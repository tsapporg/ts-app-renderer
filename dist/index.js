"use strict";function _get(){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get.bind();}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver);}return desc.value;};}return _get.apply(this,arguments);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable;})),t.push.apply(t,o);}return t;}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r]);}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r));});}return e;}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _regeneratorRuntime(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function _regeneratorRuntime(){return e;};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value;},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e];}try{define({},"");}catch(t){define=function define(t,e,r){return t[e]=r;};}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a;}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)};}catch(t){return{type:"throw",arg:t};}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this;});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t);});});}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a);},function(t){invoke("throw",t,i,a);}):e.resolve(h).then(function(t){u.value=t,i(u);},function(t){return invoke("throw",t,i,a);});}a(c.arg);}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r);});}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg();}});}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0};}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u;}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg);}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done};}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg);}};}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y);}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e);}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e;}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0);}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next;};return i.next=i;}}throw new TypeError(_typeof(e)+" is not iterable");}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name));},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t;},e.awrap=function(t){return{__await:t};},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this;}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next();});},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this;}),define(g,"toString",function(){return"[object Generator]";}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next;}return next.done=!0,next;};},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t);},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval;},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o;}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc);}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc);}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break;}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a);},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y;},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y;}},"catch":function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r);}return o;}}throw new Error("illegal catch attempt");},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y;}},e;}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value;}catch(error){reject(error);return;}if(info.done){resolve(value);}else{Promise.resolve(value).then(_next,_throw);}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value);}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err);}_next(undefined);});};}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l){if(Object(t)!==t)return;f=!1;}else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r;}finally{try{if(!f&&null!=t["return"]&&(u=t["return"](),Object(u)!==u))return;}finally{if(o)throw n;}}return a;}}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _wrapNativeSuper(Class){var _cache=typeof Map==="function"?new Map():undefined;_wrapNativeSuper=function _wrapNativeSuper(Class){if(Class===null||!_isNativeFunction(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function");}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper);}function Wrapper(){return _construct(Class,arguments,_getPrototypeOf(this).constructor);}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _setPrototypeOf(Wrapper,Class);};return _wrapNativeSuper(Class);}function _construct(Parent,args,Class){if(_isNativeReflectConstruct()){_construct=Reflect.construct.bind();}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _isNativeFunction(fn){try{return Function.toString.call(fn).indexOf("[native code]")!==-1;}catch(e){return typeof fn==="function";}}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==_typeof(i)?i:String(i);}function _toPrimitive(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.");}return("string"===r?String:Number)(t);}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e2){throw _e2;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e3){didErr=true;err=_e3;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2;}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o;}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o;},_typeof(o);}var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __commonJS=function __commonJS(cb,mod){return function __require(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports;};};var __export=function __export(target,all){for(var name135 in all)__defProp(target,name135,{get:all[name135],enumerable:true});};var __copyProps=function __copyProps(to,from,except,desc){if(from&&_typeof(from)==="object"||typeof from==="function"){var _iterator=_createForOfIteratorHelper(__getOwnPropNames(from)),_step;try{var _loop=function _loop(){var key=_step.value;if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:function get(){return from[key];},enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});};for(_iterator.s();!(_step=_iterator.n()).done;){_loop();}}catch(err){_iterator.e(err);}finally{_iterator.f();}}return to;};var __toESM=function __toESM(mod,isNodeMode,target){return target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod);};var __toCommonJS=function __toCommonJS(mod){return __copyProps(__defProp({},"__esModule",{value:true}),mod);};// node_modules/class-logger/dist/src/constants.js
var require_constants=__commonJS({"node_modules/class-logger/dist/src/constants.js":function node_modulesClassLoggerDistSrcConstantsJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CLASS_LOGGER_METADATA_KEY=Symbol();}});// node_modules/fast-safe-stringify/index.js
var require_fast_safe_stringify=__commonJS({"node_modules/fast-safe-stringify/index.js":function node_modulesFastSafeStringifyIndexJs(exports,module2){module2.exports=stringify;stringify["default"]=stringify;stringify.stable=deterministicStringify;stringify.stableStringify=deterministicStringify;var LIMIT_REPLACE_NODE="[...]";var CIRCULAR_REPLACE_NODE="[Circular]";var arr=[];var replacerStack=[];function defaultOptions2(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER};}function stringify(obj,replacer,spacer,options){if(typeof options==="undefined"){options=defaultOptions2();}decirc(obj,"",0,[],void 0,0,options);var res;try{if(replacerStack.length===0){res=JSON.stringify(obj,replacer,spacer);}else{res=JSON.stringify(obj,replaceGetterValues(replacer),spacer);}}catch(_){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]");}finally{while(arr.length!==0){var part=arr.pop();if(part.length===4){Object.defineProperty(part[0],part[1],part[3]);}else{part[0][part[1]]=part[2];}}}return res;}function setReplace(replace,val,k,parent){var propertyDescriptor=Object.getOwnPropertyDescriptor(parent,k);if(propertyDescriptor.get!==void 0){if(propertyDescriptor.configurable){Object.defineProperty(parent,k,{value:replace});arr.push([parent,k,val,propertyDescriptor]);}else{replacerStack.push([val,k,replace]);}}else{parent[k]=replace;arr.push([parent,k,val]);}}function decirc(val,k,edgeIndex,stack,parent,depth,options){depth+=1;var i;if(_typeof(val)==="object"&&val!==null){for(i=0;i<stack.length;i++){if(stack[i]===val){setReplace(CIRCULAR_REPLACE_NODE,val,k,parent);return;}}if(typeof options.depthLimit!=="undefined"&&depth>options.depthLimit){setReplace(LIMIT_REPLACE_NODE,val,k,parent);return;}if(typeof options.edgesLimit!=="undefined"&&edgeIndex+1>options.edgesLimit){setReplace(LIMIT_REPLACE_NODE,val,k,parent);return;}stack.push(val);if(Array.isArray(val)){for(i=0;i<val.length;i++){decirc(val[i],i,i,stack,val,depth,options);}}else{var keys=Object.keys(val);for(i=0;i<keys.length;i++){var key=keys[i];decirc(val[key],key,i,stack,val,depth,options);}}stack.pop();}}function compareFunction(a,b){if(a<b){return-1;}if(a>b){return 1;}return 0;}function deterministicStringify(obj,replacer,spacer,options){if(typeof options==="undefined"){options=defaultOptions2();}var tmp=deterministicDecirc(obj,"",0,[],void 0,0,options)||obj;var res;try{if(replacerStack.length===0){res=JSON.stringify(tmp,replacer,spacer);}else{res=JSON.stringify(tmp,replaceGetterValues(replacer),spacer);}}catch(_){return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]");}finally{while(arr.length!==0){var part=arr.pop();if(part.length===4){Object.defineProperty(part[0],part[1],part[3]);}else{part[0][part[1]]=part[2];}}}return res;}function deterministicDecirc(val,k,edgeIndex,stack,parent,depth,options){depth+=1;var i;if(_typeof(val)==="object"&&val!==null){for(i=0;i<stack.length;i++){if(stack[i]===val){setReplace(CIRCULAR_REPLACE_NODE,val,k,parent);return;}}try{if(typeof val.toJSON==="function"){return;}}catch(_){return;}if(typeof options.depthLimit!=="undefined"&&depth>options.depthLimit){setReplace(LIMIT_REPLACE_NODE,val,k,parent);return;}if(typeof options.edgesLimit!=="undefined"&&edgeIndex+1>options.edgesLimit){setReplace(LIMIT_REPLACE_NODE,val,k,parent);return;}stack.push(val);if(Array.isArray(val)){for(i=0;i<val.length;i++){deterministicDecirc(val[i],i,i,stack,val,depth,options);}}else{var tmp={};var keys=Object.keys(val).sort(compareFunction);for(i=0;i<keys.length;i++){var key=keys[i];deterministicDecirc(val[key],key,i,stack,val,depth,options);tmp[key]=val[key];}if(typeof parent!=="undefined"){arr.push([parent,k,val]);parent[k]=tmp;}else{return tmp;}}stack.pop();}}function replaceGetterValues(replacer){replacer=typeof replacer!=="undefined"?replacer:function(k,v){return v;};return function(key,val){if(replacerStack.length>0){for(var i=0;i<replacerStack.length;i++){var part=replacerStack[i];if(part[1]===key&&part[0]===val){val=part[2];replacerStack.splice(i,1);break;}}}return replacer.call(this,key,val);};}}});// node_modules/class-logger/dist/src/formatter.service.js
var require_formatter_service=__commonJS({"node_modules/class-logger/dist/src/formatter.service.js":function node_modulesClassLoggerDistSrcFormatterServiceJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var fast_safe_stringify_12=require_fast_safe_stringify();var ClassLoggerFormatterService2=/*#__PURE__*/function(){function ClassLoggerFormatterService2(){_classCallCheck(this,ClassLoggerFormatterService2);this.placeholderNotAvailable="N/A";this.placeholderUndefined="undefined";}_createClass(ClassLoggerFormatterService2,[{key:"start",value:function start(data){var message=this.base(data);if(this.includeComplex(data.include.args,"start")){message+=this.args(data);}if(this.includeComplex(data.include.classInstance,"start")){message+=this.classInstance(data);}message+=this["final"]();return message;}},{key:"end",value:function end(data){var message=this.base(data);message+=this.operation(data);if(this.includeComplex(data.include.args,"end")){message+=this.args(data);}if(this.includeComplex(data.include.classInstance,"end")){message+=this.classInstance(data);}if(data.include.result){message+=this.result(data);}message+=this["final"]();return message;}},{key:"base",value:function base(_ref){var className=_ref.className,propertyName=_ref.propertyName;return"".concat(className,".").concat(propertyName.toString());}},{key:"operation",value:function operation(_ref2){var error=_ref2.error;return error?" -> error":" -> done";}},{key:"args",value:function args(_ref3){var _args=_ref3.args;return". Args: ".concat(this.valueToString(_args));}},{key:"classInstance",value:function classInstance(_ref4){var _classInstance=_ref4.classInstance;return". Class instance: ".concat(this.complexObjectToString(_classInstance));}},{key:"result",value:function result(_ref5){var _result=_ref5.result;return". Res: ".concat(this.valueToString(_result));}},{key:"final",value:function final(){return".";}},{key:"complexObjectToString",value:function complexObjectToString(obj){var _this=this;if(_typeof(obj)!=="object"){return this.placeholderNotAvailable;}if(obj===null){return fast_safe_stringify_12["default"](obj);}var classInstanceFiltered={};var keys=Object.keys(obj);if(obj instanceof Map||obj instanceof Set){keys=_toConsumableArray(obj.keys());}keys.forEach(function(key){var value=obj[key];if(typeof value==="function"){return;}classInstanceFiltered[key]=_typeof(value)==="object"&&!_this.isPlainObjectOrArray(value)?_this.complexObjectToString(value):value;});return"".concat(obj.constructor.name," ").concat(fast_safe_stringify_12["default"](classInstanceFiltered));}},{key:"valueToString",value:function valueToString(val){if(val===void 0){return this.placeholderUndefined;}if(_typeof(val)!=="object"){return val.toString();}if(val instanceof Error){return this.errorToString(val);}if(!this.isPlainObjectOrArray(val)){return this.complexObjectToString(val);}if(Array.isArray(val)){var arrayWithStringifiedElements=val.map(this.valueToString.bind(this));return"[".concat(arrayWithStringifiedElements.join(", "),"]");}return fast_safe_stringify_12["default"](val);}},{key:"includeComplex",value:function includeComplex(_includeComplex,type){if(typeof _includeComplex==="boolean"){return _includeComplex;}return _includeComplex[type];}},{key:"isPlainObjectOrArray",value:function isPlainObjectOrArray(obj){if(!obj){return false;}var proto=Object.getPrototypeOf(obj);return proto===Object.prototype||proto===Array.prototype;}},{key:"errorToString",value:function errorToString(error){var data={code:error.code,message:error.message,name:error.name,stack:error.stack};return"".concat(error.constructor.name," ").concat(fast_safe_stringify_12["default"](data));}}]);return ClassLoggerFormatterService2;}();exports.ClassLoggerFormatterService=ClassLoggerFormatterService2;}});// node_modules/class-logger/dist/src/config.service.js
var require_config_service=__commonJS({"node_modules/class-logger/dist/src/config.service.js":function node_modulesClassLoggerDistSrcConfigServiceJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var formatter_service_1=require_formatter_service();var ConfigService=/*#__PURE__*/function(){function ConfigService(){_classCallCheck(this,ConfigService);}_createClass(ConfigService,null,[{key:"configsMerge",value:function configsMerge(config){for(var _len=arguments.length,configsPartial=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){configsPartial[_key-1]=arguments[_key];}return configsPartial.reduce(function(configRes,configPartial){return Object.assign(Object.assign(Object.assign({},configRes),configPartial),{include:Object.assign(Object.assign({},configRes.include),configPartial.include)});},config);}},{key:"setConfig",value:function setConfig(config){this.config=this.configsMerge(this.config,config);}}]);return ConfigService;}();exports.ConfigService=ConfigService;ConfigService.config={formatter:new formatter_service_1.ClassLoggerFormatterService(),include:{args:true,classInstance:false,construct:true,result:true},log:function log(message){return console.log(message);},logError:function logError(message){return console.error(message);}};}});// node_modules/class-logger/dist/src/class-wrapper.service.js
var require_class_wrapper_service=__commonJS({"node_modules/class-logger/dist/src/class-wrapper.service.js":function node_modulesClassLoggerDistSrcClassWrapperServiceJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var config_service_1=require_config_service();var constants_1=require_constants();var ClassWrapperService=/*#__PURE__*/function(){function ClassWrapperService(){var _this2=this;_classCallCheck(this,ClassWrapperService);this.proxyTrapConstruct=function(target,args,newTarget){var config=_this2.classGetConfigMerged(target.prototype);if(config.include.construct){var messageStart=config.formatter.start({args:args,className:target.name,include:config.include,propertyName:"construct"});config.log(messageStart);}var instance=Reflect.construct(target,args,newTarget);var instanceWrapped=_this2.wrapClassInstance(instance);return instanceWrapped;};this.makeProxyTrapGet=function(className){return function(target,property,receiver){var prop=Reflect.get(target,property,receiver);if(typeof prop!=="function"){return prop;}var configProp=Reflect.getMetadata(constants_1.CLASS_LOGGER_METADATA_KEY,target,property);if(!configProp){return prop;}var configClass=_this2.classGetConfigMerged(target);var configFinal=config_service_1.ConfigService.configsMerge(configClass,configProp);var propWrapped=_this2.wrapFunction(configFinal,prop,className,property,target);return propWrapped;};};}_createClass(ClassWrapperService,[{key:"wrap",value:function wrap(targetWrap){var get=this.makeProxyTrapGet(targetWrap.name);var proxied=new Proxy(targetWrap,{construct:this.proxyTrapConstruct,get:get});Reflect.getMetadataKeys(targetWrap).forEach(function(metadataKey){Reflect.defineMetadata(metadataKey,Reflect.getMetadata(metadataKey,targetWrap),proxied);});return proxied;}},{key:"wrapClassInstance",value:function wrapClassInstance(instance){var get=this.makeProxyTrapGet(instance.constructor.name);return new Proxy(instance,{get:get});}},{key:"wrapFunction",value:function wrapFunction(config,fn,className,propertyName,classInstance){var classWrapper=this;var res=function res(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}var messageStart=config.formatter.start({args:args,classInstance:classInstance,className:className,include:config.include,propertyName:propertyName});config.log(messageStart);var logEnd=function logEnd(result,error){var messageEnd=config.formatter.end({args:args,classInstance:classInstance,className:className,error:!!error,include:config.include,propertyName:propertyName,result:result});var logFn=config.log;if(error){logFn=config.logError;}logFn(messageEnd);};try{var fnRes=fn.apply(this,args);if(classWrapper.isPromise(fnRes)){fnRes=fnRes.then(function(result){logEnd(result);return result;})["catch"](function(error){logEnd(error,true);throw error;});return fnRes;}logEnd(fnRes);return fnRes;}catch(error){logEnd(error,true);throw error;}};Object.keys(fn).forEach(function(prop){res[prop]=fn[prop];});return res;}},{key:"isPromise",value:function isPromise(val){return!!val&&_typeof(val)==="object"&&typeof val.then==="function"&&typeof val["catch"]==="function";}},{key:"classGetConfigMerged",value:function classGetConfigMerged(target){var configClassMeta=Reflect.getMetadata(constants_1.CLASS_LOGGER_METADATA_KEY,target);var configRes=config_service_1.ConfigService.configsMerge(config_service_1.ConfigService.config,configClassMeta);return configRes;}}]);return ClassWrapperService;}();exports.ClassWrapperService=ClassWrapperService;}});// node_modules/class-logger/dist/src/log-class.decorator.js
var require_log_class_decorator=__commonJS({"node_modules/class-logger/dist/src/log-class.decorator.js":function node_modulesClassLoggerDistSrcLogClassDecoratorJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var class_wrapper_service_1=require_class_wrapper_service();var constants_1=require_constants();var classWrapper=new class_wrapper_service_1.ClassWrapperService();exports.LogClass=function(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return function(target){Reflect.defineMetadata(constants_1.CLASS_LOGGER_METADATA_KEY,config,target.prototype);Reflect.defineMetadata(constants_1.CLASS_LOGGER_METADATA_KEY,config,target);return classWrapper.wrap(target);};};}});// node_modules/class-logger/dist/src/log.decorator.js
var require_log_decorator=__commonJS({"node_modules/class-logger/dist/src/log.decorator.js":function node_modulesClassLoggerDistSrcLogDecoratorJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants_1=require_constants();exports.Log=function(){var config=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return function(target,propertyKey){Reflect.defineMetadata(constants_1.CLASS_LOGGER_METADATA_KEY,config,target,propertyKey);};};}});// node_modules/class-logger/dist/index.js
var require_dist=__commonJS({"node_modules/class-logger/dist/index.js":function node_modulesClassLoggerDistIndexJs(exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants_1=require_constants();exports.CLASS_LOGGER_METADATA_KEY=constants_1.CLASS_LOGGER_METADATA_KEY;var config_service_1=require_config_service();var formatter_service_1=require_formatter_service();exports.ClassLoggerFormatterService=formatter_service_1.ClassLoggerFormatterService;var log_class_decorator_1=require_log_class_decorator();exports.LogClass=log_class_decorator_1.LogClass;var log_decorator_1=require_log_decorator();exports.Log=log_decorator_1.Log;exports.setConfig=config_service_1.ConfigService.setConfig.bind(config_service_1.ConfigService);}});// src/index.ts
var src_exports2={};__export(src_exports2,{ALevel:function ALevel(){return _ALevel;},AScene:function AScene(){return _AScene;},BabylonRenderer:function BabylonRenderer(){return _BabylonRenderer;},RendererState:function RendererState(){return _RendererState;},constants:function constants(){return constants_exports;},viewport:function viewport(){return viewport_exports;}});module.exports=__toCommonJS(src_exports2);// src/constants.ts
var constants_exports={};__export(constants_exports,{scene:function scene(){return _scene2;},strings:function strings(){return _strings;}});// node_modules/reflect-metadata/Reflect.js
var Reflect2;(function(Reflect3){(function(factory){var root=(typeof global==="undefined"?"undefined":_typeof(global))==="object"?global:(typeof self==="undefined"?"undefined":_typeof(self))==="object"?self:_typeof(this)==="object"?this:Function("return this;")();var exporter=makeExporter(Reflect3);if(typeof root.Reflect==="undefined"){root.Reflect=Reflect3;}else{exporter=makeExporter(root.Reflect,exporter);}factory(exporter);function makeExporter(target,previous){return function(key,value){if(typeof target[key]!=="function"){Object.defineProperty(target,key,{configurable:true,writable:true,value:value});}if(previous)previous(key,value);};}})(function(exporter){var hasOwn=Object.prototype.hasOwnProperty;var supportsSymbol=typeof Symbol==="function";var toPrimitiveSymbol=supportsSymbol&&typeof Symbol.toPrimitive!=="undefined"?Symbol.toPrimitive:"@@toPrimitive";var iteratorSymbol=supportsSymbol&&typeof Symbol.iterator!=="undefined"?Symbol.iterator:"@@iterator";var supportsCreate=typeof Object.create==="function";var supportsProto={__proto__:[]}instanceof Array;var downLevel=!supportsCreate&&!supportsProto;var HashMap={create:supportsCreate?function(){return MakeDictionary(/* @__PURE__ */Object.create(null));}:supportsProto?function(){return MakeDictionary({__proto__:null});}:function(){return MakeDictionary({});},has:downLevel?function(map,key){return hasOwn.call(map,key);}:function(map,key){return key in map;},get:downLevel?function(map,key){return hasOwn.call(map,key)?map[key]:void 0;}:function(map,key){return map[key];}};var functionPrototype=Object.getPrototypeOf(Function);var usePolyfill=(typeof process==="undefined"?"undefined":_typeof(process))==="object"&&process.env&&process.env["REFLECT_METADATA_USE_MAP_POLYFILL"]==="true";var _Map=!usePolyfill&&typeof Map==="function"&&typeof Map.prototype.entries==="function"?Map:CreateMapPolyfill();var _Set=!usePolyfill&&typeof Set==="function"&&typeof Set.prototype.entries==="function"?Set:CreateSetPolyfill();var _WeakMap=!usePolyfill&&typeof WeakMap==="function"?WeakMap:CreateWeakMapPolyfill();var Metadata=new _WeakMap();function decorate(decorators,target,propertyKey,attributes){if(!IsUndefined(propertyKey)){if(!IsArray(decorators))throw new TypeError();if(!IsObject(target))throw new TypeError();if(!IsObject(attributes)&&!IsUndefined(attributes)&&!IsNull(attributes))throw new TypeError();if(IsNull(attributes))attributes=void 0;propertyKey=ToPropertyKey(propertyKey);return DecorateProperty(decorators,target,propertyKey,attributes);}else{if(!IsArray(decorators))throw new TypeError();if(!IsConstructor(target))throw new TypeError();return DecorateConstructor(decorators,target);}}exporter("decorate",decorate);function metadata(metadataKey,metadataValue){function decorator(target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey)&&!IsPropertyKey(propertyKey))throw new TypeError();OrdinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey);}return decorator;}exporter("metadata",metadata);function defineMetadata(metadataKey,metadataValue,target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryDefineOwnMetadata(metadataKey,metadataValue,target,propertyKey);}exporter("defineMetadata",defineMetadata);function hasMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryHasMetadata(metadataKey,target,propertyKey);}exporter("hasMetadata",hasMetadata);function hasOwnMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryHasOwnMetadata(metadataKey,target,propertyKey);}exporter("hasOwnMetadata",hasOwnMetadata);function getMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryGetMetadata(metadataKey,target,propertyKey);}exporter("getMetadata",getMetadata);function getOwnMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryGetOwnMetadata(metadataKey,target,propertyKey);}exporter("getOwnMetadata",getOwnMetadata);function getMetadataKeys(target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryMetadataKeys(target,propertyKey);}exporter("getMetadataKeys",getMetadataKeys);function getOwnMetadataKeys(target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);return OrdinaryOwnMetadataKeys(target,propertyKey);}exporter("getOwnMetadataKeys",getOwnMetadataKeys);function deleteMetadata(metadataKey,target,propertyKey){if(!IsObject(target))throw new TypeError();if(!IsUndefined(propertyKey))propertyKey=ToPropertyKey(propertyKey);var metadataMap=GetOrCreateMetadataMap(target,propertyKey,false);if(IsUndefined(metadataMap))return false;if(!metadataMap["delete"](metadataKey))return false;if(metadataMap.size>0)return true;var targetMetadata=Metadata.get(target);targetMetadata["delete"](propertyKey);if(targetMetadata.size>0)return true;Metadata["delete"](target);return true;}exporter("deleteMetadata",deleteMetadata);function DecorateConstructor(decorators,target){for(var i=decorators.length-1;i>=0;--i){var decorator=decorators[i];var decorated=decorator(target);if(!IsUndefined(decorated)&&!IsNull(decorated)){if(!IsConstructor(decorated))throw new TypeError();target=decorated;}}return target;}function DecorateProperty(decorators,target,propertyKey,descriptor){for(var i=decorators.length-1;i>=0;--i){var decorator=decorators[i];var decorated=decorator(target,propertyKey,descriptor);if(!IsUndefined(decorated)&&!IsNull(decorated)){if(!IsObject(decorated))throw new TypeError();descriptor=decorated;}}return descriptor;}function GetOrCreateMetadataMap(O,P,Create){var targetMetadata=Metadata.get(O);if(IsUndefined(targetMetadata)){if(!Create)return void 0;targetMetadata=new _Map();Metadata.set(O,targetMetadata);}var metadataMap=targetMetadata.get(P);if(IsUndefined(metadataMap)){if(!Create)return void 0;metadataMap=new _Map();targetMetadata.set(P,metadataMap);}return metadataMap;}function OrdinaryHasMetadata(MetadataKey,O,P){var hasOwn2=OrdinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn2)return true;var parent=OrdinaryGetPrototypeOf(O);if(!IsNull(parent))return OrdinaryHasMetadata(MetadataKey,parent,P);return false;}function OrdinaryHasOwnMetadata(MetadataKey,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,false);if(IsUndefined(metadataMap))return false;return ToBoolean(metadataMap.has(MetadataKey));}function OrdinaryGetMetadata(MetadataKey,O,P){var hasOwn2=OrdinaryHasOwnMetadata(MetadataKey,O,P);if(hasOwn2)return OrdinaryGetOwnMetadata(MetadataKey,O,P);var parent=OrdinaryGetPrototypeOf(O);if(!IsNull(parent))return OrdinaryGetMetadata(MetadataKey,parent,P);return void 0;}function OrdinaryGetOwnMetadata(MetadataKey,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,false);if(IsUndefined(metadataMap))return void 0;return metadataMap.get(MetadataKey);}function OrdinaryDefineOwnMetadata(MetadataKey,MetadataValue,O,P){var metadataMap=GetOrCreateMetadataMap(O,P,true);metadataMap.set(MetadataKey,MetadataValue);}function OrdinaryMetadataKeys(O,P){var ownKeys=OrdinaryOwnMetadataKeys(O,P);var parent=OrdinaryGetPrototypeOf(O);if(parent===null)return ownKeys;var parentKeys=OrdinaryMetadataKeys(parent,P);if(parentKeys.length<=0)return ownKeys;if(ownKeys.length<=0)return parentKeys;var set=new _Set();var keys=[];for(var _i=0,ownKeys_1=ownKeys;_i<ownKeys_1.length;_i++){var key=ownKeys_1[_i];var hasKey=set.has(key);if(!hasKey){set.add(key);keys.push(key);}}for(var _a=0,parentKeys_1=parentKeys;_a<parentKeys_1.length;_a++){var key=parentKeys_1[_a];var hasKey=set.has(key);if(!hasKey){set.add(key);keys.push(key);}}return keys;}function OrdinaryOwnMetadataKeys(O,P){var keys=[];var metadataMap=GetOrCreateMetadataMap(O,P,false);if(IsUndefined(metadataMap))return keys;var keysObj=metadataMap.keys();var iterator=GetIterator(keysObj);var k=0;while(true){var next=IteratorStep(iterator);if(!next){keys.length=k;return keys;}var nextValue=IteratorValue(next);try{keys[k]=nextValue;}catch(e){try{IteratorClose(iterator);}finally{throw e;}}k++;}}function Type(x){if(x===null)return 1;switch(_typeof(x)){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return x===null?1:6;default:return 6;}}function IsUndefined(x){return x===void 0;}function IsNull(x){return x===null;}function IsSymbol(x){return _typeof(x)==="symbol";}function IsObject(x){return _typeof(x)==="object"?x!==null:typeof x==="function";}function ToPrimitive(input,PreferredType){switch(Type(input)){case 0:return input;case 1:return input;case 2:return input;case 3:return input;case 4:return input;case 5:return input;}var hint=PreferredType===3?"string":PreferredType===5?"number":"default";var exoticToPrim=GetMethod(input,toPrimitiveSymbol);if(exoticToPrim!==void 0){var result=exoticToPrim.call(input,hint);if(IsObject(result))throw new TypeError();return result;}return OrdinaryToPrimitive(input,hint==="default"?"number":hint);}function OrdinaryToPrimitive(O,hint){if(hint==="string"){var toString_1=O.toString;if(IsCallable(toString_1)){var result=toString_1.call(O);if(!IsObject(result))return result;}var valueOf=O.valueOf;if(IsCallable(valueOf)){var result=valueOf.call(O);if(!IsObject(result))return result;}}else{var valueOf=O.valueOf;if(IsCallable(valueOf)){var result=valueOf.call(O);if(!IsObject(result))return result;}var toString_2=O.toString;if(IsCallable(toString_2)){var result=toString_2.call(O);if(!IsObject(result))return result;}}throw new TypeError();}function ToBoolean(argument){return!!argument;}function ToString(argument){return""+argument;}function ToPropertyKey(argument){var key=ToPrimitive(argument,3);if(IsSymbol(key))return key;return ToString(key);}function IsArray(argument){return Array.isArray?Array.isArray(argument):argument instanceof Object?argument instanceof Array:Object.prototype.toString.call(argument)==="[object Array]";}function IsCallable(argument){return typeof argument==="function";}function IsConstructor(argument){return typeof argument==="function";}function IsPropertyKey(argument){switch(Type(argument)){case 3:return true;case 4:return true;default:return false;}}function GetMethod(V,P){var func=V[P];if(func===void 0||func===null)return void 0;if(!IsCallable(func))throw new TypeError();return func;}function GetIterator(obj){var method=GetMethod(obj,iteratorSymbol);if(!IsCallable(method))throw new TypeError();var iterator=method.call(obj);if(!IsObject(iterator))throw new TypeError();return iterator;}function IteratorValue(iterResult){return iterResult.value;}function IteratorStep(iterator){var result=iterator.next();return result.done?false:result;}function IteratorClose(iterator){var f=iterator["return"];if(f)f.call(iterator);}function OrdinaryGetPrototypeOf(O){var proto=Object.getPrototypeOf(O);if(typeof O!=="function"||O===functionPrototype)return proto;if(proto!==functionPrototype)return proto;var prototype=O.prototype;var prototypeProto=prototype&&Object.getPrototypeOf(prototype);if(prototypeProto==null||prototypeProto===Object.prototype)return proto;var constructor=prototypeProto.constructor;if(typeof constructor!=="function")return proto;if(constructor===O)return proto;return constructor;}function CreateMapPolyfill(){var cacheSentinel={};var arraySentinel=[];var MapIterator=function(){function MapIterator2(keys,values,selector){this._index=0;this._keys=keys;this._values=values;this._selector=selector;}MapIterator2.prototype["@@iterator"]=function(){return this;};MapIterator2.prototype[iteratorSymbol]=function(){return this;};MapIterator2.prototype.next=function(){var index=this._index;if(index>=0&&index<this._keys.length){var result=this._selector(this._keys[index],this._values[index]);if(index+1>=this._keys.length){this._index=-1;this._keys=arraySentinel;this._values=arraySentinel;}else{this._index++;}return{value:result,done:false};}return{value:void 0,done:true};};MapIterator2.prototype["throw"]=function(error){if(this._index>=0){this._index=-1;this._keys=arraySentinel;this._values=arraySentinel;}throw error;};MapIterator2.prototype["return"]=function(value){if(this._index>=0){this._index=-1;this._keys=arraySentinel;this._values=arraySentinel;}return{value:value,done:true};};return MapIterator2;}();return function(){function Map2(){this._keys=[];this._values=[];this._cacheKey=cacheSentinel;this._cacheIndex=-2;}Object.defineProperty(Map2.prototype,"size",{get:function get(){return this._keys.length;},enumerable:true,configurable:true});Map2.prototype.has=function(key){return this._find(key,false)>=0;};Map2.prototype.get=function(key){var index=this._find(key,false);return index>=0?this._values[index]:void 0;};Map2.prototype.set=function(key,value){var index=this._find(key,true);this._values[index]=value;return this;};Map2.prototype["delete"]=function(key){var index=this._find(key,false);if(index>=0){var size=this._keys.length;for(var i=index+1;i<size;i++){this._keys[i-1]=this._keys[i];this._values[i-1]=this._values[i];}this._keys.length--;this._values.length--;if(key===this._cacheKey){this._cacheKey=cacheSentinel;this._cacheIndex=-2;}return true;}return false;};Map2.prototype.clear=function(){this._keys.length=0;this._values.length=0;this._cacheKey=cacheSentinel;this._cacheIndex=-2;};Map2.prototype.keys=function(){return new MapIterator(this._keys,this._values,getKey);};Map2.prototype.values=function(){return new MapIterator(this._keys,this._values,getValue);};Map2.prototype.entries=function(){return new MapIterator(this._keys,this._values,getEntry);};Map2.prototype["@@iterator"]=function(){return this.entries();};Map2.prototype[iteratorSymbol]=function(){return this.entries();};Map2.prototype._find=function(key,insert){if(this._cacheKey!==key){this._cacheIndex=this._keys.indexOf(this._cacheKey=key);}if(this._cacheIndex<0&&insert){this._cacheIndex=this._keys.length;this._keys.push(key);this._values.push(void 0);}return this._cacheIndex;};return Map2;}();function getKey(key,_){return key;}function getValue(_,value){return value;}function getEntry(key,value){return[key,value];}}function CreateSetPolyfill(){return function(){function Set2(){this._map=new _Map();}Object.defineProperty(Set2.prototype,"size",{get:function get(){return this._map.size;},enumerable:true,configurable:true});Set2.prototype.has=function(value){return this._map.has(value);};Set2.prototype.add=function(value){return this._map.set(value,value),this;};Set2.prototype["delete"]=function(value){return this._map["delete"](value);};Set2.prototype.clear=function(){this._map.clear();};Set2.prototype.keys=function(){return this._map.keys();};Set2.prototype.values=function(){return this._map.values();};Set2.prototype.entries=function(){return this._map.entries();};Set2.prototype["@@iterator"]=function(){return this.keys();};Set2.prototype[iteratorSymbol]=function(){return this.keys();};return Set2;}();}function CreateWeakMapPolyfill(){var UUID_SIZE=16;var keys=HashMap.create();var rootKey=CreateUniqueKey();return function(){function WeakMap2(){this._key=CreateUniqueKey();}WeakMap2.prototype.has=function(target){var table=GetOrCreateWeakMapTable(target,false);return table!==void 0?HashMap.has(table,this._key):false;};WeakMap2.prototype.get=function(target){var table=GetOrCreateWeakMapTable(target,false);return table!==void 0?HashMap.get(table,this._key):void 0;};WeakMap2.prototype.set=function(target,value){var table=GetOrCreateWeakMapTable(target,true);table[this._key]=value;return this;};WeakMap2.prototype["delete"]=function(target){var table=GetOrCreateWeakMapTable(target,false);return table!==void 0?delete table[this._key]:false;};WeakMap2.prototype.clear=function(){this._key=CreateUniqueKey();};return WeakMap2;}();function CreateUniqueKey(){var key;do key="@@WeakMap@@"+CreateUUID();while(HashMap.has(keys,key));keys[key]=true;return key;}function GetOrCreateWeakMapTable(target,create){if(!hasOwn.call(target,rootKey)){if(!create)return void 0;Object.defineProperty(target,rootKey,{value:HashMap.create()});}return target[rootKey];}function FillRandomBytes(buffer,size){for(var i=0;i<size;++i)buffer[i]=Math.random()*255|0;return buffer;}function GenRandomBytes(size){if(typeof Uint8Array==="function"){if(typeof crypto!=="undefined")return crypto.getRandomValues(new Uint8Array(size));if(typeof msCrypto!=="undefined")return msCrypto.getRandomValues(new Uint8Array(size));return FillRandomBytes(new Uint8Array(size),size);}return FillRandomBytes(new Array(size),size);}function CreateUUID(){var data=GenRandomBytes(UUID_SIZE);data[6]=data[6]&79|64;data[8]=data[8]&191|128;var result="";for(var offset=0;offset<UUID_SIZE;++offset){var _byte=data[offset];if(offset===4||offset===6||offset===8)result+="-";if(_byte<16)result+="0";result+=_byte.toString(16).toLowerCase();}return result;}}function MakeDictionary(obj){obj.__=void 0;delete obj.__;return obj;}});})(Reflect2||(Reflect2={}));// node_modules/ts-app-logger/src/index.ts
var import_class_logger=__toESM(require_dist(),1);var import_fast_safe_stringify=__toESM(require_fast_safe_stringify(),1);var import_class_logger2=__toESM(require_dist(),1);var debugEnabled=true;var filters=void 0;var mapArgsToString=function mapArgsToString(args){return args.map(function(_){if(_ instanceof Error){return"".concat(_.message," ").concat(_.stack);}if(_ instanceof Object){return JSON.stringify(_);}return _.toString();}).join(" ");};var debug=function debug(){if(!debugEnabled){return;}for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}try{var message=mapArgsToString(args);if(!filters||filters&&filters.length===0||filters&&filters.find(function(filter){return message.includes(filter);})){console.debug("DEBUG ".concat(message));}}catch(error){console.debug.apply(args);}};// src/constants.ts
debug("constants loaded");var _scene2;(function(scene2){scene2.defaultCameraName="Default Camera";scene2.defaultCameraLocation=[0,0,-10];scene2.headlessViewportWidth=800;scene2.headlessViewportHeight=600;})(_scene2||(_scene2={}));var _strings;(function(strings2){strings2.notImplementedError="Not implemented.";})(_strings||(_strings={}));// node_modules/@babylonjs/core/Misc/observable.js
var EventState=/*#__PURE__*/function(){function EventState(mask){var skipNextObservers=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var target=arguments.length>2?arguments[2]:undefined;var currentTarget=arguments.length>3?arguments[3]:undefined;_classCallCheck(this,EventState);this.initialize(mask,skipNextObservers,target,currentTarget);}_createClass(EventState,[{key:"initialize",value:function initialize(mask){var skipNextObservers=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var target=arguments.length>2?arguments[2]:undefined;var currentTarget=arguments.length>3?arguments[3]:undefined;this.mask=mask;this.skipNextObservers=skipNextObservers;this.target=target;this.currentTarget=currentTarget;return this;}}]);return EventState;}();var Observer=/*#__PURE__*/_createClass(function Observer(callback,mask){var scope=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_classCallCheck(this,Observer);this.callback=callback;this.mask=mask;this.scope=scope;this._willBeUnregistered=false;this.unregisterOnNextCall=false;});var Observable=/*#__PURE__*/function(){function Observable(onObserverAdded){_classCallCheck(this,Observable);this._observers=new Array();this._numObserversMarkedAsDeleted=0;this._eventState=new EventState(0);if(onObserverAdded){this._onObserverAdded=onObserverAdded;}}_createClass(Observable,[{key:"observers",get:function get(){return this._observers;}},{key:"add",value:function add(callback){var mask=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var insertFirst=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var scope=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var unregisterOnFirstCall=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(!callback){return null;}var observer=new Observer(callback,mask,scope);observer.unregisterOnNextCall=unregisterOnFirstCall;if(insertFirst){this._observers.unshift(observer);}else{this._observers.push(observer);}if(this._onObserverAdded){this._onObserverAdded(observer);}return observer;}},{key:"addOnce",value:function addOnce(callback){return this.add(callback,void 0,void 0,void 0,true);}},{key:"remove",value:function remove(observer){if(!observer){return false;}var index=this._observers.indexOf(observer);if(index!==-1){this._deferUnregister(observer);return true;}return false;}},{key:"removeCallback",value:function removeCallback(callback,scope){for(var index=0;index<this._observers.length;index++){var observer=this._observers[index];if(observer._willBeUnregistered){continue;}if(observer.callback===callback&&(!scope||scope===observer.scope)){this._deferUnregister(observer);return true;}}return false;}},{key:"_deferUnregister",value:function _deferUnregister(observer){var _this3=this;this._numObserversMarkedAsDeleted++;observer.unregisterOnNextCall=false;observer._willBeUnregistered=true;setTimeout(function(){_this3._remove(observer);},0);}},{key:"_remove",value:function _remove(observer){var updateCounter=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!observer){return false;}var index=this._observers.indexOf(observer);if(index!==-1){if(updateCounter){this._numObserversMarkedAsDeleted--;}this._observers.splice(index,1);return true;}return false;}},{key:"makeObserverTopPriority",value:function makeObserverTopPriority(observer){this._remove(observer,false);this._observers.unshift(observer);}},{key:"makeObserverBottomPriority",value:function makeObserverBottomPriority(observer){this._remove(observer,false);this._observers.push(observer);}},{key:"notifyObservers",value:function notifyObservers(eventData){var mask=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var target=arguments.length>2?arguments[2]:undefined;var currentTarget=arguments.length>3?arguments[3]:undefined;var userInfo=arguments.length>4?arguments[4]:undefined;if(!this._observers.length){return true;}var state=this._eventState;state.mask=mask;state.target=target;state.currentTarget=currentTarget;state.skipNextObservers=false;state.lastReturnValue=eventData;state.userInfo=userInfo;var _iterator2=_createForOfIteratorHelper(this._observers),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var obs=_step2.value;if(obs._willBeUnregistered){continue;}if(obs.mask&mask){if(obs.unregisterOnNextCall){this._deferUnregister(obs);}if(obs.scope){state.lastReturnValue=obs.callback.apply(obs.scope,[eventData,state]);}else{state.lastReturnValue=obs.callback(eventData,state);}}if(state.skipNextObservers){return false;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return true;}},{key:"notifyObserver",value:function notifyObserver(observer,eventData){var mask=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;if(observer._willBeUnregistered){return;}var state=this._eventState;state.mask=mask;state.skipNextObservers=false;if(observer.unregisterOnNextCall){this._deferUnregister(observer);}observer.callback(eventData,state);}},{key:"hasObservers",value:function hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0;}},{key:"clear",value:function clear(){this._observers=new Array();this._onObserverAdded=null;this._numObserversMarkedAsDeleted=0;}},{key:"clone",value:function clone(){var result=new Observable();result._observers=this._observers.slice(0);return result;}},{key:"hasSpecificMask",value:function hasSpecificMask(){var mask=arguments.length>0&&arguments[0]!==undefined?arguments[0]:-1;var _iterator3=_createForOfIteratorHelper(this._observers),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var obs=_step3.value;if(obs.mask&mask||obs.mask===mask){return true;}}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return false;}}],[{key:"FromPromise",value:function FromPromise(promise,onErrorObservable){var observable=new Observable();promise.then(function(ret){observable.notifyObservers(ret);})["catch"](function(err){if(onErrorObservable){onErrorObservable.notifyObservers(err);}else{throw err;}});return observable;}}]);return Observable;}();// node_modules/@babylonjs/core/Misc/domManagement.js
function IsWindowObjectExist(){return typeof window!=="undefined";}function IsNavigatorAvailable(){return typeof navigator!=="undefined";}function IsDocumentAvailable(){return typeof document!=="undefined";}function GetDOMTextContent(element){var result="";var child=element.firstChild;while(child){if(child.nodeType===3){result+=child.textContent;}child=child.nextSibling;}return result;}var DomManagement={IsWindowObjectExist:IsWindowObjectExist,IsNavigatorAvailable:IsNavigatorAvailable,IsDocumentAvailable:IsDocumentAvailable,GetDOMTextContent:GetDOMTextContent};// node_modules/@babylonjs/core/Misc/logger.js
var Logger=/*#__PURE__*/function(){function Logger(){_classCallCheck(this,Logger);}_createClass(Logger,null,[{key:"_CheckLimit",value:function _CheckLimit(message,limit){var entry=Logger._LogLimitOutputs[message];if(!entry){entry={limit:limit,current:1};Logger._LogLimitOutputs[message]=entry;}else{entry.current++;}return entry.current<=entry.limit;}},{key:"_GenerateLimitMessage",value:function _GenerateLimitMessage(message){var level=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _a;var entry=Logger._LogLimitOutputs[message];if(!entry||!Logger.MessageLimitReached){return;}var type=this._Levels[level];if(entry.current===entry.limit){Logger[type.name](Logger.MessageLimitReached.replace(/%LIMIT%/g,""+entry.limit).replace(/%TYPE%/g,(_a=type.name)!==null&&_a!==void 0?_a:""));}}},{key:"_AddLogEntry",value:function _AddLogEntry(entry){Logger._LogCache=entry+Logger._LogCache;if(Logger.OnNewCacheEntry){Logger.OnNewCacheEntry(entry);}}},{key:"_FormatMessage",value:function _FormatMessage(message){var padStr=function padStr(i){return i<10?"0"+i:""+i;};var date=new Date();return"["+padStr(date.getHours())+":"+padStr(date.getMinutes())+":"+padStr(date.getSeconds())+"]: "+message;}},{key:"_LogDisabled",value:function _LogDisabled(message,limit){}},{key:"_LogEnabled",value:function _LogEnabled(){var level=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var message=arguments.length>1?arguments[1]:undefined;var limit=arguments.length>2?arguments[2]:undefined;if(limit!==void 0&&!Logger._CheckLimit(message,limit)){return;}var formattedMessage=Logger._FormatMessage(message);var type=this._Levels[level];type.logFunc&&type.logFunc("BJS - "+formattedMessage);var entry="<div style='color:".concat(type.color,"'>").concat(formattedMessage,"</div><br>");Logger._AddLogEntry(entry);Logger._GenerateLimitMessage(message,level);}},{key:"LogCache",get:function get(){return Logger._LogCache;}},{key:"ClearLogCache",value:function ClearLogCache(){Logger._LogCache="";Logger._LogLimitOutputs={};Logger.errorsCount=0;}},{key:"LogLevels",set:function set(level){var _this4=this;Logger.Log=Logger._LogDisabled;Logger.Warn=Logger._LogDisabled;Logger.Error=Logger._LogDisabled;[Logger.MessageLogLevel,Logger.WarningLogLevel,Logger.ErrorLogLevel].forEach(function(l){if((level&l)===l){var type=_this4._Levels[l];Logger[type.name]=Logger._LogEnabled.bind(Logger,l);}});}}]);return Logger;}();Logger.NoneLogLevel=0;Logger.MessageLogLevel=1;Logger.WarningLogLevel=2;Logger.ErrorLogLevel=4;Logger.AllLogLevel=7;Logger.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.";Logger._LogCache="";Logger._LogLimitOutputs={};Logger._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}];Logger.errorsCount=0;Logger.Log=Logger._LogEnabled.bind(Logger,Logger.MessageLogLevel);Logger.Warn=Logger._LogEnabled.bind(Logger,Logger.WarningLogLevel);Logger.Error=Logger._LogEnabled.bind(Logger,Logger.ErrorLogLevel);// node_modules/@babylonjs/core/Misc/deepCopier.js
var CloneValue=function CloneValue(source,destinationObject){if(!source){return null;}if(source.getClassName&&source.getClassName()==="Mesh"){return null;}if(source.getClassName&&source.getClassName()==="SubMesh"){return source.clone(destinationObject);}else if(source.clone){return source.clone();}return null;};function GetAllPropertyNames(obj){var props=[];do{Object.getOwnPropertyNames(obj).forEach(function(prop){if(props.indexOf(prop)===-1){props.push(prop);}});}while(obj=Object.getPrototypeOf(obj));return props;}var DeepCopier=/*#__PURE__*/function(){function DeepCopier(){_classCallCheck(this,DeepCopier);}_createClass(DeepCopier,null,[{key:"DeepCopy",value:function DeepCopy(source,destination,doNotCopyList,mustCopyList){var properties=GetAllPropertyNames(source);var _iterator4=_createForOfIteratorHelper(properties),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var prop=_step4.value;if(prop[0]==="_"&&(!mustCopyList||mustCopyList.indexOf(prop)===-1)){continue;}if(prop.endsWith("Observable")){continue;}if(doNotCopyList&&doNotCopyList.indexOf(prop)!==-1){continue;}var sourceValue=source[prop];var typeOfSourceValue=_typeof(sourceValue);if(typeOfSourceValue==="function"){continue;}try{if(typeOfSourceValue==="object"){if(sourceValue instanceof Array){destination[prop]=[];if(sourceValue.length>0){if(_typeof(sourceValue[0])=="object"){for(var index=0;index<sourceValue.length;index++){var clonedValue=CloneValue(sourceValue[index],destination);if(destination[prop].indexOf(clonedValue)===-1){destination[prop].push(clonedValue);}}}else{destination[prop]=sourceValue.slice(0);}}}else{destination[prop]=CloneValue(sourceValue,destination);}}else{destination[prop]=sourceValue;}}catch(e){Logger.Warn(e.message);}}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}}]);return DeepCopier;}();// node_modules/@babylonjs/core/Misc/precisionDate.js
var PrecisionDate=/*#__PURE__*/function(){function PrecisionDate(){_classCallCheck(this,PrecisionDate);}_createClass(PrecisionDate,null,[{key:"Now",get:function get(){if(DomManagement.IsWindowObjectExist()&&window.performance&&window.performance.now){return window.performance.now();}return Date.now();}}]);return PrecisionDate;}();// node_modules/@babylonjs/core/Misc/devTools.js
function _WarnImport(name135){return"".concat(name135," needs to be imported before as it contains a side-effect required by your code.");}// node_modules/@babylonjs/core/Misc/webRequest.js
function createXMLHttpRequest(){if(typeof _native!=="undefined"&&_native.XMLHttpRequest){return new _native.XMLHttpRequest();}else{return new XMLHttpRequest();}}var WebRequest=/*#__PURE__*/function(){function WebRequest(){_classCallCheck(this,WebRequest);this._xhr=createXMLHttpRequest();this._requestURL="";}_createClass(WebRequest,[{key:"_injectCustomRequestHeaders",value:function _injectCustomRequestHeaders(){if(this._shouldSkipRequestModifications(this._requestURL)){return;}for(var key in WebRequest.CustomRequestHeaders){var val=WebRequest.CustomRequestHeaders[key];if(val){this._xhr.setRequestHeader(key,val);}}}},{key:"_shouldSkipRequestModifications",value:function _shouldSkipRequestModifications(url){return WebRequest.SkipRequestModificationForBabylonCDN&&(url.includes("preview.babylonjs.com")||url.includes("cdn.babylonjs.com"));}},{key:"onprogress",get:function get(){return this._xhr.onprogress;},set:function set(value){this._xhr.onprogress=value;}},{key:"readyState",get:function get(){return this._xhr.readyState;}},{key:"status",get:function get(){return this._xhr.status;}},{key:"statusText",get:function get(){return this._xhr.statusText;}},{key:"response",get:function get(){return this._xhr.response;}},{key:"responseURL",get:function get(){return this._xhr.responseURL;}},{key:"responseText",get:function get(){return this._xhr.responseText;}},{key:"responseType",get:function get(){return this._xhr.responseType;},set:function set(value){this._xhr.responseType=value;}},{key:"timeout",get:function get(){return this._xhr.timeout;},set:function set(value){this._xhr.timeout=value;}},{key:"addEventListener",value:function addEventListener(type,listener,options){this._xhr.addEventListener(type,listener,options);}},{key:"removeEventListener",value:function removeEventListener(type,listener,options){this._xhr.removeEventListener(type,listener,options);}},{key:"abort",value:function abort(){this._xhr.abort();}},{key:"send",value:function send(body){if(WebRequest.CustomRequestHeaders){this._injectCustomRequestHeaders();}this._xhr.send(body);}},{key:"open",value:function open(method,url){var _iterator5=_createForOfIteratorHelper(WebRequest.CustomRequestModifiers),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var update=_step5.value;if(this._shouldSkipRequestModifications(url)){return;}update(this._xhr,url);}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}url=url.replace("file:http:","http:");url=url.replace("file:https:","https:");this._requestURL=url;return this._xhr.open(method,url,true);}},{key:"setRequestHeader",value:function setRequestHeader(name135,value){this._xhr.setRequestHeader(name135,value);}},{key:"getResponseHeader",value:function getResponseHeader(name135){return this._xhr.getResponseHeader(name135);}}]);return WebRequest;}();WebRequest.CustomRequestHeaders={};WebRequest.CustomRequestModifiers=new Array();WebRequest.SkipRequestModificationForBabylonCDN=true;// node_modules/@babylonjs/core/Engines/engineStore.js
var EngineStore=/*#__PURE__*/function(){function EngineStore(){_classCallCheck(this,EngineStore);}_createClass(EngineStore,null,[{key:"LastCreatedEngine",get:function get(){if(this.Instances.length===0){return null;}return this.Instances[this.Instances.length-1];}},{key:"LastCreatedScene",get:function get(){return this._LastCreatedScene;}}]);return EngineStore;}();EngineStore.Instances=new Array();EngineStore._LastCreatedScene=null;EngineStore.UseFallbackTexture=true;EngineStore.FallbackTexture="";// node_modules/@babylonjs/core/Misc/filesInputStore.js
var FilesInputStore=/*#__PURE__*/_createClass(function FilesInputStore(){_classCallCheck(this,FilesInputStore);});FilesInputStore.FilesToLoad={};// node_modules/@babylonjs/core/Misc/retryStrategy.js
var RetryStrategy=/*#__PURE__*/function(){function RetryStrategy(){_classCallCheck(this,RetryStrategy);}_createClass(RetryStrategy,null,[{key:"ExponentialBackoff",value:function ExponentialBackoff(){var maxRetries=arguments.length>0&&arguments[0]!==undefined?arguments[0]:3;var baseInterval=arguments.length>1&&arguments[1]!==undefined?arguments[1]:500;return function(url,request,retryIndex){if(request.status!==0||retryIndex>=maxRetries||url.indexOf("file:")!==-1){return-1;}return Math.pow(2,retryIndex)*baseInterval;};}}]);return RetryStrategy;}();// node_modules/@babylonjs/core/Misc/error.js
var BaseError=/*#__PURE__*/function(_Error){_inherits(BaseError,_Error);var _super=_createSuper(BaseError);function BaseError(){_classCallCheck(this,BaseError);return _super.apply(this,arguments);}return _createClass(BaseError);}(/*#__PURE__*/_wrapNativeSuper(Error));BaseError._setPrototypeOf=Object.setPrototypeOf||function(o,proto){o.__proto__=proto;return o;};var ErrorCodes={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};var RuntimeError=/*#__PURE__*/function(_BaseError){_inherits(RuntimeError,_BaseError);var _super2=_createSuper(RuntimeError);function RuntimeError(message,errorCode,innerError){var _this5;_classCallCheck(this,RuntimeError);_this5=_super2.call(this,message);_this5.errorCode=errorCode;_this5.innerError=innerError;_this5.name="RuntimeError";BaseError._setPrototypeOf(_assertThisInitialized(_this5),RuntimeError.prototype);return _this5;}return _createClass(RuntimeError);}(BaseError);// node_modules/@babylonjs/core/Misc/stringTools.js
var Decode=function Decode(buffer){if(typeof TextDecoder!=="undefined"){return new TextDecoder().decode(buffer);}var result="";for(var i=0;i<buffer.byteLength;i++){result+=String.fromCharCode(buffer[i]);}return result;};var EncodeArrayBufferToBase64=function EncodeArrayBufferToBase64(buffer){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;var bytes=ArrayBuffer.isView(buffer)?new Uint8Array(buffer.buffer,buffer.byteOffset,buffer.byteLength):new Uint8Array(buffer);while(i<bytes.length){chr1=bytes[i++];chr2=i<bytes.length?bytes[i++]:Number.NaN;chr3=i<bytes.length?bytes[i++]:Number.NaN;enc1=chr1>>2;enc2=(chr1&3)<<4|chr2>>4;enc3=(chr2&15)<<2|chr3>>6;enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}output+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);}return output;};var DecodeBase64ToString=function DecodeBase64ToString(base64Data){return atob(base64Data);};var DecodeBase64ToBinary=function DecodeBase64ToBinary(base64Data){var decodedString=DecodeBase64ToString(base64Data);var bufferLength=decodedString.length;var bufferView=new Uint8Array(new ArrayBuffer(bufferLength));for(var i=0;i<bufferLength;i++){bufferView[i]=decodedString.charCodeAt(i);}return bufferView.buffer;};// node_modules/@babylonjs/core/Engines/Processors/shaderCodeNode.js
var defaultAttributeKeywordName="attribute";var defaultVaryingKeywordName="varying";var ShaderCodeNode=/*#__PURE__*/function(){function ShaderCodeNode(){_classCallCheck(this,ShaderCodeNode);this.children=[];}_createClass(ShaderCodeNode,[{key:"isValid",value:function isValid(preprocessors){return true;}},{key:"process",value:function process(preprocessors,options){var _a,_b,_c,_d,_e,_f;var result="";if(this.line){var value=this.line;var processor=options.processor;if(processor){if(processor.lineProcessor){value=processor.lineProcessor(value,options.isFragment,options.processingContext);}var attributeKeyword=(_b=(_a=options.processor)===null||_a===void 0?void 0:_a.attributeKeywordName)!==null&&_b!==void 0?_b:defaultAttributeKeywordName;var varyingKeyword=options.isFragment&&((_c=options.processor)===null||_c===void 0?void 0:_c.varyingFragmentKeywordName)?(_d=options.processor)===null||_d===void 0?void 0:_d.varyingFragmentKeywordName:!options.isFragment&&((_e=options.processor)===null||_e===void 0?void 0:_e.varyingVertexKeywordName)?(_f=options.processor)===null||_f===void 0?void 0:_f.varyingVertexKeywordName:defaultVaryingKeywordName;if(!options.isFragment&&processor.attributeProcessor&&this.line.startsWith(attributeKeyword)){value=processor.attributeProcessor(this.line,preprocessors,options.processingContext);}else if(processor.varyingProcessor&&this.line.startsWith(varyingKeyword)){value=processor.varyingProcessor(this.line,options.isFragment,preprocessors,options.processingContext);}else if(processor.uniformProcessor&&processor.uniformRegexp&&processor.uniformRegexp.test(this.line)){if(!options.lookForClosingBracketForUniformBuffer){value=processor.uniformProcessor(this.line,options.isFragment,preprocessors,options.processingContext);}}else if(processor.uniformBufferProcessor&&processor.uniformBufferRegexp&&processor.uniformBufferRegexp.test(this.line)){if(!options.lookForClosingBracketForUniformBuffer){value=processor.uniformBufferProcessor(this.line,options.isFragment,options.processingContext);options.lookForClosingBracketForUniformBuffer=true;}}else if(processor.textureProcessor&&processor.textureRegexp&&processor.textureRegexp.test(this.line)){value=processor.textureProcessor(this.line,options.isFragment,preprocessors,options.processingContext);}else if((processor.uniformProcessor||processor.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!options.lookForClosingBracketForUniformBuffer){var regex=/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/;if(regex.test(this.line)){if(processor.uniformProcessor){value=processor.uniformProcessor(this.line,options.isFragment,preprocessors,options.processingContext);}}else{if(processor.uniformBufferProcessor){value=processor.uniformBufferProcessor(this.line,options.isFragment,options.processingContext);options.lookForClosingBracketForUniformBuffer=true;}}}if(options.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1){options.lookForClosingBracketForUniformBuffer=false;if(processor.endOfUniformBufferProcessor){value=processor.endOfUniformBufferProcessor(this.line,options.isFragment,options.processingContext);}}}result+=value+"\r\n";}this.children.forEach(function(child){result+=child.process(preprocessors,options);});if(this.additionalDefineKey){preprocessors[this.additionalDefineKey]=this.additionalDefineValue||"true";}return result;}}]);return ShaderCodeNode;}();// node_modules/@babylonjs/core/Engines/Processors/shaderCodeCursor.js
var ShaderCodeCursor=/*#__PURE__*/function(){function ShaderCodeCursor(){_classCallCheck(this,ShaderCodeCursor);this._lines=[];}_createClass(ShaderCodeCursor,[{key:"currentLine",get:function get(){return this._lines[this.lineIndex];}},{key:"canRead",get:function get(){return this.lineIndex<this._lines.length-1;}},{key:"lines",set:function set(value){this._lines.length=0;var _iterator6=_createForOfIteratorHelper(value),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var line=_step6.value;if(line[0]==="#"){this._lines.push(line);continue;}if(line.trim().startsWith("//")){this._lines.push(line);continue;}var split=line.split(";");for(var index=0;index<split.length;index++){var subLine=split[index];subLine=subLine.trim();if(!subLine){continue;}this._lines.push(subLine+(index!==split.length-1?";":""));}}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}}}]);return ShaderCodeCursor;}();// node_modules/@babylonjs/core/Engines/Processors/shaderCodeConditionNode.js
var ShaderCodeConditionNode=/*#__PURE__*/function(_ShaderCodeNode){_inherits(ShaderCodeConditionNode,_ShaderCodeNode);var _super3=_createSuper(ShaderCodeConditionNode);function ShaderCodeConditionNode(){_classCallCheck(this,ShaderCodeConditionNode);return _super3.apply(this,arguments);}_createClass(ShaderCodeConditionNode,[{key:"process",value:function process(preprocessors,options){for(var index=0;index<this.children.length;index++){var node=this.children[index];if(node.isValid(preprocessors)){return node.process(preprocessors,options);}}return"";}}]);return ShaderCodeConditionNode;}(ShaderCodeNode);// node_modules/@babylonjs/core/Engines/Processors/shaderCodeTestNode.js
var ShaderCodeTestNode=/*#__PURE__*/function(_ShaderCodeNode2){_inherits(ShaderCodeTestNode,_ShaderCodeNode2);var _super4=_createSuper(ShaderCodeTestNode);function ShaderCodeTestNode(){_classCallCheck(this,ShaderCodeTestNode);return _super4.apply(this,arguments);}_createClass(ShaderCodeTestNode,[{key:"isValid",value:function isValid(preprocessors){return this.testExpression.isTrue(preprocessors);}}]);return ShaderCodeTestNode;}(ShaderCodeNode);// node_modules/@babylonjs/core/Engines/Processors/Expressions/shaderDefineExpression.js
var ShaderDefineExpression=/*#__PURE__*/function(){function ShaderDefineExpression(){_classCallCheck(this,ShaderDefineExpression);}_createClass(ShaderDefineExpression,[{key:"isTrue",value:function isTrue(preprocessors){return true;}}],[{key:"postfixToInfix",value:function postfixToInfix(postfix){var stack=[];var _iterator7=_createForOfIteratorHelper(postfix),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var c=_step7.value;if(ShaderDefineExpression._OperatorPriority[c]===void 0){stack.push(c);}else{var v1=stack[stack.length-1],v2=stack[stack.length-2];stack.length-=2;stack.push("(".concat(v2).concat(c).concat(v1,")"));}}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}return stack[stack.length-1];}},{key:"infixToPostfix",value:function infixToPostfix(infix){var result=[];var stackIdx=-1;var pushOperand=function pushOperand(){operand=operand.trim();if(operand!==""){result.push(operand);operand="";}};var push=function push(s){if(stackIdx<ShaderDefineExpression._Stack.length-1){ShaderDefineExpression._Stack[++stackIdx]=s;}};var peek=function peek(){return ShaderDefineExpression._Stack[stackIdx];};var pop=function pop(){return stackIdx===-1?"!!INVALID EXPRESSION!!":ShaderDefineExpression._Stack[stackIdx--];};var idx=0,operand="";while(idx<infix.length){var c=infix.charAt(idx),token=idx<infix.length-1?infix.substr(idx,2):"";if(c==="("){operand="";push(c);}else if(c===")"){pushOperand();while(stackIdx!==-1&&peek()!=="("){result.push(pop());}pop();}else if(ShaderDefineExpression._OperatorPriority[token]>1){pushOperand();while(stackIdx!==-1&&ShaderDefineExpression._OperatorPriority[peek()]>=ShaderDefineExpression._OperatorPriority[token]){result.push(pop());}push(token);idx++;}else{operand+=c;}idx++;}pushOperand();while(stackIdx!==-1){if(peek()==="("){pop();}else{result.push(pop());}}return result;}}]);return ShaderDefineExpression;}();ShaderDefineExpression._OperatorPriority={")":0,"(":1,"||":2,"&&":3};ShaderDefineExpression._Stack=["","","","","","","","","","","","","","","","","","","",""];// node_modules/@babylonjs/core/Engines/Processors/Expressions/Operators/shaderDefineIsDefinedOperator.js
var ShaderDefineIsDefinedOperator=/*#__PURE__*/function(_ShaderDefineExpressi){_inherits(ShaderDefineIsDefinedOperator,_ShaderDefineExpressi);var _super5=_createSuper(ShaderDefineIsDefinedOperator);function ShaderDefineIsDefinedOperator(define){var _this6;var not=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_classCallCheck(this,ShaderDefineIsDefinedOperator);_this6=_super5.call(this);_this6.define=define;_this6.not=not;return _this6;}_createClass(ShaderDefineIsDefinedOperator,[{key:"isTrue",value:function isTrue(preprocessors){var condition=preprocessors[this.define]!==void 0;if(this.not){condition=!condition;}return condition;}}]);return ShaderDefineIsDefinedOperator;}(ShaderDefineExpression);// node_modules/@babylonjs/core/Engines/Processors/Expressions/Operators/shaderDefineOrOperator.js
var ShaderDefineOrOperator=/*#__PURE__*/function(_ShaderDefineExpressi2){_inherits(ShaderDefineOrOperator,_ShaderDefineExpressi2);var _super6=_createSuper(ShaderDefineOrOperator);function ShaderDefineOrOperator(){_classCallCheck(this,ShaderDefineOrOperator);return _super6.apply(this,arguments);}_createClass(ShaderDefineOrOperator,[{key:"isTrue",value:function isTrue(preprocessors){return this.leftOperand.isTrue(preprocessors)||this.rightOperand.isTrue(preprocessors);}}]);return ShaderDefineOrOperator;}(ShaderDefineExpression);// node_modules/@babylonjs/core/Engines/Processors/Expressions/Operators/shaderDefineAndOperator.js
var ShaderDefineAndOperator=/*#__PURE__*/function(_ShaderDefineExpressi3){_inherits(ShaderDefineAndOperator,_ShaderDefineExpressi3);var _super7=_createSuper(ShaderDefineAndOperator);function ShaderDefineAndOperator(){_classCallCheck(this,ShaderDefineAndOperator);return _super7.apply(this,arguments);}_createClass(ShaderDefineAndOperator,[{key:"isTrue",value:function isTrue(preprocessors){return this.leftOperand.isTrue(preprocessors)&&this.rightOperand.isTrue(preprocessors);}}]);return ShaderDefineAndOperator;}(ShaderDefineExpression);// node_modules/@babylonjs/core/Engines/Processors/Expressions/Operators/shaderDefineArithmeticOperator.js
var ShaderDefineArithmeticOperator=/*#__PURE__*/function(_ShaderDefineExpressi4){_inherits(ShaderDefineArithmeticOperator,_ShaderDefineExpressi4);var _super8=_createSuper(ShaderDefineArithmeticOperator);function ShaderDefineArithmeticOperator(define,operand,testValue){var _this7;_classCallCheck(this,ShaderDefineArithmeticOperator);_this7=_super8.call(this);_this7.define=define;_this7.operand=operand;_this7.testValue=testValue;return _this7;}_createClass(ShaderDefineArithmeticOperator,[{key:"isTrue",value:function isTrue(preprocessors){var value=preprocessors[this.define];if(value===void 0){value=this.define;}var condition=false;var left=parseInt(value);var right=parseInt(this.testValue);switch(this.operand){case">":condition=left>right;break;case"<":condition=left<right;break;case"<=":condition=left<=right;break;case">=":condition=left>=right;break;case"==":condition=left===right;break;}return condition;}}]);return ShaderDefineArithmeticOperator;}(ShaderDefineExpression);// node_modules/@babylonjs/core/Materials/shaderLanguage.js
var ShaderLanguage;(function(ShaderLanguage2){ShaderLanguage2[ShaderLanguage2["GLSL"]=0]="GLSL";ShaderLanguage2[ShaderLanguage2["WGSL"]=1]="WGSL";})(ShaderLanguage||(ShaderLanguage={}));// node_modules/@babylonjs/core/Engines/Processors/shaderProcessor.js
var regexSE=/defined\s*?\((.+?)\)/g;var regexSERevert=/defined\s*?\[(.+?)\]/g;var regexShaderInclude=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g;var ShaderProcessor=/*#__PURE__*/function(){function ShaderProcessor(){_classCallCheck(this,ShaderProcessor);}_createClass(ShaderProcessor,null,[{key:"Initialize",value:function Initialize(options){if(options.processor&&options.processor.initializeShaders){options.processor.initializeShaders(options.processingContext);}}},{key:"Process",value:function Process(sourceCode,options,callback,engine){var _this8=this;var _a;if((_a=options.processor)===null||_a===void 0?void 0:_a.preProcessShaderCode){sourceCode=options.processor.preProcessShaderCode(sourceCode,options.isFragment);}this._ProcessIncludes(sourceCode,options,function(codeWithIncludes){if(options.processCodeAfterIncludes){codeWithIncludes=options.processCodeAfterIncludes(options.isFragment?"fragment":"vertex",codeWithIncludes);}var migratedCode=_this8._ProcessShaderConversion(codeWithIncludes,options,engine);callback(migratedCode,codeWithIncludes);});}},{key:"PreProcess",value:function PreProcess(sourceCode,options,callback,engine){var _this9=this;var _a;if((_a=options.processor)===null||_a===void 0?void 0:_a.preProcessShaderCode){sourceCode=options.processor.preProcessShaderCode(sourceCode,options.isFragment);}this._ProcessIncludes(sourceCode,options,function(codeWithIncludes){if(options.processCodeAfterIncludes){codeWithIncludes=options.processCodeAfterIncludes(options.isFragment?"fragment":"vertex",codeWithIncludes);}var migratedCode=_this9._ApplyPreProcessing(codeWithIncludes,options,engine);callback(migratedCode,codeWithIncludes);});}},{key:"Finalize",value:function Finalize(vertexCode,fragmentCode,options){if(!options.processor||!options.processor.finalizeShaders){return{vertexCode:vertexCode,fragmentCode:fragmentCode};}return options.processor.finalizeShaders(vertexCode,fragmentCode,options.processingContext);}},{key:"_ProcessPrecision",value:function _ProcessPrecision(source,options){var _a;if((_a=options.processor)===null||_a===void 0?void 0:_a.noPrecision){return source;}var shouldUseHighPrecisionShader=options.shouldUseHighPrecisionShader;if(source.indexOf("precision highp float")===-1){if(!shouldUseHighPrecisionShader){source="precision mediump float;\n"+source;}else{source="precision highp float;\n"+source;}}else{if(!shouldUseHighPrecisionShader){source=source.replace("precision highp float","precision mediump float");}}return source;}},{key:"_ExtractOperation",value:function _ExtractOperation(expression){var regex=/defined\((.+)\)/;var match=regex.exec(expression);if(match&&match.length){return new ShaderDefineIsDefinedOperator(match[1].trim(),expression[0]==="!");}var operators=["==",">=","<=","<",">"];var operator="";var indexOperator=0;for(var _i2=0,_operators=operators;_i2<_operators.length;_i2++){operator=_operators[_i2];indexOperator=expression.indexOf(operator);if(indexOperator>-1){break;}}if(indexOperator===-1){return new ShaderDefineIsDefinedOperator(expression);}var define=expression.substring(0,indexOperator).trim();var value=expression.substring(indexOperator+operator.length).trim();return new ShaderDefineArithmeticOperator(define,operator,value);}},{key:"_BuildSubExpression",value:function _BuildSubExpression(expression){expression=expression.replace(regexSE,"defined[$1]");var postfix=ShaderDefineExpression.infixToPostfix(expression);var stack=[];var _iterator8=_createForOfIteratorHelper(postfix),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var c=_step8.value;if(c!=="||"&&c!=="&&"){stack.push(c);}else if(stack.length>=2){var v1=stack[stack.length-1],v2=stack[stack.length-2];stack.length-=2;var operator=c=="&&"?new ShaderDefineAndOperator():new ShaderDefineOrOperator();if(typeof v1==="string"){v1=v1.replace(regexSERevert,"defined($1)");}if(typeof v2==="string"){v2=v2.replace(regexSERevert,"defined($1)");}operator.leftOperand=typeof v2==="string"?this._ExtractOperation(v2):v2;operator.rightOperand=typeof v1==="string"?this._ExtractOperation(v1):v1;stack.push(operator);}}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}var result=stack[stack.length-1];if(typeof result==="string"){result=result.replace(regexSERevert,"defined($1)");}return typeof result==="string"?this._ExtractOperation(result):result;}},{key:"_BuildExpression",value:function _BuildExpression(line,start){var node=new ShaderCodeTestNode();var command=line.substring(0,start);var expression=line.substring(start);expression=expression.substring(0,(expression.indexOf("//")+1||expression.length+1)-1).trim();if(command==="#ifdef"){node.testExpression=new ShaderDefineIsDefinedOperator(expression);}else if(command==="#ifndef"){node.testExpression=new ShaderDefineIsDefinedOperator(expression,true);}else{node.testExpression=this._BuildSubExpression(expression);}return node;}},{key:"_MoveCursorWithinIf",value:function _MoveCursorWithinIf(cursor,rootNode,ifNode){var line=cursor.currentLine;while(this._MoveCursor(cursor,ifNode)){line=cursor.currentLine;var first5=line.substring(0,5).toLowerCase();if(first5==="#else"){var elseNode=new ShaderCodeNode();rootNode.children.push(elseNode);this._MoveCursor(cursor,elseNode);return;}else if(first5==="#elif"){var elifNode=this._BuildExpression(line,5);rootNode.children.push(elifNode);ifNode=elifNode;}}}},{key:"_MoveCursor",value:function _MoveCursor(cursor,rootNode){while(cursor.canRead){cursor.lineIndex++;var line=cursor.currentLine;var keywords=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;var matches=keywords.exec(line);if(matches&&matches.length){var keyword=matches[0];switch(keyword){case"#ifdef":{var newRootNode=new ShaderCodeConditionNode();rootNode.children.push(newRootNode);var ifNode=this._BuildExpression(line,6);newRootNode.children.push(ifNode);this._MoveCursorWithinIf(cursor,newRootNode,ifNode);break;}case"#else":case"#elif":return true;case"#endif":return false;case"#ifndef":{var _newRootNode=new ShaderCodeConditionNode();rootNode.children.push(_newRootNode);var _ifNode=this._BuildExpression(line,7);_newRootNode.children.push(_ifNode);this._MoveCursorWithinIf(cursor,_newRootNode,_ifNode);break;}case"#if":{var _newRootNode2=new ShaderCodeConditionNode();var _ifNode2=this._BuildExpression(line,3);rootNode.children.push(_newRootNode2);_newRootNode2.children.push(_ifNode2);this._MoveCursorWithinIf(cursor,_newRootNode2,_ifNode2);break;}}}else{var newNode=new ShaderCodeNode();newNode.line=line;rootNode.children.push(newNode);if(line[0]==="#"&&line[1]==="d"){var split=line.replace(";","").split(" ");newNode.additionalDefineKey=split[1];if(split.length===3){newNode.additionalDefineValue=split[2];}}}}return false;}},{key:"_EvaluatePreProcessors",value:function _EvaluatePreProcessors(sourceCode,preprocessors,options){var rootNode=new ShaderCodeNode();var cursor=new ShaderCodeCursor();cursor.lineIndex=-1;cursor.lines=sourceCode.split("\n");this._MoveCursor(cursor,rootNode);return rootNode.process(preprocessors,options);}},{key:"_PreparePreProcessors",value:function _PreparePreProcessors(options,engine){var _a;var defines=options.defines;var preprocessors={};var _iterator9=_createForOfIteratorHelper(defines),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var define=_step9.value;var keyValue=define.replace("#define","").replace(";","").trim();var split=keyValue.split(" ");preprocessors[split[0]]=split.length>1?split[1]:"";}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}if(((_a=options.processor)===null||_a===void 0?void 0:_a.shaderLanguage)===ShaderLanguage.GLSL){preprocessors["GL_ES"]="true";}preprocessors["__VERSION__"]=options.version;preprocessors[options.platformName]="true";engine._getGlobalDefines(preprocessors);return preprocessors;}},{key:"_ProcessShaderConversion",value:function _ProcessShaderConversion(sourceCode,options,engine){var preparedSourceCode=this._ProcessPrecision(sourceCode,options);if(!options.processor){return preparedSourceCode;}if(options.processor.shaderLanguage===ShaderLanguage.GLSL&&preparedSourceCode.indexOf("#version 3")!==-1){preparedSourceCode=preparedSourceCode.replace("#version 300 es","");if(!options.processor.parseGLES3){return preparedSourceCode;}}var defines=options.defines;var preprocessors=this._PreparePreProcessors(options,engine);if(options.processor.preProcessor){preparedSourceCode=options.processor.preProcessor(preparedSourceCode,defines,options.isFragment,options.processingContext);}preparedSourceCode=this._EvaluatePreProcessors(preparedSourceCode,preprocessors,options);if(options.processor.postProcessor){preparedSourceCode=options.processor.postProcessor(preparedSourceCode,defines,options.isFragment,options.processingContext,engine);}if(engine._features.needShaderCodeInlining){preparedSourceCode=engine.inlineShaderCode(preparedSourceCode);}return preparedSourceCode;}},{key:"_ApplyPreProcessing",value:function _ApplyPreProcessing(sourceCode,options,engine){var _a,_b;var preparedSourceCode=sourceCode;var defines=options.defines;var preprocessors=this._PreparePreProcessors(options,engine);if((_a=options.processor)===null||_a===void 0?void 0:_a.preProcessor){preparedSourceCode=options.processor.preProcessor(preparedSourceCode,defines,options.isFragment,options.processingContext);}preparedSourceCode=this._EvaluatePreProcessors(preparedSourceCode,preprocessors,options);if((_b=options.processor)===null||_b===void 0?void 0:_b.postProcessor){preparedSourceCode=options.processor.postProcessor(preparedSourceCode,defines,options.isFragment,options.processingContext,engine);}if(engine._features.needShaderCodeInlining){preparedSourceCode=engine.inlineShaderCode(preparedSourceCode);}return preparedSourceCode;}},{key:"_ProcessIncludes",value:function _ProcessIncludes(sourceCode,options,callback){var _this10=this;var match=regexShaderInclude.exec(sourceCode);var returnValue=new String(sourceCode);var keepProcessing=false;var _loop2=function _loop2(){var includeFile=match[1];if(includeFile.indexOf("__decl__")!==-1){includeFile=includeFile.replace(/__decl__/,"");if(options.supportsUniformBuffers){includeFile=includeFile.replace(/Vertex/,"Ubo");includeFile=includeFile.replace(/Fragment/,"Ubo");}includeFile=includeFile+"Declaration";}if(options.includesShadersStore[includeFile]){var includeContent=options.includesShadersStore[includeFile];if(match[2]){var splits=match[3].split(",");for(var index=0;index<splits.length;index+=2){var source=new RegExp(splits[index],"g");var dest=splits[index+1];includeContent=includeContent.replace(source,dest);}}if(match[4]){var indexString=match[5];if(indexString.indexOf("..")!==-1){var indexSplits=indexString.split("..");var minIndex=parseInt(indexSplits[0]);var maxIndex=parseInt(indexSplits[1]);var sourceIncludeContent=includeContent.slice(0);includeContent="";if(isNaN(maxIndex)){maxIndex=options.indexParameters[indexSplits[1]];}for(var i=minIndex;i<maxIndex;i++){if(!options.supportsUniformBuffers){sourceIncludeContent=sourceIncludeContent.replace(/light\{X\}.(\w*)/g,function(str,p1){return p1+"{X}";});}includeContent+=sourceIncludeContent.replace(/\{X\}/g,i.toString())+"\n";}}else{if(!options.supportsUniformBuffers){includeContent=includeContent.replace(/light\{X\}.(\w*)/g,function(str,p1){return p1+"{X}";});}includeContent=includeContent.replace(/\{X\}/g,indexString);}}returnValue=returnValue.replace(match[0],includeContent);keepProcessing=keepProcessing||includeContent.indexOf("#include<")>=0||includeContent.indexOf("#include <")>=0;}else{var includeShaderUrl=options.shadersRepository+"ShadersInclude/"+includeFile+".fx";ShaderProcessor._FileToolsLoadFile(includeShaderUrl,function(fileContent){options.includesShadersStore[includeFile]=fileContent;_this10._ProcessIncludes(returnValue,options,callback);});return{v:void 0};}match=regexShaderInclude.exec(sourceCode);},_ret;while(match!=null){_ret=_loop2();if(_ret)return _ret.v;}if(keepProcessing){this._ProcessIncludes(returnValue.toString(),options,callback);}else{callback(returnValue);}}},{key:"_FileToolsLoadFile",value:function _FileToolsLoadFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError){throw _WarnImport("FileTools");}}]);return ShaderProcessor;}();// node_modules/@babylonjs/core/Engines/shaderStore.js
var ShaderStore=/*#__PURE__*/function(){function ShaderStore(){_classCallCheck(this,ShaderStore);}_createClass(ShaderStore,null,[{key:"GetShadersRepository",value:function GetShadersRepository(){var shaderLanguage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:ShaderLanguage.GLSL;return shaderLanguage===ShaderLanguage.GLSL?ShaderStore.ShadersRepository:ShaderStore.ShadersRepositoryWGSL;}},{key:"GetShadersStore",value:function GetShadersStore(){var shaderLanguage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:ShaderLanguage.GLSL;return shaderLanguage===ShaderLanguage.GLSL?ShaderStore.ShadersStore:ShaderStore.ShadersStoreWGSL;}},{key:"GetIncludesShadersStore",value:function GetIncludesShadersStore(){var shaderLanguage=arguments.length>0&&arguments[0]!==undefined?arguments[0]:ShaderLanguage.GLSL;return shaderLanguage===ShaderLanguage.GLSL?ShaderStore.IncludesShadersStore:ShaderStore.IncludesShadersStoreWGSL;}}]);return ShaderStore;}();ShaderStore.ShadersRepository="src/Shaders/";ShaderStore.ShadersStore={};ShaderStore.IncludesShadersStore={};ShaderStore.ShadersRepositoryWGSL="src/ShadersWGSL/";ShaderStore.ShadersStoreWGSL={};ShaderStore.IncludesShadersStoreWGSL={};// node_modules/@babylonjs/core/Materials/effect.js
var Effect=/*#__PURE__*/function(){function Effect(baseName,attributesNamesOrOptions,uniformsNamesOrEngine){var _this11=this;var samplers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var engine=arguments.length>4?arguments[4]:undefined;var defines=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var fallbacks=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var onCompiled=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var onError=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var indexParameters=arguments.length>9?arguments[9]:undefined;var key=arguments.length>10&&arguments[10]!==undefined?arguments[10]:"";var shaderLanguage=arguments.length>11&&arguments[11]!==undefined?arguments[11]:ShaderLanguage.GLSL;_classCallCheck(this,Effect);var _a,_b,_c;this.name=null;this.defines="";this.onCompiled=null;this.onError=null;this.onBind=null;this.uniqueId=0;this.onCompileObservable=new Observable();this.onErrorObservable=new Observable();this._onBindObservable=null;this._wasPreviouslyReady=false;this._forceRebindOnNextCall=false;this._wasPreviouslyUsingInstances=null;this._isDisposed=false;this._bonesComputationForcedToCPU=false;this._uniformBuffersNames={};this._multiTarget=false;this._samplers={};this._isReady=false;this._compilationError="";this._allFallbacksProcessed=false;this._uniforms={};this._key="";this._fallbacks=null;this._vertexSourceCodeOverride="";this._fragmentSourceCodeOverride="";this._transformFeedbackVaryings=null;this._pipelineContext=null;this._vertexSourceCode="";this._fragmentSourceCode="";this._vertexSourceCodeBeforeMigration="";this._fragmentSourceCodeBeforeMigration="";this._rawVertexSourceCode="";this._rawFragmentSourceCode="";this.name=baseName;this._key=key;var processCodeAfterIncludes=void 0;var processFinalCode=null;if(attributesNamesOrOptions.attributes){var options=attributesNamesOrOptions;this._engine=uniformsNamesOrEngine;this._attributesNames=options.attributes;this._uniformsNames=options.uniformsNames.concat(options.samplers);this._samplerList=options.samplers.slice();this.defines=options.defines;this.onError=options.onError;this.onCompiled=options.onCompiled;this._fallbacks=options.fallbacks;this._indexParameters=options.indexParameters;this._transformFeedbackVaryings=options.transformFeedbackVaryings||null;this._multiTarget=!!options.multiTarget;this._shaderLanguage=(_a=options.shaderLanguage)!==null&&_a!==void 0?_a:ShaderLanguage.GLSL;if(options.uniformBuffersNames){this._uniformBuffersNamesList=options.uniformBuffersNames.slice();for(var i=0;i<options.uniformBuffersNames.length;i++){this._uniformBuffersNames[options.uniformBuffersNames[i]]=i;}}processFinalCode=(_b=options.processFinalCode)!==null&&_b!==void 0?_b:null;processCodeAfterIncludes=(_c=options.processCodeAfterIncludes)!==null&&_c!==void 0?_c:void 0;}else{this._engine=engine;this.defines=defines==null?"":defines;this._uniformsNames=uniformsNamesOrEngine.concat(samplers);this._samplerList=samplers?samplers.slice():[];this._attributesNames=attributesNamesOrOptions;this._uniformBuffersNamesList=[];this._shaderLanguage=shaderLanguage;this.onError=onError;this.onCompiled=onCompiled;this._indexParameters=indexParameters;this._fallbacks=fallbacks;}this._attributeLocationByName={};this.uniqueId=Effect._UniqueIdSeed++;var vertexSource;var fragmentSource;var hostDocument=IsWindowObjectExist()?this._engine.getHostDocument():null;if(baseName.vertexSource){vertexSource="source:"+baseName.vertexSource;}else if(baseName.vertexElement){vertexSource=hostDocument?hostDocument.getElementById(baseName.vertexElement):null;if(!vertexSource){vertexSource=baseName.vertexElement;}}else{vertexSource=baseName.vertex||baseName;}if(baseName.fragmentSource){fragmentSource="source:"+baseName.fragmentSource;}else if(baseName.fragmentElement){fragmentSource=hostDocument?hostDocument.getElementById(baseName.fragmentElement):null;if(!fragmentSource){fragmentSource=baseName.fragmentElement;}}else{fragmentSource=baseName.fragment||baseName;}this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var processorOptions={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:false,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ShaderStore.GetShadersRepository(this._shaderLanguage),includesShadersStore:ShaderStore.GetIncludesShadersStore(this._shaderLanguage),version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:processCodeAfterIncludes};var shaderCodes=[void 0,void 0];var shadersLoaded=function shadersLoaded(){if(shaderCodes[0]&&shaderCodes[1]){processorOptions.isFragment=true;var migratedVertexCode=shaderCodes[0],fragmentCode=shaderCodes[1];ShaderProcessor.Process(fragmentCode,processorOptions,function(migratedFragmentCode,codeBeforeMigration){_this11._fragmentSourceCodeBeforeMigration=codeBeforeMigration;if(processFinalCode){migratedFragmentCode=processFinalCode("fragment",migratedFragmentCode);}var finalShaders=ShaderProcessor.Finalize(migratedVertexCode,migratedFragmentCode,processorOptions);processorOptions=null;_this11._useFinalCode(finalShaders.vertexCode,finalShaders.fragmentCode,baseName);},_this11._engine);}};this._loadShader(vertexSource,"Vertex","",function(vertexCode){ShaderProcessor.Initialize(processorOptions);ShaderProcessor.Process(vertexCode,processorOptions,function(migratedVertexCode,codeBeforeMigration){_this11._rawVertexSourceCode=vertexCode;_this11._vertexSourceCodeBeforeMigration=codeBeforeMigration;if(processFinalCode){migratedVertexCode=processFinalCode("vertex",migratedVertexCode);}shaderCodes[0]=migratedVertexCode;shadersLoaded();},_this11._engine);});this._loadShader(fragmentSource,"Fragment","Pixel",function(fragmentCode){_this11._rawFragmentSourceCode=fragmentCode;shaderCodes[1]=fragmentCode;shadersLoaded();});var proxyFunction=function proxyFunction(functionName){return function(){if(this._pipelineContext){var func=this._pipelineContext[functionName];func.apply(this._pipelineContext,arguments);}return this;};};["Int?","UInt?","IntArray?","UIntArray?","Array?","Color?","Vector?","Float?","Matrices","Matrix","Matrix3x3","Matrix2x2","Quaternion","DirectColor4"].forEach(function(functionName){var name135="set".concat(functionName);if(name135.endsWith("?")){["",2,3,4].forEach(function(n){_this11[name135.slice(0,-1)+n]=_this11[name135.slice(0,-1)+n]||proxyFunction(name135.slice(0,-1)+n).bind(_this11);});}else{_this11[name135]=_this11[name135]||proxyFunction(name135).bind(_this11);}});}_createClass(Effect,[{key:"onBindObservable",get:function get(){if(!this._onBindObservable){this._onBindObservable=new Observable();}return this._onBindObservable;}},{key:"_useFinalCode",value:function _useFinalCode(migratedVertexCode,migratedFragmentCode,baseName){if(baseName){var vertex=baseName.vertexElement||baseName.vertex||baseName.spectorName||baseName;var fragment=baseName.fragmentElement||baseName.fragment||baseName.spectorName||baseName;this._vertexSourceCode=(this._shaderLanguage===ShaderLanguage.WGSL?"//":"")+"#define SHADER_NAME vertex:"+vertex+"\n"+migratedVertexCode;this._fragmentSourceCode=(this._shaderLanguage===ShaderLanguage.WGSL?"//":"")+"#define SHADER_NAME fragment:"+fragment+"\n"+migratedFragmentCode;}else{this._vertexSourceCode=migratedVertexCode;this._fragmentSourceCode=migratedFragmentCode;}this._prepareEffect();}},{key:"key",get:function get(){return this._key;}},{key:"isReady",value:function isReady(){try{return this._isReadyInternal();}catch(_a){return false;}}},{key:"_isReadyInternal",value:function _isReadyInternal(){if(this._isReady){return true;}if(this._pipelineContext){return this._pipelineContext.isReady;}return false;}},{key:"getEngine",value:function getEngine(){return this._engine;}},{key:"getPipelineContext",value:function getPipelineContext(){return this._pipelineContext;}},{key:"getAttributesNames",value:function getAttributesNames(){return this._attributesNames;}},{key:"getAttributeLocation",value:function getAttributeLocation(index){return this._attributes[index];}},{key:"getAttributeLocationByName",value:function getAttributeLocationByName(name135){return this._attributeLocationByName[name135];}},{key:"getAttributesCount",value:function getAttributesCount(){return this._attributes.length;}},{key:"getUniformIndex",value:function getUniformIndex(uniformName){return this._uniformsNames.indexOf(uniformName);}},{key:"getUniform",value:function getUniform(uniformName){return this._uniforms[uniformName];}},{key:"getSamplers",value:function getSamplers(){return this._samplerList;}},{key:"getUniformNames",value:function getUniformNames(){return this._uniformsNames;}},{key:"getUniformBuffersNames",value:function getUniformBuffersNames(){return this._uniformBuffersNamesList;}},{key:"getIndexParameters",value:function getIndexParameters(){return this._indexParameters;}},{key:"getCompilationError",value:function getCompilationError(){return this._compilationError;}},{key:"allFallbacksProcessed",value:function allFallbacksProcessed(){return this._allFallbacksProcessed;}},{key:"executeWhenCompiled",value:function executeWhenCompiled(func){var _this12=this;if(this.isReady()){func(this);return;}this.onCompileObservable.add(function(effect){func(effect);});if(!this._pipelineContext||this._pipelineContext.isAsync){setTimeout(function(){_this12._checkIsReady(null);},16);}}},{key:"_checkIsReady",value:function _checkIsReady(previousPipelineContext){var _this13=this;try{if(this._isReadyInternal()){return;}}catch(e){this._processCompilationErrors(e,previousPipelineContext);return;}if(this._isDisposed){return;}setTimeout(function(){_this13._checkIsReady(previousPipelineContext);},16);}},{key:"_loadShader",value:function _loadShader(shader135,key,optionalKey,callback){if(typeof HTMLElement!=="undefined"){if(shader135 instanceof HTMLElement){var shaderCode=GetDOMTextContent(shader135);callback(shaderCode);return;}}if(shader135.substr(0,7)==="source:"){callback(shader135.substr(7));return;}if(shader135.substr(0,7)==="base64:"){var shaderBinary=window.atob(shader135.substr(7));callback(shaderBinary);return;}var shaderStore=ShaderStore.GetShadersStore(this._shaderLanguage);if(shaderStore[shader135+key+"Shader"]){callback(shaderStore[shader135+key+"Shader"]);return;}if(optionalKey&&shaderStore[shader135+optionalKey+"Shader"]){callback(shaderStore[shader135+optionalKey+"Shader"]);return;}var shaderUrl;if(shader135[0]==="."||shader135[0]==="/"||shader135.indexOf("http")>-1){shaderUrl=shader135;}else{shaderUrl=ShaderStore.GetShadersRepository(this._shaderLanguage)+shader135;}this._engine._loadFile(shaderUrl+"."+key.toLowerCase()+".fx",callback);}},{key:"vertexSourceCode",get:function get(){var _a,_b;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(_b=(_a=this._pipelineContext)===null||_a===void 0?void 0:_a._getVertexShaderCode())!==null&&_b!==void 0?_b:this._vertexSourceCode;}},{key:"fragmentSourceCode",get:function get(){var _a,_b;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(_b=(_a=this._pipelineContext)===null||_a===void 0?void 0:_a._getFragmentShaderCode())!==null&&_b!==void 0?_b:this._fragmentSourceCode;}},{key:"vertexSourceCodeBeforeMigration",get:function get(){return this._vertexSourceCodeBeforeMigration;}},{key:"fragmentSourceCodeBeforeMigration",get:function get(){return this._fragmentSourceCodeBeforeMigration;}},{key:"rawVertexSourceCode",get:function get(){return this._rawVertexSourceCode;}},{key:"rawFragmentSourceCode",get:function get(){return this._rawFragmentSourceCode;}},{key:"_rebuildProgram",value:function _rebuildProgram(vertexSourceCode,fragmentSourceCode,onCompiled,onError){var _this14=this;this._isReady=false;this._vertexSourceCodeOverride=vertexSourceCode;this._fragmentSourceCodeOverride=fragmentSourceCode;this.onError=function(effect,error){if(onError){onError(error);}};this.onCompiled=function(){var scenes=_this14.getEngine().scenes;if(scenes){for(var i=0;i<scenes.length;i++){scenes[i].markAllMaterialsAsDirty(63);}}_this14._pipelineContext._handlesSpectorRebuildCallback(onCompiled);};this._fallbacks=null;this._prepareEffect();}},{key:"_prepareEffect",value:function _prepareEffect(){var _this15=this;var attributesNames=this._attributesNames;var defines=this.defines;var previousPipelineContext=this._pipelineContext;this._isReady=false;try{var engine=this._engine;this._pipelineContext=engine.createPipelineContext(this._processingContext);this._pipelineContext._name=this._key;var rebuildRebind=this._rebuildProgram.bind(this);if(this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride){engine._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,true,this._rawVertexSourceCode,this._rawFragmentSourceCode,rebuildRebind,null,this._transformFeedbackVaryings,this._key);}else{engine._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,false,this._rawVertexSourceCode,this._rawFragmentSourceCode,rebuildRebind,defines,this._transformFeedbackVaryings,this._key);}engine._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){_this15._attributes=[];_this15._pipelineContext._fillEffectInformation(_this15,_this15._uniformBuffersNames,_this15._uniformsNames,_this15._uniforms,_this15._samplerList,_this15._samplers,attributesNames,_this15._attributes);if(attributesNames){for(var i=0;i<attributesNames.length;i++){var name135=attributesNames[i];_this15._attributeLocationByName[name135]=_this15._attributes[i];}}engine.bindSamplers(_this15);_this15._compilationError="";_this15._isReady=true;if(_this15.onCompiled){_this15.onCompiled(_this15);}_this15.onCompileObservable.notifyObservers(_this15);_this15.onCompileObservable.clear();if(_this15._fallbacks){_this15._fallbacks.unBindMesh();}if(previousPipelineContext){_this15.getEngine()._deletePipelineContext(previousPipelineContext);}});if(this._pipelineContext.isAsync){this._checkIsReady(previousPipelineContext);}}catch(e){this._processCompilationErrors(e,previousPipelineContext);}}},{key:"_getShaderCodeAndErrorLine",value:function _getShaderCodeAndErrorLine(code,error,isFragment){var regexp=isFragment?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;var errorLine=null;if(error&&code){var res=error.match(regexp);if(res&&res.length===2){var lineNumber=parseInt(res[1]);var lines=code.split("\n",-1);if(lines.length>=lineNumber){errorLine="Offending line [".concat(lineNumber,"] in ").concat(isFragment?"fragment":"vertex"," code: ").concat(lines[lineNumber-1]);}}}return[code,errorLine];}},{key:"_processCompilationErrors",value:function _processCompilationErrors(e){var _this16=this;var previousPipelineContext=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _a,_b,_c;this._compilationError=e.message;var attributesNames=this._attributesNames;var fallbacks=this._fallbacks;Logger.Error("Unable to compile effect:");Logger.Error("Uniforms: "+this._uniformsNames.map(function(uniform){return" "+uniform;}));Logger.Error("Attributes: "+attributesNames.map(function(attribute){return" "+attribute;}));Logger.Error("Defines:\r\n"+this.defines);if(Effect.LogShaderCodeOnCompilationError){var lineErrorVertex=null,lineErrorFragment=null,code=null;if((_a=this._pipelineContext)===null||_a===void 0?void 0:_a._getVertexShaderCode()){var _this$_getShaderCodeA=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,false);var _this$_getShaderCodeA2=_slicedToArray(_this$_getShaderCodeA,2);code=_this$_getShaderCodeA2[0];lineErrorVertex=_this$_getShaderCodeA2[1];if(code){Logger.Error("Vertex code:");Logger.Error(code);}}if((_b=this._pipelineContext)===null||_b===void 0?void 0:_b._getFragmentShaderCode()){var _this$_getShaderCodeA3=this._getShaderCodeAndErrorLine((_c=this._pipelineContext)===null||_c===void 0?void 0:_c._getFragmentShaderCode(),this._compilationError,true);var _this$_getShaderCodeA4=_slicedToArray(_this$_getShaderCodeA3,2);code=_this$_getShaderCodeA4[0];lineErrorFragment=_this$_getShaderCodeA4[1];if(code){Logger.Error("Fragment code:");Logger.Error(code);}}if(lineErrorVertex){Logger.Error(lineErrorVertex);}if(lineErrorFragment){Logger.Error(lineErrorFragment);}}Logger.Error("Error: "+this._compilationError);var notifyErrors=function notifyErrors(){if(_this16.onError){_this16.onError(_this16,_this16._compilationError);}_this16.onErrorObservable.notifyObservers(_this16);};if(previousPipelineContext){this._pipelineContext=previousPipelineContext;this._isReady=true;notifyErrors();}if(fallbacks){this._pipelineContext=null;if(fallbacks.hasMoreFallbacks){this._allFallbacksProcessed=false;Logger.Error("Trying next fallback.");this.defines=fallbacks.reduce(this.defines,this);this._prepareEffect();}else{this._allFallbacksProcessed=true;notifyErrors();this.onErrorObservable.clear();if(this._fallbacks){this._fallbacks.unBindMesh();}}}else{this._allFallbacksProcessed=true;if(!previousPipelineContext){notifyErrors();}}}},{key:"isSupported",get:function get(){return this._compilationError==="";}},{key:"_bindTexture",value:function _bindTexture(channel,texture){this._engine._bindTexture(this._samplers[channel],texture,channel);}},{key:"setTexture",value:function setTexture(channel,texture){this._engine.setTexture(this._samplers[channel],this._uniforms[channel],texture,channel);}},{key:"setDepthStencilTexture",value:function setDepthStencilTexture(channel,texture){this._engine.setDepthStencilTexture(this._samplers[channel],this._uniforms[channel],texture,channel);}},{key:"setTextureArray",value:function setTextureArray(channel,textures){var exName=channel+"Ex";if(this._samplerList.indexOf(exName+"0")===-1){var initialPos=this._samplerList.indexOf(channel);for(var index=1;index<textures.length;index++){var currentExName=exName+(index-1).toString();this._samplerList.splice(initialPos+index,0,currentExName);}var channelIndex=0;var _iterator10=_createForOfIteratorHelper(this._samplerList),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var key=_step10.value;this._samplers[key]=channelIndex;channelIndex+=1;}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}}this._engine.setTextureArray(this._samplers[channel],this._uniforms[channel],textures,channel);}},{key:"setTextureFromPostProcess",value:function setTextureFromPostProcess(channel,postProcess){this._engine.setTextureFromPostProcess(this._samplers[channel],postProcess,channel);}},{key:"setTextureFromPostProcessOutput",value:function setTextureFromPostProcessOutput(channel,postProcess){this._engine.setTextureFromPostProcessOutput(this._samplers[channel],postProcess,channel);}},{key:"bindUniformBuffer",value:function bindUniformBuffer(buffer,name135){var bufferName=this._uniformBuffersNames[name135];if(bufferName===void 0||Effect._BaseCache[bufferName]===buffer&&this._engine._features.useUBOBindingCache){return;}Effect._BaseCache[bufferName]=buffer;this._engine.bindUniformBufferBase(buffer,bufferName,name135);}},{key:"bindUniformBlock",value:function bindUniformBlock(blockName,index){this._engine.bindUniformBlock(this._pipelineContext,blockName,index);}},{key:"setFloatArray",value:function setFloatArray(uniformName,array){this._pipelineContext.setArray(uniformName,array);return this;}},{key:"setFloatArray2",value:function setFloatArray2(uniformName,array){this._pipelineContext.setArray2(uniformName,array);return this;}},{key:"setFloatArray3",value:function setFloatArray3(uniformName,array){this._pipelineContext.setArray3(uniformName,array);return this;}},{key:"setFloatArray4",value:function setFloatArray4(uniformName,array){this._pipelineContext.setArray4(uniformName,array);return this;}},{key:"setBool",value:function setBool(uniformName,bool){this._pipelineContext.setInt(uniformName,bool?1:0);return this;}},{key:"dispose",value:function dispose(){var _a;(_a=this._pipelineContext)===null||_a===void 0?void 0:_a.dispose();this._engine._releaseEffect(this);this._isDisposed=true;}}],[{key:"ShadersRepository",get:function get(){return ShaderStore.ShadersRepository;},set:function set(repo){ShaderStore.ShadersRepository=repo;}},{key:"RegisterShader",value:function RegisterShader(name135,pixelShader,vertexShader){var shaderLanguage=arguments.length>3&&arguments[3]!==undefined?arguments[3]:ShaderLanguage.GLSL;if(pixelShader){ShaderStore.GetShadersStore(shaderLanguage)["".concat(name135,"PixelShader")]=pixelShader;}if(vertexShader){ShaderStore.GetShadersStore(shaderLanguage)["".concat(name135,"VertexShader")]=vertexShader;}}},{key:"ResetCache",value:function ResetCache(){Effect._BaseCache={};}}]);return Effect;}();Effect.LogShaderCodeOnCompilationError=true;Effect._UniqueIdSeed=0;Effect._BaseCache={};Effect.ShadersStore=ShaderStore.ShadersStore;Effect.IncludesShadersStore=ShaderStore.IncludesShadersStore;// node_modules/@babylonjs/core/States/depthCullingState.js
var DepthCullingState=/*#__PURE__*/function(){function DepthCullingState(){var reset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_classCallCheck(this,DepthCullingState);this._isDepthTestDirty=false;this._isDepthMaskDirty=false;this._isDepthFuncDirty=false;this._isCullFaceDirty=false;this._isCullDirty=false;this._isZOffsetDirty=false;this._isFrontFaceDirty=false;if(reset){this.reset();}}_createClass(DepthCullingState,[{key:"isDirty",get:function get(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty;}},{key:"zOffset",get:function get(){return this._zOffset;},set:function set(value){if(this._zOffset===value){return;}this._zOffset=value;this._isZOffsetDirty=true;}},{key:"zOffsetUnits",get:function get(){return this._zOffsetUnits;},set:function set(value){if(this._zOffsetUnits===value){return;}this._zOffsetUnits=value;this._isZOffsetDirty=true;}},{key:"cullFace",get:function get(){return this._cullFace;},set:function set(value){if(this._cullFace===value){return;}this._cullFace=value;this._isCullFaceDirty=true;}},{key:"cull",get:function get(){return this._cull;},set:function set(value){if(this._cull===value){return;}this._cull=value;this._isCullDirty=true;}},{key:"depthFunc",get:function get(){return this._depthFunc;},set:function set(value){if(this._depthFunc===value){return;}this._depthFunc=value;this._isDepthFuncDirty=true;}},{key:"depthMask",get:function get(){return this._depthMask;},set:function set(value){if(this._depthMask===value){return;}this._depthMask=value;this._isDepthMaskDirty=true;}},{key:"depthTest",get:function get(){return this._depthTest;},set:function set(value){if(this._depthTest===value){return;}this._depthTest=value;this._isDepthTestDirty=true;}},{key:"frontFace",get:function get(){return this._frontFace;},set:function set(value){if(this._frontFace===value){return;}this._frontFace=value;this._isFrontFaceDirty=true;}},{key:"reset",value:function reset(){this._depthMask=true;this._depthTest=true;this._depthFunc=null;this._cullFace=null;this._cull=null;this._zOffset=0;this._zOffsetUnits=0;this._frontFace=null;this._isDepthTestDirty=true;this._isDepthMaskDirty=true;this._isDepthFuncDirty=false;this._isCullFaceDirty=false;this._isCullDirty=false;this._isZOffsetDirty=true;this._isFrontFaceDirty=false;}},{key:"apply",value:function apply(gl){if(!this.isDirty){return;}if(this._isCullDirty){if(this.cull){gl.enable(gl.CULL_FACE);}else{gl.disable(gl.CULL_FACE);}this._isCullDirty=false;}if(this._isCullFaceDirty){gl.cullFace(this.cullFace);this._isCullFaceDirty=false;}if(this._isDepthMaskDirty){gl.depthMask(this.depthMask);this._isDepthMaskDirty=false;}if(this._isDepthTestDirty){if(this.depthTest){gl.enable(gl.DEPTH_TEST);}else{gl.disable(gl.DEPTH_TEST);}this._isDepthTestDirty=false;}if(this._isDepthFuncDirty){gl.depthFunc(this.depthFunc);this._isDepthFuncDirty=false;}if(this._isZOffsetDirty){if(this.zOffset||this.zOffsetUnits){gl.enable(gl.POLYGON_OFFSET_FILL);gl.polygonOffset(this.zOffset,this.zOffsetUnits);}else{gl.disable(gl.POLYGON_OFFSET_FILL);}this._isZOffsetDirty=false;}if(this._isFrontFaceDirty){gl.frontFace(this.frontFace);this._isFrontFaceDirty=false;}}}]);return DepthCullingState;}();// node_modules/@babylonjs/core/States/stencilState.js
var StencilState=/*#__PURE__*/function(){function StencilState(){_classCallCheck(this,StencilState);this.reset();}_createClass(StencilState,[{key:"reset",value:function reset(){this.enabled=false;this.mask=255;this.func=StencilState.ALWAYS;this.funcRef=1;this.funcMask=255;this.opStencilFail=StencilState.KEEP;this.opDepthFail=StencilState.KEEP;this.opStencilDepthPass=StencilState.REPLACE;}},{key:"stencilFunc",get:function get(){return this.func;},set:function set(value){this.func=value;}},{key:"stencilFuncRef",get:function get(){return this.funcRef;},set:function set(value){this.funcRef=value;}},{key:"stencilFuncMask",get:function get(){return this.funcMask;},set:function set(value){this.funcMask=value;}},{key:"stencilOpStencilFail",get:function get(){return this.opStencilFail;},set:function set(value){this.opStencilFail=value;}},{key:"stencilOpDepthFail",get:function get(){return this.opDepthFail;},set:function set(value){this.opDepthFail=value;}},{key:"stencilOpStencilDepthPass",get:function get(){return this.opStencilDepthPass;},set:function set(value){this.opStencilDepthPass=value;}},{key:"stencilMask",get:function get(){return this.mask;},set:function set(value){this.mask=value;}},{key:"stencilTest",get:function get(){return this.enabled;},set:function set(value){this.enabled=value;}}]);return StencilState;}();StencilState.ALWAYS=519;StencilState.KEEP=7680;StencilState.REPLACE=7681;// node_modules/@babylonjs/core/States/alphaCullingState.js
var AlphaState=/*#__PURE__*/function(){function AlphaState(){_classCallCheck(this,AlphaState);this._blendFunctionParameters=new Array(4);this._blendEquationParameters=new Array(2);this._blendConstants=new Array(4);this._isBlendConstantsDirty=false;this._alphaBlend=false;this._isAlphaBlendDirty=false;this._isBlendFunctionParametersDirty=false;this._isBlendEquationParametersDirty=false;this.reset();}_createClass(AlphaState,[{key:"isDirty",get:function get(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty;}},{key:"alphaBlend",get:function get(){return this._alphaBlend;},set:function set(value){if(this._alphaBlend===value){return;}this._alphaBlend=value;this._isAlphaBlendDirty=true;}},{key:"setAlphaBlendConstants",value:function setAlphaBlendConstants(r,g,b,a){if(this._blendConstants[0]===r&&this._blendConstants[1]===g&&this._blendConstants[2]===b&&this._blendConstants[3]===a){return;}this._blendConstants[0]=r;this._blendConstants[1]=g;this._blendConstants[2]=b;this._blendConstants[3]=a;this._isBlendConstantsDirty=true;}},{key:"setAlphaBlendFunctionParameters",value:function setAlphaBlendFunctionParameters(value0,value1,value2,value3){if(this._blendFunctionParameters[0]===value0&&this._blendFunctionParameters[1]===value1&&this._blendFunctionParameters[2]===value2&&this._blendFunctionParameters[3]===value3){return;}this._blendFunctionParameters[0]=value0;this._blendFunctionParameters[1]=value1;this._blendFunctionParameters[2]=value2;this._blendFunctionParameters[3]=value3;this._isBlendFunctionParametersDirty=true;}},{key:"setAlphaEquationParameters",value:function setAlphaEquationParameters(rgb,alpha){if(this._blendEquationParameters[0]===rgb&&this._blendEquationParameters[1]===alpha){return;}this._blendEquationParameters[0]=rgb;this._blendEquationParameters[1]=alpha;this._isBlendEquationParametersDirty=true;}},{key:"reset",value:function reset(){this._alphaBlend=false;this._blendFunctionParameters[0]=null;this._blendFunctionParameters[1]=null;this._blendFunctionParameters[2]=null;this._blendFunctionParameters[3]=null;this._blendEquationParameters[0]=null;this._blendEquationParameters[1]=null;this._blendConstants[0]=null;this._blendConstants[1]=null;this._blendConstants[2]=null;this._blendConstants[3]=null;this._isAlphaBlendDirty=true;this._isBlendFunctionParametersDirty=false;this._isBlendEquationParametersDirty=false;this._isBlendConstantsDirty=false;}},{key:"apply",value:function apply(gl){if(!this.isDirty){return;}if(this._isAlphaBlendDirty){if(this._alphaBlend){gl.enable(gl.BLEND);}else{gl.disable(gl.BLEND);}this._isAlphaBlendDirty=false;}if(this._isBlendFunctionParametersDirty){gl.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]);this._isBlendFunctionParametersDirty=false;}if(this._isBlendEquationParametersDirty){gl.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]);this._isBlendEquationParametersDirty=false;}if(this._isBlendConstantsDirty){gl.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]);this._isBlendConstantsDirty=false;}}}]);return AlphaState;}();// node_modules/@babylonjs/core/Materials/Textures/textureSampler.js
var TextureSampler=/*#__PURE__*/function(){function TextureSampler(){_classCallCheck(this,TextureSampler);this.samplingMode=-1;this._useMipMaps=true;this._cachedWrapU=null;this._cachedWrapV=null;this._cachedWrapR=null;this._cachedAnisotropicFilteringLevel=null;this._comparisonFunction=0;}_createClass(TextureSampler,[{key:"wrapU",get:function get(){return this._cachedWrapU;},set:function set(value){this._cachedWrapU=value;}},{key:"wrapV",get:function get(){return this._cachedWrapV;},set:function set(value){this._cachedWrapV=value;}},{key:"wrapR",get:function get(){return this._cachedWrapR;},set:function set(value){this._cachedWrapR=value;}},{key:"anisotropicFilteringLevel",get:function get(){return this._cachedAnisotropicFilteringLevel;},set:function set(value){this._cachedAnisotropicFilteringLevel=value;}},{key:"comparisonFunction",get:function get(){return this._comparisonFunction;},set:function set(value){this._comparisonFunction=value;}},{key:"useMipMaps",get:function get(){return this._useMipMaps;},set:function set(value){this._useMipMaps=value;}},{key:"setParameters",value:function setParameters(){var wrapU=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var wrapV=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var wrapR=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var anisotropicFilteringLevel=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var samplingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:2;var comparisonFunction=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;this._cachedWrapU=wrapU;this._cachedWrapV=wrapV;this._cachedWrapR=wrapR;this._cachedAnisotropicFilteringLevel=anisotropicFilteringLevel;this.samplingMode=samplingMode;this._comparisonFunction=comparisonFunction;return this;}},{key:"compareSampler",value:function compareSampler(other){return this._cachedWrapU===other._cachedWrapU&&this._cachedWrapV===other._cachedWrapV&&this._cachedWrapR===other._cachedWrapR&&this._cachedAnisotropicFilteringLevel===other._cachedAnisotropicFilteringLevel&&this.samplingMode===other.samplingMode&&this._comparisonFunction===other._comparisonFunction&&this._useMipMaps===other._useMipMaps;}}]);return TextureSampler;}();// node_modules/@babylonjs/core/Materials/Textures/internalTexture.js
var InternalTextureSource;(function(InternalTextureSource2){InternalTextureSource2[InternalTextureSource2["Unknown"]=0]="Unknown";InternalTextureSource2[InternalTextureSource2["Url"]=1]="Url";InternalTextureSource2[InternalTextureSource2["Temp"]=2]="Temp";InternalTextureSource2[InternalTextureSource2["Raw"]=3]="Raw";InternalTextureSource2[InternalTextureSource2["Dynamic"]=4]="Dynamic";InternalTextureSource2[InternalTextureSource2["RenderTarget"]=5]="RenderTarget";InternalTextureSource2[InternalTextureSource2["MultiRenderTarget"]=6]="MultiRenderTarget";InternalTextureSource2[InternalTextureSource2["Cube"]=7]="Cube";InternalTextureSource2[InternalTextureSource2["CubeRaw"]=8]="CubeRaw";InternalTextureSource2[InternalTextureSource2["CubePrefiltered"]=9]="CubePrefiltered";InternalTextureSource2[InternalTextureSource2["Raw3D"]=10]="Raw3D";InternalTextureSource2[InternalTextureSource2["Raw2DArray"]=11]="Raw2DArray";InternalTextureSource2[InternalTextureSource2["DepthStencil"]=12]="DepthStencil";InternalTextureSource2[InternalTextureSource2["CubeRawRGBD"]=13]="CubeRawRGBD";InternalTextureSource2[InternalTextureSource2["Depth"]=14]="Depth";})(InternalTextureSource||(InternalTextureSource={}));var InternalTexture=/*#__PURE__*/function(_TextureSampler){_inherits(InternalTexture,_TextureSampler);var _super9=_createSuper(InternalTexture);function InternalTexture(engine,source){var _this17;var delayAllocation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;_classCallCheck(this,InternalTexture);_this17=_super9.call(this);_this17.isReady=false;_this17.isCube=false;_this17.is3D=false;_this17.is2DArray=false;_this17.isMultiview=false;_this17.url="";_this17.generateMipMaps=false;_this17.samples=0;_this17.type=-1;_this17.format=-1;_this17.onLoadedObservable=new Observable();_this17.onErrorObservable=new Observable();_this17.onRebuildCallback=null;_this17.width=0;_this17.height=0;_this17.depth=0;_this17.baseWidth=0;_this17.baseHeight=0;_this17.baseDepth=0;_this17.invertY=false;_this17._invertVScale=false;_this17._associatedChannel=-1;_this17._source=InternalTextureSource.Unknown;_this17._buffer=null;_this17._bufferView=null;_this17._bufferViewArray=null;_this17._bufferViewArrayArray=null;_this17._size=0;_this17._extension="";_this17._files=null;_this17._workingCanvas=null;_this17._workingContext=null;_this17._cachedCoordinatesMode=null;_this17._isDisabled=false;_this17._compression=null;_this17._sphericalPolynomial=null;_this17._sphericalPolynomialPromise=null;_this17._sphericalPolynomialComputed=false;_this17._lodGenerationScale=0;_this17._lodGenerationOffset=0;_this17._useSRGBBuffer=false;_this17._lodTextureHigh=null;_this17._lodTextureMid=null;_this17._lodTextureLow=null;_this17._isRGBD=false;_this17._linearSpecularLOD=false;_this17._irradianceTexture=null;_this17._hardwareTexture=null;_this17._maxLodLevel=null;_this17._references=1;_this17._gammaSpace=null;_this17._engine=engine;_this17._source=source;_this17._uniqueId=InternalTexture._Counter++;if(!delayAllocation){_this17._hardwareTexture=engine._createHardwareTexture();}return _this17;}_createClass(InternalTexture,[{key:"useMipMaps",get:function get(){return this.generateMipMaps;},set:function set(value){this.generateMipMaps=value;}},{key:"uniqueId",get:function get(){return this._uniqueId;}},{key:"_setUniqueId",value:function _setUniqueId(id){this._uniqueId=id;}},{key:"getEngine",value:function getEngine(){return this._engine;}},{key:"source",get:function get(){return this._source;}},{key:"incrementReferences",value:function incrementReferences(){this._references++;}},{key:"updateSize",value:function updateSize(width,height){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;this._engine.updateTextureDimensions(this,width,height,depth);this.width=width;this.height=height;this.depth=depth;this.baseWidth=width;this.baseHeight=height;this.baseDepth=depth;this._size=width*height*depth;}},{key:"_rebuild",value:function _rebuild(){var _this18=this;var _a;this.isReady=false;this._cachedCoordinatesMode=null;this._cachedWrapU=null;this._cachedWrapV=null;this._cachedWrapR=null;this._cachedAnisotropicFilteringLevel=null;if(this.onRebuildCallback){var data=this.onRebuildCallback(this);var swapAndSetIsReady=function swapAndSetIsReady(proxyInternalTexture){proxyInternalTexture._swapAndDie(_this18,false);_this18.isReady=data.isReady;};if(data.isAsync){data.proxy.then(swapAndSetIsReady);}else{swapAndSetIsReady(data.proxy);}return;}var proxy;switch(this.source){case InternalTextureSource.Temp:break;case InternalTextureSource.Url:proxy=this._engine.createTexture((_a=this._originalUrl)!==null&&_a!==void 0?_a:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(temp){temp._swapAndDie(_this18,false);_this18.isReady=true;},null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer);return;case InternalTextureSource.Raw:proxy=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer);proxy._swapAndDie(this,false);this.isReady=true;break;case InternalTextureSource.Raw3D:proxy=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type);proxy._swapAndDie(this,false);this.isReady=true;break;case InternalTextureSource.Raw2DArray:proxy=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type);proxy._swapAndDie(this,false);this.isReady=true;break;case InternalTextureSource.Dynamic:proxy=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode);proxy._swapAndDie(this,false);this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,true);break;case InternalTextureSource.Cube:proxy=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){proxy._swapAndDie(_this18,false);_this18.isReady=true;},null,this.format,this._extension,false,0,0,null,void 0,this._useSRGBBuffer);return;case InternalTextureSource.CubeRaw:proxy=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression);proxy._swapAndDie(this,false);this.isReady=true;break;case InternalTextureSource.CubeRawRGBD:return;case InternalTextureSource.CubePrefiltered:proxy=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(proxy2){if(proxy2){proxy2._swapAndDie(_this18,false);}_this18.isReady=true;},null,this.format,this._extension);proxy._sphericalPolynomial=this._sphericalPolynomial;return;}}},{key:"_swapAndDie",value:function _swapAndDie(target){var swapAll=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var _a;(_a=this._hardwareTexture)===null||_a===void 0?void 0:_a.setUsage(target._source,this.generateMipMaps,this.isCube,this.width,this.height);target._hardwareTexture=this._hardwareTexture;if(swapAll){target._isRGBD=this._isRGBD;}if(this._lodTextureHigh){if(target._lodTextureHigh){target._lodTextureHigh.dispose();}target._lodTextureHigh=this._lodTextureHigh;}if(this._lodTextureMid){if(target._lodTextureMid){target._lodTextureMid.dispose();}target._lodTextureMid=this._lodTextureMid;}if(this._lodTextureLow){if(target._lodTextureLow){target._lodTextureLow.dispose();}target._lodTextureLow=this._lodTextureLow;}if(this._irradianceTexture){if(target._irradianceTexture){target._irradianceTexture.dispose();}target._irradianceTexture=this._irradianceTexture;}var cache=this._engine.getLoadedTexturesCache();var index=cache.indexOf(this);if(index!==-1){cache.splice(index,1);}index=cache.indexOf(target);if(index===-1){cache.push(target);}}},{key:"dispose",value:function dispose(){this._references--;this.onLoadedObservable.clear();this.onErrorObservable.clear();if(this._references===0){this._engine._releaseTexture(this);this._hardwareTexture=null;}}}]);return InternalTexture;}(TextureSampler);InternalTexture._Counter=0;// node_modules/@babylonjs/core/Engines/WebGL/webGLShaderProcessors.js
var WebGLShaderProcessor=/*#__PURE__*/function(){function WebGLShaderProcessor(){_classCallCheck(this,WebGLShaderProcessor);this.shaderLanguage=ShaderLanguage.GLSL;}_createClass(WebGLShaderProcessor,[{key:"postProcessor",value:function postProcessor(code,defines,isFragment,processingContext,engine){if(!engine.getCaps().drawBuffersExtension){var regex=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;code=code.replace(regex,"");}return code;}}]);return WebGLShaderProcessor;}();// node_modules/@babylonjs/core/Engines/WebGL/webGL2ShaderProcessors.js
var WebGL2ShaderProcessor=/*#__PURE__*/function(){function WebGL2ShaderProcessor(){_classCallCheck(this,WebGL2ShaderProcessor);this.shaderLanguage=ShaderLanguage.GLSL;}_createClass(WebGL2ShaderProcessor,[{key:"attributeProcessor",value:function attributeProcessor(attribute){return attribute.replace("attribute","in");}},{key:"varyingProcessor",value:function varyingProcessor(varying,isFragment){return varying.replace("varying",isFragment?"in":"out");}},{key:"postProcessor",value:function postProcessor(code,defines,isFragment){var hasDrawBuffersExtension=code.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1;var regex=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;code=code.replace(regex,"");code=code.replace(/texture2D\s*\(/g,"texture(");if(isFragment){code=code.replace(/texture2DLodEXT\s*\(/g,"textureLod(");code=code.replace(/textureCubeLodEXT\s*\(/g,"textureLod(");code=code.replace(/textureCube\s*\(/g,"texture(");code=code.replace(/gl_FragDepthEXT/g,"gl_FragDepth");code=code.replace(/gl_FragColor/g,"glFragColor");code=code.replace(/gl_FragData/g,"glFragData");code=code.replace(/void\s+?main\s*\(/g,(hasDrawBuffersExtension?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(");}else{var hasMultiviewExtension=defines.indexOf("#define MULTIVIEW")!==-1;if(hasMultiviewExtension){return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+code;}}return code;}}]);return WebGL2ShaderProcessor;}();// node_modules/@babylonjs/core/Buffers/dataBuffer.js
var DataBuffer=/*#__PURE__*/function(){function DataBuffer(){_classCallCheck(this,DataBuffer);this.references=0;this.capacity=0;this.is32Bits=false;this.uniqueId=DataBuffer._Counter++;}_createClass(DataBuffer,[{key:"underlyingResource",get:function get(){return null;}}]);return DataBuffer;}();DataBuffer._Counter=0;// node_modules/@babylonjs/core/Meshes/WebGL/webGLDataBuffer.js
var WebGLDataBuffer=/*#__PURE__*/function(_DataBuffer){_inherits(WebGLDataBuffer,_DataBuffer);var _super10=_createSuper(WebGLDataBuffer);function WebGLDataBuffer(resource){var _this19;_classCallCheck(this,WebGLDataBuffer);_this19=_super10.call(this);_this19._buffer=resource;return _this19;}_createClass(WebGLDataBuffer,[{key:"underlyingResource",get:function get(){return this._buffer;}}]);return WebGLDataBuffer;}(DataBuffer);// node_modules/@babylonjs/core/Engines/WebGL/webGLPipelineContext.js
var floatNCache=["Int","Int2","Int3","Int4","UInt","UInt2","UInt3","UInt4","Vector2","Vector3","Vector4","Float2","Float","Float3","Float4","Quaternion","Color3","Color4","DirectColor4"];var WebGLPipelineContext=/*#__PURE__*/function(){function WebGLPipelineContext(){var _this20=this;_classCallCheck(this,WebGLPipelineContext);this._valueCache={};this.vertexCompilationError=null;this.fragmentCompilationError=null;this.programLinkError=null;this.programValidationError=null;var args=[];var prepareArray=function prepareArray(){args.length=0;Array.prototype.push.apply(args,arguments);args[0]=this._uniforms[args[0]];};var proxyFunction=function proxyFunction(functionName){var cacheFunction=floatNCache.includes(functionName.substring(3))&&"FloatN";if(cacheFunction){var cacheFunc=_this20["_cache".concat(cacheFunction)];return function(){var func=this.engine[functionName];prepareArray.apply(this,arguments);if(cacheFunc.apply(this,arguments)){if(!func.apply(this.engine,args)){this._valueCache[arguments[0]]=null;}}};}else{return function(){var func=this.engine[functionName];prepareArray.apply(this,arguments);if(arguments[1]!==void 0){this._valueCache[arguments[0]]=null;func.apply(this.engine,args);}};}};["Int?","UInt?","IntArray?","UIntArray?","Array?","Float?","Matrices","Matrix3x3","Matrix2x2"].forEach(function(functionName){var name135="set".concat(functionName);if(_this20[name135]){return;}if(name135.endsWith("?")){["",2,3,4].forEach(function(n){_this20[name135.slice(0,-1)+n]=_this20[name135.slice(0,-1)+n]||proxyFunction(name135.slice(0,-1)+n).bind(_this20);});}else{_this20[name135]=_this20[name135]||proxyFunction(name135).bind(_this20);}});}_createClass(WebGLPipelineContext,[{key:"isAsync",get:function get(){return this.isParallelCompiled;}},{key:"isReady",get:function get(){if(this.program){if(this.isParallelCompiled){return this.engine._isRenderingStateCompiled(this);}return true;}return false;}},{key:"_handlesSpectorRebuildCallback",value:function _handlesSpectorRebuildCallback(onCompiled){if(onCompiled&&this.program){onCompiled(this.program);}}},{key:"_fillEffectInformation",value:function _fillEffectInformation(effect,uniformBuffersNames,uniformsNames,uniforms,samplerList,samplers,attributesNames,attributes){var engine=this.engine;if(engine.supportsUniformBuffers){for(var name135 in uniformBuffersNames){effect.bindUniformBlock(name135,uniformBuffersNames[name135]);}}var effectAvailableUniforms=this.engine.getUniforms(this,uniformsNames);effectAvailableUniforms.forEach(function(uniform,index2){uniforms[uniformsNames[index2]]=uniform;});this._uniforms=uniforms;var index;for(index=0;index<samplerList.length;index++){var sampler=effect.getUniform(samplerList[index]);if(sampler==null){samplerList.splice(index,1);index--;}}samplerList.forEach(function(name135,index2){samplers[name135]=index2;});var _iterator11=_createForOfIteratorHelper(engine.getAttributes(this,attributesNames)),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var attr=_step11.value;attributes.push(attr);}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}}},{key:"dispose",value:function dispose(){this._uniforms={};}},{key:"_cacheMatrix",value:function _cacheMatrix(uniformName,matrix){var cache=this._valueCache[uniformName];var flag=matrix.updateFlag;if(cache!==void 0&&cache===flag){return false;}this._valueCache[uniformName]=flag;return true;}},{key:"_cacheFloatN",value:function _cacheFloatN(_uniformName,_x,_y,_z,_w){var cache=this._valueCache[arguments[0]];if(!cache||cache.length!==arguments.length-1){cache=Array.prototype.slice.call(arguments,1);this._valueCache[arguments[0]]=cache;return true;}var changed=false;for(var i=0;i<cache.length;++i){if(cache[i]!==arguments[i+1]){cache[i]=arguments[i+1];changed=true;}}return changed;}},{key:"_cacheFloat2",value:function _cacheFloat2(uniformName,x,y){return this._cacheFloatN(uniformName,x,y);}},{key:"_cacheFloat3",value:function _cacheFloat3(uniformName,x,y,z){return this._cacheFloatN(uniformName,x,y,z);}},{key:"_cacheFloat4",value:function _cacheFloat4(uniformName,x,y,z,w){return this._cacheFloatN(uniformName,x,y,z,w);}},{key:"setMatrix",value:function setMatrix(uniformName,matrix){if(this._cacheMatrix(uniformName,matrix)){if(!this.engine.setMatrices(this._uniforms[uniformName],matrix.toArray())){this._valueCache[uniformName]=null;}}}},{key:"setVector2",value:function setVector2(uniformName,vector2){this.setFloat2(uniformName,vector2.x,vector2.y);}},{key:"setVector3",value:function setVector3(uniformName,vector3){this.setFloat3(uniformName,vector3.x,vector3.y,vector3.z);}},{key:"setVector4",value:function setVector4(uniformName,vector4){this.setFloat4(uniformName,vector4.x,vector4.y,vector4.z,vector4.w);}},{key:"setQuaternion",value:function setQuaternion(uniformName,quaternion){this.setFloat4(uniformName,quaternion.x,quaternion.y,quaternion.z,quaternion.w);}},{key:"setColor3",value:function setColor3(uniformName,color3){this.setFloat3(uniformName,color3.r,color3.g,color3.b);}},{key:"setColor4",value:function setColor4(uniformName,color3,alpha){this.setFloat4(uniformName,color3.r,color3.g,color3.b,alpha);}},{key:"setDirectColor4",value:function setDirectColor4(uniformName,color4){this.setFloat4(uniformName,color4.r,color4.g,color4.b,color4.a);}},{key:"_getVertexShaderCode",value:function _getVertexShaderCode(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null;}},{key:"_getFragmentShaderCode",value:function _getFragmentShaderCode(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null;}}]);return WebGLPipelineContext;}();// node_modules/@babylonjs/core/Engines/performanceConfigurator.js
var PerformanceConfigurator=/*#__PURE__*/function(){function PerformanceConfigurator(){_classCallCheck(this,PerformanceConfigurator);}_createClass(PerformanceConfigurator,null,[{key:"SetMatrixPrecision",value:function SetMatrixPrecision(use64bits){PerformanceConfigurator.MatrixTrackPrecisionChange=false;if(use64bits&&!PerformanceConfigurator.MatrixUse64Bits){if(PerformanceConfigurator.MatrixTrackedMatrices){for(var m=0;m<PerformanceConfigurator.MatrixTrackedMatrices.length;++m){var matrix=PerformanceConfigurator.MatrixTrackedMatrices[m];var values=matrix._m;matrix._m=new Array(16);for(var i=0;i<16;++i){matrix._m[i]=values[i];}}}}PerformanceConfigurator.MatrixUse64Bits=use64bits;PerformanceConfigurator.MatrixCurrentType=PerformanceConfigurator.MatrixUse64Bits?Array:Float32Array;PerformanceConfigurator.MatrixTrackedMatrices=null;}}]);return PerformanceConfigurator;}();PerformanceConfigurator.MatrixUse64Bits=false;PerformanceConfigurator.MatrixTrackPrecisionChange=true;PerformanceConfigurator.MatrixCurrentType=Float32Array;PerformanceConfigurator.MatrixTrackedMatrices=[];// node_modules/@babylonjs/core/Engines/WebGL/webGLHardwareTexture.js
var WebGLHardwareTexture=/*#__PURE__*/function(){function WebGLHardwareTexture(){var existingTexture=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var context=arguments.length>1?arguments[1]:undefined;_classCallCheck(this,WebGLHardwareTexture);this._MSAARenderBuffer=null;this._context=context;if(!existingTexture){existingTexture=context.createTexture();if(!existingTexture){throw new Error("Unable to create webGL texture");}}this.set(existingTexture);}_createClass(WebGLHardwareTexture,[{key:"underlyingResource",get:function get(){return this._webGLTexture;}},{key:"setUsage",value:function setUsage(){}},{key:"set",value:function set(hardwareTexture){this._webGLTexture=hardwareTexture;}},{key:"reset",value:function reset(){this._webGLTexture=null;this._MSAARenderBuffer=null;}},{key:"release",value:function release(){if(this._MSAARenderBuffer){this._context.deleteRenderbuffer(this._MSAARenderBuffer);this._MSAARenderBuffer=null;}if(this._webGLTexture){this._context.deleteTexture(this._webGLTexture);}this.reset();}}]);return WebGLHardwareTexture;}();// node_modules/@babylonjs/core/Materials/drawWrapper.js
var DrawWrapper=/*#__PURE__*/function(){function DrawWrapper(engine){var createMaterialContext=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,DrawWrapper);this.effect=null;this.defines=null;this.drawContext=engine.createDrawContext();if(createMaterialContext){this.materialContext=engine.createMaterialContext();}}_createClass(DrawWrapper,[{key:"setEffect",value:function setEffect(effect,defines){var resetContext=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var _a;this.effect=effect;if(defines!==void 0){this.defines=defines;}if(resetContext){(_a=this.drawContext)===null||_a===void 0?void 0:_a.reset();}}},{key:"dispose",value:function dispose(){var _a;(_a=this.drawContext)===null||_a===void 0?void 0:_a.dispose();}}],[{key:"IsWrapper",value:function IsWrapper(effect){return effect.getPipelineContext===void 0;}},{key:"GetEffect",value:function GetEffect(effect){return effect.getPipelineContext===void 0?effect.effect:effect;}}]);return DrawWrapper;}();// node_modules/@babylonjs/core/States/stencilStateComposer.js
var StencilStateComposer=/*#__PURE__*/function(){function StencilStateComposer(){var reset=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_classCallCheck(this,StencilStateComposer);this._isStencilTestDirty=false;this._isStencilMaskDirty=false;this._isStencilFuncDirty=false;this._isStencilOpDirty=false;this.useStencilGlobalOnly=false;if(reset){this.reset();}}_createClass(StencilStateComposer,[{key:"isDirty",get:function get(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty;}},{key:"func",get:function get(){return this._func;},set:function set(value){if(this._func===value){return;}this._func=value;this._isStencilFuncDirty=true;}},{key:"funcRef",get:function get(){return this._funcRef;},set:function set(value){if(this._funcRef===value){return;}this._funcRef=value;this._isStencilFuncDirty=true;}},{key:"funcMask",get:function get(){return this._funcMask;},set:function set(value){if(this._funcMask===value){return;}this._funcMask=value;this._isStencilFuncDirty=true;}},{key:"opStencilFail",get:function get(){return this._opStencilFail;},set:function set(value){if(this._opStencilFail===value){return;}this._opStencilFail=value;this._isStencilOpDirty=true;}},{key:"opDepthFail",get:function get(){return this._opDepthFail;},set:function set(value){if(this._opDepthFail===value){return;}this._opDepthFail=value;this._isStencilOpDirty=true;}},{key:"opStencilDepthPass",get:function get(){return this._opStencilDepthPass;},set:function set(value){if(this._opStencilDepthPass===value){return;}this._opStencilDepthPass=value;this._isStencilOpDirty=true;}},{key:"mask",get:function get(){return this._mask;},set:function set(value){if(this._mask===value){return;}this._mask=value;this._isStencilMaskDirty=true;}},{key:"enabled",get:function get(){return this._enabled;},set:function set(value){if(this._enabled===value){return;}this._enabled=value;this._isStencilTestDirty=true;}},{key:"reset",value:function reset(){var _a;this.stencilMaterial=void 0;(_a=this.stencilGlobal)===null||_a===void 0?void 0:_a.reset();this._isStencilTestDirty=true;this._isStencilMaskDirty=true;this._isStencilFuncDirty=true;this._isStencilOpDirty=true;}},{key:"apply",value:function apply(gl){var _a;if(!gl){return;}var stencilMaterialEnabled=!this.useStencilGlobalOnly&&!!((_a=this.stencilMaterial)===null||_a===void 0?void 0:_a.enabled);this.enabled=stencilMaterialEnabled?this.stencilMaterial.enabled:this.stencilGlobal.enabled;this.func=stencilMaterialEnabled?this.stencilMaterial.func:this.stencilGlobal.func;this.funcRef=stencilMaterialEnabled?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef;this.funcMask=stencilMaterialEnabled?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask;this.opStencilFail=stencilMaterialEnabled?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail;this.opDepthFail=stencilMaterialEnabled?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail;this.opStencilDepthPass=stencilMaterialEnabled?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass;this.mask=stencilMaterialEnabled?this.stencilMaterial.mask:this.stencilGlobal.mask;if(!this.isDirty){return;}if(this._isStencilTestDirty){if(this.enabled){gl.enable(gl.STENCIL_TEST);}else{gl.disable(gl.STENCIL_TEST);}this._isStencilTestDirty=false;}if(this._isStencilMaskDirty){gl.stencilMask(this.mask);this._isStencilMaskDirty=false;}if(this._isStencilFuncDirty){gl.stencilFunc(this.func,this.funcRef,this.funcMask);this._isStencilFuncDirty=false;}if(this._isStencilOpDirty){gl.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass);this._isStencilOpDirty=false;}}}]);return StencilStateComposer;}();// node_modules/@babylonjs/core/Engines/thinEngine.js
var BufferPointer=/*#__PURE__*/_createClass(function BufferPointer(){_classCallCheck(this,BufferPointer);});var ThinEngine=/*#__PURE__*/function(){function ThinEngine(canvasOrContext,antialias,options,adaptToDeviceRatio){var _this21=this;_classCallCheck(this,ThinEngine);var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l;this._name="WebGL";this.forcePOTTextures=false;this.isFullscreen=false;this.cullBackFaces=null;this.renderEvenInBackground=true;this.preventCacheWipeBetweenFrames=false;this.validateShaderPrograms=false;this._useReverseDepthBuffer=false;this.isNDCHalfZRange=false;this.hasOriginBottomLeft=true;this.disableUniformBuffers=false;this.onDisposeObservable=new Observable();this._frameId=0;this._uniformBuffers=new Array();this._storageBuffers=new Array();this._webGLVersion=1;this._windowIsBackground=false;this._highPrecisionShadersAllowed=true;this._badOS=false;this._badDesktopOS=false;this._renderingQueueLaunched=false;this._activeRenderLoops=new Array();this.onContextLostObservable=new Observable();this.onContextRestoredObservable=new Observable();this._contextWasLost=false;this._doNotHandleContextLost=false;this.disableVertexArrayObjects=false;this._colorWrite=true;this._colorWriteChanged=true;this._depthCullingState=new DepthCullingState();this._stencilStateComposer=new StencilStateComposer();this._stencilState=new StencilState();this._alphaState=new AlphaState();this._alphaMode=1;this._alphaEquation=0;this._internalTexturesCache=new Array();this._renderTargetWrapperCache=new Array();this._activeChannel=0;this._currentTextureChannel=-1;this._boundTexturesCache={};this._compiledEffects={};this._vertexAttribArraysEnabled=[];this._uintIndicesCurrentlySet=false;this._currentBoundBuffer=new Array();this._currentFramebuffer=null;this._dummyFramebuffer=null;this._currentBufferPointers=new Array();this._currentInstanceLocations=new Array();this._currentInstanceBuffers=new Array();this._vaoRecordInProgress=false;this._mustWipeVertexAttributes=false;this._nextFreeTextureSlots=new Array();this._maxSimultaneousTextures=0;this._maxMSAASamplesOverride=null;this._activeRequests=new Array();this.adaptToDeviceRatio=false;this._lastDevicePixelRatio=1;this._transformTextureUrl=null;this.hostInformation={isMobile:false};this.premultipliedAlpha=true;this.onBeforeTextureInitObservable=new Observable();this._isWebGPU=false;this._snapshotRenderingMode=0;this._useExactSrgbConversions=false;this._viewportCached={x:0,y:0,z:0,w:0};this._unpackFlipYCached=null;this.enableUnpackFlipYCached=true;this._boundUniforms={};this.startTime=PrecisionDate.Now;var canvas=null;options=options||{};this._creationOptions=options;this.adaptToDeviceRatio=adaptToDeviceRatio!==null&&adaptToDeviceRatio!==void 0?adaptToDeviceRatio:false;this._stencilStateComposer.stencilGlobal=this._stencilState;PerformanceConfigurator.SetMatrixPrecision(!!options.useHighPrecisionMatrix);options.antialias=antialias!==null&&antialias!==void 0?antialias:options.antialias;options.deterministicLockstep=(_a=options.deterministicLockstep)!==null&&_a!==void 0?_a:false;options.lockstepMaxSteps=(_b=options.lockstepMaxSteps)!==null&&_b!==void 0?_b:4;options.timeStep=(_c=options.timeStep)!==null&&_c!==void 0?_c:1/60;options.audioEngine=(_d=options.audioEngine)!==null&&_d!==void 0?_d:true;options.stencil=(_e=options.stencil)!==null&&_e!==void 0?_e:true;this._audioContext=(_g=(_f=options.audioEngineOptions)===null||_f===void 0?void 0:_f.audioContext)!==null&&_g!==void 0?_g:null;this._audioDestination=(_j=(_h=options.audioEngineOptions)===null||_h===void 0?void 0:_h.audioDestination)!==null&&_j!==void 0?_j:null;this.premultipliedAlpha=(_k=options.premultipliedAlpha)!==null&&_k!==void 0?_k:true;this._useExactSrgbConversions=(_l=options.useExactSrgbConversions)!==null&&_l!==void 0?_l:false;this._doNotHandleContextLost=!!options.doNotHandleContextLost;this._isStencilEnable=options.stencil?true:false;adaptToDeviceRatio=adaptToDeviceRatio||options.adaptToDeviceRatio||false;var devicePixelRatio=IsWindowObjectExist()?window.devicePixelRatio||1:1;var limitDeviceRatio=options.limitDeviceRatio||devicePixelRatio;this._hardwareScalingLevel=adaptToDeviceRatio?1/Math.min(limitDeviceRatio,devicePixelRatio):1;this._lastDevicePixelRatio=devicePixelRatio;if(!canvasOrContext){return;}if(canvasOrContext.getContext){canvas=canvasOrContext;this._renderingCanvas=canvas;if(options.preserveDrawingBuffer===void 0){options.preserveDrawingBuffer=false;}if(options.xrCompatible===void 0){options.xrCompatible=true;}if(navigator&&navigator.userAgent){this._setupMobileChecks();var ua=navigator.userAgent;var _iterator12=_createForOfIteratorHelper(ThinEngine.ExceptionList),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var exception=_step12.value;var key=exception.key;var targets=exception.targets;var check=new RegExp(key);if(check.test(ua)){if(exception.capture&&exception.captureConstraint){var capture=exception.capture;var constraint=exception.captureConstraint;var regex=new RegExp(capture);var matches=regex.exec(ua);if(matches&&matches.length>0){var capturedValue=parseInt(matches[matches.length-1]);if(capturedValue>=constraint){continue;}}}var _iterator13=_createForOfIteratorHelper(targets),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var target=_step13.value;switch(target){case"uniformBuffer":this.disableUniformBuffers=true;break;case"vao":this.disableVertexArrayObjects=true;break;case"antialias":options.antialias=false;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1;break;}}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}}}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}}if(!this._doNotHandleContextLost){this._onContextLost=function(evt){evt.preventDefault();_this21._contextWasLost=true;Logger.Warn("WebGL context lost.");_this21.onContextLostObservable.notifyObservers(_this21);};this._onContextRestored=function(){_this21._restoreEngineAfterContextLost(_this21._initGLContext.bind(_this21));};canvas.addEventListener("webglcontextlost",this._onContextLost,false);canvas.addEventListener("webglcontextrestored",this._onContextRestored,false);options.powerPreference="high-performance";}this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);if(this._badDesktopOS){options.xrCompatible=false;}if(!options.disableWebGL2Support){try{this._gl=canvas.getContext("webgl2",options)||canvas.getContext("experimental-webgl2",options);if(this._gl){this._webGLVersion=2;this._shaderPlatformName="WEBGL2";if(!this._gl.deleteQuery){this._webGLVersion=1;this._shaderPlatformName="WEBGL1";}}}catch(e){}}if(!this._gl){if(!canvas){throw new Error("The provided canvas is null or undefined.");}try{this._gl=canvas.getContext("webgl",options)||canvas.getContext("experimental-webgl",options);}catch(e){throw new Error("WebGL not supported");}}if(!this._gl){throw new Error("WebGL not supported");}}else{this._gl=canvasOrContext;this._renderingCanvas=this._gl.canvas;if(this._gl.renderbufferStorageMultisample){this._webGLVersion=2;this._shaderPlatformName="WEBGL2";}else{this._shaderPlatformName="WEBGL1";}var attributes=this._gl.getContextAttributes();if(attributes){options.stencil=attributes.stencil;}}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE);if(options.useHighPrecisionFloats!==void 0){this._highPrecisionShadersAllowed=options.useHighPrecisionFloats;}this.resize();this._initGLContext();this._initFeatures();for(var i=0;i<this._caps.maxVertexAttribs;i++){this._currentBufferPointers[i]=new BufferPointer();}this._shaderProcessor=this.webGLVersion>1?new WebGL2ShaderProcessor():new WebGLShaderProcessor();this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var versionToLog="Babylon.js v".concat(ThinEngine.Version);console.log(versionToLog+" - ".concat(this.description));if(this._renderingCanvas&&this._renderingCanvas.setAttribute){this._renderingCanvas.setAttribute("data-engine",versionToLog);}}_createClass(ThinEngine,[{key:"description",get:function get(){var description=this.name+this.webGLVersion;if(this._caps.parallelShaderCompile){description+=" - Parallel shader compilation";}return description;}},{key:"name",get:function get(){return this._name;},set:function set(value){this._name=value;}},{key:"version",get:function get(){return this._webGLVersion;}},{key:"_getShaderProcessor",value:function _getShaderProcessor(shaderLanguage){return this._shaderProcessor;}},{key:"useReverseDepthBuffer",get:function get(){return this._useReverseDepthBuffer;},set:function set(useReverse){if(useReverse===this._useReverseDepthBuffer){return;}this._useReverseDepthBuffer=useReverse;if(useReverse){this._depthCullingState.depthFunc=518;}else{this._depthCullingState.depthFunc=515;}}},{key:"frameId",get:function get(){return this._frameId;}},{key:"supportsUniformBuffers",get:function get(){return this.webGLVersion>1&&!this.disableUniformBuffers;}},{key:"getCreationOptions",value:function getCreationOptions(){return this._creationOptions;}},{key:"_shouldUseHighPrecisionShader",get:function get(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed);}},{key:"needPOTTextures",get:function get(){return this._webGLVersion<2||this.forcePOTTextures;}},{key:"activeRenderLoops",get:function get(){return this._activeRenderLoops;}},{key:"doNotHandleContextLost",get:function get(){return this._doNotHandleContextLost;},set:function set(value){this._doNotHandleContextLost=value;}},{key:"_supportsHardwareTextureRescaling",get:function get(){return false;}},{key:"framebufferDimensionsObject",set:function set(dimensions){this._framebufferDimensionsObject=dimensions;}},{key:"currentViewport",get:function get(){return this._cachedViewport;}},{key:"emptyTexture",get:function get(){if(!this._emptyTexture){this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,false,false,1);}return this._emptyTexture;}},{key:"emptyTexture3D",get:function get(){if(!this._emptyTexture3D){this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,false,false,1);}return this._emptyTexture3D;}},{key:"emptyTexture2DArray",get:function get(){if(!this._emptyTexture2DArray){this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,false,false,1);}return this._emptyTexture2DArray;}},{key:"emptyCubeTexture",get:function get(){if(!this._emptyCubeTexture){var faceData=new Uint8Array(4);var cubeData=[faceData,faceData,faceData,faceData,faceData,faceData];this._emptyCubeTexture=this.createRawCubeTexture(cubeData,1,5,0,false,false,1);}return this._emptyCubeTexture;}},{key:"isWebGPU",get:function get(){return this._isWebGPU;}},{key:"shaderPlatformName",get:function get(){return this._shaderPlatformName;}},{key:"snapshotRendering",get:function get(){return false;},set:function set(activate){}},{key:"snapshotRenderingMode",get:function get(){return this._snapshotRenderingMode;},set:function set(mode){this._snapshotRenderingMode=mode;}},{key:"useExactSrgbConversions",get:function get(){return this._useExactSrgbConversions;}},{key:"snapshotRenderingReset",value:function snapshotRenderingReset(){this.snapshotRendering=false;}},{key:"createCanvas",value:function createCanvas(width,height){return ThinEngine._CreateCanvas(width,height);}},{key:"createCanvasImage",value:function createCanvasImage(){return document.createElement("img");}},{key:"_setupMobileChecks",value:function _setupMobileChecks(){var _this22=this;if(!(navigator&&navigator.userAgent)){return;}this._checkForMobile=function(){var currentUA=navigator.userAgent;_this22.hostInformation.isMobile=currentUA.indexOf("Mobile")!==-1||currentUA.indexOf("Mac")!==-1&&IsDocumentAvailable()&&"ontouchend"in document;};this._checkForMobile();if(IsWindowObjectExist()){window.addEventListener("resize",this._checkForMobile);}}},{key:"_restoreEngineAfterContextLost",value:function _restoreEngineAfterContextLost(initEngine){var _this23=this;setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _a,depthTest,depthFunc,depthMask,stencilTest;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_this23._dummyFramebuffer=null;depthTest=_this23._depthCullingState.depthTest;depthFunc=_this23._depthCullingState.depthFunc;depthMask=_this23._depthCullingState.depthMask;stencilTest=_this23._stencilState.stencilTest;_context.next=7;return initEngine();case 7:_this23.wipeCaches(true);_this23._rebuildEffects();(_a=_this23._rebuildComputeEffects)===null||_a===void 0?void 0:_a.call(_this23);_this23._rebuildBuffers();_this23._rebuildInternalTextures();_this23._rebuildRenderTargetWrappers();_this23.wipeCaches(true);_this23._depthCullingState.depthTest=depthTest;_this23._depthCullingState.depthFunc=depthFunc;_this23._depthCullingState.depthMask=depthMask;_this23._stencilState.stencilTest=stencilTest;Logger.Warn(_this23.name+" context successfully restored.");_this23.onContextRestoredObservable.notifyObservers(_this23);_this23._contextWasLost=false;case 21:case"end":return _context.stop();}},_callee);})),0);}},{key:"_sharedInit",value:function _sharedInit(canvas){this._renderingCanvas=canvas;}},{key:"_getShaderProcessingContext",value:function _getShaderProcessingContext(shaderLanguage){return null;}},{key:"_rebuildInternalTextures",value:function _rebuildInternalTextures(){var currentState=this._internalTexturesCache.slice();var _iterator14=_createForOfIteratorHelper(currentState),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var internalTexture=_step14.value;internalTexture._rebuild();}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}}},{key:"_rebuildRenderTargetWrappers",value:function _rebuildRenderTargetWrappers(){var currentState=this._renderTargetWrapperCache.slice();var _iterator15=_createForOfIteratorHelper(currentState),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var renderTargetWrapper=_step15.value;renderTargetWrapper._rebuild();}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}}},{key:"_rebuildEffects",value:function _rebuildEffects(){for(var key in this._compiledEffects){var effect=this._compiledEffects[key];effect._pipelineContext=null;effect._wasPreviouslyReady=false;effect._prepareEffect();}Effect.ResetCache();}},{key:"areAllEffectsReady",value:function areAllEffectsReady(){for(var key in this._compiledEffects){var effect=this._compiledEffects[key];if(!effect.isReady()){return false;}}return true;}},{key:"_rebuildBuffers",value:function _rebuildBuffers(){var _iterator16=_createForOfIteratorHelper(this._uniformBuffers),_step16;try{for(_iterator16.s();!(_step16=_iterator16.n()).done;){var uniformBuffer=_step16.value;uniformBuffer._rebuild();}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}var _iterator17=_createForOfIteratorHelper(this._storageBuffers),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var storageBuffer=_step17.value;storageBuffer._rebuild();}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}}},{key:"_initGLContext",value:function _initGLContext(){var _a;this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:false,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:false,drawBuffersExtension:false,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:this._webGLVersion>1||this._gl.getExtension("OES_texture_float")?true:false,textureHalfFloat:this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")?true:false,textureHalfFloatRender:false,textureFloatLinearFiltering:false,textureFloatRender:false,textureHalfFloatLinearFiltering:false,vertexArrayObject:false,instancedArrays:false,textureLOD:this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")?true:false,blendMinMax:false,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:false,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:false,supportSRGBBuffers:false,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128};this._glVersion=this._gl.getParameter(this._gl.VERSION);var rendererInfo=this._gl.getExtension("WEBGL_debug_renderer_info");if(rendererInfo!=null){this._glRenderer=this._gl.getParameter(rendererInfo.UNMASKED_RENDERER_WEBGL);this._glVendor=this._gl.getParameter(rendererInfo.UNMASKED_VENDOR_WEBGL);}if(!this._glVendor){this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor";}if(!this._glRenderer){this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer";}if(this._gl.HALF_FLOAT_OES!==36193){this._gl.HALF_FLOAT_OES=36193;}if(this._gl.RGBA16F!==34842){this._gl.RGBA16F=34842;}if(this._gl.RGBA32F!==34836){this._gl.RGBA32F=34836;}if(this._gl.DEPTH24_STENCIL8!==35056){this._gl.DEPTH24_STENCIL8=35056;}if(this._caps.timerQuery){if(this._webGLVersion===1){this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery);}this._caps.canUseTimestampForTimerQuery=((_a=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT))!==null&&_a!==void 0?_a:0)>0;}this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;this._caps.textureFloatLinearFiltering=this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")?true:false;this._caps.textureFloatRender=this._caps.textureFloat&&this._canRenderToFloatFramebuffer()?true:false;this._caps.textureHalfFloatLinearFiltering=this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")?true:false;if(this._caps.astc){this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;}if(this._caps.bptc){this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;}if(this._caps.s3tc_srgb){this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT;this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;}if(this._caps.etc2){this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2;this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;}if(this._webGLVersion>1){if(this._gl.HALF_FLOAT_OES!==5131){this._gl.HALF_FLOAT_OES=5131;}}this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer();if(this._webGLVersion>1){this._caps.drawBuffersExtension=true;this._caps.maxMSAASamples=this._maxMSAASamplesOverride!==null?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);}else{var drawBuffersExtension=this._gl.getExtension("WEBGL_draw_buffers");if(drawBuffersExtension!==null){this._caps.drawBuffersExtension=true;this._gl.drawBuffers=drawBuffersExtension.drawBuffersWEBGL.bind(drawBuffersExtension);this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var i=0;i<16;i++){this._gl["COLOR_ATTACHMENT"+i+"_WEBGL"]=drawBuffersExtension["COLOR_ATTACHMENT"+i+"_WEBGL"];}}}if(this._webGLVersion>1){this._caps.depthTextureExtension=true;}else{var depthTextureExtension=this._gl.getExtension("WEBGL_depth_texture");if(depthTextureExtension!=null){this._caps.depthTextureExtension=true;this._gl.UNSIGNED_INT_24_8=depthTextureExtension.UNSIGNED_INT_24_8_WEBGL;}}if(this.disableVertexArrayObjects){this._caps.vertexArrayObject=false;}else if(this._webGLVersion>1){this._caps.vertexArrayObject=true;}else{var vertexArrayObjectExtension=this._gl.getExtension("OES_vertex_array_object");if(vertexArrayObjectExtension!=null){this._caps.vertexArrayObject=true;this._gl.createVertexArray=vertexArrayObjectExtension.createVertexArrayOES.bind(vertexArrayObjectExtension);this._gl.bindVertexArray=vertexArrayObjectExtension.bindVertexArrayOES.bind(vertexArrayObjectExtension);this._gl.deleteVertexArray=vertexArrayObjectExtension.deleteVertexArrayOES.bind(vertexArrayObjectExtension);}}if(this._webGLVersion>1){this._caps.instancedArrays=true;}else{var instanceExtension=this._gl.getExtension("ANGLE_instanced_arrays");if(instanceExtension!=null){this._caps.instancedArrays=true;this._gl.drawArraysInstanced=instanceExtension.drawArraysInstancedANGLE.bind(instanceExtension);this._gl.drawElementsInstanced=instanceExtension.drawElementsInstancedANGLE.bind(instanceExtension);this._gl.vertexAttribDivisor=instanceExtension.vertexAttribDivisorANGLE.bind(instanceExtension);}else{this._caps.instancedArrays=false;}}if(this._gl.getShaderPrecisionFormat){var vertexhighp=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT);var fragmenthighp=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);if(vertexhighp&&fragmenthighp){this._caps.highPrecisionShaderSupported=vertexhighp.precision!==0&&fragmenthighp.precision!==0;}}if(this._webGLVersion>1){this._caps.blendMinMax=true;}else{var blendMinMaxExtension=this._gl.getExtension("EXT_blend_minmax");if(blendMinMaxExtension!=null){this._caps.blendMinMax=true;this._gl.MAX=blendMinMaxExtension.MAX_EXT;this._gl.MIN=blendMinMaxExtension.MIN_EXT;}}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1){this._caps.supportSRGBBuffers=true;}else{var sRGBExtension=this._gl.getExtension("EXT_sRGB");if(sRGBExtension!=null){this._caps.supportSRGBBuffers=true;this._gl.SRGB=sRGBExtension.SRGB_EXT;this._gl.SRGB8=sRGBExtension.SRGB_ALPHA_EXT;this._gl.SRGB8_ALPHA8=sRGBExtension.SRGB_ALPHA_EXT;}}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!!(this._creationOptions&&this._creationOptions.forceSRGBBufferSupportState);}this._depthCullingState.depthTest=true;this._depthCullingState.depthFunc=this._gl.LEQUAL;this._depthCullingState.depthMask=true;this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var slot=0;slot<this._maxSimultaneousTextures;slot++){this._nextFreeTextureSlots.push(slot);}}},{key:"_initFeatures",value:function _initFeatures(){this._features={forceBitmapOverHTMLImageElement:false,supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:false,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:false,checkUbosContentBeforeUpload:false,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:true,needsInvertingBitmap:true,useUBOBindingCache:true,needShaderCodeInlining:false,needToAlwaysBindUniformBuffers:false,supportRenderPasses:false,supportSpriteInstancing:true,_collectUbosUpdatedInFrame:false};}},{key:"webGLVersion",get:function get(){return this._webGLVersion;}},{key:"getClassName",value:function getClassName(){return"ThinEngine";}},{key:"isStencilEnable",get:function get(){return this._isStencilEnable;}},{key:"_prepareWorkingCanvas",value:function _prepareWorkingCanvas(){if(this._workingCanvas){return;}this._workingCanvas=this.createCanvas(1,1);var context=this._workingCanvas.getContext("2d");if(context){this._workingContext=context;}}},{key:"resetTextureCache",value:function resetTextureCache(){for(var key in this._boundTexturesCache){if(!Object.prototype.hasOwnProperty.call(this._boundTexturesCache,key)){continue;}this._boundTexturesCache[key]=null;}this._currentTextureChannel=-1;}},{key:"getInfo",value:function getInfo(){return this.getGlInfo();}},{key:"getGlInfo",value:function getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion};}},{key:"setHardwareScalingLevel",value:function setHardwareScalingLevel(level){this._hardwareScalingLevel=level;this.resize();}},{key:"getHardwareScalingLevel",value:function getHardwareScalingLevel(){return this._hardwareScalingLevel;}},{key:"getLoadedTexturesCache",value:function getLoadedTexturesCache(){return this._internalTexturesCache;}},{key:"getCaps",value:function getCaps(){return this._caps;}},{key:"stopRenderLoop",value:function stopRenderLoop(renderFunction){if(!renderFunction){this._activeRenderLoops=[];return;}var index=this._activeRenderLoops.indexOf(renderFunction);if(index>=0){this._activeRenderLoops.splice(index,1);}}},{key:"_renderLoop",value:function _renderLoop(){if(!this._contextWasLost){var shouldRender=true;if(!this.renderEvenInBackground&&this._windowIsBackground){shouldRender=false;}if(shouldRender){this.beginFrame();for(var index=0;index<this._activeRenderLoops.length;index++){var renderFunction=this._activeRenderLoops[index];renderFunction();}this.endFrame();}}if(this._activeRenderLoops.length>0){this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow());}else{this._renderingQueueLaunched=false;}}},{key:"getRenderingCanvas",value:function getRenderingCanvas(){return this._renderingCanvas;}},{key:"getAudioContext",value:function getAudioContext(){return this._audioContext;}},{key:"getAudioDestination",value:function getAudioDestination(){return this._audioDestination;}},{key:"getHostWindow",value:function getHostWindow(){if(!IsWindowObjectExist()){return null;}if(this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView){return this._renderingCanvas.ownerDocument.defaultView;}return window;}},{key:"getRenderWidth",value:function getRenderWidth(){var useScreen=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!useScreen&&this._currentRenderTarget){return this._currentRenderTarget.width;}return this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth;}},{key:"getRenderHeight",value:function getRenderHeight(){var useScreen=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!useScreen&&this._currentRenderTarget){return this._currentRenderTarget.height;}return this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight;}},{key:"_queueNewFrame",value:function _queueNewFrame(bindedRenderFunction,requester){return ThinEngine.QueueNewFrame(bindedRenderFunction,requester);}},{key:"runRenderLoop",value:function runRenderLoop(renderFunction){if(this._activeRenderLoops.indexOf(renderFunction)!==-1){return;}this._activeRenderLoops.push(renderFunction);if(!this._renderingQueueLaunched){this._renderingQueueLaunched=true;this._boundRenderFunction=this._renderLoop.bind(this);this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow());}}},{key:"clear",value:function clear(color,backBuffer,depth){var stencil=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var useStencilGlobalOnly=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=true;this.applyStates();this.stencilStateComposer.useStencilGlobalOnly=useStencilGlobalOnly;var mode=0;if(backBuffer&&color){this._gl.clearColor(color.r,color.g,color.b,color.a!==void 0?color.a:1);mode|=this._gl.COLOR_BUFFER_BIT;}if(depth){if(this.useReverseDepthBuffer){this._depthCullingState.depthFunc=this._gl.GEQUAL;this._gl.clearDepth(0);}else{this._gl.clearDepth(1);}mode|=this._gl.DEPTH_BUFFER_BIT;}if(stencil){this._gl.clearStencil(0);mode|=this._gl.STENCIL_BUFFER_BIT;}this._gl.clear(mode);}},{key:"_viewport",value:function _viewport(x,y,width,height){if(x!==this._viewportCached.x||y!==this._viewportCached.y||width!==this._viewportCached.z||height!==this._viewportCached.w){this._viewportCached.x=x;this._viewportCached.y=y;this._viewportCached.z=width;this._viewportCached.w=height;this._gl.viewport(x,y,width,height);}}},{key:"setViewport",value:function setViewport(viewport,requiredWidth,requiredHeight){var width=requiredWidth||this.getRenderWidth();var height=requiredHeight||this.getRenderHeight();var x=viewport.x||0;var y=viewport.y||0;this._cachedViewport=viewport;this._viewport(x*width,y*height,width*viewport.width,height*viewport.height);}},{key:"beginFrame",value:function beginFrame(){}},{key:"endFrame",value:function endFrame(){if(this._badOS){this.flushFramebuffer();}this._frameId++;}},{key:"resize",value:function resize(){var forceSetSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var width;var height;if(this.adaptToDeviceRatio){var devicePixelRatio=IsWindowObjectExist()?window.devicePixelRatio||1:1;var changeRatio=this._lastDevicePixelRatio/devicePixelRatio;this._lastDevicePixelRatio=devicePixelRatio;this._hardwareScalingLevel*=changeRatio;}if(IsWindowObjectExist()){width=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth;height=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight;}else{width=this._renderingCanvas?this._renderingCanvas.width:100;height=this._renderingCanvas?this._renderingCanvas.height:100;}this.setSize(width/this._hardwareScalingLevel,height/this._hardwareScalingLevel,forceSetSize);}},{key:"setSize",value:function setSize(width,height){var forceSetSize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._renderingCanvas){return false;}width=width|0;height=height|0;if(!forceSetSize&&this._renderingCanvas.width===width&&this._renderingCanvas.height===height){return false;}this._renderingCanvas.width=width;this._renderingCanvas.height=height;return true;}},{key:"bindFramebuffer",value:function bindFramebuffer(texture){var faceIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var requiredWidth=arguments.length>2?arguments[2]:undefined;var requiredHeight=arguments.length>3?arguments[3]:undefined;var forceFullscreenViewport=arguments.length>4?arguments[4]:undefined;var lodLevel=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var layer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var _a,_b,_c,_d,_e;var webglRTWrapper=texture;if(this._currentRenderTarget){this.unBindFramebuffer(this._currentRenderTarget);}this._currentRenderTarget=texture;this._bindUnboundFramebuffer(webglRTWrapper._MSAAFramebuffer?webglRTWrapper._MSAAFramebuffer:webglRTWrapper._framebuffer);var gl=this._gl;if(texture.is2DArray){gl.framebufferTextureLayer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,(_a=texture.texture._hardwareTexture)===null||_a===void 0?void 0:_a.underlyingResource,lodLevel,layer);}else if(texture.isCube){gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,(_b=texture.texture._hardwareTexture)===null||_b===void 0?void 0:_b.underlyingResource,lodLevel);}var depthStencilTexture=texture._depthStencilTexture;if(depthStencilTexture){var attachment=texture._depthStencilTextureWithStencil?gl.DEPTH_STENCIL_ATTACHMENT:gl.DEPTH_ATTACHMENT;if(texture.is2DArray){gl.framebufferTextureLayer(gl.FRAMEBUFFER,attachment,(_c=depthStencilTexture._hardwareTexture)===null||_c===void 0?void 0:_c.underlyingResource,lodLevel,layer);}else if(texture.isCube){gl.framebufferTexture2D(gl.FRAMEBUFFER,attachment,gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,(_d=depthStencilTexture._hardwareTexture)===null||_d===void 0?void 0:_d.underlyingResource,lodLevel);}else{gl.framebufferTexture2D(gl.FRAMEBUFFER,attachment,gl.TEXTURE_2D,(_e=depthStencilTexture._hardwareTexture)===null||_e===void 0?void 0:_e.underlyingResource,lodLevel);}}if(this._cachedViewport&&!forceFullscreenViewport){this.setViewport(this._cachedViewport,requiredWidth,requiredHeight);}else{if(!requiredWidth){requiredWidth=texture.width;if(lodLevel){requiredWidth=requiredWidth/Math.pow(2,lodLevel);}}if(!requiredHeight){requiredHeight=texture.height;if(lodLevel){requiredHeight=requiredHeight/Math.pow(2,lodLevel);}}this._viewport(0,0,requiredWidth,requiredHeight);}this.wipeCaches();}},{key:"setState",value:function setState(culling){var zOffset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2?arguments[2]:undefined;var reverseSide=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var cullBackFaces=arguments.length>4?arguments[4]:undefined;var stencil=arguments.length>5?arguments[5]:undefined;var zOffsetUnits=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var _a,_b;if(this._depthCullingState.cull!==culling||force){this._depthCullingState.cull=culling;}var cullFace=((_b=(_a=this.cullBackFaces)!==null&&_a!==void 0?_a:cullBackFaces)!==null&&_b!==void 0?_b:true)?this._gl.BACK:this._gl.FRONT;if(this._depthCullingState.cullFace!==cullFace||force){this._depthCullingState.cullFace=cullFace;}this.setZOffset(zOffset);this.setZOffsetUnits(zOffsetUnits);var frontFace=reverseSide?this._gl.CW:this._gl.CCW;if(this._depthCullingState.frontFace!==frontFace||force){this._depthCullingState.frontFace=frontFace;}this._stencilStateComposer.stencilMaterial=stencil;}},{key:"getDepthBuffer",value:function getDepthBuffer(){return this._depthCullingState.depthTest;}},{key:"setDepthBuffer",value:function setDepthBuffer(enable){this._depthCullingState.depthTest=enable;}},{key:"setZOffset",value:function setZOffset(value){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-value:value;}},{key:"getZOffset",value:function getZOffset(){var zOffset=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-zOffset:zOffset;}},{key:"setZOffsetUnits",value:function setZOffsetUnits(value){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-value:value;}},{key:"getZOffsetUnits",value:function getZOffsetUnits(){var zOffsetUnits=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-zOffsetUnits:zOffsetUnits;}},{key:"_bindUnboundFramebuffer",value:function _bindUnboundFramebuffer(framebuffer){if(this._currentFramebuffer!==framebuffer){this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,framebuffer);this._currentFramebuffer=framebuffer;}}},{key:"_currentFrameBufferIsDefaultFrameBuffer",value:function _currentFrameBufferIsDefaultFrameBuffer(){return this._currentFramebuffer===null;}},{key:"generateMipmaps",value:function generateMipmaps(texture){this._bindTextureDirectly(this._gl.TEXTURE_2D,texture,true);this._gl.generateMipmap(this._gl.TEXTURE_2D);this._bindTextureDirectly(this._gl.TEXTURE_2D,null);}},{key:"unBindFramebuffer",value:function unBindFramebuffer(texture){var disableGenerateMipMaps=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var onBeforeUnbind=arguments.length>2?arguments[2]:undefined;var _a;var webglRTWrapper=texture;this._currentRenderTarget=null;var gl=this._gl;if(webglRTWrapper._MSAAFramebuffer){if(texture.isMulti){this.unBindMultiColorAttachmentFramebuffer(texture,disableGenerateMipMaps,onBeforeUnbind);return;}gl.bindFramebuffer(gl.READ_FRAMEBUFFER,webglRTWrapper._MSAAFramebuffer);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,webglRTWrapper._framebuffer);gl.blitFramebuffer(0,0,texture.width,texture.height,0,0,texture.width,texture.height,gl.COLOR_BUFFER_BIT,gl.NEAREST);}if(((_a=texture.texture)===null||_a===void 0?void 0:_a.generateMipMaps)&&!disableGenerateMipMaps&&!texture.isCube){this.generateMipmaps(texture.texture);}if(onBeforeUnbind){if(webglRTWrapper._MSAAFramebuffer){this._bindUnboundFramebuffer(webglRTWrapper._framebuffer);}onBeforeUnbind();}this._bindUnboundFramebuffer(null);}},{key:"flushFramebuffer",value:function flushFramebuffer(){this._gl.flush();}},{key:"restoreDefaultFramebuffer",value:function restoreDefaultFramebuffer(){if(this._currentRenderTarget){this.unBindFramebuffer(this._currentRenderTarget);}else{this._bindUnboundFramebuffer(null);}if(this._cachedViewport){this.setViewport(this._cachedViewport);}this.wipeCaches();}},{key:"_resetVertexBufferBinding",value:function _resetVertexBufferBinding(){this.bindArrayBuffer(null);this._cachedVertexBuffers=null;}},{key:"createVertexBuffer",value:function createVertexBuffer(data){return this._createVertexBuffer(data,this._gl.STATIC_DRAW);}},{key:"_createVertexBuffer",value:function _createVertexBuffer(data,usage){var vbo=this._gl.createBuffer();if(!vbo){throw new Error("Unable to create vertex buffer");}var dataBuffer=new WebGLDataBuffer(vbo);this.bindArrayBuffer(dataBuffer);if(data instanceof Array){this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(data),usage);}else{this._gl.bufferData(this._gl.ARRAY_BUFFER,data,usage);}this._resetVertexBufferBinding();dataBuffer.references=1;return dataBuffer;}},{key:"createDynamicVertexBuffer",value:function createDynamicVertexBuffer(data){return this._createVertexBuffer(data,this._gl.DYNAMIC_DRAW);}},{key:"_resetIndexBufferBinding",value:function _resetIndexBufferBinding(){this.bindIndexBuffer(null);this._cachedIndexBuffer=null;}},{key:"createIndexBuffer",value:function createIndexBuffer(indices,updatable){var vbo=this._gl.createBuffer();var dataBuffer=new WebGLDataBuffer(vbo);if(!vbo){throw new Error("Unable to create index buffer");}this.bindIndexBuffer(dataBuffer);var data=this._normalizeIndexData(indices);this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,data,updatable?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW);this._resetIndexBufferBinding();dataBuffer.references=1;dataBuffer.is32Bits=data.BYTES_PER_ELEMENT===4;return dataBuffer;}},{key:"_normalizeIndexData",value:function _normalizeIndexData(indices){var bytesPerElement=indices.BYTES_PER_ELEMENT;if(bytesPerElement===2){return indices;}if(this._caps.uintIndices){if(indices instanceof Uint32Array){return indices;}else{for(var index=0;index<indices.length;index++){if(indices[index]>=65535){return new Uint32Array(indices);}}return new Uint16Array(indices);}}return new Uint16Array(indices);}},{key:"bindArrayBuffer",value:function bindArrayBuffer(buffer){if(!this._vaoRecordInProgress){this._unbindVertexArrayObject();}this._bindBuffer(buffer,this._gl.ARRAY_BUFFER);}},{key:"bindUniformBlock",value:function bindUniformBlock(pipelineContext,blockName,index){var program=pipelineContext.program;var uniformLocation=this._gl.getUniformBlockIndex(program,blockName);this._gl.uniformBlockBinding(program,uniformLocation,index);}},{key:"bindIndexBuffer",value:function bindIndexBuffer(buffer){if(!this._vaoRecordInProgress){this._unbindVertexArrayObject();}this._bindBuffer(buffer,this._gl.ELEMENT_ARRAY_BUFFER);}},{key:"_bindBuffer",value:function _bindBuffer(buffer,target){if(this._vaoRecordInProgress||this._currentBoundBuffer[target]!==buffer){this._gl.bindBuffer(target,buffer?buffer.underlyingResource:null);this._currentBoundBuffer[target]=buffer;}}},{key:"updateArrayBuffer",value:function updateArrayBuffer(data){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,data);}},{key:"_vertexAttribPointer",value:function _vertexAttribPointer(buffer,indx,size,type,normalized,stride,offset){var pointer=this._currentBufferPointers[indx];if(!pointer){return;}var changed=false;if(!pointer.active){changed=true;pointer.active=true;pointer.index=indx;pointer.size=size;pointer.type=type;pointer.normalized=normalized;pointer.stride=stride;pointer.offset=offset;pointer.buffer=buffer;}else{if(pointer.buffer!==buffer){pointer.buffer=buffer;changed=true;}if(pointer.size!==size){pointer.size=size;changed=true;}if(pointer.type!==type){pointer.type=type;changed=true;}if(pointer.normalized!==normalized){pointer.normalized=normalized;changed=true;}if(pointer.stride!==stride){pointer.stride=stride;changed=true;}if(pointer.offset!==offset){pointer.offset=offset;changed=true;}}if(changed||this._vaoRecordInProgress){this.bindArrayBuffer(buffer);if(type===this._gl.UNSIGNED_INT||type===this._gl.INT){this._gl.vertexAttribIPointer(indx,size,type,stride,offset);}else{this._gl.vertexAttribPointer(indx,size,type,normalized,stride,offset);}}}},{key:"_bindIndexBufferWithCache",value:function _bindIndexBufferWithCache(indexBuffer){if(indexBuffer==null){return;}if(this._cachedIndexBuffer!==indexBuffer){this._cachedIndexBuffer=indexBuffer;this.bindIndexBuffer(indexBuffer);this._uintIndicesCurrentlySet=indexBuffer.is32Bits;}}},{key:"_bindVertexBuffersAttributes",value:function _bindVertexBuffersAttributes(vertexBuffers,effect,overrideVertexBuffers){var attributes=effect.getAttributesNames();if(!this._vaoRecordInProgress){this._unbindVertexArrayObject();}this.unbindAllAttributes();for(var index=0;index<attributes.length;index++){var order=effect.getAttributeLocation(index);if(order>=0){var ai=attributes[index];var vertexBuffer=null;if(overrideVertexBuffers){vertexBuffer=overrideVertexBuffers[ai];}if(!vertexBuffer){vertexBuffer=vertexBuffers[ai];}if(!vertexBuffer){continue;}this._gl.enableVertexAttribArray(order);if(!this._vaoRecordInProgress){this._vertexAttribArraysEnabled[order]=true;}var buffer=vertexBuffer.getBuffer();if(buffer){this._vertexAttribPointer(buffer,order,vertexBuffer.getSize(),vertexBuffer.type,vertexBuffer.normalized,vertexBuffer.byteStride,vertexBuffer.byteOffset);if(vertexBuffer.getIsInstanced()){this._gl.vertexAttribDivisor(order,vertexBuffer.getInstanceDivisor());if(!this._vaoRecordInProgress){this._currentInstanceLocations.push(order);this._currentInstanceBuffers.push(buffer);}}}}}}},{key:"recordVertexArrayObject",value:function recordVertexArrayObject(vertexBuffers,indexBuffer,effect,overrideVertexBuffers){var vao=this._gl.createVertexArray();if(!vao){throw new Error("Unable to create VAO");}this._vaoRecordInProgress=true;this._gl.bindVertexArray(vao);this._mustWipeVertexAttributes=true;this._bindVertexBuffersAttributes(vertexBuffers,effect,overrideVertexBuffers);this.bindIndexBuffer(indexBuffer);this._vaoRecordInProgress=false;this._gl.bindVertexArray(null);return vao;}},{key:"bindVertexArrayObject",value:function bindVertexArrayObject(vertexArrayObject,indexBuffer){if(this._cachedVertexArrayObject!==vertexArrayObject){this._cachedVertexArrayObject=vertexArrayObject;this._gl.bindVertexArray(vertexArrayObject);this._cachedVertexBuffers=null;this._cachedIndexBuffer=null;this._uintIndicesCurrentlySet=indexBuffer!=null&&indexBuffer.is32Bits;this._mustWipeVertexAttributes=true;}}},{key:"bindBuffersDirectly",value:function bindBuffersDirectly(vertexBuffer,indexBuffer,vertexDeclaration,vertexStrideSize,effect){if(this._cachedVertexBuffers!==vertexBuffer||this._cachedEffectForVertexBuffers!==effect){this._cachedVertexBuffers=vertexBuffer;this._cachedEffectForVertexBuffers=effect;var attributesCount=effect.getAttributesCount();this._unbindVertexArrayObject();this.unbindAllAttributes();var offset=0;for(var index=0;index<attributesCount;index++){if(index<vertexDeclaration.length){var order=effect.getAttributeLocation(index);if(order>=0){this._gl.enableVertexAttribArray(order);this._vertexAttribArraysEnabled[order]=true;this._vertexAttribPointer(vertexBuffer,order,vertexDeclaration[index],this._gl.FLOAT,false,vertexStrideSize,offset);}offset+=vertexDeclaration[index]*4;}}}this._bindIndexBufferWithCache(indexBuffer);}},{key:"_unbindVertexArrayObject",value:function _unbindVertexArrayObject(){if(!this._cachedVertexArrayObject){return;}this._cachedVertexArrayObject=null;this._gl.bindVertexArray(null);}},{key:"bindBuffers",value:function bindBuffers(vertexBuffers,indexBuffer,effect,overrideVertexBuffers){if(this._cachedVertexBuffers!==vertexBuffers||this._cachedEffectForVertexBuffers!==effect){this._cachedVertexBuffers=vertexBuffers;this._cachedEffectForVertexBuffers=effect;this._bindVertexBuffersAttributes(vertexBuffers,effect,overrideVertexBuffers);}this._bindIndexBufferWithCache(indexBuffer);}},{key:"unbindInstanceAttributes",value:function unbindInstanceAttributes(){var boundBuffer;for(var i=0,ul=this._currentInstanceLocations.length;i<ul;i++){var instancesBuffer=this._currentInstanceBuffers[i];if(boundBuffer!=instancesBuffer&&instancesBuffer.references){boundBuffer=instancesBuffer;this.bindArrayBuffer(instancesBuffer);}var offsetLocation=this._currentInstanceLocations[i];this._gl.vertexAttribDivisor(offsetLocation,0);}this._currentInstanceBuffers.length=0;this._currentInstanceLocations.length=0;}},{key:"releaseVertexArrayObject",value:function releaseVertexArrayObject(vao){this._gl.deleteVertexArray(vao);}},{key:"_releaseBuffer",value:function _releaseBuffer(buffer){buffer.references--;if(buffer.references===0){this._deleteBuffer(buffer);return true;}return false;}},{key:"_deleteBuffer",value:function _deleteBuffer(buffer){this._gl.deleteBuffer(buffer.underlyingResource);}},{key:"updateAndBindInstancesBuffer",value:function updateAndBindInstancesBuffer(instancesBuffer,data,offsetLocations){this.bindArrayBuffer(instancesBuffer);if(data){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,data);}if(offsetLocations[0].index!==void 0){this.bindInstancesBuffer(instancesBuffer,offsetLocations,true);}else{for(var index=0;index<4;index++){var offsetLocation=offsetLocations[index];if(!this._vertexAttribArraysEnabled[offsetLocation]){this._gl.enableVertexAttribArray(offsetLocation);this._vertexAttribArraysEnabled[offsetLocation]=true;}this._vertexAttribPointer(instancesBuffer,offsetLocation,4,this._gl.FLOAT,false,64,index*16);this._gl.vertexAttribDivisor(offsetLocation,1);this._currentInstanceLocations.push(offsetLocation);this._currentInstanceBuffers.push(instancesBuffer);}}}},{key:"bindInstancesBuffer",value:function bindInstancesBuffer(instancesBuffer,attributesInfo){var computeStride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this.bindArrayBuffer(instancesBuffer);var stride=0;if(computeStride){for(var i=0;i<attributesInfo.length;i++){var ai=attributesInfo[i];stride+=ai.attributeSize*4;}}for(var _i3=0;_i3<attributesInfo.length;_i3++){var _ai=attributesInfo[_i3];if(_ai.index===void 0){_ai.index=this._currentEffect.getAttributeLocationByName(_ai.attributeName);}if(_ai.index<0){continue;}if(!this._vertexAttribArraysEnabled[_ai.index]){this._gl.enableVertexAttribArray(_ai.index);this._vertexAttribArraysEnabled[_ai.index]=true;}this._vertexAttribPointer(instancesBuffer,_ai.index,_ai.attributeSize,_ai.attributeType||this._gl.FLOAT,_ai.normalized||false,stride,_ai.offset);this._gl.vertexAttribDivisor(_ai.index,_ai.divisor===void 0?1:_ai.divisor);this._currentInstanceLocations.push(_ai.index);this._currentInstanceBuffers.push(instancesBuffer);}}},{key:"disableInstanceAttributeByName",value:function disableInstanceAttributeByName(name135){if(!this._currentEffect){return;}var attributeLocation=this._currentEffect.getAttributeLocationByName(name135);this.disableInstanceAttribute(attributeLocation);}},{key:"disableInstanceAttribute",value:function disableInstanceAttribute(attributeLocation){var shouldClean=false;var index;while((index=this._currentInstanceLocations.indexOf(attributeLocation))!==-1){this._currentInstanceLocations.splice(index,1);this._currentInstanceBuffers.splice(index,1);shouldClean=true;index=this._currentInstanceLocations.indexOf(attributeLocation);}if(shouldClean){this._gl.vertexAttribDivisor(attributeLocation,0);this.disableAttributeByIndex(attributeLocation);}}},{key:"disableAttributeByIndex",value:function disableAttributeByIndex(attributeLocation){this._gl.disableVertexAttribArray(attributeLocation);this._vertexAttribArraysEnabled[attributeLocation]=false;this._currentBufferPointers[attributeLocation].active=false;}},{key:"draw",value:function draw(useTriangles,indexStart,indexCount,instancesCount){this.drawElementsType(useTriangles?0:1,indexStart,indexCount,instancesCount);}},{key:"drawPointClouds",value:function drawPointClouds(verticesStart,verticesCount,instancesCount){this.drawArraysType(2,verticesStart,verticesCount,instancesCount);}},{key:"drawUnIndexed",value:function drawUnIndexed(useTriangles,verticesStart,verticesCount,instancesCount){this.drawArraysType(useTriangles?0:1,verticesStart,verticesCount,instancesCount);}},{key:"drawElementsType",value:function drawElementsType(fillMode,indexStart,indexCount,instancesCount){this.applyStates();this._reportDrawCall();var drawMode=this._drawMode(fillMode);var indexFormat=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT;var mult=this._uintIndicesCurrentlySet?4:2;if(instancesCount){this._gl.drawElementsInstanced(drawMode,indexCount,indexFormat,indexStart*mult,instancesCount);}else{this._gl.drawElements(drawMode,indexCount,indexFormat,indexStart*mult);}}},{key:"drawArraysType",value:function drawArraysType(fillMode,verticesStart,verticesCount,instancesCount){this.applyStates();this._reportDrawCall();var drawMode=this._drawMode(fillMode);if(instancesCount){this._gl.drawArraysInstanced(drawMode,verticesStart,verticesCount,instancesCount);}else{this._gl.drawArrays(drawMode,verticesStart,verticesCount);}}},{key:"_drawMode",value:function _drawMode(fillMode){switch(fillMode){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES;}}},{key:"_reportDrawCall",value:function _reportDrawCall(){}},{key:"_releaseEffect",value:function _releaseEffect(effect){if(this._compiledEffects[effect._key]){delete this._compiledEffects[effect._key];}var pipelineContext=effect.getPipelineContext();if(pipelineContext){this._deletePipelineContext(pipelineContext);}}},{key:"_deletePipelineContext",value:function _deletePipelineContext(pipelineContext){var webGLPipelineContext=pipelineContext;if(webGLPipelineContext&&webGLPipelineContext.program){webGLPipelineContext.program.__SPECTOR_rebuildProgram=null;this._gl.deleteProgram(webGLPipelineContext.program);}}},{key:"_getGlobalDefines",value:function _getGlobalDefines(defines){if(defines){if(this.isNDCHalfZRange){defines["IS_NDC_HALF_ZRANGE"]="";}else{delete defines["IS_NDC_HALF_ZRANGE"];}if(this.useReverseDepthBuffer){defines["USE_REVERSE_DEPTHBUFFER"]="";}else{delete defines["USE_REVERSE_DEPTHBUFFER"];}if(this.useExactSrgbConversions){defines["USE_EXACT_SRGB_CONVERSIONS"]="";}else{delete defines["USE_EXACT_SRGB_CONVERSIONS"];}return;}else{var s="";if(this.isNDCHalfZRange){s+="#define IS_NDC_HALF_ZRANGE";}if(this.useReverseDepthBuffer){if(s){s+="\n";}s+="#define USE_REVERSE_DEPTHBUFFER";}if(this.useExactSrgbConversions){if(s){s+="\n";}s+="#define USE_EXACT_SRGB_CONVERSIONS";}return s;}}},{key:"createEffect",value:function createEffect(baseName,attributesNamesOrOptions,uniformsNamesOrEngine,samplers,defines,fallbacks,onCompiled,onError,indexParameters){var shaderLanguage=arguments.length>9&&arguments[9]!==undefined?arguments[9]:ShaderLanguage.GLSL;var _a;var vertex=baseName.vertexElement||baseName.vertex||baseName.vertexToken||baseName.vertexSource||baseName;var fragment=baseName.fragmentElement||baseName.fragment||baseName.fragmentToken||baseName.fragmentSource||baseName;var globalDefines=this._getGlobalDefines();var fullDefines=(_a=defines!==null&&defines!==void 0?defines:attributesNamesOrOptions.defines)!==null&&_a!==void 0?_a:"";if(globalDefines){fullDefines+=globalDefines;}var name135=vertex+"+"+fragment+"@"+fullDefines;if(this._compiledEffects[name135]){var compiledEffect=this._compiledEffects[name135];if(onCompiled&&compiledEffect.isReady()){onCompiled(compiledEffect);}return compiledEffect;}var effect=new Effect(baseName,attributesNamesOrOptions,uniformsNamesOrEngine,samplers,this,defines,fallbacks,onCompiled,onError,indexParameters,name135,shaderLanguage);this._compiledEffects[name135]=effect;return effect;}},{key:"_compileShader",value:function _compileShader(source,type,defines,shaderVersion){return this._compileRawShader(ThinEngine._ConcatenateShader(source,defines,shaderVersion),type);}},{key:"_compileRawShader",value:function _compileRawShader(source,type){var gl=this._gl;var shader135=gl.createShader(type==="vertex"?gl.VERTEX_SHADER:gl.FRAGMENT_SHADER);if(!shader135){var error=gl.NO_ERROR;var tempError=gl.NO_ERROR;while((tempError=gl.getError())!==gl.NO_ERROR){error=tempError;}throw new Error("Something went wrong while creating a gl ".concat(type," shader object. gl error=").concat(error,", gl isContextLost=").concat(gl.isContextLost(),", _contextWasLost=").concat(this._contextWasLost));}gl.shaderSource(shader135,source);gl.compileShader(shader135);return shader135;}},{key:"_getShaderSource",value:function _getShaderSource(shader135){return this._gl.getShaderSource(shader135);}},{key:"createRawShaderProgram",value:function createRawShaderProgram(pipelineContext,vertexCode,fragmentCode,context){var transformFeedbackVaryings=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;context=context||this._gl;var vertexShader=this._compileRawShader(vertexCode,"vertex");var fragmentShader=this._compileRawShader(fragmentCode,"fragment");return this._createShaderProgram(pipelineContext,vertexShader,fragmentShader,context,transformFeedbackVaryings);}},{key:"createShaderProgram",value:function createShaderProgram(pipelineContext,vertexCode,fragmentCode,defines,context){var transformFeedbackVaryings=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;context=context||this._gl;var shaderVersion=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";var vertexShader=this._compileShader(vertexCode,"vertex",defines,shaderVersion);var fragmentShader=this._compileShader(fragmentCode,"fragment",defines,shaderVersion);return this._createShaderProgram(pipelineContext,vertexShader,fragmentShader,context,transformFeedbackVaryings);}},{key:"inlineShaderCode",value:function inlineShaderCode(code){return code;}},{key:"createPipelineContext",value:function createPipelineContext(shaderProcessingContext){var pipelineContext=new WebGLPipelineContext();pipelineContext.engine=this;if(this._caps.parallelShaderCompile){pipelineContext.isParallelCompiled=true;}return pipelineContext;}},{key:"createMaterialContext",value:function createMaterialContext(){return void 0;}},{key:"createDrawContext",value:function createDrawContext(){return void 0;}},{key:"_createShaderProgram",value:function _createShaderProgram(pipelineContext,vertexShader,fragmentShader,context){var transformFeedbackVaryings=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var shaderProgram=context.createProgram();pipelineContext.program=shaderProgram;if(!shaderProgram){throw new Error("Unable to create program");}context.attachShader(shaderProgram,vertexShader);context.attachShader(shaderProgram,fragmentShader);context.linkProgram(shaderProgram);pipelineContext.context=context;pipelineContext.vertexShader=vertexShader;pipelineContext.fragmentShader=fragmentShader;if(!pipelineContext.isParallelCompiled){this._finalizePipelineContext(pipelineContext);}return shaderProgram;}},{key:"_finalizePipelineContext",value:function _finalizePipelineContext(pipelineContext){var context=pipelineContext.context;var vertexShader=pipelineContext.vertexShader;var fragmentShader=pipelineContext.fragmentShader;var program=pipelineContext.program;var linked=context.getProgramParameter(program,context.LINK_STATUS);if(!linked){if(!this._gl.getShaderParameter(vertexShader,this._gl.COMPILE_STATUS)){var log=this._gl.getShaderInfoLog(vertexShader);if(log){pipelineContext.vertexCompilationError=log;throw new Error("VERTEX SHADER "+log);}}if(!this._gl.getShaderParameter(fragmentShader,this._gl.COMPILE_STATUS)){var _log=this._gl.getShaderInfoLog(fragmentShader);if(_log){pipelineContext.fragmentCompilationError=_log;throw new Error("FRAGMENT SHADER "+_log);}}var error=context.getProgramInfoLog(program);if(error){pipelineContext.programLinkError=error;throw new Error(error);}}if(this.validateShaderPrograms){context.validateProgram(program);var validated=context.getProgramParameter(program,context.VALIDATE_STATUS);if(!validated){var _error=context.getProgramInfoLog(program);if(_error){pipelineContext.programValidationError=_error;throw new Error(_error);}}}context.deleteShader(vertexShader);context.deleteShader(fragmentShader);pipelineContext.vertexShader=void 0;pipelineContext.fragmentShader=void 0;if(pipelineContext.onCompiled){pipelineContext.onCompiled();pipelineContext.onCompiled=void 0;}}},{key:"_preparePipelineContext",value:function _preparePipelineContext(pipelineContext,vertexSourceCode,fragmentSourceCode,createAsRaw,rawVertexSourceCode,rawFragmentSourceCode,rebuildRebind,defines,transformFeedbackVaryings,key){var webGLRenderingState=pipelineContext;if(createAsRaw){webGLRenderingState.program=this.createRawShaderProgram(webGLRenderingState,vertexSourceCode,fragmentSourceCode,void 0,transformFeedbackVaryings);}else{webGLRenderingState.program=this.createShaderProgram(webGLRenderingState,vertexSourceCode,fragmentSourceCode,defines,void 0,transformFeedbackVaryings);}webGLRenderingState.program.__SPECTOR_rebuildProgram=rebuildRebind;}},{key:"_isRenderingStateCompiled",value:function _isRenderingStateCompiled(pipelineContext){var webGLPipelineContext=pipelineContext;if(this._gl.getProgramParameter(webGLPipelineContext.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)){this._finalizePipelineContext(webGLPipelineContext);return true;}return false;}},{key:"_executeWhenRenderingStateIsCompiled",value:function _executeWhenRenderingStateIsCompiled(pipelineContext,action){var webGLPipelineContext=pipelineContext;if(!webGLPipelineContext.isParallelCompiled){action();return;}var oldHandler=webGLPipelineContext.onCompiled;if(oldHandler){webGLPipelineContext.onCompiled=function(){oldHandler();action();};}else{webGLPipelineContext.onCompiled=action;}}},{key:"getUniforms",value:function getUniforms(pipelineContext,uniformsNames){var results=new Array();var webGLPipelineContext=pipelineContext;for(var index=0;index<uniformsNames.length;index++){results.push(this._gl.getUniformLocation(webGLPipelineContext.program,uniformsNames[index]));}return results;}},{key:"getAttributes",value:function getAttributes(pipelineContext,attributesNames){var results=[];var webGLPipelineContext=pipelineContext;for(var index=0;index<attributesNames.length;index++){try{results.push(this._gl.getAttribLocation(webGLPipelineContext.program,attributesNames[index]));}catch(e){results.push(-1);}}return results;}},{key:"enableEffect",value:function enableEffect(effect){effect=effect!==null&&DrawWrapper.IsWrapper(effect)?effect.effect:effect;if(!effect||effect===this._currentEffect){return;}this._stencilStateComposer.stencilMaterial=void 0;effect=effect;this.bindSamplers(effect);this._currentEffect=effect;if(effect.onBind){effect.onBind(effect);}if(effect._onBindObservable){effect._onBindObservable.notifyObservers(effect);}}},{key:"setInt",value:function setInt(uniform,value){if(!uniform){return false;}this._gl.uniform1i(uniform,value);return true;}},{key:"setInt2",value:function setInt2(uniform,x,y){if(!uniform){return false;}this._gl.uniform2i(uniform,x,y);return true;}},{key:"setInt3",value:function setInt3(uniform,x,y,z){if(!uniform){return false;}this._gl.uniform3i(uniform,x,y,z);return true;}},{key:"setInt4",value:function setInt4(uniform,x,y,z,w){if(!uniform){return false;}this._gl.uniform4i(uniform,x,y,z,w);return true;}},{key:"setIntArray",value:function setIntArray(uniform,array){if(!uniform){return false;}this._gl.uniform1iv(uniform,array);return true;}},{key:"setIntArray2",value:function setIntArray2(uniform,array){if(!uniform||array.length%2!==0){return false;}this._gl.uniform2iv(uniform,array);return true;}},{key:"setIntArray3",value:function setIntArray3(uniform,array){if(!uniform||array.length%3!==0){return false;}this._gl.uniform3iv(uniform,array);return true;}},{key:"setIntArray4",value:function setIntArray4(uniform,array){if(!uniform||array.length%4!==0){return false;}this._gl.uniform4iv(uniform,array);return true;}},{key:"setUInt",value:function setUInt(uniform,value){if(!uniform){return false;}this._gl.uniform1ui(uniform,value);return true;}},{key:"setUInt2",value:function setUInt2(uniform,x,y){if(!uniform){return false;}this._gl.uniform2ui(uniform,x,y);return true;}},{key:"setUInt3",value:function setUInt3(uniform,x,y,z){if(!uniform){return false;}this._gl.uniform3ui(uniform,x,y,z);return true;}},{key:"setUInt4",value:function setUInt4(uniform,x,y,z,w){if(!uniform){return false;}this._gl.uniform4ui(uniform,x,y,z,w);return true;}},{key:"setUIntArray",value:function setUIntArray(uniform,array){if(!uniform){return false;}this._gl.uniform1uiv(uniform,array);return true;}},{key:"setUIntArray2",value:function setUIntArray2(uniform,array){if(!uniform||array.length%2!==0){return false;}this._gl.uniform2uiv(uniform,array);return true;}},{key:"setUIntArray3",value:function setUIntArray3(uniform,array){if(!uniform||array.length%3!==0){return false;}this._gl.uniform3uiv(uniform,array);return true;}},{key:"setUIntArray4",value:function setUIntArray4(uniform,array){if(!uniform||array.length%4!==0){return false;}this._gl.uniform4uiv(uniform,array);return true;}},{key:"setArray",value:function setArray(uniform,array){if(!uniform){return false;}if(array.length<1){return false;}this._gl.uniform1fv(uniform,array);return true;}},{key:"setArray2",value:function setArray2(uniform,array){if(!uniform||array.length%2!==0){return false;}this._gl.uniform2fv(uniform,array);return true;}},{key:"setArray3",value:function setArray3(uniform,array){if(!uniform||array.length%3!==0){return false;}this._gl.uniform3fv(uniform,array);return true;}},{key:"setArray4",value:function setArray4(uniform,array){if(!uniform||array.length%4!==0){return false;}this._gl.uniform4fv(uniform,array);return true;}},{key:"setMatrices",value:function setMatrices(uniform,matrices){if(!uniform){return false;}this._gl.uniformMatrix4fv(uniform,false,matrices);return true;}},{key:"setMatrix3x3",value:function setMatrix3x3(uniform,matrix){if(!uniform){return false;}this._gl.uniformMatrix3fv(uniform,false,matrix);return true;}},{key:"setMatrix2x2",value:function setMatrix2x2(uniform,matrix){if(!uniform){return false;}this._gl.uniformMatrix2fv(uniform,false,matrix);return true;}},{key:"setFloat",value:function setFloat(uniform,value){if(!uniform){return false;}this._gl.uniform1f(uniform,value);return true;}},{key:"setFloat2",value:function setFloat2(uniform,x,y){if(!uniform){return false;}this._gl.uniform2f(uniform,x,y);return true;}},{key:"setFloat3",value:function setFloat3(uniform,x,y,z){if(!uniform){return false;}this._gl.uniform3f(uniform,x,y,z);return true;}},{key:"setFloat4",value:function setFloat4(uniform,x,y,z,w){if(!uniform){return false;}this._gl.uniform4f(uniform,x,y,z,w);return true;}},{key:"applyStates",value:function applyStates(){this._depthCullingState.apply(this._gl);this._stencilStateComposer.apply(this._gl);this._alphaState.apply(this._gl);if(this._colorWriteChanged){this._colorWriteChanged=false;var enable=this._colorWrite;this._gl.colorMask(enable,enable,enable,enable);}}},{key:"setColorWrite",value:function setColorWrite(enable){if(enable!==this._colorWrite){this._colorWriteChanged=true;this._colorWrite=enable;}}},{key:"getColorWrite",value:function getColorWrite(){return this._colorWrite;}},{key:"depthCullingState",get:function get(){return this._depthCullingState;}},{key:"alphaState",get:function get(){return this._alphaState;}},{key:"stencilState",get:function get(){return this._stencilState;}},{key:"stencilStateComposer",get:function get(){return this._stencilStateComposer;}},{key:"clearInternalTexturesCache",value:function clearInternalTexturesCache(){this._internalTexturesCache.length=0;}},{key:"wipeCaches",value:function wipeCaches(bruteForce){if(this.preventCacheWipeBetweenFrames&&!bruteForce){return;}this._currentEffect=null;this._viewportCached.x=0;this._viewportCached.y=0;this._viewportCached.z=0;this._viewportCached.w=0;this._unbindVertexArrayObject();if(bruteForce){this._currentProgram=null;this.resetTextureCache();this._stencilStateComposer.reset();this._depthCullingState.reset();this._depthCullingState.depthFunc=this._gl.LEQUAL;this._alphaState.reset();this._alphaMode=1;this._alphaEquation=0;this._colorWrite=true;this._colorWriteChanged=true;this._unpackFlipYCached=null;this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE);this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);this._mustWipeVertexAttributes=true;this.unbindAllAttributes();}this._resetVertexBufferBinding();this._cachedIndexBuffer=null;this._cachedEffectForVertexBuffers=null;this.bindIndexBuffer(null);}},{key:"_getSamplingParameters",value:function _getSamplingParameters(samplingMode,generateMipMaps){var gl=this._gl;var magFilter=gl.NEAREST;var minFilter=gl.NEAREST;switch(samplingMode){case 11:magFilter=gl.LINEAR;if(generateMipMaps){minFilter=gl.LINEAR_MIPMAP_NEAREST;}else{minFilter=gl.LINEAR;}break;case 3:magFilter=gl.LINEAR;if(generateMipMaps){minFilter=gl.LINEAR_MIPMAP_LINEAR;}else{minFilter=gl.LINEAR;}break;case 8:magFilter=gl.NEAREST;if(generateMipMaps){minFilter=gl.NEAREST_MIPMAP_LINEAR;}else{minFilter=gl.NEAREST;}break;case 4:magFilter=gl.NEAREST;if(generateMipMaps){minFilter=gl.NEAREST_MIPMAP_NEAREST;}else{minFilter=gl.NEAREST;}break;case 5:magFilter=gl.NEAREST;if(generateMipMaps){minFilter=gl.LINEAR_MIPMAP_NEAREST;}else{minFilter=gl.LINEAR;}break;case 6:magFilter=gl.NEAREST;if(generateMipMaps){minFilter=gl.LINEAR_MIPMAP_LINEAR;}else{minFilter=gl.LINEAR;}break;case 7:magFilter=gl.NEAREST;minFilter=gl.LINEAR;break;case 1:magFilter=gl.NEAREST;minFilter=gl.NEAREST;break;case 9:magFilter=gl.LINEAR;if(generateMipMaps){minFilter=gl.NEAREST_MIPMAP_NEAREST;}else{minFilter=gl.NEAREST;}break;case 10:magFilter=gl.LINEAR;if(generateMipMaps){minFilter=gl.NEAREST_MIPMAP_LINEAR;}else{minFilter=gl.NEAREST;}break;case 2:magFilter=gl.LINEAR;minFilter=gl.LINEAR;break;case 12:magFilter=gl.LINEAR;minFilter=gl.NEAREST;break;}return{min:minFilter,mag:magFilter};}},{key:"_createTexture",value:function _createTexture(){var texture=this._gl.createTexture();if(!texture){throw new Error("Unable to create texture");}return texture;}},{key:"_createHardwareTexture",value:function _createHardwareTexture(){return new WebGLHardwareTexture(this._createTexture(),this._gl);}},{key:"_createInternalTexture",value:function _createInternalTexture(size,options){var delayGPUTextureCreation=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var source=arguments.length>3&&arguments[3]!==undefined?arguments[3]:InternalTextureSource.Unknown;var _a;var generateMipMaps=false;var type=0;var samplingMode=3;var format=5;var useSRGBBuffer=false;var samples=1;if(options!==void 0&&_typeof(options)==="object"){generateMipMaps=!!options.generateMipMaps;type=options.type===void 0?0:options.type;samplingMode=options.samplingMode===void 0?3:options.samplingMode;format=options.format===void 0?5:options.format;useSRGBBuffer=options.useSRGBBuffer===void 0?false:options.useSRGBBuffer;samples=(_a=options.samples)!==null&&_a!==void 0?_a:1;}else{generateMipMaps=!!options;}useSRGBBuffer&&(useSRGBBuffer=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU));if(type===1&&!this._caps.textureFloatLinearFiltering){samplingMode=1;}else if(type===2&&!this._caps.textureHalfFloatLinearFiltering){samplingMode=1;}if(type===1&&!this._caps.textureFloat){type=0;Logger.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE");}var gl=this._gl;var texture=new InternalTexture(this,source);var width=size.width||size;var height=size.height||size;var layers=size.layers||0;var filters2=this._getSamplingParameters(samplingMode,generateMipMaps);var target=layers!==0?gl.TEXTURE_2D_ARRAY:gl.TEXTURE_2D;var sizedFormat=this._getRGBABufferInternalSizedFormat(type,format,useSRGBBuffer);var internalFormat=this._getInternalFormat(format);var textureType=this._getWebGLTextureType(type);this._bindTextureDirectly(target,texture);if(layers!==0){texture.is2DArray=true;gl.texImage3D(target,0,sizedFormat,width,height,layers,0,internalFormat,textureType,null);}else{gl.texImage2D(target,0,sizedFormat,width,height,0,internalFormat,textureType,null);}gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,filters2.mag);gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,filters2.min);gl.texParameteri(target,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(target,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(generateMipMaps){this._gl.generateMipmap(target);}this._bindTextureDirectly(target,null);texture._useSRGBBuffer=useSRGBBuffer;texture.baseWidth=width;texture.baseHeight=height;texture.width=width;texture.height=height;texture.depth=layers;texture.isReady=true;texture.samples=samples;texture.generateMipMaps=generateMipMaps;texture.samplingMode=samplingMode;texture.type=type;texture.format=format;this._internalTexturesCache.push(texture);return texture;}},{key:"_getUseSRGBBuffer",value:function _getUseSRGBBuffer(useSRGBBuffer,noMipmap){return useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||noMipmap);}},{key:"_createTextureBase",value:function _createTextureBase(url,noMipmap,invertY,scene2){var _this24=this;var samplingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:3;var onLoad=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onError=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var prepareTexture=arguments.length>7?arguments[7]:undefined;var prepareTextureProcessFunction=arguments.length>8?arguments[8]:undefined;var buffer=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;var fallback=arguments.length>10&&arguments[10]!==undefined?arguments[10]:null;var format=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var forcedExtension=arguments.length>12&&arguments[12]!==undefined?arguments[12]:null;var mimeType=arguments.length>13?arguments[13]:undefined;var loaderOptions=arguments.length>14?arguments[14]:undefined;var useSRGBBuffer=arguments.length>15?arguments[15]:undefined;url=url||"";var fromData=url.substr(0,5)==="data:";var fromBlob=url.substr(0,5)==="blob:";var isBase64=fromData&&url.indexOf(";base64,")!==-1;var texture=fallback?fallback:new InternalTexture(this,InternalTextureSource.Url);var originalUrl=url;if(this._transformTextureUrl&&!isBase64&&!fallback&&!buffer){url=this._transformTextureUrl(url);}if(originalUrl!==url){texture._originalUrl=originalUrl;}var lastDot=url.lastIndexOf(".");var extension=forcedExtension?forcedExtension:lastDot>-1?url.substring(lastDot).toLowerCase():"";var loader=null;var queryStringIndex=extension.indexOf("?");if(queryStringIndex>-1){extension=extension.split("?")[0];}var _iterator18=_createForOfIteratorHelper(ThinEngine._TextureLoaders),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var availableLoader=_step18.value;if(availableLoader.canLoad(extension,mimeType)){loader=availableLoader;break;}}}catch(err){_iterator18.e(err);}finally{_iterator18.f();}if(scene2){scene2.addPendingData(texture);}texture.url=url;texture.generateMipMaps=!noMipmap;texture.samplingMode=samplingMode;texture.invertY=invertY;texture._useSRGBBuffer=this._getUseSRGBBuffer(!!useSRGBBuffer,noMipmap);if(!this._doNotHandleContextLost){texture._buffer=buffer;}var onLoadObserver=null;if(onLoad&&!fallback){onLoadObserver=texture.onLoadedObservable.add(onLoad);}if(!fallback){this._internalTexturesCache.push(texture);}var onInternalError=function onInternalError(message,exception){if(scene2){scene2.removePendingData(texture);}if(url===originalUrl){if(onLoadObserver){texture.onLoadedObservable.remove(onLoadObserver);}if(EngineStore.UseFallbackTexture){_this24._createTextureBase(EngineStore.FallbackTexture,noMipmap,texture.invertY,scene2,samplingMode,null,onError,prepareTexture,prepareTextureProcessFunction,buffer,texture);}message=(message||"Unknown error")+(EngineStore.UseFallbackTexture?" - Fallback texture was used":"");texture.onErrorObservable.notifyObservers({message:message,exception:exception});if(onError){onError(message,exception);}}else{Logger.Warn("Failed to load ".concat(url,", falling back to ").concat(originalUrl));_this24._createTextureBase(originalUrl,noMipmap,texture.invertY,scene2,samplingMode,onLoad,onError,prepareTexture,prepareTextureProcessFunction,buffer,texture,format,forcedExtension,mimeType,loaderOptions,useSRGBBuffer);}};if(loader){var callback=function callback(data){loader.loadData(data,texture,function(width,height,loadMipmap,isCompressed,done,loadFailed){if(loadFailed){onInternalError("TextureLoader failed to load data");}else{prepareTexture(texture,extension,scene2,{width:width,height:height},texture.invertY,!loadMipmap,isCompressed,function(){done();return false;},samplingMode);}},loaderOptions);};if(!buffer){this._loadFile(url,function(data){return callback(new Uint8Array(data));},void 0,scene2?scene2.offlineProvider:void 0,true,function(request,exception){onInternalError("Unable to load "+(request?request.responseURL:url,exception));});}else{if(buffer instanceof ArrayBuffer){callback(new Uint8Array(buffer));}else if(ArrayBuffer.isView(buffer)){callback(buffer);}else{if(onError){onError("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null);}}}}else{var onload=function onload(img){if(fromBlob&&!_this24._doNotHandleContextLost){texture._buffer=img;}prepareTexture(texture,extension,scene2,img,texture.invertY,noMipmap,false,prepareTextureProcessFunction,samplingMode);};if(!fromData||isBase64){if(buffer&&(typeof buffer.decoding==="string"||buffer.close)){onload(buffer);}else{ThinEngine._FileToolsLoadImage(url,onload,onInternalError,scene2?scene2.offlineProvider:null,mimeType,texture.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0);}}else if(typeof buffer==="string"||buffer instanceof ArrayBuffer||ArrayBuffer.isView(buffer)||buffer instanceof Blob){ThinEngine._FileToolsLoadImage(buffer,onload,onInternalError,scene2?scene2.offlineProvider:null,mimeType,texture.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0);}else if(buffer){onload(buffer);}}return texture;}},{key:"createTexture",value:function createTexture(url,noMipmap,invertY,scene2){var _this25=this;var samplingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:3;var onLoad=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onError=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var buffer=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var fallback=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var format=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;var forcedExtension=arguments.length>10&&arguments[10]!==undefined?arguments[10]:null;var mimeType=arguments.length>11?arguments[11]:undefined;var loaderOptions=arguments.length>12?arguments[12]:undefined;var creationFlags=arguments.length>13?arguments[13]:undefined;var useSRGBBuffer=arguments.length>14?arguments[14]:undefined;return this._createTextureBase(url,noMipmap,invertY,scene2,samplingMode,onLoad,onError,this._prepareWebGLTexture.bind(this),function(potWidth,potHeight,img,extension,texture,continuationCallback){var gl=_this25._gl;var isPot=img.width===potWidth&&img.height===potHeight;var internalFormat=format?_this25._getInternalFormat(format,texture._useSRGBBuffer):extension===".jpg"&&!texture._useSRGBBuffer?gl.RGB:texture._useSRGBBuffer?gl.SRGB8_ALPHA8:gl.RGBA;var texelFormat=format?_this25._getInternalFormat(format):extension===".jpg"&&!texture._useSRGBBuffer?gl.RGB:gl.RGBA;if(texture._useSRGBBuffer&&_this25.webGLVersion===1){texelFormat=internalFormat;}if(isPot){gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,texelFormat,gl.UNSIGNED_BYTE,img);return false;}var maxTextureSize=_this25._caps.maxTextureSize;if(img.width>maxTextureSize||img.height>maxTextureSize||!_this25._supportsHardwareTextureRescaling){_this25._prepareWorkingCanvas();if(!_this25._workingCanvas||!_this25._workingContext){return false;}_this25._workingCanvas.width=potWidth;_this25._workingCanvas.height=potHeight;_this25._workingContext.drawImage(img,0,0,img.width,img.height,0,0,potWidth,potHeight);gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,texelFormat,gl.UNSIGNED_BYTE,_this25._workingCanvas);texture.width=potWidth;texture.height=potHeight;return false;}else{var source=new InternalTexture(_this25,InternalTextureSource.Temp);_this25._bindTextureDirectly(gl.TEXTURE_2D,source,true);gl.texImage2D(gl.TEXTURE_2D,0,internalFormat,texelFormat,gl.UNSIGNED_BYTE,img);_this25._rescaleTexture(source,texture,scene2,internalFormat,function(){_this25._releaseTexture(source);_this25._bindTextureDirectly(gl.TEXTURE_2D,texture,true);continuationCallback();});}return true;},buffer,fallback,format,forcedExtension,mimeType,loaderOptions,useSRGBBuffer);}},{key:"_rescaleTexture",value:function _rescaleTexture(source,destination,scene2,internalFormat,onComplete){}},{key:"createRawTexture",value:function createRawTexture(data,width,height,format,generateMipMaps,invertY,samplingMode){var compression=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var type=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var creationFlags=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var useSRGBBuffer=arguments.length>10&&arguments[10]!==undefined?arguments[10]:false;throw _WarnImport("Engine.RawTexture");}},{key:"createRawCubeTexture",value:function createRawCubeTexture(data,size,format,type,generateMipMaps,invertY,samplingMode){var compression=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;throw _WarnImport("Engine.RawTexture");}},{key:"createRawTexture3D",value:function createRawTexture3D(data,width,height,depth,format,generateMipMaps,invertY,samplingMode){var compression=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var textureType=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;throw _WarnImport("Engine.RawTexture");}},{key:"createRawTexture2DArray",value:function createRawTexture2DArray(data,width,height,depth,format,generateMipMaps,invertY,samplingMode){var compression=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var textureType=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;throw _WarnImport("Engine.RawTexture");}},{key:"_unpackFlipY",value:function _unpackFlipY(value){if(this._unpackFlipYCached!==value){this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,value?1:0);if(this.enableUnpackFlipYCached){this._unpackFlipYCached=value;}}}},{key:"_getUnpackAlignement",value:function _getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT);}},{key:"_getTextureTarget",value:function _getTextureTarget(texture){if(texture.isCube){return this._gl.TEXTURE_CUBE_MAP;}else if(texture.is3D){return this._gl.TEXTURE_3D;}else if(texture.is2DArray||texture.isMultiview){return this._gl.TEXTURE_2D_ARRAY;}return this._gl.TEXTURE_2D;}},{key:"updateTextureSamplingMode",value:function updateTextureSamplingMode(samplingMode,texture){var generateMipMaps=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var target=this._getTextureTarget(texture);var filters2=this._getSamplingParameters(samplingMode,texture.generateMipMaps||generateMipMaps);this._setTextureParameterInteger(target,this._gl.TEXTURE_MAG_FILTER,filters2.mag,texture);this._setTextureParameterInteger(target,this._gl.TEXTURE_MIN_FILTER,filters2.min);if(generateMipMaps){texture.generateMipMaps=true;this._gl.generateMipmap(target);}this._bindTextureDirectly(target,null);texture.samplingMode=samplingMode;}},{key:"updateTextureDimensions",value:function updateTextureDimensions(texture,width,height){var depth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;}},{key:"updateTextureWrappingMode",value:function updateTextureWrappingMode(texture,wrapU){var wrapV=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var wrapR=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var target=this._getTextureTarget(texture);if(wrapU!==null){this._setTextureParameterInteger(target,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(wrapU),texture);texture._cachedWrapU=wrapU;}if(wrapV!==null){this._setTextureParameterInteger(target,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(wrapV),texture);texture._cachedWrapV=wrapV;}if((texture.is2DArray||texture.is3D)&&wrapR!==null){this._setTextureParameterInteger(target,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(wrapR),texture);texture._cachedWrapR=wrapR;}this._bindTextureDirectly(target,null);}},{key:"_setupDepthStencilTexture",value:function _setupDepthStencilTexture(internalTexture,size,generateStencil,bilinearFiltering,comparisonFunction){var samples=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var width=size.width||size;var height=size.height||size;var layers=size.layers||0;internalTexture.baseWidth=width;internalTexture.baseHeight=height;internalTexture.width=width;internalTexture.height=height;internalTexture.is2DArray=layers>0;internalTexture.depth=layers;internalTexture.isReady=true;internalTexture.samples=samples;internalTexture.generateMipMaps=false;internalTexture.samplingMode=bilinearFiltering?2:1;internalTexture.type=0;internalTexture._comparisonFunction=comparisonFunction;var gl=this._gl;var target=this._getTextureTarget(internalTexture);var samplingParameters=this._getSamplingParameters(internalTexture.samplingMode,false);gl.texParameteri(target,gl.TEXTURE_MAG_FILTER,samplingParameters.mag);gl.texParameteri(target,gl.TEXTURE_MIN_FILTER,samplingParameters.min);gl.texParameteri(target,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(target,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(this.webGLVersion>1){if(comparisonFunction===0){gl.texParameteri(target,gl.TEXTURE_COMPARE_FUNC,515);gl.texParameteri(target,gl.TEXTURE_COMPARE_MODE,gl.NONE);}else{gl.texParameteri(target,gl.TEXTURE_COMPARE_FUNC,comparisonFunction);gl.texParameteri(target,gl.TEXTURE_COMPARE_MODE,gl.COMPARE_REF_TO_TEXTURE);}}}},{key:"_uploadCompressedDataToTextureDirectly",value:function _uploadCompressedDataToTextureDirectly(texture,internalFormat,width,height,data){var faceIndex=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var lod=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var gl=this._gl;var target=gl.TEXTURE_2D;if(texture.isCube){target=gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex;}if(texture._useSRGBBuffer){switch(internalFormat){case 37492:case 36196:if(this._caps.etc2){internalFormat=gl.COMPRESSED_SRGB8_ETC2;}else{texture._useSRGBBuffer=false;}break;case 37496:if(this._caps.etc2){internalFormat=gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;}else{texture._useSRGBBuffer=false;}break;case 36492:internalFormat=gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:internalFormat=gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:if(this._caps.s3tc_srgb){internalFormat=gl.COMPRESSED_SRGB_S3TC_DXT1_EXT;}else{texture._useSRGBBuffer=false;}break;case 33777:if(this._caps.s3tc_srgb){internalFormat=gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;}else{texture._useSRGBBuffer=false;}break;case 33779:if(this._caps.s3tc_srgb){internalFormat=gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;}else{texture._useSRGBBuffer=false;}break;default:texture._useSRGBBuffer=false;break;}}this._gl.compressedTexImage2D(target,lod,internalFormat,width,height,0,data);}},{key:"_uploadDataToTextureDirectly",value:function _uploadDataToTextureDirectly(texture,imageData){var faceIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var lod=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var babylonInternalFormat=arguments.length>4?arguments[4]:undefined;var useTextureWidthAndHeight=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var gl=this._gl;var textureType=this._getWebGLTextureType(texture.type);var format=this._getInternalFormat(texture.format);var internalFormat=babylonInternalFormat===void 0?this._getRGBABufferInternalSizedFormat(texture.type,texture.format,texture._useSRGBBuffer):this._getInternalFormat(babylonInternalFormat,texture._useSRGBBuffer);this._unpackFlipY(texture.invertY);var target=gl.TEXTURE_2D;if(texture.isCube){target=gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex;}var lodMaxWidth=Math.round(Math.log(texture.width)*Math.LOG2E);var lodMaxHeight=Math.round(Math.log(texture.height)*Math.LOG2E);var width=useTextureWidthAndHeight?texture.width:Math.pow(2,Math.max(lodMaxWidth-lod,0));var height=useTextureWidthAndHeight?texture.height:Math.pow(2,Math.max(lodMaxHeight-lod,0));gl.texImage2D(target,lod,internalFormat,width,height,0,format,textureType,imageData);}},{key:"updateTextureData",value:function updateTextureData(texture,imageData,xOffset,yOffset,width,height){var faceIndex=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var lod=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var generateMipMaps=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var gl=this._gl;var textureType=this._getWebGLTextureType(texture.type);var format=this._getInternalFormat(texture.format);this._unpackFlipY(texture.invertY);var targetForBinding=gl.TEXTURE_2D;var target=gl.TEXTURE_2D;if(texture.isCube){target=gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex;targetForBinding=gl.TEXTURE_CUBE_MAP;}this._bindTextureDirectly(targetForBinding,texture,true);gl.texSubImage2D(target,lod,xOffset,yOffset,width,height,format,textureType,imageData);if(generateMipMaps){this._gl.generateMipmap(target);}this._bindTextureDirectly(targetForBinding,null);}},{key:"_uploadArrayBufferViewToTexture",value:function _uploadArrayBufferViewToTexture(texture,imageData){var faceIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var lod=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var gl=this._gl;var bindTarget=texture.isCube?gl.TEXTURE_CUBE_MAP:gl.TEXTURE_2D;this._bindTextureDirectly(bindTarget,texture,true);this._uploadDataToTextureDirectly(texture,imageData,faceIndex,lod);this._bindTextureDirectly(bindTarget,null,true);}},{key:"_prepareWebGLTextureContinuation",value:function _prepareWebGLTextureContinuation(texture,scene2,noMipmap,isCompressed,samplingMode){var gl=this._gl;if(!gl){return;}var filters2=this._getSamplingParameters(samplingMode,!noMipmap);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,filters2.mag);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,filters2.min);if(!noMipmap&&!isCompressed){gl.generateMipmap(gl.TEXTURE_2D);}this._bindTextureDirectly(gl.TEXTURE_2D,null);if(scene2){scene2.removePendingData(texture);}texture.onLoadedObservable.notifyObservers(texture);texture.onLoadedObservable.clear();}},{key:"_prepareWebGLTexture",value:function _prepareWebGLTexture(texture,extension,scene2,img,invertY,noMipmap,isCompressed,processFunction){var _this26=this;var samplingMode=arguments.length>8&&arguments[8]!==undefined?arguments[8]:3;var maxTextureSize=this.getCaps().maxTextureSize;var potWidth=Math.min(maxTextureSize,this.needPOTTextures?ThinEngine.GetExponentOfTwo(img.width,maxTextureSize):img.width);var potHeight=Math.min(maxTextureSize,this.needPOTTextures?ThinEngine.GetExponentOfTwo(img.height,maxTextureSize):img.height);var gl=this._gl;if(!gl){return;}if(!texture._hardwareTexture){if(scene2){scene2.removePendingData(texture);}return;}this._bindTextureDirectly(gl.TEXTURE_2D,texture,true);this._unpackFlipY(invertY===void 0?true:invertY?true:false);texture.baseWidth=img.width;texture.baseHeight=img.height;texture.width=potWidth;texture.height=potHeight;texture.isReady=true;if(processFunction(potWidth,potHeight,img,extension,texture,function(){_this26._prepareWebGLTextureContinuation(texture,scene2,noMipmap,isCompressed,samplingMode);})){return;}this._prepareWebGLTextureContinuation(texture,scene2,noMipmap,isCompressed,samplingMode);}},{key:"_setupFramebufferDepthAttachments",value:function _setupFramebufferDepthAttachments(generateStencilBuffer,generateDepthBuffer,width,height){var samples=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var gl=this._gl;if(generateStencilBuffer&&generateDepthBuffer){return this._createRenderBuffer(width,height,samples,gl.DEPTH_STENCIL,gl.DEPTH24_STENCIL8,gl.DEPTH_STENCIL_ATTACHMENT);}if(generateDepthBuffer){var depthFormat=gl.DEPTH_COMPONENT16;if(this._webGLVersion>1){depthFormat=gl.DEPTH_COMPONENT32F;}return this._createRenderBuffer(width,height,samples,depthFormat,depthFormat,gl.DEPTH_ATTACHMENT);}if(generateStencilBuffer){return this._createRenderBuffer(width,height,samples,gl.STENCIL_INDEX8,gl.STENCIL_INDEX8,gl.STENCIL_ATTACHMENT);}return null;}},{key:"_createRenderBuffer",value:function _createRenderBuffer(width,height,samples,internalFormat,msInternalFormat,attachment){var unbindBuffer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;var gl=this._gl;var renderBuffer=gl.createRenderbuffer();return this._updateRenderBuffer(renderBuffer,width,height,samples,internalFormat,msInternalFormat,attachment,unbindBuffer);}},{key:"_updateRenderBuffer",value:function _updateRenderBuffer(renderBuffer,width,height,samples,internalFormat,msInternalFormat,attachment){var unbindBuffer=arguments.length>7&&arguments[7]!==undefined?arguments[7]:true;var gl=this._gl;gl.bindRenderbuffer(gl.RENDERBUFFER,renderBuffer);if(samples>1&&gl.renderbufferStorageMultisample){gl.renderbufferStorageMultisample(gl.RENDERBUFFER,samples,msInternalFormat,width,height);}else{gl.renderbufferStorage(gl.RENDERBUFFER,internalFormat,width,height);}gl.framebufferRenderbuffer(gl.FRAMEBUFFER,attachment,gl.RENDERBUFFER,renderBuffer);if(unbindBuffer){gl.bindRenderbuffer(gl.RENDERBUFFER,null);}return renderBuffer;}},{key:"_releaseTexture",value:function _releaseTexture(texture){var _a;this._deleteTexture((_a=texture._hardwareTexture)===null||_a===void 0?void 0:_a.underlyingResource);this.unbindAllTextures();var index=this._internalTexturesCache.indexOf(texture);if(index!==-1){this._internalTexturesCache.splice(index,1);}if(texture._lodTextureHigh){texture._lodTextureHigh.dispose();}if(texture._lodTextureMid){texture._lodTextureMid.dispose();}if(texture._lodTextureLow){texture._lodTextureLow.dispose();}if(texture._irradianceTexture){texture._irradianceTexture.dispose();}}},{key:"_releaseRenderTargetWrapper",value:function _releaseRenderTargetWrapper(rtWrapper){var index=this._renderTargetWrapperCache.indexOf(rtWrapper);if(index!==-1){this._renderTargetWrapperCache.splice(index,1);}}},{key:"_deleteTexture",value:function _deleteTexture(texture){if(texture){this._gl.deleteTexture(texture);}}},{key:"_setProgram",value:function _setProgram(program){if(this._currentProgram!==program){this._gl.useProgram(program);this._currentProgram=program;}}},{key:"bindSamplers",value:function bindSamplers(effect){var webGLPipelineContext=effect.getPipelineContext();this._setProgram(webGLPipelineContext.program);var samplers=effect.getSamplers();for(var index=0;index<samplers.length;index++){var uniform=effect.getUniform(samplers[index]);if(uniform){this._boundUniforms[index]=uniform;}}this._currentEffect=null;}},{key:"_activateCurrentTexture",value:function _activateCurrentTexture(){if(this._currentTextureChannel!==this._activeChannel){this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel);this._currentTextureChannel=this._activeChannel;}}},{key:"_bindTextureDirectly",value:function _bindTextureDirectly(target,texture){var forTextureDataUpdate=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var force=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var _a,_b;var wasPreviouslyBound=false;var isTextureForRendering=texture&&texture._associatedChannel>-1;if(forTextureDataUpdate&&isTextureForRendering){this._activeChannel=texture._associatedChannel;}var currentTextureBound=this._boundTexturesCache[this._activeChannel];if(currentTextureBound!==texture||force){this._activateCurrentTexture();if(texture&&texture.isMultiview){console.error(target,texture);throw"_bindTextureDirectly called with a multiview texture!";}else{this._gl.bindTexture(target,(_b=(_a=texture===null||texture===void 0?void 0:texture._hardwareTexture)===null||_a===void 0?void 0:_a.underlyingResource)!==null&&_b!==void 0?_b:null);}this._boundTexturesCache[this._activeChannel]=texture;if(texture){texture._associatedChannel=this._activeChannel;}}else if(forTextureDataUpdate){wasPreviouslyBound=true;this._activateCurrentTexture();}if(isTextureForRendering&&!forTextureDataUpdate){this._bindSamplerUniformToChannel(texture._associatedChannel,this._activeChannel);}return wasPreviouslyBound;}},{key:"_bindTexture",value:function _bindTexture(channel,texture,name135){if(channel===void 0){return;}if(texture){texture._associatedChannel=channel;}this._activeChannel=channel;var target=texture?this._getTextureTarget(texture):this._gl.TEXTURE_2D;this._bindTextureDirectly(target,texture);}},{key:"unbindAllTextures",value:function unbindAllTextures(){for(var channel=0;channel<this._maxSimultaneousTextures;channel++){this._activeChannel=channel;this._bindTextureDirectly(this._gl.TEXTURE_2D,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null);if(this.webGLVersion>1){this._bindTextureDirectly(this._gl.TEXTURE_3D,null);this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null);}}}},{key:"setTexture",value:function setTexture(channel,uniform,texture,name135){if(channel===void 0){return;}if(uniform){this._boundUniforms[channel]=uniform;}this._setTexture(channel,texture);}},{key:"_bindSamplerUniformToChannel",value:function _bindSamplerUniformToChannel(sourceSlot,destination){var uniform=this._boundUniforms[sourceSlot];if(!uniform||uniform._currentState===destination){return;}this._gl.uniform1i(uniform,destination);uniform._currentState=destination;}},{key:"_getTextureWrapMode",value:function _getTextureWrapMode(mode){switch(mode){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT;}return this._gl.REPEAT;}},{key:"_setTexture",value:function _setTexture(channel,texture){var isPartOfTextureArray=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var depthStencilTexture=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var name135=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";if(!texture){if(this._boundTexturesCache[channel]!=null){this._activeChannel=channel;this._bindTextureDirectly(this._gl.TEXTURE_2D,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null);if(this.webGLVersion>1){this._bindTextureDirectly(this._gl.TEXTURE_3D,null);this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null);}}return false;}if(texture.video){this._activeChannel=channel;texture.update();}else if(texture.delayLoadState===4){texture.delayLoad();return false;}var internalTexture;if(depthStencilTexture){internalTexture=texture.depthStencilTexture;}else if(texture.isReady()){internalTexture=texture.getInternalTexture();}else if(texture.isCube){internalTexture=this.emptyCubeTexture;}else if(texture.is3D){internalTexture=this.emptyTexture3D;}else if(texture.is2DArray){internalTexture=this.emptyTexture2DArray;}else{internalTexture=this.emptyTexture;}if(!isPartOfTextureArray&&internalTexture){internalTexture._associatedChannel=channel;}var needToBind=true;if(this._boundTexturesCache[channel]===internalTexture){if(!isPartOfTextureArray){this._bindSamplerUniformToChannel(internalTexture._associatedChannel,channel);}needToBind=false;}this._activeChannel=channel;var target=this._getTextureTarget(internalTexture);if(needToBind){this._bindTextureDirectly(target,internalTexture,isPartOfTextureArray);}if(internalTexture&&!internalTexture.isMultiview){if(internalTexture.isCube&&internalTexture._cachedCoordinatesMode!==texture.coordinatesMode){internalTexture._cachedCoordinatesMode=texture.coordinatesMode;var textureWrapMode=texture.coordinatesMode!==3&&texture.coordinatesMode!==5?1:0;texture.wrapU=textureWrapMode;texture.wrapV=textureWrapMode;}if(internalTexture._cachedWrapU!==texture.wrapU){internalTexture._cachedWrapU=texture.wrapU;this._setTextureParameterInteger(target,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(texture.wrapU),internalTexture);}if(internalTexture._cachedWrapV!==texture.wrapV){internalTexture._cachedWrapV=texture.wrapV;this._setTextureParameterInteger(target,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(texture.wrapV),internalTexture);}if(internalTexture.is3D&&internalTexture._cachedWrapR!==texture.wrapR){internalTexture._cachedWrapR=texture.wrapR;this._setTextureParameterInteger(target,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(texture.wrapR),internalTexture);}this._setAnisotropicLevel(target,internalTexture,texture.anisotropicFilteringLevel);}return true;}},{key:"setTextureArray",value:function setTextureArray(channel,uniform,textures,name135){if(channel===void 0||!uniform){return;}if(!this._textureUnits||this._textureUnits.length!==textures.length){this._textureUnits=new Int32Array(textures.length);}for(var i=0;i<textures.length;i++){var texture=textures[i].getInternalTexture();if(texture){this._textureUnits[i]=channel+i;texture._associatedChannel=channel+i;}else{this._textureUnits[i]=-1;}}this._gl.uniform1iv(uniform,this._textureUnits);for(var index=0;index<textures.length;index++){this._setTexture(this._textureUnits[index],textures[index],true);}}},{key:"_setAnisotropicLevel",value:function _setAnisotropicLevel(target,internalTexture,anisotropicFilteringLevel){var anisotropicFilterExtension=this._caps.textureAnisotropicFilterExtension;if(internalTexture.samplingMode!==11&&internalTexture.samplingMode!==3&&internalTexture.samplingMode!==2){anisotropicFilteringLevel=1;}if(anisotropicFilterExtension&&internalTexture._cachedAnisotropicFilteringLevel!==anisotropicFilteringLevel){this._setTextureParameterFloat(target,anisotropicFilterExtension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(anisotropicFilteringLevel,this._caps.maxAnisotropy),internalTexture);internalTexture._cachedAnisotropicFilteringLevel=anisotropicFilteringLevel;}}},{key:"_setTextureParameterFloat",value:function _setTextureParameterFloat(target,parameter,value,texture){this._bindTextureDirectly(target,texture,true,true);this._gl.texParameterf(target,parameter,value);}},{key:"_setTextureParameterInteger",value:function _setTextureParameterInteger(target,parameter,value,texture){if(texture){this._bindTextureDirectly(target,texture,true,true);}this._gl.texParameteri(target,parameter,value);}},{key:"unbindAllAttributes",value:function unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=false;for(var i=0;i<this._caps.maxVertexAttribs;i++){this.disableAttributeByIndex(i);}return;}for(var _i4=0,ul=this._vertexAttribArraysEnabled.length;_i4<ul;_i4++){if(_i4>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[_i4]){continue;}this.disableAttributeByIndex(_i4);}}},{key:"releaseEffects",value:function releaseEffects(){for(var name135 in this._compiledEffects){var webGLPipelineContext=this._compiledEffects[name135].getPipelineContext();this._deletePipelineContext(webGLPipelineContext);}this._compiledEffects={};}},{key:"dispose",value:function dispose(){var _a;this.stopRenderLoop();if(this.onBeforeTextureInitObservable){this.onBeforeTextureInitObservable.clear();}if(this._emptyTexture){this._releaseTexture(this._emptyTexture);this._emptyTexture=null;}if(this._emptyCubeTexture){this._releaseTexture(this._emptyCubeTexture);this._emptyCubeTexture=null;}if(this._dummyFramebuffer){this._gl.deleteFramebuffer(this._dummyFramebuffer);}this.releaseEffects();(_a=this.releaseComputeEffects)===null||_a===void 0?void 0:_a.call(this);this.unbindAllAttributes();this._boundUniforms={};if(IsWindowObjectExist()){if(this._renderingCanvas){if(!this._doNotHandleContextLost){this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost);this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored);}window.removeEventListener("resize",this._checkForMobile);}}this._workingCanvas=null;this._workingContext=null;this._currentBufferPointers.length=0;this._renderingCanvas=null;this._currentProgram=null;this._boundRenderFunction=null;Effect.ResetCache();var _iterator19=_createForOfIteratorHelper(this._activeRequests),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var request=_step19.value;request.abort();}}catch(err){_iterator19.e(err);}finally{_iterator19.f();}this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();}},{key:"attachContextLostEvent",value:function attachContextLostEvent(callback){if(this._renderingCanvas){this._renderingCanvas.addEventListener("webglcontextlost",callback,false);}}},{key:"attachContextRestoredEvent",value:function attachContextRestoredEvent(callback){if(this._renderingCanvas){this._renderingCanvas.addEventListener("webglcontextrestored",callback,false);}}},{key:"getError",value:function getError(){return this._gl.getError();}},{key:"_canRenderToFloatFramebuffer",value:function _canRenderToFloatFramebuffer(){if(this._webGLVersion>1){return this._caps.colorBufferFloat;}return this._canRenderToFramebuffer(1);}},{key:"_canRenderToHalfFloatFramebuffer",value:function _canRenderToHalfFloatFramebuffer(){if(this._webGLVersion>1){return this._caps.colorBufferFloat;}return this._canRenderToFramebuffer(2);}},{key:"_canRenderToFramebuffer",value:function _canRenderToFramebuffer(type){var gl=this._gl;while(gl.getError()!==gl.NO_ERROR){}var successful=true;var texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,texture);gl.texImage2D(gl.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(type),1,1,0,gl.RGBA,this._getWebGLTextureType(type),null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);var fb=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,fb);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture,0);var status=gl.checkFramebufferStatus(gl.FRAMEBUFFER);successful=successful&&status===gl.FRAMEBUFFER_COMPLETE;successful=successful&&gl.getError()===gl.NO_ERROR;if(successful){gl.clear(gl.COLOR_BUFFER_BIT);successful=successful&&gl.getError()===gl.NO_ERROR;}if(successful){gl.bindFramebuffer(gl.FRAMEBUFFER,null);var readFormat=gl.RGBA;var readType=gl.UNSIGNED_BYTE;var buffer=new Uint8Array(4);gl.readPixels(0,0,1,1,readFormat,readType,buffer);successful=successful&&gl.getError()===gl.NO_ERROR;}gl.deleteTexture(texture);gl.deleteFramebuffer(fb);gl.bindFramebuffer(gl.FRAMEBUFFER,null);while(!successful&&gl.getError()!==gl.NO_ERROR){}return successful;}},{key:"_getWebGLTextureType",value:function _getWebGLTextureType(type){if(this._webGLVersion===1){switch(type){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;}return this._gl.UNSIGNED_BYTE;}switch(type){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV;}return this._gl.UNSIGNED_BYTE;}},{key:"_getInternalFormat",value:function _getInternalFormat(format){var useSRGBBuffer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var internalFormat=useSRGBBuffer?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(format){case 0:internalFormat=this._gl.ALPHA;break;case 1:internalFormat=this._gl.LUMINANCE;break;case 2:internalFormat=this._gl.LUMINANCE_ALPHA;break;case 6:internalFormat=this._gl.RED;break;case 7:internalFormat=this._gl.RG;break;case 4:internalFormat=useSRGBBuffer?this._gl.SRGB:this._gl.RGB;break;case 5:internalFormat=useSRGBBuffer?this._gl.SRGB8_ALPHA8:this._gl.RGBA;break;}if(this._webGLVersion>1){switch(format){case 8:internalFormat=this._gl.RED_INTEGER;break;case 9:internalFormat=this._gl.RG_INTEGER;break;case 10:internalFormat=this._gl.RGB_INTEGER;break;case 11:internalFormat=this._gl.RGBA_INTEGER;break;}}return internalFormat;}},{key:"_getRGBABufferInternalSizedFormat",value:function _getRGBABufferInternalSizedFormat(type,format){var useSRGBBuffer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this._webGLVersion===1){if(format!==void 0){switch(format){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return useSRGBBuffer?this._gl.SRGB:this._gl.RGB;}}return this._gl.RGBA;}switch(type){case 3:switch(format){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM;}case 0:switch(format){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return useSRGBBuffer?this._gl.SRGB8:this._gl.RGB8;case 5:return useSRGBBuffer?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8;}case 4:switch(format){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I;}case 5:switch(format){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI;}case 6:switch(format){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I;}case 7:switch(format){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI;}case 1:switch(format){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F;}case 2:switch(format){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F;}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(format){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2;}}return useSRGBBuffer?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;}},{key:"_getRGBAMultiSampleBufferFormat",value:function _getRGBAMultiSampleBufferFormat(type){if(type===1){return this._gl.RGBA32F;}else if(type===2){return this._gl.RGBA16F;}return this._gl.RGBA8;}},{key:"_loadFile",value:function _loadFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError){var _this27=this;var request=ThinEngine._FileToolsLoadFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError);this._activeRequests.push(request);request.onCompleteObservable.add(function(request2){_this27._activeRequests.splice(_this27._activeRequests.indexOf(request2),1);});return request;}},{key:"readPixels",value:function readPixels(x,y,width,height){var hasAlpha=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var flushRenderer=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var numChannels=hasAlpha?4:3;var format=hasAlpha?this._gl.RGBA:this._gl.RGB;var data=new Uint8Array(height*width*numChannels);if(flushRenderer){this.flushFramebuffer();}this._gl.readPixels(x,y,width,height,format,this._gl.UNSIGNED_BYTE,data);return Promise.resolve(data);}},{key:"getHostDocument",value:function getHostDocument(){if(this._renderingCanvas&&this._renderingCanvas.ownerDocument){return this._renderingCanvas.ownerDocument;}return IsDocumentAvailable()?document:null;}}],[{key:"NpmPackage",get:function get(){return"babylonjs@5.48.0";}},{key:"Version",get:function get(){return"5.48.0";}},{key:"ShadersRepository",get:function get(){return Effect.ShadersRepository;},set:function set(value){Effect.ShadersRepository=value;}},{key:"_CreateCanvas",value:function _CreateCanvas(width,height){if(typeof document==="undefined"){return new OffscreenCanvas(width,height);}var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas;}},{key:"_ConcatenateShader",value:function _ConcatenateShader(source,defines){var shaderVersion=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";return shaderVersion+(defines?defines+"\n":"")+source;}},{key:"_FileToolsLoadImage",value:function _FileToolsLoadImage(input,onLoad,onError,offlineProvider,mimeType,imageBitmapOptions){throw _WarnImport("FileTools");}},{key:"_FileToolsLoadFile",value:function _FileToolsLoadFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError){throw _WarnImport("FileTools");}},{key:"IsSupportedAsync",get:function get(){return Promise.resolve(this.isSupported());}},{key:"IsSupported",get:function get(){return this.isSupported();}},{key:"isSupported",value:function isSupported(){if(this._HasMajorPerformanceCaveat!==null){return!this._HasMajorPerformanceCaveat;}if(this._IsSupported===null){try{var tempcanvas=this._CreateCanvas(1,1);var gl=tempcanvas.getContext("webgl")||tempcanvas.getContext("experimental-webgl");this._IsSupported=gl!=null&&!!window.WebGLRenderingContext;}catch(e){this._IsSupported=false;}}return this._IsSupported;}},{key:"HasMajorPerformanceCaveat",get:function get(){if(this._HasMajorPerformanceCaveat===null){try{var tempcanvas=this._CreateCanvas(1,1);var gl=tempcanvas.getContext("webgl",{failIfMajorPerformanceCaveat:true})||tempcanvas.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:true});this._HasMajorPerformanceCaveat=!gl;}catch(e){this._HasMajorPerformanceCaveat=false;}}return this._HasMajorPerformanceCaveat;}},{key:"CeilingPOT",value:function CeilingPOT(x){x--;x|=x>>1;x|=x>>2;x|=x>>4;x|=x>>8;x|=x>>16;x++;return x;}},{key:"FloorPOT",value:function FloorPOT(x){x=x|x>>1;x=x|x>>2;x=x|x>>4;x=x|x>>8;x=x|x>>16;return x-(x>>1);}},{key:"NearestPOT",value:function NearestPOT(x){var c=ThinEngine.CeilingPOT(x);var f=ThinEngine.FloorPOT(x);return c-x>x-f?f:c;}},{key:"GetExponentOfTwo",value:function GetExponentOfTwo(value,max){var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var pot;switch(mode){case 1:pot=ThinEngine.FloorPOT(value);break;case 2:pot=ThinEngine.NearestPOT(value);break;case 3:default:pot=ThinEngine.CeilingPOT(value);break;}return Math.min(pot,max);}},{key:"QueueNewFrame",value:function QueueNewFrame(func,requester){if(!IsWindowObjectExist()){if(typeof requestAnimationFrame==="function"){return requestAnimationFrame(func);}}else{var _ref7=requester||window,requestPostAnimationFrame=_ref7.requestPostAnimationFrame,requestAnimationFrame2=_ref7.requestAnimationFrame;if(typeof requestPostAnimationFrame==="function"){return requestPostAnimationFrame(func);}if(typeof requestAnimationFrame2==="function"){return requestAnimationFrame2(func);}}return setTimeout(func,16);}}]);return ThinEngine;}();ThinEngine.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}];ThinEngine._TextureLoaders=[];ThinEngine.CollisionsEpsilon=1e-3;ThinEngine._IsSupported=null;ThinEngine._HasMajorPerformanceCaveat=null;// node_modules/@babylonjs/core/Misc/timingTools.js
var TimingTools=/*#__PURE__*/function(){function TimingTools(){_classCallCheck(this,TimingTools);}_createClass(TimingTools,null,[{key:"SetImmediate",value:function SetImmediate(action){if(IsWindowObjectExist()&&window.setImmediate){window.setImmediate(action);}else{setTimeout(action,1);}}}]);return TimingTools;}();// node_modules/@babylonjs/core/Misc/fileTools.js
var Base64DataUrlRegEx=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);var LoadFileError=/*#__PURE__*/function(_RuntimeError){_inherits(LoadFileError,_RuntimeError);var _super11=_createSuper(LoadFileError);function LoadFileError(message,object){var _this28;_classCallCheck(this,LoadFileError);_this28=_super11.call(this,message,ErrorCodes.LoadFileError);_this28.name="LoadFileError";BaseError._setPrototypeOf(_assertThisInitialized(_this28),LoadFileError.prototype);if(object instanceof WebRequest){_this28.request=object;}else{_this28.file=object;}return _this28;}return _createClass(LoadFileError);}(RuntimeError);var RequestFileError=/*#__PURE__*/function(_RuntimeError2){_inherits(RequestFileError,_RuntimeError2);var _super12=_createSuper(RequestFileError);function RequestFileError(message,request){var _this29;_classCallCheck(this,RequestFileError);_this29=_super12.call(this,message,ErrorCodes.RequestFileError);_this29.request=request;_this29.name="RequestFileError";BaseError._setPrototypeOf(_assertThisInitialized(_this29),RequestFileError.prototype);return _this29;}return _createClass(RequestFileError);}(RuntimeError);var ReadFileError=/*#__PURE__*/function(_RuntimeError3){_inherits(ReadFileError,_RuntimeError3);var _super13=_createSuper(ReadFileError);function ReadFileError(message,file){var _this30;_classCallCheck(this,ReadFileError);_this30=_super13.call(this,message,ErrorCodes.ReadFileError);_this30.file=file;_this30.name="ReadFileError";BaseError._setPrototypeOf(_assertThisInitialized(_this30),ReadFileError.prototype);return _this30;}return _createClass(ReadFileError);}(RuntimeError);var FileToolsOptions={DefaultRetryStrategy:RetryStrategy.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function PreprocessUrl(url){return url;}};var _CleanUrl=function _CleanUrl(url){url=url.replace(/#/gm,"%23");return url;};var _SetCorsBehavior=function SetCorsBehavior(url,element){if(url&&url.indexOf("data:")===0){return;}if(FileToolsOptions.CorsBehavior){if(typeof FileToolsOptions.CorsBehavior==="string"||FileToolsOptions.CorsBehavior instanceof String){element.crossOrigin=FileToolsOptions.CorsBehavior;}else{var result=FileToolsOptions.CorsBehavior(url);if(result){element.crossOrigin=result;}}}};var _LoadImage=function LoadImage(input,onLoad,onError,offlineProvider){var mimeType=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";var imageBitmapOptions=arguments.length>5?arguments[5]:undefined;var _a;var url;var usingObjectURL=false;if(input instanceof ArrayBuffer||ArrayBuffer.isView(input)){if(typeof Blob!=="undefined"&&typeof URL!=="undefined"){url=URL.createObjectURL(new Blob([input],{type:mimeType}));usingObjectURL=true;}else{url="data:".concat(mimeType,";base64,")+EncodeArrayBufferToBase64(input);}}else if(input instanceof Blob){url=URL.createObjectURL(input);usingObjectURL=true;}else{url=_CleanUrl(input);url=FileToolsOptions.PreprocessUrl(input);}var engine=EngineStore.LastCreatedEngine;var onErrorHandler=function onErrorHandler(exception){if(onError){var inputText=url||input.toString();onError("Error while trying to load image: ".concat(inputText.indexOf("http")===0||inputText.length<=128?inputText:inputText.slice(0,128)+"..."),exception);}};if(typeof Image==="undefined"||((_a=engine===null||engine===void 0?void 0:engine._features.forceBitmapOverHTMLImageElement)!==null&&_a!==void 0?_a:false)){_LoadFile(url,function(data){engine.createImageBitmap(new Blob([data],{type:mimeType}),_objectSpread({premultiplyAlpha:"none"},imageBitmapOptions)).then(function(imgBmp){onLoad(imgBmp);if(usingObjectURL){URL.revokeObjectURL(url);}})["catch"](function(reason){if(onError){onError("Error while trying to load image: "+input,reason);}});},void 0,offlineProvider||void 0,true,function(request,exception){onErrorHandler(exception);});return null;}var img=new Image();_SetCorsBehavior(url,img);var handlersList=[];var loadHandlersList=function loadHandlersList(){handlersList.forEach(function(handler){handler.target.addEventListener(handler.name,handler.handler);});};var unloadHandlersList=function unloadHandlersList(){handlersList.forEach(function(handler){handler.target.removeEventListener(handler.name,handler.handler);});handlersList.length=0;};var loadHandler=function loadHandler(){unloadHandlersList();onLoad(img);if(usingObjectURL&&img.src){URL.revokeObjectURL(img.src);}};var errorHandler=function errorHandler(err){unloadHandlersList();onErrorHandler(err);if(usingObjectURL&&img.src){URL.revokeObjectURL(img.src);}};var cspHandler=function cspHandler(err){unloadHandlersList();var cspException=new Error("CSP violation of policy ".concat(err.effectiveDirective," ").concat(err.blockedURI,". Current policy is ").concat(err.originalPolicy));EngineStore.UseFallbackTexture=false;onErrorHandler(cspException);if(usingObjectURL&&img.src){URL.revokeObjectURL(img.src);}img.src="";};handlersList.push({target:img,name:"load",handler:loadHandler});handlersList.push({target:img,name:"error",handler:errorHandler});handlersList.push({target:document,name:"securitypolicyviolation",handler:cspHandler});loadHandlersList();var fromBlob=url.substring(0,5)==="blob:";var fromData=url.substring(0,5)==="data:";var noOfflineSupport=function noOfflineSupport(){if(fromBlob||fromData){img.src=url;}else{_LoadFile(url,function(data,_,contentType){var type=!mimeType&&contentType?contentType:mimeType;var blob=new Blob([data],{type:type});var url2=URL.createObjectURL(blob);usingObjectURL=true;img.src=url2;},void 0,offlineProvider||void 0,true,function(request,exception){onErrorHandler(exception);});}};var loadFromOfflineSupport=function loadFromOfflineSupport(){if(offlineProvider){offlineProvider.loadImage(url,img);}};if(!fromBlob&&!fromData&&offlineProvider&&offlineProvider.enableTexturesOffline){offlineProvider.open(loadFromOfflineSupport,noOfflineSupport);}else{if(url.indexOf("file:")!==-1){var textureName=decodeURIComponent(url.substring(5).toLowerCase());if(FilesInputStore.FilesToLoad[textureName]&&typeof URL!=="undefined"){try{var blobURL;try{blobURL=URL.createObjectURL(FilesInputStore.FilesToLoad[textureName]);}catch(ex){blobURL=URL.createObjectURL(FilesInputStore.FilesToLoad[textureName]);}img.src=blobURL;usingObjectURL=true;}catch(e){img.src="";}return img;}}noOfflineSupport();}return img;};var _ReadFile=function ReadFile(file,onSuccess,onProgress,useArrayBuffer,onError){var reader=new FileReader();var fileRequest={onCompleteObservable:new Observable(),abort:function abort(){return reader.abort();}};reader.onloadend=function(){return fileRequest.onCompleteObservable.notifyObservers(fileRequest);};if(onError){reader.onerror=function(){onError(new ReadFileError("Unable to read ".concat(file.name),file));};}reader.onload=function(e){onSuccess(e.target["result"]);};if(onProgress){reader.onprogress=onProgress;}if(!useArrayBuffer){reader.readAsText(file);}else{reader.readAsArrayBuffer(file);}return fileRequest;};var _LoadFile=function LoadFile(fileOrUrl,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError,onOpened){if(fileOrUrl.name){return _ReadFile(fileOrUrl,onSuccess,onProgress,useArrayBuffer,onError?function(error){onError(void 0,error);}:void 0);}var url=fileOrUrl;if(url.indexOf("file:")!==-1){var fileName=decodeURIComponent(url.substring(5).toLowerCase());if(fileName.indexOf("./")===0){fileName=fileName.substring(2);}var file=FilesInputStore.FilesToLoad[fileName];if(file){return _ReadFile(file,onSuccess,onProgress,useArrayBuffer,onError?function(error){return onError(void 0,new LoadFileError(error.message,error.file));}:void 0);}}var _TestBase64DataUrl=TestBase64DataUrl(url),match=_TestBase64DataUrl.match,type=_TestBase64DataUrl.type;if(match){var fileRequest={onCompleteObservable:new Observable(),abort:function abort(){return function(){};}};try{var data=useArrayBuffer?DecodeBase64UrlToBinary(url):DecodeBase64UrlToString(url);onSuccess(data,void 0,type);}catch(error){if(onError){onError(void 0,error);}else{Logger.Error(error.message||"Failed to parse the Data URL");}}TimingTools.SetImmediate(function(){fileRequest.onCompleteObservable.notifyObservers(fileRequest);});return fileRequest;}return RequestFile(url,function(data,request){onSuccess(data,request===null||request===void 0?void 0:request.responseURL,request===null||request===void 0?void 0:request.getResponseHeader("content-type"));},onProgress,offlineProvider,useArrayBuffer,onError?function(error){onError(error.request,new LoadFileError(error.message,error.request));}:void 0,onOpened);};var RequestFile=function RequestFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError,onOpened){url=_CleanUrl(url);url=FileToolsOptions.PreprocessUrl(url);var loadUrl=FileToolsOptions.BaseUrl+url;var aborted=false;var fileRequest={onCompleteObservable:new Observable(),abort:function abort(){return aborted=true;}};var requestFile=function requestFile(){var request=new WebRequest();var retryHandle=null;var _onReadyStateChange;var unbindEvents=function unbindEvents(){if(!request){return;}if(onProgress){request.removeEventListener("progress",onProgress);}if(_onReadyStateChange){request.removeEventListener("readystatechange",_onReadyStateChange);}request.removeEventListener("loadend",_onLoadEnd);};var _onLoadEnd=function onLoadEnd(){unbindEvents();fileRequest.onCompleteObservable.notifyObservers(fileRequest);fileRequest.onCompleteObservable.clear();onProgress=void 0;_onReadyStateChange=null;_onLoadEnd=null;onError=void 0;onOpened=void 0;onSuccess=void 0;};fileRequest.abort=function(){aborted=true;if(_onLoadEnd){_onLoadEnd();}if(request&&request.readyState!==(XMLHttpRequest.DONE||4)){request.abort();}if(retryHandle!==null){clearTimeout(retryHandle);retryHandle=null;}request=null;};var handleError=function handleError(error){var message=error.message||"Unknown error";if(onError&&request){onError(new RequestFileError(message,request));}else{Logger.Error(message);}};var retryLoop=function retryLoop(retryIndex){if(!request){return;}request.open("GET",loadUrl);if(onOpened){try{onOpened(request);}catch(e){handleError(e);return;}}if(useArrayBuffer){request.responseType="arraybuffer";}if(onProgress){request.addEventListener("progress",onProgress);}if(_onLoadEnd){request.addEventListener("loadend",_onLoadEnd);}_onReadyStateChange=function onReadyStateChange(){if(aborted||!request){return;}if(request.readyState===(XMLHttpRequest.DONE||4)){if(_onReadyStateChange){request.removeEventListener("readystatechange",_onReadyStateChange);}if(request.status>=200&&request.status<300||request.status===0&&(!IsWindowObjectExist()||IsFileURL())){try{if(onSuccess){onSuccess(useArrayBuffer?request.response:request.responseText,request);}}catch(e){handleError(e);}return;}var retryStrategy=FileToolsOptions.DefaultRetryStrategy;if(retryStrategy){var waitTime=retryStrategy(loadUrl,request,retryIndex);if(waitTime!==-1){unbindEvents();request=new WebRequest();retryHandle=setTimeout(function(){return retryLoop(retryIndex+1);},waitTime);return;}}var error=new RequestFileError("Error status: "+request.status+" "+request.statusText+" - Unable to load "+loadUrl,request);if(onError){onError(error);}}};request.addEventListener("readystatechange",_onReadyStateChange);request.send();};retryLoop(0);};if(offlineProvider&&offlineProvider.enableSceneOffline){var noOfflineSupport=function noOfflineSupport(request){if(request&&request.status>400){if(onError){onError(request);}}else{requestFile();}};var loadFromOfflineSupport=function loadFromOfflineSupport(){if(offlineProvider){offlineProvider.loadFile(FileToolsOptions.BaseUrl+url,function(data){if(!aborted&&onSuccess){onSuccess(data);}fileRequest.onCompleteObservable.notifyObservers(fileRequest);},onProgress?function(event){if(!aborted&&onProgress){onProgress(event);}}:void 0,noOfflineSupport,useArrayBuffer);}};offlineProvider.open(loadFromOfflineSupport,noOfflineSupport);}else{requestFile();}return fileRequest;};var IsFileURL=function IsFileURL(){return typeof location!=="undefined"&&location.protocol==="file:";};var IsBase64DataUrl=function IsBase64DataUrl(uri){return Base64DataUrlRegEx.test(uri);};var TestBase64DataUrl=function TestBase64DataUrl(uri){var results=Base64DataUrlRegEx.exec(uri);if(results===null||results.length===0){return{match:false,type:""};}else{var type=results[0].replace("data:","").replace("base64,","");return{match:true,type:type};}};function DecodeBase64UrlToBinary(uri){return DecodeBase64ToBinary(uri.split(",")[1]);}var DecodeBase64UrlToString=function DecodeBase64UrlToString(uri){return DecodeBase64ToString(uri.split(",")[1]);};var initSideEffects=function initSideEffects(){ThinEngine._FileToolsLoadImage=_LoadImage;ThinEngine._FileToolsLoadFile=_LoadFile;ShaderProcessor._FileToolsLoadFile=_LoadFile;};initSideEffects();var FileTools;var _injectLTSFileTools=function _injectLTSFileTools(DecodeBase64UrlToBinary2,DecodeBase64UrlToString2,FileToolsOptions2,IsBase64DataUrl2,IsFileURL2,LoadFile2,LoadImage2,ReadFile2,RequestFile2,SetCorsBehavior2){FileTools={DecodeBase64UrlToBinary:DecodeBase64UrlToBinary2,DecodeBase64UrlToString:DecodeBase64UrlToString2,DefaultRetryStrategy:FileToolsOptions2.DefaultRetryStrategy,BaseUrl:FileToolsOptions2.BaseUrl,CorsBehavior:FileToolsOptions2.CorsBehavior,PreprocessUrl:FileToolsOptions2.PreprocessUrl,IsBase64DataUrl:IsBase64DataUrl2,IsFileURL:IsFileURL2,LoadFile:LoadFile2,LoadImage:LoadImage2,ReadFile:ReadFile2,RequestFile:RequestFile2,SetCorsBehavior:SetCorsBehavior2};Object.defineProperty(FileTools,"DefaultRetryStrategy",{get:function get(){return FileToolsOptions2.DefaultRetryStrategy;},set:function set(value){FileToolsOptions2.DefaultRetryStrategy=value;}});Object.defineProperty(FileTools,"BaseUrl",{get:function get(){return FileToolsOptions2.BaseUrl;},set:function set(value){FileToolsOptions2.BaseUrl=value;}});Object.defineProperty(FileTools,"PreprocessUrl",{get:function get(){return FileToolsOptions2.PreprocessUrl;},set:function set(value){FileToolsOptions2.PreprocessUrl=value;}});Object.defineProperty(FileTools,"CorsBehavior",{get:function get(){return FileToolsOptions2.CorsBehavior;},set:function set(value){FileToolsOptions2.CorsBehavior=value;}});};_injectLTSFileTools(DecodeBase64UrlToBinary,DecodeBase64UrlToString,FileToolsOptions,IsBase64DataUrl,IsFileURL,_LoadFile,_LoadImage,_ReadFile,RequestFile,_SetCorsBehavior);// node_modules/@babylonjs/core/Misc/typeStore.js
var _RegisteredTypes={};function RegisterClass(className,type){_RegisteredTypes[className]=type;}function GetClass(fqdn){return _RegisteredTypes[fqdn];}// node_modules/@babylonjs/core/Misc/instantiationTools.js
var InstantiationTools=/*#__PURE__*/function(){function InstantiationTools(){_classCallCheck(this,InstantiationTools);}_createClass(InstantiationTools,null,[{key:"Instantiate",value:function Instantiate(className){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[className]){return this.RegisteredExternalClasses[className];}var internalClass=GetClass(className);if(internalClass){return internalClass;}Logger.Warn(className+" not found, you may have missed an import.");var arr=className.split(".");var fn=window||this;for(var i=0,len=arr.length;i<len;i++){fn=fn[arr[i]];}if(typeof fn!=="function"){return null;}return fn;}}]);return InstantiationTools;}();InstantiationTools.RegisteredExternalClasses={};// node_modules/@babylonjs/core/Misc/guid.js
function RandomGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16);});}// node_modules/@babylonjs/core/Misc/tools.js
var Tools=/*#__PURE__*/function(){function Tools(){_classCallCheck(this,Tools);}_createClass(Tools,null,[{key:"BaseUrl",get:function get(){return FileToolsOptions.BaseUrl;},set:function set(value){FileToolsOptions.BaseUrl=value;}},{key:"DefaultRetryStrategy",get:function get(){return FileToolsOptions.DefaultRetryStrategy;},set:function set(strategy){FileToolsOptions.DefaultRetryStrategy=strategy;}},{key:"CorsBehavior",get:function get(){return FileToolsOptions.CorsBehavior;},set:function set(value){FileToolsOptions.CorsBehavior=value;}},{key:"UseFallbackTexture",get:function get(){return EngineStore.UseFallbackTexture;},set:function set(value){EngineStore.UseFallbackTexture=value;}},{key:"RegisteredExternalClasses",get:function get(){return InstantiationTools.RegisteredExternalClasses;},set:function set(classes){InstantiationTools.RegisteredExternalClasses=classes;}},{key:"fallbackTexture",get:function get(){return EngineStore.FallbackTexture;},set:function set(value){EngineStore.FallbackTexture=value;}},{key:"FetchToRef",value:function FetchToRef(u,v,width,height,pixels,color){var wrappedU=Math.abs(u)*width%width|0;var wrappedV=Math.abs(v)*height%height|0;var position=(wrappedU+wrappedV*width)*4;color.r=pixels[position]/255;color.g=pixels[position+1]/255;color.b=pixels[position+2]/255;color.a=pixels[position+3]/255;}},{key:"Mix",value:function Mix(a,b,alpha){return a*(1-alpha)+b*alpha;}},{key:"Instantiate",value:function Instantiate(className){return InstantiationTools.Instantiate(className);}},{key:"SetImmediate",value:function SetImmediate(action){TimingTools.SetImmediate(action);}},{key:"IsExponentOfTwo",value:function IsExponentOfTwo(value){var count=1;do{count*=2;}while(count<value);return count===value;}},{key:"FloatRound",value:function FloatRound(value){if(Math.fround){return Math.fround(value);}return Tools._TmpFloatArray[0]=value,Tools._TmpFloatArray[0];}},{key:"GetFilename",value:function GetFilename(path){var index=path.lastIndexOf("/");if(index<0){return path;}return path.substring(index+1);}},{key:"GetFolderPath",value:function GetFolderPath(uri){var returnUnchangedIfNoSlash=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var index=uri.lastIndexOf("/");if(index<0){if(returnUnchangedIfNoSlash){return uri;}return"";}return uri.substring(0,index+1);}},{key:"ToDegrees",value:function ToDegrees(angle){return angle*180/Math.PI;}},{key:"ToRadians",value:function ToRadians(angle){return angle*Math.PI/180;}},{key:"SmoothAngleChange",value:function SmoothAngleChange(previousAngle,newAngle){var smoothFactor=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.9;var previousAngleRad=this.ToRadians(previousAngle);var newAngleRad=this.ToRadians(newAngle);return this.ToDegrees(Math.atan2((1-smoothFactor)*Math.sin(newAngleRad)+smoothFactor*Math.sin(previousAngleRad),(1-smoothFactor)*Math.cos(newAngleRad)+smoothFactor*Math.cos(previousAngleRad)));}},{key:"MakeArray",value:function MakeArray(obj,allowsNullUndefined){if(allowsNullUndefined!==true&&(obj===void 0||obj==null)){return null;}return Array.isArray(obj)?obj:[obj];}},{key:"GetPointerPrefix",value:function GetPointerPrefix(engine){var eventPrefix="pointer";if(IsWindowObjectExist()&&!window.PointerEvent){eventPrefix="mouse";}if(engine._badDesktopOS&&!engine._badOS&&!(document&&"ontouchend"in document)){eventPrefix="mouse";}return eventPrefix;}},{key:"SetCorsBehavior",value:function SetCorsBehavior(url,element){_SetCorsBehavior(url,element);}},{key:"SetReferrerPolicyBehavior",value:function SetReferrerPolicyBehavior(referrerPolicy,element){element.referrerPolicy=referrerPolicy;}},{key:"CleanUrl",value:function CleanUrl(url){url=url.replace(/#/gm,"%23");return url;}},{key:"PreprocessUrl",get:function get(){return FileToolsOptions.PreprocessUrl;},set:function set(processor){FileToolsOptions.PreprocessUrl=processor;}},{key:"LoadImage",value:function LoadImage(input,onLoad,onError,offlineProvider,mimeType,imageBitmapOptions){return _LoadImage(input,onLoad,onError,offlineProvider,mimeType,imageBitmapOptions);}},{key:"LoadFile",value:function LoadFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError){return _LoadFile(url,onSuccess,onProgress,offlineProvider,useArrayBuffer,onError);}},{key:"LoadFileAsync",value:function LoadFileAsync(url){var useArrayBuffer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return new Promise(function(resolve,reject){_LoadFile(url,function(data){resolve(data);},void 0,void 0,useArrayBuffer,function(request,exception){reject(exception);});});}},{key:"LoadScript",value:function LoadScript(scriptUrl,onSuccess,onError,scriptId){if(typeof importScripts==="function"){try{importScripts(scriptUrl);onSuccess();}catch(e){onError===null||onError===void 0?void 0:onError("Unable to load script '".concat(scriptUrl,"' in worker"),e);}return;}else if(!IsWindowObjectExist()){onError===null||onError===void 0?void 0:onError("Cannot load script '".concat(scriptUrl,"' outside of a window or a worker"));return;}var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.setAttribute("type","text/javascript");script.setAttribute("src",scriptUrl);if(scriptId){script.id=scriptId;}script.onload=function(){if(onSuccess){onSuccess();}};script.onerror=function(e){if(onError){onError("Unable to load script '".concat(scriptUrl,"'"),e);}};head.appendChild(script);}},{key:"LoadScriptAsync",value:function LoadScriptAsync(scriptUrl){var _this31=this;return new Promise(function(resolve,reject){_this31.LoadScript(scriptUrl,function(){resolve();},function(message,exception){reject(exception||new Error(message));});});}},{key:"ReadFileAsDataURL",value:function ReadFileAsDataURL(fileToLoad,callback,progressCallback){var reader=new FileReader();var request={onCompleteObservable:new Observable(),abort:function abort(){return reader.abort();}};reader.onloadend=function(){request.onCompleteObservable.notifyObservers(request);};reader.onload=function(e){callback(e.target["result"]);};reader.onprogress=progressCallback;reader.readAsDataURL(fileToLoad);return request;}},{key:"ReadFile",value:function ReadFile(file,onSuccess,onProgress,useArrayBuffer,onError){return _ReadFile(file,onSuccess,onProgress,useArrayBuffer,onError);}},{key:"FileAsURL",value:function FileAsURL(content){var fileBlob=new Blob([content]);var url=window.URL;var link=url.createObjectURL(fileBlob);return link;}},{key:"Format",value:function Format(value){var decimals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;return value.toFixed(decimals);}},{key:"DeepCopy",value:function DeepCopy(source,destination,doNotCopyList,mustCopyList){DeepCopier.DeepCopy(source,destination,doNotCopyList,mustCopyList);}},{key:"IsEmpty",value:function IsEmpty(obj){for(var i in obj){if(Object.prototype.hasOwnProperty.call(obj,i)){return false;}}return true;}},{key:"RegisterTopRootEvents",value:function RegisterTopRootEvents(windowElement,events){for(var index=0;index<events.length;index++){var event=events[index];windowElement.addEventListener(event.name,event.handler,false);try{if(window.parent){window.parent.addEventListener(event.name,event.handler,false);}}catch(e){}}}},{key:"UnregisterTopRootEvents",value:function UnregisterTopRootEvents(windowElement,events){for(var index=0;index<events.length;index++){var event=events[index];windowElement.removeEventListener(event.name,event.handler);try{if(windowElement.parent){windowElement.parent.removeEventListener(event.name,event.handler);}}catch(e){}}}},{key:"DumpFramebuffer",value:function(){var _DumpFramebuffer=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(width,height,engine,successCallback){var mimeType,fileName,_args3=arguments;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:mimeType=_args3.length>4&&_args3[4]!==undefined?_args3[4]:"image/png";fileName=_args3.length>5?_args3[5]:undefined;throw _WarnImport("DumpTools");case 3:case"end":return _context2.stop();}},_callee2);}));function DumpFramebuffer(_x2,_x3,_x4,_x5){return _DumpFramebuffer.apply(this,arguments);}return DumpFramebuffer;}()},{key:"DumpData",value:function DumpData(width,height,data,successCallback){var mimeType=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"image/png";var fileName=arguments.length>5?arguments[5]:undefined;var invertY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var toArrayBuffer=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var quality=arguments.length>8?arguments[8]:undefined;throw _WarnImport("DumpTools");}},{key:"DumpDataAsync",value:function DumpDataAsync(width,height,data){var mimeType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"image/png";var fileName=arguments.length>4?arguments[4]:undefined;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var toArrayBuffer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var quality=arguments.length>7?arguments[7]:undefined;throw _WarnImport("DumpTools");}},{key:"ToBlob",value:function ToBlob(canvas,successCallback){var mimeType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"image/png";var quality=arguments.length>3?arguments[3]:undefined;if(!canvas.toBlob){canvas.toBlob=function(callback,type,quality2){var _this32=this;setTimeout(function(){var binStr=atob(_this32.toDataURL(type,quality2).split(",")[1]),len=binStr.length,arr=new Uint8Array(len);for(var i=0;i<len;i++){arr[i]=binStr.charCodeAt(i);}callback(new Blob([arr]));});};}canvas.toBlob(function(blob){successCallback(blob);},mimeType,quality);}},{key:"DownloadBlob",value:function DownloadBlob(blob,fileName){if("download"in document.createElement("a")){if(!fileName){var date=new Date();var stringDate=(date.getFullYear()+"-"+(date.getMonth()+1)).slice(2)+"-"+date.getDate()+"_"+date.getHours()+"-"+("0"+date.getMinutes()).slice(-2);fileName="screenshot_"+stringDate+".png";}Tools.Download(blob,fileName);}else{if(blob&&typeof URL!=="undefined"){var url=URL.createObjectURL(blob);var newWindow=window.open("");if(!newWindow){return;}var img=newWindow.document.createElement("img");img.onload=function(){URL.revokeObjectURL(url);};img.src=url;newWindow.document.body.appendChild(img);}}}},{key:"EncodeScreenshotCanvasData",value:function EncodeScreenshotCanvasData(canvas,successCallback){var mimeType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"image/png";var fileName=arguments.length>3?arguments[3]:undefined;var quality=arguments.length>4?arguments[4]:undefined;if(successCallback){var base64Image=canvas.toDataURL(mimeType,quality);successCallback(base64Image);}else{this.ToBlob(canvas,function(blob){if(blob){Tools.DownloadBlob(blob,fileName);}},mimeType,quality);}}},{key:"Download",value:function Download(blob,fileName){if(typeof URL==="undefined"){return;}var url=window.URL.createObjectURL(blob);var a=document.createElement("a");document.body.appendChild(a);a.style.display="none";a.href=url;a.download=fileName;a.addEventListener("click",function(){if(a.parentElement){a.parentElement.removeChild(a);}});a.click();window.URL.revokeObjectURL(url);}},{key:"BackCompatCameraNoPreventDefault",value:function BackCompatCameraNoPreventDefault(args){if(typeof args[0]==="boolean"){return args[0];}else if(typeof args[1]==="boolean"){return args[1];}return false;}},{key:"CreateScreenshot",value:function CreateScreenshot(engine,camera,size,successCallback){var mimeType=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"image/png";throw _WarnImport("ScreenshotTools");}},{key:"CreateScreenshotAsync",value:function CreateScreenshotAsync(engine,camera,size){var mimeType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"image/png";throw _WarnImport("ScreenshotTools");}},{key:"CreateScreenshotUsingRenderTarget",value:function CreateScreenshotUsingRenderTarget(engine,camera,size,successCallback){var mimeType=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"image/png";var samples=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var antialiasing=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var fileName=arguments.length>7?arguments[7]:undefined;throw _WarnImport("ScreenshotTools");}},{key:"CreateScreenshotUsingRenderTargetAsync",value:function CreateScreenshotUsingRenderTargetAsync(engine,camera,size){var mimeType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"image/png";var samples=arguments.length>4&&arguments[4]!==undefined?arguments[4]:1;var antialiasing=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var fileName=arguments.length>6?arguments[6]:undefined;throw _WarnImport("ScreenshotTools");}},{key:"RandomId",value:function RandomId(){return RandomGUID();}},{key:"IsBase64",value:function IsBase64(uri){return IsBase64DataUrl(uri);}},{key:"DecodeBase64",value:function DecodeBase64(uri){return DecodeBase64UrlToBinary(uri);}},{key:"errorsCount",get:function get(){return Logger.errorsCount;}},{key:"Log",value:function Log(message){Logger.Log(message);}},{key:"Warn",value:function Warn(message){Logger.Warn(message);}},{key:"Error",value:function Error(message){Logger.Error(message);}},{key:"LogCache",get:function get(){return Logger.LogCache;}},{key:"ClearLogCache",value:function ClearLogCache(){Logger.ClearLogCache();}},{key:"LogLevels",set:function set(level){Logger.LogLevels=level;}},{key:"PerformanceLogLevel",set:function set(level){if((level&Tools.PerformanceUserMarkLogLevel)===Tools.PerformanceUserMarkLogLevel){Tools.StartPerformanceCounter=Tools._StartUserMark;Tools.EndPerformanceCounter=Tools._EndUserMark;return;}if((level&Tools.PerformanceConsoleLogLevel)===Tools.PerformanceConsoleLogLevel){Tools.StartPerformanceCounter=Tools._StartPerformanceConsole;Tools.EndPerformanceCounter=Tools._EndPerformanceConsole;return;}Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled;Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled;}},{key:"_StartPerformanceCounterDisabled",value:function _StartPerformanceCounterDisabled(counterName,condition){}},{key:"_EndPerformanceCounterDisabled",value:function _EndPerformanceCounterDisabled(counterName,condition){}},{key:"_StartUserMark",value:function _StartUserMark(counterName){var condition=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!Tools._Performance){if(!IsWindowObjectExist()){return;}Tools._Performance=window.performance;}if(!condition||!Tools._Performance.mark){return;}Tools._Performance.mark(counterName+"-Begin");}},{key:"_EndUserMark",value:function _EndUserMark(counterName){var condition=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!condition||!Tools._Performance.mark){return;}Tools._Performance.mark(counterName+"-End");Tools._Performance.measure(counterName,counterName+"-Begin",counterName+"-End");}},{key:"_StartPerformanceConsole",value:function _StartPerformanceConsole(counterName){var condition=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!condition){return;}Tools._StartUserMark(counterName,condition);if(console.time){console.time(counterName);}}},{key:"_EndPerformanceConsole",value:function _EndPerformanceConsole(counterName){var condition=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!condition){return;}Tools._EndUserMark(counterName,condition);console.timeEnd(counterName);}},{key:"Now",get:function get(){return PrecisionDate.Now;}},{key:"GetClassName",value:function GetClassName(object){var isType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var name135=null;if(!isType&&object.getClassName){name135=object.getClassName();}else{if(object instanceof Object){var classObj=isType?object:Object.getPrototypeOf(object);name135=classObj.constructor["__bjsclassName__"];}if(!name135){name135=_typeof(object);}}return name135;}},{key:"First",value:function First(array,predicate){var _iterator20=_createForOfIteratorHelper(array),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var el=_step20.value;if(predicate(el)){return el;}}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}return null;}},{key:"getFullClassName",value:function getFullClassName(object){var isType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var className=null;var moduleName=null;if(!isType&&object.getClassName){className=object.getClassName();}else{if(object instanceof Object){var classObj=isType?object:Object.getPrototypeOf(object);className=classObj.constructor["__bjsclassName__"];moduleName=classObj.constructor["__bjsmoduleName__"];}if(!className){className=_typeof(object);}}if(!className){return null;}return(moduleName!=null?moduleName+".":"")+className;}},{key:"DelayAsync",value:function DelayAsync(delay){return new Promise(function(resolve){setTimeout(function(){resolve();},delay);});}},{key:"IsSafari",value:function IsSafari(){if(!IsNavigatorAvailable()){return false;}return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);}}]);return Tools;}();Tools.UseCustomRequestHeaders=false;Tools.CustomRequestHeaders=WebRequest.CustomRequestHeaders;Tools._TmpFloatArray=new Float32Array(1);Tools.GetDOMTextContent=GetDOMTextContent;Tools.GetAbsoluteUrl=(typeof document==="undefined"?"undefined":_typeof(document))==="object"?function(url){var a=document.createElement("a");a.href=url;return a.href;}:typeof URL==="function"&&(typeof location==="undefined"?"undefined":_typeof(location))==="object"?function(url){return new URL(url,location.origin).href;}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.");};Tools.NoneLogLevel=Logger.NoneLogLevel;Tools.MessageLogLevel=Logger.MessageLogLevel;Tools.WarningLogLevel=Logger.WarningLogLevel;Tools.ErrorLogLevel=Logger.ErrorLogLevel;Tools.AllLogLevel=Logger.AllLogLevel;Tools.IsWindowObjectExist=IsWindowObjectExist;Tools.PerformanceNoneLogLevel=0;Tools.PerformanceUserMarkLogLevel=1;Tools.PerformanceConsoleLogLevel=2;Tools.StartPerformanceCounter=Tools._StartPerformanceCounterDisabled;Tools.EndPerformanceCounter=Tools._EndPerformanceCounterDisabled;var AsyncLoop=/*#__PURE__*/function(){function AsyncLoop(iterations,func,successCallback){var offset=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,AsyncLoop);this.iterations=iterations;this.index=offset-1;this._done=false;this._fn=func;this._successCallback=successCallback;}_createClass(AsyncLoop,[{key:"executeNext",value:function executeNext(){if(!this._done){if(this.index+1<this.iterations){++this.index;this._fn(this);}else{this.breakLoop();}}}},{key:"breakLoop",value:function breakLoop(){this._done=true;this._successCallback();}}],[{key:"Run",value:function Run(iterations,fn,successCallback){var offset=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var loop=new AsyncLoop(iterations,fn,successCallback,offset);loop.executeNext();return loop;}},{key:"SyncAsyncForLoop",value:function SyncAsyncForLoop(iterations,syncedIterations,fn,callback,breakFunction){var timeout=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;return AsyncLoop.Run(Math.ceil(iterations/syncedIterations),function(loop){if(breakFunction&&breakFunction()){loop.breakLoop();}else{setTimeout(function(){for(var i=0;i<syncedIterations;++i){var iteration=loop.index*syncedIterations+i;if(iteration>=iterations){break;}fn(iteration);if(breakFunction&&breakFunction()){loop.breakLoop();break;}}loop.executeNext();},timeout);}},callback);}}]);return AsyncLoop;}();EngineStore.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";// node_modules/@babylonjs/core/Misc/smartArray.js
var SmartArray=/*#__PURE__*/function(){function SmartArray(capacity){_classCallCheck(this,SmartArray);this.length=0;this.data=new Array(capacity);this._id=SmartArray._GlobalId++;}_createClass(SmartArray,[{key:"push",value:function push(value){this.data[this.length++]=value;if(this.length>this.data.length){this.data.length*=2;}}},{key:"forEach",value:function forEach(func){for(var index=0;index<this.length;index++){func(this.data[index]);}}},{key:"sort",value:function sort(compareFn){this.data.sort(compareFn);}},{key:"reset",value:function reset(){this.length=0;}},{key:"dispose",value:function dispose(){this.reset();if(this.data){this.data.length=0;}}},{key:"concat",value:function concat(array){if(array.length===0){return;}if(this.length+array.length>this.data.length){this.data.length=(this.length+array.length)*2;}for(var index=0;index<array.length;index++){this.data[this.length++]=(array.data||array)[index];}}},{key:"indexOf",value:function indexOf(value){var position=this.data.indexOf(value);if(position>=this.length){return-1;}return position;}},{key:"contains",value:function contains(value){return this.indexOf(value)!==-1;}}]);return SmartArray;}();SmartArray._GlobalId=0;var SmartArrayNoDuplicate=/*#__PURE__*/function(_SmartArray){_inherits(SmartArrayNoDuplicate,_SmartArray);var _super14=_createSuper(SmartArrayNoDuplicate);function SmartArrayNoDuplicate(){var _this33;_classCallCheck(this,SmartArrayNoDuplicate);_this33=_super14.apply(this,arguments);_this33._duplicateId=0;return _this33;}_createClass(SmartArrayNoDuplicate,[{key:"push",value:function push(value){_get(_getPrototypeOf(SmartArrayNoDuplicate.prototype),"push",this).call(this,value);if(!value.__smartArrayFlags){value.__smartArrayFlags={};}value.__smartArrayFlags[this._id]=this._duplicateId;}},{key:"pushNoDuplicate",value:function pushNoDuplicate(value){if(value.__smartArrayFlags&&value.__smartArrayFlags[this._id]===this._duplicateId){return false;}this.push(value);return true;}},{key:"reset",value:function reset(){_get(_getPrototypeOf(SmartArrayNoDuplicate.prototype),"reset",this).call(this);this._duplicateId++;}},{key:"concatWithNoDuplicate",value:function concatWithNoDuplicate(array){if(array.length===0){return;}if(this.length+array.length>this.data.length){this.data.length=(this.length+array.length)*2;}for(var index=0;index<array.length;index++){var item=(array.data||array)[index];this.pushNoDuplicate(item);}}}]);return SmartArrayNoDuplicate;}(SmartArray);// node_modules/@babylonjs/core/Misc/stringDictionary.js
var StringDictionary=/*#__PURE__*/function(){function StringDictionary(){_classCallCheck(this,StringDictionary);this._count=0;this._data={};}_createClass(StringDictionary,[{key:"copyFrom",value:function copyFrom(source){var _this34=this;this.clear();source.forEach(function(t,v){return _this34.add(t,v);});}},{key:"get",value:function get(key){var val=this._data[key];if(val!==void 0){return val;}return void 0;}},{key:"getOrAddWithFactory",value:function getOrAddWithFactory(key,factory){var val=this.get(key);if(val!==void 0){return val;}val=factory(key);if(val){this.add(key,val);}return val;}},{key:"getOrAdd",value:function getOrAdd(key,val){var curVal=this.get(key);if(curVal!==void 0){return curVal;}this.add(key,val);return val;}},{key:"contains",value:function contains(key){return this._data[key]!==void 0;}},{key:"add",value:function add(key,value){if(this._data[key]!==void 0){return false;}this._data[key]=value;++this._count;return true;}},{key:"set",value:function set(key,value){if(this._data[key]===void 0){return false;}this._data[key]=value;return true;}},{key:"getAndRemove",value:function getAndRemove(key){var val=this.get(key);if(val!==void 0){delete this._data[key];--this._count;return val;}return null;}},{key:"remove",value:function remove(key){if(this.contains(key)){delete this._data[key];--this._count;return true;}return false;}},{key:"clear",value:function clear(){this._data={};this._count=0;}},{key:"count",get:function get(){return this._count;}},{key:"forEach",value:function forEach(callback){for(var cur in this._data){var val=this._data[cur];callback(cur,val);}}},{key:"first",value:function first(callback){for(var cur in this._data){var val=this._data[cur];var res=callback(cur,val);if(res){return res;}}return null;}}]);return StringDictionary;}();// node_modules/@babylonjs/core/Misc/andOrNotEvaluator.js
var AndOrNotEvaluator=/*#__PURE__*/function(){function AndOrNotEvaluator(){_classCallCheck(this,AndOrNotEvaluator);}_createClass(AndOrNotEvaluator,null,[{key:"Eval",value:function Eval(query,evaluateCallback){if(!query.match(/\([^()]*\)/g)){query=AndOrNotEvaluator._HandleParenthesisContent(query,evaluateCallback);}else{query=query.replace(/\([^()]*\)/g,function(r){r=r.slice(1,r.length-1);return AndOrNotEvaluator._HandleParenthesisContent(r,evaluateCallback);});}if(query==="true"){return true;}if(query==="false"){return false;}return AndOrNotEvaluator.Eval(query,evaluateCallback);}},{key:"_HandleParenthesisContent",value:function _HandleParenthesisContent(parenthesisContent,evaluateCallback){evaluateCallback=evaluateCallback||function(r){return r==="true"?true:false;};var result;var or=parenthesisContent.split("||");for(var i in or){if(Object.prototype.hasOwnProperty.call(or,i)){var ori=AndOrNotEvaluator._SimplifyNegation(or[i].trim());var and=ori.split("&&");if(and.length>1){for(var j=0;j<and.length;++j){var andj=AndOrNotEvaluator._SimplifyNegation(and[j].trim());if(andj!=="true"&&andj!=="false"){if(andj[0]==="!"){result=!evaluateCallback(andj.substring(1));}else{result=evaluateCallback(andj);}}else{result=andj==="true"?true:false;}if(!result){ori="false";break;}}}if(result||ori==="true"){result=true;break;}if(ori!=="true"&&ori!=="false"){if(ori[0]==="!"){result=!evaluateCallback(ori.substring(1));}else{result=evaluateCallback(ori);}}else{result=ori==="true"?true:false;}}}return result?"true":"false";}},{key:"_SimplifyNegation",value:function _SimplifyNegation(booleanString){booleanString=booleanString.replace(/^[\s!]+/,function(r){r=r.replace(/[\s]/g,function(){return"";});return r.length%2?"!":"";});booleanString=booleanString.trim();if(booleanString==="!true"){booleanString="false";}else if(booleanString==="!false"){booleanString="true";}return booleanString;}}]);return AndOrNotEvaluator;}();// node_modules/@babylonjs/core/Misc/tags.js
var Tags=/*#__PURE__*/function(){function Tags(){_classCallCheck(this,Tags);}_createClass(Tags,null,[{key:"EnableFor",value:function EnableFor(obj){obj._tags=obj._tags||{};obj.hasTags=function(){return Tags.HasTags(obj);};obj.addTags=function(tagsString){return Tags.AddTagsTo(obj,tagsString);};obj.removeTags=function(tagsString){return Tags.RemoveTagsFrom(obj,tagsString);};obj.matchesTagsQuery=function(tagsQuery){return Tags.MatchesQuery(obj,tagsQuery);};}},{key:"DisableFor",value:function DisableFor(obj){delete obj._tags;delete obj.hasTags;delete obj.addTags;delete obj.removeTags;delete obj.matchesTagsQuery;}},{key:"HasTags",value:function HasTags(obj){if(!obj._tags){return false;}var tags=obj._tags;for(var i in tags){if(Object.prototype.hasOwnProperty.call(tags,i)){return true;}}return false;}},{key:"GetTags",value:function GetTags(obj){var asString=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!obj._tags){return null;}if(asString){var tagsArray=[];for(var tag in obj._tags){if(Object.prototype.hasOwnProperty.call(obj._tags,tag)&&obj._tags[tag]===true){tagsArray.push(tag);}}return tagsArray.join(" ");}else{return obj._tags;}}},{key:"AddTagsTo",value:function AddTagsTo(obj,tagsString){if(!tagsString){return;}if(typeof tagsString!=="string"){return;}var tags=tagsString.split(" ");tags.forEach(function(tag){Tags._AddTagTo(obj,tag);});}},{key:"_AddTagTo",value:function _AddTagTo(obj,tag){tag=tag.trim();if(tag===""||tag==="true"||tag==="false"){return;}if(tag.match(/[\s]/)||tag.match(/^([!]|([|]|[&]){2})/)){return;}Tags.EnableFor(obj);obj._tags[tag]=true;}},{key:"RemoveTagsFrom",value:function RemoveTagsFrom(obj,tagsString){if(!Tags.HasTags(obj)){return;}var tags=tagsString.split(" ");for(var t in tags){Tags._RemoveTagFrom(obj,tags[t]);}}},{key:"_RemoveTagFrom",value:function _RemoveTagFrom(obj,tag){delete obj._tags[tag];}},{key:"MatchesQuery",value:function MatchesQuery(obj,tagsQuery){if(tagsQuery===void 0){return true;}if(tagsQuery===""){return Tags.HasTags(obj);}return AndOrNotEvaluator.Eval(tagsQuery,function(r){return Tags.HasTags(obj)&&obj._tags[r];});}}]);return Tags;}();// node_modules/@babylonjs/core/Maths/math.scalar.js
var Scalar=/*#__PURE__*/function(){function Scalar(){_classCallCheck(this,Scalar);}_createClass(Scalar,null,[{key:"WithinEpsilon",value:function WithinEpsilon(a,b){var epsilon=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1401298e-51;return Math.abs(a-b)<=epsilon;}},{key:"ToHex",value:function ToHex(i){var str=i.toString(16);if(i<=15){return("0"+str).toUpperCase();}return str.toUpperCase();}},{key:"Sign",value:function Sign(value){value=+value;if(value===0||isNaN(value)){return value;}return value>0?1:-1;}},{key:"Clamp",value:function Clamp(value){var min=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return Math.min(max,Math.max(min,value));}},{key:"Log2",value:function Log2(value){return Math.log(value)*Math.LOG2E;}},{key:"ILog2",value:function ILog2(value){if(Math.log2){return Math.floor(Math.log2(value));}if(value<0){return NaN;}else if(value===0){return-Infinity;}var n=0;if(value<1){while(value<1){n++;value=value*2;}n=-n;}else if(value>1){while(value>1){n++;value=Math.floor(value/2);}}return n;}},{key:"Repeat",value:function Repeat(value,length){return value-Math.floor(value/length)*length;}},{key:"Normalize",value:function Normalize(value,min,max){return(value-min)/(max-min);}},{key:"Denormalize",value:function Denormalize(normalized,min,max){return normalized*(max-min)+min;}},{key:"DeltaAngle",value:function DeltaAngle(current,target){var num=Scalar.Repeat(target-current,360);if(num>180){num-=360;}return num;}},{key:"PingPong",value:function PingPong(tx,length){var t=Scalar.Repeat(tx,length*2);return length-Math.abs(t-length);}},{key:"SmoothStep",value:function SmoothStep(from,to,tx){var t=Scalar.Clamp(tx);t=-2*t*t*t+3*t*t;return to*t+from*(1-t);}},{key:"MoveTowards",value:function MoveTowards(current,target,maxDelta){var result=0;if(Math.abs(target-current)<=maxDelta){result=target;}else{result=current+Scalar.Sign(target-current)*maxDelta;}return result;}},{key:"MoveTowardsAngle",value:function MoveTowardsAngle(current,target,maxDelta){var num=Scalar.DeltaAngle(current,target);var result=0;if(-maxDelta<num&&num<maxDelta){result=target;}else{target=current+num;result=Scalar.MoveTowards(current,target,maxDelta);}return result;}},{key:"Lerp",value:function Lerp(start,end,amount){return start+(end-start)*amount;}},{key:"LerpAngle",value:function LerpAngle(start,end,amount){var num=Scalar.Repeat(end-start,360);if(num>180){num-=360;}return start+num*Scalar.Clamp(amount);}},{key:"InverseLerp",value:function InverseLerp(a,b,value){var result=0;if(a!=b){result=Scalar.Clamp((value-a)/(b-a));}else{result=0;}return result;}},{key:"Hermite",value:function Hermite(value1,tangent1,value2,tangent2,amount){var squared=amount*amount;var cubed=amount*squared;var part1=2*cubed-3*squared+1;var part2=-2*cubed+3*squared;var part3=cubed-2*squared+amount;var part4=cubed-squared;return value1*part1+value2*part2+tangent1*part3+tangent2*part4;}},{key:"Hermite1stDerivative",value:function Hermite1stDerivative(value1,tangent1,value2,tangent2,time){var t2=time*time;return(t2-time)*6*value1+(3*t2-4*time+1)*tangent1+(-t2+time)*6*value2+(3*t2-2*time)*tangent2;}},{key:"RandomRange",value:function RandomRange(min,max){if(min===max){return min;}return Math.random()*(max-min)+min;}},{key:"RangeToPercent",value:function RangeToPercent(number,min,max){return(number-min)/(max-min);}},{key:"PercentToRange",value:function PercentToRange(percent,min,max){return(max-min)*percent+min;}},{key:"NormalizeRadians",value:function NormalizeRadians(angle){angle-=Scalar.TwoPi*Math.floor((angle+Math.PI)/Scalar.TwoPi);return angle;}},{key:"HCF",value:function HCF(a,b){var r=a%b;if(r===0){return b;}return Scalar.HCF(b,r);}}]);return Scalar;}();Scalar.TwoPi=Math.PI*2;// node_modules/@babylonjs/core/Maths/math.constants.js
var ToGammaSpace=1/2.2;var ToLinearSpace=2.2;var PHI=(1+Math.sqrt(5))/2;var Epsilon=1e-3;// node_modules/@babylonjs/core/Misc/arrayTools.js
var ArrayTools=/*#__PURE__*/function(){function ArrayTools(){_classCallCheck(this,ArrayTools);}_createClass(ArrayTools,null,[{key:"BuildArray",value:function BuildArray(size,itemBuilder){var a=[];for(var i=0;i<size;++i){a.push(itemBuilder());}return a;}},{key:"BuildTuple",value:function BuildTuple(size,itemBuilder){return ArrayTools.BuildArray(size,itemBuilder);}}]);return ArrayTools;}();function _observeArrayfunction(object,functionName,callback){var oldFunction=object[functionName];if(typeof oldFunction!=="function"){return null;}var newFunction=function newFunction(){var previousLength=object.length;var returnValue=newFunction.previous.apply(object,arguments);callback(functionName,previousLength);return returnValue;};oldFunction.next=newFunction;newFunction.previous=oldFunction;object[functionName]=newFunction;return function(){var previous=newFunction.previous;if(!previous){return;}var next=newFunction.next;if(next){previous.next=next;next.previous=previous;}else{previous.next=void 0;object[functionName]=previous;}newFunction.next=void 0;newFunction.previous=void 0;};}var observedArrayFunctions=["push","splice","pop","shift","unshift"];function _ObserveArray(array,callback){var unObserveFunctions=observedArrayFunctions.map(function(name135){return _observeArrayfunction(array,name135,callback);});return function(){unObserveFunctions.forEach(function(unObserveFunction){unObserveFunction===null||unObserveFunction===void 0?void 0:unObserveFunction();});};}// node_modules/@babylonjs/core/Maths/math.vector.js
var _ExtractAsInt=function _ExtractAsInt(value){return parseInt(value.toString().replace(/\W/g,""));};var Vector2=/*#__PURE__*/function(){function Vector2(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,Vector2);this.x=x;this.y=y;}_createClass(Vector2,[{key:"toString",value:function toString(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}");}},{key:"getClassName",value:function getClassName(){return"Vector2";}},{key:"getHashCode",value:function getHashCode(){var x=_ExtractAsInt(this.x);var y=_ExtractAsInt(this.y);var hash=x;hash=hash*397^y;return hash;}},{key:"toArray",value:function toArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[index]=this.x;array[index+1]=this.y;return this;}},{key:"fromArray",value:function fromArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;Vector2.FromArrayToRef(array,index,this);return this;}},{key:"asArray",value:function asArray(){var result=new Array();this.toArray(result,0);return result;}},{key:"copyFrom",value:function copyFrom(source){this.x=source.x;this.y=source.y;return this;}},{key:"copyFromFloats",value:function copyFromFloats(x,y){this.x=x;this.y=y;return this;}},{key:"set",value:function set(x,y){return this.copyFromFloats(x,y);}},{key:"add",value:function add(otherVector){return new this.constructor(this.x+otherVector.x,this.y+otherVector.y);}},{key:"addToRef",value:function addToRef(otherVector,result){result.x=this.x+otherVector.x;result.y=this.y+otherVector.y;return result;}},{key:"addInPlace",value:function addInPlace(otherVector){this.x+=otherVector.x;this.y+=otherVector.y;return this;}},{key:"addVector3",value:function addVector3(otherVector){return new this.constructor(this.x+otherVector.x,this.y+otherVector.y);}},{key:"subtract",value:function subtract(otherVector){return new this.constructor(this.x-otherVector.x,this.y-otherVector.y);}},{key:"subtractToRef",value:function subtractToRef(otherVector,result){result.x=this.x-otherVector.x;result.y=this.y-otherVector.y;return result;}},{key:"subtractInPlace",value:function subtractInPlace(otherVector){this.x-=otherVector.x;this.y-=otherVector.y;return this;}},{key:"multiplyInPlace",value:function multiplyInPlace(otherVector){this.x*=otherVector.x;this.y*=otherVector.y;return this;}},{key:"multiply",value:function multiply(otherVector){return new this.constructor(this.x*otherVector.x,this.y*otherVector.y);}},{key:"multiplyToRef",value:function multiplyToRef(otherVector,result){result.x=this.x*otherVector.x;result.y=this.y*otherVector.y;return result;}},{key:"multiplyByFloats",value:function multiplyByFloats(x,y){return new this.constructor(this.x*x,this.y*y);}},{key:"divide",value:function divide(otherVector){return new this.constructor(this.x/otherVector.x,this.y/otherVector.y);}},{key:"divideToRef",value:function divideToRef(otherVector,result){result.x=this.x/otherVector.x;result.y=this.y/otherVector.y;return result;}},{key:"divideInPlace",value:function divideInPlace(otherVector){return this.divideToRef(otherVector,this);}},{key:"negate",value:function negate(){return new this.constructor(-this.x,-this.y);}},{key:"negateInPlace",value:function negateInPlace(){this.x*=-1;this.y*=-1;return this;}},{key:"negateToRef",value:function negateToRef(result){return result.copyFromFloats(this.x*-1,this.y*-1);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this.x*=scale;this.y*=scale;return this;}},{key:"scale",value:function scale(_scale){var result=new this.constructor(0,0);this.scaleToRef(_scale,result);return result;}},{key:"scaleToRef",value:function scaleToRef(scale,result){result.x=this.x*scale;result.y=this.y*scale;return result;}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){result.x+=this.x*scale;result.y+=this.y*scale;return result;}},{key:"equals",value:function equals(otherVector){return otherVector&&this.x===otherVector.x&&this.y===otherVector.y;}},{key:"equalsWithEpsilon",value:function equalsWithEpsilon(otherVector){var epsilon=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Epsilon;return otherVector&&Scalar.WithinEpsilon(this.x,otherVector.x,epsilon)&&Scalar.WithinEpsilon(this.y,otherVector.y,epsilon);}},{key:"floor",value:function floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y));}},{key:"fract",value:function fract(){return new this.constructor(this.x-Math.floor(this.x),this.y-Math.floor(this.y));}},{key:"rotateToRef",value:function rotateToRef(angle,result){var cos=Math.cos(angle);var sin=Math.sin(angle);result.x=cos*this.x-sin*this.y;result.y=sin*this.x+cos*this.y;return result;}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y);}},{key:"lengthSquared",value:function lengthSquared(){return this.x*this.x+this.y*this.y;}},{key:"normalize",value:function normalize(){Vector2.NormalizeToRef(this,this);return this;}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y);}}],[{key:"Zero",value:function Zero(){return new Vector2(0,0);}},{key:"One",value:function One(){return new Vector2(1,1);}},{key:"Random",value:function Random(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return new Vector2(Scalar.RandomRange(min,max),Scalar.RandomRange(min,max));}},{key:"ZeroReadOnly",get:function get(){return Vector2._ZeroReadOnly;}},{key:"FromArray",value:function FromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Vector2(array[offset],array[offset+1]);}},{key:"FromArrayToRef",value:function FromArrayToRef(array,offset,result){result.x=array[offset];result.y=array[offset+1];return result;}},{key:"CatmullRom",value:function CatmullRom(value1,value2,value3,value4,amount){var squared=amount*amount;var cubed=amount*squared;var x=0.5*(2*value2.x+(-value1.x+value3.x)*amount+(2*value1.x-5*value2.x+4*value3.x-value4.x)*squared+(-value1.x+3*value2.x-3*value3.x+value4.x)*cubed);var y=0.5*(2*value2.y+(-value1.y+value3.y)*amount+(2*value1.y-5*value2.y+4*value3.y-value4.y)*squared+(-value1.y+3*value2.y-3*value3.y+value4.y)*cubed);return new value1.constructor(x,y);}},{key:"Clamp",value:function Clamp(value,min,max){var x=value.x;x=x>max.x?max.x:x;x=x<min.x?min.x:x;var y=value.y;y=y>max.y?max.y:y;y=y<min.y?min.y:y;return new value.constructor(x,y);}},{key:"Hermite",value:function Hermite(value1,tangent1,value2,tangent2,amount){var squared=amount*amount;var cubed=amount*squared;var part1=2*cubed-3*squared+1;var part2=-2*cubed+3*squared;var part3=cubed-2*squared+amount;var part4=cubed-squared;var x=value1.x*part1+value2.x*part2+tangent1.x*part3+tangent2.x*part4;var y=value1.y*part1+value2.y*part2+tangent1.y*part3+tangent2.y*part4;return new value1.constructor(x,y);}},{key:"Hermite1stDerivative",value:function Hermite1stDerivative(value1,tangent1,value2,tangent2,time){var result=new value1.constructor();this.Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result);return result;}},{key:"Hermite1stDerivativeToRef",value:function Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result){var t2=time*time;result.x=(t2-time)*6*value1.x+(3*t2-4*time+1)*tangent1.x+(-t2+time)*6*value2.x+(3*t2-2*time)*tangent2.x;result.y=(t2-time)*6*value1.y+(3*t2-4*time+1)*tangent1.y+(-t2+time)*6*value2.y+(3*t2-2*time)*tangent2.y;return result;}},{key:"Lerp",value:function Lerp(start,end,amount){var x=start.x+(end.x-start.x)*amount;var y=start.y+(end.y-start.y)*amount;return new start.constructor(x,y);}},{key:"Dot",value:function Dot(left,right){return left.x*right.x+left.y*right.y;}},{key:"Normalize",value:function Normalize(vector){var newVector=new vector.constructor();this.NormalizeToRef(vector,newVector);return newVector;}},{key:"NormalizeToRef",value:function NormalizeToRef(vector,result){var len=vector.length();if(len===0){return result;}result.x=vector.x/len;result.y=vector.y/len;return result;}},{key:"Minimize",value:function Minimize(left,right){var x=left.x<right.x?left.x:right.x;var y=left.y<right.y?left.y:right.y;return new left.constructor(x,y);}},{key:"Maximize",value:function Maximize(left,right){var x=left.x>right.x?left.x:right.x;var y=left.y>right.y?left.y:right.y;return new left.constructor(x,y);}},{key:"Transform",value:function Transform(vector,transformation){var result=new vector.constructor();Vector2.TransformToRef(vector,transformation,result);return result;}},{key:"TransformToRef",value:function TransformToRef(vector,transformation,result){var m=transformation.m;var x=vector.x*m[0]+vector.y*m[4]+m[12];var y=vector.x*m[1]+vector.y*m[5]+m[13];result.x=x;result.y=y;return result;}},{key:"PointInTriangle",value:function PointInTriangle(p,p0,p1,p2){var a=1/2*(-p1.y*p2.x+p0.y*(-p1.x+p2.x)+p0.x*(p1.y-p2.y)+p1.x*p2.y);var sign=a<0?-1:1;var s=(p0.y*p2.x-p0.x*p2.y+(p2.y-p0.y)*p.x+(p0.x-p2.x)*p.y)*sign;var t=(p0.x*p1.y-p0.y*p1.x+(p0.y-p1.y)*p.x+(p1.x-p0.x)*p.y)*sign;return s>0&&t>0&&s+t<2*a*sign;}},{key:"Distance",value:function Distance(value1,value2){return Math.sqrt(Vector2.DistanceSquared(value1,value2));}},{key:"DistanceSquared",value:function DistanceSquared(value1,value2){var x=value1.x-value2.x;var y=value1.y-value2.y;return x*x+y*y;}},{key:"Center",value:function Center(value1,value2){var result=new value1.constructor();return Vector2.CenterToRef(value1,value2,result);}},{key:"CenterToRef",value:function CenterToRef(value1,value2,ref){return ref.copyFromFloats((value1.x+value2.x)/2,(value1.y+value2.y)/2);}},{key:"DistanceOfPointFromSegment",value:function DistanceOfPointFromSegment(p,segA,segB){var l2=Vector2.DistanceSquared(segA,segB);if(l2===0){return Vector2.Distance(p,segA);}var v=segB.subtract(segA);var t=Math.max(0,Math.min(1,Vector2.Dot(p.subtract(segA),v)/l2));var proj=segA.add(v.multiplyByFloats(t,t));return Vector2.Distance(p,proj);}}]);return Vector2;}();Vector2._ZeroReadOnly=Vector2.Zero();var Vector3=/*#__PURE__*/function(){function Vector3(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Vector3);this._isDirty=true;this._x=x;this._y=y;this._z=z;}_createClass(Vector3,[{key:"x",get:function get(){return this._x;},set:function set(value){this._x=value;this._isDirty=true;}},{key:"y",get:function get(){return this._y;},set:function set(value){this._y=value;this._isDirty=true;}},{key:"z",get:function get(){return this._z;},set:function set(value){this._z=value;this._isDirty=true;}},{key:"toString",value:function toString(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}");}},{key:"getClassName",value:function getClassName(){return"Vector3";}},{key:"getHashCode",value:function getHashCode(){var x=_ExtractAsInt(this._x);var y=_ExtractAsInt(this._y);var z=_ExtractAsInt(this._z);var hash=x;hash=hash*397^y;hash=hash*397^z;return hash;}},{key:"asArray",value:function asArray(){var result=[];this.toArray(result,0);return result;}},{key:"toArray",value:function toArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[index]=this._x;array[index+1]=this._y;array[index+2]=this._z;return this;}},{key:"fromArray",value:function fromArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;Vector3.FromArrayToRef(array,index,this);return this;}},{key:"toQuaternion",value:function toQuaternion(){return Quaternion.RotationYawPitchRoll(this._y,this._x,this._z);}},{key:"addInPlace",value:function addInPlace(otherVector){return this.addInPlaceFromFloats(otherVector._x,otherVector._y,otherVector._z);}},{key:"addInPlaceFromFloats",value:function addInPlaceFromFloats(x,y,z){this._x+=x;this._y+=y;this._z+=z;this._isDirty=true;return this;}},{key:"add",value:function add(otherVector){return new this.constructor(this._x+otherVector._x,this._y+otherVector._y,this._z+otherVector._z);}},{key:"addToRef",value:function addToRef(otherVector,result){return result.copyFromFloats(this._x+otherVector._x,this._y+otherVector._y,this._z+otherVector._z);}},{key:"subtractInPlace",value:function subtractInPlace(otherVector){this._x-=otherVector._x;this._y-=otherVector._y;this._z-=otherVector._z;this._isDirty=true;return this;}},{key:"subtract",value:function subtract(otherVector){return new this.constructor(this._x-otherVector._x,this._y-otherVector._y,this._z-otherVector._z);}},{key:"subtractToRef",value:function subtractToRef(otherVector,result){return this.subtractFromFloatsToRef(otherVector._x,otherVector._y,otherVector._z,result);}},{key:"subtractFromFloats",value:function subtractFromFloats(x,y,z){return new this.constructor(this._x-x,this._y-y,this._z-z);}},{key:"subtractFromFloatsToRef",value:function subtractFromFloatsToRef(x,y,z,result){return result.copyFromFloats(this._x-x,this._y-y,this._z-z);}},{key:"negate",value:function negate(){return new this.constructor(-this._x,-this._y,-this._z);}},{key:"negateInPlace",value:function negateInPlace(){this._x*=-1;this._y*=-1;this._z*=-1;this._isDirty=true;return this;}},{key:"negateToRef",value:function negateToRef(result){return result.copyFromFloats(this._x*-1,this._y*-1,this._z*-1);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this._x*=scale;this._y*=scale;this._z*=scale;this._isDirty=true;return this;}},{key:"scale",value:function scale(_scale2){return new this.constructor(this._x*_scale2,this._y*_scale2,this._z*_scale2);}},{key:"scaleToRef",value:function scaleToRef(scale,result){return result.copyFromFloats(this._x*scale,this._y*scale,this._z*scale);}},{key:"getNormalToRef",value:function getNormalToRef(result){var radius=this.length();var theta=Math.acos(this.y/radius);var phi=Math.atan2(this.z,this.x);if(theta>Math.PI/2){theta-=Math.PI/2;}else{theta+=Math.PI/2;}var x=radius*Math.sin(theta)*Math.cos(phi);var y=radius*Math.cos(theta);var z=radius*Math.sin(theta)*Math.sin(phi);result.set(x,y,z);return result;}},{key:"applyRotationQuaternionToRef",value:function applyRotationQuaternionToRef(q,result){var ix=q._w*this._x+q._y*this._z-q._z*this._y;var iy=q._w*this._y+q._z*this._x-q._x*this._z;var iz=q._w*this._z+q._x*this._y-q._y*this._x;var iw=-q._x*this._x-q._y*this._y-q._z*this._z;result._x=ix*q._w+iw*-q._x+iy*-q._z-iz*-q._y;result._y=iy*q._w+iw*-q._y+iz*-q._x-ix*-q._z;result._z=iz*q._w+iw*-q._z+ix*-q._y-iy*-q._x;result._isDirty=true;return result;}},{key:"applyRotationQuaternionInPlace",value:function applyRotationQuaternionInPlace(q){return this.applyRotationQuaternionToRef(q,this);}},{key:"applyRotationQuaternion",value:function applyRotationQuaternion(q){return this.applyRotationQuaternionToRef(q,new this.constructor());}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){return result.addInPlaceFromFloats(this._x*scale,this._y*scale,this._z*scale);}},{key:"projectOnPlane",value:function projectOnPlane(plane,origin){var result=new this.constructor();this.projectOnPlaneToRef(plane,origin,result);return result;}},{key:"projectOnPlaneToRef",value:function projectOnPlaneToRef(plane,origin,result){var n=plane.normal;var d=plane.d;var V=MathTmp.Vector3[0];this.subtractToRef(origin,V);V.normalize();var denom=Vector3.Dot(V,n);if(Math.abs(denom)<Math.pow(10,-10)){result.setAll(Infinity);}else{var t=-(Vector3.Dot(origin,n)+d)/denom;var scaledV=V.scaleInPlace(t);origin.addToRef(scaledV,result);}return result;}},{key:"equals",value:function equals(otherVector){return otherVector&&this._x===otherVector._x&&this._y===otherVector._y&&this._z===otherVector._z;}},{key:"equalsWithEpsilon",value:function equalsWithEpsilon(otherVector){var epsilon=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Epsilon;return otherVector&&Scalar.WithinEpsilon(this._x,otherVector._x,epsilon)&&Scalar.WithinEpsilon(this._y,otherVector._y,epsilon)&&Scalar.WithinEpsilon(this._z,otherVector._z,epsilon);}},{key:"equalsToFloats",value:function equalsToFloats(x,y,z){return this._x===x&&this._y===y&&this._z===z;}},{key:"multiplyInPlace",value:function multiplyInPlace(otherVector){this._x*=otherVector._x;this._y*=otherVector._y;this._z*=otherVector._z;this._isDirty=true;return this;}},{key:"multiply",value:function multiply(otherVector){return this.multiplyByFloats(otherVector._x,otherVector._y,otherVector._z);}},{key:"multiplyToRef",value:function multiplyToRef(otherVector,result){return result.copyFromFloats(this._x*otherVector._x,this._y*otherVector._y,this._z*otherVector._z);}},{key:"multiplyByFloats",value:function multiplyByFloats(x,y,z){return new this.constructor(this._x*x,this._y*y,this._z*z);}},{key:"divide",value:function divide(otherVector){return new this.constructor(this._x/otherVector._x,this._y/otherVector._y,this._z/otherVector._z);}},{key:"divideToRef",value:function divideToRef(otherVector,result){return result.copyFromFloats(this._x/otherVector._x,this._y/otherVector._y,this._z/otherVector._z);}},{key:"divideInPlace",value:function divideInPlace(otherVector){return this.divideToRef(otherVector,this);}},{key:"minimizeInPlace",value:function minimizeInPlace(other){return this.minimizeInPlaceFromFloats(other._x,other._y,other._z);}},{key:"maximizeInPlace",value:function maximizeInPlace(other){return this.maximizeInPlaceFromFloats(other._x,other._y,other._z);}},{key:"minimizeInPlaceFromFloats",value:function minimizeInPlaceFromFloats(x,y,z){if(x<this._x){this.x=x;}if(y<this._y){this.y=y;}if(z<this._z){this.z=z;}return this;}},{key:"maximizeInPlaceFromFloats",value:function maximizeInPlaceFromFloats(x,y,z){if(x>this._x){this.x=x;}if(y>this._y){this.y=y;}if(z>this._z){this.z=z;}return this;}},{key:"isNonUniformWithinEpsilon",value:function isNonUniformWithinEpsilon(epsilon){var absX=Math.abs(this._x);var absY=Math.abs(this._y);if(!Scalar.WithinEpsilon(absX,absY,epsilon)){return true;}var absZ=Math.abs(this._z);if(!Scalar.WithinEpsilon(absX,absZ,epsilon)){return true;}if(!Scalar.WithinEpsilon(absY,absZ,epsilon)){return true;}return false;}},{key:"isNonUniform",get:function get(){var absX=Math.abs(this._x);var absY=Math.abs(this._y);if(absX!==absY){return true;}var absZ=Math.abs(this._z);if(absX!==absZ){return true;}return false;}},{key:"floor",value:function floor(){return new this.constructor(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z));}},{key:"fract",value:function fract(){return new this.constructor(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z));}},{key:"length",value:function length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z);}},{key:"lengthSquared",value:function lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z;}},{key:"hasAZeroComponent",get:function get(){return this._x*this._y*this._z===0;}},{key:"normalize",value:function normalize(){return this.normalizeFromLength(this.length());}},{key:"reorderInPlace",value:function reorderInPlace(order){var _this35=this;order=order.toLowerCase();if(order==="xyz"){return this;}MathTmp.Vector3[0].copyFrom(this);["x","y","z"].forEach(function(val,i){_this35[val]=MathTmp.Vector3[0][order[i]];});return this;}},{key:"rotateByQuaternionToRef",value:function rotateByQuaternionToRef(quaternion,result){quaternion.toRotationMatrix(MathTmp.Matrix[0]);Vector3.TransformCoordinatesToRef(this,MathTmp.Matrix[0],result);return result;}},{key:"rotateByQuaternionAroundPointToRef",value:function rotateByQuaternionAroundPointToRef(quaternion,point,result){this.subtractToRef(point,MathTmp.Vector3[0]);MathTmp.Vector3[0].rotateByQuaternionToRef(quaternion,MathTmp.Vector3[0]);point.addToRef(MathTmp.Vector3[0],result);return result;}},{key:"cross",value:function cross(other){var result=new this.constructor();return Vector3.CrossToRef(this,other,result);}},{key:"normalizeFromLength",value:function normalizeFromLength(len){if(len===0||len===1){return this;}return this.scaleInPlace(1/len);}},{key:"normalizeToNew",value:function normalizeToNew(){var normalized=new this.constructor(0,0,0);this.normalizeToRef(normalized);return normalized;}},{key:"normalizeToRef",value:function normalizeToRef(reference){var len=this.length();if(len===0||len===1){return reference.copyFromFloats(this._x,this._y,this._z);}return this.scaleToRef(1/len,reference);}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z);}},{key:"copyFrom",value:function copyFrom(source){return this.copyFromFloats(source._x,source._y,source._z);}},{key:"copyFromFloats",value:function copyFromFloats(x,y,z){this._x=x;this._y=y;this._z=z;this._isDirty=true;return this;}},{key:"set",value:function set(x,y,z){return this.copyFromFloats(x,y,z);}},{key:"setAll",value:function setAll(v){this._x=this._y=this._z=v;this._isDirty=true;return this;}}],[{key:"GetClipFactor",value:function GetClipFactor(vector0,vector1,axis,size){var d0=Vector3.Dot(vector0,axis)-size;var d1=Vector3.Dot(vector1,axis)-size;var s=d0/(d0-d1);return s;}},{key:"GetAngleBetweenVectors",value:function GetAngleBetweenVectors(vector0,vector1,normal){var v0=vector0.normalizeToRef(MathTmp.Vector3[1]);var v1=vector1.normalizeToRef(MathTmp.Vector3[2]);var dot=Vector3.Dot(v0,v1);dot=Scalar.Clamp(dot,-1,1);var angle=Math.acos(dot);var n=MathTmp.Vector3[3];Vector3.CrossToRef(v0,v1,n);if(Vector3.Dot(n,normal)>0){return isNaN(angle)?0:angle;}return isNaN(angle)?-Math.PI:-Math.acos(dot);}},{key:"GetAngleBetweenVectorsOnPlane",value:function GetAngleBetweenVectorsOnPlane(vector0,vector1,normal){MathTmp.Vector3[0].copyFrom(vector0);var v0=MathTmp.Vector3[0];MathTmp.Vector3[1].copyFrom(vector1);var v1=MathTmp.Vector3[1];MathTmp.Vector3[2].copyFrom(normal);var vNormal=MathTmp.Vector3[2];var right=MathTmp.Vector3[3];var forward=MathTmp.Vector3[4];v0.normalize();v1.normalize();vNormal.normalize();Vector3.CrossToRef(vNormal,v0,right);Vector3.CrossToRef(right,vNormal,forward);var angle=Math.atan2(Vector3.Dot(v1,right),Vector3.Dot(v1,forward));return Scalar.NormalizeRadians(angle);}},{key:"PitchYawRollToMoveBetweenPointsToRef",value:function PitchYawRollToMoveBetweenPointsToRef(start,target,ref){var diff=TmpVectors.Vector3[0];target.subtractToRef(start,diff);ref._y=Math.atan2(diff.x,diff.z)||0;ref._x=Math.atan2(Math.sqrt(Math.pow(diff.x,2)+Math.pow(diff.z,2)),diff.y)||0;ref._z=0;ref._isDirty=true;return ref;}},{key:"PitchYawRollToMoveBetweenPoints",value:function PitchYawRollToMoveBetweenPoints(start,target){var ref=Vector3.Zero();return Vector3.PitchYawRollToMoveBetweenPointsToRef(start,target,ref);}},{key:"SlerpToRef",value:function SlerpToRef(vector0,vector1,slerp,result){slerp=Scalar.Clamp(slerp,0,1);var vector0Dir=MathTmp.Vector3[0];var vector1Dir=MathTmp.Vector3[1];vector0Dir.copyFrom(vector0);var vector0Length=vector0Dir.length();vector0Dir.normalizeFromLength(vector0Length);vector1Dir.copyFrom(vector1);var vector1Length=vector1Dir.length();vector1Dir.normalizeFromLength(vector1Length);var dot=Vector3.Dot(vector0Dir,vector1Dir);var scale0;var scale1;if(dot<1-Epsilon){var omega=Math.acos(dot);var invSin=1/Math.sin(omega);scale0=Math.sin((1-slerp)*omega)*invSin;scale1=Math.sin(slerp*omega)*invSin;}else{scale0=1-slerp;scale1=slerp;}vector0Dir.scaleInPlace(scale0);vector1Dir.scaleInPlace(scale1);result.copyFrom(vector0Dir).addInPlace(vector1Dir);result.scaleInPlace(Scalar.Lerp(vector0Length,vector1Length,slerp));return result;}},{key:"SmoothToRef",value:function SmoothToRef(source,goal,deltaTime,lerpTime,result){Vector3.SlerpToRef(source,goal,lerpTime===0?1:deltaTime/lerpTime,result);return result;}},{key:"FromArray",value:function FromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Vector3(array[offset],array[offset+1],array[offset+2]);}},{key:"FromFloatArray",value:function FromFloatArray(array,offset){return Vector3.FromArray(array,offset);}},{key:"FromArrayToRef",value:function FromArrayToRef(array,offset,result){result._x=array[offset];result._y=array[offset+1];result._z=array[offset+2];result._isDirty=true;return result;}},{key:"FromFloatArrayToRef",value:function FromFloatArrayToRef(array,offset,result){return Vector3.FromArrayToRef(array,offset,result);}},{key:"FromFloatsToRef",value:function FromFloatsToRef(x,y,z,result){result.copyFromFloats(x,y,z);return result;}},{key:"Zero",value:function Zero(){return new Vector3(0,0,0);}},{key:"One",value:function One(){return new Vector3(1,1,1);}},{key:"Up",value:function Up(){return new Vector3(0,1,0);}},{key:"UpReadOnly",get:function get(){return Vector3._UpReadOnly;}},{key:"DownReadOnly",get:function get(){return Vector3._DownReadOnly;}},{key:"RightReadOnly",get:function get(){return Vector3._RightReadOnly;}},{key:"LeftReadOnly",get:function get(){return Vector3._LeftReadOnly;}},{key:"LeftHandedForwardReadOnly",get:function get(){return Vector3._LeftHandedForwardReadOnly;}},{key:"RightHandedForwardReadOnly",get:function get(){return Vector3._RightHandedForwardReadOnly;}},{key:"ZeroReadOnly",get:function get(){return Vector3._ZeroReadOnly;}},{key:"Down",value:function Down(){return new Vector3(0,-1,0);}},{key:"Forward",value:function Forward(){var rightHandedSystem=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Vector3(0,0,rightHandedSystem?-1:1);}},{key:"Backward",value:function Backward(){var rightHandedSystem=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Vector3(0,0,rightHandedSystem?1:-1);}},{key:"Right",value:function Right(){return new Vector3(1,0,0);}},{key:"Left",value:function Left(){return new Vector3(-1,0,0);}},{key:"Random",value:function Random(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return new Vector3(Scalar.RandomRange(min,max),Scalar.RandomRange(min,max),Scalar.RandomRange(min,max));}},{key:"TransformCoordinates",value:function TransformCoordinates(vector,transformation){var result=Vector3.Zero();Vector3.TransformCoordinatesToRef(vector,transformation,result);return result;}},{key:"TransformCoordinatesToRef",value:function TransformCoordinatesToRef(vector,transformation,result){Vector3.TransformCoordinatesFromFloatsToRef(vector._x,vector._y,vector._z,transformation,result);return result;}},{key:"TransformCoordinatesFromFloatsToRef",value:function TransformCoordinatesFromFloatsToRef(x,y,z,transformation,result){var m=transformation.m;var rx=x*m[0]+y*m[4]+z*m[8]+m[12];var ry=x*m[1]+y*m[5]+z*m[9]+m[13];var rz=x*m[2]+y*m[6]+z*m[10]+m[14];var rw=1/(x*m[3]+y*m[7]+z*m[11]+m[15]);result._x=rx*rw;result._y=ry*rw;result._z=rz*rw;result._isDirty=true;return result;}},{key:"TransformNormal",value:function TransformNormal(vector,transformation){var result=Vector3.Zero();Vector3.TransformNormalToRef(vector,transformation,result);return result;}},{key:"TransformNormalToRef",value:function TransformNormalToRef(vector,transformation,result){this.TransformNormalFromFloatsToRef(vector._x,vector._y,vector._z,transformation,result);return result;}},{key:"TransformNormalFromFloatsToRef",value:function TransformNormalFromFloatsToRef(x,y,z,transformation,result){var m=transformation.m;result._x=x*m[0]+y*m[4]+z*m[8];result._y=x*m[1]+y*m[5]+z*m[9];result._z=x*m[2]+y*m[6]+z*m[10];result._isDirty=true;return result;}},{key:"CatmullRom",value:function CatmullRom(value1,value2,value3,value4,amount){var squared=amount*amount;var cubed=amount*squared;var x=0.5*(2*value2._x+(-value1._x+value3._x)*amount+(2*value1._x-5*value2._x+4*value3._x-value4._x)*squared+(-value1._x+3*value2._x-3*value3._x+value4._x)*cubed);var y=0.5*(2*value2._y+(-value1._y+value3._y)*amount+(2*value1._y-5*value2._y+4*value3._y-value4._y)*squared+(-value1._y+3*value2._y-3*value3._y+value4._y)*cubed);var z=0.5*(2*value2._z+(-value1._z+value3._z)*amount+(2*value1._z-5*value2._z+4*value3._z-value4._z)*squared+(-value1._z+3*value2._z-3*value3._z+value4._z)*cubed);return new value1.constructor(x,y,z);}},{key:"Clamp",value:function Clamp(value,min,max){var result=new value.constructor();Vector3.ClampToRef(value,min,max,result);return result;}},{key:"ClampToRef",value:function ClampToRef(value,min,max,result){var x=value._x;x=x>max._x?max._x:x;x=x<min._x?min._x:x;var y=value._y;y=y>max._y?max._y:y;y=y<min._y?min._y:y;var z=value._z;z=z>max._z?max._z:z;z=z<min._z?min._z:z;result.copyFromFloats(x,y,z);return result;}},{key:"CheckExtends",value:function CheckExtends(v,min,max){min.minimizeInPlace(v);max.maximizeInPlace(v);}},{key:"Hermite",value:function Hermite(value1,tangent1,value2,tangent2,amount){var squared=amount*amount;var cubed=amount*squared;var part1=2*cubed-3*squared+1;var part2=-2*cubed+3*squared;var part3=cubed-2*squared+amount;var part4=cubed-squared;var x=value1._x*part1+value2._x*part2+tangent1._x*part3+tangent2._x*part4;var y=value1._y*part1+value2._y*part2+tangent1._y*part3+tangent2._y*part4;var z=value1._z*part1+value2._z*part2+tangent1._z*part3+tangent2._z*part4;return new value1.constructor(x,y,z);}},{key:"Hermite1stDerivative",value:function Hermite1stDerivative(value1,tangent1,value2,tangent2,time){var result=new value1.constructor();this.Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result);return result;}},{key:"Hermite1stDerivativeToRef",value:function Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result){var t2=time*time;result._x=(t2-time)*6*value1._x+(3*t2-4*time+1)*tangent1._x+(-t2+time)*6*value2._x+(3*t2-2*time)*tangent2._x;result._y=(t2-time)*6*value1._y+(3*t2-4*time+1)*tangent1._y+(-t2+time)*6*value2._y+(3*t2-2*time)*tangent2._y;result._z=(t2-time)*6*value1._z+(3*t2-4*time+1)*tangent1._z+(-t2+time)*6*value2._z+(3*t2-2*time)*tangent2._z;result._isDirty=true;return result;}},{key:"Lerp",value:function Lerp(start,end,amount){var result=new start.constructor(0,0,0);Vector3.LerpToRef(start,end,amount,result);return result;}},{key:"LerpToRef",value:function LerpToRef(start,end,amount,result){result._x=start._x+(end._x-start._x)*amount;result._y=start._y+(end._y-start._y)*amount;result._z=start._z+(end._z-start._z)*amount;result._isDirty=true;return result;}},{key:"Dot",value:function Dot(left,right){return left._x*right._x+left._y*right._y+left._z*right._z;}},{key:"Cross",value:function Cross(left,right){var result=new left.constructor();Vector3.CrossToRef(left,right,result);return result;}},{key:"CrossToRef",value:function CrossToRef(left,right,result){var x=left._y*right._z-left._z*right._y;var y=left._z*right._x-left._x*right._z;var z=left._x*right._y-left._y*right._x;result.copyFromFloats(x,y,z);return result;}},{key:"Normalize",value:function Normalize(vector){var result=Vector3.Zero();Vector3.NormalizeToRef(vector,result);return result;}},{key:"NormalizeToRef",value:function NormalizeToRef(vector,result){vector.normalizeToRef(result);return result;}},{key:"Project",value:function Project(vector,world,transform,viewport){var result=new vector.constructor();Vector3.ProjectToRef(vector,world,transform,viewport,result);return result;}},{key:"ProjectToRef",value:function ProjectToRef(vector,world,transform,viewport,result){var cw=viewport.width;var ch=viewport.height;var cx=viewport.x;var cy=viewport.y;var viewportMatrix=MathTmp.Matrix[1];Matrix.FromValuesToRef(cw/2,0,0,0,0,-ch/2,0,0,0,0,0.5,0,cx+cw/2,ch/2+cy,0.5,1,viewportMatrix);var matrix=MathTmp.Matrix[0];world.multiplyToRef(transform,matrix);matrix.multiplyToRef(viewportMatrix,matrix);Vector3.TransformCoordinatesToRef(vector,matrix,result);return result;}},{key:"Reflect",value:function Reflect(inDirection,normal){return this.ReflectToRef(inDirection,normal,new Vector3());}},{key:"ReflectToRef",value:function ReflectToRef(inDirection,normal,ref){var tmp=TmpVectors.Vector3[0];tmp.copyFrom(normal).scaleInPlace(2*Vector3.Dot(inDirection,normal));return ref.copyFrom(inDirection).subtractInPlace(tmp);}},{key:"_UnprojectFromInvertedMatrixToRef",value:function _UnprojectFromInvertedMatrixToRef(source,matrix,result){Vector3.TransformCoordinatesToRef(source,matrix,result);var m=matrix.m;var num=source._x*m[3]+source._y*m[7]+source._z*m[11]+m[15];if(Scalar.WithinEpsilon(num,1)){result.scaleInPlace(1/num);}return result;}},{key:"UnprojectFromTransform",value:function UnprojectFromTransform(source,viewportWidth,viewportHeight,world,transform){return this.Unproject(source,viewportWidth,viewportHeight,world,transform,Matrix.IdentityReadOnly);}},{key:"Unproject",value:function Unproject(source,viewportWidth,viewportHeight,world,view,projection){var result=new source.constructor();Vector3.UnprojectToRef(source,viewportWidth,viewportHeight,world,view,projection,result);return result;}},{key:"UnprojectToRef",value:function UnprojectToRef(source,viewportWidth,viewportHeight,world,view,projection,result){Vector3.UnprojectFloatsToRef(source._x,source._y,source._z,viewportWidth,viewportHeight,world,view,projection,result);return result;}},{key:"UnprojectFloatsToRef",value:function UnprojectFloatsToRef(sourceX,sourceY,sourceZ,viewportWidth,viewportHeight,world,view,projection,result){var _a;var matrix=MathTmp.Matrix[0];world.multiplyToRef(view,matrix);matrix.multiplyToRef(projection,matrix);matrix.invert();var screenSource=MathTmp.Vector3[0];screenSource.x=sourceX/viewportWidth*2-1;screenSource.y=-(sourceY/viewportHeight*2-1);if((_a=EngineStore.LastCreatedEngine)===null||_a===void 0?void 0:_a.isNDCHalfZRange){screenSource.z=sourceZ;}else{screenSource.z=2*sourceZ-1;}Vector3._UnprojectFromInvertedMatrixToRef(screenSource,matrix,result);return result;}},{key:"Minimize",value:function Minimize(left,right){var min=new left.constructor();min.copyFrom(left);min.minimizeInPlace(right);return min;}},{key:"Maximize",value:function Maximize(left,right){var max=new left.constructor();max.copyFrom(left);max.maximizeInPlace(right);return max;}},{key:"Distance",value:function Distance(value1,value2){return Math.sqrt(Vector3.DistanceSquared(value1,value2));}},{key:"DistanceSquared",value:function DistanceSquared(value1,value2){var x=value1._x-value2._x;var y=value1._y-value2._y;var z=value1._z-value2._z;return x*x+y*y+z*z;}},{key:"ProjectOnTriangleToRef",value:function ProjectOnTriangleToRef(vector,p0,p1,p2,ref){var p1p0=MathTmp.Vector3[0];var p2p0=MathTmp.Vector3[1];var p2p1=MathTmp.Vector3[2];var normal=MathTmp.Vector3[3];var vectorp0=MathTmp.Vector3[4];p1.subtractToRef(p0,p1p0);p2.subtractToRef(p0,p2p0);p2.subtractToRef(p1,p2p1);var p1p0L=p1p0.length();var p2p0L=p2p0.length();var p2p1L=p2p1.length();if(p1p0L<Epsilon||p2p0L<Epsilon||p2p1L<Epsilon){ref.copyFrom(p0);return Vector3.Distance(vector,p0);}vector.subtractToRef(p0,vectorp0);Vector3.CrossToRef(p1p0,p2p0,normal);var nl=normal.length();if(nl<Epsilon){ref.copyFrom(p0);return Vector3.Distance(vector,p0);}normal.normalizeFromLength(nl);var l=vectorp0.length();if(l<Epsilon){ref.copyFrom(p0);return 0;}vectorp0.normalizeFromLength(l);var cosA=Vector3.Dot(normal,vectorp0);var projVector=MathTmp.Vector3[5];var proj=MathTmp.Vector3[6];projVector.copyFrom(normal).scaleInPlace(-l*cosA);proj.copyFrom(vector).addInPlace(projVector);var v0=MathTmp.Vector3[4];var v1=MathTmp.Vector3[5];var v2=MathTmp.Vector3[7];var tmp=MathTmp.Vector3[8];v0.copyFrom(p1p0).scaleInPlace(1/p1p0L);tmp.copyFrom(p2p0).scaleInPlace(1/p2p0L);v0.addInPlace(tmp).scaleInPlace(-1);v1.copyFrom(p1p0).scaleInPlace(-1/p1p0L);tmp.copyFrom(p2p1).scaleInPlace(1/p2p1L);v1.addInPlace(tmp).scaleInPlace(-1);v2.copyFrom(p2p1).scaleInPlace(-1/p2p1L);tmp.copyFrom(p2p0).scaleInPlace(-1/p2p0L);v2.addInPlace(tmp).scaleInPlace(-1);var projP=MathTmp.Vector3[9];var dot;projP.copyFrom(proj).subtractInPlace(p0);Vector3.CrossToRef(v0,projP,tmp);dot=Vector3.Dot(tmp,normal);var s0=dot;projP.copyFrom(proj).subtractInPlace(p1);Vector3.CrossToRef(v1,projP,tmp);dot=Vector3.Dot(tmp,normal);var s1=dot;projP.copyFrom(proj).subtractInPlace(p2);Vector3.CrossToRef(v2,projP,tmp);dot=Vector3.Dot(tmp,normal);var s2=dot;var edge=MathTmp.Vector3[10];var e0,e1;if(s0>0&&s1<0){edge.copyFrom(p1p0);e0=p0;e1=p1;}else if(s1>0&&s2<0){edge.copyFrom(p2p1);e0=p1;e1=p2;}else{edge.copyFrom(p2p0).scaleInPlace(-1);e0=p2;e1=p0;}var tmp2=MathTmp.Vector3[9];var tmp3=MathTmp.Vector3[4];e0.subtractToRef(proj,tmp);e1.subtractToRef(proj,tmp2);Vector3.CrossToRef(tmp,tmp2,tmp3);var isOutside=Vector3.Dot(tmp3,normal)<0;if(!isOutside){ref.copyFrom(proj);return Math.abs(l*cosA);}var r=MathTmp.Vector3[5];Vector3.CrossToRef(edge,tmp3,r);r.normalize();var e0proj=MathTmp.Vector3[9];e0proj.copyFrom(e0).subtractInPlace(proj);var e0projL=e0proj.length();if(e0projL<Epsilon){ref.copyFrom(e0);return Vector3.Distance(vector,e0);}e0proj.normalizeFromLength(e0projL);var cosG=Vector3.Dot(r,e0proj);var triProj=MathTmp.Vector3[7];triProj.copyFrom(proj).addInPlace(r.scaleInPlace(e0projL*cosG));tmp.copyFrom(triProj).subtractInPlace(e0);l=edge.length();edge.normalizeFromLength(l);var t=Vector3.Dot(tmp,edge)/Math.max(l,Epsilon);t=Scalar.Clamp(t,0,1);triProj.copyFrom(e0).addInPlace(edge.scaleInPlace(t*l));ref.copyFrom(triProj);return Vector3.Distance(vector,triProj);}},{key:"Center",value:function Center(value1,value2){return Vector3.CenterToRef(value1,value2,Vector3.Zero());}},{key:"CenterToRef",value:function CenterToRef(value1,value2,ref){return ref.copyFromFloats((value1._x+value2._x)/2,(value1._y+value2._y)/2,(value1._z+value2._z)/2);}},{key:"RotationFromAxis",value:function RotationFromAxis(axis1,axis2,axis3){var rotation=new axis1.constructor();Vector3.RotationFromAxisToRef(axis1,axis2,axis3,rotation);return rotation;}},{key:"RotationFromAxisToRef",value:function RotationFromAxisToRef(axis1,axis2,axis3,ref){var quat=MathTmp.Quaternion[0];Quaternion.RotationQuaternionFromAxisToRef(axis1,axis2,axis3,quat);quat.toEulerAnglesToRef(ref);return ref;}}]);return Vector3;}();Vector3._UpReadOnly=Vector3.Up();Vector3._DownReadOnly=Vector3.Down();Vector3._LeftHandedForwardReadOnly=Vector3.Forward(false);Vector3._RightHandedForwardReadOnly=Vector3.Forward(true);Vector3._RightReadOnly=Vector3.Right();Vector3._LeftReadOnly=Vector3.Left();Vector3._ZeroReadOnly=Vector3.Zero();var Vector4=/*#__PURE__*/function(){function Vector4(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,Vector4);this.x=x;this.y=y;this.z=z;this.w=w;}_createClass(Vector4,[{key:"toString",value:function toString(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}");}},{key:"getClassName",value:function getClassName(){return"Vector4";}},{key:"getHashCode",value:function getHashCode(){var x=_ExtractAsInt(this.x);var y=_ExtractAsInt(this.y);var z=_ExtractAsInt(this.z);var w=_ExtractAsInt(this.w);var hash=x;hash=hash*397^y;hash=hash*397^z;hash=hash*397^w;return hash;}},{key:"asArray",value:function asArray(){var result=new Array();this.toArray(result,0);return result;}},{key:"toArray",value:function toArray(array,index){if(index===void 0){index=0;}array[index]=this.x;array[index+1]=this.y;array[index+2]=this.z;array[index+3]=this.w;return this;}},{key:"fromArray",value:function fromArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;Vector4.FromArrayToRef(array,index,this);return this;}},{key:"addInPlace",value:function addInPlace(otherVector){this.x+=otherVector.x;this.y+=otherVector.y;this.z+=otherVector.z;this.w+=otherVector.w;return this;}},{key:"add",value:function add(otherVector){return new this.constructor(this.x+otherVector.x,this.y+otherVector.y,this.z+otherVector.z,this.w+otherVector.w);}},{key:"addToRef",value:function addToRef(otherVector,result){result.x=this.x+otherVector.x;result.y=this.y+otherVector.y;result.z=this.z+otherVector.z;result.w=this.w+otherVector.w;return result;}},{key:"subtractInPlace",value:function subtractInPlace(otherVector){this.x-=otherVector.x;this.y-=otherVector.y;this.z-=otherVector.z;this.w-=otherVector.w;return this;}},{key:"subtract",value:function subtract(otherVector){return new this.constructor(this.x-otherVector.x,this.y-otherVector.y,this.z-otherVector.z,this.w-otherVector.w);}},{key:"subtractToRef",value:function subtractToRef(otherVector,result){result.x=this.x-otherVector.x;result.y=this.y-otherVector.y;result.z=this.z-otherVector.z;result.w=this.w-otherVector.w;return result;}},{key:"subtractFromFloats",value:function subtractFromFloats(x,y,z,w){return new this.constructor(this.x-x,this.y-y,this.z-z,this.w-w);}},{key:"subtractFromFloatsToRef",value:function subtractFromFloatsToRef(x,y,z,w,result){result.x=this.x-x;result.y=this.y-y;result.z=this.z-z;result.w=this.w-w;return result;}},{key:"negate",value:function negate(){return new this.constructor(-this.x,-this.y,-this.z,-this.w);}},{key:"negateInPlace",value:function negateInPlace(){this.x*=-1;this.y*=-1;this.z*=-1;this.w*=-1;return this;}},{key:"negateToRef",value:function negateToRef(result){return result.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this.x*=scale;this.y*=scale;this.z*=scale;this.w*=scale;return this;}},{key:"scale",value:function scale(_scale3){return new this.constructor(this.x*_scale3,this.y*_scale3,this.z*_scale3,this.w*_scale3);}},{key:"scaleToRef",value:function scaleToRef(scale,result){result.x=this.x*scale;result.y=this.y*scale;result.z=this.z*scale;result.w=this.w*scale;return result;}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){result.x+=this.x*scale;result.y+=this.y*scale;result.z+=this.z*scale;result.w+=this.w*scale;return result;}},{key:"equals",value:function equals(otherVector){return otherVector&&this.x===otherVector.x&&this.y===otherVector.y&&this.z===otherVector.z&&this.w===otherVector.w;}},{key:"equalsWithEpsilon",value:function equalsWithEpsilon(otherVector){var epsilon=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Epsilon;return otherVector&&Scalar.WithinEpsilon(this.x,otherVector.x,epsilon)&&Scalar.WithinEpsilon(this.y,otherVector.y,epsilon)&&Scalar.WithinEpsilon(this.z,otherVector.z,epsilon)&&Scalar.WithinEpsilon(this.w,otherVector.w,epsilon);}},{key:"equalsToFloats",value:function equalsToFloats(x,y,z,w){return this.x===x&&this.y===y&&this.z===z&&this.w===w;}},{key:"multiplyInPlace",value:function multiplyInPlace(otherVector){this.x*=otherVector.x;this.y*=otherVector.y;this.z*=otherVector.z;this.w*=otherVector.w;return this;}},{key:"multiply",value:function multiply(otherVector){return new this.constructor(this.x*otherVector.x,this.y*otherVector.y,this.z*otherVector.z,this.w*otherVector.w);}},{key:"multiplyToRef",value:function multiplyToRef(otherVector,result){result.x=this.x*otherVector.x;result.y=this.y*otherVector.y;result.z=this.z*otherVector.z;result.w=this.w*otherVector.w;return result;}},{key:"multiplyByFloats",value:function multiplyByFloats(x,y,z,w){return new this.constructor(this.x*x,this.y*y,this.z*z,this.w*w);}},{key:"divide",value:function divide(otherVector){return new this.constructor(this.x/otherVector.x,this.y/otherVector.y,this.z/otherVector.z,this.w/otherVector.w);}},{key:"divideToRef",value:function divideToRef(otherVector,result){result.x=this.x/otherVector.x;result.y=this.y/otherVector.y;result.z=this.z/otherVector.z;result.w=this.w/otherVector.w;return result;}},{key:"divideInPlace",value:function divideInPlace(otherVector){return this.divideToRef(otherVector,this);}},{key:"minimizeInPlace",value:function minimizeInPlace(other){if(other.x<this.x){this.x=other.x;}if(other.y<this.y){this.y=other.y;}if(other.z<this.z){this.z=other.z;}if(other.w<this.w){this.w=other.w;}return this;}},{key:"maximizeInPlace",value:function maximizeInPlace(other){if(other.x>this.x){this.x=other.x;}if(other.y>this.y){this.y=other.y;}if(other.z>this.z){this.z=other.z;}if(other.w>this.w){this.w=other.w;}return this;}},{key:"floor",value:function floor(){return new this.constructor(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w));}},{key:"fract",value:function fract(){return new this.constructor(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w));}},{key:"length",value:function length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);}},{key:"lengthSquared",value:function lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w;}},{key:"normalize",value:function normalize(){var len=this.length();if(len===0){return this;}return this.scaleInPlace(1/len);}},{key:"toVector3",value:function toVector3(){return new Vector3(this.x,this.y,this.z);}},{key:"clone",value:function clone(){return new this.constructor(this.x,this.y,this.z,this.w);}},{key:"copyFrom",value:function copyFrom(source){this.x=source.x;this.y=source.y;this.z=source.z;this.w=source.w;return this;}},{key:"copyFromFloats",value:function copyFromFloats(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this;}},{key:"set",value:function set(x,y,z,w){return this.copyFromFloats(x,y,z,w);}},{key:"setAll",value:function setAll(v){this.x=this.y=this.z=this.w=v;return this;}}],[{key:"FromArray",value:function FromArray(array,offset){if(!offset){offset=0;}return new Vector4(array[offset],array[offset+1],array[offset+2],array[offset+3]);}},{key:"FromArrayToRef",value:function FromArrayToRef(array,offset,result){result.x=array[offset];result.y=array[offset+1];result.z=array[offset+2];result.w=array[offset+3];return result;}},{key:"FromFloatArrayToRef",value:function FromFloatArrayToRef(array,offset,result){Vector4.FromArrayToRef(array,offset,result);return result;}},{key:"FromFloatsToRef",value:function FromFloatsToRef(x,y,z,w,result){result.x=x;result.y=y;result.z=z;result.w=w;return result;}},{key:"Zero",value:function Zero(){return new Vector4(0,0,0,0);}},{key:"One",value:function One(){return new Vector4(1,1,1,1);}},{key:"Random",value:function Random(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return new Vector4(Scalar.RandomRange(min,max),Scalar.RandomRange(min,max),Scalar.RandomRange(min,max),Scalar.RandomRange(min,max));}},{key:"ZeroReadOnly",get:function get(){return Vector4._ZeroReadOnly;}},{key:"Normalize",value:function Normalize(vector){var result=Vector4.Zero();Vector4.NormalizeToRef(vector,result);return result;}},{key:"NormalizeToRef",value:function NormalizeToRef(vector,result){result.copyFrom(vector);result.normalize();return result;}},{key:"Minimize",value:function Minimize(left,right){var min=new left.constructor();min.copyFrom(left);min.minimizeInPlace(right);return min;}},{key:"Maximize",value:function Maximize(left,right){var max=new left.constructor();max.copyFrom(left);max.maximizeInPlace(right);return max;}},{key:"Distance",value:function Distance(value1,value2){return Math.sqrt(Vector4.DistanceSquared(value1,value2));}},{key:"DistanceSquared",value:function DistanceSquared(value1,value2){var x=value1.x-value2.x;var y=value1.y-value2.y;var z=value1.z-value2.z;var w=value1.w-value2.w;return x*x+y*y+z*z+w*w;}},{key:"Center",value:function Center(value1,value2){return Vector4.CenterToRef(value1,value2,Vector4.Zero());}},{key:"CenterToRef",value:function CenterToRef(value1,value2,ref){return ref.copyFromFloats((value1.x+value2.x)/2,(value1.y+value2.y)/2,(value1.z+value2.z)/2,(value1.w+value2.w)/2);}},{key:"TransformCoordinates",value:function TransformCoordinates(vector,transformation){var result=Vector4.Zero();Vector4.TransformCoordinatesToRef(vector,transformation,result);return result;}},{key:"TransformCoordinatesToRef",value:function TransformCoordinatesToRef(vector,transformation,result){Vector4.TransformCoordinatesFromFloatsToRef(vector._x,vector._y,vector._z,transformation,result);return result;}},{key:"TransformCoordinatesFromFloatsToRef",value:function TransformCoordinatesFromFloatsToRef(x,y,z,transformation,result){var m=transformation.m;var rx=x*m[0]+y*m[4]+z*m[8]+m[12];var ry=x*m[1]+y*m[5]+z*m[9]+m[13];var rz=x*m[2]+y*m[6]+z*m[10]+m[14];var rw=x*m[3]+y*m[7]+z*m[11]+m[15];result.x=rx;result.y=ry;result.z=rz;result.w=rw;return result;}},{key:"TransformNormal",value:function TransformNormal(vector,transformation){var result=new vector.constructor();Vector4.TransformNormalToRef(vector,transformation,result);return result;}},{key:"TransformNormalToRef",value:function TransformNormalToRef(vector,transformation,result){var m=transformation.m;var x=vector.x*m[0]+vector.y*m[4]+vector.z*m[8];var y=vector.x*m[1]+vector.y*m[5]+vector.z*m[9];var z=vector.x*m[2]+vector.y*m[6]+vector.z*m[10];result.x=x;result.y=y;result.z=z;result.w=vector.w;return result;}},{key:"TransformNormalFromFloatsToRef",value:function TransformNormalFromFloatsToRef(x,y,z,w,transformation,result){var m=transformation.m;result.x=x*m[0]+y*m[4]+z*m[8];result.y=x*m[1]+y*m[5]+z*m[9];result.z=x*m[2]+y*m[6]+z*m[10];result.w=w;return result;}},{key:"FromVector3",value:function FromVector3(source){var w=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Vector4(source._x,source._y,source._z,w);}}]);return Vector4;}();Vector4._ZeroReadOnly=Vector4.Zero();var Quaternion=/*#__PURE__*/function(){function Quaternion(){var x=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var w=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Quaternion);this._isDirty=true;this._x=x;this._y=y;this._z=z;this._w=w;}_createClass(Quaternion,[{key:"x",get:function get(){return this._x;},set:function set(value){this._x=value;this._isDirty=true;}},{key:"y",get:function get(){return this._y;},set:function set(value){this._y=value;this._isDirty=true;}},{key:"z",get:function get(){return this._z;},set:function set(value){this._z=value;this._isDirty=true;}},{key:"w",get:function get(){return this._w;},set:function set(value){this._w=value;this._isDirty=true;}},{key:"toString",value:function toString(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}");}},{key:"getClassName",value:function getClassName(){return"Quaternion";}},{key:"getHashCode",value:function getHashCode(){var x=_ExtractAsInt(this._x);var y=_ExtractAsInt(this._y);var z=_ExtractAsInt(this._z);var w=_ExtractAsInt(this._w);var hash=x;hash=hash*397^y;hash=hash*397^z;hash=hash*397^w;return hash;}},{key:"asArray",value:function asArray(){return[this._x,this._y,this._z,this._w];}},{key:"toArray",value:function toArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[index]=this._x;array[index+1]=this._y;array[index+2]=this._z;array[index+3]=this._w;return this;}},{key:"equals",value:function equals(otherQuaternion){return otherQuaternion&&this._x===otherQuaternion._x&&this._y===otherQuaternion._y&&this._z===otherQuaternion._z&&this._w===otherQuaternion._w;}},{key:"equalsWithEpsilon",value:function equalsWithEpsilon(otherQuaternion){var epsilon=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Epsilon;return otherQuaternion&&Scalar.WithinEpsilon(this._x,otherQuaternion._x,epsilon)&&Scalar.WithinEpsilon(this._y,otherQuaternion._y,epsilon)&&Scalar.WithinEpsilon(this._z,otherQuaternion._z,epsilon)&&Scalar.WithinEpsilon(this._w,otherQuaternion._w,epsilon);}},{key:"clone",value:function clone(){return new this.constructor(this._x,this._y,this._z,this._w);}},{key:"copyFrom",value:function copyFrom(other){this._x=other._x;this._y=other._y;this._z=other._z;this._w=other._w;this._isDirty=true;return this;}},{key:"copyFromFloats",value:function copyFromFloats(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this._isDirty=true;return this;}},{key:"set",value:function set(x,y,z,w){return this.copyFromFloats(x,y,z,w);}},{key:"add",value:function add(other){return new this.constructor(this._x+other._x,this._y+other._y,this._z+other._z,this._w+other._w);}},{key:"addInPlace",value:function addInPlace(other){this._x+=other._x;this._y+=other._y;this._z+=other._z;this._w+=other._w;this._isDirty=true;return this;}},{key:"subtract",value:function subtract(other){return new this.constructor(this._x-other._x,this._y-other._y,this._z-other._z,this._w-other._w);}},{key:"subtractInPlace",value:function subtractInPlace(other){this._x-=other._x;this._y-=other._y;this._z-=other._z;this._w-=other._w;this._isDirty=true;return this;}},{key:"scale",value:function scale(value){return new this.constructor(this._x*value,this._y*value,this._z*value,this._w*value);}},{key:"scaleToRef",value:function scaleToRef(scale,result){result._x=this._x*scale;result._y=this._y*scale;result._z=this._z*scale;result._w=this._w*scale;result._isDirty=true;return result;}},{key:"scaleInPlace",value:function scaleInPlace(value){this._x*=value;this._y*=value;this._z*=value;this._w*=value;this._isDirty=true;return this;}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){result._x+=this._x*scale;result._y+=this._y*scale;result._z+=this._z*scale;result._w+=this._w*scale;result._isDirty=true;return result;}},{key:"multiply",value:function multiply(q1){var result=new this.constructor(0,0,0,1);this.multiplyToRef(q1,result);return result;}},{key:"multiplyToRef",value:function multiplyToRef(q1,result){var x=this._x*q1._w+this._y*q1._z-this._z*q1._y+this._w*q1._x;var y=-this._x*q1._z+this._y*q1._w+this._z*q1._x+this._w*q1._y;var z=this._x*q1._y-this._y*q1._x+this._z*q1._w+this._w*q1._z;var w=-this._x*q1._x-this._y*q1._y-this._z*q1._z+this._w*q1._w;result.copyFromFloats(x,y,z,w);return result;}},{key:"multiplyInPlace",value:function multiplyInPlace(q1){this.multiplyToRef(q1,this);return this;}},{key:"conjugateToRef",value:function conjugateToRef(ref){ref.copyFromFloats(-this._x,-this._y,-this._z,this._w);return ref;}},{key:"conjugateInPlace",value:function conjugateInPlace(){this._x*=-1;this._y*=-1;this._z*=-1;this._isDirty=true;return this;}},{key:"conjugate",value:function conjugate(){return new this.constructor(-this._x,-this._y,-this._z,this._w);}},{key:"invert",value:function invert(){var conjugate=this.conjugate();var lengthSquared=this.lengthSquared();if(lengthSquared==0||lengthSquared==1){return conjugate;}conjugate.scaleInPlace(1/lengthSquared);return conjugate;}},{key:"invertInPlace",value:function invertInPlace(){this.conjugateInPlace();var lengthSquared=this.lengthSquared();if(lengthSquared==0||lengthSquared==1){return this;}this.scaleInPlace(1/lengthSquared);return this;}},{key:"lengthSquared",value:function lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w;}},{key:"length",value:function length(){return Math.sqrt(this.lengthSquared());}},{key:"normalize",value:function normalize(){var len=this.length();if(len===0){return this;}var inv=1/len;this.scaleInPlace(inv);return this;}},{key:"normalizeToNew",value:function normalizeToNew(){var len=this.length();if(len===0){return this.clone();}var inv=1/len;return this.scale(inv);}},{key:"toEulerAngles",value:function toEulerAngles(){var result=Vector3.Zero();this.toEulerAnglesToRef(result);return result;}},{key:"toEulerAnglesToRef",value:function toEulerAnglesToRef(result){var qz=this._z;var qx=this._x;var qy=this._y;var qw=this._w;var zAxisY=qy*qz-qx*qw;var limit=0.4999999;if(zAxisY<-limit){result._y=2*Math.atan2(qy,qw);result._x=Math.PI/2;result._z=0;result._isDirty=true;}else if(zAxisY>limit){result._y=2*Math.atan2(qy,qw);result._x=-Math.PI/2;result._z=0;result._isDirty=true;}else{var sqw=qw*qw;var sqz=qz*qz;var sqx=qx*qx;var sqy=qy*qy;result._z=Math.atan2(2*(qx*qy+qz*qw),-sqz-sqx+sqy+sqw);result._x=Math.asin(-2*zAxisY);result._y=Math.atan2(2*(qz*qx+qy*qw),sqz-sqx-sqy+sqw);result._isDirty=true;}return result;}},{key:"toRotationMatrix",value:function toRotationMatrix(result){Matrix.FromQuaternionToRef(this,result);return result;}},{key:"fromRotationMatrix",value:function fromRotationMatrix(matrix){Quaternion.FromRotationMatrixToRef(matrix,this);return this;}}],[{key:"FromRotationMatrix",value:function FromRotationMatrix(matrix){var result=new Quaternion();Quaternion.FromRotationMatrixToRef(matrix,result);return result;}},{key:"FromRotationMatrixToRef",value:function FromRotationMatrixToRef(matrix,result){var data=matrix.m;var m11=data[0],m12=data[4],m13=data[8];var m21=data[1],m22=data[5],m23=data[9];var m31=data[2],m32=data[6],m33=data[10];var trace=m11+m22+m33;var s;if(trace>0){s=0.5/Math.sqrt(trace+1);result._w=0.25/s;result._x=(m32-m23)*s;result._y=(m13-m31)*s;result._z=(m21-m12)*s;result._isDirty=true;}else if(m11>m22&&m11>m33){s=2*Math.sqrt(1+m11-m22-m33);result._w=(m32-m23)/s;result._x=0.25*s;result._y=(m12+m21)/s;result._z=(m13+m31)/s;result._isDirty=true;}else if(m22>m33){s=2*Math.sqrt(1+m22-m11-m33);result._w=(m13-m31)/s;result._x=(m12+m21)/s;result._y=0.25*s;result._z=(m23+m32)/s;result._isDirty=true;}else{s=2*Math.sqrt(1+m33-m11-m22);result._w=(m21-m12)/s;result._x=(m13+m31)/s;result._y=(m23+m32)/s;result._z=0.25*s;result._isDirty=true;}return result;}},{key:"Dot",value:function Dot(left,right){return left._x*right._x+left._y*right._y+left._z*right._z+left._w*right._w;}},{key:"AreClose",value:function AreClose(quat0,quat1){var epsilon=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.1;var dot=Quaternion.Dot(quat0,quat1);return 1-dot*dot<=epsilon;}},{key:"SmoothToRef",value:function SmoothToRef(source,goal,deltaTime,lerpTime,result){var slerp=lerpTime===0?1:deltaTime/lerpTime;slerp=Scalar.Clamp(slerp,0,1);Quaternion.SlerpToRef(source,goal,slerp,result);return result;}},{key:"Zero",value:function Zero(){return new Quaternion(0,0,0,0);}},{key:"Inverse",value:function Inverse(q){return new q.constructor(-q._x,-q._y,-q._z,q._w);}},{key:"InverseToRef",value:function InverseToRef(q,result){result.set(-q._x,-q._y,-q._z,q._w);return result;}},{key:"Identity",value:function Identity(){return new Quaternion(0,0,0,1);}},{key:"IsIdentity",value:function IsIdentity(quaternion){return quaternion&&quaternion._x===0&&quaternion._y===0&&quaternion._z===0&&quaternion._w===1;}},{key:"RotationAxis",value:function RotationAxis(axis,angle){return Quaternion.RotationAxisToRef(axis,angle,new Quaternion());}},{key:"RotationAxisToRef",value:function RotationAxisToRef(axis,angle,result){var sin=Math.sin(angle/2);axis.normalize();result._w=Math.cos(angle/2);result._x=axis._x*sin;result._y=axis._y*sin;result._z=axis._z*sin;result._isDirty=true;return result;}},{key:"FromArray",value:function FromArray(array,offset){if(!offset){offset=0;}return new Quaternion(array[offset],array[offset+1],array[offset+2],array[offset+3]);}},{key:"FromArrayToRef",value:function FromArrayToRef(array,offset,result){result._x=array[offset];result._y=array[offset+1];result._z=array[offset+2];result._w=array[offset+3];result._isDirty=true;return result;}},{key:"FromEulerAngles",value:function FromEulerAngles(x,y,z){var q=new Quaternion();Quaternion.RotationYawPitchRollToRef(y,x,z,q);return q;}},{key:"FromEulerAnglesToRef",value:function FromEulerAnglesToRef(x,y,z,result){Quaternion.RotationYawPitchRollToRef(y,x,z,result);return result;}},{key:"FromEulerVector",value:function FromEulerVector(vec){var q=new Quaternion();Quaternion.RotationYawPitchRollToRef(vec._y,vec._x,vec._z,q);return q;}},{key:"FromEulerVectorToRef",value:function FromEulerVectorToRef(vec,result){Quaternion.RotationYawPitchRollToRef(vec._y,vec._x,vec._z,result);return result;}},{key:"FromUnitVectorsToRef",value:function FromUnitVectorsToRef(vecFrom,vecTo,result){var r=Vector3.Dot(vecFrom,vecTo)+1;if(r<Epsilon){if(Math.abs(vecFrom.x)>Math.abs(vecFrom.z)){result.set(-vecFrom.y,vecFrom.x,0,0);}else{result.set(0,-vecFrom.z,vecFrom.y,0);}}else{Vector3.CrossToRef(vecFrom,vecTo,TmpVectors.Vector3[0]);result.set(TmpVectors.Vector3[0].x,TmpVectors.Vector3[0].y,TmpVectors.Vector3[0].z,r);}return result.normalize();}},{key:"RotationYawPitchRoll",value:function RotationYawPitchRoll(yaw,pitch,roll){var q=new Quaternion();Quaternion.RotationYawPitchRollToRef(yaw,pitch,roll,q);return q;}},{key:"RotationYawPitchRollToRef",value:function RotationYawPitchRollToRef(yaw,pitch,roll,result){var halfRoll=roll*0.5;var halfPitch=pitch*0.5;var halfYaw=yaw*0.5;var sinRoll=Math.sin(halfRoll);var cosRoll=Math.cos(halfRoll);var sinPitch=Math.sin(halfPitch);var cosPitch=Math.cos(halfPitch);var sinYaw=Math.sin(halfYaw);var cosYaw=Math.cos(halfYaw);result._x=cosYaw*sinPitch*cosRoll+sinYaw*cosPitch*sinRoll;result._y=sinYaw*cosPitch*cosRoll-cosYaw*sinPitch*sinRoll;result._z=cosYaw*cosPitch*sinRoll-sinYaw*sinPitch*cosRoll;result._w=cosYaw*cosPitch*cosRoll+sinYaw*sinPitch*sinRoll;result._isDirty=true;return result;}},{key:"RotationAlphaBetaGamma",value:function RotationAlphaBetaGamma(alpha,beta,gamma){var result=new Quaternion();Quaternion.RotationAlphaBetaGammaToRef(alpha,beta,gamma,result);return result;}},{key:"RotationAlphaBetaGammaToRef",value:function RotationAlphaBetaGammaToRef(alpha,beta,gamma,result){var halfGammaPlusAlpha=(gamma+alpha)*0.5;var halfGammaMinusAlpha=(gamma-alpha)*0.5;var halfBeta=beta*0.5;result._x=Math.cos(halfGammaMinusAlpha)*Math.sin(halfBeta);result._y=Math.sin(halfGammaMinusAlpha)*Math.sin(halfBeta);result._z=Math.sin(halfGammaPlusAlpha)*Math.cos(halfBeta);result._w=Math.cos(halfGammaPlusAlpha)*Math.cos(halfBeta);result._isDirty=true;return result;}},{key:"RotationQuaternionFromAxis",value:function RotationQuaternionFromAxis(axis1,axis2,axis3){var quat=new Quaternion(0,0,0,0);Quaternion.RotationQuaternionFromAxisToRef(axis1,axis2,axis3,quat);return quat;}},{key:"RotationQuaternionFromAxisToRef",value:function RotationQuaternionFromAxisToRef(axis1,axis2,axis3,ref){var rotMat=MathTmp.Matrix[0];Matrix.FromXYZAxesToRef(axis1.normalize(),axis2.normalize(),axis3.normalize(),rotMat);Quaternion.FromRotationMatrixToRef(rotMat,ref);return ref;}},{key:"FromLookDirectionLH",value:function FromLookDirectionLH(forward,up){var quat=new Quaternion();Quaternion.FromLookDirectionLHToRef(forward,up,quat);return quat;}},{key:"FromLookDirectionLHToRef",value:function FromLookDirectionLHToRef(forward,up,ref){var rotMat=MathTmp.Matrix[0];Matrix.LookDirectionLHToRef(forward,up,rotMat);Quaternion.FromRotationMatrixToRef(rotMat,ref);return ref;}},{key:"FromLookDirectionRH",value:function FromLookDirectionRH(forward,up){var quat=new Quaternion();Quaternion.FromLookDirectionRHToRef(forward,up,quat);return quat;}},{key:"FromLookDirectionRHToRef",value:function FromLookDirectionRHToRef(forward,up,ref){var rotMat=MathTmp.Matrix[0];Matrix.LookDirectionRHToRef(forward,up,rotMat);return Quaternion.FromRotationMatrixToRef(rotMat,ref);}},{key:"Slerp",value:function Slerp(left,right,amount){var result=Quaternion.Identity();Quaternion.SlerpToRef(left,right,amount,result);return result;}},{key:"SlerpToRef",value:function SlerpToRef(left,right,amount,result){var num2;var num3;var num4=left._x*right._x+left._y*right._y+left._z*right._z+left._w*right._w;var flag=false;if(num4<0){flag=true;num4=-num4;}if(num4>0.999999){num3=1-amount;num2=flag?-amount:amount;}else{var num5=Math.acos(num4);var num6=1/Math.sin(num5);num3=Math.sin((1-amount)*num5)*num6;num2=flag?-Math.sin(amount*num5)*num6:Math.sin(amount*num5)*num6;}result._x=num3*left._x+num2*right._x;result._y=num3*left._y+num2*right._y;result._z=num3*left._z+num2*right._z;result._w=num3*left._w+num2*right._w;result._isDirty=true;return result;}},{key:"Hermite",value:function Hermite(value1,tangent1,value2,tangent2,amount){var squared=amount*amount;var cubed=amount*squared;var part1=2*cubed-3*squared+1;var part2=-2*cubed+3*squared;var part3=cubed-2*squared+amount;var part4=cubed-squared;var x=value1._x*part1+value2._x*part2+tangent1._x*part3+tangent2._x*part4;var y=value1._y*part1+value2._y*part2+tangent1._y*part3+tangent2._y*part4;var z=value1._z*part1+value2._z*part2+tangent1._z*part3+tangent2._z*part4;var w=value1._w*part1+value2._w*part2+tangent1._w*part3+tangent2._w*part4;return new value1.constructor(x,y,z,w);}},{key:"Hermite1stDerivative",value:function Hermite1stDerivative(value1,tangent1,value2,tangent2,time){var result=new value1.constructor();this.Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result);return result;}},{key:"Hermite1stDerivativeToRef",value:function Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result){var t2=time*time;result._x=(t2-time)*6*value1._x+(3*t2-4*time+1)*tangent1._x+(-t2+time)*6*value2._x+(3*t2-2*time)*tangent2._x;result._y=(t2-time)*6*value1._y+(3*t2-4*time+1)*tangent1._y+(-t2+time)*6*value2._y+(3*t2-2*time)*tangent2._y;result._z=(t2-time)*6*value1._z+(3*t2-4*time+1)*tangent1._z+(-t2+time)*6*value2._z+(3*t2-2*time)*tangent2._z;result._w=(t2-time)*6*value1._w+(3*t2-4*time+1)*tangent1._w+(-t2+time)*6*value2._w+(3*t2-2*time)*tangent2._w;result._isDirty=true;return result;}}]);return Quaternion;}();var Matrix=/*#__PURE__*/function(){function Matrix(){_classCallCheck(this,Matrix);this._isIdentity=false;this._isIdentityDirty=true;this._isIdentity3x2=true;this._isIdentity3x2Dirty=true;this.updateFlag=-1;if(PerformanceConfigurator.MatrixTrackPrecisionChange){PerformanceConfigurator.MatrixTrackedMatrices.push(this);}this._m=new PerformanceConfigurator.MatrixCurrentType(16);this.markAsUpdated();}_createClass(Matrix,[{key:"m",get:function get(){return this._m;}},{key:"markAsUpdated",value:function markAsUpdated(){this.updateFlag=Matrix._UpdateFlagSeed++;this._isIdentity=false;this._isIdentity3x2=false;this._isIdentityDirty=true;this._isIdentity3x2Dirty=true;}},{key:"_updateIdentityStatus",value:function _updateIdentityStatus(isIdentity){var isIdentityDirty=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var isIdentity3x2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isIdentity3x2Dirty=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;this._isIdentity=isIdentity;this._isIdentity3x2=isIdentity||isIdentity3x2;this._isIdentityDirty=this._isIdentity?false:isIdentityDirty;this._isIdentity3x2Dirty=this._isIdentity3x2?false:isIdentity3x2Dirty;}},{key:"isIdentity",value:function isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=false;var m=this._m;this._isIdentity=m[0]===1&&m[1]===0&&m[2]===0&&m[3]===0&&m[4]===0&&m[5]===1&&m[6]===0&&m[7]===0&&m[8]===0&&m[9]===0&&m[10]===1&&m[11]===0&&m[12]===0&&m[13]===0&&m[14]===0&&m[15]===1;}return this._isIdentity;}},{key:"isIdentityAs3x2",value:function isIdentityAs3x2(){if(this._isIdentity3x2Dirty){this._isIdentity3x2Dirty=false;if(this._m[0]!==1||this._m[5]!==1||this._m[15]!==1){this._isIdentity3x2=false;}else if(this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0){this._isIdentity3x2=false;}else{this._isIdentity3x2=true;}}return this._isIdentity3x2;}},{key:"determinant",value:function determinant(){if(this._isIdentity===true){return 1;}var m=this._m;var m00=m[0],m01=m[1],m02=m[2],m03=m[3];var m10=m[4],m11=m[5],m12=m[6],m13=m[7];var m20=m[8],m21=m[9],m22=m[10],m23=m[11];var m30=m[12],m31=m[13],m32=m[14],m33=m[15];var det_22_33=m22*m33-m32*m23;var det_21_33=m21*m33-m31*m23;var det_21_32=m21*m32-m31*m22;var det_20_33=m20*m33-m30*m23;var det_20_32=m20*m32-m22*m30;var det_20_31=m20*m31-m30*m21;var cofact_00=+(m11*det_22_33-m12*det_21_33+m13*det_21_32);var cofact_01=-(m10*det_22_33-m12*det_20_33+m13*det_20_32);var cofact_02=+(m10*det_21_33-m11*det_20_33+m13*det_20_31);var cofact_03=-(m10*det_21_32-m11*det_20_32+m12*det_20_31);return m00*cofact_00+m01*cofact_01+m02*cofact_02+m03*cofact_03;}},{key:"toArray",value:function toArray(){return this._m;}},{key:"asArray",value:function asArray(){return this._m;}},{key:"invert",value:function invert(){this.invertToRef(this);return this;}},{key:"reset",value:function reset(){Matrix.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this);this._updateIdentityStatus(false);return this;}},{key:"add",value:function add(other){var result=new this.constructor();this.addToRef(other,result);return result;}},{key:"addToRef",value:function addToRef(other,result){var m=this._m;var resultM=result._m;var otherM=other.m;for(var index=0;index<16;index++){resultM[index]=m[index]+otherM[index];}result.markAsUpdated();return result;}},{key:"addToSelf",value:function addToSelf(other){var m=this._m;var otherM=other.m;for(var index=0;index<16;index++){m[index]+=otherM[index];}this.markAsUpdated();return this;}},{key:"invertToRef",value:function invertToRef(other){if(this._isIdentity===true){Matrix.IdentityToRef(other);return other;}var m=this._m;var m00=m[0],m01=m[1],m02=m[2],m03=m[3];var m10=m[4],m11=m[5],m12=m[6],m13=m[7];var m20=m[8],m21=m[9],m22=m[10],m23=m[11];var m30=m[12],m31=m[13],m32=m[14],m33=m[15];var det_22_33=m22*m33-m32*m23;var det_21_33=m21*m33-m31*m23;var det_21_32=m21*m32-m31*m22;var det_20_33=m20*m33-m30*m23;var det_20_32=m20*m32-m22*m30;var det_20_31=m20*m31-m30*m21;var cofact_00=+(m11*det_22_33-m12*det_21_33+m13*det_21_32);var cofact_01=-(m10*det_22_33-m12*det_20_33+m13*det_20_32);var cofact_02=+(m10*det_21_33-m11*det_20_33+m13*det_20_31);var cofact_03=-(m10*det_21_32-m11*det_20_32+m12*det_20_31);var det=m00*cofact_00+m01*cofact_01+m02*cofact_02+m03*cofact_03;if(det===0){other.copyFrom(this);return other;}var detInv=1/det;var det_12_33=m12*m33-m32*m13;var det_11_33=m11*m33-m31*m13;var det_11_32=m11*m32-m31*m12;var det_10_33=m10*m33-m30*m13;var det_10_32=m10*m32-m30*m12;var det_10_31=m10*m31-m30*m11;var det_12_23=m12*m23-m22*m13;var det_11_23=m11*m23-m21*m13;var det_11_22=m11*m22-m21*m12;var det_10_23=m10*m23-m20*m13;var det_10_22=m10*m22-m20*m12;var det_10_21=m10*m21-m20*m11;var cofact_10=-(m01*det_22_33-m02*det_21_33+m03*det_21_32);var cofact_11=+(m00*det_22_33-m02*det_20_33+m03*det_20_32);var cofact_12=-(m00*det_21_33-m01*det_20_33+m03*det_20_31);var cofact_13=+(m00*det_21_32-m01*det_20_32+m02*det_20_31);var cofact_20=+(m01*det_12_33-m02*det_11_33+m03*det_11_32);var cofact_21=-(m00*det_12_33-m02*det_10_33+m03*det_10_32);var cofact_22=+(m00*det_11_33-m01*det_10_33+m03*det_10_31);var cofact_23=-(m00*det_11_32-m01*det_10_32+m02*det_10_31);var cofact_30=-(m01*det_12_23-m02*det_11_23+m03*det_11_22);var cofact_31=+(m00*det_12_23-m02*det_10_23+m03*det_10_22);var cofact_32=-(m00*det_11_23-m01*det_10_23+m03*det_10_21);var cofact_33=+(m00*det_11_22-m01*det_10_22+m02*det_10_21);Matrix.FromValuesToRef(cofact_00*detInv,cofact_10*detInv,cofact_20*detInv,cofact_30*detInv,cofact_01*detInv,cofact_11*detInv,cofact_21*detInv,cofact_31*detInv,cofact_02*detInv,cofact_12*detInv,cofact_22*detInv,cofact_32*detInv,cofact_03*detInv,cofact_13*detInv,cofact_23*detInv,cofact_33*detInv,other);return other;}},{key:"addAtIndex",value:function addAtIndex(index,value){this._m[index]+=value;this.markAsUpdated();return this;}},{key:"multiplyAtIndex",value:function multiplyAtIndex(index,value){this._m[index]*=value;this.markAsUpdated();return this;}},{key:"setTranslationFromFloats",value:function setTranslationFromFloats(x,y,z){this._m[12]=x;this._m[13]=y;this._m[14]=z;this.markAsUpdated();return this;}},{key:"addTranslationFromFloats",value:function addTranslationFromFloats(x,y,z){this._m[12]+=x;this._m[13]+=y;this._m[14]+=z;this.markAsUpdated();return this;}},{key:"setTranslation",value:function setTranslation(vector3){return this.setTranslationFromFloats(vector3._x,vector3._y,vector3._z);}},{key:"getTranslation",value:function getTranslation(){return new Vector3(this._m[12],this._m[13],this._m[14]);}},{key:"getTranslationToRef",value:function getTranslationToRef(result){result.x=this._m[12];result.y=this._m[13];result.z=this._m[14];return result;}},{key:"removeRotationAndScaling",value:function removeRotationAndScaling(){var m=this.m;Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,m[12],m[13],m[14],m[15],this);this._updateIdentityStatus(m[12]===0&&m[13]===0&&m[14]===0&&m[15]===1);return this;}},{key:"multiply",value:function multiply(other){var result=new this.constructor();this.multiplyToRef(other,result);return result;}},{key:"copyFrom",value:function copyFrom(other){other.copyToArray(this._m);var o=other;this.updateFlag=o.updateFlag;this._updateIdentityStatus(o._isIdentity,o._isIdentityDirty,o._isIdentity3x2,o._isIdentity3x2Dirty);return this;}},{key:"copyToArray",value:function copyToArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var source=this._m;array[offset]=source[0];array[offset+1]=source[1];array[offset+2]=source[2];array[offset+3]=source[3];array[offset+4]=source[4];array[offset+5]=source[5];array[offset+6]=source[6];array[offset+7]=source[7];array[offset+8]=source[8];array[offset+9]=source[9];array[offset+10]=source[10];array[offset+11]=source[11];array[offset+12]=source[12];array[offset+13]=source[13];array[offset+14]=source[14];array[offset+15]=source[15];return this;}},{key:"multiplyToRef",value:function multiplyToRef(other,result){if(this._isIdentity){result.copyFrom(other);return result;}if(other._isIdentity){result.copyFrom(this);return result;}this.multiplyToArray(other,result._m,0);result.markAsUpdated();return result;}},{key:"multiplyToArray",value:function multiplyToArray(other,result,offset){var m=this._m;var otherM=other.m;var tm0=m[0],tm1=m[1],tm2=m[2],tm3=m[3];var tm4=m[4],tm5=m[5],tm6=m[6],tm7=m[7];var tm8=m[8],tm9=m[9],tm10=m[10],tm11=m[11];var tm12=m[12],tm13=m[13],tm14=m[14],tm15=m[15];var om0=otherM[0],om1=otherM[1],om2=otherM[2],om3=otherM[3];var om4=otherM[4],om5=otherM[5],om6=otherM[6],om7=otherM[7];var om8=otherM[8],om9=otherM[9],om10=otherM[10],om11=otherM[11];var om12=otherM[12],om13=otherM[13],om14=otherM[14],om15=otherM[15];result[offset]=tm0*om0+tm1*om4+tm2*om8+tm3*om12;result[offset+1]=tm0*om1+tm1*om5+tm2*om9+tm3*om13;result[offset+2]=tm0*om2+tm1*om6+tm2*om10+tm3*om14;result[offset+3]=tm0*om3+tm1*om7+tm2*om11+tm3*om15;result[offset+4]=tm4*om0+tm5*om4+tm6*om8+tm7*om12;result[offset+5]=tm4*om1+tm5*om5+tm6*om9+tm7*om13;result[offset+6]=tm4*om2+tm5*om6+tm6*om10+tm7*om14;result[offset+7]=tm4*om3+tm5*om7+tm6*om11+tm7*om15;result[offset+8]=tm8*om0+tm9*om4+tm10*om8+tm11*om12;result[offset+9]=tm8*om1+tm9*om5+tm10*om9+tm11*om13;result[offset+10]=tm8*om2+tm9*om6+tm10*om10+tm11*om14;result[offset+11]=tm8*om3+tm9*om7+tm10*om11+tm11*om15;result[offset+12]=tm12*om0+tm13*om4+tm14*om8+tm15*om12;result[offset+13]=tm12*om1+tm13*om5+tm14*om9+tm15*om13;result[offset+14]=tm12*om2+tm13*om6+tm14*om10+tm15*om14;result[offset+15]=tm12*om3+tm13*om7+tm14*om11+tm15*om15;return this;}},{key:"equals",value:function equals(value){var other=value;if(!other){return false;}if(this._isIdentity||other._isIdentity){if(!this._isIdentityDirty&&!other._isIdentityDirty){return this._isIdentity&&other._isIdentity;}}var m=this.m;var om=other.m;return m[0]===om[0]&&m[1]===om[1]&&m[2]===om[2]&&m[3]===om[3]&&m[4]===om[4]&&m[5]===om[5]&&m[6]===om[6]&&m[7]===om[7]&&m[8]===om[8]&&m[9]===om[9]&&m[10]===om[10]&&m[11]===om[11]&&m[12]===om[12]&&m[13]===om[13]&&m[14]===om[14]&&m[15]===om[15];}},{key:"clone",value:function clone(){var matrix=new this.constructor();matrix.copyFrom(this);return matrix;}},{key:"getClassName",value:function getClassName(){return"Matrix";}},{key:"getHashCode",value:function getHashCode(){var hash=_ExtractAsInt(this._m[0]);for(var i=1;i<16;i++){hash=hash*397^_ExtractAsInt(this._m[i]);}return hash;}},{key:"decomposeToTransformNode",value:function decomposeToTransformNode(node){node.rotationQuaternion=node.rotationQuaternion||new Quaternion();return this.decompose(node.scaling,node.rotationQuaternion,node.position);}},{key:"decompose",value:function decompose(scale,rotation,translation,preserveScalingNode){if(this._isIdentity){if(translation){translation.setAll(0);}if(scale){scale.setAll(1);}if(rotation){rotation.copyFromFloats(0,0,0,1);}return true;}var m=this._m;if(translation){translation.copyFromFloats(m[12],m[13],m[14]);}scale=scale||MathTmp.Vector3[0];scale.x=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]);scale.y=Math.sqrt(m[4]*m[4]+m[5]*m[5]+m[6]*m[6]);scale.z=Math.sqrt(m[8]*m[8]+m[9]*m[9]+m[10]*m[10]);if(preserveScalingNode){var signX=preserveScalingNode.scaling.x<0?-1:1;var signY=preserveScalingNode.scaling.y<0?-1:1;var signZ=preserveScalingNode.scaling.z<0?-1:1;scale.x*=signX;scale.y*=signY;scale.z*=signZ;}else{if(this.determinant()<=0){scale.y*=-1;}}if(scale._x===0||scale._y===0||scale._z===0){if(rotation){rotation.copyFromFloats(0,0,0,1);}return false;}if(rotation){var sx=1/scale._x,sy=1/scale._y,sz=1/scale._z;Matrix.FromValuesToRef(m[0]*sx,m[1]*sx,m[2]*sx,0,m[4]*sy,m[5]*sy,m[6]*sy,0,m[8]*sz,m[9]*sz,m[10]*sz,0,0,0,0,1,MathTmp.Matrix[0]);Quaternion.FromRotationMatrixToRef(MathTmp.Matrix[0],rotation);}return true;}},{key:"getRow",value:function getRow(index){if(index<0||index>3){return null;}var i=index*4;return new Vector4(this._m[i+0],this._m[i+1],this._m[i+2],this._m[i+3]);}},{key:"getRowToRef",value:function getRowToRef(index,rowVector){if(index>=0&&index<3){var i=index*4;rowVector.x=this._m[i+0];rowVector.y=this._m[i+1];rowVector.z=this._m[i+2];rowVector.w=this._m[i+3];}return rowVector;}},{key:"setRow",value:function setRow(index,row){return this.setRowFromFloats(index,row.x,row.y,row.z,row.w);}},{key:"transpose",value:function transpose(){var result=new this.constructor();Matrix.TransposeToRef(this,result);return result;}},{key:"transposeToRef",value:function transposeToRef(result){Matrix.TransposeToRef(this,result);return result;}},{key:"setRowFromFloats",value:function setRowFromFloats(index,x,y,z,w){if(index<0||index>3){return this;}var i=index*4;this._m[i+0]=x;this._m[i+1]=y;this._m[i+2]=z;this._m[i+3]=w;this.markAsUpdated();return this;}},{key:"scale",value:function scale(_scale4){var result=new this.constructor();this.scaleToRef(_scale4,result);return result;}},{key:"scaleToRef",value:function scaleToRef(scale,result){for(var index=0;index<16;index++){result._m[index]=this._m[index]*scale;}result.markAsUpdated();return result;}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){for(var index=0;index<16;index++){result._m[index]+=this._m[index]*scale;}result.markAsUpdated();return result;}},{key:"toNormalMatrix",value:function toNormalMatrix(ref){var tmp=MathTmp.Matrix[0];this.invertToRef(tmp);tmp.transposeToRef(ref);var m=ref._m;Matrix.FromValuesToRef(m[0],m[1],m[2],0,m[4],m[5],m[6],0,m[8],m[9],m[10],0,0,0,0,1,ref);return ref;}},{key:"getRotationMatrix",value:function getRotationMatrix(){var result=new this.constructor();this.getRotationMatrixToRef(result);return result;}},{key:"getRotationMatrixToRef",value:function getRotationMatrixToRef(result){var scale=MathTmp.Vector3[0];if(!this.decompose(scale)){Matrix.IdentityToRef(result);return result;}var m=this._m;var sx=1/scale._x,sy=1/scale._y,sz=1/scale._z;Matrix.FromValuesToRef(m[0]*sx,m[1]*sx,m[2]*sx,0,m[4]*sy,m[5]*sy,m[6]*sy,0,m[8]*sz,m[9]*sz,m[10]*sz,0,0,0,0,1,result);return result;}},{key:"toggleModelMatrixHandInPlace",value:function toggleModelMatrixHandInPlace(){var m=this._m;m[2]*=-1;m[6]*=-1;m[8]*=-1;m[9]*=-1;m[14]*=-1;this.markAsUpdated();return this;}},{key:"toggleProjectionMatrixHandInPlace",value:function toggleProjectionMatrixHandInPlace(){var m=this._m;m[8]*=-1;m[9]*=-1;m[10]*=-1;m[11]*=-1;this.markAsUpdated();return this;}}],[{key:"Use64Bits",get:function get(){return PerformanceConfigurator.MatrixUse64Bits;}},{key:"FromArray",value:function FromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var result=new Matrix();Matrix.FromArrayToRef(array,offset,result);return result;}},{key:"FromArrayToRef",value:function FromArrayToRef(array,offset,result){for(var index=0;index<16;index++){result._m[index]=array[index+offset];}result.markAsUpdated();return result;}},{key:"FromFloat32ArrayToRefScaled",value:function FromFloat32ArrayToRefScaled(array,offset,scale,result){for(var index=0;index<16;index++){result._m[index]=array[index+offset]*scale;}result.markAsUpdated();return result;}},{key:"IdentityReadOnly",get:function get(){return Matrix._IdentityReadOnly;}},{key:"FromValuesToRef",value:function FromValuesToRef(initialM11,initialM12,initialM13,initialM14,initialM21,initialM22,initialM23,initialM24,initialM31,initialM32,initialM33,initialM34,initialM41,initialM42,initialM43,initialM44,result){var m=result._m;m[0]=initialM11;m[1]=initialM12;m[2]=initialM13;m[3]=initialM14;m[4]=initialM21;m[5]=initialM22;m[6]=initialM23;m[7]=initialM24;m[8]=initialM31;m[9]=initialM32;m[10]=initialM33;m[11]=initialM34;m[12]=initialM41;m[13]=initialM42;m[14]=initialM43;m[15]=initialM44;result.markAsUpdated();}},{key:"FromValues",value:function FromValues(initialM11,initialM12,initialM13,initialM14,initialM21,initialM22,initialM23,initialM24,initialM31,initialM32,initialM33,initialM34,initialM41,initialM42,initialM43,initialM44){var result=new Matrix();var m=result._m;m[0]=initialM11;m[1]=initialM12;m[2]=initialM13;m[3]=initialM14;m[4]=initialM21;m[5]=initialM22;m[6]=initialM23;m[7]=initialM24;m[8]=initialM31;m[9]=initialM32;m[10]=initialM33;m[11]=initialM34;m[12]=initialM41;m[13]=initialM42;m[14]=initialM43;m[15]=initialM44;result.markAsUpdated();return result;}},{key:"Compose",value:function Compose(scale,rotation,translation){var result=new Matrix();Matrix.ComposeToRef(scale,rotation,translation,result);return result;}},{key:"ComposeToRef",value:function ComposeToRef(scale,rotation,translation,result){var m=result._m;var x=rotation._x,y=rotation._y,z=rotation._z,w=rotation._w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;var sx=scale._x,sy=scale._y,sz=scale._z;m[0]=(1-(yy+zz))*sx;m[1]=(xy+wz)*sx;m[2]=(xz-wy)*sx;m[3]=0;m[4]=(xy-wz)*sy;m[5]=(1-(xx+zz))*sy;m[6]=(yz+wx)*sy;m[7]=0;m[8]=(xz+wy)*sz;m[9]=(yz-wx)*sz;m[10]=(1-(xx+yy))*sz;m[11]=0;m[12]=translation._x;m[13]=translation._y;m[14]=translation._z;m[15]=1;result.markAsUpdated();return result;}},{key:"Identity",value:function Identity(){var identity=Matrix.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);identity._updateIdentityStatus(true);return identity;}},{key:"IdentityToRef",value:function IdentityToRef(result){Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,result);result._updateIdentityStatus(true);return result;}},{key:"Zero",value:function Zero(){var zero=Matrix.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);zero._updateIdentityStatus(false);return zero;}},{key:"RotationX",value:function RotationX(angle){var result=new Matrix();Matrix.RotationXToRef(angle,result);return result;}},{key:"Invert",value:function Invert(source){var result=new source.constructor();source.invertToRef(result);return result;}},{key:"RotationXToRef",value:function RotationXToRef(angle,result){var s=Math.sin(angle);var c=Math.cos(angle);Matrix.FromValuesToRef(1,0,0,0,0,c,s,0,0,-s,c,0,0,0,0,1,result);result._updateIdentityStatus(c===1&&s===0);return result;}},{key:"RotationY",value:function RotationY(angle){var result=new Matrix();Matrix.RotationYToRef(angle,result);return result;}},{key:"RotationYToRef",value:function RotationYToRef(angle,result){var s=Math.sin(angle);var c=Math.cos(angle);Matrix.FromValuesToRef(c,0,-s,0,0,1,0,0,s,0,c,0,0,0,0,1,result);result._updateIdentityStatus(c===1&&s===0);return result;}},{key:"RotationZ",value:function RotationZ(angle){var result=new Matrix();Matrix.RotationZToRef(angle,result);return result;}},{key:"RotationZToRef",value:function RotationZToRef(angle,result){var s=Math.sin(angle);var c=Math.cos(angle);Matrix.FromValuesToRef(c,s,0,0,-s,c,0,0,0,0,1,0,0,0,0,1,result);result._updateIdentityStatus(c===1&&s===0);return result;}},{key:"RotationAxis",value:function RotationAxis(axis,angle){var result=new Matrix();Matrix.RotationAxisToRef(axis,angle,result);return result;}},{key:"RotationAxisToRef",value:function RotationAxisToRef(axis,angle,result){var s=Math.sin(-angle);var c=Math.cos(-angle);var c1=1-c;axis.normalize();var m=result._m;m[0]=axis._x*axis._x*c1+c;m[1]=axis._x*axis._y*c1-axis._z*s;m[2]=axis._x*axis._z*c1+axis._y*s;m[3]=0;m[4]=axis._y*axis._x*c1+axis._z*s;m[5]=axis._y*axis._y*c1+c;m[6]=axis._y*axis._z*c1-axis._x*s;m[7]=0;m[8]=axis._z*axis._x*c1-axis._y*s;m[9]=axis._z*axis._y*c1+axis._x*s;m[10]=axis._z*axis._z*c1+c;m[11]=0;m[12]=0;m[13]=0;m[14]=0;m[15]=1;result.markAsUpdated();return result;}},{key:"RotationAlignToRef",value:function RotationAlignToRef(from,to,result){var c=Vector3.Dot(to,from);var m=result._m;if(c<-1+Epsilon){m[0]=-1;m[1]=0;m[2]=0;m[3]=0;m[4]=0;m[5]=-1;m[6]=0;m[7]=0;m[8]=0;m[9]=0;m[10]=1;m[11]=0;}else{var v=Vector3.Cross(to,from);var k=1/(1+c);m[0]=v._x*v._x*k+c;m[1]=v._y*v._x*k-v._z;m[2]=v._z*v._x*k+v._y;m[3]=0;m[4]=v._x*v._y*k+v._z;m[5]=v._y*v._y*k+c;m[6]=v._z*v._y*k-v._x;m[7]=0;m[8]=v._x*v._z*k-v._y;m[9]=v._y*v._z*k+v._x;m[10]=v._z*v._z*k+c;m[11]=0;}m[12]=0;m[13]=0;m[14]=0;m[15]=1;result.markAsUpdated();return result;}},{key:"RotationYawPitchRoll",value:function RotationYawPitchRoll(yaw,pitch,roll){var result=new Matrix();Matrix.RotationYawPitchRollToRef(yaw,pitch,roll,result);return result;}},{key:"RotationYawPitchRollToRef",value:function RotationYawPitchRollToRef(yaw,pitch,roll,result){Quaternion.RotationYawPitchRollToRef(yaw,pitch,roll,MathTmp.Quaternion[0]);MathTmp.Quaternion[0].toRotationMatrix(result);return result;}},{key:"Scaling",value:function Scaling(x,y,z){var result=new Matrix();Matrix.ScalingToRef(x,y,z,result);return result;}},{key:"ScalingToRef",value:function ScalingToRef(x,y,z,result){Matrix.FromValuesToRef(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1,result);result._updateIdentityStatus(x===1&&y===1&&z===1);return result;}},{key:"Translation",value:function Translation(x,y,z){var result=new Matrix();Matrix.TranslationToRef(x,y,z,result);return result;}},{key:"TranslationToRef",value:function TranslationToRef(x,y,z,result){Matrix.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,x,y,z,1,result);result._updateIdentityStatus(x===0&&y===0&&z===0);return result;}},{key:"Lerp",value:function Lerp(startValue,endValue,gradient){var result=new startValue.constructor();Matrix.LerpToRef(startValue,endValue,gradient,result);return result;}},{key:"LerpToRef",value:function LerpToRef(startValue,endValue,gradient,result){var resultM=result._m;var startM=startValue.m;var endM=endValue.m;for(var index=0;index<16;index++){resultM[index]=startM[index]*(1-gradient)+endM[index]*gradient;}result.markAsUpdated();return result;}},{key:"DecomposeLerp",value:function DecomposeLerp(startValue,endValue,gradient){var result=new startValue.constructor();Matrix.DecomposeLerpToRef(startValue,endValue,gradient,result);return result;}},{key:"DecomposeLerpToRef",value:function DecomposeLerpToRef(startValue,endValue,gradient,result){var startScale=MathTmp.Vector3[0];var startRotation=MathTmp.Quaternion[0];var startTranslation=MathTmp.Vector3[1];startValue.decompose(startScale,startRotation,startTranslation);var endScale=MathTmp.Vector3[2];var endRotation=MathTmp.Quaternion[1];var endTranslation=MathTmp.Vector3[3];endValue.decompose(endScale,endRotation,endTranslation);var resultScale=MathTmp.Vector3[4];Vector3.LerpToRef(startScale,endScale,gradient,resultScale);var resultRotation=MathTmp.Quaternion[2];Quaternion.SlerpToRef(startRotation,endRotation,gradient,resultRotation);var resultTranslation=MathTmp.Vector3[5];Vector3.LerpToRef(startTranslation,endTranslation,gradient,resultTranslation);Matrix.ComposeToRef(resultScale,resultRotation,resultTranslation,result);return result;}},{key:"LookAtLH",value:function LookAtLH(eye,target,up){var result=new Matrix();Matrix.LookAtLHToRef(eye,target,up,result);return result;}},{key:"LookAtLHToRef",value:function LookAtLHToRef(eye,target,up,result){var xAxis=MathTmp.Vector3[0];var yAxis=MathTmp.Vector3[1];var zAxis=MathTmp.Vector3[2];target.subtractToRef(eye,zAxis);zAxis.normalize();Vector3.CrossToRef(up,zAxis,xAxis);var xSquareLength=xAxis.lengthSquared();if(xSquareLength===0){xAxis.x=1;}else{xAxis.normalizeFromLength(Math.sqrt(xSquareLength));}Vector3.CrossToRef(zAxis,xAxis,yAxis);yAxis.normalize();var ex=-Vector3.Dot(xAxis,eye);var ey=-Vector3.Dot(yAxis,eye);var ez=-Vector3.Dot(zAxis,eye);Matrix.FromValuesToRef(xAxis._x,yAxis._x,zAxis._x,0,xAxis._y,yAxis._y,zAxis._y,0,xAxis._z,yAxis._z,zAxis._z,0,ex,ey,ez,1,result);}},{key:"LookAtRH",value:function LookAtRH(eye,target,up){var result=new Matrix();Matrix.LookAtRHToRef(eye,target,up,result);return result;}},{key:"LookAtRHToRef",value:function LookAtRHToRef(eye,target,up,result){var xAxis=MathTmp.Vector3[0];var yAxis=MathTmp.Vector3[1];var zAxis=MathTmp.Vector3[2];eye.subtractToRef(target,zAxis);zAxis.normalize();Vector3.CrossToRef(up,zAxis,xAxis);var xSquareLength=xAxis.lengthSquared();if(xSquareLength===0){xAxis.x=1;}else{xAxis.normalizeFromLength(Math.sqrt(xSquareLength));}Vector3.CrossToRef(zAxis,xAxis,yAxis);yAxis.normalize();var ex=-Vector3.Dot(xAxis,eye);var ey=-Vector3.Dot(yAxis,eye);var ez=-Vector3.Dot(zAxis,eye);Matrix.FromValuesToRef(xAxis._x,yAxis._x,zAxis._x,0,xAxis._y,yAxis._y,zAxis._y,0,xAxis._z,yAxis._z,zAxis._z,0,ex,ey,ez,1,result);return result;}},{key:"LookDirectionLH",value:function LookDirectionLH(forward,up){var result=new Matrix();Matrix.LookDirectionLHToRef(forward,up,result);return result;}},{key:"LookDirectionLHToRef",value:function LookDirectionLHToRef(forward,up,result){var back=MathTmp.Vector3[0];back.copyFrom(forward);back.scaleInPlace(-1);var left=MathTmp.Vector3[1];Vector3.CrossToRef(up,back,left);Matrix.FromValuesToRef(left._x,left._y,left._z,0,up._x,up._y,up._z,0,back._x,back._y,back._z,0,0,0,0,1,result);return result;}},{key:"LookDirectionRH",value:function LookDirectionRH(forward,up){var result=new Matrix();Matrix.LookDirectionRHToRef(forward,up,result);return result;}},{key:"LookDirectionRHToRef",value:function LookDirectionRHToRef(forward,up,result){var right=MathTmp.Vector3[2];Vector3.CrossToRef(up,forward,right);Matrix.FromValuesToRef(right._x,right._y,right._z,0,up._x,up._y,up._z,0,forward._x,forward._y,forward._z,0,0,0,0,1,result);return result;}},{key:"OrthoLH",value:function OrthoLH(width,height,znear,zfar,halfZRange){var matrix=new Matrix();Matrix.OrthoLHToRef(width,height,znear,zfar,matrix,halfZRange);return matrix;}},{key:"OrthoLHToRef",value:function OrthoLHToRef(width,height,znear,zfar,result,halfZRange){var n=znear;var f=zfar;var a=2/width;var b=2/height;var c=2/(f-n);var d=-(f+n)/(f-n);Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,0,0,0,d,1,result);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result._updateIdentityStatus(a===1&&b===1&&c===1&&d===0);return result;}},{key:"OrthoOffCenterLH",value:function OrthoOffCenterLH(left,right,bottom,top,znear,zfar,halfZRange){var matrix=new Matrix();Matrix.OrthoOffCenterLHToRef(left,right,bottom,top,znear,zfar,matrix,halfZRange);return matrix;}},{key:"OrthoOffCenterLHToRef",value:function OrthoOffCenterLHToRef(left,right,bottom,top,znear,zfar,result,halfZRange){var n=znear;var f=zfar;var a=2/(right-left);var b=2/(top-bottom);var c=2/(f-n);var d=-(f+n)/(f-n);var i0=(left+right)/(left-right);var i1=(top+bottom)/(bottom-top);Matrix.FromValuesToRef(a,0,0,0,0,b,0,0,0,0,c,0,i0,i1,d,1,result);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result.markAsUpdated();return result;}},{key:"OrthoOffCenterRH",value:function OrthoOffCenterRH(left,right,bottom,top,znear,zfar,halfZRange){var matrix=new Matrix();Matrix.OrthoOffCenterRHToRef(left,right,bottom,top,znear,zfar,matrix,halfZRange);return matrix;}},{key:"OrthoOffCenterRHToRef",value:function OrthoOffCenterRHToRef(left,right,bottom,top,znear,zfar,result,halfZRange){Matrix.OrthoOffCenterLHToRef(left,right,bottom,top,znear,zfar,result,halfZRange);result._m[10]*=-1;return result;}},{key:"PerspectiveLH",value:function PerspectiveLH(width,height,znear,zfar,halfZRange){var projectionPlaneTilt=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var matrix=new Matrix();var n=znear;var f=zfar;var a=2*n/width;var b=2*n/height;var c=(f+n)/(f-n);var d=-2*f*n/(f-n);var rot=Math.tan(projectionPlaneTilt);Matrix.FromValuesToRef(a,0,0,0,0,b,0,rot,0,0,c,1,0,0,d,0,matrix);if(halfZRange){matrix.multiplyToRef(mtxConvertNDCToHalfZRange,matrix);}matrix._updateIdentityStatus(false);return matrix;}},{key:"PerspectiveFovLH",value:function PerspectiveFovLH(fov,aspect,znear,zfar,halfZRange){var projectionPlaneTilt=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var reverseDepthBufferMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var matrix=new Matrix();Matrix.PerspectiveFovLHToRef(fov,aspect,znear,zfar,matrix,true,halfZRange,projectionPlaneTilt,reverseDepthBufferMode);return matrix;}},{key:"PerspectiveFovLHToRef",value:function PerspectiveFovLHToRef(fov,aspect,znear,zfar,result){var isVerticalFovFixed=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var halfZRange=arguments.length>6?arguments[6]:undefined;var projectionPlaneTilt=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var reverseDepthBufferMode=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var n=znear;var f=zfar;var t=1/Math.tan(fov*0.5);var a=isVerticalFovFixed?t/aspect:t;var b=isVerticalFovFixed?t:t*aspect;var c=reverseDepthBufferMode&&n===0?-1:f!==0?(f+n)/(f-n):1;var d=reverseDepthBufferMode&&n===0?2*f:f!==0?-2*f*n/(f-n):-2*n;var rot=Math.tan(projectionPlaneTilt);Matrix.FromValuesToRef(a,0,0,0,0,b,0,rot,0,0,c,1,0,0,d,0,result);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result._updateIdentityStatus(false);return result;}},{key:"PerspectiveFovReverseLHToRef",value:function PerspectiveFovReverseLHToRef(fov,aspect,znear,zfar,result){var isVerticalFovFixed=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var halfZRange=arguments.length>6?arguments[6]:undefined;var projectionPlaneTilt=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var t=1/Math.tan(fov*0.5);var a=isVerticalFovFixed?t/aspect:t;var b=isVerticalFovFixed?t:t*aspect;var rot=Math.tan(projectionPlaneTilt);Matrix.FromValuesToRef(a,0,0,0,0,b,0,rot,0,0,-znear,1,0,0,1,0,result);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result._updateIdentityStatus(false);return result;}},{key:"PerspectiveFovRH",value:function PerspectiveFovRH(fov,aspect,znear,zfar,halfZRange){var projectionPlaneTilt=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var reverseDepthBufferMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var matrix=new Matrix();Matrix.PerspectiveFovRHToRef(fov,aspect,znear,zfar,matrix,true,halfZRange,projectionPlaneTilt,reverseDepthBufferMode);return matrix;}},{key:"PerspectiveFovRHToRef",value:function PerspectiveFovRHToRef(fov,aspect,znear,zfar,result){var isVerticalFovFixed=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var halfZRange=arguments.length>6?arguments[6]:undefined;var projectionPlaneTilt=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var reverseDepthBufferMode=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var n=znear;var f=zfar;var t=1/Math.tan(fov*0.5);var a=isVerticalFovFixed?t/aspect:t;var b=isVerticalFovFixed?t:t*aspect;var c=reverseDepthBufferMode&&n===0?1:f!==0?-(f+n)/(f-n):-1;var d=reverseDepthBufferMode&&n===0?2*f:f!==0?-2*f*n/(f-n):-2*n;var rot=Math.tan(projectionPlaneTilt);Matrix.FromValuesToRef(a,0,0,0,0,b,0,rot,0,0,c,-1,0,0,d,0,result);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result._updateIdentityStatus(false);return result;}},{key:"PerspectiveFovReverseRHToRef",value:function PerspectiveFovReverseRHToRef(fov,aspect,znear,zfar,result){var isVerticalFovFixed=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var halfZRange=arguments.length>6?arguments[6]:undefined;var projectionPlaneTilt=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var t=1/Math.tan(fov*0.5);var a=isVerticalFovFixed?t/aspect:t;var b=isVerticalFovFixed?t:t*aspect;var rot=Math.tan(projectionPlaneTilt);Matrix.FromValuesToRef(a,0,0,0,0,b,0,rot,0,0,-znear,-1,0,0,-1,0,result);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result._updateIdentityStatus(false);return result;}},{key:"PerspectiveFovWebVRToRef",value:function PerspectiveFovWebVRToRef(fov,znear,zfar,result){var rightHanded=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var halfZRange=arguments.length>5?arguments[5]:undefined;var projectionPlaneTilt=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var rightHandedFactor=rightHanded?-1:1;var upTan=Math.tan(fov.upDegrees*Math.PI/180);var downTan=Math.tan(fov.downDegrees*Math.PI/180);var leftTan=Math.tan(fov.leftDegrees*Math.PI/180);var rightTan=Math.tan(fov.rightDegrees*Math.PI/180);var xScale=2/(leftTan+rightTan);var yScale=2/(upTan+downTan);var rot=Math.tan(projectionPlaneTilt);var m=result._m;m[0]=xScale;m[1]=m[2]=m[3]=m[4]=0;m[5]=yScale;m[6]=0;m[7]=rot;m[8]=(leftTan-rightTan)*xScale*0.5;m[9]=-((upTan-downTan)*yScale*0.5);m[10]=-zfar/(znear-zfar);m[11]=1*rightHandedFactor;m[12]=m[13]=m[15]=0;m[14]=-(2*zfar*znear)/(zfar-znear);if(halfZRange){result.multiplyToRef(mtxConvertNDCToHalfZRange,result);}result.markAsUpdated();return result;}},{key:"GetFinalMatrix",value:function GetFinalMatrix(viewport,world,view,projection,zmin,zmax){var cw=viewport.width;var ch=viewport.height;var cx=viewport.x;var cy=viewport.y;var viewportMatrix=Matrix.FromValues(cw/2,0,0,0,0,-ch/2,0,0,0,0,zmax-zmin,0,cx+cw/2,ch/2+cy,zmin,1);var matrix=new world.constructor();world.multiplyToRef(view,matrix);matrix.multiplyToRef(projection,matrix);return matrix.multiplyToRef(viewportMatrix,matrix);}},{key:"GetAsMatrix2x2",value:function GetAsMatrix2x2(matrix){var m=matrix.m;var arr=[m[0],m[1],m[4],m[5]];return PerformanceConfigurator.MatrixUse64Bits?arr:new Float32Array(arr);}},{key:"GetAsMatrix3x3",value:function GetAsMatrix3x3(matrix){var m=matrix.m;var arr=[m[0],m[1],m[2],m[4],m[5],m[6],m[8],m[9],m[10]];return PerformanceConfigurator.MatrixUse64Bits?arr:new Float32Array(arr);}},{key:"Transpose",value:function Transpose(matrix){var result=new matrix.constructor();Matrix.TransposeToRef(matrix,result);return result;}},{key:"TransposeToRef",value:function TransposeToRef(matrix,result){var rm=result._m;var mm=matrix.m;rm[0]=mm[0];rm[1]=mm[4];rm[2]=mm[8];rm[3]=mm[12];rm[4]=mm[1];rm[5]=mm[5];rm[6]=mm[9];rm[7]=mm[13];rm[8]=mm[2];rm[9]=mm[6];rm[10]=mm[10];rm[11]=mm[14];rm[12]=mm[3];rm[13]=mm[7];rm[14]=mm[11];rm[15]=mm[15];result.markAsUpdated();result._updateIdentityStatus(matrix._isIdentity,matrix._isIdentityDirty);return result;}},{key:"Reflection",value:function Reflection(plane){var matrix=new Matrix();Matrix.ReflectionToRef(plane,matrix);return matrix;}},{key:"ReflectionToRef",value:function ReflectionToRef(plane,result){plane.normalize();var x=plane.normal.x;var y=plane.normal.y;var z=plane.normal.z;var temp=-2*x;var temp2=-2*y;var temp3=-2*z;Matrix.FromValuesToRef(temp*x+1,temp2*x,temp3*x,0,temp*y,temp2*y+1,temp3*y,0,temp*z,temp2*z,temp3*z+1,0,temp*plane.d,temp2*plane.d,temp3*plane.d,1,result);return result;}},{key:"FromXYZAxesToRef",value:function FromXYZAxesToRef(xaxis,yaxis,zaxis,result){Matrix.FromValuesToRef(xaxis._x,xaxis._y,xaxis._z,0,yaxis._x,yaxis._y,yaxis._z,0,zaxis._x,zaxis._y,zaxis._z,0,0,0,0,1,result);return result;}},{key:"FromQuaternionToRef",value:function FromQuaternionToRef(quat,result){var xx=quat._x*quat._x;var yy=quat._y*quat._y;var zz=quat._z*quat._z;var xy=quat._x*quat._y;var zw=quat._z*quat._w;var zx=quat._z*quat._x;var yw=quat._y*quat._w;var yz=quat._y*quat._z;var xw=quat._x*quat._w;result._m[0]=1-2*(yy+zz);result._m[1]=2*(xy+zw);result._m[2]=2*(zx-yw);result._m[3]=0;result._m[4]=2*(xy-zw);result._m[5]=1-2*(zz+xx);result._m[6]=2*(yz+xw);result._m[7]=0;result._m[8]=2*(zx+yw);result._m[9]=2*(yz-xw);result._m[10]=1-2*(yy+xx);result._m[11]=0;result._m[12]=0;result._m[13]=0;result._m[14]=0;result._m[15]=1;result.markAsUpdated();return result;}}]);return Matrix;}();Matrix._UpdateFlagSeed=0;Matrix._IdentityReadOnly=Matrix.Identity();var MathTmp=/*#__PURE__*/_createClass(function MathTmp(){_classCallCheck(this,MathTmp);});MathTmp.Vector3=ArrayTools.BuildTuple(11,Vector3.Zero);MathTmp.Matrix=ArrayTools.BuildTuple(2,Matrix.Identity);MathTmp.Quaternion=ArrayTools.BuildTuple(3,Quaternion.Zero);var TmpVectors=/*#__PURE__*/_createClass(function TmpVectors(){_classCallCheck(this,TmpVectors);});TmpVectors.Vector2=ArrayTools.BuildTuple(3,Vector2.Zero);TmpVectors.Vector3=ArrayTools.BuildTuple(13,Vector3.Zero);TmpVectors.Vector4=ArrayTools.BuildTuple(3,Vector4.Zero);TmpVectors.Quaternion=ArrayTools.BuildTuple(2,Quaternion.Zero);TmpVectors.Matrix=ArrayTools.BuildTuple(8,Matrix.Identity);RegisterClass("BABYLON.Vector2",Vector2);RegisterClass("BABYLON.Vector3",Vector3);RegisterClass("BABYLON.Vector4",Vector4);RegisterClass("BABYLON.Matrix",Matrix);var mtxConvertNDCToHalfZRange=Matrix.FromValues(1,0,0,0,0,1,0,0,0,0,0.5,0,0,0,0.5,1);// node_modules/@babylonjs/core/abstractScene.js
var AbstractScene=/*#__PURE__*/function(){function AbstractScene(){_classCallCheck(this,AbstractScene);this.rootNodes=new Array();this.cameras=new Array();this.lights=new Array();this.meshes=new Array();this.skeletons=new Array();this.particleSystems=new Array();this.animations=[];this.animationGroups=new Array();this.multiMaterials=new Array();this.materials=new Array();this.morphTargetManagers=new Array();this.geometries=new Array();this.transformNodes=new Array();this.actionManagers=new Array();this.textures=new Array();this._environmentTexture=null;this.postProcesses=new Array();}_createClass(AbstractScene,[{key:"environmentTexture",get:function get(){return this._environmentTexture;},set:function set(value){this._environmentTexture=value;}},{key:"getNodes",value:function getNodes(){var nodes=new Array();nodes=nodes.concat(this.meshes);nodes=nodes.concat(this.lights);nodes=nodes.concat(this.cameras);nodes=nodes.concat(this.transformNodes);this.skeletons.forEach(function(skeleton){return nodes=nodes.concat(skeleton.bones);});return nodes;}}],[{key:"AddParser",value:function AddParser(name135,parser){this._BabylonFileParsers[name135]=parser;}},{key:"GetParser",value:function GetParser(name135){if(this._BabylonFileParsers[name135]){return this._BabylonFileParsers[name135];}return null;}},{key:"AddIndividualParser",value:function AddIndividualParser(name135,parser){this._IndividualBabylonFileParsers[name135]=parser;}},{key:"GetIndividualParser",value:function GetIndividualParser(name135){if(this._IndividualBabylonFileParsers[name135]){return this._IndividualBabylonFileParsers[name135];}return null;}},{key:"Parse",value:function Parse(jsonData,scene2,container,rootUrl){for(var parserName in this._BabylonFileParsers){if(Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,parserName)){this._BabylonFileParsers[parserName](jsonData,scene2,container,rootUrl);}}}}]);return AbstractScene;}();AbstractScene._BabylonFileParsers={};AbstractScene._IndividualBabylonFileParsers={};// node_modules/@babylonjs/core/tslib.es6.js
function __decorate(decorators,target,key,desc){var c=arguments.length,r=c<3?target:desc===null?desc=Object.getOwnPropertyDescriptor(target,key):desc,d;if((typeof Reflect==="undefined"?"undefined":_typeof(Reflect))==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r;return c>3&&r&&Object.defineProperty(target,key,r),r;}// node_modules/@babylonjs/core/Maths/math.color.js
var Color3=/*#__PURE__*/function(){function Color3(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var g=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var b=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,Color3);this.r=r;this.g=g;this.b=b;}_createClass(Color3,[{key:"toString",value:function toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}";}},{key:"getClassName",value:function getClassName(){return"Color3";}},{key:"getHashCode",value:function getHashCode(){var hash=this.r*255|0;hash=hash*397^(this.g*255|0);hash=hash*397^(this.b*255|0);return hash;}},{key:"toArray",value:function toArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[index]=this.r;array[index+1]=this.g;array[index+2]=this.b;return this;}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;Color3.FromArrayToRef(array,offset,this);return this;}},{key:"toColor4",value:function toColor4(){var alpha=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return new Color4(this.r,this.g,this.b,alpha);}},{key:"asArray",value:function asArray(){return[this.r,this.g,this.b];}},{key:"toLuminance",value:function toLuminance(){return this.r*0.3+this.g*0.59+this.b*0.11;}},{key:"multiply",value:function multiply(otherColor){return new Color3(this.r*otherColor.r,this.g*otherColor.g,this.b*otherColor.b);}},{key:"multiplyToRef",value:function multiplyToRef(otherColor,result){result.r=this.r*otherColor.r;result.g=this.g*otherColor.g;result.b=this.b*otherColor.b;return this;}},{key:"equals",value:function equals(otherColor){return otherColor&&this.r===otherColor.r&&this.g===otherColor.g&&this.b===otherColor.b;}},{key:"equalsFloats",value:function equalsFloats(r,g,b){return this.r===r&&this.g===g&&this.b===b;}},{key:"scale",value:function scale(_scale5){return new Color3(this.r*_scale5,this.g*_scale5,this.b*_scale5);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this.r*=scale;this.g*=scale;this.b*=scale;return this;}},{key:"scaleToRef",value:function scaleToRef(scale,result){result.r=this.r*scale;result.g=this.g*scale;result.b=this.b*scale;return this;}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){result.r+=this.r*scale;result.g+=this.g*scale;result.b+=this.b*scale;return this;}},{key:"clampToRef",value:function clampToRef(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var result=arguments.length>2?arguments[2]:undefined;result.r=Scalar.Clamp(this.r,min,max);result.g=Scalar.Clamp(this.g,min,max);result.b=Scalar.Clamp(this.b,min,max);return this;}},{key:"add",value:function add(otherColor){return new Color3(this.r+otherColor.r,this.g+otherColor.g,this.b+otherColor.b);}},{key:"addToRef",value:function addToRef(otherColor,result){result.r=this.r+otherColor.r;result.g=this.g+otherColor.g;result.b=this.b+otherColor.b;return this;}},{key:"subtract",value:function subtract(otherColor){return new Color3(this.r-otherColor.r,this.g-otherColor.g,this.b-otherColor.b);}},{key:"subtractToRef",value:function subtractToRef(otherColor,result){result.r=this.r-otherColor.r;result.g=this.g-otherColor.g;result.b=this.b-otherColor.b;return this;}},{key:"clone",value:function clone(){return new Color3(this.r,this.g,this.b);}},{key:"copyFrom",value:function copyFrom(source){this.r=source.r;this.g=source.g;this.b=source.b;return this;}},{key:"copyFromFloats",value:function copyFromFloats(r,g,b){this.r=r;this.g=g;this.b=b;return this;}},{key:"set",value:function set(r,g,b){return this.copyFromFloats(r,g,b);}},{key:"toHexString",value:function toHexString(){var intR=Math.round(this.r*255);var intG=Math.round(this.g*255);var intB=Math.round(this.b*255);return"#"+Scalar.ToHex(intR)+Scalar.ToHex(intG)+Scalar.ToHex(intB);}},{key:"toLinearSpace",value:function toLinearSpace(){var convertedColor=new Color3();this.toLinearSpaceToRef(convertedColor);return convertedColor;}},{key:"toHSV",value:function toHSV(){var result=new Color3();this.toHSVToRef(result);return result;}},{key:"toHSVToRef",value:function toHSVToRef(result){var r=this.r;var g=this.g;var b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var h=0;var s=0;var v=max;var dm=max-min;if(max!==0){s=dm/max;}if(max!=min){if(max==r){h=(g-b)/dm;if(g<b){h+=6;}}else if(max==g){h=(b-r)/dm+2;}else if(max==b){h=(r-g)/dm+4;}h*=60;}result.r=h;result.g=s;result.b=v;}},{key:"toLinearSpaceToRef",value:function toLinearSpaceToRef(convertedColor){convertedColor.r=Math.pow(this.r,ToLinearSpace);convertedColor.g=Math.pow(this.g,ToLinearSpace);convertedColor.b=Math.pow(this.b,ToLinearSpace);return this;}},{key:"toGammaSpace",value:function toGammaSpace(){var convertedColor=new Color3();this.toGammaSpaceToRef(convertedColor);return convertedColor;}},{key:"toGammaSpaceToRef",value:function toGammaSpaceToRef(convertedColor){convertedColor.r=Math.pow(this.r,ToGammaSpace);convertedColor.g=Math.pow(this.g,ToGammaSpace);convertedColor.b=Math.pow(this.b,ToGammaSpace);return this;}}],[{key:"HSVtoRGBToRef",value:function HSVtoRGBToRef(hue,saturation,value,result){var chroma=value*saturation;var h=hue/60;var x=chroma*(1-Math.abs(h%2-1));var r=0;var g=0;var b=0;if(h>=0&&h<=1){r=chroma;g=x;}else if(h>=1&&h<=2){r=x;g=chroma;}else if(h>=2&&h<=3){g=chroma;b=x;}else if(h>=3&&h<=4){g=x;b=chroma;}else if(h>=4&&h<=5){r=x;b=chroma;}else if(h>=5&&h<=6){r=chroma;b=x;}var m=value-chroma;result.set(r+m,g+m,b+m);}},{key:"FromHSV",value:function FromHSV(hue,saturation,value){var result=new Color3(0,0,0);Color3.HSVtoRGBToRef(hue,saturation,value,result);return result;}},{key:"FromHexString",value:function FromHexString(hex){if(hex.substring(0,1)!=="#"||hex.length!==7){return new Color3(0,0,0);}var r=parseInt(hex.substring(1,3),16);var g=parseInt(hex.substring(3,5),16);var b=parseInt(hex.substring(5,7),16);return Color3.FromInts(r,g,b);}},{key:"FromArray",value:function FromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Color3(array[offset],array[offset+1],array[offset+2]);}},{key:"FromArrayToRef",value:function FromArrayToRef(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var result=arguments.length>2?arguments[2]:undefined;result.r=array[offset];result.g=array[offset+1];result.b=array[offset+2];}},{key:"FromInts",value:function FromInts(r,g,b){return new Color3(r/255,g/255,b/255);}},{key:"Lerp",value:function Lerp(start,end,amount){var result=new Color3(0,0,0);Color3.LerpToRef(start,end,amount,result);return result;}},{key:"LerpToRef",value:function LerpToRef(left,right,amount,result){result.r=left.r+(right.r-left.r)*amount;result.g=left.g+(right.g-left.g)*amount;result.b=left.b+(right.b-left.b)*amount;}},{key:"Hermite",value:function Hermite(value1,tangent1,value2,tangent2,amount){var squared=amount*amount;var cubed=amount*squared;var part1=2*cubed-3*squared+1;var part2=-2*cubed+3*squared;var part3=cubed-2*squared+amount;var part4=cubed-squared;var r=value1.r*part1+value2.r*part2+tangent1.r*part3+tangent2.r*part4;var g=value1.g*part1+value2.g*part2+tangent1.g*part3+tangent2.g*part4;var b=value1.b*part1+value2.b*part2+tangent1.b*part3+tangent2.b*part4;return new Color3(r,g,b);}},{key:"Hermite1stDerivative",value:function Hermite1stDerivative(value1,tangent1,value2,tangent2,time){var result=Color3.Black();this.Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result);return result;}},{key:"Hermite1stDerivativeToRef",value:function Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result){var t2=time*time;result.r=(t2-time)*6*value1.r+(3*t2-4*time+1)*tangent1.r+(-t2+time)*6*value2.r+(3*t2-2*time)*tangent2.r;result.g=(t2-time)*6*value1.g+(3*t2-4*time+1)*tangent1.g+(-t2+time)*6*value2.g+(3*t2-2*time)*tangent2.g;result.b=(t2-time)*6*value1.b+(3*t2-4*time+1)*tangent1.b+(-t2+time)*6*value2.b+(3*t2-2*time)*tangent2.b;}},{key:"Red",value:function Red(){return new Color3(1,0,0);}},{key:"Green",value:function Green(){return new Color3(0,1,0);}},{key:"Blue",value:function Blue(){return new Color3(0,0,1);}},{key:"Black",value:function Black(){return new Color3(0,0,0);}},{key:"BlackReadOnly",get:function get(){return Color3._BlackReadOnly;}},{key:"White",value:function White(){return new Color3(1,1,1);}},{key:"Purple",value:function Purple(){return new Color3(0.5,0,0.5);}},{key:"Magenta",value:function Magenta(){return new Color3(1,0,1);}},{key:"Yellow",value:function Yellow(){return new Color3(1,1,0);}},{key:"Gray",value:function Gray(){return new Color3(0.5,0.5,0.5);}},{key:"Teal",value:function Teal(){return new Color3(0,1,1);}},{key:"Random",value:function Random(){return new Color3(Math.random(),Math.random(),Math.random());}}]);return Color3;}();Color3._BlackReadOnly=Color3.Black();var Color4=/*#__PURE__*/function(){function Color4(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var g=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var b=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;_classCallCheck(this,Color4);this.r=r;this.g=g;this.b=b;this.a=a;}_createClass(Color4,[{key:"addInPlace",value:function addInPlace(right){this.r+=right.r;this.g+=right.g;this.b+=right.b;this.a+=right.a;return this;}},{key:"asArray",value:function asArray(){return[this.r,this.g,this.b,this.a];}},{key:"toArray",value:function toArray(array){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;array[index]=this.r;array[index+1]=this.g;array[index+2]=this.b;array[index+3]=this.a;return this;}},{key:"fromArray",value:function fromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;Color4.FromArrayToRef(array,offset,this);return this;}},{key:"equals",value:function equals(otherColor){return otherColor&&this.r===otherColor.r&&this.g===otherColor.g&&this.b===otherColor.b&&this.a===otherColor.a;}},{key:"add",value:function add(right){return new Color4(this.r+right.r,this.g+right.g,this.b+right.b,this.a+right.a);}},{key:"subtract",value:function subtract(right){return new Color4(this.r-right.r,this.g-right.g,this.b-right.b,this.a-right.a);}},{key:"subtractToRef",value:function subtractToRef(right,result){result.r=this.r-right.r;result.g=this.g-right.g;result.b=this.b-right.b;result.a=this.a-right.a;return this;}},{key:"scale",value:function scale(_scale6){return new Color4(this.r*_scale6,this.g*_scale6,this.b*_scale6,this.a*_scale6);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this.r*=scale;this.g*=scale;this.b*=scale;this.a*=scale;return this;}},{key:"scaleToRef",value:function scaleToRef(scale,result){result.r=this.r*scale;result.g=this.g*scale;result.b=this.b*scale;result.a=this.a*scale;return this;}},{key:"scaleAndAddToRef",value:function scaleAndAddToRef(scale,result){result.r+=this.r*scale;result.g+=this.g*scale;result.b+=this.b*scale;result.a+=this.a*scale;return this;}},{key:"clampToRef",value:function clampToRef(){var min=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var max=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var result=arguments.length>2?arguments[2]:undefined;result.r=Scalar.Clamp(this.r,min,max);result.g=Scalar.Clamp(this.g,min,max);result.b=Scalar.Clamp(this.b,min,max);result.a=Scalar.Clamp(this.a,min,max);return this;}},{key:"multiply",value:function multiply(color){return new Color4(this.r*color.r,this.g*color.g,this.b*color.b,this.a*color.a);}},{key:"multiplyToRef",value:function multiplyToRef(color,result){result.r=this.r*color.r;result.g=this.g*color.g;result.b=this.b*color.b;result.a=this.a*color.a;return result;}},{key:"toString",value:function toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}";}},{key:"getClassName",value:function getClassName(){return"Color4";}},{key:"getHashCode",value:function getHashCode(){var hash=this.r*255|0;hash=hash*397^(this.g*255|0);hash=hash*397^(this.b*255|0);hash=hash*397^(this.a*255|0);return hash;}},{key:"clone",value:function clone(){return new Color4(this.r,this.g,this.b,this.a);}},{key:"copyFrom",value:function copyFrom(source){this.r=source.r;this.g=source.g;this.b=source.b;this.a=source.a;return this;}},{key:"copyFromFloats",value:function copyFromFloats(r,g,b,a){this.r=r;this.g=g;this.b=b;this.a=a;return this;}},{key:"set",value:function set(r,g,b,a){return this.copyFromFloats(r,g,b,a);}},{key:"toHexString",value:function toHexString(){var returnAsColor3=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var intR=Math.round(this.r*255);var intG=Math.round(this.g*255);var intB=Math.round(this.b*255);if(returnAsColor3){return"#"+Scalar.ToHex(intR)+Scalar.ToHex(intG)+Scalar.ToHex(intB);}var intA=Math.round(this.a*255);return"#"+Scalar.ToHex(intR)+Scalar.ToHex(intG)+Scalar.ToHex(intB)+Scalar.ToHex(intA);}},{key:"toLinearSpace",value:function toLinearSpace(){var convertedColor=new Color4();this.toLinearSpaceToRef(convertedColor);return convertedColor;}},{key:"toLinearSpaceToRef",value:function toLinearSpaceToRef(convertedColor){convertedColor.r=Math.pow(this.r,ToLinearSpace);convertedColor.g=Math.pow(this.g,ToLinearSpace);convertedColor.b=Math.pow(this.b,ToLinearSpace);convertedColor.a=this.a;return this;}},{key:"toGammaSpace",value:function toGammaSpace(){var convertedColor=new Color4();this.toGammaSpaceToRef(convertedColor);return convertedColor;}},{key:"toGammaSpaceToRef",value:function toGammaSpaceToRef(convertedColor){convertedColor.r=Math.pow(this.r,ToGammaSpace);convertedColor.g=Math.pow(this.g,ToGammaSpace);convertedColor.b=Math.pow(this.b,ToGammaSpace);convertedColor.a=this.a;return this;}}],[{key:"FromHexString",value:function FromHexString(hex){if(hex.substring(0,1)!=="#"||hex.length!==9&&hex.length!==7){return new Color4(0,0,0,0);}var r=parseInt(hex.substring(1,3),16);var g=parseInt(hex.substring(3,5),16);var b=parseInt(hex.substring(5,7),16);var a=hex.length===9?parseInt(hex.substring(7,9),16):255;return Color4.FromInts(r,g,b,a);}},{key:"Lerp",value:function Lerp(left,right,amount){var result=new Color4(0,0,0,0);Color4.LerpToRef(left,right,amount,result);return result;}},{key:"LerpToRef",value:function LerpToRef(left,right,amount,result){result.r=left.r+(right.r-left.r)*amount;result.g=left.g+(right.g-left.g)*amount;result.b=left.b+(right.b-left.b)*amount;result.a=left.a+(right.a-left.a)*amount;}},{key:"Hermite",value:function Hermite(value1,tangent1,value2,tangent2,amount){var squared=amount*amount;var cubed=amount*squared;var part1=2*cubed-3*squared+1;var part2=-2*cubed+3*squared;var part3=cubed-2*squared+amount;var part4=cubed-squared;var r=value1.r*part1+value2.r*part2+tangent1.r*part3+tangent2.r*part4;var g=value1.g*part1+value2.g*part2+tangent1.g*part3+tangent2.g*part4;var b=value1.b*part1+value2.b*part2+tangent1.b*part3+tangent2.b*part4;var a=value1.a*part1+value2.a*part2+tangent1.a*part3+tangent2.a*part4;return new Color4(r,g,b,a);}},{key:"Hermite1stDerivative",value:function Hermite1stDerivative(value1,tangent1,value2,tangent2,time){var result=new Color4();this.Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result);return result;}},{key:"Hermite1stDerivativeToRef",value:function Hermite1stDerivativeToRef(value1,tangent1,value2,tangent2,time,result){var t2=time*time;result.r=(t2-time)*6*value1.r+(3*t2-4*time+1)*tangent1.r+(-t2+time)*6*value2.r+(3*t2-2*time)*tangent2.r;result.g=(t2-time)*6*value1.g+(3*t2-4*time+1)*tangent1.g+(-t2+time)*6*value2.g+(3*t2-2*time)*tangent2.g;result.b=(t2-time)*6*value1.b+(3*t2-4*time+1)*tangent1.b+(-t2+time)*6*value2.b+(3*t2-2*time)*tangent2.b;result.a=(t2-time)*6*value1.a+(3*t2-4*time+1)*tangent1.a+(-t2+time)*6*value2.a+(3*t2-2*time)*tangent2.a;}},{key:"FromColor3",value:function FromColor3(color3){var alpha=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return new Color4(color3.r,color3.g,color3.b,alpha);}},{key:"FromArray",value:function FromArray(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return new Color4(array[offset],array[offset+1],array[offset+2],array[offset+3]);}},{key:"FromArrayToRef",value:function FromArrayToRef(array){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var result=arguments.length>2?arguments[2]:undefined;result.r=array[offset];result.g=array[offset+1];result.b=array[offset+2];result.a=array[offset+3];}},{key:"FromInts",value:function FromInts(r,g,b,a){return new Color4(r/255,g/255,b/255,a/255);}},{key:"CheckColors4",value:function CheckColors4(colors,count){if(colors.length===count*3){var colors4=[];for(var index=0;index<colors.length;index+=3){var newIndex=index/3*4;colors4[newIndex]=colors[index];colors4[newIndex+1]=colors[index+1];colors4[newIndex+2]=colors[index+2];colors4[newIndex+3]=1;}return colors4;}return colors;}}]);return Color4;}();var TmpColors=/*#__PURE__*/_createClass(function TmpColors(){_classCallCheck(this,TmpColors);});TmpColors.Color3=ArrayTools.BuildArray(3,Color3.Black);TmpColors.Color4=ArrayTools.BuildArray(3,function(){return new Color4(0,0,0,0);});RegisterClass("BABYLON.Color3",Color3);RegisterClass("BABYLON.Color4",Color4);// node_modules/@babylonjs/core/Misc/decorators.js
var __decoratorInitialStore={};var __mergedStore={};var _copySource=function _copySource(creationFunction,source,instanciate){var destination=creationFunction();if(Tags){Tags.AddTagsTo(destination,source.tags);}var classStore=getMergedStore(destination);for(var property in classStore){var propertyDescriptor=classStore[property];var sourceProperty=source[property];var propertyType=propertyDescriptor.type;if(sourceProperty!==void 0&&sourceProperty!==null&&(property!=="uniqueId"||SerializationHelper.AllowLoadingUniqueId)){switch(propertyType){case 0:case 6:case 11:destination[property]=sourceProperty;break;case 1:destination[property]=instanciate||sourceProperty.isRenderTarget?sourceProperty:sourceProperty.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:destination[property]=instanciate?sourceProperty:sourceProperty.clone();break;}}}return destination;};function getDirectStore(target){var classKey=target.getClassName();if(!__decoratorInitialStore[classKey]){__decoratorInitialStore[classKey]={};}return __decoratorInitialStore[classKey];}function getMergedStore(target){var classKey=target.getClassName();if(__mergedStore[classKey]){return __mergedStore[classKey];}__mergedStore[classKey]={};var store=__mergedStore[classKey];var currentTarget=target;var currentKey=classKey;while(currentKey){var initialStore=__decoratorInitialStore[currentKey];for(var property in initialStore){store[property]=initialStore[property];}var parent=void 0;var done=false;do{parent=Object.getPrototypeOf(currentTarget);if(!parent.getClassName){done=true;break;}if(parent.getClassName()!==currentKey){break;}currentTarget=parent;}while(parent);if(done){break;}currentKey=parent.getClassName();currentTarget=parent;}return store;}function generateSerializableMember(type,sourceName){return function(target,propertyKey){var classStore=getDirectStore(target);if(!classStore[propertyKey]){classStore[propertyKey]={type:type,sourceName:sourceName};}};}function generateExpandMember(setCallback){var targetKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return function(target,propertyKey){var key=targetKey||"_"+propertyKey;Object.defineProperty(target,propertyKey,{get:function get(){return this[key];},set:function set(value){if(typeof this.equals==="function"){if(this.equals(value)){return;}}if(this[key]===value){return;}this[key]=value;target[setCallback].apply(this);},enumerable:true,configurable:true});};}function expandToProperty(callback){var targetKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;return generateExpandMember(callback,targetKey);}function serialize(sourceName){return generateSerializableMember(0,sourceName);}function serializeAsTexture(sourceName){return generateSerializableMember(1,sourceName);}function serializeAsColor3(sourceName){return generateSerializableMember(2,sourceName);}function serializeAsFresnelParameters(sourceName){return generateSerializableMember(3,sourceName);}function serializeAsVector2(sourceName){return generateSerializableMember(4,sourceName);}function serializeAsVector3(sourceName){return generateSerializableMember(5,sourceName);}function serializeAsMeshReference(sourceName){return generateSerializableMember(6,sourceName);}function serializeAsColorCurves(sourceName){return generateSerializableMember(7,sourceName);}function serializeAsColor4(sourceName){return generateSerializableMember(8,sourceName);}function serializeAsImageProcessingConfiguration(sourceName){return generateSerializableMember(9,sourceName);}function serializeAsQuaternion(sourceName){return generateSerializableMember(10,sourceName);}function serializeAsMatrix(sourceName){return generateSerializableMember(12,sourceName);}var SerializationHelper=/*#__PURE__*/function(){function SerializationHelper(){_classCallCheck(this,SerializationHelper);}_createClass(SerializationHelper,null,[{key:"AppendSerializedAnimations",value:function AppendSerializedAnimations(source,destination){if(source.animations){destination.animations=[];for(var animationIndex=0;animationIndex<source.animations.length;animationIndex++){var animation=source.animations[animationIndex];destination.animations.push(animation.serialize());}}}},{key:"Serialize",value:function Serialize(entity,serializationObject){if(!serializationObject){serializationObject={};}if(Tags){serializationObject.tags=Tags.GetTags(entity);}var serializedProperties=getMergedStore(entity);for(var property in serializedProperties){var propertyDescriptor=serializedProperties[property];var targetPropertyName=propertyDescriptor.sourceName||property;var propertyType=propertyDescriptor.type;var sourceProperty=entity[property];if(sourceProperty!==void 0&&sourceProperty!==null&&(property!=="uniqueId"||SerializationHelper.AllowLoadingUniqueId)){switch(propertyType){case 0:serializationObject[targetPropertyName]=sourceProperty;break;case 1:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 2:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 3:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 4:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 5:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 6:serializationObject[targetPropertyName]=sourceProperty.id;break;case 7:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 8:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 9:serializationObject[targetPropertyName]=sourceProperty.serialize();break;case 10:serializationObject[targetPropertyName]=sourceProperty.asArray();break;case 11:serializationObject[targetPropertyName]=sourceProperty.id;break;case 12:serializationObject[targetPropertyName]=sourceProperty.asArray();break;}}}return serializationObject;}},{key:"Parse",value:function Parse(creationFunction,source,scene2){var rootUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var destination=creationFunction();if(!rootUrl){rootUrl="";}if(Tags){Tags.AddTagsTo(destination,source.tags);}var classStore=getMergedStore(destination);for(var property in classStore){var propertyDescriptor=classStore[property];var sourceProperty=source[propertyDescriptor.sourceName||property];var propertyType=propertyDescriptor.type;if(sourceProperty!==void 0&&sourceProperty!==null&&(property!=="uniqueId"||SerializationHelper.AllowLoadingUniqueId)){var dest=destination;switch(propertyType){case 0:dest[property]=sourceProperty;break;case 1:if(scene2){dest[property]=SerializationHelper._TextureParser(sourceProperty,scene2,rootUrl);}break;case 2:dest[property]=Color3.FromArray(sourceProperty);break;case 3:dest[property]=SerializationHelper._FresnelParametersParser(sourceProperty);break;case 4:dest[property]=Vector2.FromArray(sourceProperty);break;case 5:dest[property]=Vector3.FromArray(sourceProperty);break;case 6:if(scene2){dest[property]=scene2.getLastMeshById(sourceProperty);}break;case 7:dest[property]=SerializationHelper._ColorCurvesParser(sourceProperty);break;case 8:dest[property]=Color4.FromArray(sourceProperty);break;case 9:dest[property]=SerializationHelper._ImageProcessingConfigurationParser(sourceProperty);break;case 10:dest[property]=Quaternion.FromArray(sourceProperty);break;case 11:if(scene2){dest[property]=scene2.getCameraById(sourceProperty);}break;case 12:dest[property]=Matrix.FromArray(sourceProperty);break;}}}return destination;}},{key:"Clone",value:function Clone(creationFunction,source){return _copySource(creationFunction,source,false);}},{key:"Instanciate",value:function Instanciate(creationFunction,source){return _copySource(creationFunction,source,true);}}]);return SerializationHelper;}();SerializationHelper.AllowLoadingUniqueId=false;SerializationHelper._ImageProcessingConfigurationParser=function(sourceProperty){throw _WarnImport("ImageProcessingConfiguration");};SerializationHelper._FresnelParametersParser=function(sourceProperty){throw _WarnImport("FresnelParameters");};SerializationHelper._ColorCurvesParser=function(sourceProperty){throw _WarnImport("ColorCurves");};SerializationHelper._TextureParser=function(sourceProperty,scene2,rootUrl){throw _WarnImport("Texture");};function nativeOverride(target,propertyKey,descriptor,predicate){var jsFunc=descriptor.value;descriptor.value=function(){var func=jsFunc;if(typeof _native!=="undefined"&&_native[propertyKey]){var nativeFunc=_native[propertyKey];if(predicate){func=function func(){return predicate.apply(void 0,arguments)?nativeFunc.apply(void 0,arguments):jsFunc.apply(void 0,arguments);};}else{func=nativeFunc;}}target[propertyKey]=func;return func.apply(void 0,arguments);};}nativeOverride.filter=function(predicate){return function(target,propertyKey,descriptor){return nativeOverride(target,propertyKey,descriptor,predicate);};};// node_modules/@babylonjs/core/Materials/materialDefines.js
var MaterialDefines=/*#__PURE__*/function(){function MaterialDefines(externalProperties){_classCallCheck(this,MaterialDefines);this._keys=[];this._isDirty=true;this._areLightsDirty=true;this._areLightsDisposed=false;this._areAttributesDirty=true;this._areTexturesDirty=true;this._areFresnelDirty=true;this._areMiscDirty=true;this._arePrePassDirty=true;this._areImageProcessingDirty=true;this._normals=false;this._uvs=false;this._needNormals=false;this._needUVs=false;this._externalProperties=externalProperties;if(externalProperties){for(var prop in externalProperties){if(Object.prototype.hasOwnProperty.call(externalProperties,prop)){this._setDefaultValue(prop);}}}}_createClass(MaterialDefines,[{key:"isDirty",get:function get(){return this._isDirty;}},{key:"markAsProcessed",value:function markAsProcessed(){this._isDirty=false;this._areAttributesDirty=false;this._areTexturesDirty=false;this._areFresnelDirty=false;this._areLightsDirty=false;this._areLightsDisposed=false;this._areMiscDirty=false;this._arePrePassDirty=false;this._areImageProcessingDirty=false;}},{key:"markAsUnprocessed",value:function markAsUnprocessed(){this._isDirty=true;}},{key:"markAllAsDirty",value:function markAllAsDirty(){this._areTexturesDirty=true;this._areAttributesDirty=true;this._areLightsDirty=true;this._areFresnelDirty=true;this._areMiscDirty=true;this._areImageProcessingDirty=true;this._isDirty=true;}},{key:"markAsImageProcessingDirty",value:function markAsImageProcessingDirty(){this._areImageProcessingDirty=true;this._isDirty=true;}},{key:"markAsLightDirty",value:function markAsLightDirty(){var disposed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._areLightsDirty=true;this._areLightsDisposed=this._areLightsDisposed||disposed;this._isDirty=true;}},{key:"markAsAttributesDirty",value:function markAsAttributesDirty(){this._areAttributesDirty=true;this._isDirty=true;}},{key:"markAsTexturesDirty",value:function markAsTexturesDirty(){this._areTexturesDirty=true;this._isDirty=true;}},{key:"markAsFresnelDirty",value:function markAsFresnelDirty(){this._areFresnelDirty=true;this._isDirty=true;}},{key:"markAsMiscDirty",value:function markAsMiscDirty(){this._areMiscDirty=true;this._isDirty=true;}},{key:"markAsPrePassDirty",value:function markAsPrePassDirty(){this._arePrePassDirty=true;this._isDirty=true;}},{key:"rebuild",value:function rebuild(){this._keys.length=0;for(var _i5=0,_Object$keys=Object.keys(this);_i5<_Object$keys.length;_i5++){var key=_Object$keys[_i5];if(key[0]==="_"){continue;}this._keys.push(key);}if(this._externalProperties){for(var name135 in this._externalProperties){if(this._keys.indexOf(name135)===-1){this._keys.push(name135);}}}}},{key:"isEqual",value:function isEqual(other){if(this._keys.length!==other._keys.length){return false;}for(var index=0;index<this._keys.length;index++){var prop=this._keys[index];if(this[prop]!==other[prop]){return false;}}return true;}},{key:"cloneTo",value:function cloneTo(other){if(this._keys.length!==other._keys.length){other._keys=this._keys.slice(0);}for(var index=0;index<this._keys.length;index++){var prop=this._keys[index];other[prop]=this[prop];}}},{key:"reset",value:function reset(){var _this36=this;this._keys.forEach(function(prop){return _this36._setDefaultValue(prop);});}},{key:"_setDefaultValue",value:function _setDefaultValue(prop){var _a,_b,_c,_d,_e;var type=(_c=(_b=(_a=this._externalProperties)===null||_a===void 0?void 0:_a[prop])===null||_b===void 0?void 0:_b.type)!==null&&_c!==void 0?_c:_typeof(this[prop]);var defValue=(_e=(_d=this._externalProperties)===null||_d===void 0?void 0:_d[prop])===null||_e===void 0?void 0:_e["default"];switch(type){case"number":this[prop]=defValue!==null&&defValue!==void 0?defValue:0;break;case"string":this[prop]=defValue!==null&&defValue!==void 0?defValue:"";break;default:this[prop]=defValue!==null&&defValue!==void 0?defValue:false;break;}}},{key:"toString",value:function toString(){var result="";for(var index=0;index<this._keys.length;index++){var prop=this._keys[index];var value=this[prop];var type=_typeof(value);switch(type){case"number":case"string":result+="#define "+prop+" "+value+"\n";break;default:if(value){result+="#define "+prop+"\n";}break;}}return result;}}]);return MaterialDefines;}();// node_modules/@babylonjs/core/Materials/colorCurves.js
var ColorCurves=/*#__PURE__*/function(){function ColorCurves(){_classCallCheck(this,ColorCurves);this._dirty=true;this._tempColor=new Color4(0,0,0,0);this._globalCurve=new Color4(0,0,0,0);this._highlightsCurve=new Color4(0,0,0,0);this._midtonesCurve=new Color4(0,0,0,0);this._shadowsCurve=new Color4(0,0,0,0);this._positiveCurve=new Color4(0,0,0,0);this._negativeCurve=new Color4(0,0,0,0);this._globalHue=30;this._globalDensity=0;this._globalSaturation=0;this._globalExposure=0;this._highlightsHue=30;this._highlightsDensity=0;this._highlightsSaturation=0;this._highlightsExposure=0;this._midtonesHue=30;this._midtonesDensity=0;this._midtonesSaturation=0;this._midtonesExposure=0;this._shadowsHue=30;this._shadowsDensity=0;this._shadowsSaturation=0;this._shadowsExposure=0;}_createClass(ColorCurves,[{key:"globalHue",get:function get(){return this._globalHue;},set:function set(value){this._globalHue=value;this._dirty=true;}},{key:"globalDensity",get:function get(){return this._globalDensity;},set:function set(value){this._globalDensity=value;this._dirty=true;}},{key:"globalSaturation",get:function get(){return this._globalSaturation;},set:function set(value){this._globalSaturation=value;this._dirty=true;}},{key:"globalExposure",get:function get(){return this._globalExposure;},set:function set(value){this._globalExposure=value;this._dirty=true;}},{key:"highlightsHue",get:function get(){return this._highlightsHue;},set:function set(value){this._highlightsHue=value;this._dirty=true;}},{key:"highlightsDensity",get:function get(){return this._highlightsDensity;},set:function set(value){this._highlightsDensity=value;this._dirty=true;}},{key:"highlightsSaturation",get:function get(){return this._highlightsSaturation;},set:function set(value){this._highlightsSaturation=value;this._dirty=true;}},{key:"highlightsExposure",get:function get(){return this._highlightsExposure;},set:function set(value){this._highlightsExposure=value;this._dirty=true;}},{key:"midtonesHue",get:function get(){return this._midtonesHue;},set:function set(value){this._midtonesHue=value;this._dirty=true;}},{key:"midtonesDensity",get:function get(){return this._midtonesDensity;},set:function set(value){this._midtonesDensity=value;this._dirty=true;}},{key:"midtonesSaturation",get:function get(){return this._midtonesSaturation;},set:function set(value){this._midtonesSaturation=value;this._dirty=true;}},{key:"midtonesExposure",get:function get(){return this._midtonesExposure;},set:function set(value){this._midtonesExposure=value;this._dirty=true;}},{key:"shadowsHue",get:function get(){return this._shadowsHue;},set:function set(value){this._shadowsHue=value;this._dirty=true;}},{key:"shadowsDensity",get:function get(){return this._shadowsDensity;},set:function set(value){this._shadowsDensity=value;this._dirty=true;}},{key:"shadowsSaturation",get:function get(){return this._shadowsSaturation;},set:function set(value){this._shadowsSaturation=value;this._dirty=true;}},{key:"shadowsExposure",get:function get(){return this._shadowsExposure;},set:function set(value){this._shadowsExposure=value;this._dirty=true;}},{key:"getClassName",value:function getClassName(){return"ColorCurves";}},{key:"_getColorGradingDataToRef",value:function _getColorGradingDataToRef(hue,density,saturation,exposure,result){if(hue==null){return;}hue=ColorCurves._Clamp(hue,0,360);density=ColorCurves._Clamp(density,-100,100);saturation=ColorCurves._Clamp(saturation,-100,100);exposure=ColorCurves._Clamp(exposure,-100,100);density=ColorCurves._ApplyColorGradingSliderNonlinear(density);density*=0.5;exposure=ColorCurves._ApplyColorGradingSliderNonlinear(exposure);if(density<0){density*=-1;hue=(hue+180)%360;}ColorCurves._FromHSBToRef(hue,density,50+0.25*exposure,result);result.scaleToRef(2,result);result.a=1+0.01*saturation;}},{key:"clone",value:function clone(){return SerializationHelper.Clone(function(){return new ColorCurves();},this);}},{key:"serialize",value:function serialize(){return SerializationHelper.Serialize(this);}}],[{key:"Bind",value:function Bind(colorCurves,effect){var positiveUniform=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"vCameraColorCurvePositive";var neutralUniform=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"vCameraColorCurveNeutral";var negativeUniform=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"vCameraColorCurveNegative";if(colorCurves._dirty){colorCurves._dirty=false;colorCurves._getColorGradingDataToRef(colorCurves._globalHue,colorCurves._globalDensity,colorCurves._globalSaturation,colorCurves._globalExposure,colorCurves._globalCurve);colorCurves._getColorGradingDataToRef(colorCurves._highlightsHue,colorCurves._highlightsDensity,colorCurves._highlightsSaturation,colorCurves._highlightsExposure,colorCurves._tempColor);colorCurves._tempColor.multiplyToRef(colorCurves._globalCurve,colorCurves._highlightsCurve);colorCurves._getColorGradingDataToRef(colorCurves._midtonesHue,colorCurves._midtonesDensity,colorCurves._midtonesSaturation,colorCurves._midtonesExposure,colorCurves._tempColor);colorCurves._tempColor.multiplyToRef(colorCurves._globalCurve,colorCurves._midtonesCurve);colorCurves._getColorGradingDataToRef(colorCurves._shadowsHue,colorCurves._shadowsDensity,colorCurves._shadowsSaturation,colorCurves._shadowsExposure,colorCurves._tempColor);colorCurves._tempColor.multiplyToRef(colorCurves._globalCurve,colorCurves._shadowsCurve);colorCurves._highlightsCurve.subtractToRef(colorCurves._midtonesCurve,colorCurves._positiveCurve);colorCurves._midtonesCurve.subtractToRef(colorCurves._shadowsCurve,colorCurves._negativeCurve);}if(effect){effect.setFloat4(positiveUniform,colorCurves._positiveCurve.r,colorCurves._positiveCurve.g,colorCurves._positiveCurve.b,colorCurves._positiveCurve.a);effect.setFloat4(neutralUniform,colorCurves._midtonesCurve.r,colorCurves._midtonesCurve.g,colorCurves._midtonesCurve.b,colorCurves._midtonesCurve.a);effect.setFloat4(negativeUniform,colorCurves._negativeCurve.r,colorCurves._negativeCurve.g,colorCurves._negativeCurve.b,colorCurves._negativeCurve.a);}}},{key:"PrepareUniforms",value:function PrepareUniforms(uniformsList){uniformsList.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative");}},{key:"_ApplyColorGradingSliderNonlinear",value:function _ApplyColorGradingSliderNonlinear(value){value/=100;var x=Math.abs(value);x=Math.pow(x,2);if(value<0){x*=-1;}x*=100;return x;}},{key:"_FromHSBToRef",value:function _FromHSBToRef(hue,saturation,brightness,result){var h=ColorCurves._Clamp(hue,0,360);var s=ColorCurves._Clamp(saturation/100,0,1);var v=ColorCurves._Clamp(brightness/100,0,1);if(s===0){result.r=v;result.g=v;result.b=v;}else{h/=60;var i=Math.floor(h);var f=h-i;var p=v*(1-s);var q=v*(1-s*f);var t=v*(1-s*(1-f));switch(i){case 0:result.r=v;result.g=t;result.b=p;break;case 1:result.r=q;result.g=v;result.b=p;break;case 2:result.r=p;result.g=v;result.b=t;break;case 3:result.r=p;result.g=q;result.b=v;break;case 4:result.r=t;result.g=p;result.b=v;break;default:result.r=v;result.g=p;result.b=q;break;}}result.a=1;}},{key:"_Clamp",value:function _Clamp(value,min,max){return Math.min(Math.max(value,min),max);}},{key:"Parse",value:function Parse(source){return SerializationHelper.Parse(function(){return new ColorCurves();},source,null,null);}}]);return ColorCurves;}();__decorate([serialize()],ColorCurves.prototype,"_globalHue",void 0);__decorate([serialize()],ColorCurves.prototype,"_globalDensity",void 0);__decorate([serialize()],ColorCurves.prototype,"_globalSaturation",void 0);__decorate([serialize()],ColorCurves.prototype,"_globalExposure",void 0);__decorate([serialize()],ColorCurves.prototype,"_highlightsHue",void 0);__decorate([serialize()],ColorCurves.prototype,"_highlightsDensity",void 0);__decorate([serialize()],ColorCurves.prototype,"_highlightsSaturation",void 0);__decorate([serialize()],ColorCurves.prototype,"_highlightsExposure",void 0);__decorate([serialize()],ColorCurves.prototype,"_midtonesHue",void 0);__decorate([serialize()],ColorCurves.prototype,"_midtonesDensity",void 0);__decorate([serialize()],ColorCurves.prototype,"_midtonesSaturation",void 0);__decorate([serialize()],ColorCurves.prototype,"_midtonesExposure",void 0);SerializationHelper._ColorCurvesParser=ColorCurves.Parse;// node_modules/@babylonjs/core/Materials/imageProcessingConfiguration.js
var ImageProcessingConfiguration=/*#__PURE__*/function(){function ImageProcessingConfiguration(){_classCallCheck(this,ImageProcessingConfiguration);this.colorCurves=new ColorCurves();this._colorCurvesEnabled=false;this._colorGradingEnabled=false;this._colorGradingWithGreenDepth=true;this._colorGradingBGR=true;this._exposure=1;this._toneMappingEnabled=false;this._toneMappingType=ImageProcessingConfiguration.TONEMAPPING_STANDARD;this._contrast=1;this.vignetteStretch=0;this.vignetteCenterX=0;this.vignetteCenterY=0;this.vignetteWeight=1.5;this.vignetteColor=new Color4(0,0,0,0);this.vignetteCameraFov=0.5;this._vignetteBlendMode=ImageProcessingConfiguration.VIGNETTEMODE_MULTIPLY;this._vignetteEnabled=false;this._ditheringEnabled=false;this._ditheringIntensity=1/255;this._skipFinalColorClamp=false;this._applyByPostProcess=false;this._isEnabled=true;this.onUpdateParameters=new Observable();}_createClass(ImageProcessingConfiguration,[{key:"colorCurvesEnabled",get:function get(){return this._colorCurvesEnabled;},set:function set(value){if(this._colorCurvesEnabled===value){return;}this._colorCurvesEnabled=value;this._updateParameters();}},{key:"colorGradingTexture",get:function get(){return this._colorGradingTexture;},set:function set(value){if(this._colorGradingTexture===value){return;}this._colorGradingTexture=value;this._updateParameters();}},{key:"colorGradingEnabled",get:function get(){return this._colorGradingEnabled;},set:function set(value){if(this._colorGradingEnabled===value){return;}this._colorGradingEnabled=value;this._updateParameters();}},{key:"colorGradingWithGreenDepth",get:function get(){return this._colorGradingWithGreenDepth;},set:function set(value){if(this._colorGradingWithGreenDepth===value){return;}this._colorGradingWithGreenDepth=value;this._updateParameters();}},{key:"colorGradingBGR",get:function get(){return this._colorGradingBGR;},set:function set(value){if(this._colorGradingBGR===value){return;}this._colorGradingBGR=value;this._updateParameters();}},{key:"exposure",get:function get(){return this._exposure;},set:function set(value){if(this._exposure===value){return;}this._exposure=value;this._updateParameters();}},{key:"toneMappingEnabled",get:function get(){return this._toneMappingEnabled;},set:function set(value){if(this._toneMappingEnabled===value){return;}this._toneMappingEnabled=value;this._updateParameters();}},{key:"toneMappingType",get:function get(){return this._toneMappingType;},set:function set(value){if(this._toneMappingType===value){return;}this._toneMappingType=value;this._updateParameters();}},{key:"contrast",get:function get(){return this._contrast;},set:function set(value){if(this._contrast===value){return;}this._contrast=value;this._updateParameters();}},{key:"vignetteCentreY",get:function get(){return this.vignetteCenterY;},set:function set(value){this.vignetteCenterY=value;}},{key:"vignetteCentreX",get:function get(){return this.vignetteCenterX;},set:function set(value){this.vignetteCenterX=value;}},{key:"vignetteBlendMode",get:function get(){return this._vignetteBlendMode;},set:function set(value){if(this._vignetteBlendMode===value){return;}this._vignetteBlendMode=value;this._updateParameters();}},{key:"vignetteEnabled",get:function get(){return this._vignetteEnabled;},set:function set(value){if(this._vignetteEnabled===value){return;}this._vignetteEnabled=value;this._updateParameters();}},{key:"ditheringEnabled",get:function get(){return this._ditheringEnabled;},set:function set(value){if(this._ditheringEnabled===value){return;}this._ditheringEnabled=value;this._updateParameters();}},{key:"ditheringIntensity",get:function get(){return this._ditheringIntensity;},set:function set(value){if(this._ditheringIntensity===value){return;}this._ditheringIntensity=value;this._updateParameters();}},{key:"skipFinalColorClamp",get:function get(){return this._skipFinalColorClamp;},set:function set(value){if(this._skipFinalColorClamp===value){return;}this._skipFinalColorClamp=value;this._updateParameters();}},{key:"applyByPostProcess",get:function get(){return this._applyByPostProcess;},set:function set(value){if(this._applyByPostProcess===value){return;}this._applyByPostProcess=value;this._updateParameters();}},{key:"isEnabled",get:function get(){return this._isEnabled;},set:function set(value){if(this._isEnabled===value){return;}this._isEnabled=value;this._updateParameters();}},{key:"_updateParameters",value:function _updateParameters(){this.onUpdateParameters.notifyObservers(this);}},{key:"getClassName",value:function getClassName(){return"ImageProcessingConfiguration";}},{key:"prepareDefines",value:function prepareDefines(defines){var forPostProcess=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(forPostProcess!==this.applyByPostProcess||!this._isEnabled){defines.VIGNETTE=false;defines.TONEMAPPING=false;defines.TONEMAPPING_ACES=false;defines.CONTRAST=false;defines.EXPOSURE=false;defines.COLORCURVES=false;defines.COLORGRADING=false;defines.COLORGRADING3D=false;defines.DITHER=false;defines.IMAGEPROCESSING=false;defines.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp;defines.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return;}defines.VIGNETTE=this.vignetteEnabled;defines.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY;defines.VIGNETTEBLENDMODEOPAQUE=!defines.VIGNETTEBLENDMODEMULTIPLY;defines.TONEMAPPING=this.toneMappingEnabled;switch(this._toneMappingType){case ImageProcessingConfiguration.TONEMAPPING_ACES:defines.TONEMAPPING_ACES=true;break;default:defines.TONEMAPPING_ACES=false;break;}defines.CONTRAST=this.contrast!==1;defines.EXPOSURE=this.exposure!==1;defines.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves;defines.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture;if(defines.COLORGRADING){defines.COLORGRADING3D=this.colorGradingTexture.is3D;}else{defines.COLORGRADING3D=false;}defines.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth;defines.SAMPLER3DBGRMAP=this.colorGradingBGR;defines.DITHER=this._ditheringEnabled;defines.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess;defines.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp;defines.IMAGEPROCESSING=defines.VIGNETTE||defines.TONEMAPPING||defines.CONTRAST||defines.EXPOSURE||defines.COLORCURVES||defines.COLORGRADING||defines.DITHER;}},{key:"isReady",value:function isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady();}},{key:"bind",value:function bind(effect,overrideAspectRatio){if(this._colorCurvesEnabled&&this.colorCurves){ColorCurves.Bind(this.colorCurves,effect);}if(this._vignetteEnabled||this._ditheringEnabled){var inverseWidth=1/effect.getEngine().getRenderWidth();var inverseHeight=1/effect.getEngine().getRenderHeight();effect.setFloat2("vInverseScreenSize",inverseWidth,inverseHeight);if(this._ditheringEnabled){effect.setFloat("ditherIntensity",0.5*this._ditheringIntensity);}if(this._vignetteEnabled){var aspectRatio=overrideAspectRatio!=null?overrideAspectRatio:inverseHeight/inverseWidth;var vignetteScaleY=Math.tan(this.vignetteCameraFov*0.5);var vignetteScaleX=vignetteScaleY*aspectRatio;var vignetteScaleGeometricMean=Math.sqrt(vignetteScaleX*vignetteScaleY);vignetteScaleX=Tools.Mix(vignetteScaleX,vignetteScaleGeometricMean,this.vignetteStretch);vignetteScaleY=Tools.Mix(vignetteScaleY,vignetteScaleGeometricMean,this.vignetteStretch);effect.setFloat4("vignetteSettings1",vignetteScaleX,vignetteScaleY,-vignetteScaleX*this.vignetteCenterX,-vignetteScaleY*this.vignetteCenterY);var vignettePower=-2*this.vignetteWeight;effect.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,vignettePower);}}effect.setFloat("exposureLinear",this.exposure);effect.setFloat("contrast",this.contrast);if(this.colorGradingTexture){effect.setTexture("txColorTransform",this.colorGradingTexture);var textureSize=this.colorGradingTexture.getSize().height;effect.setFloat4("colorTransformSettings",(textureSize-1)/textureSize,0.5/textureSize,textureSize,this.colorGradingTexture.level);}}},{key:"clone",value:function clone(){return SerializationHelper.Clone(function(){return new ImageProcessingConfiguration();},this);}},{key:"serialize",value:function serialize(){return SerializationHelper.Serialize(this);}}],[{key:"PrepareUniforms",value:function PrepareUniforms(uniforms,defines){if(defines.EXPOSURE){uniforms.push("exposureLinear");}if(defines.CONTRAST){uniforms.push("contrast");}if(defines.COLORGRADING){uniforms.push("colorTransformSettings");}if(defines.VIGNETTE||defines.DITHER){uniforms.push("vInverseScreenSize");}if(defines.VIGNETTE){uniforms.push("vignetteSettings1");uniforms.push("vignetteSettings2");}if(defines.COLORCURVES){ColorCurves.PrepareUniforms(uniforms);}if(defines.DITHER){uniforms.push("ditherIntensity");}}},{key:"PrepareSamplers",value:function PrepareSamplers(samplersList,defines){if(defines.COLORGRADING){samplersList.push("txColorTransform");}}},{key:"Parse",value:function Parse(source){var parsed=SerializationHelper.Parse(function(){return new ImageProcessingConfiguration();},source,null,null);if(source.vignetteCentreX!==void 0){parsed.vignetteCenterX=source.vignetteCentreX;}if(source.vignetteCentreY!==void 0){parsed.vignetteCenterY=source.vignetteCentreY;}return parsed;}},{key:"VIGNETTEMODE_MULTIPLY",get:function get(){return this._VIGNETTEMODE_MULTIPLY;}},{key:"VIGNETTEMODE_OPAQUE",get:function get(){return this._VIGNETTEMODE_OPAQUE;}}]);return ImageProcessingConfiguration;}();ImageProcessingConfiguration.TONEMAPPING_STANDARD=0;ImageProcessingConfiguration.TONEMAPPING_ACES=1;ImageProcessingConfiguration._VIGNETTEMODE_MULTIPLY=0;ImageProcessingConfiguration._VIGNETTEMODE_OPAQUE=1;__decorate([serializeAsColorCurves()],ImageProcessingConfiguration.prototype,"colorCurves",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorCurvesEnabled",void 0);__decorate([serializeAsTexture("colorGradingTexture")],ImageProcessingConfiguration.prototype,"_colorGradingTexture",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorGradingEnabled",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorGradingWithGreenDepth",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_colorGradingBGR",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_exposure",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_toneMappingEnabled",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_toneMappingType",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_contrast",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteStretch",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteCenterX",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteCenterY",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteWeight",void 0);__decorate([serializeAsColor4()],ImageProcessingConfiguration.prototype,"vignetteColor",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"vignetteCameraFov",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_vignetteBlendMode",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_vignetteEnabled",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_ditheringEnabled",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_ditheringIntensity",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_skipFinalColorClamp",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_applyByPostProcess",void 0);__decorate([serialize()],ImageProcessingConfiguration.prototype,"_isEnabled",void 0);SerializationHelper._ImageProcessingConfigurationParser=ImageProcessingConfiguration.Parse;// node_modules/@babylonjs/core/Engines/Extensions/engine.uniformBuffer.js
ThinEngine.prototype.createUniformBuffer=function(elements){var ubo=this._gl.createBuffer();if(!ubo){throw new Error("Unable to create uniform buffer");}var result=new WebGLDataBuffer(ubo);this.bindUniformBuffer(result);if(elements instanceof Float32Array){this._gl.bufferData(this._gl.UNIFORM_BUFFER,elements,this._gl.STATIC_DRAW);}else{this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(elements),this._gl.STATIC_DRAW);}this.bindUniformBuffer(null);result.references=1;return result;};ThinEngine.prototype.createDynamicUniformBuffer=function(elements){var ubo=this._gl.createBuffer();if(!ubo){throw new Error("Unable to create dynamic uniform buffer");}var result=new WebGLDataBuffer(ubo);this.bindUniformBuffer(result);if(elements instanceof Float32Array){this._gl.bufferData(this._gl.UNIFORM_BUFFER,elements,this._gl.DYNAMIC_DRAW);}else{this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(elements),this._gl.DYNAMIC_DRAW);}this.bindUniformBuffer(null);result.references=1;return result;};ThinEngine.prototype.updateUniformBuffer=function(uniformBuffer,elements,offset,count){this.bindUniformBuffer(uniformBuffer);if(offset===void 0){offset=0;}if(count===void 0){if(elements instanceof Float32Array){this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,offset,elements);}else{this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,offset,new Float32Array(elements));}}else{if(elements instanceof Float32Array){this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,elements.subarray(offset,offset+count));}else{this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(elements).subarray(offset,offset+count));}}this.bindUniformBuffer(null);};ThinEngine.prototype.bindUniformBuffer=function(buffer){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,buffer?buffer.underlyingResource:null);};ThinEngine.prototype.bindUniformBufferBase=function(buffer,location2,name135){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,location2,buffer?buffer.underlyingResource:null);};ThinEngine.prototype.bindUniformBlock=function(pipelineContext,blockName,index){var program=pipelineContext.program;var uniformLocation=this._gl.getUniformBlockIndex(program,blockName);if(uniformLocation!==4294967295){this._gl.uniformBlockBinding(program,uniformLocation,index);}};// node_modules/@babylonjs/core/Materials/uniformBuffer.js
var UniformBuffer=/*#__PURE__*/function(){function UniformBuffer(engine,data,dynamic,name135){var forceNoUniformBuffer=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;_classCallCheck(this,UniformBuffer);this._valueCache={};this._engine=engine;this._noUBO=!engine.supportsUniformBuffers||forceNoUniformBuffer;this._dynamic=dynamic;this._name=name135!==null&&name135!==void 0?name135:"no-name";this._data=data||[];this._uniformLocations={};this._uniformSizes={};this._uniformArraySizes={};this._uniformLocationPointer=0;this._needSync=false;if(this._engine._features.trackUbosInFrame){this._buffers=[];this._bufferIndex=-1;this._createBufferOnWrite=false;this._currentFrameId=0;}if(this._noUBO){this.updateMatrix3x3=this._updateMatrix3x3ForEffect;this.updateMatrix2x2=this._updateMatrix2x2ForEffect;this.updateFloat=this._updateFloatForEffect;this.updateFloat2=this._updateFloat2ForEffect;this.updateFloat3=this._updateFloat3ForEffect;this.updateFloat4=this._updateFloat4ForEffect;this.updateFloatArray=this._updateFloatArrayForEffect;this.updateArray=this._updateArrayForEffect;this.updateIntArray=this._updateIntArrayForEffect;this.updateUIntArray=this._updateUIntArrayForEffect;this.updateMatrix=this._updateMatrixForEffect;this.updateMatrices=this._updateMatricesForEffect;this.updateVector3=this._updateVector3ForEffect;this.updateVector4=this._updateVector4ForEffect;this.updateColor3=this._updateColor3ForEffect;this.updateColor4=this._updateColor4ForEffect;this.updateDirectColor4=this._updateDirectColor4ForEffect;this.updateInt=this._updateIntForEffect;this.updateInt2=this._updateInt2ForEffect;this.updateInt3=this._updateInt3ForEffect;this.updateInt4=this._updateInt4ForEffect;this.updateUInt=this._updateUIntForEffect;this.updateUInt2=this._updateUInt2ForEffect;this.updateUInt3=this._updateUInt3ForEffect;this.updateUInt4=this._updateUInt4ForEffect;}else{this._engine._uniformBuffers.push(this);this.updateMatrix3x3=this._updateMatrix3x3ForUniform;this.updateMatrix2x2=this._updateMatrix2x2ForUniform;this.updateFloat=this._updateFloatForUniform;this.updateFloat2=this._updateFloat2ForUniform;this.updateFloat3=this._updateFloat3ForUniform;this.updateFloat4=this._updateFloat4ForUniform;this.updateFloatArray=this._updateFloatArrayForUniform;this.updateArray=this._updateArrayForUniform;this.updateIntArray=this._updateIntArrayForUniform;this.updateUIntArray=this._updateUIntArrayForUniform;this.updateMatrix=this._updateMatrixForUniform;this.updateMatrices=this._updateMatricesForUniform;this.updateVector3=this._updateVector3ForUniform;this.updateVector4=this._updateVector4ForUniform;this.updateColor3=this._updateColor3ForUniform;this.updateColor4=this._updateColor4ForUniform;this.updateDirectColor4=this._updateDirectColor4ForUniform;this.updateInt=this._updateIntForUniform;this.updateInt2=this._updateInt2ForUniform;this.updateInt3=this._updateInt3ForUniform;this.updateInt4=this._updateInt4ForUniform;this.updateUInt=this._updateUIntForUniform;this.updateUInt2=this._updateUInt2ForUniform;this.updateUInt3=this._updateUInt3ForUniform;this.updateUInt4=this._updateUInt4ForUniform;}}_createClass(UniformBuffer,[{key:"useUbo",get:function get(){return!this._noUBO;}},{key:"isSync",get:function get(){return!this._needSync;}},{key:"isDynamic",value:function isDynamic(){return this._dynamic!==void 0;}},{key:"getData",value:function getData(){return this._bufferData;}},{key:"getBuffer",value:function getBuffer(){return this._buffer;}},{key:"_fillAlignment",value:function _fillAlignment(size){var alignment;if(size<=2){alignment=size;}else{alignment=4;}if(this._uniformLocationPointer%alignment!==0){var oldPointer=this._uniformLocationPointer;this._uniformLocationPointer+=alignment-this._uniformLocationPointer%alignment;var diff=this._uniformLocationPointer-oldPointer;for(var i=0;i<diff;i++){this._data.push(0);}}}},{key:"addUniform",value:function addUniform(name135,size){var arraySize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(this._noUBO){return;}if(this._uniformLocations[name135]!==void 0){return;}var data;if(arraySize>0){if(size instanceof Array){throw"addUniform should not be use with Array in UBO: "+name135;}this._fillAlignment(4);this._uniformArraySizes[name135]={strideSize:size,arraySize:arraySize};if(size==16){size=size*arraySize;}else{var perElementPadding=4-size;var totalPadding=perElementPadding*arraySize;size=size*arraySize+totalPadding;}data=[];for(var i=0;i<size;i++){data.push(0);}}else{if(size instanceof Array){data=size;size=data.length;}else{size=size;data=[];for(var _i6=0;_i6<size;_i6++){data.push(0);}}this._fillAlignment(size);}this._uniformSizes[name135]=size;this._uniformLocations[name135]=this._uniformLocationPointer;this._uniformLocationPointer+=size;for(var _i7=0;_i7<size;_i7++){this._data.push(data[_i7]);}this._needSync=true;}},{key:"addMatrix",value:function addMatrix(name135,mat){this.addUniform(name135,Array.prototype.slice.call(mat.toArray()));}},{key:"addFloat2",value:function addFloat2(name135,x,y){var temp=[x,y];this.addUniform(name135,temp);}},{key:"addFloat3",value:function addFloat3(name135,x,y,z){var temp=[x,y,z];this.addUniform(name135,temp);}},{key:"addColor3",value:function addColor3(name135,color){var temp=[color.r,color.g,color.b];this.addUniform(name135,temp);}},{key:"addColor4",value:function addColor4(name135,color,alpha){var temp=[color.r,color.g,color.b,alpha];this.addUniform(name135,temp);}},{key:"addVector3",value:function addVector3(name135,vector){var temp=[vector.x,vector.y,vector.z];this.addUniform(name135,temp);}},{key:"addMatrix3x3",value:function addMatrix3x3(name135){this.addUniform(name135,12);}},{key:"addMatrix2x2",value:function addMatrix2x2(name135){this.addUniform(name135,8);}},{key:"create",value:function create(){if(this._noUBO){return;}if(this._buffer){return;}this._fillAlignment(4);this._bufferData=new Float32Array(this._data);this._rebuild();this._needSync=true;}},{key:"_rebuild",value:function _rebuild(){if(this._noUBO||!this._bufferData){return;}if(this._dynamic){this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData);}else{this._buffer=this._engine.createUniformBuffer(this._bufferData);}if(this._engine._features.trackUbosInFrame){this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]);this._bufferIndex=this._buffers.length-1;this._createBufferOnWrite=false;}}},{key:"_numBuffers",get:function get(){return this._buffers.length;}},{key:"_indexBuffer",get:function get(){return this._bufferIndex;}},{key:"name",get:function get(){return this._name;}},{key:"_buffersEqual",value:function _buffersEqual(buf1,buf2){for(var i=0;i<buf1.length;++i){if(buf1[i]!==buf2[i]){return false;}}return true;}},{key:"_copyBuffer",value:function _copyBuffer(src,dst){for(var i=0;i<src.length;++i){dst[i]=src[i];}}},{key:"update",value:function update(){if(this._noUBO){return;}this.bindUniformBuffer();if(!this._buffer){this.create();return;}if(!this._dynamic&&!this._needSync){this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return;}if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1])){this._needSync=false;this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return;}else{this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1]);}}this._engine.updateUniformBuffer(this._buffer,this._bufferData);if(this._engine._features._collectUbosUpdatedInFrame){if(!UniformBuffer._UpdatedUbosInFrame[this._name]){UniformBuffer._UpdatedUbosInFrame[this._name]=0;}UniformBuffer._UpdatedUbosInFrame[this._name]++;}this._needSync=false;this._createBufferOnWrite=this._engine._features.trackUbosInFrame;}},{key:"_createNewBuffer",value:function _createNewBuffer(){if(this._bufferIndex+1<this._buffers.length){this._bufferIndex++;this._buffer=this._buffers[this._bufferIndex][0];this._createBufferOnWrite=false;this._needSync=true;}else{this._rebuild();}}},{key:"_checkNewFrame",value:function _checkNewFrame(){if(this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId){this._currentFrameId=this._engine.frameId;this._createBufferOnWrite=false;if(this._buffers&&this._buffers.length>0){this._needSync=this._bufferIndex!==0;this._bufferIndex=0;this._buffer=this._buffers[this._bufferIndex][0];}else{this._bufferIndex=-1;}}}},{key:"updateUniform",value:function updateUniform(uniformName,data,size){this._checkNewFrame();var location2=this._uniformLocations[uniformName];if(location2===void 0){if(this._buffer){Logger.Error("Cannot add an uniform after UBO has been created.");return;}this.addUniform(uniformName,size);location2=this._uniformLocations[uniformName];}if(!this._buffer){this.create();}if(!this._dynamic){var changed=false;for(var i=0;i<size;i++){if(size===16&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[location2+i]!==Tools.FloatRound(data[i])){changed=true;if(this._createBufferOnWrite){this._createNewBuffer();}this._bufferData[location2+i]=data[i];}}this._needSync=this._needSync||changed;}else{for(var _i8=0;_i8<size;_i8++){this._bufferData[location2+_i8]=data[_i8];}}}},{key:"updateUniformArray",value:function updateUniformArray(uniformName,data,size){this._checkNewFrame();var location2=this._uniformLocations[uniformName];if(location2===void 0){Logger.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");return;}if(!this._buffer){this.create();}var arraySizes=this._uniformArraySizes[uniformName];if(!this._dynamic){var changed=false;var countToFour=0;var baseStride=0;for(var i=0;i<size;i++){if(this._bufferData[location2+baseStride*4+countToFour]!==Tools.FloatRound(data[i])){changed=true;if(this._createBufferOnWrite){this._createNewBuffer();}this._bufferData[location2+baseStride*4+countToFour]=data[i];}countToFour++;if(countToFour===arraySizes.strideSize){for(;countToFour<4;countToFour++){this._bufferData[location2+baseStride*4+countToFour]=0;}countToFour=0;baseStride++;}}this._needSync=this._needSync||changed;}else{for(var _i9=0;_i9<size;_i9++){this._bufferData[location2+_i9]=data[_i9];}}}},{key:"_cacheMatrix",value:function _cacheMatrix(name135,matrix){this._checkNewFrame();var cache=this._valueCache[name135];var flag=matrix.updateFlag;if(cache!==void 0&&cache===flag){return false;}this._valueCache[name135]=flag;return true;}},{key:"_updateMatrix3x3ForUniform",value:function _updateMatrix3x3ForUniform(name135,matrix){for(var i=0;i<3;i++){UniformBuffer._TempBuffer[i*4]=matrix[i*3];UniformBuffer._TempBuffer[i*4+1]=matrix[i*3+1];UniformBuffer._TempBuffer[i*4+2]=matrix[i*3+2];UniformBuffer._TempBuffer[i*4+3]=0;}this.updateUniform(name135,UniformBuffer._TempBuffer,12);}},{key:"_updateMatrix3x3ForEffect",value:function _updateMatrix3x3ForEffect(name135,matrix){this._currentEffect.setMatrix3x3(name135,matrix);}},{key:"_updateMatrix2x2ForEffect",value:function _updateMatrix2x2ForEffect(name135,matrix){this._currentEffect.setMatrix2x2(name135,matrix);}},{key:"_updateMatrix2x2ForUniform",value:function _updateMatrix2x2ForUniform(name135,matrix){for(var i=0;i<2;i++){UniformBuffer._TempBuffer[i*4]=matrix[i*2];UniformBuffer._TempBuffer[i*4+1]=matrix[i*2+1];UniformBuffer._TempBuffer[i*4+2]=0;UniformBuffer._TempBuffer[i*4+3]=0;}this.updateUniform(name135,UniformBuffer._TempBuffer,8);}},{key:"_updateFloatForEffect",value:function _updateFloatForEffect(name135,x){this._currentEffect.setFloat(name135,x);}},{key:"_updateFloatForUniform",value:function _updateFloatForUniform(name135,x){UniformBuffer._TempBuffer[0]=x;this.updateUniform(name135,UniformBuffer._TempBuffer,1);}},{key:"_updateFloat2ForEffect",value:function _updateFloat2ForEffect(name135,x,y){var suffix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";this._currentEffect.setFloat2(name135+suffix,x,y);}},{key:"_updateFloat2ForUniform",value:function _updateFloat2ForUniform(name135,x,y){UniformBuffer._TempBuffer[0]=x;UniformBuffer._TempBuffer[1]=y;this.updateUniform(name135,UniformBuffer._TempBuffer,2);}},{key:"_updateFloat3ForEffect",value:function _updateFloat3ForEffect(name135,x,y,z){var suffix=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";this._currentEffect.setFloat3(name135+suffix,x,y,z);}},{key:"_updateFloat3ForUniform",value:function _updateFloat3ForUniform(name135,x,y,z){UniformBuffer._TempBuffer[0]=x;UniformBuffer._TempBuffer[1]=y;UniformBuffer._TempBuffer[2]=z;this.updateUniform(name135,UniformBuffer._TempBuffer,3);}},{key:"_updateFloat4ForEffect",value:function _updateFloat4ForEffect(name135,x,y,z,w){var suffix=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";this._currentEffect.setFloat4(name135+suffix,x,y,z,w);}},{key:"_updateFloat4ForUniform",value:function _updateFloat4ForUniform(name135,x,y,z,w){UniformBuffer._TempBuffer[0]=x;UniformBuffer._TempBuffer[1]=y;UniformBuffer._TempBuffer[2]=z;UniformBuffer._TempBuffer[3]=w;this.updateUniform(name135,UniformBuffer._TempBuffer,4);}},{key:"_updateFloatArrayForEffect",value:function _updateFloatArrayForEffect(name135,array){this._currentEffect.setFloatArray(name135,array);}},{key:"_updateFloatArrayForUniform",value:function _updateFloatArrayForUniform(name135,array){this.updateUniformArray(name135,array,array.length);}},{key:"_updateArrayForEffect",value:function _updateArrayForEffect(name135,array){this._currentEffect.setArray(name135,array);}},{key:"_updateArrayForUniform",value:function _updateArrayForUniform(name135,array){this.updateUniformArray(name135,array,array.length);}},{key:"_updateIntArrayForEffect",value:function _updateIntArrayForEffect(name135,array){this._currentEffect.setIntArray(name135,array);}},{key:"_updateIntArrayForUniform",value:function _updateIntArrayForUniform(name135,array){UniformBuffer._TempBufferInt32View.set(array);this.updateUniformArray(name135,UniformBuffer._TempBuffer,array.length);}},{key:"_updateUIntArrayForEffect",value:function _updateUIntArrayForEffect(name135,array){this._currentEffect.setUIntArray(name135,array);}},{key:"_updateUIntArrayForUniform",value:function _updateUIntArrayForUniform(name135,array){UniformBuffer._TempBufferUInt32View.set(array);this.updateUniformArray(name135,UniformBuffer._TempBuffer,array.length);}},{key:"_updateMatrixForEffect",value:function _updateMatrixForEffect(name135,mat){this._currentEffect.setMatrix(name135,mat);}},{key:"_updateMatrixForUniform",value:function _updateMatrixForUniform(name135,mat){if(this._cacheMatrix(name135,mat)){this.updateUniform(name135,mat.toArray(),16);}}},{key:"_updateMatricesForEffect",value:function _updateMatricesForEffect(name135,mat){this._currentEffect.setMatrices(name135,mat);}},{key:"_updateMatricesForUniform",value:function _updateMatricesForUniform(name135,mat){this.updateUniform(name135,mat,mat.length);}},{key:"_updateVector3ForEffect",value:function _updateVector3ForEffect(name135,vector){this._currentEffect.setVector3(name135,vector);}},{key:"_updateVector3ForUniform",value:function _updateVector3ForUniform(name135,vector){UniformBuffer._TempBuffer[0]=vector.x;UniformBuffer._TempBuffer[1]=vector.y;UniformBuffer._TempBuffer[2]=vector.z;this.updateUniform(name135,UniformBuffer._TempBuffer,3);}},{key:"_updateVector4ForEffect",value:function _updateVector4ForEffect(name135,vector){this._currentEffect.setVector4(name135,vector);}},{key:"_updateVector4ForUniform",value:function _updateVector4ForUniform(name135,vector){UniformBuffer._TempBuffer[0]=vector.x;UniformBuffer._TempBuffer[1]=vector.y;UniformBuffer._TempBuffer[2]=vector.z;UniformBuffer._TempBuffer[3]=vector.w;this.updateUniform(name135,UniformBuffer._TempBuffer,4);}},{key:"_updateColor3ForEffect",value:function _updateColor3ForEffect(name135,color){var suffix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";this._currentEffect.setColor3(name135+suffix,color);}},{key:"_updateColor3ForUniform",value:function _updateColor3ForUniform(name135,color){UniformBuffer._TempBuffer[0]=color.r;UniformBuffer._TempBuffer[1]=color.g;UniformBuffer._TempBuffer[2]=color.b;this.updateUniform(name135,UniformBuffer._TempBuffer,3);}},{key:"_updateColor4ForEffect",value:function _updateColor4ForEffect(name135,color,alpha){var suffix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";this._currentEffect.setColor4(name135+suffix,color,alpha);}},{key:"_updateDirectColor4ForEffect",value:function _updateDirectColor4ForEffect(name135,color){var suffix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";this._currentEffect.setDirectColor4(name135+suffix,color);}},{key:"_updateColor4ForUniform",value:function _updateColor4ForUniform(name135,color,alpha){UniformBuffer._TempBuffer[0]=color.r;UniformBuffer._TempBuffer[1]=color.g;UniformBuffer._TempBuffer[2]=color.b;UniformBuffer._TempBuffer[3]=alpha;this.updateUniform(name135,UniformBuffer._TempBuffer,4);}},{key:"_updateDirectColor4ForUniform",value:function _updateDirectColor4ForUniform(name135,color){UniformBuffer._TempBuffer[0]=color.r;UniformBuffer._TempBuffer[1]=color.g;UniformBuffer._TempBuffer[2]=color.b;UniformBuffer._TempBuffer[3]=color.a;this.updateUniform(name135,UniformBuffer._TempBuffer,4);}},{key:"_updateIntForEffect",value:function _updateIntForEffect(name135,x){var suffix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";this._currentEffect.setInt(name135+suffix,x);}},{key:"_updateIntForUniform",value:function _updateIntForUniform(name135,x){UniformBuffer._TempBufferInt32View[0]=x;this.updateUniform(name135,UniformBuffer._TempBuffer,1);}},{key:"_updateInt2ForEffect",value:function _updateInt2ForEffect(name135,x,y){var suffix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";this._currentEffect.setInt2(name135+suffix,x,y);}},{key:"_updateInt2ForUniform",value:function _updateInt2ForUniform(name135,x,y){UniformBuffer._TempBufferInt32View[0]=x;UniformBuffer._TempBufferInt32View[1]=y;this.updateUniform(name135,UniformBuffer._TempBuffer,2);}},{key:"_updateInt3ForEffect",value:function _updateInt3ForEffect(name135,x,y,z){var suffix=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";this._currentEffect.setInt3(name135+suffix,x,y,z);}},{key:"_updateInt3ForUniform",value:function _updateInt3ForUniform(name135,x,y,z){UniformBuffer._TempBufferInt32View[0]=x;UniformBuffer._TempBufferInt32View[1]=y;UniformBuffer._TempBufferInt32View[2]=z;this.updateUniform(name135,UniformBuffer._TempBuffer,3);}},{key:"_updateInt4ForEffect",value:function _updateInt4ForEffect(name135,x,y,z,w){var suffix=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";this._currentEffect.setInt4(name135+suffix,x,y,z,w);}},{key:"_updateInt4ForUniform",value:function _updateInt4ForUniform(name135,x,y,z,w){UniformBuffer._TempBufferInt32View[0]=x;UniformBuffer._TempBufferInt32View[1]=y;UniformBuffer._TempBufferInt32View[2]=z;UniformBuffer._TempBufferInt32View[3]=w;this.updateUniform(name135,UniformBuffer._TempBuffer,4);}},{key:"_updateUIntForEffect",value:function _updateUIntForEffect(name135,x){var suffix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";this._currentEffect.setUInt(name135+suffix,x);}},{key:"_updateUIntForUniform",value:function _updateUIntForUniform(name135,x){UniformBuffer._TempBufferUInt32View[0]=x;this.updateUniform(name135,UniformBuffer._TempBuffer,1);}},{key:"_updateUInt2ForEffect",value:function _updateUInt2ForEffect(name135,x,y){var suffix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";this._currentEffect.setUInt2(name135+suffix,x,y);}},{key:"_updateUInt2ForUniform",value:function _updateUInt2ForUniform(name135,x,y){UniformBuffer._TempBufferUInt32View[0]=x;UniformBuffer._TempBufferUInt32View[1]=y;this.updateUniform(name135,UniformBuffer._TempBuffer,2);}},{key:"_updateUInt3ForEffect",value:function _updateUInt3ForEffect(name135,x,y,z){var suffix=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";this._currentEffect.setUInt3(name135+suffix,x,y,z);}},{key:"_updateUInt3ForUniform",value:function _updateUInt3ForUniform(name135,x,y,z){UniformBuffer._TempBufferUInt32View[0]=x;UniformBuffer._TempBufferUInt32View[1]=y;UniformBuffer._TempBufferUInt32View[2]=z;this.updateUniform(name135,UniformBuffer._TempBuffer,3);}},{key:"_updateUInt4ForEffect",value:function _updateUInt4ForEffect(name135,x,y,z,w){var suffix=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";this._currentEffect.setUInt4(name135+suffix,x,y,z,w);}},{key:"_updateUInt4ForUniform",value:function _updateUInt4ForUniform(name135,x,y,z,w){UniformBuffer._TempBufferUInt32View[0]=x;UniformBuffer._TempBufferUInt32View[1]=y;UniformBuffer._TempBufferUInt32View[2]=z;UniformBuffer._TempBufferUInt32View[3]=w;this.updateUniform(name135,UniformBuffer._TempBuffer,4);}},{key:"setTexture",value:function setTexture(name135,texture){this._currentEffect.setTexture(name135,texture);}},{key:"updateUniformDirectly",value:function updateUniformDirectly(uniformName,data){this.updateUniform(uniformName,data,data.length);this.update();}},{key:"bindToEffect",value:function bindToEffect(effect,name135){this._currentEffect=effect;this._currentEffectName=name135;}},{key:"bindUniformBuffer",value:function bindUniformBuffer(){if(!this._noUBO&&this._buffer&&this._currentEffect){this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName);}}},{key:"unbindEffect",value:function unbindEffect(){this._currentEffect=void 0;this._currentEffectName=void 0;}},{key:"setDataBuffer",value:function setDataBuffer(dataBuffer){if(!this._buffers){return this._buffer===dataBuffer;}for(var b=0;b<this._buffers.length;++b){var buffer=this._buffers[b];if(buffer[0]===dataBuffer){this._bufferIndex=b;this._buffer=dataBuffer;this._createBufferOnWrite=false;this._currentEffect=void 0;return true;}}return false;}},{key:"dispose",value:function dispose(){if(this._noUBO){return;}var uniformBuffers=this._engine._uniformBuffers;var index=uniformBuffers.indexOf(this);if(index!==-1){uniformBuffers[index]=uniformBuffers[uniformBuffers.length-1];uniformBuffers.pop();}if(this._engine._features.trackUbosInFrame&&this._buffers){for(var i=0;i<this._buffers.length;++i){var buffer=this._buffers[i][0];this._engine._releaseBuffer(buffer);}}else if(this._buffer&&this._engine._releaseBuffer(this._buffer)){this._buffer=null;}}}]);return UniformBuffer;}();UniformBuffer._UpdatedUbosInFrame={};UniformBuffer._MAX_UNIFORM_SIZE=256;UniformBuffer._TempBuffer=new Float32Array(UniformBuffer._MAX_UNIFORM_SIZE);UniformBuffer._TempBufferInt32View=new Int32Array(UniformBuffer._TempBuffer.buffer);UniformBuffer._TempBufferUInt32View=new Uint32Array(UniformBuffer._TempBuffer.buffer);// node_modules/@babylonjs/core/Buffers/buffer.js
var Buffer2=/*#__PURE__*/function(){function Buffer2(engine,data,updatable){var stride=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var postponeInternalCreation=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var instanced=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var useBytes=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var divisor=arguments.length>7?arguments[7]:undefined;_classCallCheck(this,Buffer2);this._isAlreadyOwned=false;if(engine.getScene){this._engine=engine.getScene().getEngine();}else{this._engine=engine;}this._updatable=updatable;this._instanced=instanced;this._divisor=divisor||1;if(data instanceof DataBuffer){this._data=null;this._buffer=data;}else{this._data=data;this._buffer=null;}this.byteStride=useBytes?stride:stride*Float32Array.BYTES_PER_ELEMENT;if(!postponeInternalCreation){this.create();}}_createClass(Buffer2,[{key:"createVertexBuffer",value:function createVertexBuffer(kind,offset,size,stride,instanced){var useBytes=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var divisor=arguments.length>6?arguments[6]:undefined;var byteOffset=useBytes?offset:offset*Float32Array.BYTES_PER_ELEMENT;var byteStride=stride?useBytes?stride:stride*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new VertexBuffer(this._engine,this,kind,this._updatable,true,byteStride,instanced===void 0?this._instanced:instanced,byteOffset,size,void 0,void 0,true,this._divisor||divisor);}},{key:"isUpdatable",value:function isUpdatable(){return this._updatable;}},{key:"getData",value:function getData(){return this._data;}},{key:"getBuffer",value:function getBuffer(){return this._buffer;}},{key:"getStrideSize",value:function getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT;}},{key:"create",value:function create(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!data&&this._buffer){return;}data=data||this._data;if(!data){return;}if(!this._buffer){if(this._updatable){this._buffer=this._engine.createDynamicVertexBuffer(data);this._data=data;}else{this._buffer=this._engine.createVertexBuffer(data);}}else if(this._updatable){this._engine.updateDynamicVertexBuffer(this._buffer,data);this._data=data;}}},{key:"_rebuild",value:function _rebuild(){this._buffer=null;this.create(this._data);}},{key:"update",value:function update(data){this.create(data);}},{key:"updateDirectly",value:function updateDirectly(data,offset,vertexCount){var useBytes=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!this._buffer){return;}if(this._updatable){this._engine.updateDynamicVertexBuffer(this._buffer,data,useBytes?offset:offset*Float32Array.BYTES_PER_ELEMENT,vertexCount?vertexCount*this.byteStride:void 0);if(offset===0&&vertexCount===void 0){this._data=data;}else{this._data=null;}}}},{key:"_increaseReferences",value:function _increaseReferences(){if(!this._buffer){return;}if(!this._isAlreadyOwned){this._isAlreadyOwned=true;return;}this._buffer.references++;}},{key:"dispose",value:function dispose(){if(!this._buffer){return;}if(this._engine._releaseBuffer(this._buffer)){this._buffer=null;this._data=null;}}}]);return Buffer2;}();var VertexBuffer=/*#__PURE__*/function(){function VertexBuffer(engine,data,kind,updatable,postponeInternalCreation,stride,instanced,offset,size,type){var normalized=arguments.length>10&&arguments[10]!==undefined?arguments[10]:false;var useBytes=arguments.length>11&&arguments[11]!==undefined?arguments[11]:false;var divisor=arguments.length>12&&arguments[12]!==undefined?arguments[12]:1;var takeBufferOwnership=arguments.length>13&&arguments[13]!==undefined?arguments[13]:false;_classCallCheck(this,VertexBuffer);if(data instanceof Buffer2){this._buffer=data;this._ownsBuffer=takeBufferOwnership;}else{this._buffer=new Buffer2(engine,data,updatable,stride,postponeInternalCreation,instanced,useBytes);this._ownsBuffer=true;}this.uniqueId=VertexBuffer._Counter++;this._kind=kind;if(type==void 0){var vertexData=this.getData();this.type=VertexBuffer.FLOAT;if(vertexData instanceof Int8Array){this.type=VertexBuffer.BYTE;}else if(vertexData instanceof Uint8Array){this.type=VertexBuffer.UNSIGNED_BYTE;}else if(vertexData instanceof Int16Array){this.type=VertexBuffer.SHORT;}else if(vertexData instanceof Uint16Array){this.type=VertexBuffer.UNSIGNED_SHORT;}else if(vertexData instanceof Int32Array){this.type=VertexBuffer.INT;}else if(vertexData instanceof Uint32Array){this.type=VertexBuffer.UNSIGNED_INT;}}else{this.type=type;}var typeByteLength=VertexBuffer.GetTypeByteLength(this.type);if(useBytes){this._size=size||(stride?stride/typeByteLength:VertexBuffer.DeduceStride(kind));this.byteStride=stride||this._buffer.byteStride||this._size*typeByteLength;this.byteOffset=offset||0;}else{this._size=size||stride||VertexBuffer.DeduceStride(kind);this.byteStride=stride?stride*typeByteLength:this._buffer.byteStride||this._size*typeByteLength;this.byteOffset=(offset||0)*typeByteLength;}this.normalized=normalized;this._instanced=instanced!==void 0?instanced:false;this._instanceDivisor=instanced?divisor:0;this._computeHashCode();}_createClass(VertexBuffer,[{key:"instanceDivisor",get:function get(){return this._instanceDivisor;},set:function set(value){var isInstanced=value!=0;this._instanceDivisor=value;if(isInstanced!==this._instanced){this._instanced=isInstanced;this._computeHashCode();}}},{key:"_computeHashCode",value:function _computeHashCode(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12);}},{key:"_rebuild",value:function _rebuild(){if(!this._buffer){return;}this._buffer._rebuild();}},{key:"getKind",value:function getKind(){return this._kind;}},{key:"isUpdatable",value:function isUpdatable(){return this._buffer.isUpdatable();}},{key:"getData",value:function getData(){return this._buffer.getData();}},{key:"getFloatData",value:function getFloatData(totalVertices,forceCopy){var data=this.getData();if(!data){return null;}var tightlyPackedByteStride=this.getSize()*VertexBuffer.GetTypeByteLength(this.type);var count=totalVertices*this.getSize();if(this.type!==VertexBuffer.FLOAT||this.byteStride!==tightlyPackedByteStride){var copy=new Float32Array(count);this.forEach(count,function(value,index){return copy[index]=value;});return copy;}if(!(data instanceof Array||data instanceof Float32Array)||this.byteOffset!==0||data.length!==count){if(data instanceof Array){var offset=this.byteOffset/4;return data.slice(offset,offset+count);}else if(data instanceof ArrayBuffer){return new Float32Array(data,this.byteOffset,count);}else{var _offset=data.byteOffset+this.byteOffset;if(forceCopy){var result=new Float32Array(count);var source=new Float32Array(data.buffer,_offset,count);result.set(source);return result;}var remainder=_offset%4;if(remainder){_offset=Math.max(0,_offset-remainder);}return new Float32Array(data.buffer,_offset,count);}}if(forceCopy){return data.slice();}return data;}},{key:"getBuffer",value:function getBuffer(){return this._buffer.getBuffer();}},{key:"getStrideSize",value:function getStrideSize(){return this.byteStride/VertexBuffer.GetTypeByteLength(this.type);}},{key:"getOffset",value:function getOffset(){return this.byteOffset/VertexBuffer.GetTypeByteLength(this.type);}},{key:"getSize",value:function getSize(){var sizeInBytes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return sizeInBytes?this._size*VertexBuffer.GetTypeByteLength(this.type):this._size;}},{key:"getIsInstanced",value:function getIsInstanced(){return this._instanced;}},{key:"getInstanceDivisor",value:function getInstanceDivisor(){return this._instanceDivisor;}},{key:"create",value:function create(data){this._buffer.create(data);}},{key:"update",value:function update(data){this._buffer.update(data);}},{key:"updateDirectly",value:function updateDirectly(data,offset){var useBytes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;this._buffer.updateDirectly(data,offset,void 0,useBytes);}},{key:"dispose",value:function dispose(){if(this._ownsBuffer){this._buffer.dispose();}}},{key:"forEach",value:function forEach(count,callback){VertexBuffer.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,count,this.normalized,callback);}}],[{key:"DeduceStride",value:function DeduceStride(kind){switch(kind){case VertexBuffer.UVKind:case VertexBuffer.UV2Kind:case VertexBuffer.UV3Kind:case VertexBuffer.UV4Kind:case VertexBuffer.UV5Kind:case VertexBuffer.UV6Kind:return 2;case VertexBuffer.NormalKind:case VertexBuffer.PositionKind:return 3;case VertexBuffer.ColorKind:case VertexBuffer.MatricesIndicesKind:case VertexBuffer.MatricesIndicesExtraKind:case VertexBuffer.MatricesWeightsKind:case VertexBuffer.MatricesWeightsExtraKind:case VertexBuffer.TangentKind:return 4;default:throw new Error("Invalid kind '"+kind+"'");}}},{key:"GetTypeByteLength",value:function GetTypeByteLength(type){switch(type){case VertexBuffer.BYTE:case VertexBuffer.UNSIGNED_BYTE:return 1;case VertexBuffer.SHORT:case VertexBuffer.UNSIGNED_SHORT:return 2;case VertexBuffer.INT:case VertexBuffer.UNSIGNED_INT:case VertexBuffer.FLOAT:return 4;default:throw new Error("Invalid type '".concat(type,"'"));}}},{key:"ForEach",value:function ForEach(data,byteOffset,byteStride,componentCount,componentType,count,normalized,callback){if(data instanceof Array){var offset=byteOffset/4;var stride=byteStride/4;for(var index=0;index<count;index+=componentCount){for(var componentIndex=0;componentIndex<componentCount;componentIndex++){callback(data[offset+componentIndex],index+componentIndex);}offset+=stride;}}else{var dataView=data instanceof ArrayBuffer?new DataView(data):new DataView(data.buffer,data.byteOffset,data.byteLength);var componentByteLength=VertexBuffer.GetTypeByteLength(componentType);for(var _index=0;_index<count;_index+=componentCount){var componentByteOffset=byteOffset;for(var _componentIndex=0;_componentIndex<componentCount;_componentIndex++){var value=VertexBuffer._GetFloatValue(dataView,componentType,componentByteOffset,normalized);callback(value,_index+_componentIndex);componentByteOffset+=componentByteLength;}byteOffset+=byteStride;}}}},{key:"_GetFloatValue",value:function _GetFloatValue(dataView,type,byteOffset,normalized){switch(type){case VertexBuffer.BYTE:{var value=dataView.getInt8(byteOffset);if(normalized){value=Math.max(value/127,-1);}return value;}case VertexBuffer.UNSIGNED_BYTE:{var _value=dataView.getUint8(byteOffset);if(normalized){_value=_value/255;}return _value;}case VertexBuffer.SHORT:{var _value2=dataView.getInt16(byteOffset,true);if(normalized){_value2=Math.max(_value2/32767,-1);}return _value2;}case VertexBuffer.UNSIGNED_SHORT:{var _value3=dataView.getUint16(byteOffset,true);if(normalized){_value3=_value3/65535;}return _value3;}case VertexBuffer.INT:{return dataView.getInt32(byteOffset,true);}case VertexBuffer.UNSIGNED_INT:{return dataView.getUint32(byteOffset,true);}case VertexBuffer.FLOAT:{return dataView.getFloat32(byteOffset,true);}default:{throw new Error("Invalid component type ".concat(type));}}}}]);return VertexBuffer;}();VertexBuffer._Counter=0;VertexBuffer.BYTE=5120;VertexBuffer.UNSIGNED_BYTE=5121;VertexBuffer.SHORT=5122;VertexBuffer.UNSIGNED_SHORT=5123;VertexBuffer.INT=5124;VertexBuffer.UNSIGNED_INT=5125;VertexBuffer.FLOAT=5126;VertexBuffer.PositionKind="position";VertexBuffer.NormalKind="normal";VertexBuffer.TangentKind="tangent";VertexBuffer.UVKind="uv";VertexBuffer.UV2Kind="uv2";VertexBuffer.UV3Kind="uv3";VertexBuffer.UV4Kind="uv4";VertexBuffer.UV5Kind="uv5";VertexBuffer.UV6Kind="uv6";VertexBuffer.ColorKind="color";VertexBuffer.ColorInstanceKind="instanceColor";VertexBuffer.MatricesIndicesKind="matricesIndices";VertexBuffer.MatricesWeightsKind="matricesWeights";VertexBuffer.MatricesIndicesExtraKind="matricesIndicesExtra";VertexBuffer.MatricesWeightsExtraKind="matricesWeightsExtra";// node_modules/@babylonjs/core/Collisions/pickingInfo.js
var PickingInfo=/*#__PURE__*/function(){function PickingInfo(){_classCallCheck(this,PickingInfo);this.hit=false;this.distance=0;this.pickedPoint=null;this.pickedMesh=null;this.bu=0;this.bv=0;this.faceId=-1;this.subMeshFaceId=-1;this.subMeshId=0;this.pickedSprite=null;this.thinInstanceIndex=-1;this.ray=null;this.originMesh=null;this.aimTransform=null;this.gripTransform=null;}_createClass(PickingInfo,[{key:"getNormal",value:function getNormal(){var useWorldCoordinates=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var useVerticesNormals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this.pickedMesh||useVerticesNormals&&!this.pickedMesh.isVerticesDataPresent(VertexBuffer.NormalKind)){return null;}var indices=this.pickedMesh.getIndices();if(!indices){return null;}var result;if(useVerticesNormals){var normals=this.pickedMesh.getVerticesData(VertexBuffer.NormalKind);var normal0=Vector3.FromArray(normals,indices[this.faceId*3]*3);var normal1=Vector3.FromArray(normals,indices[this.faceId*3+1]*3);var normal2=Vector3.FromArray(normals,indices[this.faceId*3+2]*3);normal0=normal0.scale(this.bu);normal1=normal1.scale(this.bv);normal2=normal2.scale(1-this.bu-this.bv);result=new Vector3(normal0.x+normal1.x+normal2.x,normal0.y+normal1.y+normal2.y,normal0.z+normal1.z+normal2.z);}else{var positions=this.pickedMesh.getVerticesData(VertexBuffer.PositionKind);var vertex1=Vector3.FromArray(positions,indices[this.faceId*3]*3);var vertex2=Vector3.FromArray(positions,indices[this.faceId*3+1]*3);var vertex3=Vector3.FromArray(positions,indices[this.faceId*3+2]*3);var p1p2=vertex1.subtract(vertex2);var p3p2=vertex3.subtract(vertex2);result=Vector3.Cross(p1p2,p3p2);}var transformNormalToWorld=function transformNormalToWorld(pickedMesh,n){var wm=pickedMesh.getWorldMatrix();if(pickedMesh.nonUniformScaling){TmpVectors.Matrix[0].copyFrom(wm);wm=TmpVectors.Matrix[0];wm.setTranslationFromFloats(0,0,0);wm.invert();wm.transposeToRef(TmpVectors.Matrix[1]);wm=TmpVectors.Matrix[1];}Vector3.TransformNormalToRef(n,wm,n);};if(useWorldCoordinates){transformNormalToWorld(this.pickedMesh,result);}if(this.ray){var normalForDirectionChecking=TmpVectors.Vector3[0].copyFrom(result);if(!useWorldCoordinates){transformNormalToWorld(this.pickedMesh,normalForDirectionChecking);}if(Vector3.Dot(normalForDirectionChecking,this.ray.direction)>0){result.negateInPlace();}}result.normalize();return result;}},{key:"getTextureCoordinates",value:function getTextureCoordinates(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(VertexBuffer.UVKind)){return null;}var indices=this.pickedMesh.getIndices();if(!indices){return null;}var uvs=this.pickedMesh.getVerticesData(VertexBuffer.UVKind);if(!uvs){return null;}var uv0=Vector2.FromArray(uvs,indices[this.faceId*3]*2);var uv1=Vector2.FromArray(uvs,indices[this.faceId*3+1]*2);var uv2=Vector2.FromArray(uvs,indices[this.faceId*3+2]*2);uv0=uv0.scale(this.bu);uv1=uv1.scale(this.bv);uv2=uv2.scale(1-this.bu-this.bv);return new Vector2(uv0.x+uv1.x+uv2.x,uv0.y+uv1.y+uv2.y);}}]);return PickingInfo;}();// node_modules/@babylonjs/core/Actions/actionEvent.js
var ActionEvent=/*#__PURE__*/function(){function ActionEvent(source,pointerX,pointerY,meshUnderPointer,sourceEvent,additionalData){_classCallCheck(this,ActionEvent);this.source=source;this.pointerX=pointerX;this.pointerY=pointerY;this.meshUnderPointer=meshUnderPointer;this.sourceEvent=sourceEvent;this.additionalData=additionalData;}_createClass(ActionEvent,null,[{key:"CreateNew",value:function CreateNew(source,evt,additionalData){var scene2=source.getScene();return new ActionEvent(source,scene2.pointerX,scene2.pointerY,scene2.meshUnderPointer||source,evt,additionalData);}},{key:"CreateNewFromSprite",value:function CreateNewFromSprite(source,scene2,evt,additionalData){return new ActionEvent(source,scene2.pointerX,scene2.pointerY,scene2.meshUnderPointer,evt,additionalData);}},{key:"CreateNewFromScene",value:function CreateNewFromScene(scene2,evt){return new ActionEvent(null,scene2.pointerX,scene2.pointerY,scene2.meshUnderPointer,evt);}},{key:"CreateNewFromPrimitive",value:function CreateNewFromPrimitive(prim,pointerPos,evt,additionalData){return new ActionEvent(prim,pointerPos.x,pointerPos.y,null,evt,additionalData);}}]);return ActionEvent;}();// node_modules/@babylonjs/core/PostProcesses/postProcessManager.js
var PostProcessManager=/*#__PURE__*/function(){function PostProcessManager(scene2){_classCallCheck(this,PostProcessManager);this._vertexBuffers={};this._scene=scene2;}_createClass(PostProcessManager,[{key:"_prepareBuffers",value:function _prepareBuffers(){if(this._vertexBuffers[VertexBuffer.PositionKind]){return;}var vertices=[];vertices.push(1,1);vertices.push(-1,1);vertices.push(-1,-1);vertices.push(1,-1);this._vertexBuffers[VertexBuffer.PositionKind]=new VertexBuffer(this._scene.getEngine(),vertices,VertexBuffer.PositionKind,false,false,2);this._buildIndexBuffer();}},{key:"_buildIndexBuffer",value:function _buildIndexBuffer(){var indices=[];indices.push(0);indices.push(1);indices.push(2);indices.push(0);indices.push(2);indices.push(3);this._indexBuffer=this._scene.getEngine().createIndexBuffer(indices);}},{key:"_rebuild",value:function _rebuild(){var vb=this._vertexBuffers[VertexBuffer.PositionKind];if(!vb){return;}vb._rebuild();this._buildIndexBuffer();}},{key:"_prepareFrame",value:function _prepareFrame(){var sourceTexture=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var postProcesses=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var camera=this._scene.activeCamera;if(!camera){return false;}postProcesses=postProcesses||camera._postProcesses.filter(function(pp){return pp!=null;});if(!postProcesses||postProcesses.length===0||!this._scene.postProcessesEnabled){return false;}postProcesses[0].activate(camera,sourceTexture,postProcesses!==null&&postProcesses!==void 0);return true;}},{key:"directRender",value:function directRender(postProcesses){var targetTexture=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var forceFullscreenViewport=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var faceIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var lodLevel=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var doNotBindFrambuffer=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var _a;var engine=this._scene.getEngine();for(var index=0;index<postProcesses.length;index++){if(index<postProcesses.length-1){postProcesses[index+1].activate(this._scene.activeCamera,targetTexture===null||targetTexture===void 0?void 0:targetTexture.texture);}else{if(targetTexture){engine.bindFramebuffer(targetTexture,faceIndex,void 0,void 0,forceFullscreenViewport,lodLevel);}else if(!doNotBindFrambuffer){engine.restoreDefaultFramebuffer();}(_a=engine._debugInsertMarker)===null||_a===void 0?void 0:_a.call(engine,"post process ".concat(postProcesses[index].name," output"));}var pp=postProcesses[index];var effect=pp.apply();if(effect){pp.onBeforeRenderObservable.notifyObservers(effect);this._prepareBuffers();engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect);engine.drawElementsType(0,0,6);pp.onAfterRenderObservable.notifyObservers(effect);}}engine.setDepthBuffer(true);engine.setDepthWrite(true);}},{key:"_finalizeFrame",value:function _finalizeFrame(doNotPresent,targetTexture,faceIndex,postProcesses){var forceFullscreenViewport=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var _a;var camera=this._scene.activeCamera;if(!camera){return;}postProcesses=postProcesses||camera._postProcesses.filter(function(pp){return pp!=null;});if(postProcesses.length===0||!this._scene.postProcessesEnabled){return;}var engine=this._scene.getEngine();for(var index=0,len=postProcesses.length;index<len;index++){var pp=postProcesses[index];if(index<len-1){pp._outputTexture=postProcesses[index+1].activate(camera,targetTexture===null||targetTexture===void 0?void 0:targetTexture.texture);}else{if(targetTexture){engine.bindFramebuffer(targetTexture,faceIndex,void 0,void 0,forceFullscreenViewport);pp._outputTexture=targetTexture;}else{engine.restoreDefaultFramebuffer();pp._outputTexture=null;}(_a=engine._debugInsertMarker)===null||_a===void 0?void 0:_a.call(engine,"post process ".concat(postProcesses[index].name," output"));}if(doNotPresent){break;}var effect=pp.apply();if(effect){pp.onBeforeRenderObservable.notifyObservers(effect);this._prepareBuffers();engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect);engine.drawElementsType(0,0,6);pp.onAfterRenderObservable.notifyObservers(effect);}}engine.setDepthBuffer(true);engine.setDepthWrite(true);engine.setAlphaMode(0);}},{key:"dispose",value:function dispose(){var buffer=this._vertexBuffers[VertexBuffer.PositionKind];if(buffer){buffer.dispose();this._vertexBuffers[VertexBuffer.PositionKind]=null;}if(this._indexBuffer){this._scene.getEngine()._releaseBuffer(this._indexBuffer);this._indexBuffer=null;}}}]);return PostProcessManager;}();// node_modules/@babylonjs/core/Rendering/renderingGroup.js
var RenderingGroup=/*#__PURE__*/function(){function RenderingGroup(index,scene2){var opaqueSortCompareFn=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var alphaTestSortCompareFn=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var transparentSortCompareFn=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;_classCallCheck(this,RenderingGroup);this.index=index;this._opaqueSubMeshes=new SmartArray(256);this._transparentSubMeshes=new SmartArray(256);this._alphaTestSubMeshes=new SmartArray(256);this._depthOnlySubMeshes=new SmartArray(256);this._particleSystems=new SmartArray(256);this._spriteManagers=new SmartArray(256);this._empty=true;this._edgesRenderers=new SmartArrayNoDuplicate(16);this._scene=scene2;this.opaqueSortCompareFn=opaqueSortCompareFn;this.alphaTestSortCompareFn=alphaTestSortCompareFn;this.transparentSortCompareFn=transparentSortCompareFn;}_createClass(RenderingGroup,[{key:"opaqueSortCompareFn",set:function set(value){if(value){this._opaqueSortCompareFn=value;}else{this._opaqueSortCompareFn=RenderingGroup.PainterSortCompare;}this._renderOpaque=this._renderOpaqueSorted;}},{key:"alphaTestSortCompareFn",set:function set(value){if(value){this._alphaTestSortCompareFn=value;}else{this._alphaTestSortCompareFn=RenderingGroup.PainterSortCompare;}this._renderAlphaTest=this._renderAlphaTestSorted;}},{key:"transparentSortCompareFn",set:function set(value){if(value){this._transparentSortCompareFn=value;}else{this._transparentSortCompareFn=RenderingGroup.defaultTransparentSortCompare;}this._renderTransparent=this._renderTransparentSorted;}},{key:"render",value:function render(customRenderFunction,renderSprites,renderParticles,activeMeshes){if(customRenderFunction){customRenderFunction(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return;}var engine=this._scene.getEngine();if(this._depthOnlySubMeshes.length!==0){engine.setColorWrite(false);this._renderAlphaTest(this._depthOnlySubMeshes);engine.setColorWrite(true);}if(this._opaqueSubMeshes.length!==0){this._renderOpaque(this._opaqueSubMeshes);}if(this._alphaTestSubMeshes.length!==0){this._renderAlphaTest(this._alphaTestSubMeshes);}var stencilState=engine.getStencilBuffer();engine.setStencilBuffer(false);if(renderSprites){this._renderSprites();}if(renderParticles){this._renderParticles(activeMeshes);}if(this.onBeforeTransparentRendering){this.onBeforeTransparentRendering();}if(this._transparentSubMeshes.length!==0||this._scene.useOrderIndependentTransparency){engine.setStencilBuffer(stencilState);if(this._scene.useOrderIndependentTransparency){var excludedMeshes=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);if(excludedMeshes.length){this._renderTransparent(excludedMeshes);}}else{this._renderTransparent(this._transparentSubMeshes);}engine.setAlphaMode(0);}engine.setStencilBuffer(false);if(this._edgesRenderers.length){for(var edgesRendererIndex=0;edgesRendererIndex<this._edgesRenderers.length;edgesRendererIndex++){this._edgesRenderers.data[edgesRendererIndex].render();}engine.setAlphaMode(0);}engine.setStencilBuffer(stencilState);}},{key:"_renderOpaqueSorted",value:function _renderOpaqueSorted(subMeshes){return RenderingGroup._RenderSorted(subMeshes,this._opaqueSortCompareFn,this._scene.activeCamera,false);}},{key:"_renderAlphaTestSorted",value:function _renderAlphaTestSorted(subMeshes){return RenderingGroup._RenderSorted(subMeshes,this._alphaTestSortCompareFn,this._scene.activeCamera,false);}},{key:"_renderTransparentSorted",value:function _renderTransparentSorted(subMeshes){return RenderingGroup._RenderSorted(subMeshes,this._transparentSortCompareFn,this._scene.activeCamera,true);}},{key:"prepare",value:function prepare(){this._opaqueSubMeshes.reset();this._transparentSubMeshes.reset();this._alphaTestSubMeshes.reset();this._depthOnlySubMeshes.reset();this._particleSystems.reset();this.prepareSprites();this._edgesRenderers.reset();this._empty=true;}},{key:"prepareSprites",value:function prepareSprites(){this._spriteManagers.reset();}},{key:"dispose",value:function dispose(){this._opaqueSubMeshes.dispose();this._transparentSubMeshes.dispose();this._alphaTestSubMeshes.dispose();this._depthOnlySubMeshes.dispose();this._particleSystems.dispose();this._spriteManagers.dispose();this._edgesRenderers.dispose();}},{key:"dispatch",value:function dispatch(subMesh,mesh,material){if(mesh===void 0){mesh=subMesh.getMesh();}if(material===void 0){material=subMesh.getMaterial();}if(material===null||material===void 0){return;}if(material.needAlphaBlendingForMesh(mesh)){this._transparentSubMeshes.push(subMesh);}else if(material.needAlphaTesting()){if(material.needDepthPrePass){this._depthOnlySubMeshes.push(subMesh);}this._alphaTestSubMeshes.push(subMesh);}else{if(material.needDepthPrePass){this._depthOnlySubMeshes.push(subMesh);}this._opaqueSubMeshes.push(subMesh);}mesh._renderingGroup=this;if(mesh._edgesRenderer&&mesh._edgesRenderer.isEnabled){this._edgesRenderers.pushNoDuplicate(mesh._edgesRenderer);}this._empty=false;}},{key:"dispatchSprites",value:function dispatchSprites(spriteManager){this._spriteManagers.push(spriteManager);this._empty=false;}},{key:"dispatchParticles",value:function dispatchParticles(particleSystem){this._particleSystems.push(particleSystem);this._empty=false;}},{key:"_renderParticles",value:function _renderParticles(activeMeshes){if(this._particleSystems.length===0){return;}var activeCamera=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var particleIndex=0;particleIndex<this._particleSystems.length;particleIndex++){var particleSystem=this._particleSystems.data[particleIndex];if((activeCamera&&activeCamera.layerMask&particleSystem.layerMask)===0){continue;}var emitter=particleSystem.emitter;if(!emitter.position||!activeMeshes||activeMeshes.indexOf(emitter)!==-1){this._scene._activeParticles.addCount(particleSystem.render(),false);}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene);}},{key:"_renderSprites",value:function _renderSprites(){if(!this._scene.spritesEnabled||this._spriteManagers.length===0){return;}var activeCamera=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var id=0;id<this._spriteManagers.length;id++){var spriteManager=this._spriteManagers.data[id];if((activeCamera&&activeCamera.layerMask&spriteManager.layerMask)!==0){spriteManager.render();}}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene);}}],[{key:"_RenderSorted",value:function _RenderSorted(subMeshes,sortCompareFn,camera,transparent){var subIndex=0;var subMesh;var cameraPosition=camera?camera.globalPosition:RenderingGroup._ZeroVector;if(transparent){for(;subIndex<subMeshes.length;subIndex++){subMesh=subMeshes.data[subIndex];subMesh._alphaIndex=subMesh.getMesh().alphaIndex;subMesh._distanceToCamera=Vector3.Distance(subMesh.getBoundingInfo().boundingSphere.centerWorld,cameraPosition);}}var sortedArray=subMeshes.length===subMeshes.data.length?subMeshes.data:subMeshes.data.slice(0,subMeshes.length);if(sortCompareFn){sortedArray.sort(sortCompareFn);}var scene2=sortedArray[0].getMesh().getScene();for(subIndex=0;subIndex<sortedArray.length;subIndex++){subMesh=sortedArray[subIndex];if(scene2._activeMeshesFrozenButKeepClipping&&!subMesh.isInFrustum(scene2._frustumPlanes)){continue;}if(transparent){var material=subMesh.getMaterial();if(material&&material.needDepthPrePass){var engine=material.getScene().getEngine();engine.setColorWrite(false);engine.setAlphaMode(0);subMesh.render(false);engine.setColorWrite(true);}}subMesh.render(transparent);}}},{key:"defaultTransparentSortCompare",value:function defaultTransparentSortCompare(a,b){if(a._alphaIndex>b._alphaIndex){return 1;}if(a._alphaIndex<b._alphaIndex){return-1;}return RenderingGroup.backToFrontSortCompare(a,b);}},{key:"backToFrontSortCompare",value:function backToFrontSortCompare(a,b){if(a._distanceToCamera<b._distanceToCamera){return 1;}if(a._distanceToCamera>b._distanceToCamera){return-1;}return 0;}},{key:"frontToBackSortCompare",value:function frontToBackSortCompare(a,b){if(a._distanceToCamera<b._distanceToCamera){return-1;}if(a._distanceToCamera>b._distanceToCamera){return 1;}return 0;}},{key:"PainterSortCompare",value:function PainterSortCompare(a,b){var meshA=a.getMesh();var meshB=b.getMesh();if(meshA.material&&meshB.material){return meshA.material.uniqueId-meshB.material.uniqueId;}return meshA.uniqueId-meshB.uniqueId;}}]);return RenderingGroup;}();RenderingGroup._ZeroVector=Vector3.Zero();// node_modules/@babylonjs/core/Rendering/renderingManager.js
var RenderingGroupInfo=/*#__PURE__*/_createClass(function RenderingGroupInfo(){_classCallCheck(this,RenderingGroupInfo);});var RenderingManager=/*#__PURE__*/function(){function RenderingManager(scene2){_classCallCheck(this,RenderingManager);this._useSceneAutoClearSetup=false;this._renderingGroups=new Array();this._autoClearDepthStencil={};this._customOpaqueSortCompareFn={};this._customAlphaTestSortCompareFn={};this._customTransparentSortCompareFn={};this._renderingGroupInfo=new RenderingGroupInfo();this._maintainStateBetweenFrames=false;this._scene=scene2;for(var i=RenderingManager.MIN_RENDERINGGROUPS;i<RenderingManager.MAX_RENDERINGGROUPS;i++){this._autoClearDepthStencil[i]={autoClear:true,depth:true,stencil:true};}}_createClass(RenderingManager,[{key:"maintainStateBetweenFrames",get:function get(){return this._maintainStateBetweenFrames;},set:function set(value){if(value===this._maintainStateBetweenFrames){return;}this._maintainStateBetweenFrames=value;if(!this._maintainStateBetweenFrames){var _iterator21=_createForOfIteratorHelper(this._scene.meshes),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var mesh=_step21.value;if(mesh.subMeshes){var _iterator24=_createForOfIteratorHelper(mesh.subMeshes),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var subMesh=_step24.value;subMesh._wasDispatched=false;}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}}}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}var _iterator22=_createForOfIteratorHelper(this._scene.spriteManagers),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var spriteManager=_step22.value;spriteManager._wasDispatched=false;}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}var _iterator23=_createForOfIteratorHelper(this._scene.particleSystems),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var particleSystem=_step23.value;particleSystem._wasDispatched=false;}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}}}},{key:"getRenderingGroup",value:function getRenderingGroup(id){var renderingGroupId=id||0;this._prepareRenderingGroup(renderingGroupId);return this._renderingGroups[renderingGroupId];}},{key:"_clearDepthStencilBuffer",value:function _clearDepthStencilBuffer(){var depth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var stencil=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this._depthStencilBufferAlreadyCleaned){return;}this._scene.getEngine().clear(null,false,depth,stencil);this._depthStencilBufferAlreadyCleaned=true;}},{key:"render",value:function render(customRenderFunction,activeMeshes,renderParticles,renderSprites){var info=this._renderingGroupInfo;info.scene=this._scene;info.camera=this._scene.activeCamera;if(this._scene.spriteManagers&&renderSprites){for(var index=0;index<this._scene.spriteManagers.length;index++){var manager=this._scene.spriteManagers[index];this.dispatchSprites(manager);}}for(var _index2=RenderingManager.MIN_RENDERINGGROUPS;_index2<RenderingManager.MAX_RENDERINGGROUPS;_index2++){this._depthStencilBufferAlreadyCleaned=_index2===RenderingManager.MIN_RENDERINGGROUPS;var renderingGroup=this._renderingGroups[_index2];if(!renderingGroup||renderingGroup._empty){continue;}var renderingGroupMask=Math.pow(2,_index2);info.renderingGroupId=_index2;this._scene.onBeforeRenderingGroupObservable.notifyObservers(info,renderingGroupMask);if(RenderingManager.AUTOCLEAR){var autoClear=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(_index2):this._autoClearDepthStencil[_index2];if(autoClear&&autoClear.autoClear){this._clearDepthStencilBuffer(autoClear.depth,autoClear.stencil);}}var _iterator25=_createForOfIteratorHelper(this._scene._beforeRenderingGroupDrawStage),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var step=_step25.value;step.action(_index2);}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}renderingGroup.render(customRenderFunction,renderSprites,renderParticles,activeMeshes);var _iterator26=_createForOfIteratorHelper(this._scene._afterRenderingGroupDrawStage),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var _step27=_step26.value;_step27.action(_index2);}}catch(err){_iterator26.e(err);}finally{_iterator26.f();}this._scene.onAfterRenderingGroupObservable.notifyObservers(info,renderingGroupMask);}}},{key:"reset",value:function reset(){if(this.maintainStateBetweenFrames){return;}for(var index=RenderingManager.MIN_RENDERINGGROUPS;index<RenderingManager.MAX_RENDERINGGROUPS;index++){var renderingGroup=this._renderingGroups[index];if(renderingGroup){renderingGroup.prepare();}}}},{key:"resetSprites",value:function resetSprites(){if(this.maintainStateBetweenFrames){return;}for(var index=RenderingManager.MIN_RENDERINGGROUPS;index<RenderingManager.MAX_RENDERINGGROUPS;index++){var renderingGroup=this._renderingGroups[index];if(renderingGroup){renderingGroup.prepareSprites();}}}},{key:"dispose",value:function dispose(){this.freeRenderingGroups();this._renderingGroups.length=0;this._renderingGroupInfo=null;}},{key:"freeRenderingGroups",value:function freeRenderingGroups(){for(var index=RenderingManager.MIN_RENDERINGGROUPS;index<RenderingManager.MAX_RENDERINGGROUPS;index++){var renderingGroup=this._renderingGroups[index];if(renderingGroup){renderingGroup.dispose();}}}},{key:"_prepareRenderingGroup",value:function _prepareRenderingGroup(renderingGroupId){if(this._renderingGroups[renderingGroupId]===void 0){this._renderingGroups[renderingGroupId]=new RenderingGroup(renderingGroupId,this._scene,this._customOpaqueSortCompareFn[renderingGroupId],this._customAlphaTestSortCompareFn[renderingGroupId],this._customTransparentSortCompareFn[renderingGroupId]);}}},{key:"dispatchSprites",value:function dispatchSprites(spriteManager){if(this.maintainStateBetweenFrames&&spriteManager._wasDispatched){return;}spriteManager._wasDispatched=true;this.getRenderingGroup(spriteManager.renderingGroupId).dispatchSprites(spriteManager);}},{key:"dispatchParticles",value:function dispatchParticles(particleSystem){if(this.maintainStateBetweenFrames&&particleSystem._wasDispatched){return;}particleSystem._wasDispatched=true;this.getRenderingGroup(particleSystem.renderingGroupId).dispatchParticles(particleSystem);}},{key:"dispatch",value:function dispatch(subMesh,mesh,material){if(mesh===void 0){mesh=subMesh.getMesh();}if(this.maintainStateBetweenFrames&&subMesh._wasDispatched){return;}subMesh._wasDispatched=true;this.getRenderingGroup(mesh.renderingGroupId).dispatch(subMesh,mesh,material);}},{key:"setRenderingOrder",value:function setRenderingOrder(renderingGroupId){var opaqueSortCompareFn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var alphaTestSortCompareFn=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var transparentSortCompareFn=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;this._customOpaqueSortCompareFn[renderingGroupId]=opaqueSortCompareFn;this._customAlphaTestSortCompareFn[renderingGroupId]=alphaTestSortCompareFn;this._customTransparentSortCompareFn[renderingGroupId]=transparentSortCompareFn;if(this._renderingGroups[renderingGroupId]){var group=this._renderingGroups[renderingGroupId];group.opaqueSortCompareFn=this._customOpaqueSortCompareFn[renderingGroupId];group.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[renderingGroupId];group.transparentSortCompareFn=this._customTransparentSortCompareFn[renderingGroupId];}}},{key:"setRenderingAutoClearDepthStencil",value:function setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var stencil=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;this._autoClearDepthStencil[renderingGroupId]={autoClear:autoClearDepthStencil,depth:depth,stencil:stencil};}},{key:"getAutoClearDepthStencilSetup",value:function getAutoClearDepthStencilSetup(index){return this._autoClearDepthStencil[index];}}]);return RenderingManager;}();RenderingManager.MAX_RENDERINGGROUPS=4;RenderingManager.MIN_RENDERINGGROUPS=0;RenderingManager.AUTOCLEAR=true;// node_modules/@babylonjs/core/sceneComponent.js
var SceneComponentConstants=/*#__PURE__*/_createClass(function SceneComponentConstants(){_classCallCheck(this,SceneComponentConstants);});SceneComponentConstants.NAME_EFFECTLAYER="EffectLayer";SceneComponentConstants.NAME_LAYER="Layer";SceneComponentConstants.NAME_LENSFLARESYSTEM="LensFlareSystem";SceneComponentConstants.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer";SceneComponentConstants.NAME_PARTICLESYSTEM="ParticleSystem";SceneComponentConstants.NAME_GAMEPAD="Gamepad";SceneComponentConstants.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue";SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer";SceneComponentConstants.NAME_PREPASSRENDERER="PrePassRenderer";SceneComponentConstants.NAME_DEPTHRENDERER="DepthRenderer";SceneComponentConstants.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer";SceneComponentConstants.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager";SceneComponentConstants.NAME_SPRITE="Sprite";SceneComponentConstants.NAME_SUBSURFACE="SubSurface";SceneComponentConstants.NAME_OUTLINERENDERER="Outline";SceneComponentConstants.NAME_PROCEDURALTEXTURE="ProceduralTexture";SceneComponentConstants.NAME_SHADOWGENERATOR="ShadowGenerator";SceneComponentConstants.NAME_OCTREE="Octree";SceneComponentConstants.NAME_PHYSICSENGINE="PhysicsEngine";SceneComponentConstants.NAME_AUDIO="Audio";SceneComponentConstants.NAME_FLUIDRENDERER="FluidRenderer";SceneComponentConstants.STEP_ISREADYFORMESH_EFFECTLAYER=0;SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0;SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0;SceneComponentConstants.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0;SceneComponentConstants.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1;SceneComponentConstants.STEP_BEFORECAMERADRAW_PREPASS=0;SceneComponentConstants.STEP_BEFORECAMERADRAW_EFFECTLAYER=1;SceneComponentConstants.STEP_BEFORECAMERADRAW_LAYER=2;SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_PREPASS=0;SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_LAYER=1;SceneComponentConstants.STEP_BEFORERENDERINGMESH_PREPASS=0;SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE=1;SceneComponentConstants.STEP_AFTERRENDERINGMESH_PREPASS=0;SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE=1;SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0;SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1;SceneComponentConstants.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0;SceneComponentConstants.STEP_BEFORECAMERAUPDATE_GAMEPAD=1;SceneComponentConstants.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0;SceneComponentConstants.STEP_BEFORECLEAR_PREPASS=1;SceneComponentConstants.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0;SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_PREPASS=0;SceneComponentConstants.STEP_AFTERRENDERTARGETDRAW_LAYER=1;SceneComponentConstants.STEP_AFTERCAMERADRAW_PREPASS=0;SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER=1;SceneComponentConstants.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2;SceneComponentConstants.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3;SceneComponentConstants.STEP_AFTERCAMERADRAW_LAYER=4;SceneComponentConstants.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5;SceneComponentConstants.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0;SceneComponentConstants.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0;SceneComponentConstants.STEP_AFTERRENDER_AUDIO=0;SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0;SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1;SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2;SceneComponentConstants.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3;SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0;SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1;SceneComponentConstants.STEP_POINTERMOVE_SPRITE=0;SceneComponentConstants.STEP_POINTERDOWN_SPRITE=0;SceneComponentConstants.STEP_POINTERUP_SPRITE=0;var Stage=/*#__PURE__*/function(_Array){_inherits(Stage,_Array);var _super15=_createSuper(Stage);function Stage(items){_classCallCheck(this,Stage);return _super15.call.apply(_super15,[this].concat(_toConsumableArray(items)));}_createClass(Stage,[{key:"registerStep",value:function registerStep(index,component,action){var i=0;var maxIndex=Number.MAX_VALUE;for(;i<this.length;i++){var step=this[i];maxIndex=step.index;if(index<maxIndex){break;}}this.splice(i,0,{index:index,component:component,action:action.bind(component)});}},{key:"clear",value:function clear(){this.length=0;}}],[{key:"Create",value:function Create(){return Object.create(Stage.prototype);}}]);return Stage;}(/*#__PURE__*/_wrapNativeSuper(Array));// node_modules/@babylonjs/core/Events/pointerEvents.js
var PointerEventTypes=/*#__PURE__*/_createClass(function PointerEventTypes(){_classCallCheck(this,PointerEventTypes);});PointerEventTypes.POINTERDOWN=1;PointerEventTypes.POINTERUP=2;PointerEventTypes.POINTERMOVE=4;PointerEventTypes.POINTERWHEEL=8;PointerEventTypes.POINTERPICK=16;PointerEventTypes.POINTERTAP=32;PointerEventTypes.POINTERDOUBLETAP=64;var PointerInfoBase=/*#__PURE__*/_createClass(function PointerInfoBase(type,event){_classCallCheck(this,PointerInfoBase);this.type=type;this.event=event;});var PointerInfoPre=/*#__PURE__*/function(_PointerInfoBase){_inherits(PointerInfoPre,_PointerInfoBase);var _super16=_createSuper(PointerInfoPre);function PointerInfoPre(type,event,localX,localY){var _this37;_classCallCheck(this,PointerInfoPre);_this37=_super16.call(this,type,event);_this37.ray=null;_this37.originalPickingInfo=null;_this37.skipOnPointerObservable=false;_this37.localPosition=new Vector2(localX,localY);return _this37;}return _createClass(PointerInfoPre);}(PointerInfoBase);var PointerInfo=/*#__PURE__*/function(_PointerInfoBase2){_inherits(PointerInfo,_PointerInfoBase2);var _super17=_createSuper(PointerInfo);function PointerInfo(type,event,pickInfo){var _this38;var inputManager=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_classCallCheck(this,PointerInfo);_this38=_super17.call(this,type,event);_this38._pickInfo=pickInfo;_this38._inputManager=inputManager;return _this38;}_createClass(PointerInfo,[{key:"pickInfo",get:function get(){if(!this._pickInfo){this._generatePickInfo();}return this._pickInfo;}},{key:"_generatePickInfo",value:function _generatePickInfo(){if(this._inputManager){this._pickInfo=this._inputManager._pickMove(this.event);this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event);this._inputManager=null;}}}]);return PointerInfo;}(PointerInfoBase);// node_modules/@babylonjs/core/Actions/abstractActionManager.js
var AbstractActionManager=/*#__PURE__*/function(){function AbstractActionManager(){_classCallCheck(this,AbstractActionManager);this.hoverCursor="";this.actions=new Array();this.isRecursive=false;}_createClass(AbstractActionManager,null,[{key:"HasTriggers",get:function get(){for(var t in AbstractActionManager.Triggers){if(Object.prototype.hasOwnProperty.call(AbstractActionManager.Triggers,t)){return true;}}return false;}},{key:"HasPickTriggers",get:function get(){for(var t in AbstractActionManager.Triggers){if(Object.prototype.hasOwnProperty.call(AbstractActionManager.Triggers,t)){var tAsInt=parseInt(t);if(tAsInt>=1&&tAsInt<=7){return true;}}}return false;}},{key:"HasSpecificTrigger",value:function HasSpecificTrigger(trigger){for(var t in AbstractActionManager.Triggers){if(Object.prototype.hasOwnProperty.call(AbstractActionManager.Triggers,t)){var tAsInt=parseInt(t);if(tAsInt===trigger){return true;}}}return false;}}]);return AbstractActionManager;}();AbstractActionManager.Triggers={};// node_modules/@babylonjs/core/Events/keyboardEvents.js
var KeyboardEventTypes=/*#__PURE__*/_createClass(function KeyboardEventTypes(){_classCallCheck(this,KeyboardEventTypes);});KeyboardEventTypes.KEYDOWN=1;KeyboardEventTypes.KEYUP=2;var KeyboardInfo=/*#__PURE__*/_createClass(function KeyboardInfo(type,event){_classCallCheck(this,KeyboardInfo);this.type=type;this.event=event;});var KeyboardInfoPre=/*#__PURE__*/function(_KeyboardInfo){_inherits(KeyboardInfoPre,_KeyboardInfo);var _super18=_createSuper(KeyboardInfoPre);function KeyboardInfoPre(type,event){var _this39;_classCallCheck(this,KeyboardInfoPre);_this39=_super18.call(this,type,event);_this39.type=type;_this39.event=event;_this39.skipOnKeyboardObservable=false;return _this39;}_createClass(KeyboardInfoPre,[{key:"skipOnPointerObservable",get:function get(){return this.skipOnKeyboardObservable;},set:function set(value){this.skipOnKeyboardObservable=value;}}]);return KeyboardInfoPre;}(KeyboardInfo);// node_modules/@babylonjs/core/DeviceInput/InputDevices/deviceEnums.js
var DeviceType;(function(DeviceType2){DeviceType2[DeviceType2["Generic"]=0]="Generic";DeviceType2[DeviceType2["Keyboard"]=1]="Keyboard";DeviceType2[DeviceType2["Mouse"]=2]="Mouse";DeviceType2[DeviceType2["Touch"]=3]="Touch";DeviceType2[DeviceType2["DualShock"]=4]="DualShock";DeviceType2[DeviceType2["Xbox"]=5]="Xbox";DeviceType2[DeviceType2["Switch"]=6]="Switch";DeviceType2[DeviceType2["DualSense"]=7]="DualSense";})(DeviceType||(DeviceType={}));var PointerInput;(function(PointerInput2){PointerInput2[PointerInput2["Horizontal"]=0]="Horizontal";PointerInput2[PointerInput2["Vertical"]=1]="Vertical";PointerInput2[PointerInput2["LeftClick"]=2]="LeftClick";PointerInput2[PointerInput2["MiddleClick"]=3]="MiddleClick";PointerInput2[PointerInput2["RightClick"]=4]="RightClick";PointerInput2[PointerInput2["BrowserBack"]=5]="BrowserBack";PointerInput2[PointerInput2["BrowserForward"]=6]="BrowserForward";PointerInput2[PointerInput2["MouseWheelX"]=7]="MouseWheelX";PointerInput2[PointerInput2["MouseWheelY"]=8]="MouseWheelY";PointerInput2[PointerInput2["MouseWheelZ"]=9]="MouseWheelZ";PointerInput2[PointerInput2["Move"]=12]="Move";})(PointerInput||(PointerInput={}));var NativePointerInput;(function(NativePointerInput2){NativePointerInput2[NativePointerInput2["Horizontal"]=0]="Horizontal";NativePointerInput2[NativePointerInput2["Vertical"]=1]="Vertical";NativePointerInput2[NativePointerInput2["LeftClick"]=2]="LeftClick";NativePointerInput2[NativePointerInput2["MiddleClick"]=3]="MiddleClick";NativePointerInput2[NativePointerInput2["RightClick"]=4]="RightClick";NativePointerInput2[NativePointerInput2["BrowserBack"]=5]="BrowserBack";NativePointerInput2[NativePointerInput2["BrowserForward"]=6]="BrowserForward";NativePointerInput2[NativePointerInput2["MouseWheelX"]=7]="MouseWheelX";NativePointerInput2[NativePointerInput2["MouseWheelY"]=8]="MouseWheelY";NativePointerInput2[NativePointerInput2["MouseWheelZ"]=9]="MouseWheelZ";NativePointerInput2[NativePointerInput2["DeltaHorizontal"]=10]="DeltaHorizontal";NativePointerInput2[NativePointerInput2["DeltaVertical"]=11]="DeltaVertical";})(NativePointerInput||(NativePointerInput={}));var DualShockInput;(function(DualShockInput2){DualShockInput2[DualShockInput2["Cross"]=0]="Cross";DualShockInput2[DualShockInput2["Circle"]=1]="Circle";DualShockInput2[DualShockInput2["Square"]=2]="Square";DualShockInput2[DualShockInput2["Triangle"]=3]="Triangle";DualShockInput2[DualShockInput2["L1"]=4]="L1";DualShockInput2[DualShockInput2["R1"]=5]="R1";DualShockInput2[DualShockInput2["L2"]=6]="L2";DualShockInput2[DualShockInput2["R2"]=7]="R2";DualShockInput2[DualShockInput2["Share"]=8]="Share";DualShockInput2[DualShockInput2["Options"]=9]="Options";DualShockInput2[DualShockInput2["L3"]=10]="L3";DualShockInput2[DualShockInput2["R3"]=11]="R3";DualShockInput2[DualShockInput2["DPadUp"]=12]="DPadUp";DualShockInput2[DualShockInput2["DPadDown"]=13]="DPadDown";DualShockInput2[DualShockInput2["DPadLeft"]=14]="DPadLeft";DualShockInput2[DualShockInput2["DPadRight"]=15]="DPadRight";DualShockInput2[DualShockInput2["Home"]=16]="Home";DualShockInput2[DualShockInput2["TouchPad"]=17]="TouchPad";DualShockInput2[DualShockInput2["LStickXAxis"]=18]="LStickXAxis";DualShockInput2[DualShockInput2["LStickYAxis"]=19]="LStickYAxis";DualShockInput2[DualShockInput2["RStickXAxis"]=20]="RStickXAxis";DualShockInput2[DualShockInput2["RStickYAxis"]=21]="RStickYAxis";})(DualShockInput||(DualShockInput={}));var DualSenseInput;(function(DualSenseInput2){DualSenseInput2[DualSenseInput2["Cross"]=0]="Cross";DualSenseInput2[DualSenseInput2["Circle"]=1]="Circle";DualSenseInput2[DualSenseInput2["Square"]=2]="Square";DualSenseInput2[DualSenseInput2["Triangle"]=3]="Triangle";DualSenseInput2[DualSenseInput2["L1"]=4]="L1";DualSenseInput2[DualSenseInput2["R1"]=5]="R1";DualSenseInput2[DualSenseInput2["L2"]=6]="L2";DualSenseInput2[DualSenseInput2["R2"]=7]="R2";DualSenseInput2[DualSenseInput2["Create"]=8]="Create";DualSenseInput2[DualSenseInput2["Options"]=9]="Options";DualSenseInput2[DualSenseInput2["L3"]=10]="L3";DualSenseInput2[DualSenseInput2["R3"]=11]="R3";DualSenseInput2[DualSenseInput2["DPadUp"]=12]="DPadUp";DualSenseInput2[DualSenseInput2["DPadDown"]=13]="DPadDown";DualSenseInput2[DualSenseInput2["DPadLeft"]=14]="DPadLeft";DualSenseInput2[DualSenseInput2["DPadRight"]=15]="DPadRight";DualSenseInput2[DualSenseInput2["Home"]=16]="Home";DualSenseInput2[DualSenseInput2["TouchPad"]=17]="TouchPad";DualSenseInput2[DualSenseInput2["LStickXAxis"]=18]="LStickXAxis";DualSenseInput2[DualSenseInput2["LStickYAxis"]=19]="LStickYAxis";DualSenseInput2[DualSenseInput2["RStickXAxis"]=20]="RStickXAxis";DualSenseInput2[DualSenseInput2["RStickYAxis"]=21]="RStickYAxis";})(DualSenseInput||(DualSenseInput={}));var XboxInput;(function(XboxInput2){XboxInput2[XboxInput2["A"]=0]="A";XboxInput2[XboxInput2["B"]=1]="B";XboxInput2[XboxInput2["X"]=2]="X";XboxInput2[XboxInput2["Y"]=3]="Y";XboxInput2[XboxInput2["LB"]=4]="LB";XboxInput2[XboxInput2["RB"]=5]="RB";XboxInput2[XboxInput2["LT"]=6]="LT";XboxInput2[XboxInput2["RT"]=7]="RT";XboxInput2[XboxInput2["Back"]=8]="Back";XboxInput2[XboxInput2["Start"]=9]="Start";XboxInput2[XboxInput2["LS"]=10]="LS";XboxInput2[XboxInput2["RS"]=11]="RS";XboxInput2[XboxInput2["DPadUp"]=12]="DPadUp";XboxInput2[XboxInput2["DPadDown"]=13]="DPadDown";XboxInput2[XboxInput2["DPadLeft"]=14]="DPadLeft";XboxInput2[XboxInput2["DPadRight"]=15]="DPadRight";XboxInput2[XboxInput2["Home"]=16]="Home";XboxInput2[XboxInput2["LStickXAxis"]=17]="LStickXAxis";XboxInput2[XboxInput2["LStickYAxis"]=18]="LStickYAxis";XboxInput2[XboxInput2["RStickXAxis"]=19]="RStickXAxis";XboxInput2[XboxInput2["RStickYAxis"]=20]="RStickYAxis";})(XboxInput||(XboxInput={}));var SwitchInput;(function(SwitchInput2){SwitchInput2[SwitchInput2["B"]=0]="B";SwitchInput2[SwitchInput2["A"]=1]="A";SwitchInput2[SwitchInput2["Y"]=2]="Y";SwitchInput2[SwitchInput2["X"]=3]="X";SwitchInput2[SwitchInput2["L"]=4]="L";SwitchInput2[SwitchInput2["R"]=5]="R";SwitchInput2[SwitchInput2["ZL"]=6]="ZL";SwitchInput2[SwitchInput2["ZR"]=7]="ZR";SwitchInput2[SwitchInput2["Minus"]=8]="Minus";SwitchInput2[SwitchInput2["Plus"]=9]="Plus";SwitchInput2[SwitchInput2["LS"]=10]="LS";SwitchInput2[SwitchInput2["RS"]=11]="RS";SwitchInput2[SwitchInput2["DPadUp"]=12]="DPadUp";SwitchInput2[SwitchInput2["DPadDown"]=13]="DPadDown";SwitchInput2[SwitchInput2["DPadLeft"]=14]="DPadLeft";SwitchInput2[SwitchInput2["DPadRight"]=15]="DPadRight";SwitchInput2[SwitchInput2["Home"]=16]="Home";SwitchInput2[SwitchInput2["Capture"]=17]="Capture";SwitchInput2[SwitchInput2["LStickXAxis"]=18]="LStickXAxis";SwitchInput2[SwitchInput2["LStickYAxis"]=19]="LStickYAxis";SwitchInput2[SwitchInput2["RStickXAxis"]=20]="RStickXAxis";SwitchInput2[SwitchInput2["RStickYAxis"]=21]="RStickYAxis";})(SwitchInput||(SwitchInput={}));// node_modules/@babylonjs/core/Events/deviceInputEvents.js
var DeviceInputEventType;(function(DeviceInputEventType2){DeviceInputEventType2[DeviceInputEventType2["PointerMove"]=0]="PointerMove";DeviceInputEventType2[DeviceInputEventType2["PointerDown"]=1]="PointerDown";DeviceInputEventType2[DeviceInputEventType2["PointerUp"]=2]="PointerUp";})(DeviceInputEventType||(DeviceInputEventType={}));var EventConstants=/*#__PURE__*/_createClass(function EventConstants(){_classCallCheck(this,EventConstants);});EventConstants.DOM_DELTA_PIXEL=0;EventConstants.DOM_DELTA_LINE=1;EventConstants.DOM_DELTA_PAGE=2;// node_modules/@babylonjs/core/DeviceInput/eventFactory.js
var DeviceEventFactory=/*#__PURE__*/function(){function DeviceEventFactory(){_classCallCheck(this,DeviceEventFactory);}_createClass(DeviceEventFactory,null,[{key:"CreateDeviceEvent",value:function CreateDeviceEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo,pointerId){switch(deviceType){case DeviceType.Keyboard:return this._CreateKeyboardEvent(inputIndex,currentState,deviceInputSystem,elementToAttachTo);case DeviceType.Mouse:if(inputIndex===PointerInput.MouseWheelX||inputIndex===PointerInput.MouseWheelY||inputIndex===PointerInput.MouseWheelZ){return this._CreateWheelEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo);}case DeviceType.Touch:return this._CreatePointerEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo,pointerId);default:throw"Unable to generate event for device ".concat(DeviceType[deviceType]);}}},{key:"_CreatePointerEvent",value:function _CreatePointerEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo,pointerId){var evt=this._CreateMouseEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo);if(deviceType===DeviceType.Mouse){evt.deviceType=DeviceType.Mouse;evt.pointerId=1;evt.pointerType="mouse";}else{evt.deviceType=DeviceType.Touch;evt.pointerId=pointerId!==null&&pointerId!==void 0?pointerId:deviceSlot;evt.pointerType="touch";}if(inputIndex===PointerInput.Move){evt.type="pointermove";}else if(inputIndex>=PointerInput.LeftClick&&inputIndex<=PointerInput.RightClick){evt.type=currentState===1?"pointerdown":"pointerup";evt.button=inputIndex-2;}return evt;}},{key:"_CreateWheelEvent",value:function _CreateWheelEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo){var evt=this._CreateMouseEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo);evt.type="wheel";evt.deltaMode=EventConstants.DOM_DELTA_PIXEL;evt.deltaX=0;evt.deltaY=0;evt.deltaZ=0;switch(inputIndex){case PointerInput.MouseWheelX:evt.deltaX=currentState;break;case PointerInput.MouseWheelY:evt.deltaY=currentState;break;case PointerInput.MouseWheelZ:evt.deltaZ=currentState;break;}return evt;}},{key:"_CreateMouseEvent",value:function _CreateMouseEvent(deviceType,deviceSlot,inputIndex,currentState,deviceInputSystem,elementToAttachTo){var evt=this._CreateEvent(elementToAttachTo);var pointerX=deviceInputSystem.pollInput(deviceType,deviceSlot,PointerInput.Horizontal);var pointerY=deviceInputSystem.pollInput(deviceType,deviceSlot,PointerInput.Vertical);if(elementToAttachTo){evt.movementX=0;evt.movementY=0;evt.offsetX=evt.movementX-elementToAttachTo.getBoundingClientRect().x;evt.offsetY=evt.movementY-elementToAttachTo.getBoundingClientRect().y;}else{evt.movementX=deviceInputSystem.pollInput(deviceType,deviceSlot,NativePointerInput.DeltaHorizontal);evt.movementY=deviceInputSystem.pollInput(deviceType,deviceSlot,NativePointerInput.DeltaVertical);evt.offsetX=0;evt.offsetY=0;}this._CheckNonCharacterKeys(evt,deviceInputSystem);evt.clientX=pointerX;evt.clientY=pointerY;evt.x=pointerX;evt.y=pointerY;evt.deviceType=deviceType;evt.deviceSlot=deviceSlot;evt.inputIndex=inputIndex;return evt;}},{key:"_CreateKeyboardEvent",value:function _CreateKeyboardEvent(inputIndex,currentState,deviceInputSystem,elementToAttachTo){var evt=this._CreateEvent(elementToAttachTo);this._CheckNonCharacterKeys(evt,deviceInputSystem);evt.deviceType=DeviceType.Keyboard;evt.deviceSlot=0;evt.inputIndex=inputIndex;evt.type=currentState===1?"keydown":"keyup";evt.key=String.fromCharCode(inputIndex);evt.keyCode=inputIndex;return evt;}},{key:"_CheckNonCharacterKeys",value:function _CheckNonCharacterKeys(evt,deviceInputSystem){var isKeyboardActive=deviceInputSystem.isDeviceAvailable(DeviceType.Keyboard);var altKey=isKeyboardActive&&deviceInputSystem.pollInput(DeviceType.Keyboard,0,18)===1;var ctrlKey=isKeyboardActive&&deviceInputSystem.pollInput(DeviceType.Keyboard,0,17)===1;var metaKey=isKeyboardActive&&(deviceInputSystem.pollInput(DeviceType.Keyboard,0,91)===1||deviceInputSystem.pollInput(DeviceType.Keyboard,0,92)===1||deviceInputSystem.pollInput(DeviceType.Keyboard,0,93)===1);var shiftKey=isKeyboardActive&&deviceInputSystem.pollInput(DeviceType.Keyboard,0,16)===1;evt.altKey=altKey;evt.ctrlKey=ctrlKey;evt.metaKey=metaKey;evt.shiftKey=shiftKey;}},{key:"_CreateEvent",value:function _CreateEvent(elementToAttachTo){var evt={};evt.preventDefault=function(){};evt.target=elementToAttachTo;return evt;}}]);return DeviceEventFactory;}();// node_modules/@babylonjs/core/DeviceInput/nativeDeviceInputSystem.js
var NativeDeviceInputSystem=/*#__PURE__*/function(){function NativeDeviceInputSystem(onDeviceConnected,onDeviceDisconnected,onInputChanged){var _this40=this;_classCallCheck(this,NativeDeviceInputSystem);this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(onDeviceConnected,onDeviceDisconnected,function(deviceType,deviceSlot,inputIndex,currentState){var evt=DeviceEventFactory.CreateDeviceEvent(deviceType,deviceSlot,inputIndex,currentState,_this40);onInputChanged(deviceType,deviceSlot,evt);}):this._createDummyNativeInput();}_createClass(NativeDeviceInputSystem,[{key:"pollInput",value:function pollInput(deviceType,deviceSlot,inputIndex){return this._nativeInput.pollInput(deviceType,deviceSlot,inputIndex);}},{key:"isDeviceAvailable",value:function isDeviceAvailable(deviceType){return deviceType===DeviceType.Mouse||deviceType===DeviceType.Touch;}},{key:"dispose",value:function dispose(){this._nativeInput.dispose();}},{key:"_createDummyNativeInput",value:function _createDummyNativeInput(){var nativeInput={pollInput:function pollInput(){return 0;},isDeviceAvailable:function isDeviceAvailable(){return false;},dispose:function dispose(){}};return nativeInput;}}]);return NativeDeviceInputSystem;}();// node_modules/@babylonjs/core/DeviceInput/webDeviceInputSystem.js
var MAX_KEYCODES=255;var MAX_POINTER_INPUTS=Object.keys(PointerInput).length/2;var WebDeviceInputSystem=/*#__PURE__*/function(){function WebDeviceInputSystem(engine,onDeviceConnected,onDeviceDisconnected,onInputChanged){var _this41=this;_classCallCheck(this,WebDeviceInputSystem);this._inputs=[];this._keyboardActive=false;this._pointerActive=false;this._usingSafari=Tools.IsSafari();this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform);this._keyboardDownEvent=function(evt){};this._keyboardUpEvent=function(evt){};this._keyboardBlurEvent=function(evt){};this._pointerMoveEvent=function(evt){};this._pointerDownEvent=function(evt){};this._pointerUpEvent=function(evt){};this._pointerCancelEvent=function(evt){};this._pointerWheelEvent=function(evt){};this._pointerBlurEvent=function(evt){};this._eventsAttached=false;this._mouseId=-1;this._isUsingFirefox=DomManagement.IsNavigatorAvailable()&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!==-1;this._maxTouchPoints=0;this._pointerInputClearObserver=null;this._gamepadConnectedEvent=function(evt){};this._gamepadDisconnectedEvent=function(evt){};this._eventPrefix=Tools.GetPointerPrefix(engine);this._engine=engine;this._onDeviceConnected=onDeviceConnected;this._onDeviceDisconnected=onDeviceDisconnected;this._onInputChanged=onInputChanged;this._enableEvents();if(this._usingMacOS){this._metaKeys=[];}if(!this._engine._onEngineViewChanged){this._engine._onEngineViewChanged=function(){_this41._enableEvents();};}}_createClass(WebDeviceInputSystem,[{key:"pollInput",value:function pollInput(deviceType,deviceSlot,inputIndex){var device=this._inputs[deviceType][deviceSlot];if(!device){throw"Unable to find device ".concat(DeviceType[deviceType]);}if(deviceType>=DeviceType.DualShock&&deviceType<=DeviceType.DualSense){this._updateDevice(deviceType,deviceSlot,inputIndex);}var currentValue=device[inputIndex];if(currentValue===void 0){throw"Unable to find input ".concat(inputIndex," for device ").concat(DeviceType[deviceType]," in slot ").concat(deviceSlot);}if(inputIndex===PointerInput.Move){Tools.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data.");}return currentValue;}},{key:"isDeviceAvailable",value:function isDeviceAvailable(deviceType){return this._inputs[deviceType]!==void 0;}},{key:"dispose",value:function dispose(){this._onDeviceConnected=function(){};this._onDeviceDisconnected=function(){};this._onInputChanged=function(){};delete this._engine._onEngineViewChanged;if(this._elementToAttachTo){this._disableEvents();}}},{key:"_enableEvents",value:function _enableEvents(){var inputElement=this===null||this===void 0?void 0:this._engine.getInputElement();if(inputElement&&(!this._eventsAttached||this._elementToAttachTo!==inputElement)){this._disableEvents();if(this._inputs){var _iterator27=_createForOfIteratorHelper(this._inputs),_step28;try{for(_iterator27.s();!(_step28=_iterator27.n()).done;){var inputs=_step28.value;if(inputs){for(var deviceSlotKey in inputs){var deviceSlot=+deviceSlotKey;var device=inputs[deviceSlot];if(device){for(var inputIndex=0;inputIndex<device.length;inputIndex++){device[inputIndex]=0;}}}}}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}}this._elementToAttachTo=inputElement;this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex;this._handleKeyActions();this._handlePointerActions();this._handleGamepadActions();this._eventsAttached=true;this._checkForConnectedDevices();}}},{key:"_disableEvents",value:function _disableEvents(){if(this._elementToAttachTo){this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent);this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent);this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent);this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent);this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent);this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent);this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent);this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent);this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent);window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent);window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent);}if(this._pointerInputClearObserver){this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver);}this._eventsAttached=false;}},{key:"_checkForConnectedDevices",value:function _checkForConnectedDevices(){if(navigator.getGamepads){var gamepads=navigator.getGamepads();var _iterator28=_createForOfIteratorHelper(gamepads),_step29;try{for(_iterator28.s();!(_step29=_iterator28.n()).done;){var gamepad=_step29.value;if(gamepad){this._addGamePad(gamepad);}}}catch(err){_iterator28.e(err);}finally{_iterator28.f();}}if(typeof matchMedia==="function"&&matchMedia("(pointer:fine)").matches){this._addPointerDevice(DeviceType.Mouse,0,0,0);}}},{key:"_addGamePad",value:function _addGamePad(gamepad){var deviceType=this._getGamepadDeviceType(gamepad.id);var deviceSlot=gamepad.index;this._gamepads=this._gamepads||new Array(gamepad.index+1);this._registerDevice(deviceType,deviceSlot,gamepad.buttons.length+gamepad.axes.length);this._gamepads[deviceSlot]=deviceType;}},{key:"_addPointerDevice",value:function _addPointerDevice(deviceType,deviceSlot,currentX,currentY){if(!this._pointerActive){this._pointerActive=true;}this._registerDevice(deviceType,deviceSlot,MAX_POINTER_INPUTS);var pointer=this._inputs[deviceType][deviceSlot];pointer[0]=currentX;pointer[1]=currentY;}},{key:"_registerDevice",value:function _registerDevice(deviceType,deviceSlot,numberOfInputs){if(deviceSlot===void 0){throw"Unable to register device ".concat(DeviceType[deviceType]," to undefined slot.");}if(!this._inputs[deviceType]){this._inputs[deviceType]={};}if(!this._inputs[deviceType][deviceSlot]){var device=new Array(numberOfInputs);device.fill(0);this._inputs[deviceType][deviceSlot]=device;this._onDeviceConnected(deviceType,deviceSlot);}}},{key:"_unregisterDevice",value:function _unregisterDevice(deviceType,deviceSlot){if(this._inputs[deviceType][deviceSlot]){delete this._inputs[deviceType][deviceSlot];this._onDeviceDisconnected(deviceType,deviceSlot);}}},{key:"_handleKeyActions",value:function _handleKeyActions(){var _this42=this;this._keyboardDownEvent=function(evt){if(!_this42._keyboardActive){_this42._keyboardActive=true;_this42._registerDevice(DeviceType.Keyboard,0,MAX_KEYCODES);}var kbKey=_this42._inputs[DeviceType.Keyboard][0];if(kbKey){kbKey[evt.keyCode]=1;var deviceEvent=evt;deviceEvent.inputIndex=evt.keyCode;if(_this42._usingMacOS&&evt.metaKey&&evt.key!=="Meta"){if(!_this42._metaKeys.includes(evt.keyCode)){_this42._metaKeys.push(evt.keyCode);}}_this42._onInputChanged(DeviceType.Keyboard,0,deviceEvent);}};this._keyboardUpEvent=function(evt){if(!_this42._keyboardActive){_this42._keyboardActive=true;_this42._registerDevice(DeviceType.Keyboard,0,MAX_KEYCODES);}var kbKey=_this42._inputs[DeviceType.Keyboard][0];if(kbKey){kbKey[evt.keyCode]=0;var deviceEvent=evt;deviceEvent.inputIndex=evt.keyCode;if(_this42._usingMacOS&&evt.key==="Meta"&&_this42._metaKeys.length>0){var _iterator29=_createForOfIteratorHelper(_this42._metaKeys),_step30;try{for(_iterator29.s();!(_step30=_iterator29.n()).done;){var keyCode=_step30.value;var deviceEvent2=DeviceEventFactory.CreateDeviceEvent(DeviceType.Keyboard,0,keyCode,0,_this42,_this42._elementToAttachTo);kbKey[keyCode]=0;_this42._onInputChanged(DeviceType.Keyboard,0,deviceEvent2);}}catch(err){_iterator29.e(err);}finally{_iterator29.f();}_this42._metaKeys.splice(0,_this42._metaKeys.length);}_this42._onInputChanged(DeviceType.Keyboard,0,deviceEvent);}};this._keyboardBlurEvent=function(){if(_this42._keyboardActive){var kbKey=_this42._inputs[DeviceType.Keyboard][0];for(var i=0;i<kbKey.length;i++){if(kbKey[i]!==0){kbKey[i]=0;var deviceEvent=DeviceEventFactory.CreateDeviceEvent(DeviceType.Keyboard,0,i,0,_this42,_this42._elementToAttachTo);_this42._onInputChanged(DeviceType.Keyboard,0,deviceEvent);}}if(_this42._usingMacOS){_this42._metaKeys.splice(0,_this42._metaKeys.length);}}};this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent);this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent);this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent);}},{key:"_handlePointerActions",value:function _handlePointerActions(){var _this43=this;this._maxTouchPoints=DomManagement.IsNavigatorAvailable()&&navigator.maxTouchPoints||2;if(!this._activeTouchIds){this._activeTouchIds=new Array(this._maxTouchPoints);}for(var i=0;i<this._maxTouchPoints;i++){this._activeTouchIds[i]=-1;}this._pointerMoveEvent=function(evt){var deviceType=_this43._getPointerType(evt);var deviceSlot=deviceType===DeviceType.Mouse?0:_this43._activeTouchIds.indexOf(evt.pointerId);if(!_this43._inputs[deviceType]){_this43._inputs[deviceType]={};}if(!_this43._inputs[deviceType][deviceSlot]){_this43._addPointerDevice(deviceType,deviceSlot,evt.clientX,evt.clientY);}var pointer=_this43._inputs[deviceType][deviceSlot];if(pointer){var deviceEvent=evt;deviceEvent.inputIndex=PointerInput.Move;pointer[PointerInput.Horizontal]=evt.clientX;pointer[PointerInput.Vertical]=evt.clientY;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);if(!_this43._usingSafari&&evt.button!==-1){deviceEvent.inputIndex=evt.button+2;pointer[evt.button+2]=pointer[evt.button+2]?0:1;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);}}};this._pointerDownEvent=function(evt){var deviceType=_this43._getPointerType(evt);var deviceSlot=deviceType===DeviceType.Mouse?0:evt.pointerId;if(deviceType===DeviceType.Touch){var idx=_this43._activeTouchIds.indexOf(-1);if(idx>=0){deviceSlot=idx;_this43._activeTouchIds[idx]=evt.pointerId;}else{Tools.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(_this43._maxTouchPoints));return;}}if(!_this43._inputs[deviceType]){_this43._inputs[deviceType]={};}if(!_this43._inputs[deviceType][deviceSlot]){_this43._addPointerDevice(deviceType,deviceSlot,evt.clientX,evt.clientY);}else if(deviceType===DeviceType.Touch){_this43._onDeviceConnected(deviceType,deviceSlot);}var pointer=_this43._inputs[deviceType][deviceSlot];if(pointer){var previousHorizontal=pointer[PointerInput.Horizontal];var previousVertical=pointer[PointerInput.Vertical];if(deviceType===DeviceType.Mouse){if(_this43._mouseId===-1){if(evt.pointerId===void 0){_this43._mouseId=_this43._isUsingFirefox?0:1;}else{_this43._mouseId=evt.pointerId;}}if(!document.pointerLockElement){try{_this43._elementToAttachTo.setPointerCapture(_this43._mouseId);}catch(e){}}}else{if(evt.pointerId&&!document.pointerLockElement){try{_this43._elementToAttachTo.setPointerCapture(evt.pointerId);}catch(e){}}}pointer[PointerInput.Horizontal]=evt.clientX;pointer[PointerInput.Vertical]=evt.clientY;pointer[evt.button+2]=1;var deviceEvent=evt;deviceEvent.inputIndex=evt.button+2;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);if(previousHorizontal!==evt.clientX||previousVertical!==evt.clientY){deviceEvent.inputIndex=PointerInput.Move;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);}}};this._pointerUpEvent=function(evt){var _a,_b,_c,_d,_e;var deviceType=_this43._getPointerType(evt);var deviceSlot=deviceType===DeviceType.Mouse?0:_this43._activeTouchIds.indexOf(evt.pointerId);if(deviceType===DeviceType.Touch){if(deviceSlot===-1){return;}else{_this43._activeTouchIds[deviceSlot]=-1;}}var pointer=(_a=_this43._inputs[deviceType])===null||_a===void 0?void 0:_a[deviceSlot];if(pointer&&pointer[evt.button+2]!==0){var previousHorizontal=pointer[PointerInput.Horizontal];var previousVertical=pointer[PointerInput.Vertical];pointer[PointerInput.Horizontal]=evt.clientX;pointer[PointerInput.Vertical]=evt.clientY;pointer[evt.button+2]=0;var deviceEvent=evt;if(previousHorizontal!==evt.clientX||previousVertical!==evt.clientY){deviceEvent.inputIndex=PointerInput.Move;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);}deviceEvent.inputIndex=evt.button+2;if(deviceType===DeviceType.Mouse&&_this43._mouseId>=0&&((_c=(_b=_this43._elementToAttachTo).hasPointerCapture)===null||_c===void 0?void 0:_c.call(_b,_this43._mouseId))){_this43._elementToAttachTo.releasePointerCapture(_this43._mouseId);}else if(evt.pointerId&&((_e=(_d=_this43._elementToAttachTo).hasPointerCapture)===null||_e===void 0?void 0:_e.call(_d,evt.pointerId))){_this43._elementToAttachTo.releasePointerCapture(evt.pointerId);}_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);if(deviceType===DeviceType.Touch){_this43._onDeviceDisconnected(deviceType,deviceSlot);}}};this._pointerCancelEvent=function(evt){var _a,_b,_c,_d;if(evt.pointerType==="mouse"){var pointer=_this43._inputs[DeviceType.Mouse][0];if(_this43._mouseId>=0&&((_b=(_a=_this43._elementToAttachTo).hasPointerCapture)===null||_b===void 0?void 0:_b.call(_a,_this43._mouseId))){_this43._elementToAttachTo.releasePointerCapture(_this43._mouseId);}for(var inputIndex=PointerInput.LeftClick;inputIndex<=PointerInput.BrowserForward;inputIndex++){if(pointer[inputIndex]===1){pointer[inputIndex]=0;var deviceEvent=DeviceEventFactory.CreateDeviceEvent(DeviceType.Mouse,0,inputIndex,0,_this43,_this43._elementToAttachTo);_this43._onInputChanged(DeviceType.Mouse,0,deviceEvent);}}}else{var deviceSlot=_this43._activeTouchIds.indexOf(evt.pointerId);if((_d=(_c=_this43._elementToAttachTo).hasPointerCapture)===null||_d===void 0?void 0:_d.call(_c,evt.pointerId)){_this43._elementToAttachTo.releasePointerCapture(evt.pointerId);}_this43._inputs[DeviceType.Touch][deviceSlot][PointerInput.LeftClick]=0;var _deviceEvent=DeviceEventFactory.CreateDeviceEvent(DeviceType.Touch,deviceSlot,PointerInput.LeftClick,0,_this43,_this43._elementToAttachTo,evt.pointerId);_this43._onInputChanged(DeviceType.Touch,deviceSlot,_deviceEvent);_this43._activeTouchIds[deviceSlot]=-1;_this43._onDeviceDisconnected(DeviceType.Touch,deviceSlot);}};this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";var passiveSupported=false;var noop=function noop(){};try{var options=Object.defineProperty({},"passive",{get:function get(){passiveSupported=true;}});this._elementToAttachTo.addEventListener("test",noop,options);this._elementToAttachTo.removeEventListener("test",noop,options);}catch(e){}this._pointerBlurEvent=function(){var _a,_b,_c,_d,_e;if(_this43.isDeviceAvailable(DeviceType.Mouse)){var pointer=_this43._inputs[DeviceType.Mouse][0];if(_this43._mouseId>=0&&((_b=(_a=_this43._elementToAttachTo).hasPointerCapture)===null||_b===void 0?void 0:_b.call(_a,_this43._mouseId))){_this43._elementToAttachTo.releasePointerCapture(_this43._mouseId);}for(var inputIndex=PointerInput.LeftClick;inputIndex<=PointerInput.BrowserForward;inputIndex++){if(pointer[inputIndex]===1){pointer[inputIndex]=0;var deviceEvent=DeviceEventFactory.CreateDeviceEvent(DeviceType.Mouse,0,inputIndex,0,_this43,_this43._elementToAttachTo);_this43._onInputChanged(DeviceType.Mouse,0,deviceEvent);}}}if(_this43.isDeviceAvailable(DeviceType.Touch)){var _pointer=_this43._inputs[DeviceType.Touch];for(var deviceSlot=0;deviceSlot<_this43._activeTouchIds.length;deviceSlot++){var pointerId=_this43._activeTouchIds[deviceSlot];if((_d=(_c=_this43._elementToAttachTo).hasPointerCapture)===null||_d===void 0?void 0:_d.call(_c,pointerId)){_this43._elementToAttachTo.releasePointerCapture(pointerId);}if(pointerId!==-1&&((_e=_pointer[deviceSlot])===null||_e===void 0?void 0:_e[PointerInput.LeftClick])===1){_pointer[deviceSlot][PointerInput.LeftClick]=0;var _deviceEvent2=DeviceEventFactory.CreateDeviceEvent(DeviceType.Touch,deviceSlot,PointerInput.LeftClick,0,_this43,_this43._elementToAttachTo,pointerId);_this43._onInputChanged(DeviceType.Touch,deviceSlot,_deviceEvent2);_this43._activeTouchIds[deviceSlot]=-1;_this43._onDeviceDisconnected(DeviceType.Touch,deviceSlot);}}}};this._pointerWheelEvent=function(evt){var deviceType=DeviceType.Mouse;var deviceSlot=0;if(!_this43._inputs[deviceType]){_this43._inputs[deviceType]=[];}if(!_this43._inputs[deviceType][deviceSlot]){_this43._pointerActive=true;_this43._registerDevice(deviceType,deviceSlot,MAX_POINTER_INPUTS);}var pointer=_this43._inputs[deviceType][deviceSlot];if(pointer){pointer[PointerInput.MouseWheelX]=evt.deltaX||0;pointer[PointerInput.MouseWheelY]=evt.deltaY||evt.wheelDelta||0;pointer[PointerInput.MouseWheelZ]=evt.deltaZ||0;var deviceEvent=evt;if(pointer[PointerInput.MouseWheelX]!==0){deviceEvent.inputIndex=PointerInput.MouseWheelX;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);}if(pointer[PointerInput.MouseWheelY]!==0){deviceEvent.inputIndex=PointerInput.MouseWheelY;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);}if(pointer[PointerInput.MouseWheelZ]!==0){deviceEvent.inputIndex=PointerInput.MouseWheelZ;_this43._onInputChanged(deviceType,deviceSlot,deviceEvent);}}};this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent);this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent);this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent);this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent);this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent);this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,passiveSupported?{passive:false}:false);this._pointerInputClearObserver=this._engine.onEndFrameObservable.add(function(){if(_this43.isDeviceAvailable(DeviceType.Mouse)){var pointer=_this43._inputs[DeviceType.Mouse][0];pointer[PointerInput.MouseWheelX]=0;pointer[PointerInput.MouseWheelY]=0;pointer[PointerInput.MouseWheelZ]=0;}});}},{key:"_handleGamepadActions",value:function _handleGamepadActions(){var _this44=this;this._gamepadConnectedEvent=function(evt){_this44._addGamePad(evt.gamepad);};this._gamepadDisconnectedEvent=function(evt){if(_this44._gamepads){var deviceType=_this44._getGamepadDeviceType(evt.gamepad.id);var deviceSlot=evt.gamepad.index;_this44._unregisterDevice(deviceType,deviceSlot);delete _this44._gamepads[deviceSlot];}};window.addEventListener("gamepadconnected",this._gamepadConnectedEvent);window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent);}},{key:"_updateDevice",value:function _updateDevice(deviceType,deviceSlot,inputIndex){var gp=navigator.getGamepads()[deviceSlot];if(gp&&deviceType===this._gamepads[deviceSlot]){var device=this._inputs[deviceType][deviceSlot];if(inputIndex>=gp.buttons.length){device[inputIndex]=gp.axes[inputIndex-gp.buttons.length].valueOf();}else{device[inputIndex]=gp.buttons[inputIndex].value;}}}},{key:"_getGamepadDeviceType",value:function _getGamepadDeviceType(deviceName){if(deviceName.indexOf("054c")!==-1){return deviceName.indexOf("0ce6")!==-1?DeviceType.DualSense:DeviceType.DualShock;}else if(deviceName.indexOf("Xbox One")!==-1||deviceName.search("Xbox 360")!==-1||deviceName.search("xinput")!==-1){return DeviceType.Xbox;}else if(deviceName.indexOf("057e")!==-1){return DeviceType.Switch;}return DeviceType.Generic;}},{key:"_getPointerType",value:function _getPointerType(evt){var deviceType=DeviceType.Mouse;if(evt.pointerType==="touch"||evt.pointerType==="pen"||evt.touches){deviceType=DeviceType.Touch;}return deviceType;}}]);return WebDeviceInputSystem;}();// node_modules/@babylonjs/core/DeviceInput/InputDevices/deviceSource.js
var DeviceSource=/*#__PURE__*/function(){function DeviceSource(deviceInputSystem,deviceType){var deviceSlot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,DeviceSource);this.deviceType=deviceType;this.deviceSlot=deviceSlot;this.onInputChangedObservable=new Observable();this._deviceInputSystem=deviceInputSystem;}_createClass(DeviceSource,[{key:"getInput",value:function getInput(inputIndex){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,inputIndex);}}]);return DeviceSource;}();// node_modules/@babylonjs/core/DeviceInput/internalDeviceSourceManager.js
var InternalDeviceSourceManager=/*#__PURE__*/function(){function InternalDeviceSourceManager(engine){var _this45=this;_classCallCheck(this,InternalDeviceSourceManager);this._registeredManagers=new Array();this._refCount=0;this.registerManager=function(manager){for(var deviceType=0;deviceType<_this45._devices.length;deviceType++){var device=_this45._devices[deviceType];for(var deviceSlotKey in device){var deviceSlot=+deviceSlotKey;manager._addDevice(new DeviceSource(_this45._deviceInputSystem,deviceType,deviceSlot));}}_this45._registeredManagers.push(manager);};this.unregisterManager=function(manager){var idx=_this45._registeredManagers.indexOf(manager);if(idx>-1){_this45._registeredManagers.splice(idx,1);}};var numberOfDeviceTypes=Object.keys(DeviceType).length/2;this._devices=new Array(numberOfDeviceTypes);var onDeviceConnected=function onDeviceConnected(deviceType,deviceSlot){if(!_this45._devices[deviceType]){_this45._devices[deviceType]=new Array();}if(!_this45._devices[deviceType][deviceSlot]){_this45._devices[deviceType][deviceSlot]=deviceSlot;}var _iterator30=_createForOfIteratorHelper(_this45._registeredManagers),_step31;try{for(_iterator30.s();!(_step31=_iterator30.n()).done;){var manager=_step31.value;var deviceSource=new DeviceSource(_this45._deviceInputSystem,deviceType,deviceSlot);manager._addDevice(deviceSource);}}catch(err){_iterator30.e(err);}finally{_iterator30.f();}};var onDeviceDisconnected=function onDeviceDisconnected(deviceType,deviceSlot){var _a;if((_a=_this45._devices[deviceType])===null||_a===void 0?void 0:_a[deviceSlot]){delete _this45._devices[deviceType][deviceSlot];}var _iterator31=_createForOfIteratorHelper(_this45._registeredManagers),_step32;try{for(_iterator31.s();!(_step32=_iterator31.n()).done;){var manager=_step32.value;manager._removeDevice(deviceType,deviceSlot);}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}};var onInputChanged=function onInputChanged(deviceType,deviceSlot,eventData){if(eventData){var _iterator32=_createForOfIteratorHelper(_this45._registeredManagers),_step33;try{for(_iterator32.s();!(_step33=_iterator32.n()).done;){var manager=_step33.value;manager._onInputChanged(deviceType,deviceSlot,eventData);}}catch(err){_iterator32.e(err);}finally{_iterator32.f();}}};if(typeof _native!=="undefined"){this._deviceInputSystem=new NativeDeviceInputSystem(onDeviceConnected,onDeviceDisconnected,onInputChanged);}else{this._deviceInputSystem=new WebDeviceInputSystem(engine,onDeviceConnected,onDeviceDisconnected,onInputChanged);}}_createClass(InternalDeviceSourceManager,[{key:"dispose",value:function dispose(){this._deviceInputSystem.dispose();}}]);return InternalDeviceSourceManager;}();// node_modules/@babylonjs/core/DeviceInput/InputDevices/deviceSourceManager.js
var DeviceSourceManager=/*#__PURE__*/function(){function DeviceSourceManager(engine){var _this46=this;_classCallCheck(this,DeviceSourceManager);var numberOfDeviceTypes=Object.keys(DeviceType).length/2;this._devices=new Array(numberOfDeviceTypes);this._firstDevice=new Array(numberOfDeviceTypes);this._engine=engine;if(!this._engine._deviceSourceManager){this._engine._deviceSourceManager=new InternalDeviceSourceManager(engine);}this._engine._deviceSourceManager._refCount++;this.onDeviceConnectedObservable=new Observable(function(observer){var _iterator33=_createForOfIteratorHelper(_this46._devices),_step34;try{for(_iterator33.s();!(_step34=_iterator33.n()).done;){var devices=_step34.value;if(devices){var _iterator34=_createForOfIteratorHelper(devices),_step35;try{for(_iterator34.s();!(_step35=_iterator34.n()).done;){var device=_step35.value;if(device){_this46.onDeviceConnectedObservable.notifyObserver(observer,device);}}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}}}}catch(err){_iterator33.e(err);}finally{_iterator33.f();}});this.onDeviceDisconnectedObservable=new Observable();this._engine._deviceSourceManager.registerManager(this);this._onDisposeObserver=engine.onDisposeObservable.add(function(){_this46.dispose();});}_createClass(DeviceSourceManager,[{key:"getDeviceSource",value:function getDeviceSource(deviceType,deviceSlot){if(deviceSlot===void 0){if(this._firstDevice[deviceType]===void 0){return null;}deviceSlot=this._firstDevice[deviceType];}if(!this._devices[deviceType]||this._devices[deviceType][deviceSlot]===void 0){return null;}return this._devices[deviceType][deviceSlot];}},{key:"getDeviceSources",value:function getDeviceSources(deviceType){if(!this._devices[deviceType]){return[];}return this._devices[deviceType].filter(function(source){return!!source;});}},{key:"dispose",value:function dispose(){this.onDeviceConnectedObservable.clear();this.onDeviceDisconnectedObservable.clear();if(this._engine._deviceSourceManager){this._engine._deviceSourceManager.unregisterManager(this);if(--this._engine._deviceSourceManager._refCount<1){this._engine._deviceSourceManager.dispose();delete this._engine._deviceSourceManager;}}this._engine.onDisposeObservable.remove(this._onDisposeObserver);}},{key:"_addDevice",value:function _addDevice(deviceSource){if(!this._devices[deviceSource.deviceType]){this._devices[deviceSource.deviceType]=new Array();}if(!this._devices[deviceSource.deviceType][deviceSource.deviceSlot]){this._devices[deviceSource.deviceType][deviceSource.deviceSlot]=deviceSource;this._updateFirstDevices(deviceSource.deviceType);}this.onDeviceConnectedObservable.notifyObservers(deviceSource);}},{key:"_removeDevice",value:function _removeDevice(deviceType,deviceSlot){var _a,_b;var deviceSource=(_a=this._devices[deviceType])===null||_a===void 0?void 0:_a[deviceSlot];this.onDeviceDisconnectedObservable.notifyObservers(deviceSource);if((_b=this._devices[deviceType])===null||_b===void 0?void 0:_b[deviceSlot]){delete this._devices[deviceType][deviceSlot];}this._updateFirstDevices(deviceType);}},{key:"_onInputChanged",value:function _onInputChanged(deviceType,deviceSlot,eventData){var _a,_b;(_b=(_a=this._devices[deviceType])===null||_a===void 0?void 0:_a[deviceSlot])===null||_b===void 0?void 0:_b.onInputChangedObservable.notifyObservers(eventData);}},{key:"_updateFirstDevices",value:function _updateFirstDevices(type){switch(type){case DeviceType.Keyboard:case DeviceType.Mouse:this._firstDevice[type]=0;break;case DeviceType.Touch:case DeviceType.DualSense:case DeviceType.DualShock:case DeviceType.Xbox:case DeviceType.Switch:case DeviceType.Generic:{delete this._firstDevice[type];var devices=this._devices[type];if(devices){for(var i=0;i<devices.length;i++){if(devices[i]){this._firstDevice[type]=i;break;}}}break;}}}}]);return DeviceSourceManager;}();// node_modules/@babylonjs/core/Inputs/scene.inputManager.js
var _ClickInfo=/*#__PURE__*/function(){function _ClickInfo(){_classCallCheck(this,_ClickInfo);this._singleClick=false;this._doubleClick=false;this._hasSwiped=false;this._ignore=false;}_createClass(_ClickInfo,[{key:"singleClick",get:function get(){return this._singleClick;},set:function set(b){this._singleClick=b;}},{key:"doubleClick",get:function get(){return this._doubleClick;},set:function set(b){this._doubleClick=b;}},{key:"hasSwiped",get:function get(){return this._hasSwiped;},set:function set(b){this._hasSwiped=b;}},{key:"ignore",get:function get(){return this._ignore;},set:function set(b){this._ignore=b;}}]);return _ClickInfo;}();var InputManager=/*#__PURE__*/function(){function InputManager(scene2){_classCallCheck(this,InputManager);this._alreadyAttached=false;this._meshPickProceed=false;this._currentPickResult=null;this._previousPickResult=null;this._totalPointersPressed=0;this._doubleClickOccured=false;this._isSwiping=false;this._swipeButtonPressed=-1;this._skipPointerTap=false;this._isMultiTouchGesture=false;this._pointerX=0;this._pointerY=0;this._startingPointerPosition=new Vector2(0,0);this._previousStartingPointerPosition=new Vector2(0,0);this._startingPointerTime=0;this._previousStartingPointerTime=0;this._pointerCaptures={};this._meshUnderPointerId={};this._movePointerInfo=null;this._cameraObserverCount=0;this._deviceSourceManager=null;this._scene=scene2||EngineStore.LastCreatedScene;if(!this._scene){return;}}_createClass(InputManager,[{key:"meshUnderPointer",get:function get(){if(this._movePointerInfo){this._movePointerInfo._generatePickInfo();this._movePointerInfo=null;}return this._pointerOverMesh;}},{key:"getMeshUnderPointerByPointerId",value:function getMeshUnderPointerByPointerId(pointerId){return this._meshUnderPointerId[pointerId]||null;}},{key:"unTranslatedPointer",get:function get(){return new Vector2(this._unTranslatedPointerX,this._unTranslatedPointerY);}},{key:"pointerX",get:function get(){return this._pointerX;},set:function set(value){this._pointerX=value;}},{key:"pointerY",get:function get(){return this._pointerY;},set:function set(value){this._pointerY=value;}},{key:"_updatePointerPosition",value:function _updatePointerPosition(evt){var canvasRect=this._scene.getEngine().getInputElementClientRect();if(!canvasRect){return;}this._pointerX=evt.clientX-canvasRect.left;this._pointerY=evt.clientY-canvasRect.top;this._unTranslatedPointerX=this._pointerX;this._unTranslatedPointerY=this._pointerY;}},{key:"_processPointerMove",value:function _processPointerMove(pickResult,evt){var scene2=this._scene;var engine=scene2.getEngine();var canvas=engine.getInputElement();if(canvas){canvas.tabIndex=engine.canvasTabIndex;if(!scene2.doNotHandleCursors){canvas.style.cursor=scene2.defaultCursor;}}this._setCursorAndPointerOverMesh(pickResult,evt,scene2);var _iterator35=_createForOfIteratorHelper(scene2._pointerMoveStage),_step36;try{for(_iterator35.s();!(_step36=_iterator35.n()).done;){var step=_step36.value;var isMeshPicked=(pickResult===null||pickResult===void 0?void 0:pickResult.pickedMesh)?true:false;pickResult=step.action(this._unTranslatedPointerX,this._unTranslatedPointerY,pickResult,isMeshPicked,canvas);}}catch(err){_iterator35.e(err);}finally{_iterator35.f();}var type=evt.inputIndex>=PointerInput.MouseWheelX&&evt.inputIndex<=PointerInput.MouseWheelZ?PointerEventTypes.POINTERWHEEL:PointerEventTypes.POINTERMOVE;if(scene2.onPointerMove){pickResult=pickResult||this._pickMove(evt);scene2.onPointerMove(evt,pickResult,type);}var pointerInfo;if(pickResult){pointerInfo=new PointerInfo(type,evt,pickResult);this._setRayOnPointerInfo(pickResult,evt);}else{pointerInfo=new PointerInfo(type,evt,null,this);this._movePointerInfo=pointerInfo;}if(scene2.onPointerObservable.hasObservers()){scene2.onPointerObservable.notifyObservers(pointerInfo,type);}}},{key:"_setRayOnPointerInfo",value:function _setRayOnPointerInfo(pickInfo,event){var scene2=this._scene;if(pickInfo&&scene2._pickingAvailable){if(!pickInfo.ray){pickInfo.ray=scene2.createPickingRay(event.offsetX,event.offsetY,Matrix.Identity(),scene2.activeCamera);}}}},{key:"_addCameraPointerObserver",value:function _addCameraPointerObserver(observer,mask){this._cameraObserverCount++;return this._scene.onPointerObservable.add(observer,mask);}},{key:"_removeCameraPointerObserver",value:function _removeCameraPointerObserver(observer){this._cameraObserverCount--;return this._scene.onPointerObservable.remove(observer);}},{key:"_checkForPicking",value:function _checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick);}},{key:"_checkPrePointerObservable",value:function _checkPrePointerObservable(pickResult,evt,type){var scene2=this._scene;var pi=new PointerInfoPre(type,evt,this._unTranslatedPointerX,this._unTranslatedPointerY);if(pickResult){pi.originalPickingInfo=pickResult;pi.ray=pickResult.ray;if(pickResult.originMesh){pi.nearInteractionPickingInfo=pickResult;}}scene2.onPrePointerObservable.notifyObservers(pi,type);if(pi.skipOnPointerObservable){return true;}else{return false;}}},{key:"_pickMove",value:function _pickMove(evt){var scene2=this._scene;var pickResult=scene2.pick(this._unTranslatedPointerX,this._unTranslatedPointerY,scene2.pointerMovePredicate,false,scene2.cameraToUseForPointers,scene2.pointerMoveTrianglePredicate);this._setCursorAndPointerOverMesh(pickResult,evt,scene2);return pickResult;}},{key:"_setCursorAndPointerOverMesh",value:function _setCursorAndPointerOverMesh(pickResult,evt,scene2){var engine=scene2.getEngine();var canvas=engine.getInputElement();if(pickResult===null||pickResult===void 0?void 0:pickResult.pickedMesh){this.setPointerOverMesh(pickResult.pickedMesh,evt.pointerId,pickResult,evt);if(!scene2.doNotHandleCursors&&canvas&&this._pointerOverMesh){var actionManager=this._pointerOverMesh._getActionManagerForTrigger();if(actionManager&&actionManager.hasPointerTriggers){canvas.style.cursor=actionManager.hoverCursor||scene2.hoverCursor;}}}else{this.setPointerOverMesh(null,evt.pointerId,pickResult,evt);}}},{key:"simulatePointerMove",value:function simulatePointerMove(pickResult,pointerEventInit){var evt=new PointerEvent("pointermove",pointerEventInit);evt.inputIndex=PointerInput.Move;if(this._checkPrePointerObservable(pickResult,evt,PointerEventTypes.POINTERMOVE)){return;}this._processPointerMove(pickResult,evt);}},{key:"simulatePointerDown",value:function simulatePointerDown(pickResult,pointerEventInit){var evt=new PointerEvent("pointerdown",pointerEventInit);evt.inputIndex=evt.button+2;if(this._checkPrePointerObservable(pickResult,evt,PointerEventTypes.POINTERDOWN)){return;}this._processPointerDown(pickResult,evt);}},{key:"_processPointerDown",value:function _processPointerDown(pickResult,evt){var _this47=this;var scene2=this._scene;if(pickResult===null||pickResult===void 0?void 0:pickResult.pickedMesh){this._pickedDownMesh=pickResult.pickedMesh;var actionManager=pickResult.pickedMesh._getActionManagerForTrigger();if(actionManager){if(actionManager.hasPickTriggers){actionManager.processTrigger(5,ActionEvent.CreateNew(pickResult.pickedMesh,evt));switch(evt.button){case 0:actionManager.processTrigger(2,ActionEvent.CreateNew(pickResult.pickedMesh,evt));break;case 1:actionManager.processTrigger(4,ActionEvent.CreateNew(pickResult.pickedMesh,evt));break;case 2:actionManager.processTrigger(3,ActionEvent.CreateNew(pickResult.pickedMesh,evt));break;}}if(actionManager.hasSpecificTrigger(8)){window.setTimeout(function(){var pickResult2=scene2.pick(_this47._unTranslatedPointerX,_this47._unTranslatedPointerY,function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.actionManager&&mesh.actionManager.hasSpecificTrigger(8)&&mesh===_this47._pickedDownMesh;},false,scene2.cameraToUseForPointers);if((pickResult2===null||pickResult2===void 0?void 0:pickResult2.pickedMesh)&&actionManager){if(_this47._totalPointersPressed!==0&&Date.now()-_this47._startingPointerTime>InputManager.LongPressDelay&&!_this47._isPointerSwiping()){_this47._startingPointerTime=0;actionManager.processTrigger(8,ActionEvent.CreateNew(pickResult2.pickedMesh,evt));}}},InputManager.LongPressDelay);}}}else{var _iterator36=_createForOfIteratorHelper(scene2._pointerDownStage),_step37;try{for(_iterator36.s();!(_step37=_iterator36.n()).done;){var step=_step37.value;pickResult=step.action(this._unTranslatedPointerX,this._unTranslatedPointerY,pickResult,evt,false);}}catch(err){_iterator36.e(err);}finally{_iterator36.f();}}var pointerInfo;var type=PointerEventTypes.POINTERDOWN;if(pickResult){if(scene2.onPointerDown){scene2.onPointerDown(evt,pickResult,type);}pointerInfo=new PointerInfo(type,evt,pickResult);this._setRayOnPointerInfo(pickResult,evt);}else{pointerInfo=new PointerInfo(type,evt,null,this);}if(scene2.onPointerObservable.hasObservers()){scene2.onPointerObservable.notifyObservers(pointerInfo,type);}}},{key:"_isPointerSwiping",value:function _isPointerSwiping(){return this._isSwiping;}},{key:"simulatePointerUp",value:function simulatePointerUp(pickResult,pointerEventInit,doubleTap){var evt=new PointerEvent("pointerup",pointerEventInit);evt.inputIndex=PointerInput.Move;var clickInfo=new _ClickInfo();if(doubleTap){clickInfo.doubleClick=true;}else{clickInfo.singleClick=true;}if(this._checkPrePointerObservable(pickResult,evt,PointerEventTypes.POINTERUP)){return;}this._processPointerUp(pickResult,evt,clickInfo);}},{key:"_processPointerUp",value:function _processPointerUp(pickResult,evt,clickInfo){var scene2=this._scene;if(pickResult===null||pickResult===void 0?void 0:pickResult.pickedMesh){this._pickedUpMesh=pickResult.pickedMesh;if(this._pickedDownMesh===this._pickedUpMesh){if(scene2.onPointerPick){scene2.onPointerPick(evt,pickResult);}if(clickInfo.singleClick&&!clickInfo.ignore&&scene2.onPointerObservable.observers.length>this._cameraObserverCount){var type=PointerEventTypes.POINTERPICK;var pi=new PointerInfo(type,evt,pickResult);this._setRayOnPointerInfo(pickResult,evt);scene2.onPointerObservable.notifyObservers(pi,type);}}var actionManager=pickResult.pickedMesh._getActionManagerForTrigger();if(actionManager&&!clickInfo.ignore){actionManager.processTrigger(7,ActionEvent.CreateNew(pickResult.pickedMesh,evt,pickResult));if(!clickInfo.hasSwiped&&clickInfo.singleClick){actionManager.processTrigger(1,ActionEvent.CreateNew(pickResult.pickedMesh,evt,pickResult));}var doubleClickActionManager=pickResult.pickedMesh._getActionManagerForTrigger(6);if(clickInfo.doubleClick&&doubleClickActionManager){doubleClickActionManager.processTrigger(6,ActionEvent.CreateNew(pickResult.pickedMesh,evt,pickResult));}}}else{if(!clickInfo.ignore){var _iterator37=_createForOfIteratorHelper(scene2._pointerUpStage),_step38;try{for(_iterator37.s();!(_step38=_iterator37.n()).done;){var step=_step38.value;pickResult=step.action(this._unTranslatedPointerX,this._unTranslatedPointerY,pickResult,evt,clickInfo.doubleClick);}}catch(err){_iterator37.e(err);}finally{_iterator37.f();}}}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var pickedDownActionManager=this._pickedDownMesh._getActionManagerForTrigger(16);if(pickedDownActionManager){pickedDownActionManager.processTrigger(16,ActionEvent.CreateNew(this._pickedDownMesh,evt));}}if(!clickInfo.ignore){var _pi=new PointerInfo(PointerEventTypes.POINTERUP,evt,pickResult);this._setRayOnPointerInfo(pickResult,evt);scene2.onPointerObservable.notifyObservers(_pi,PointerEventTypes.POINTERUP);if(scene2.onPointerUp){scene2.onPointerUp(evt,pickResult,PointerEventTypes.POINTERUP);}if(!clickInfo.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){var _type=0;if(clickInfo.singleClick){_type=PointerEventTypes.POINTERTAP;}else if(clickInfo.doubleClick){_type=PointerEventTypes.POINTERDOUBLETAP;}if(_type){var pi2=new PointerInfo(_type,evt,pickResult);if(scene2.onPointerObservable.hasObservers()&&scene2.onPointerObservable.hasSpecificMask(_type)){scene2.onPointerObservable.notifyObservers(pi2,_type);}}}}}},{key:"isPointerCaptured",value:function isPointerCaptured(){var pointerId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return this._pointerCaptures[pointerId];}},{key:"attachControl",value:function attachControl(){var _this48=this;var attachUp=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var attachDown=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var attachMove=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var elementToAttachTo=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var scene2=this._scene;var engine=scene2.getEngine();if(!elementToAttachTo){elementToAttachTo=engine.getInputElement();}if(this._alreadyAttached){this.detachControl();}if(elementToAttachTo){this._alreadyAttachedTo=elementToAttachTo;}this._deviceSourceManager=new DeviceSourceManager(engine);this._initActionManager=function(act){if(!_this48._meshPickProceed){var pickResult=scene2.skipPointerUpPicking||scene2._registeredActions===0&&!_this48._checkForPicking()&&!scene2.onPointerUp?null:scene2.pick(_this48._unTranslatedPointerX,_this48._unTranslatedPointerY,scene2.pointerUpPredicate,false,scene2.cameraToUseForPointers);_this48._currentPickResult=pickResult;if(pickResult){act=pickResult.hit&&pickResult.pickedMesh?pickResult.pickedMesh._getActionManagerForTrigger():null;}_this48._meshPickProceed=true;}return act;};this._delayedSimpleClick=function(btn,clickInfo,cb){if(Date.now()-_this48._previousStartingPointerTime>InputManager.DoubleClickDelay&&!_this48._doubleClickOccured||btn!==_this48._previousButtonPressed){_this48._doubleClickOccured=false;clickInfo.singleClick=true;clickInfo.ignore=false;cb(clickInfo,_this48._currentPickResult);}};this._initClickEvent=function(obs1,obs2,evt,cb){var clickInfo=new _ClickInfo();_this48._currentPickResult=null;var act=null;var checkPicking=obs1.hasSpecificMask(PointerEventTypes.POINTERPICK)||obs2.hasSpecificMask(PointerEventTypes.POINTERPICK)||obs1.hasSpecificMask(PointerEventTypes.POINTERTAP)||obs2.hasSpecificMask(PointerEventTypes.POINTERTAP)||obs1.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)||obs2.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);if(!checkPicking&&AbstractActionManager){act=_this48._initActionManager(act,clickInfo);if(act){checkPicking=act.hasPickTriggers;}}var needToIgnoreNext=false;if(checkPicking){var btn=evt.button;clickInfo.hasSwiped=_this48._isPointerSwiping();if(!clickInfo.hasSwiped){var checkSingleClickImmediately=!InputManager.ExclusiveDoubleClickMode;if(!checkSingleClickImmediately){checkSingleClickImmediately=!obs1.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)&&!obs2.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);if(checkSingleClickImmediately&&!AbstractActionManager.HasSpecificTrigger(6)){act=_this48._initActionManager(act,clickInfo);if(act){checkSingleClickImmediately=!act.hasSpecificTrigger(6);}}}if(checkSingleClickImmediately){if(Date.now()-_this48._previousStartingPointerTime>InputManager.DoubleClickDelay||btn!==_this48._previousButtonPressed){clickInfo.singleClick=true;cb(clickInfo,_this48._currentPickResult);needToIgnoreNext=true;}}else{_this48._previousDelayedSimpleClickTimeout=_this48._delayedSimpleClickTimeout;_this48._delayedSimpleClickTimeout=window.setTimeout(_this48._delayedSimpleClick.bind(_this48,btn,clickInfo,cb),InputManager.DoubleClickDelay);}var checkDoubleClick=obs1.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)||obs2.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP);if(!checkDoubleClick&&AbstractActionManager.HasSpecificTrigger(6)){act=_this48._initActionManager(act,clickInfo);if(act){checkDoubleClick=act.hasSpecificTrigger(6);}}if(checkDoubleClick){if(btn===_this48._previousButtonPressed&&Date.now()-_this48._previousStartingPointerTime<InputManager.DoubleClickDelay&&!_this48._doubleClickOccured){if(!clickInfo.hasSwiped&&!_this48._isPointerSwiping()){_this48._previousStartingPointerTime=0;_this48._doubleClickOccured=true;clickInfo.doubleClick=true;clickInfo.ignore=false;if(InputManager.ExclusiveDoubleClickMode&&_this48._previousDelayedSimpleClickTimeout){clearTimeout(_this48._previousDelayedSimpleClickTimeout);}_this48._previousDelayedSimpleClickTimeout=_this48._delayedSimpleClickTimeout;cb(clickInfo,_this48._currentPickResult);}else{_this48._doubleClickOccured=false;_this48._previousStartingPointerTime=_this48._startingPointerTime;_this48._previousStartingPointerPosition.x=_this48._startingPointerPosition.x;_this48._previousStartingPointerPosition.y=_this48._startingPointerPosition.y;_this48._previousButtonPressed=btn;if(InputManager.ExclusiveDoubleClickMode){if(_this48._previousDelayedSimpleClickTimeout){clearTimeout(_this48._previousDelayedSimpleClickTimeout);}_this48._previousDelayedSimpleClickTimeout=_this48._delayedSimpleClickTimeout;cb(clickInfo,_this48._previousPickResult);}else{cb(clickInfo,_this48._currentPickResult);}}needToIgnoreNext=true;}else{_this48._doubleClickOccured=false;_this48._previousStartingPointerTime=_this48._startingPointerTime;_this48._previousStartingPointerPosition.x=_this48._startingPointerPosition.x;_this48._previousStartingPointerPosition.y=_this48._startingPointerPosition.y;_this48._previousButtonPressed=btn;}}}}if(!needToIgnoreNext){cb(clickInfo,_this48._currentPickResult);}};this._onPointerMove=function(evt){if(evt.pointerId===void 0){evt.pointerId=0;}_this48._updatePointerPosition(evt);if(!_this48._isSwiping&&_this48._swipeButtonPressed!==-1){_this48._isSwiping=Math.abs(_this48._startingPointerPosition.x-_this48._pointerX)>InputManager.DragMovementThreshold||Math.abs(_this48._startingPointerPosition.y-_this48._pointerY)>InputManager.DragMovementThreshold;}if(_this48._checkPrePointerObservable(null,evt,evt.inputIndex>=PointerInput.MouseWheelX&&evt.inputIndex<=PointerInput.MouseWheelZ?PointerEventTypes.POINTERWHEEL:PointerEventTypes.POINTERMOVE)){return;}if(!scene2.cameraToUseForPointers&&!scene2.activeCamera){return;}if(scene2.skipPointerMovePicking){_this48._processPointerMove(new PickingInfo(),evt);return;}if(!scene2.pointerMovePredicate){scene2.pointerMovePredicate=function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.isEnabled()&&(mesh.enablePointerMoveEvents||scene2.constantlyUpdateMeshUnderPointer||mesh._getActionManagerForTrigger()!==null)&&(!scene2.cameraToUseForPointers||(scene2.cameraToUseForPointers.layerMask&mesh.layerMask)!==0);};}var pickResult=scene2._registeredActions>0?_this48._pickMove(evt):null;_this48._processPointerMove(pickResult,evt);};this._onPointerDown=function(evt){_this48._totalPointersPressed++;_this48._pickedDownMesh=null;_this48._meshPickProceed=false;if(evt.pointerId===void 0){evt.pointerId=0;}_this48._updatePointerPosition(evt);if(_this48._swipeButtonPressed===-1){_this48._swipeButtonPressed=evt.button;}if(scene2.preventDefaultOnPointerDown&&elementToAttachTo){evt.preventDefault();elementToAttachTo.focus();}_this48._startingPointerPosition.x=_this48._pointerX;_this48._startingPointerPosition.y=_this48._pointerY;_this48._startingPointerTime=Date.now();if(_this48._checkPrePointerObservable(null,evt,PointerEventTypes.POINTERDOWN)){return;}if(!scene2.cameraToUseForPointers&&!scene2.activeCamera){return;}_this48._pointerCaptures[evt.pointerId]=true;if(!scene2.pointerDownPredicate){scene2.pointerDownPredicate=function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.isEnabled()&&(!scene2.cameraToUseForPointers||(scene2.cameraToUseForPointers.layerMask&mesh.layerMask)!==0);};}_this48._pickedDownMesh=null;var pickResult;if(scene2.skipPointerDownPicking||scene2._registeredActions===0&&!_this48._checkForPicking()&&!scene2.onPointerDown){pickResult=new PickingInfo();}else{pickResult=scene2.pick(_this48._unTranslatedPointerX,_this48._unTranslatedPointerY,scene2.pointerDownPredicate,false,scene2.cameraToUseForPointers);}_this48._processPointerDown(pickResult,evt);};this._onPointerUp=function(evt){if(_this48._totalPointersPressed===0){return;}_this48._totalPointersPressed--;_this48._pickedUpMesh=null;_this48._meshPickProceed=false;if(evt.pointerId===void 0){evt.pointerId=0;}_this48._updatePointerPosition(evt);if(scene2.preventDefaultOnPointerUp&&elementToAttachTo){evt.preventDefault();elementToAttachTo.focus();}_this48._initClickEvent(scene2.onPrePointerObservable,scene2.onPointerObservable,evt,function(clickInfo,pickResult){if(scene2.onPrePointerObservable.hasObservers()){_this48._skipPointerTap=false;if(!clickInfo.ignore){if(_this48._checkPrePointerObservable(null,evt,PointerEventTypes.POINTERUP)){if(_this48._swipeButtonPressed===evt.button){_this48._isSwiping=false;_this48._swipeButtonPressed=-1;}return;}if(!clickInfo.hasSwiped){if(clickInfo.singleClick&&scene2.onPrePointerObservable.hasSpecificMask(PointerEventTypes.POINTERTAP)){if(_this48._checkPrePointerObservable(null,evt,PointerEventTypes.POINTERTAP)){_this48._skipPointerTap=true;}}if(clickInfo.doubleClick&&scene2.onPrePointerObservable.hasSpecificMask(PointerEventTypes.POINTERDOUBLETAP)){if(_this48._checkPrePointerObservable(null,evt,PointerEventTypes.POINTERDOUBLETAP)){_this48._skipPointerTap=true;}}}}}if(!_this48._pointerCaptures[evt.pointerId]){if(_this48._swipeButtonPressed===evt.button){_this48._isSwiping=false;_this48._swipeButtonPressed=-1;}return;}if(evt.buttons===0){_this48._pointerCaptures[evt.pointerId]=false;}if(!scene2.cameraToUseForPointers&&!scene2.activeCamera){return;}if(!scene2.pointerUpPredicate){scene2.pointerUpPredicate=function(mesh){return mesh.isPickable&&mesh.isVisible&&mesh.isReady()&&mesh.isEnabled()&&(!scene2.cameraToUseForPointers||(scene2.cameraToUseForPointers.layerMask&mesh.layerMask)!==0);};}if(!_this48._meshPickProceed&&(AbstractActionManager&&AbstractActionManager.HasTriggers||_this48._checkForPicking()||scene2.onPointerUp)){_this48._initActionManager(null,clickInfo);}if(!pickResult){pickResult=_this48._currentPickResult;}_this48._processPointerUp(pickResult,evt,clickInfo);_this48._previousPickResult=_this48._currentPickResult;if(_this48._swipeButtonPressed===evt.button){_this48._isSwiping=false;_this48._swipeButtonPressed=-1;}});};this._onKeyDown=function(evt){var type=KeyboardEventTypes.KEYDOWN;if(scene2.onPreKeyboardObservable.hasObservers()){var pi=new KeyboardInfoPre(type,evt);scene2.onPreKeyboardObservable.notifyObservers(pi,type);if(pi.skipOnKeyboardObservable){return;}}if(scene2.onKeyboardObservable.hasObservers()){var _pi2=new KeyboardInfo(type,evt);scene2.onKeyboardObservable.notifyObservers(_pi2,type);}if(scene2.actionManager){scene2.actionManager.processTrigger(14,ActionEvent.CreateNewFromScene(scene2,evt));}};this._onKeyUp=function(evt){var type=KeyboardEventTypes.KEYUP;if(scene2.onPreKeyboardObservable.hasObservers()){var pi=new KeyboardInfoPre(type,evt);scene2.onPreKeyboardObservable.notifyObservers(pi,type);if(pi.skipOnKeyboardObservable){return;}}if(scene2.onKeyboardObservable.hasObservers()){var _pi3=new KeyboardInfo(type,evt);scene2.onKeyboardObservable.notifyObservers(_pi3,type);}if(scene2.actionManager){scene2.actionManager.processTrigger(15,ActionEvent.CreateNewFromScene(scene2,evt));}};this._deviceSourceManager.onDeviceConnectedObservable.add(function(deviceSource){if(deviceSource.deviceType===DeviceType.Mouse){deviceSource.onInputChangedObservable.add(function(eventData){if(eventData.inputIndex===PointerInput.LeftClick||eventData.inputIndex===PointerInput.MiddleClick||eventData.inputIndex===PointerInput.RightClick||eventData.inputIndex===PointerInput.BrowserBack||eventData.inputIndex===PointerInput.BrowserForward){if(attachDown&&deviceSource.getInput(eventData.inputIndex)===1){_this48._onPointerDown(eventData);}else if(attachUp&&deviceSource.getInput(eventData.inputIndex)===0){_this48._onPointerUp(eventData);}}else if(attachMove){if(eventData.inputIndex===PointerInput.Move){_this48._onPointerMove(eventData);}else if(eventData.inputIndex===PointerInput.MouseWheelX||eventData.inputIndex===PointerInput.MouseWheelY||eventData.inputIndex===PointerInput.MouseWheelZ){_this48._onPointerMove(eventData);}}});}else if(deviceSource.deviceType===DeviceType.Touch){deviceSource.onInputChangedObservable.add(function(eventData){if(eventData.inputIndex===PointerInput.LeftClick){if(attachDown&&deviceSource.getInput(eventData.inputIndex)===1){_this48._onPointerDown(eventData);if(_this48._totalPointersPressed>1){_this48._isMultiTouchGesture=true;}}else if(attachUp&&deviceSource.getInput(eventData.inputIndex)===0){_this48._onPointerUp(eventData);if(_this48._totalPointersPressed===0){_this48._isMultiTouchGesture=false;}}}if(attachMove&&eventData.inputIndex===PointerInput.Move){_this48._onPointerMove(eventData);}});}else if(deviceSource.deviceType===DeviceType.Keyboard){deviceSource.onInputChangedObservable.add(function(eventData){if(eventData.type==="keydown"){_this48._onKeyDown(eventData);}else if(eventData.type==="keyup"){_this48._onKeyUp(eventData);}});}});this._alreadyAttached=true;}},{key:"detachControl",value:function detachControl(){if(this._alreadyAttached){this._deviceSourceManager.dispose();this._deviceSourceManager=null;if(this._alreadyAttachedTo&&!this._scene.doNotHandleCursors){this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor;}this._alreadyAttached=false;this._alreadyAttachedTo=null;}}},{key:"setPointerOverMesh",value:function setPointerOverMesh(mesh){var pointerId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var pickResult=arguments.length>2?arguments[2]:undefined;var evt=arguments.length>3?arguments[3]:undefined;if(this._meshUnderPointerId[pointerId]===mesh&&(!mesh||!mesh._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting)){return;}var underPointerMesh=this._meshUnderPointerId[pointerId];var actionManager;if(underPointerMesh){actionManager=underPointerMesh._getActionManagerForTrigger(10);if(actionManager){actionManager.processTrigger(10,ActionEvent.CreateNew(underPointerMesh,evt,{pointerId:pointerId}));}}if(mesh){this._meshUnderPointerId[pointerId]=mesh;this._pointerOverMesh=mesh;actionManager=mesh._getActionManagerForTrigger(9);if(actionManager){actionManager.processTrigger(9,ActionEvent.CreateNew(mesh,evt,{pointerId:pointerId,pickResult:pickResult}));}}else{delete this._meshUnderPointerId[pointerId];this._pointerOverMesh=null;}}},{key:"getPointerOverMesh",value:function getPointerOverMesh(){return this.meshUnderPointer;}},{key:"_invalidateMesh",value:function _invalidateMesh(mesh){if(this._pointerOverMesh===mesh){this._pointerOverMesh=null;}if(this._pickedDownMesh===mesh){this._pickedDownMesh=null;}if(this._pickedUpMesh===mesh){this._pickedUpMesh=null;}for(var pointerId in this._meshUnderPointerId){if(this._meshUnderPointerId[pointerId]===mesh){delete this._meshUnderPointerId[pointerId];}}}}]);return InputManager;}();InputManager.DragMovementThreshold=10;InputManager.LongPressDelay=500;InputManager.DoubleClickDelay=300;InputManager.ExclusiveDoubleClickMode=false;// node_modules/@babylonjs/core/Misc/perfCounter.js
var PerfCounter=/*#__PURE__*/function(){function PerfCounter(){_classCallCheck(this,PerfCounter);this._startMonitoringTime=0;this._min=0;this._max=0;this._average=0;this._lastSecAverage=0;this._current=0;this._totalValueCount=0;this._totalAccumulated=0;this._lastSecAccumulated=0;this._lastSecTime=0;this._lastSecValueCount=0;}_createClass(PerfCounter,[{key:"min",get:function get(){return this._min;}},{key:"max",get:function get(){return this._max;}},{key:"average",get:function get(){return this._average;}},{key:"lastSecAverage",get:function get(){return this._lastSecAverage;}},{key:"current",get:function get(){return this._current;}},{key:"total",get:function get(){return this._totalAccumulated;}},{key:"count",get:function get(){return this._totalValueCount;}},{key:"fetchNewFrame",value:function fetchNewFrame(){this._totalValueCount++;this._current=0;this._lastSecValueCount++;}},{key:"addCount",value:function addCount(newCount,fetchResult){if(!PerfCounter.Enabled){return;}this._current+=newCount;if(fetchResult){this._fetchResult();}}},{key:"beginMonitoring",value:function beginMonitoring(){if(!PerfCounter.Enabled){return;}this._startMonitoringTime=PrecisionDate.Now;}},{key:"endMonitoring",value:function endMonitoring(){var newFrame=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!PerfCounter.Enabled){return;}if(newFrame){this.fetchNewFrame();}var currentTime=PrecisionDate.Now;this._current=currentTime-this._startMonitoringTime;if(newFrame){this._fetchResult();}}},{key:"_fetchResult",value:function _fetchResult(){this._totalAccumulated+=this._current;this._lastSecAccumulated+=this._current;this._min=Math.min(this._min,this._current);this._max=Math.max(this._max,this._current);this._average=this._totalAccumulated/this._totalValueCount;var now=PrecisionDate.Now;if(now-this._lastSecTime>1e3){this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount;this._lastSecTime=now;this._lastSecAccumulated=0;this._lastSecValueCount=0;}}}]);return PerfCounter;}();PerfCounter.Enabled=true;// node_modules/@babylonjs/core/Maths/math.plane.js
var Plane=/*#__PURE__*/function(){function Plane(a,b,c,d){_classCallCheck(this,Plane);this.normal=new Vector3(a,b,c);this.d=d;}_createClass(Plane,[{key:"asArray",value:function asArray(){return[this.normal.x,this.normal.y,this.normal.z,this.d];}},{key:"clone",value:function clone(){return new Plane(this.normal.x,this.normal.y,this.normal.z,this.d);}},{key:"getClassName",value:function getClassName(){return"Plane";}},{key:"getHashCode",value:function getHashCode(){var hash=this.normal.getHashCode();hash=hash*397^(this.d|0);return hash;}},{key:"normalize",value:function normalize(){var norm=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z);var magnitude=0;if(norm!==0){magnitude=1/norm;}this.normal.x*=magnitude;this.normal.y*=magnitude;this.normal.z*=magnitude;this.d*=magnitude;return this;}},{key:"transform",value:function transform(transformation){var invertedMatrix=Plane._TmpMatrix;transformation.invertToRef(invertedMatrix);var m=invertedMatrix.m;var x=this.normal.x;var y=this.normal.y;var z=this.normal.z;var d=this.d;var normalX=x*m[0]+y*m[1]+z*m[2]+d*m[3];var normalY=x*m[4]+y*m[5]+z*m[6]+d*m[7];var normalZ=x*m[8]+y*m[9]+z*m[10]+d*m[11];var finalD=x*m[12]+y*m[13]+z*m[14]+d*m[15];return new Plane(normalX,normalY,normalZ,finalD);}},{key:"dotCoordinate",value:function dotCoordinate(point){return this.normal.x*point.x+this.normal.y*point.y+this.normal.z*point.z+this.d;}},{key:"copyFromPoints",value:function copyFromPoints(point1,point2,point3){var x1=point2.x-point1.x;var y1=point2.y-point1.y;var z1=point2.z-point1.z;var x2=point3.x-point1.x;var y2=point3.y-point1.y;var z2=point3.z-point1.z;var yz=y1*z2-z1*y2;var xz=z1*x2-x1*z2;var xy=x1*y2-y1*x2;var pyth=Math.sqrt(yz*yz+xz*xz+xy*xy);var invPyth;if(pyth!==0){invPyth=1/pyth;}else{invPyth=0;}this.normal.x=yz*invPyth;this.normal.y=xz*invPyth;this.normal.z=xy*invPyth;this.d=-(this.normal.x*point1.x+this.normal.y*point1.y+this.normal.z*point1.z);return this;}},{key:"isFrontFacingTo",value:function isFrontFacingTo(direction,epsilon){var dot=Vector3.Dot(this.normal,direction);return dot<=epsilon;}},{key:"signedDistanceTo",value:function signedDistanceTo(point){return Vector3.Dot(point,this.normal)+this.d;}}],[{key:"FromArray",value:function FromArray(array){return new Plane(array[0],array[1],array[2],array[3]);}},{key:"FromPoints",value:function FromPoints(point1,point2,point3){var result=new Plane(0,0,0,0);result.copyFromPoints(point1,point2,point3);return result;}},{key:"FromPositionAndNormal",value:function FromPositionAndNormal(origin,normal){var result=new Plane(0,0,0,0);normal.normalize();result.normal=normal;result.d=-(normal.x*origin.x+normal.y*origin.y+normal.z*origin.z);return result;}},{key:"SignedDistanceToPlaneFromPositionAndNormal",value:function SignedDistanceToPlaneFromPositionAndNormal(origin,normal,point){var d=-(normal.x*origin.x+normal.y*origin.y+normal.z*origin.z);return Vector3.Dot(point,normal)+d;}}]);return Plane;}();Plane._TmpMatrix=Matrix.Identity();// node_modules/@babylonjs/core/Maths/math.frustum.js
var Frustum=/*#__PURE__*/function(){function Frustum(){_classCallCheck(this,Frustum);}_createClass(Frustum,null,[{key:"GetPlanes",value:function GetPlanes(transform){var frustumPlanes=[];for(var index=0;index<6;index++){frustumPlanes.push(new Plane(0,0,0,0));}Frustum.GetPlanesToRef(transform,frustumPlanes);return frustumPlanes;}},{key:"GetNearPlaneToRef",value:function GetNearPlaneToRef(transform,frustumPlane){var m=transform.m;frustumPlane.normal.x=m[3]+m[2];frustumPlane.normal.y=m[7]+m[6];frustumPlane.normal.z=m[11]+m[10];frustumPlane.d=m[15]+m[14];frustumPlane.normalize();}},{key:"GetFarPlaneToRef",value:function GetFarPlaneToRef(transform,frustumPlane){var m=transform.m;frustumPlane.normal.x=m[3]-m[2];frustumPlane.normal.y=m[7]-m[6];frustumPlane.normal.z=m[11]-m[10];frustumPlane.d=m[15]-m[14];frustumPlane.normalize();}},{key:"GetLeftPlaneToRef",value:function GetLeftPlaneToRef(transform,frustumPlane){var m=transform.m;frustumPlane.normal.x=m[3]+m[0];frustumPlane.normal.y=m[7]+m[4];frustumPlane.normal.z=m[11]+m[8];frustumPlane.d=m[15]+m[12];frustumPlane.normalize();}},{key:"GetRightPlaneToRef",value:function GetRightPlaneToRef(transform,frustumPlane){var m=transform.m;frustumPlane.normal.x=m[3]-m[0];frustumPlane.normal.y=m[7]-m[4];frustumPlane.normal.z=m[11]-m[8];frustumPlane.d=m[15]-m[12];frustumPlane.normalize();}},{key:"GetTopPlaneToRef",value:function GetTopPlaneToRef(transform,frustumPlane){var m=transform.m;frustumPlane.normal.x=m[3]-m[1];frustumPlane.normal.y=m[7]-m[5];frustumPlane.normal.z=m[11]-m[9];frustumPlane.d=m[15]-m[13];frustumPlane.normalize();}},{key:"GetBottomPlaneToRef",value:function GetBottomPlaneToRef(transform,frustumPlane){var m=transform.m;frustumPlane.normal.x=m[3]+m[1];frustumPlane.normal.y=m[7]+m[5];frustumPlane.normal.z=m[11]+m[9];frustumPlane.d=m[15]+m[13];frustumPlane.normalize();}},{key:"GetPlanesToRef",value:function GetPlanesToRef(transform,frustumPlanes){Frustum.GetNearPlaneToRef(transform,frustumPlanes[0]);Frustum.GetFarPlaneToRef(transform,frustumPlanes[1]);Frustum.GetLeftPlaneToRef(transform,frustumPlanes[2]);Frustum.GetRightPlaneToRef(transform,frustumPlanes[3]);Frustum.GetTopPlaneToRef(transform,frustumPlanes[4]);Frustum.GetBottomPlaneToRef(transform,frustumPlanes[5]);}}]);return Frustum;}();// node_modules/@babylonjs/core/Misc/uniqueIdGenerator.js
var UniqueIdGenerator=/*#__PURE__*/function(){function UniqueIdGenerator(){_classCallCheck(this,UniqueIdGenerator);}_createClass(UniqueIdGenerator,null,[{key:"UniqueId",get:function get(){var result=this._UniqueIdCounter;this._UniqueIdCounter++;return result;}}]);return UniqueIdGenerator;}();UniqueIdGenerator._UniqueIdCounter=1;// node_modules/@babylonjs/core/Lights/lightConstants.js
var LightConstants=/*#__PURE__*/function(){function LightConstants(){_classCallCheck(this,LightConstants);}_createClass(LightConstants,null,[{key:"CompareLightsPriority",value:function CompareLightsPriority(a,b){if(a.shadowEnabled!==b.shadowEnabled){return(b.shadowEnabled?1:0)-(a.shadowEnabled?1:0);}return b.renderPriority-a.renderPriority;}}]);return LightConstants;}();LightConstants.FALLOFF_DEFAULT=0;LightConstants.FALLOFF_PHYSICAL=1;LightConstants.FALLOFF_GLTF=2;LightConstants.FALLOFF_STANDARD=3;LightConstants.LIGHTMAP_DEFAULT=0;LightConstants.LIGHTMAP_SPECULAR=1;LightConstants.LIGHTMAP_SHADOWSONLY=2;LightConstants.INTENSITYMODE_AUTOMATIC=0;LightConstants.INTENSITYMODE_LUMINOUSPOWER=1;LightConstants.INTENSITYMODE_LUMINOUSINTENSITY=2;LightConstants.INTENSITYMODE_ILLUMINANCE=3;LightConstants.INTENSITYMODE_LUMINANCE=4;LightConstants.LIGHTTYPEID_POINTLIGHT=0;LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT=1;LightConstants.LIGHTTYPEID_SPOTLIGHT=2;LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT=3;// node_modules/@babylonjs/core/scene.js
var ScenePerformancePriority;(function(ScenePerformancePriority2){ScenePerformancePriority2[ScenePerformancePriority2["BackwardCompatible"]=0]="BackwardCompatible";ScenePerformancePriority2[ScenePerformancePriority2["Intermediate"]=1]="Intermediate";ScenePerformancePriority2[ScenePerformancePriority2["Aggressive"]=2]="Aggressive";})(ScenePerformancePriority||(ScenePerformancePriority={}));var Scene=/*#__PURE__*/function(_AbstractScene){_inherits(Scene,_AbstractScene);var _super19=_createSuper(Scene);function Scene(engine,options){var _this49;_classCallCheck(this,Scene);_this49=_super19.call(this);_this49._inputManager=new InputManager(_assertThisInitialized(_this49));_this49.cameraToUseForPointers=null;_this49._isScene=true;_this49._blockEntityCollection=false;_this49.autoClear=true;_this49.autoClearDepthAndStencil=true;_this49.clearColor=new Color4(0.2,0.2,0.3,1);_this49.ambientColor=new Color3(0,0,0);_this49.environmentIntensity=1;_this49._performancePriority=ScenePerformancePriority.BackwardCompatible;_this49._forceWireframe=false;_this49._skipFrustumClipping=false;_this49._forcePointsCloud=false;_this49.animationsEnabled=true;_this49._animationPropertiesOverride=null;_this49.useConstantAnimationDeltaTime=false;_this49.constantlyUpdateMeshUnderPointer=false;_this49.hoverCursor="pointer";_this49.defaultCursor="";_this49.doNotHandleCursors=false;_this49.preventDefaultOnPointerDown=true;_this49.preventDefaultOnPointerUp=true;_this49.metadata=null;_this49.reservedDataStore=null;_this49.disableOfflineSupportExceptionRules=new Array();_this49.onDisposeObservable=new Observable();_this49._onDisposeObserver=null;_this49.onBeforeRenderObservable=new Observable();_this49._onBeforeRenderObserver=null;_this49.onAfterRenderObservable=new Observable();_this49.onAfterRenderCameraObservable=new Observable();_this49._onAfterRenderObserver=null;_this49.onBeforeAnimationsObservable=new Observable();_this49.onAfterAnimationsObservable=new Observable();_this49.onBeforeDrawPhaseObservable=new Observable();_this49.onAfterDrawPhaseObservable=new Observable();_this49.onReadyObservable=new Observable();_this49.onBeforeCameraRenderObservable=new Observable();_this49._onBeforeCameraRenderObserver=null;_this49.onAfterCameraRenderObservable=new Observable();_this49._onAfterCameraRenderObserver=null;_this49.onBeforeActiveMeshesEvaluationObservable=new Observable();_this49.onAfterActiveMeshesEvaluationObservable=new Observable();_this49.onBeforeParticlesRenderingObservable=new Observable();_this49.onAfterParticlesRenderingObservable=new Observable();_this49.onDataLoadedObservable=new Observable();_this49.onNewCameraAddedObservable=new Observable();_this49.onCameraRemovedObservable=new Observable();_this49.onNewLightAddedObservable=new Observable();_this49.onLightRemovedObservable=new Observable();_this49.onNewGeometryAddedObservable=new Observable();_this49.onGeometryRemovedObservable=new Observable();_this49.onNewTransformNodeAddedObservable=new Observable();_this49.onTransformNodeRemovedObservable=new Observable();_this49.onNewMeshAddedObservable=new Observable();_this49.onMeshRemovedObservable=new Observable();_this49.onNewSkeletonAddedObservable=new Observable();_this49.onSkeletonRemovedObservable=new Observable();_this49.onNewMaterialAddedObservable=new Observable();_this49.onNewMultiMaterialAddedObservable=new Observable();_this49.onMaterialRemovedObservable=new Observable();_this49.onMultiMaterialRemovedObservable=new Observable();_this49.onNewTextureAddedObservable=new Observable();_this49.onTextureRemovedObservable=new Observable();_this49.onBeforeRenderTargetsRenderObservable=new Observable();_this49.onAfterRenderTargetsRenderObservable=new Observable();_this49.onBeforeStepObservable=new Observable();_this49.onAfterStepObservable=new Observable();_this49.onActiveCameraChanged=new Observable();_this49.onActiveCamerasChanged=new Observable();_this49.onBeforeRenderingGroupObservable=new Observable();_this49.onAfterRenderingGroupObservable=new Observable();_this49.onMeshImportedObservable=new Observable();_this49.onAnimationFileImportedObservable=new Observable();_this49._registeredForLateAnimationBindings=new SmartArrayNoDuplicate(256);_this49.skipPointerMovePicking=false;_this49.skipPointerDownPicking=false;_this49.skipPointerUpPicking=false;_this49.onPrePointerObservable=new Observable();_this49.onPointerObservable=new Observable();_this49.onPreKeyboardObservable=new Observable();_this49.onKeyboardObservable=new Observable();_this49._useRightHandedSystem=false;_this49._timeAccumulator=0;_this49._currentStepId=0;_this49._currentInternalStep=0;_this49._fogEnabled=true;_this49._fogMode=Scene.FOGMODE_NONE;_this49.fogColor=new Color3(0.2,0.2,0.3);_this49.fogDensity=0.1;_this49.fogStart=0;_this49.fogEnd=1e3;_this49.needsPreviousWorldMatrices=false;_this49._shadowsEnabled=true;_this49._lightsEnabled=true;_this49._unObserveActiveCameras=null;_this49._texturesEnabled=true;_this49.physicsEnabled=true;_this49.particlesEnabled=true;_this49.spritesEnabled=true;_this49._skeletonsEnabled=true;_this49.lensFlaresEnabled=true;_this49.collisionsEnabled=true;_this49.gravity=new Vector3(0,-9.807,0);_this49.postProcessesEnabled=true;_this49.renderTargetsEnabled=true;_this49.dumpNextRenderTargets=false;_this49.customRenderTargets=new Array();_this49.importedMeshesFiles=new Array();_this49.probesEnabled=true;_this49._meshesForIntersections=new SmartArrayNoDuplicate(256);_this49.proceduralTexturesEnabled=true;_this49._totalVertices=new PerfCounter();_this49._activeIndices=new PerfCounter();_this49._activeParticles=new PerfCounter();_this49._activeBones=new PerfCounter();_this49._animationTime=0;_this49.animationTimeScale=1;_this49._renderId=0;_this49._frameId=0;_this49._executeWhenReadyTimeoutId=null;_this49._intermediateRendering=false;_this49._defaultFrameBufferCleared=false;_this49._viewUpdateFlag=-1;_this49._projectionUpdateFlag=-1;_this49._toBeDisposed=new Array(256);_this49._activeRequests=new Array();_this49._pendingData=new Array();_this49._isDisposed=false;_this49.dispatchAllSubMeshesOfActiveMeshes=false;_this49._activeMeshes=new SmartArray(256);_this49._processedMaterials=new SmartArray(256);_this49._renderTargets=new SmartArrayNoDuplicate(256);_this49._materialsRenderTargets=new SmartArrayNoDuplicate(256);_this49._activeParticleSystems=new SmartArray(256);_this49._activeSkeletons=new SmartArrayNoDuplicate(32);_this49._softwareSkinnedMeshes=new SmartArrayNoDuplicate(32);_this49._activeAnimatables=new Array();_this49._transformMatrix=Matrix.Zero();_this49.requireLightSorting=false;_this49._components=[];_this49._serializableComponents=[];_this49._transientComponents=[];_this49._beforeCameraUpdateStage=Stage.Create();_this49._beforeClearStage=Stage.Create();_this49._beforeRenderTargetClearStage=Stage.Create();_this49._gatherRenderTargetsStage=Stage.Create();_this49._gatherActiveCameraRenderTargetsStage=Stage.Create();_this49._isReadyForMeshStage=Stage.Create();_this49._beforeEvaluateActiveMeshStage=Stage.Create();_this49._evaluateSubMeshStage=Stage.Create();_this49._preActiveMeshStage=Stage.Create();_this49._cameraDrawRenderTargetStage=Stage.Create();_this49._beforeCameraDrawStage=Stage.Create();_this49._beforeRenderTargetDrawStage=Stage.Create();_this49._beforeRenderingGroupDrawStage=Stage.Create();_this49._beforeRenderingMeshStage=Stage.Create();_this49._afterRenderingMeshStage=Stage.Create();_this49._afterRenderingGroupDrawStage=Stage.Create();_this49._afterCameraDrawStage=Stage.Create();_this49._afterCameraPostProcessStage=Stage.Create();_this49._afterRenderTargetDrawStage=Stage.Create();_this49._afterRenderTargetPostProcessStage=Stage.Create();_this49._afterRenderStage=Stage.Create();_this49._pointerMoveStage=Stage.Create();_this49._pointerDownStage=Stage.Create();_this49._pointerUpStage=Stage.Create();_this49._geometriesByUniqueId=null;_this49._defaultMeshCandidates={data:[],length:0};_this49._defaultSubMeshCandidates={data:[],length:0};_this49._preventFreeActiveMeshesAndRenderingGroups=false;_this49._activeMeshesFrozen=false;_this49._activeMeshesFrozenButKeepClipping=false;_this49._skipEvaluateActiveMeshesCompletely=false;_this49._allowPostProcessClearColor=true;_this49.getDeterministicFrameTime=function(){return _this49._engine.getTimeStep();};_this49._registeredActions=0;_this49._blockMaterialDirtyMechanism=false;_this49._perfCollector=null;_this49.activeCameras=new Array();var fullOptions=_objectSpread({useGeometryUniqueIdsMap:true,useMaterialMeshMap:true,useClonedMeshMap:true,virtual:false},options);_this49._engine=engine||EngineStore.LastCreatedEngine;if(!fullOptions.virtual){EngineStore._LastCreatedScene=_assertThisInitialized(_this49);_this49._engine.scenes.push(_assertThisInitialized(_this49));}else{_this49._engine._virtualScenes.push(_assertThisInitialized(_this49));}_this49._uid=null;_this49._renderingManager=new RenderingManager(_assertThisInitialized(_this49));if(PostProcessManager){_this49.postProcessManager=new PostProcessManager(_assertThisInitialized(_this49));}if(IsWindowObjectExist()){_this49.attachControl();}_this49._createUbo();if(ImageProcessingConfiguration){_this49._imageProcessingConfiguration=new ImageProcessingConfiguration();}_this49.setDefaultCandidateProviders();if(fullOptions.useGeometryUniqueIdsMap){_this49._geometriesByUniqueId={};}_this49.useMaterialMeshMap=fullOptions.useMaterialMeshMap;_this49.useClonedMeshMap=fullOptions.useClonedMeshMap;if(!options||!options.virtual){_this49._engine.onNewSceneAddedObservable.notifyObservers(_assertThisInitialized(_this49));}return _this49;}_createClass(Scene,[{key:"environmentTexture",get:function get(){return this._environmentTexture;},set:function set(value){if(this._environmentTexture===value){return;}this._environmentTexture=value;this.markAllMaterialsAsDirty(1);}},{key:"imageProcessingConfiguration",get:function get(){return this._imageProcessingConfiguration;}},{key:"performancePriority",get:function get(){return this._performancePriority;},set:function set(value){if(value===this._performancePriority){return;}this._performancePriority=value;switch(value){case ScenePerformancePriority.BackwardCompatible:this.skipFrustumClipping=false;this._renderingManager.maintainStateBetweenFrames=false;this.skipPointerMovePicking=false;this.autoClear=true;break;case ScenePerformancePriority.Intermediate:this.skipFrustumClipping=false;this._renderingManager.maintainStateBetweenFrames=false;this.skipPointerMovePicking=true;this.autoClear=false;break;case ScenePerformancePriority.Aggressive:this.skipFrustumClipping=true;this._renderingManager.maintainStateBetweenFrames=true;this.skipPointerMovePicking=true;this.autoClear=false;break;}}},{key:"forceWireframe",get:function get(){return this._forceWireframe;},set:function set(value){if(this._forceWireframe===value){return;}this._forceWireframe=value;this.markAllMaterialsAsDirty(16);}},{key:"skipFrustumClipping",get:function get(){return this._skipFrustumClipping;},set:function set(value){if(this._skipFrustumClipping===value){return;}this._skipFrustumClipping=value;}},{key:"forcePointsCloud",get:function get(){return this._forcePointsCloud;},set:function set(value){if(this._forcePointsCloud===value){return;}this._forcePointsCloud=value;this.markAllMaterialsAsDirty(16);}},{key:"animationPropertiesOverride",get:function get(){return this._animationPropertiesOverride;},set:function set(value){this._animationPropertiesOverride=value;}},{key:"onDispose",set:function set(callback){if(this._onDisposeObserver){this.onDisposeObservable.remove(this._onDisposeObserver);}this._onDisposeObserver=this.onDisposeObservable.add(callback);}},{key:"beforeRender",set:function set(callback){if(this._onBeforeRenderObserver){this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);}if(callback){this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback);}}},{key:"afterRender",set:function set(callback){if(this._onAfterRenderObserver){this.onAfterRenderObservable.remove(this._onAfterRenderObserver);}if(callback){this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback);}}},{key:"beforeCameraRender",set:function set(callback){if(this._onBeforeCameraRenderObserver){this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver);}this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(callback);}},{key:"afterCameraRender",set:function set(callback){if(this._onAfterCameraRenderObserver){this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver);}this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(callback);}},{key:"unTranslatedPointer",get:function get(){return this._inputManager.unTranslatedPointer;}},{key:"bindEyePosition",value:function bindEyePosition(effect){var variableName=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"vEyePosition";var isVector3=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _a;var eyePosition=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(_a=this.activeCamera.globalPosition)!==null&&_a!==void 0?_a:this.activeCamera.devicePosition;var invertNormal=this.useRightHandedSystem===(this._mirroredCameraPosition!=null);TmpVectors.Vector4[0].set(eyePosition.x,eyePosition.y,eyePosition.z,invertNormal?-1:1);if(effect){if(isVector3){effect.setFloat3(variableName,TmpVectors.Vector4[0].x,TmpVectors.Vector4[0].y,TmpVectors.Vector4[0].z);}else{effect.setVector4(variableName,TmpVectors.Vector4[0]);}}return TmpVectors.Vector4[0];}},{key:"finalizeSceneUbo",value:function finalizeSceneUbo(){var ubo=this.getSceneUniformBuffer();var eyePosition=this.bindEyePosition(null);ubo.updateFloat4("vEyePosition",eyePosition.x,eyePosition.y,eyePosition.z,eyePosition.w);ubo.update();return ubo;}},{key:"useRightHandedSystem",get:function get(){return this._useRightHandedSystem;},set:function set(value){if(this._useRightHandedSystem===value){return;}this._useRightHandedSystem=value;this.markAllMaterialsAsDirty(16);}},{key:"setStepId",value:function setStepId(newStepId){this._currentStepId=newStepId;}},{key:"getStepId",value:function getStepId(){return this._currentStepId;}},{key:"getInternalStep",value:function getInternalStep(){return this._currentInternalStep;}},{key:"fogEnabled",get:function get(){return this._fogEnabled;},set:function set(value){if(this._fogEnabled===value){return;}this._fogEnabled=value;this.markAllMaterialsAsDirty(16);}},{key:"fogMode",get:function get(){return this._fogMode;},set:function set(value){if(this._fogMode===value){return;}this._fogMode=value;this.markAllMaterialsAsDirty(16);}},{key:"prePass",get:function get(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled;}},{key:"shadowsEnabled",get:function get(){return this._shadowsEnabled;},set:function set(value){if(this._shadowsEnabled===value){return;}this._shadowsEnabled=value;this.markAllMaterialsAsDirty(2);}},{key:"lightsEnabled",get:function get(){return this._lightsEnabled;},set:function set(value){if(this._lightsEnabled===value){return;}this._lightsEnabled=value;this.markAllMaterialsAsDirty(2);}},{key:"activeCameras",get:function get(){return this._activeCameras;},set:function set(cameras){var _this50=this;if(this._unObserveActiveCameras){this._unObserveActiveCameras();this._unObserveActiveCameras=null;}if(cameras){this._unObserveActiveCameras=_ObserveArray(cameras,function(){_this50.onActiveCamerasChanged.notifyObservers(_this50);});}this._activeCameras=cameras;}},{key:"activeCamera",get:function get(){return this._activeCamera;},set:function set(value){if(value===this._activeCamera){return;}this._activeCamera=value;this.onActiveCameraChanged.notifyObservers(this);}},{key:"defaultMaterial",get:function get(){if(!this._defaultMaterial){this._defaultMaterial=Scene.DefaultMaterialFactory(this);}return this._defaultMaterial;},set:function set(value){this._defaultMaterial=value;}},{key:"texturesEnabled",get:function get(){return this._texturesEnabled;},set:function set(value){if(this._texturesEnabled===value){return;}this._texturesEnabled=value;this.markAllMaterialsAsDirty(1);}},{key:"skeletonsEnabled",get:function get(){return this._skeletonsEnabled;},set:function set(value){if(this._skeletonsEnabled===value){return;}this._skeletonsEnabled=value;this.markAllMaterialsAsDirty(8);}},{key:"collisionCoordinator",get:function get(){if(!this._collisionCoordinator){this._collisionCoordinator=Scene.CollisionCoordinatorFactory();this._collisionCoordinator.init(this);}return this._collisionCoordinator;}},{key:"renderingManager",get:function get(){return this._renderingManager;}},{key:"frustumPlanes",get:function get(){return this._frustumPlanes;}},{key:"_registerTransientComponents",value:function _registerTransientComponents(){if(this._transientComponents.length>0){var _iterator38=_createForOfIteratorHelper(this._transientComponents),_step39;try{for(_iterator38.s();!(_step39=_iterator38.n()).done;){var component=_step39.value;component.register();}}catch(err){_iterator38.e(err);}finally{_iterator38.f();}this._transientComponents.length=0;}}},{key:"_addComponent",value:function _addComponent(component){this._components.push(component);this._transientComponents.push(component);var serializableComponent=component;if(serializableComponent.addFromContainer&&serializableComponent.serialize){this._serializableComponents.push(serializableComponent);}}},{key:"_getComponent",value:function _getComponent(name135){var _iterator39=_createForOfIteratorHelper(this._components),_step40;try{for(_iterator39.s();!(_step40=_iterator39.n()).done;){var component=_step40.value;if(component.name===name135){return component;}}}catch(err){_iterator39.e(err);}finally{_iterator39.f();}return null;}},{key:"getClassName",value:function getClassName(){return"Scene";}},{key:"_getDefaultMeshCandidates",value:function _getDefaultMeshCandidates(){this._defaultMeshCandidates.data=this.meshes;this._defaultMeshCandidates.length=this.meshes.length;return this._defaultMeshCandidates;}},{key:"_getDefaultSubMeshCandidates",value:function _getDefaultSubMeshCandidates(mesh){this._defaultSubMeshCandidates.data=mesh.subMeshes;this._defaultSubMeshCandidates.length=mesh.subMeshes.length;return this._defaultSubMeshCandidates;}},{key:"setDefaultCandidateProviders",value:function setDefaultCandidateProviders(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this);this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this);this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this);this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this);}},{key:"meshUnderPointer",get:function get(){return this._inputManager.meshUnderPointer;}},{key:"pointerX",get:function get(){return this._inputManager.pointerX;},set:function set(value){this._inputManager.pointerX=value;}},{key:"pointerY",get:function get(){return this._inputManager.pointerY;},set:function set(value){this._inputManager.pointerY=value;}},{key:"getCachedMaterial",value:function getCachedMaterial(){return this._cachedMaterial;}},{key:"getCachedEffect",value:function getCachedEffect(){return this._cachedEffect;}},{key:"getCachedVisibility",value:function getCachedVisibility(){return this._cachedVisibility;}},{key:"isCachedMaterialInvalid",value:function isCachedMaterialInvalid(material,effect){var visibility=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return this._cachedEffect!==effect||this._cachedMaterial!==material||this._cachedVisibility!==visibility;}},{key:"getEngine",value:function getEngine(){return this._engine;}},{key:"getTotalVertices",value:function getTotalVertices(){return this._totalVertices.current;}},{key:"totalVerticesPerfCounter",get:function get(){return this._totalVertices;}},{key:"getActiveIndices",value:function getActiveIndices(){return this._activeIndices.current;}},{key:"totalActiveIndicesPerfCounter",get:function get(){return this._activeIndices;}},{key:"getActiveParticles",value:function getActiveParticles(){return this._activeParticles.current;}},{key:"activeParticlesPerfCounter",get:function get(){return this._activeParticles;}},{key:"getActiveBones",value:function getActiveBones(){return this._activeBones.current;}},{key:"activeBonesPerfCounter",get:function get(){return this._activeBones;}},{key:"getActiveMeshes",value:function getActiveMeshes(){return this._activeMeshes;}},{key:"getAnimationRatio",value:function getAnimationRatio(){return this._animationRatio!==void 0?this._animationRatio:1;}},{key:"getRenderId",value:function getRenderId(){return this._renderId;}},{key:"getFrameId",value:function getFrameId(){return this._frameId;}},{key:"incrementRenderId",value:function incrementRenderId(){this._renderId++;}},{key:"_createUbo",value:function _createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer());}},{key:"simulatePointerMove",value:function simulatePointerMove(pickResult,pointerEventInit){this._inputManager.simulatePointerMove(pickResult,pointerEventInit);return this;}},{key:"simulatePointerDown",value:function simulatePointerDown(pickResult,pointerEventInit){this._inputManager.simulatePointerDown(pickResult,pointerEventInit);return this;}},{key:"simulatePointerUp",value:function simulatePointerUp(pickResult,pointerEventInit,doubleTap){this._inputManager.simulatePointerUp(pickResult,pointerEventInit,doubleTap);return this;}},{key:"isPointerCaptured",value:function isPointerCaptured(){var pointerId=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return this._inputManager.isPointerCaptured(pointerId);}},{key:"attachControl",value:function attachControl(){var attachUp=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var attachDown=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var attachMove=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this._inputManager.attachControl(attachUp,attachDown,attachMove);}},{key:"detachControl",value:function detachControl(){this._inputManager.detachControl();}},{key:"isReady",value:function isReady(){var checkRenderTargets=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this._isDisposed){return false;}var index;var engine=this.getEngine();var isReady=true;if(this._pendingData.length>0){isReady=false;}if(checkRenderTargets){this._processedMaterials.reset();this._materialsRenderTargets.reset();}for(index=0;index<this.meshes.length;index++){var mesh=this.meshes[index];if(!mesh.subMeshes||mesh.subMeshes.length===0){continue;}if(!mesh.isReady(true)){isReady=false;continue;}var hardwareInstancedRendering=mesh.hasThinInstances||mesh.getClassName()==="InstancedMesh"||mesh.getClassName()==="InstancedLinesMesh"||engine.getCaps().instancedArrays&&mesh.instances.length>0;var _iterator40=_createForOfIteratorHelper(this._isReadyForMeshStage),_step41;try{for(_iterator40.s();!(_step41=_iterator40.n()).done;){var step=_step41.value;if(!step.action(mesh,hardwareInstancedRendering)){isReady=false;}}}catch(err){_iterator40.e(err);}finally{_iterator40.f();}if(!checkRenderTargets){continue;}var mat=mesh.material||this.defaultMaterial;if(mat){if(mat._storeEffectOnSubMeshes){var _iterator41=_createForOfIteratorHelper(mesh.subMeshes),_step42;try{for(_iterator41.s();!(_step42=_iterator41.n()).done;){var subMesh=_step42.value;var material=subMesh.getMaterial();if(material&&material.hasRenderTargetTextures&&material.getRenderTargetTextures!=null){if(this._processedMaterials.indexOf(material)===-1){this._processedMaterials.push(material);this._materialsRenderTargets.concatWithNoDuplicate(material.getRenderTargetTextures());}}}}catch(err){_iterator41.e(err);}finally{_iterator41.f();}}else{if(mat.hasRenderTargetTextures&&mat.getRenderTargetTextures!=null){if(this._processedMaterials.indexOf(mat)===-1){this._processedMaterials.push(mat);this._materialsRenderTargets.concatWithNoDuplicate(mat.getRenderTargetTextures());}}}}}if(!isReady){return false;}if(!engine.areAllEffectsReady()){return false;}if(checkRenderTargets){for(index=0;index<this._materialsRenderTargets.length;++index){var rtt=this._materialsRenderTargets.data[index];if(!rtt.isReadyForRendering()){return false;}}}for(index=0;index<this.geometries.length;index++){var geometry=this.geometries[index];if(geometry.delayLoadState===2){return false;}}if(this.activeCameras&&this.activeCameras.length>0){var _iterator42=_createForOfIteratorHelper(this.activeCameras),_step43;try{for(_iterator42.s();!(_step43=_iterator42.n()).done;){var camera=_step43.value;if(!camera.isReady(true)){return false;}}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}}else if(this.activeCamera){if(!this.activeCamera.isReady(true)){return false;}}var _iterator43=_createForOfIteratorHelper(this.particleSystems),_step44;try{for(_iterator43.s();!(_step44=_iterator43.n()).done;){var particleSystem=_step44.value;if(!particleSystem.isReady()){return false;}}}catch(err){_iterator43.e(err);}finally{_iterator43.f();}return true;}},{key:"resetCachedMaterial",value:function resetCachedMaterial(){this._cachedMaterial=null;this._cachedEffect=null;this._cachedVisibility=null;}},{key:"registerBeforeRender",value:function registerBeforeRender(func){this.onBeforeRenderObservable.add(func);}},{key:"unregisterBeforeRender",value:function unregisterBeforeRender(func){this.onBeforeRenderObservable.removeCallback(func);}},{key:"registerAfterRender",value:function registerAfterRender(func){this.onAfterRenderObservable.add(func);}},{key:"unregisterAfterRender",value:function unregisterAfterRender(func){this.onAfterRenderObservable.removeCallback(func);}},{key:"_executeOnceBeforeRender",value:function _executeOnceBeforeRender(func){var _this51=this;var execFunc=function execFunc(){func();setTimeout(function(){_this51.unregisterBeforeRender(execFunc);});};this.registerBeforeRender(execFunc);}},{key:"executeOnceBeforeRender",value:function executeOnceBeforeRender(func,timeout){var _this52=this;if(timeout!==void 0){setTimeout(function(){_this52._executeOnceBeforeRender(func);},timeout);}else{this._executeOnceBeforeRender(func);}}},{key:"addPendingData",value:function addPendingData(data){this._pendingData.push(data);}},{key:"removePendingData",value:function removePendingData(data){var wasLoading=this.isLoading;var index=this._pendingData.indexOf(data);if(index!==-1){this._pendingData.splice(index,1);}if(wasLoading&&!this.isLoading){this.onDataLoadedObservable.notifyObservers(this);}}},{key:"getWaitingItemsCount",value:function getWaitingItemsCount(){return this._pendingData.length;}},{key:"isLoading",get:function get(){return this._pendingData.length>0;}},{key:"executeWhenReady",value:function executeWhenReady(func){var checkRenderTargets=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.onReadyObservable.addOnce(func);if(this._executeWhenReadyTimeoutId!==null){return;}this._checkIsReady(checkRenderTargets);}},{key:"whenReadyAsync",value:function whenReadyAsync(){var _this53=this;var checkRenderTargets=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return new Promise(function(resolve){_this53.executeWhenReady(function(){resolve();},checkRenderTargets);});}},{key:"_checkIsReady",value:function _checkIsReady(){var _this54=this;var checkRenderTargets=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._registerTransientComponents();if(this.isReady(checkRenderTargets)){this.onReadyObservable.notifyObservers(this);this.onReadyObservable.clear();this._executeWhenReadyTimeoutId=null;return;}if(this._isDisposed){this.onReadyObservable.clear();this._executeWhenReadyTimeoutId=null;return;}this._executeWhenReadyTimeoutId=setTimeout(function(){_this54.incrementRenderId();_this54._checkIsReady(checkRenderTargets);},100);}},{key:"animatables",get:function get(){return this._activeAnimatables;}},{key:"resetLastAnimationTimeFrame",value:function resetLastAnimationTimeFrame(){this._animationTimeLast=PrecisionDate.Now;}},{key:"getViewMatrix",value:function getViewMatrix(){return this._viewMatrix;}},{key:"getProjectionMatrix",value:function getProjectionMatrix(){return this._projectionMatrix;}},{key:"getTransformMatrix",value:function getTransformMatrix(){return this._transformMatrix;}},{key:"setTransformMatrix",value:function setTransformMatrix(viewL,projectionL,viewR,projectionR){if(!viewR&&!projectionR&&this._multiviewSceneUbo){this._multiviewSceneUbo.dispose();this._multiviewSceneUbo=null;}if(this._viewUpdateFlag===viewL.updateFlag&&this._projectionUpdateFlag===projectionL.updateFlag){return;}this._viewUpdateFlag=viewL.updateFlag;this._projectionUpdateFlag=projectionL.updateFlag;this._viewMatrix=viewL;this._projectionMatrix=projectionL;this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix);if(!this._frustumPlanes){this._frustumPlanes=Frustum.GetPlanes(this._transformMatrix);}else{Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes);}if(this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo){this._updateMultiviewUbo(viewR,projectionR);}else if(this._sceneUbo.useUbo){this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix);this._sceneUbo.updateMatrix("view",this._viewMatrix);this._sceneUbo.updateMatrix("projection",this._projectionMatrix);}}},{key:"getSceneUniformBuffer",value:function getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo;}},{key:"createSceneUniformBuffer",value:function createSceneUniformBuffer(name135){var sceneUbo=new UniformBuffer(this._engine,void 0,false,name135!==null&&name135!==void 0?name135:"scene");sceneUbo.addUniform("viewProjection",16);sceneUbo.addUniform("view",16);sceneUbo.addUniform("projection",16);sceneUbo.addUniform("vEyePosition",4);return sceneUbo;}},{key:"setSceneUniformBuffer",value:function setSceneUniformBuffer(ubo){this._sceneUbo=ubo;this._viewUpdateFlag=-1;this._projectionUpdateFlag=-1;}},{key:"getUniqueId",value:function getUniqueId(){return UniqueIdGenerator.UniqueId;}},{key:"addMesh",value:function addMesh(newMesh){var _this55=this;var recursive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._blockEntityCollection){return;}this.meshes.push(newMesh);newMesh._resyncLightSources();if(!newMesh.parent){newMesh._addToSceneRootNodes();}this.onNewMeshAddedObservable.notifyObservers(newMesh);if(recursive){newMesh.getChildMeshes().forEach(function(m){_this55.addMesh(m);});}}},{key:"removeMesh",value:function removeMesh(toRemove){var _this56=this;var recursive=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var index=this.meshes.indexOf(toRemove);if(index!==-1){this.meshes[index]=this.meshes[this.meshes.length-1];this.meshes.pop();if(!toRemove.parent){toRemove._removeFromSceneRootNodes();}}this._inputManager._invalidateMesh(toRemove);this.onMeshRemovedObservable.notifyObservers(toRemove);if(recursive){toRemove.getChildMeshes().forEach(function(m){_this56.removeMesh(m);});}return index;}},{key:"addTransformNode",value:function addTransformNode(newTransformNode){if(this._blockEntityCollection){return;}if(newTransformNode.getScene()===this&&newTransformNode._indexInSceneTransformNodesArray!==-1){return;}newTransformNode._indexInSceneTransformNodesArray=this.transformNodes.length;this.transformNodes.push(newTransformNode);if(!newTransformNode.parent){newTransformNode._addToSceneRootNodes();}this.onNewTransformNodeAddedObservable.notifyObservers(newTransformNode);}},{key:"removeTransformNode",value:function removeTransformNode(toRemove){var index=toRemove._indexInSceneTransformNodesArray;if(index!==-1){if(index!==this.transformNodes.length-1){var lastNode=this.transformNodes[this.transformNodes.length-1];this.transformNodes[index]=lastNode;lastNode._indexInSceneTransformNodesArray=index;}toRemove._indexInSceneTransformNodesArray=-1;this.transformNodes.pop();if(!toRemove.parent){toRemove._removeFromSceneRootNodes();}}this.onTransformNodeRemovedObservable.notifyObservers(toRemove);return index;}},{key:"removeSkeleton",value:function removeSkeleton(toRemove){var index=this.skeletons.indexOf(toRemove);if(index!==-1){this.skeletons.splice(index,1);this.onSkeletonRemovedObservable.notifyObservers(toRemove);this._executeActiveContainerCleanup(this._activeSkeletons);}return index;}},{key:"removeMorphTargetManager",value:function removeMorphTargetManager(toRemove){var index=this.morphTargetManagers.indexOf(toRemove);if(index!==-1){this.morphTargetManagers.splice(index,1);}return index;}},{key:"removeLight",value:function removeLight(toRemove){var index=this.lights.indexOf(toRemove);if(index!==-1){var _iterator44=_createForOfIteratorHelper(this.meshes),_step45;try{for(_iterator44.s();!(_step45=_iterator44.n()).done;){var mesh=_step45.value;mesh._removeLightSource(toRemove,false);}}catch(err){_iterator44.e(err);}finally{_iterator44.f();}this.lights.splice(index,1);this.sortLightsByPriority();if(!toRemove.parent){toRemove._removeFromSceneRootNodes();}}this.onLightRemovedObservable.notifyObservers(toRemove);return index;}},{key:"removeCamera",value:function removeCamera(toRemove){var index=this.cameras.indexOf(toRemove);if(index!==-1){this.cameras.splice(index,1);if(!toRemove.parent){toRemove._removeFromSceneRootNodes();}}if(this.activeCameras){var index2=this.activeCameras.indexOf(toRemove);if(index2!==-1){this.activeCameras.splice(index2,1);}}if(this.activeCamera===toRemove){if(this.cameras.length>0){this.activeCamera=this.cameras[0];}else{this.activeCamera=null;}}this.onCameraRemovedObservable.notifyObservers(toRemove);return index;}},{key:"removeParticleSystem",value:function removeParticleSystem(toRemove){var index=this.particleSystems.indexOf(toRemove);if(index!==-1){this.particleSystems.splice(index,1);this._executeActiveContainerCleanup(this._activeParticleSystems);}return index;}},{key:"removeAnimation",value:function removeAnimation(toRemove){var index=this.animations.indexOf(toRemove);if(index!==-1){this.animations.splice(index,1);}return index;}},{key:"stopAnimation",value:function stopAnimation(target,animationName,targetMask){}},{key:"removeAnimationGroup",value:function removeAnimationGroup(toRemove){var index=this.animationGroups.indexOf(toRemove);if(index!==-1){this.animationGroups.splice(index,1);}return index;}},{key:"removeMultiMaterial",value:function removeMultiMaterial(toRemove){var index=this.multiMaterials.indexOf(toRemove);if(index!==-1){this.multiMaterials.splice(index,1);}this.onMultiMaterialRemovedObservable.notifyObservers(toRemove);return index;}},{key:"removeMaterial",value:function removeMaterial(toRemove){var index=toRemove._indexInSceneMaterialArray;if(index!==-1&&index<this.materials.length){if(index!==this.materials.length-1){var lastMaterial=this.materials[this.materials.length-1];this.materials[index]=lastMaterial;lastMaterial._indexInSceneMaterialArray=index;}toRemove._indexInSceneMaterialArray=-1;this.materials.pop();}this.onMaterialRemovedObservable.notifyObservers(toRemove);return index;}},{key:"removeActionManager",value:function removeActionManager(toRemove){var index=this.actionManagers.indexOf(toRemove);if(index!==-1){this.actionManagers.splice(index,1);}return index;}},{key:"removeTexture",value:function removeTexture(toRemove){var index=this.textures.indexOf(toRemove);if(index!==-1){this.textures.splice(index,1);}this.onTextureRemovedObservable.notifyObservers(toRemove);return index;}},{key:"addLight",value:function addLight(newLight){if(this._blockEntityCollection){return;}this.lights.push(newLight);this.sortLightsByPriority();if(!newLight.parent){newLight._addToSceneRootNodes();}var _iterator45=_createForOfIteratorHelper(this.meshes),_step46;try{for(_iterator45.s();!(_step46=_iterator45.n()).done;){var mesh=_step46.value;if(mesh.lightSources.indexOf(newLight)===-1){mesh.lightSources.push(newLight);mesh._resyncLightSources();}}}catch(err){_iterator45.e(err);}finally{_iterator45.f();}this.onNewLightAddedObservable.notifyObservers(newLight);}},{key:"sortLightsByPriority",value:function sortLightsByPriority(){if(this.requireLightSorting){this.lights.sort(LightConstants.CompareLightsPriority);}}},{key:"addCamera",value:function addCamera(newCamera){if(this._blockEntityCollection){return;}this.cameras.push(newCamera);this.onNewCameraAddedObservable.notifyObservers(newCamera);if(!newCamera.parent){newCamera._addToSceneRootNodes();}}},{key:"addSkeleton",value:function addSkeleton(newSkeleton){if(this._blockEntityCollection){return;}this.skeletons.push(newSkeleton);this.onNewSkeletonAddedObservable.notifyObservers(newSkeleton);}},{key:"addParticleSystem",value:function addParticleSystem(newParticleSystem){if(this._blockEntityCollection){return;}this.particleSystems.push(newParticleSystem);}},{key:"addAnimation",value:function addAnimation(newAnimation){if(this._blockEntityCollection){return;}this.animations.push(newAnimation);}},{key:"addAnimationGroup",value:function addAnimationGroup(newAnimationGroup){if(this._blockEntityCollection){return;}this.animationGroups.push(newAnimationGroup);}},{key:"addMultiMaterial",value:function addMultiMaterial(newMultiMaterial){if(this._blockEntityCollection){return;}this.multiMaterials.push(newMultiMaterial);this.onNewMultiMaterialAddedObservable.notifyObservers(newMultiMaterial);}},{key:"addMaterial",value:function addMaterial(newMaterial){if(this._blockEntityCollection){return;}if(newMaterial.getScene()===this&&newMaterial._indexInSceneMaterialArray!==-1){return;}newMaterial._indexInSceneMaterialArray=this.materials.length;this.materials.push(newMaterial);this.onNewMaterialAddedObservable.notifyObservers(newMaterial);}},{key:"addMorphTargetManager",value:function addMorphTargetManager(newMorphTargetManager){if(this._blockEntityCollection){return;}this.morphTargetManagers.push(newMorphTargetManager);}},{key:"addGeometry",value:function addGeometry(newGeometry){if(this._blockEntityCollection){return;}if(this._geometriesByUniqueId){this._geometriesByUniqueId[newGeometry.uniqueId]=this.geometries.length;}this.geometries.push(newGeometry);}},{key:"addActionManager",value:function addActionManager(newActionManager){this.actionManagers.push(newActionManager);}},{key:"addTexture",value:function addTexture(newTexture){if(this._blockEntityCollection){return;}this.textures.push(newTexture);this.onNewTextureAddedObservable.notifyObservers(newTexture);}},{key:"switchActiveCamera",value:function switchActiveCamera(newCamera){var attachControl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var canvas=this._engine.getInputElement();if(!canvas){return;}if(this.activeCamera){this.activeCamera.detachControl();}this.activeCamera=newCamera;if(attachControl){newCamera.attachControl();}}},{key:"setActiveCameraById",value:function setActiveCameraById(id){var camera=this.getCameraById(id);if(camera){this.activeCamera=camera;return camera;}return null;}},{key:"setActiveCameraByName",value:function setActiveCameraByName(name135){var camera=this.getCameraByName(name135);if(camera){this.activeCamera=camera;return camera;}return null;}},{key:"getAnimationGroupByName",value:function getAnimationGroupByName(name135){for(var index=0;index<this.animationGroups.length;index++){if(this.animationGroups[index].name===name135){return this.animationGroups[index];}}return null;}},{key:"_getMaterial",value:function _getMaterial(allowMultiMaterials,predicate){for(var index=0;index<this.materials.length;index++){var material=this.materials[index];if(predicate(material)){return material;}}if(allowMultiMaterials){for(var _index3=0;_index3<this.multiMaterials.length;_index3++){var _material=this.multiMaterials[_index3];if(predicate(_material)){return _material;}}}return null;}},{key:"getMaterialByUniqueID",value:function getMaterialByUniqueID(uniqueId){var allowMultiMaterials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this._getMaterial(allowMultiMaterials,function(m){return m.uniqueId===uniqueId;});}},{key:"getMaterialById",value:function getMaterialById(id){var allowMultiMaterials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this._getMaterial(allowMultiMaterials,function(m){return m.id===id;});}},{key:"getMaterialByName",value:function getMaterialByName(name135){var allowMultiMaterials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this._getMaterial(allowMultiMaterials,function(m){return m.name===name135;});}},{key:"getLastMaterialById",value:function getLastMaterialById(id){var allowMultiMaterials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;for(var index=this.materials.length-1;index>=0;index--){if(this.materials[index].id===id){return this.materials[index];}}if(allowMultiMaterials){for(var _index4=this.multiMaterials.length-1;_index4>=0;_index4--){if(this.multiMaterials[_index4].id===id){return this.multiMaterials[_index4];}}}return null;}},{key:"getTextureByUniqueId",value:function getTextureByUniqueId(uniqueId){for(var index=0;index<this.textures.length;index++){if(this.textures[index].uniqueId===uniqueId){return this.textures[index];}}return null;}},{key:"getTextureByName",value:function getTextureByName(name135){for(var index=0;index<this.textures.length;index++){if(this.textures[index].name===name135){return this.textures[index];}}return null;}},{key:"getCameraById",value:function getCameraById(id){for(var index=0;index<this.cameras.length;index++){if(this.cameras[index].id===id){return this.cameras[index];}}return null;}},{key:"getCameraByUniqueId",value:function getCameraByUniqueId(uniqueId){for(var index=0;index<this.cameras.length;index++){if(this.cameras[index].uniqueId===uniqueId){return this.cameras[index];}}return null;}},{key:"getCameraByName",value:function getCameraByName(name135){for(var index=0;index<this.cameras.length;index++){if(this.cameras[index].name===name135){return this.cameras[index];}}return null;}},{key:"getBoneById",value:function getBoneById(id){for(var skeletonIndex=0;skeletonIndex<this.skeletons.length;skeletonIndex++){var skeleton=this.skeletons[skeletonIndex];for(var boneIndex=0;boneIndex<skeleton.bones.length;boneIndex++){if(skeleton.bones[boneIndex].id===id){return skeleton.bones[boneIndex];}}}return null;}},{key:"getBoneByName",value:function getBoneByName(name135){for(var skeletonIndex=0;skeletonIndex<this.skeletons.length;skeletonIndex++){var skeleton=this.skeletons[skeletonIndex];for(var boneIndex=0;boneIndex<skeleton.bones.length;boneIndex++){if(skeleton.bones[boneIndex].name===name135){return skeleton.bones[boneIndex];}}}return null;}},{key:"getLightByName",value:function getLightByName(name135){for(var index=0;index<this.lights.length;index++){if(this.lights[index].name===name135){return this.lights[index];}}return null;}},{key:"getLightById",value:function getLightById(id){for(var index=0;index<this.lights.length;index++){if(this.lights[index].id===id){return this.lights[index];}}return null;}},{key:"getLightByUniqueId",value:function getLightByUniqueId(uniqueId){for(var index=0;index<this.lights.length;index++){if(this.lights[index].uniqueId===uniqueId){return this.lights[index];}}return null;}},{key:"getParticleSystemById",value:function getParticleSystemById(id){for(var index=0;index<this.particleSystems.length;index++){if(this.particleSystems[index].id===id){return this.particleSystems[index];}}return null;}},{key:"getGeometryById",value:function getGeometryById(id){for(var index=0;index<this.geometries.length;index++){if(this.geometries[index].id===id){return this.geometries[index];}}return null;}},{key:"_getGeometryByUniqueId",value:function _getGeometryByUniqueId(uniqueId){if(this._geometriesByUniqueId){var index=this._geometriesByUniqueId[uniqueId];if(index!==void 0){return this.geometries[index];}}else{for(var _index5=0;_index5<this.geometries.length;_index5++){if(this.geometries[_index5].uniqueId===uniqueId){return this.geometries[_index5];}}}return null;}},{key:"pushGeometry",value:function pushGeometry(geometry,force){if(!force&&this._getGeometryByUniqueId(geometry.uniqueId)){return false;}this.addGeometry(geometry);this.onNewGeometryAddedObservable.notifyObservers(geometry);return true;}},{key:"removeGeometry",value:function removeGeometry(geometry){var index;if(this._geometriesByUniqueId){index=this._geometriesByUniqueId[geometry.uniqueId];if(index===void 0){return false;}}else{index=this.geometries.indexOf(geometry);if(index<0){return false;}}if(index!==this.geometries.length-1){var lastGeometry=this.geometries[this.geometries.length-1];if(lastGeometry){this.geometries[index]=lastGeometry;if(this._geometriesByUniqueId){this._geometriesByUniqueId[lastGeometry.uniqueId]=index;}}}if(this._geometriesByUniqueId){this._geometriesByUniqueId[geometry.uniqueId]=void 0;}this.geometries.pop();this.onGeometryRemovedObservable.notifyObservers(geometry);return true;}},{key:"getGeometries",value:function getGeometries(){return this.geometries;}},{key:"getMeshById",value:function getMeshById(id){for(var index=0;index<this.meshes.length;index++){if(this.meshes[index].id===id){return this.meshes[index];}}return null;}},{key:"getMeshesById",value:function getMeshesById(id){return this.meshes.filter(function(m){return m.id===id;});}},{key:"getTransformNodeById",value:function getTransformNodeById(id){for(var index=0;index<this.transformNodes.length;index++){if(this.transformNodes[index].id===id){return this.transformNodes[index];}}return null;}},{key:"getTransformNodeByUniqueId",value:function getTransformNodeByUniqueId(uniqueId){for(var index=0;index<this.transformNodes.length;index++){if(this.transformNodes[index].uniqueId===uniqueId){return this.transformNodes[index];}}return null;}},{key:"getTransformNodesById",value:function getTransformNodesById(id){return this.transformNodes.filter(function(m){return m.id===id;});}},{key:"getMeshByUniqueId",value:function getMeshByUniqueId(uniqueId){for(var index=0;index<this.meshes.length;index++){if(this.meshes[index].uniqueId===uniqueId){return this.meshes[index];}}return null;}},{key:"getLastMeshById",value:function getLastMeshById(id){for(var index=this.meshes.length-1;index>=0;index--){if(this.meshes[index].id===id){return this.meshes[index];}}return null;}},{key:"getLastEntryById",value:function getLastEntryById(id){var index;for(index=this.meshes.length-1;index>=0;index--){if(this.meshes[index].id===id){return this.meshes[index];}}for(index=this.transformNodes.length-1;index>=0;index--){if(this.transformNodes[index].id===id){return this.transformNodes[index];}}for(index=this.cameras.length-1;index>=0;index--){if(this.cameras[index].id===id){return this.cameras[index];}}for(index=this.lights.length-1;index>=0;index--){if(this.lights[index].id===id){return this.lights[index];}}return null;}},{key:"getNodeById",value:function getNodeById(id){var mesh=this.getMeshById(id);if(mesh){return mesh;}var transformNode=this.getTransformNodeById(id);if(transformNode){return transformNode;}var light=this.getLightById(id);if(light){return light;}var camera=this.getCameraById(id);if(camera){return camera;}var bone=this.getBoneById(id);if(bone){return bone;}return null;}},{key:"getNodeByName",value:function getNodeByName(name135){var mesh=this.getMeshByName(name135);if(mesh){return mesh;}var transformNode=this.getTransformNodeByName(name135);if(transformNode){return transformNode;}var light=this.getLightByName(name135);if(light){return light;}var camera=this.getCameraByName(name135);if(camera){return camera;}var bone=this.getBoneByName(name135);if(bone){return bone;}return null;}},{key:"getMeshByName",value:function getMeshByName(name135){for(var index=0;index<this.meshes.length;index++){if(this.meshes[index].name===name135){return this.meshes[index];}}return null;}},{key:"getTransformNodeByName",value:function getTransformNodeByName(name135){for(var index=0;index<this.transformNodes.length;index++){if(this.transformNodes[index].name===name135){return this.transformNodes[index];}}return null;}},{key:"getLastSkeletonById",value:function getLastSkeletonById(id){for(var index=this.skeletons.length-1;index>=0;index--){if(this.skeletons[index].id===id){return this.skeletons[index];}}return null;}},{key:"getSkeletonByUniqueId",value:function getSkeletonByUniqueId(uniqueId){for(var index=0;index<this.skeletons.length;index++){if(this.skeletons[index].uniqueId===uniqueId){return this.skeletons[index];}}return null;}},{key:"getSkeletonById",value:function getSkeletonById(id){for(var index=0;index<this.skeletons.length;index++){if(this.skeletons[index].id===id){return this.skeletons[index];}}return null;}},{key:"getSkeletonByName",value:function getSkeletonByName(name135){for(var index=0;index<this.skeletons.length;index++){if(this.skeletons[index].name===name135){return this.skeletons[index];}}return null;}},{key:"getMorphTargetManagerById",value:function getMorphTargetManagerById(id){for(var index=0;index<this.morphTargetManagers.length;index++){if(this.morphTargetManagers[index].uniqueId===id){return this.morphTargetManagers[index];}}return null;}},{key:"getMorphTargetById",value:function getMorphTargetById(id){for(var managerIndex=0;managerIndex<this.morphTargetManagers.length;++managerIndex){var morphTargetManager=this.morphTargetManagers[managerIndex];for(var index=0;index<morphTargetManager.numTargets;++index){var target=morphTargetManager.getTarget(index);if(target.id===id){return target;}}}return null;}},{key:"getMorphTargetByName",value:function getMorphTargetByName(name135){for(var managerIndex=0;managerIndex<this.morphTargetManagers.length;++managerIndex){var morphTargetManager=this.morphTargetManagers[managerIndex];for(var index=0;index<morphTargetManager.numTargets;++index){var target=morphTargetManager.getTarget(index);if(target.name===name135){return target;}}}return null;}},{key:"getPostProcessByName",value:function getPostProcessByName(name135){for(var postProcessIndex=0;postProcessIndex<this.postProcesses.length;++postProcessIndex){var postProcess=this.postProcesses[postProcessIndex];if(postProcess.name===name135){return postProcess;}}return null;}},{key:"isActiveMesh",value:function isActiveMesh(mesh){return this._activeMeshes.indexOf(mesh)!==-1;}},{key:"uid",get:function get(){if(!this._uid){this._uid=Tools.RandomId();}return this._uid;}},{key:"addExternalData",value:function addExternalData(key,data){if(!this._externalData){this._externalData=new StringDictionary();}return this._externalData.add(key,data);}},{key:"getExternalData",value:function getExternalData(key){if(!this._externalData){return null;}return this._externalData.get(key);}},{key:"getOrAddExternalDataWithFactory",value:function getOrAddExternalDataWithFactory(key,factory){if(!this._externalData){this._externalData=new StringDictionary();}return this._externalData.getOrAddWithFactory(key,factory);}},{key:"removeExternalData",value:function removeExternalData(key){return this._externalData.remove(key);}},{key:"_evaluateSubMesh",value:function _evaluateSubMesh(subMesh,mesh,initialMesh,forcePush){if(forcePush||subMesh.isInFrustum(this._frustumPlanes)){var _iterator46=_createForOfIteratorHelper(this._evaluateSubMeshStage),_step47;try{for(_iterator46.s();!(_step47=_iterator46.n()).done;){var step=_step47.value;step.action(mesh,subMesh);}}catch(err){_iterator46.e(err);}finally{_iterator46.f();}var material=subMesh.getMaterial();if(material!==null&&material!==void 0){if(material.hasRenderTargetTextures&&material.getRenderTargetTextures!=null){if(this._processedMaterials.indexOf(material)===-1){this._processedMaterials.push(material);this._materialsRenderTargets.concatWithNoDuplicate(material.getRenderTargetTextures());}}this._renderingManager.dispatch(subMesh,mesh,material);}}}},{key:"freeProcessedMaterials",value:function freeProcessedMaterials(){this._processedMaterials.dispose();}},{key:"blockfreeActiveMeshesAndRenderingGroups",get:function get(){return this._preventFreeActiveMeshesAndRenderingGroups;},set:function set(value){if(this._preventFreeActiveMeshesAndRenderingGroups===value){return;}if(value){this.freeActiveMeshes();this.freeRenderingGroups();}this._preventFreeActiveMeshesAndRenderingGroups=value;}},{key:"freeActiveMeshes",value:function freeActiveMeshes(){if(this.blockfreeActiveMeshesAndRenderingGroups){return;}this._activeMeshes.dispose();if(this.activeCamera&&this.activeCamera._activeMeshes){this.activeCamera._activeMeshes.dispose();}if(this.activeCameras){for(var i=0;i<this.activeCameras.length;i++){var activeCamera=this.activeCameras[i];if(activeCamera&&activeCamera._activeMeshes){activeCamera._activeMeshes.dispose();}}}}},{key:"freeRenderingGroups",value:function freeRenderingGroups(){if(this.blockfreeActiveMeshesAndRenderingGroups){return;}if(this._renderingManager){this._renderingManager.freeRenderingGroups();}if(this.textures){for(var i=0;i<this.textures.length;i++){var texture=this.textures[i];if(texture&&texture.renderList){texture.freeRenderingGroups();}}}}},{key:"_isInIntermediateRendering",value:function _isInIntermediateRendering(){return this._intermediateRendering;}},{key:"freezeActiveMeshes",value:function freezeActiveMeshes(){var _this57=this;var skipEvaluateActiveMeshes=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var onSuccess=arguments.length>1?arguments[1]:undefined;var onError=arguments.length>2?arguments[2]:undefined;var freezeMeshes=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var keepFrustumCulling=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;this.executeWhenReady(function(){if(!_this57.activeCamera){onError&&onError("No active camera found");return;}if(!_this57._frustumPlanes){_this57.updateTransformMatrix();}_this57._evaluateActiveMeshes();_this57._activeMeshesFrozen=true;_this57._activeMeshesFrozenButKeepClipping=keepFrustumCulling;_this57._skipEvaluateActiveMeshesCompletely=skipEvaluateActiveMeshes;if(freezeMeshes){for(var index=0;index<_this57._activeMeshes.length;index++){_this57._activeMeshes.data[index]._freeze();}}onSuccess&&onSuccess();});return this;}},{key:"unfreezeActiveMeshes",value:function unfreezeActiveMeshes(){for(var index=0;index<this.meshes.length;index++){var mesh=this.meshes[index];if(mesh._internalAbstractMeshDataInfo){mesh._internalAbstractMeshDataInfo._isActive=false;}}for(var _index6=0;_index6<this._activeMeshes.length;_index6++){this._activeMeshes.data[_index6]._unFreeze();}this._activeMeshesFrozen=false;return this;}},{key:"_executeActiveContainerCleanup",value:function _executeActiveContainerCleanup(container){var isInFastMode=this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1;if(!isInFastMode&&this._activeMeshesFrozen&&this._activeMeshes.length){return;}this.onBeforeRenderObservable.addOnce(function(){return container.dispose();});}},{key:"_evaluateActiveMeshes",value:function _evaluateActiveMeshes(){var _a;if(this._engine.snapshotRendering&&this._engine.snapshotRenderingMode===1){if(this._activeMeshes.length>0){(_a=this.activeCamera)===null||_a===void 0?void 0:_a._activeMeshes.reset();this._activeMeshes.reset();this._renderingManager.reset();this._processedMaterials.reset();this._activeParticleSystems.reset();this._activeSkeletons.reset();this._softwareSkinnedMeshes.reset();}return;}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){var len2=this._activeMeshes.length;for(var i=0;i<len2;i++){var mesh=this._activeMeshes.data[i];mesh.computeWorldMatrix();}}if(this._activeParticleSystems){var psLength=this._activeParticleSystems.length;for(var _i10=0;_i10<psLength;_i10++){this._activeParticleSystems.data[_i10].animate();}}this._renderingManager.resetSprites();return;}if(!this.activeCamera){return;}this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this);this.activeCamera._activeMeshes.reset();this._activeMeshes.reset();this._renderingManager.reset();this._processedMaterials.reset();this._activeParticleSystems.reset();this._activeSkeletons.reset();this._softwareSkinnedMeshes.reset();this._materialsRenderTargets.reset();var _iterator47=_createForOfIteratorHelper(this._beforeEvaluateActiveMeshStage),_step48;try{for(_iterator47.s();!(_step48=_iterator47.n()).done;){var _step50=_step48.value;_step50.action();}}catch(err){_iterator47.e(err);}finally{_iterator47.f();}var meshes=this.getActiveMeshCandidates();var len=meshes.length;for(var _i11=0;_i11<len;_i11++){var _mesh=meshes.data[_i11];_mesh._internalAbstractMeshDataInfo._currentLODIsUpToDate=false;if(_mesh.isBlocked){continue;}this._totalVertices.addCount(_mesh.getTotalVertices(),false);if(!_mesh.isReady()||!_mesh.isEnabled()||_mesh.scaling.hasAZeroComponent){continue;}_mesh.computeWorldMatrix();if(_mesh.actionManager&&_mesh.actionManager.hasSpecificTriggers2(12,13)){this._meshesForIntersections.pushNoDuplicate(_mesh);}var meshToRender=this.customLODSelector?this.customLODSelector(_mesh,this.activeCamera):_mesh.getLOD(this.activeCamera);_mesh._internalAbstractMeshDataInfo._currentLOD=meshToRender;_mesh._internalAbstractMeshDataInfo._currentLODIsUpToDate=true;if(meshToRender===void 0||meshToRender===null){continue;}if(meshToRender!==_mesh&&meshToRender.billboardMode!==0){meshToRender.computeWorldMatrix();}_mesh._preActivate();if(_mesh.isVisible&&_mesh.visibility>0&&(_mesh.layerMask&this.activeCamera.layerMask)!==0&&(this._skipFrustumClipping||_mesh.alwaysSelectAsActiveMesh||_mesh.isInFrustum(this._frustumPlanes))){this._activeMeshes.push(_mesh);this.activeCamera._activeMeshes.push(_mesh);if(meshToRender!==_mesh){meshToRender._activate(this._renderId,false);}var _iterator48=_createForOfIteratorHelper(this._preActiveMeshStage),_step49;try{for(_iterator48.s();!(_step49=_iterator48.n()).done;){var step=_step49.value;step.action(_mesh);}}catch(err){_iterator48.e(err);}finally{_iterator48.f();}if(_mesh._activate(this._renderId,false)){if(!_mesh.isAnInstance){meshToRender._internalAbstractMeshDataInfo._onlyForInstances=false;}else{if(_mesh._internalAbstractMeshDataInfo._actAsRegularMesh){meshToRender=_mesh;}}meshToRender._internalAbstractMeshDataInfo._isActive=true;this._activeMesh(_mesh,meshToRender);}_mesh._postActivate();}}if(this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var particleIndex=0;particleIndex<this.particleSystems.length;particleIndex++){var particleSystem=this.particleSystems[particleIndex];if(!particleSystem.isStarted()||!particleSystem.emitter){continue;}var emitter=particleSystem.emitter;if(!emitter.position||emitter.isEnabled()){this._activeParticleSystems.push(particleSystem);particleSystem.animate();this._renderingManager.dispatchParticles(particleSystem);}}this.onAfterParticlesRenderingObservable.notifyObservers(this);}}},{key:"_activeMesh",value:function _activeMesh(sourceMesh,mesh){if(this._skeletonsEnabled&&mesh.skeleton!==null&&mesh.skeleton!==void 0){if(this._activeSkeletons.pushNoDuplicate(mesh.skeleton)){mesh.skeleton.prepare();this._activeBones.addCount(mesh.skeleton.bones.length,false);}if(!mesh.computeBonesUsingShaders){this._softwareSkinnedMeshes.pushNoDuplicate(mesh);}}var forcePush=sourceMesh.hasInstances||sourceMesh.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||mesh.alwaysSelectAsActiveMesh;if(mesh&&mesh.subMeshes&&mesh.subMeshes.length>0){var subMeshes=this.getActiveSubMeshCandidates(mesh);var len=subMeshes.length;forcePush=forcePush||len===1;for(var i=0;i<len;i++){var subMesh=subMeshes.data[i];this._evaluateSubMesh(subMesh,mesh,sourceMesh,forcePush);}}}},{key:"updateTransformMatrix",value:function updateTransformMatrix(force){if(!this.activeCamera){return;}if(this.activeCamera._renderingMultiview){var leftCamera=this.activeCamera._rigCameras[0];var rightCamera=this.activeCamera._rigCameras[1];this.setTransformMatrix(leftCamera.getViewMatrix(),leftCamera.getProjectionMatrix(force),rightCamera.getViewMatrix(),rightCamera.getProjectionMatrix(force));}else{this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(force));}}},{key:"_bindFrameBuffer",value:function _bindFrameBuffer(camera){var clear=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(camera&&camera._multiviewTexture){camera._multiviewTexture._bindFrameBuffer();}else if(camera&&camera.outputRenderTarget){camera.outputRenderTarget._bindFrameBuffer();}else{if(!this._engine._currentFrameBufferIsDefaultFrameBuffer()){this._engine.restoreDefaultFramebuffer();}}if(clear){this._clearFrameBuffer(camera);}}},{key:"_clearFrameBuffer",value:function _clearFrameBuffer(camera){if(camera&&camera._multiviewTexture){}else if(camera&&camera.outputRenderTarget&&!camera._renderingMultiview){var rtt=camera.outputRenderTarget;if(rtt.onClearObservable.hasObservers()){rtt.onClearObservable.notifyObservers(this._engine);}else if(!rtt.skipInitialClear){if(this.autoClear){this._engine.clear(rtt.clearColor||this.clearColor,!rtt._cleared,true,true);}rtt._cleared=true;}}else{if(!this._defaultFrameBufferCleared){this._defaultFrameBufferCleared=true;this._clear();}else{this._engine.clear(null,false,true,true);}}}},{key:"_renderForCamera",value:function _renderForCamera(camera,rigParent){var bindFrameBuffer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var _a,_b,_c;if(camera&&camera._skipRendering){return;}var engine=this._engine;this._activeCamera=camera;if(!this.activeCamera){throw new Error("Active camera not set");}engine.setViewport(this.activeCamera.viewport);this.resetCachedMaterial();this._renderId++;if(!this.prePass&&bindFrameBuffer){var skipInitialClear=true;if(camera._renderingMultiview&&camera.outputRenderTarget){skipInitialClear=camera.outputRenderTarget.skipInitialClear;if(this.autoClear){this._defaultFrameBufferCleared=false;camera.outputRenderTarget.skipInitialClear=false;}}this._bindFrameBuffer(this._activeCamera);if(camera._renderingMultiview&&camera.outputRenderTarget){camera.outputRenderTarget.skipInitialClear=skipInitialClear;}}this.updateTransformMatrix();this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera);this._evaluateActiveMeshes();for(var softwareSkinnedMeshIndex=0;softwareSkinnedMeshIndex<this._softwareSkinnedMeshes.length;softwareSkinnedMeshIndex++){var mesh=this._softwareSkinnedMeshes.data[softwareSkinnedMeshIndex];mesh.applySkeleton(mesh.skeleton);}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets);if(camera.customRenderTargets&&camera.customRenderTargets.length>0){this._renderTargets.concatWithNoDuplicate(camera.customRenderTargets);}if(rigParent&&rigParent.customRenderTargets&&rigParent.customRenderTargets.length>0){this._renderTargets.concatWithNoDuplicate(rigParent.customRenderTargets);}if(this.environmentTexture&&this.environmentTexture.isRenderTarget){this._renderTargets.pushNoDuplicate(this.environmentTexture);}var _iterator49=_createForOfIteratorHelper(this._gatherActiveCameraRenderTargetsStage),_step51;try{for(_iterator49.s();!(_step51=_iterator49.n()).done;){var _step56=_step51.value;_step56.action(this._renderTargets);}}catch(err){_iterator49.e(err);}finally{_iterator49.f();}var needRebind=false;if(this.renderTargetsEnabled){this._intermediateRendering=true;if(this._renderTargets.length>0){Tools.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var renderIndex=0;renderIndex<this._renderTargets.length;renderIndex++){var renderTarget=this._renderTargets.data[renderIndex];if(renderTarget._shouldRender()){this._renderId++;var hasSpecialRenderTargetCamera=renderTarget.activeCamera&&renderTarget.activeCamera!==this.activeCamera;renderTarget.render(hasSpecialRenderTargetCamera,this.dumpNextRenderTargets);needRebind=true;}}Tools.EndPerformanceCounter("Render targets",this._renderTargets.length>0);this._renderId++;}var _iterator50=_createForOfIteratorHelper(this._cameraDrawRenderTargetStage),_step52;try{for(_iterator50.s();!(_step52=_iterator50.n()).done;){var step=_step52.value;needRebind=step.action(this.activeCamera)||needRebind;}}catch(err){_iterator50.e(err);}finally{_iterator50.f();}this._intermediateRendering=false;}this._engine.currentRenderPassId=(_c=(_b=(_a=camera.outputRenderTarget)===null||_a===void 0?void 0:_a.renderPassId)!==null&&_b!==void 0?_b:camera.renderPassId)!==null&&_c!==void 0?_c:0;if(needRebind&&!this.prePass){this._bindFrameBuffer(this._activeCamera,false);}this.onAfterRenderTargetsRenderObservable.notifyObservers(this);if(this.postProcessManager&&!camera._multiviewTexture&&!this.prePass){this.postProcessManager._prepareFrame();}var _iterator51=_createForOfIteratorHelper(this._beforeCameraDrawStage),_step53;try{for(_iterator51.s();!(_step53=_iterator51.n()).done;){var _step57=_step53.value;_step57.action(this.activeCamera);}}catch(err){_iterator51.e(err);}finally{_iterator51.f();}this.onBeforeDrawPhaseObservable.notifyObservers(this);if(engine.snapshotRendering&&engine.snapshotRenderingMode===1){this.finalizeSceneUbo();}this._renderingManager.render(null,null,true,true);this.onAfterDrawPhaseObservable.notifyObservers(this);var _iterator52=_createForOfIteratorHelper(this._afterCameraDrawStage),_step54;try{for(_iterator52.s();!(_step54=_iterator52.n()).done;){var _step58=_step54.value;_step58.action(this.activeCamera);}}catch(err){_iterator52.e(err);}finally{_iterator52.f();}if(this.postProcessManager&&!camera._multiviewTexture){var texture=camera.outputRenderTarget?camera.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(camera.isIntermediate,texture);}var _iterator53=_createForOfIteratorHelper(this._afterCameraPostProcessStage),_step55;try{for(_iterator53.s();!(_step55=_iterator53.n()).done;){var _step59=_step55.value;_step59.action(this.activeCamera);}}catch(err){_iterator53.e(err);}finally{_iterator53.f();}this._renderTargets.reset();this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera);}},{key:"_processSubCameras",value:function _processSubCameras(camera){var bindFrameBuffer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(camera.cameraRigMode===0||camera._renderingMultiview){if(camera._renderingMultiview&&!this._multiviewSceneUbo){this._createMultiviewUbo();}this._renderForCamera(camera,void 0,bindFrameBuffer);this.onAfterRenderCameraObservable.notifyObservers(camera);return;}if(camera._useMultiviewToSingleView){this._renderMultiviewToSingleView(camera);}else{this.onBeforeCameraRenderObservable.notifyObservers(camera);for(var index=0;index<camera._rigCameras.length;index++){this._renderForCamera(camera._rigCameras[index],camera);}}this._activeCamera=camera;this.updateTransformMatrix();this.onAfterRenderCameraObservable.notifyObservers(camera);}},{key:"_checkIntersections",value:function _checkIntersections(){for(var index=0;index<this._meshesForIntersections.length;index++){var sourceMesh=this._meshesForIntersections.data[index];if(!sourceMesh.actionManager){continue;}var _loop3=function _loop3(){var action=sourceMesh.actionManager.actions[actionIndex];if(action.trigger===12||action.trigger===13){var parameters=action.getTriggerParameter();var otherMesh=parameters.mesh?parameters.mesh:parameters;var areIntersecting=otherMesh.intersectsMesh(sourceMesh,parameters.usePreciseIntersection);var currentIntersectionInProgress=sourceMesh._intersectionsInProgress.indexOf(otherMesh);if(areIntersecting&&currentIntersectionInProgress===-1){if(action.trigger===12){action._executeCurrent(ActionEvent.CreateNew(sourceMesh,void 0,otherMesh));sourceMesh._intersectionsInProgress.push(otherMesh);}else if(action.trigger===13){sourceMesh._intersectionsInProgress.push(otherMesh);}}else if(!areIntersecting&&currentIntersectionInProgress>-1){if(action.trigger===13){action._executeCurrent(ActionEvent.CreateNew(sourceMesh,void 0,otherMesh));}if(!sourceMesh.actionManager.hasSpecificTrigger(13,function(parameter){var parameterMesh=parameter.mesh?parameter.mesh:parameter;return otherMesh===parameterMesh;})||action.trigger===13){sourceMesh._intersectionsInProgress.splice(currentIntersectionInProgress,1);}}}};for(var actionIndex=0;sourceMesh.actionManager&&actionIndex<sourceMesh.actionManager.actions.length;actionIndex++){_loop3();}}}},{key:"_advancePhysicsEngineStep",value:function _advancePhysicsEngineStep(step){}},{key:"_animate",value:function _animate(){}},{key:"animate",value:function animate(){if(this._engine.isDeterministicLockStep()){var deltaTime=Math.max(Scene.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Scene.MaxDeltaTime))+this._timeAccumulator;var defaultFrameTime=this._engine.getTimeStep();var defaultFPS=1e3/defaultFrameTime/1e3;var stepsTaken=0;var maxSubSteps=this._engine.getLockstepMaxSteps();var internalSteps=Math.floor(deltaTime/defaultFrameTime);internalSteps=Math.min(internalSteps,maxSubSteps);while(deltaTime>0&&stepsTaken<internalSteps){this.onBeforeStepObservable.notifyObservers(this);this._animationRatio=defaultFrameTime*defaultFPS;this._animate();this.onAfterAnimationsObservable.notifyObservers(this);if(this.physicsEnabled){this._advancePhysicsEngineStep(defaultFrameTime);}this.onAfterStepObservable.notifyObservers(this);this._currentStepId++;stepsTaken++;deltaTime-=defaultFrameTime;}this._timeAccumulator=deltaTime<0?0:deltaTime;}else{var _deltaTime=this.useConstantAnimationDeltaTime?16:Math.max(Scene.MinDeltaTime,Math.min(this._engine.getDeltaTime(),Scene.MaxDeltaTime));this._animationRatio=_deltaTime*(60/1e3);this._animate();this.onAfterAnimationsObservable.notifyObservers(this);if(this.physicsEnabled){this._advancePhysicsEngineStep(_deltaTime);}}}},{key:"_clear",value:function _clear(){if(this.autoClearDepthAndStencil||this.autoClear){this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil);}}},{key:"_checkCameraRenderTarget",value:function _checkCameraRenderTarget(camera){var _a;if((camera===null||camera===void 0?void 0:camera.outputRenderTarget)&&!(camera===null||camera===void 0?void 0:camera.isRigCamera)){camera.outputRenderTarget._cleared=false;}if((_a=camera===null||camera===void 0?void 0:camera.rigCameras)===null||_a===void 0?void 0:_a.length){for(var i=0;i<camera.rigCameras.length;++i){var rtt=camera.rigCameras[i].outputRenderTarget;if(rtt){rtt._cleared=false;}}}}},{key:"resetDrawCache",value:function resetDrawCache(passId){if(!this.meshes){return;}var _iterator54=_createForOfIteratorHelper(this.meshes),_step60;try{for(_iterator54.s();!(_step60=_iterator54.n()).done;){var mesh=_step60.value;mesh.resetDrawCache(passId);}}catch(err){_iterator54.e(err);}finally{_iterator54.f();}}},{key:"render",value:function render(){var updateCameras=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var ignoreAnimations=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _a,_b,_c;if(this.isDisposed){return;}if(this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===null){this._checkIsReady();}this._frameId++;this._defaultFrameBufferCleared=false;this._checkCameraRenderTarget(this.activeCamera);if((_a=this.activeCameras)===null||_a===void 0?void 0:_a.length){this.activeCameras.forEach(this._checkCameraRenderTarget);}this._registerTransientComponents();this._activeParticles.fetchNewFrame();this._totalVertices.fetchNewFrame();this._activeIndices.fetchNewFrame();this._activeBones.fetchNewFrame();this._meshesForIntersections.reset();this.resetCachedMaterial();this.onBeforeAnimationsObservable.notifyObservers(this);if(this.actionManager){this.actionManager.processTrigger(11);}if(!ignoreAnimations){this.animate();}var _iterator55=_createForOfIteratorHelper(this._beforeCameraUpdateStage),_step61;try{for(_iterator55.s();!(_step61=_iterator55.n()).done;){var step=_step61.value;step.action();}}catch(err){_iterator55.e(err);}finally{_iterator55.f();}if(updateCameras){if(this.activeCameras&&this.activeCameras.length>0){for(var cameraIndex=0;cameraIndex<this.activeCameras.length;cameraIndex++){var camera=this.activeCameras[cameraIndex];camera.update();if(camera.cameraRigMode!==0){for(var index=0;index<camera._rigCameras.length;index++){camera._rigCameras[index].update();}}}}else if(this.activeCamera){this.activeCamera.update();if(this.activeCamera.cameraRigMode!==0){for(var _index7=0;_index7<this.activeCamera._rigCameras.length;_index7++){this.activeCamera._rigCameras[_index7].update();}}}}this.onBeforeRenderObservable.notifyObservers(this);var engine=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var currentActiveCamera=((_b=this.activeCameras)===null||_b===void 0?void 0:_b.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){Tools.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);this._intermediateRendering=true;for(var customIndex=0;customIndex<this.customRenderTargets.length;customIndex++){var renderTarget=this.customRenderTargets[customIndex];if(renderTarget._shouldRender()){this._renderId++;this.activeCamera=renderTarget.activeCamera||this.activeCamera;if(!this.activeCamera){throw new Error("Active camera not set");}engine.setViewport(this.activeCamera.viewport);this.updateTransformMatrix();renderTarget.render(currentActiveCamera!==this.activeCamera,this.dumpNextRenderTargets);}}Tools.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);this._intermediateRendering=false;this._renderId++;}this._engine.currentRenderPassId=(_c=currentActiveCamera===null||currentActiveCamera===void 0?void 0:currentActiveCamera.renderPassId)!==null&&_c!==void 0?_c:0;this.activeCamera=currentActiveCamera;if(this._activeCamera&&this._activeCamera.cameraRigMode!==22&&!this.prePass){this._bindFrameBuffer(this._activeCamera,false);}this.onAfterRenderTargetsRenderObservable.notifyObservers(this);var _iterator56=_createForOfIteratorHelper(this._beforeClearStage),_step62;try{for(_iterator56.s();!(_step62=_iterator56.n()).done;){var _step65=_step62.value;_step65.action();}}catch(err){_iterator56.e(err);}finally{_iterator56.f();}this._clearFrameBuffer(this.activeCamera);var _iterator57=_createForOfIteratorHelper(this._gatherRenderTargetsStage),_step63;try{for(_iterator57.s();!(_step63=_iterator57.n()).done;){var _step66=_step63.value;_step66.action(this._renderTargets);}}catch(err){_iterator57.e(err);}finally{_iterator57.f();}if(this.activeCameras&&this.activeCameras.length>0){for(var _cameraIndex=0;_cameraIndex<this.activeCameras.length;_cameraIndex++){this._processSubCameras(this.activeCameras[_cameraIndex],_cameraIndex>0);}}else{if(!this.activeCamera){throw new Error("No camera defined");}this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget);}this._checkIntersections();var _iterator58=_createForOfIteratorHelper(this._afterRenderStage),_step64;try{for(_iterator58.s();!(_step64=_iterator58.n()).done;){var _step67=_step64.value;_step67.action();}}catch(err){_iterator58.e(err);}finally{_iterator58.f();}if(this.afterRender){this.afterRender();}this.onAfterRenderObservable.notifyObservers(this);if(this._toBeDisposed.length){for(var _index8=0;_index8<this._toBeDisposed.length;_index8++){var data=this._toBeDisposed[_index8];if(data){data.dispose();}}this._toBeDisposed.length=0;}if(this.dumpNextRenderTargets){this.dumpNextRenderTargets=false;}this._activeBones.addCount(0,true);this._activeIndices.addCount(0,true);this._activeParticles.addCount(0,true);this._engine.restoreDefaultFramebuffer();}},{key:"freezeMaterials",value:function freezeMaterials(){for(var i=0;i<this.materials.length;i++){this.materials[i].freeze();}}},{key:"unfreezeMaterials",value:function unfreezeMaterials(){for(var i=0;i<this.materials.length;i++){this.materials[i].unfreeze();}}},{key:"dispose",value:function dispose(){if(this.isDisposed){return;}this.beforeRender=null;this.afterRender=null;this.metadata=null;this.skeletons.length=0;this.morphTargetManagers.length=0;this._transientComponents.length=0;this._isReadyForMeshStage.clear();this._beforeEvaluateActiveMeshStage.clear();this._evaluateSubMeshStage.clear();this._preActiveMeshStage.clear();this._cameraDrawRenderTargetStage.clear();this._beforeCameraDrawStage.clear();this._beforeRenderTargetDrawStage.clear();this._beforeRenderingGroupDrawStage.clear();this._beforeRenderingMeshStage.clear();this._afterRenderingMeshStage.clear();this._afterRenderingGroupDrawStage.clear();this._afterCameraDrawStage.clear();this._afterRenderTargetDrawStage.clear();this._afterRenderStage.clear();this._beforeCameraUpdateStage.clear();this._beforeClearStage.clear();this._gatherRenderTargetsStage.clear();this._gatherActiveCameraRenderTargetsStage.clear();this._pointerMoveStage.clear();this._pointerDownStage.clear();this._pointerUpStage.clear();this.importedMeshesFiles=new Array();if(this.stopAllAnimations){this.stopAllAnimations();}this.resetCachedMaterial();if(this.activeCamera){this.activeCamera._activeMeshes.dispose();this.activeCamera=null;}this.activeCameras=null;this._activeMeshes.dispose();this._renderingManager.dispose();this._processedMaterials.dispose();this._activeParticleSystems.dispose();this._activeSkeletons.dispose();this._softwareSkinnedMeshes.dispose();this._renderTargets.dispose();this._materialsRenderTargets.dispose();this._registeredForLateAnimationBindings.dispose();this._meshesForIntersections.dispose();this._toBeDisposed.length=0;var activeRequests=this._activeRequests.slice();var _iterator59=_createForOfIteratorHelper(activeRequests),_step68;try{for(_iterator59.s();!(_step68=_iterator59.n()).done;){var request=_step68.value;request.abort();}}catch(err){_iterator59.e(err);}finally{_iterator59.f();}this._activeRequests.length=0;try{this.onDisposeObservable.notifyObservers(this);}catch(e){console.error("An error occurred while calling onDisposeObservable!",e);}this.onDisposeObservable.clear();this.onBeforeRenderObservable.clear();this.onAfterRenderObservable.clear();this.onBeforeRenderTargetsRenderObservable.clear();this.onAfterRenderTargetsRenderObservable.clear();this.onAfterStepObservable.clear();this.onBeforeStepObservable.clear();this.onBeforeActiveMeshesEvaluationObservable.clear();this.onAfterActiveMeshesEvaluationObservable.clear();this.onBeforeParticlesRenderingObservable.clear();this.onAfterParticlesRenderingObservable.clear();this.onBeforeDrawPhaseObservable.clear();this.onAfterDrawPhaseObservable.clear();this.onBeforeAnimationsObservable.clear();this.onAfterAnimationsObservable.clear();this.onDataLoadedObservable.clear();this.onBeforeRenderingGroupObservable.clear();this.onAfterRenderingGroupObservable.clear();this.onMeshImportedObservable.clear();this.onBeforeCameraRenderObservable.clear();this.onAfterCameraRenderObservable.clear();this.onReadyObservable.clear();this.onNewCameraAddedObservable.clear();this.onCameraRemovedObservable.clear();this.onNewLightAddedObservable.clear();this.onLightRemovedObservable.clear();this.onNewGeometryAddedObservable.clear();this.onGeometryRemovedObservable.clear();this.onNewTransformNodeAddedObservable.clear();this.onTransformNodeRemovedObservable.clear();this.onNewMeshAddedObservable.clear();this.onMeshRemovedObservable.clear();this.onNewSkeletonAddedObservable.clear();this.onSkeletonRemovedObservable.clear();this.onNewMaterialAddedObservable.clear();this.onNewMultiMaterialAddedObservable.clear();this.onMaterialRemovedObservable.clear();this.onMultiMaterialRemovedObservable.clear();this.onNewTextureAddedObservable.clear();this.onTextureRemovedObservable.clear();this.onPrePointerObservable.clear();this.onPointerObservable.clear();this.onPreKeyboardObservable.clear();this.onKeyboardObservable.clear();this.onActiveCameraChanged.clear();this.detachControl();var canvas=this._engine.getInputElement();if(canvas){for(var index2=0;index2<this.cameras.length;index2++){this.cameras[index2].detachControl();}}this._disposeList(this.animationGroups);this._disposeList(this.lights);this._disposeList(this.meshes,function(item){return item.dispose(true);});this._disposeList(this.transformNodes,function(item){return item.dispose(true);});var cameras=this.cameras;this._disposeList(cameras);if(this._defaultMaterial){this._defaultMaterial.dispose();}this._disposeList(this.multiMaterials);this._disposeList(this.materials);this._disposeList(this.particleSystems);this._disposeList(this.postProcesses);this._disposeList(this.textures);this._disposeList(this.morphTargetManagers);this._sceneUbo.dispose();if(this._multiviewSceneUbo){this._multiviewSceneUbo.dispose();}this.postProcessManager.dispose();this._disposeList(this._components);var index=this._engine.scenes.indexOf(this);if(index>-1){this._engine.scenes.splice(index,1);}if(EngineStore._LastCreatedScene===this){if(this._engine.scenes.length>0){EngineStore._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1];}else{EngineStore._LastCreatedScene=null;}}index=this._engine._virtualScenes.indexOf(this);if(index>-1){this._engine._virtualScenes.splice(index,1);}this._engine.wipeCaches(true);this._isDisposed=true;}},{key:"_disposeList",value:function _disposeList(items,callback){var itemsCopy=items.slice(0);callback=callback!==null&&callback!==void 0?callback:function(item){return item.dispose();};var _iterator60=_createForOfIteratorHelper(itemsCopy),_step69;try{for(_iterator60.s();!(_step69=_iterator60.n()).done;){var item=_step69.value;callback(item);}}catch(err){_iterator60.e(err);}finally{_iterator60.f();}items.length=0;}},{key:"isDisposed",get:function get(){return this._isDisposed;}},{key:"clearCachedVertexData",value:function clearCachedVertexData(){for(var meshIndex=0;meshIndex<this.meshes.length;meshIndex++){var mesh=this.meshes[meshIndex];var geometry=mesh.geometry;if(geometry){geometry.clearCachedData();}}}},{key:"cleanCachedTextureBuffer",value:function cleanCachedTextureBuffer(){var _iterator61=_createForOfIteratorHelper(this.textures),_step70;try{for(_iterator61.s();!(_step70=_iterator61.n()).done;){var baseTexture=_step70.value;var buffer=baseTexture._buffer;if(buffer){baseTexture._buffer=null;}}}catch(err){_iterator61.e(err);}finally{_iterator61.f();}}},{key:"getWorldExtends",value:function getWorldExtends(filterPredicate){var min=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);var max=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);filterPredicate=filterPredicate||function(){return true;};this.meshes.filter(filterPredicate).forEach(function(mesh){mesh.computeWorldMatrix(true);if(!mesh.subMeshes||mesh.subMeshes.length===0||mesh.infiniteDistance){return;}var boundingInfo=mesh.getBoundingInfo();var minBox=boundingInfo.boundingBox.minimumWorld;var maxBox=boundingInfo.boundingBox.maximumWorld;Vector3.CheckExtends(minBox,min,max);Vector3.CheckExtends(maxBox,min,max);});return{min:min,max:max};}},{key:"createPickingRay",value:function createPickingRay(x,y,world,camera){var cameraViewSpace=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;throw _WarnImport("Ray");}},{key:"createPickingRayToRef",value:function createPickingRayToRef(x,y,world,result,camera){var cameraViewSpace=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var enableDistantPicking=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;throw _WarnImport("Ray");}},{key:"createPickingRayInCameraSpace",value:function createPickingRayInCameraSpace(x,y,camera){throw _WarnImport("Ray");}},{key:"createPickingRayInCameraSpaceToRef",value:function createPickingRayInCameraSpaceToRef(x,y,result,camera){throw _WarnImport("Ray");}},{key:"_pickingAvailable",get:function get(){return false;}},{key:"pick",value:function pick(x,y,predicate,fastCheck,camera,trianglePredicate){return new PickingInfo();}},{key:"pickWithBoundingInfo",value:function pickWithBoundingInfo(x,y,predicate,fastCheck,camera){return new PickingInfo();}},{key:"pickWithRay",value:function pickWithRay(ray,predicate,fastCheck,trianglePredicate){throw _WarnImport("Ray");}},{key:"multiPick",value:function multiPick(x,y,predicate,camera,trianglePredicate){throw _WarnImport("Ray");}},{key:"multiPickWithRay",value:function multiPickWithRay(ray,predicate,trianglePredicate){throw _WarnImport("Ray");}},{key:"setPointerOverMesh",value:function setPointerOverMesh(mesh,pointerId,pickResult){this._inputManager.setPointerOverMesh(mesh,pointerId,pickResult);}},{key:"getPointerOverMesh",value:function getPointerOverMesh(){return this._inputManager.getPointerOverMesh();}},{key:"_rebuildGeometries",value:function _rebuildGeometries(){var _iterator62=_createForOfIteratorHelper(this.geometries),_step71;try{for(_iterator62.s();!(_step71=_iterator62.n()).done;){var geometry=_step71.value;geometry._rebuild();}}catch(err){_iterator62.e(err);}finally{_iterator62.f();}var _iterator63=_createForOfIteratorHelper(this.meshes),_step72;try{for(_iterator63.s();!(_step72=_iterator63.n()).done;){var mesh=_step72.value;mesh._rebuild();}}catch(err){_iterator63.e(err);}finally{_iterator63.f();}if(this.postProcessManager){this.postProcessManager._rebuild();}var _iterator64=_createForOfIteratorHelper(this._components),_step73;try{for(_iterator64.s();!(_step73=_iterator64.n()).done;){var component=_step73.value;component.rebuild();}}catch(err){_iterator64.e(err);}finally{_iterator64.f();}var _iterator65=_createForOfIteratorHelper(this.particleSystems),_step74;try{for(_iterator65.s();!(_step74=_iterator65.n()).done;){var system=_step74.value;system.rebuild();}}catch(err){_iterator65.e(err);}finally{_iterator65.f();}if(this.spriteManagers){var _iterator66=_createForOfIteratorHelper(this.spriteManagers),_step75;try{for(_iterator66.s();!(_step75=_iterator66.n()).done;){var spriteMgr=_step75.value;spriteMgr.rebuild();}}catch(err){_iterator66.e(err);}finally{_iterator66.f();}}}},{key:"_rebuildTextures",value:function _rebuildTextures(){var _iterator67=_createForOfIteratorHelper(this.textures),_step76;try{for(_iterator67.s();!(_step76=_iterator67.n()).done;){var texture=_step76.value;texture._rebuild();}}catch(err){_iterator67.e(err);}finally{_iterator67.f();}this.markAllMaterialsAsDirty(1);}},{key:"_getByTags",value:function _getByTags(list,tagsQuery,forEach){if(tagsQuery===void 0){return list;}var listByTags=[];forEach=forEach||function(item){return;};for(var i in list){var item=list[i];if(Tags&&Tags.MatchesQuery(item,tagsQuery)){listByTags.push(item);forEach(item);}}return listByTags;}},{key:"getMeshesByTags",value:function getMeshesByTags(tagsQuery,forEach){return this._getByTags(this.meshes,tagsQuery,forEach);}},{key:"getCamerasByTags",value:function getCamerasByTags(tagsQuery,forEach){return this._getByTags(this.cameras,tagsQuery,forEach);}},{key:"getLightsByTags",value:function getLightsByTags(tagsQuery,forEach){return this._getByTags(this.lights,tagsQuery,forEach);}},{key:"getMaterialByTags",value:function getMaterialByTags(tagsQuery,forEach){return this._getByTags(this.materials,tagsQuery,forEach).concat(this._getByTags(this.multiMaterials,tagsQuery,forEach));}},{key:"getTransformNodesByTags",value:function getTransformNodesByTags(tagsQuery,forEach){return this._getByTags(this.transformNodes,tagsQuery,forEach);}},{key:"setRenderingOrder",value:function setRenderingOrder(renderingGroupId){var opaqueSortCompareFn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var alphaTestSortCompareFn=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var transparentSortCompareFn=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;this._renderingManager.setRenderingOrder(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn);}},{key:"setRenderingAutoClearDepthStencil",value:function setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil){var depth=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var stencil=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;this._renderingManager.setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil,depth,stencil);}},{key:"getAutoClearDepthStencilSetup",value:function getAutoClearDepthStencilSetup(index){return this._renderingManager.getAutoClearDepthStencilSetup(index);}},{key:"blockMaterialDirtyMechanism",get:function get(){return this._blockMaterialDirtyMechanism;},set:function set(value){if(this._blockMaterialDirtyMechanism===value){return;}this._blockMaterialDirtyMechanism=value;if(!value){this.markAllMaterialsAsDirty(63);}}},{key:"markAllMaterialsAsDirty",value:function markAllMaterialsAsDirty(flag,predicate){if(this._blockMaterialDirtyMechanism){return;}var _iterator68=_createForOfIteratorHelper(this.materials),_step77;try{for(_iterator68.s();!(_step77=_iterator68.n()).done;){var material=_step77.value;if(predicate&&!predicate(material)){continue;}material.markAsDirty(flag);}}catch(err){_iterator68.e(err);}finally{_iterator68.f();}}},{key:"_loadFile",value:function _loadFile(fileOrUrl,onSuccess,onProgress,useOfflineSupport,useArrayBuffer,onError,onOpened){var _this58=this;var request=_LoadFile(fileOrUrl,onSuccess,onProgress,useOfflineSupport?this.offlineProvider:void 0,useArrayBuffer,onError,onOpened);this._activeRequests.push(request);request.onCompleteObservable.add(function(request2){_this58._activeRequests.splice(_this58._activeRequests.indexOf(request2),1);});return request;}},{key:"_loadFileAsync",value:function _loadFileAsync(fileOrUrl,onProgress,useOfflineSupport,useArrayBuffer,onOpened){var _this59=this;return new Promise(function(resolve,reject){_this59._loadFile(fileOrUrl,function(data){resolve(data);},onProgress,useOfflineSupport,useArrayBuffer,function(request,exception){reject(exception);},onOpened);});}},{key:"_requestFile",value:function _requestFile(url,onSuccess,onProgress,useOfflineSupport,useArrayBuffer,onError,onOpened){var _this60=this;var request=RequestFile(url,onSuccess,onProgress,useOfflineSupport?this.offlineProvider:void 0,useArrayBuffer,onError,onOpened);this._activeRequests.push(request);request.onCompleteObservable.add(function(request2){_this60._activeRequests.splice(_this60._activeRequests.indexOf(request2),1);});return request;}},{key:"_requestFileAsync",value:function _requestFileAsync(url,onProgress,useOfflineSupport,useArrayBuffer,onOpened){var _this61=this;return new Promise(function(resolve,reject){_this61._requestFile(url,function(data){resolve(data);},onProgress,useOfflineSupport,useArrayBuffer,function(error){reject(error);},onOpened);});}},{key:"_readFile",value:function _readFile(file,onSuccess,onProgress,useArrayBuffer,onError){var _this62=this;var request=_ReadFile(file,onSuccess,onProgress,useArrayBuffer,onError);this._activeRequests.push(request);request.onCompleteObservable.add(function(request2){_this62._activeRequests.splice(_this62._activeRequests.indexOf(request2),1);});return request;}},{key:"_readFileAsync",value:function _readFileAsync(file,onProgress,useArrayBuffer){var _this63=this;return new Promise(function(resolve,reject){_this63._readFile(file,function(data){resolve(data);},onProgress,useArrayBuffer,function(error){reject(error);});});}},{key:"getPerfCollector",value:function getPerfCollector(){throw _WarnImport("performanceViewerSceneExtension");}}],[{key:"DefaultMaterialFactory",value:function DefaultMaterialFactory(scene2){throw _WarnImport("StandardMaterial");}},{key:"CollisionCoordinatorFactory",value:function CollisionCoordinatorFactory(){throw _WarnImport("DefaultCollisionCoordinator");}},{key:"DragMovementThreshold",get:function get(){return InputManager.DragMovementThreshold;},set:function set(value){InputManager.DragMovementThreshold=value;}},{key:"LongPressDelay",get:function get(){return InputManager.LongPressDelay;},set:function set(value){InputManager.LongPressDelay=value;}},{key:"DoubleClickDelay",get:function get(){return InputManager.DoubleClickDelay;},set:function set(value){InputManager.DoubleClickDelay=value;}},{key:"ExclusiveDoubleClickMode",get:function get(){return InputManager.ExclusiveDoubleClickMode;},set:function set(value){InputManager.ExclusiveDoubleClickMode=value;}}]);return Scene;}(AbstractScene);Scene.FOGMODE_NONE=0;Scene.FOGMODE_EXP=1;Scene.FOGMODE_EXP2=2;Scene.FOGMODE_LINEAR=3;Scene.MinDeltaTime=1;Scene.MaxDeltaTime=1e3;Scene.prototype.setActiveCameraByID=function(id){return this.setActiveCameraById(id);};Scene.prototype.getLastMaterialByID=function(id){return this.getLastMaterialById(id);};Scene.prototype.getMaterialByID=function(id){return this.getMaterialById(id);};Scene.prototype.getTextureByUniqueID=function(uniqueId){return this.getTextureByUniqueId(uniqueId);};Scene.prototype.getCameraByID=function(id){return this.getCameraById(id);};Scene.prototype.getCameraByUniqueID=function(uniqueId){return this.getCameraByUniqueId(uniqueId);};Scene.prototype.getBoneByID=function(id){return this.getBoneById(id);};Scene.prototype.getLightByID=function(id){return this.getLightById(id);};Scene.prototype.getLightByUniqueID=function(uniqueId){return this.getLightByUniqueId(uniqueId);};Scene.prototype.getParticleSystemByID=function(id){return this.getParticleSystemById(id);};Scene.prototype.getGeometryByID=function(id){return this.getGeometryById(id);};Scene.prototype.getMeshByID=function(id){return this.getMeshById(id);};Scene.prototype.getMeshesByID=function(id){return this.getMeshesById(id);};Scene.prototype.getTransformNodeByID=function(id){return this.getTransformNodeById(id);};Scene.prototype.getTransformNodeByUniqueID=function(uniqueId){return this.getTransformNodeByUniqueId(uniqueId);};Scene.prototype.getTransformNodesByID=function(id){return this.getTransformNodesById(id);};Scene.prototype.getMeshByUniqueID=function(uniqueId){return this.getMeshByUniqueId(uniqueId);};Scene.prototype.getLastMeshByID=function(id){return this.getLastMeshById(id);};Scene.prototype.getLastEntryByID=function(id){return this.getLastEntryById(id);};Scene.prototype.getNodeByID=function(id){return this.getNodeById(id);};Scene.prototype.getLastSkeletonByID=function(id){return this.getLastSkeletonById(id);};// node_modules/@babylonjs/core/Misc/performanceMonitor.js
var PerformanceMonitor=/*#__PURE__*/function(){function PerformanceMonitor(){var frameSampleSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:30;_classCallCheck(this,PerformanceMonitor);this._enabled=true;this._rollingFrameTime=new RollingAverage(frameSampleSize);}_createClass(PerformanceMonitor,[{key:"sampleFrame",value:function sampleFrame(){var timeMs=arguments.length>0&&arguments[0]!==undefined?arguments[0]:PrecisionDate.Now;if(!this._enabled){return;}if(this._lastFrameTimeMs!=null){var dt=timeMs-this._lastFrameTimeMs;this._rollingFrameTime.add(dt);}this._lastFrameTimeMs=timeMs;}},{key:"averageFrameTime",get:function get(){return this._rollingFrameTime.average;}},{key:"averageFrameTimeVariance",get:function get(){return this._rollingFrameTime.variance;}},{key:"instantaneousFrameTime",get:function get(){return this._rollingFrameTime.history(0);}},{key:"averageFPS",get:function get(){return 1e3/this._rollingFrameTime.average;}},{key:"instantaneousFPS",get:function get(){var history=this._rollingFrameTime.history(0);if(history===0){return 0;}return 1e3/history;}},{key:"isSaturated",get:function get(){return this._rollingFrameTime.isSaturated();}},{key:"enable",value:function enable(){this._enabled=true;}},{key:"disable",value:function disable(){this._enabled=false;this._lastFrameTimeMs=null;}},{key:"isEnabled",get:function get(){return this._enabled;}},{key:"reset",value:function reset(){this._lastFrameTimeMs=null;this._rollingFrameTime.reset();}}]);return PerformanceMonitor;}();var RollingAverage=/*#__PURE__*/function(){function RollingAverage(length){_classCallCheck(this,RollingAverage);this._samples=new Array(length);this.reset();}_createClass(RollingAverage,[{key:"add",value:function add(v){var delta;if(this.isSaturated()){var bottomValue=this._samples[this._pos];delta=bottomValue-this.average;this.average-=delta/(this._sampleCount-1);this._m2-=delta*(bottomValue-this.average);}else{this._sampleCount++;}delta=v-this.average;this.average+=delta/this._sampleCount;this._m2+=delta*(v-this.average);this.variance=this._m2/(this._sampleCount-1);this._samples[this._pos]=v;this._pos++;this._pos%=this._samples.length;}},{key:"history",value:function history(i){if(i>=this._sampleCount||i>=this._samples.length){return 0;}var i0=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(i0-i)];}},{key:"isSaturated",value:function isSaturated(){return this._sampleCount>=this._samples.length;}},{key:"reset",value:function reset(){this.average=0;this.variance=0;this._sampleCount=0;this._pos=0;this._m2=0;}},{key:"_wrapPosition",value:function _wrapPosition(i){var max=this._samples.length;return(i%max+max)%max;}}]);return RollingAverage;}();// node_modules/@babylonjs/core/Engines/Extensions/engine.alpha.js
ThinEngine.prototype.setAlphaConstants=function(r,g,b,a){this._alphaState.setAlphaBlendConstants(r,g,b,a);};ThinEngine.prototype.setAlphaMode=function(mode){var noDepthWriteChange=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._alphaMode===mode){if(!noDepthWriteChange){var depthMask=mode===0;if(this.depthCullingState.depthMask!==depthMask){this.depthCullingState.depthMask=depthMask;}}return;}switch(mode){case 0:this._alphaState.alphaBlend=false;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=true;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA);this._alphaState.alphaBlend=true;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=true;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO);this._alphaState.alphaBlend=true;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=true;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=true;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO);this._alphaState.alphaBlend=true;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE);this._alphaState.alphaBlend=true;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);this._alphaState.alphaBlend=true;break;}if(!noDepthWriteChange){this.depthCullingState.depthMask=mode===0;}this._alphaMode=mode;};ThinEngine.prototype.getAlphaMode=function(){return this._alphaMode;};ThinEngine.prototype.setAlphaEquation=function(equation){if(this._alphaEquation===equation){return;}switch(equation){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774);break;}this._alphaEquation=equation;};ThinEngine.prototype.getAlphaEquation=function(){return this._alphaEquation;};// node_modules/@babylonjs/core/Engines/Extensions/engine.readTexture.js
function allocateAndCopyTypedBuffer(type,sizeOrDstBuffer){var sizeInBytes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var copyBuffer=arguments.length>3?arguments[3]:undefined;switch(type){case 3:{var buffer2=sizeOrDstBuffer instanceof ArrayBuffer?new Int8Array(sizeOrDstBuffer):new Int8Array(sizeOrDstBuffer);if(copyBuffer){buffer2.set(new Int8Array(copyBuffer));}return buffer2;}case 0:{var _buffer=sizeOrDstBuffer instanceof ArrayBuffer?new Uint8Array(sizeOrDstBuffer):new Uint8Array(sizeOrDstBuffer);if(copyBuffer){_buffer.set(new Uint8Array(copyBuffer));}return _buffer;}case 4:{var _buffer2=sizeOrDstBuffer instanceof ArrayBuffer?new Int16Array(sizeOrDstBuffer):new Int16Array(sizeInBytes?sizeOrDstBuffer/2:sizeOrDstBuffer);if(copyBuffer){_buffer2.set(new Int16Array(copyBuffer));}return _buffer2;}case 5:case 8:case 9:case 10:case 2:{var _buffer3=sizeOrDstBuffer instanceof ArrayBuffer?new Uint16Array(sizeOrDstBuffer):new Uint16Array(sizeInBytes?sizeOrDstBuffer/2:sizeOrDstBuffer);if(copyBuffer){_buffer3.set(new Uint16Array(copyBuffer));}return _buffer3;}case 6:{var _buffer4=sizeOrDstBuffer instanceof ArrayBuffer?new Int32Array(sizeOrDstBuffer):new Int32Array(sizeInBytes?sizeOrDstBuffer/4:sizeOrDstBuffer);if(copyBuffer){_buffer4.set(new Int32Array(copyBuffer));}return _buffer4;}case 7:case 11:case 12:case 13:case 14:case 15:{var _buffer5=sizeOrDstBuffer instanceof ArrayBuffer?new Uint32Array(sizeOrDstBuffer):new Uint32Array(sizeInBytes?sizeOrDstBuffer/4:sizeOrDstBuffer);if(copyBuffer){_buffer5.set(new Uint32Array(copyBuffer));}return _buffer5;}case 1:{var _buffer6=sizeOrDstBuffer instanceof ArrayBuffer?new Float32Array(sizeOrDstBuffer):new Float32Array(sizeInBytes?sizeOrDstBuffer/4:sizeOrDstBuffer);if(copyBuffer){_buffer6.set(new Float32Array(copyBuffer));}return _buffer6;}}var buffer=sizeOrDstBuffer instanceof ArrayBuffer?new Uint8Array(sizeOrDstBuffer):new Uint8Array(sizeOrDstBuffer);if(copyBuffer){buffer.set(new Uint8Array(copyBuffer));}return buffer;}ThinEngine.prototype._readTexturePixelsSync=function(texture,width,height){var faceIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var level=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var buffer=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var flushRenderer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;var noDataConversion=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var x=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var y=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var _a,_b;var gl=this._gl;if(!gl){throw new Error("Engine does not have gl rendering context.");}if(!this._dummyFramebuffer){var dummy=gl.createFramebuffer();if(!dummy){throw new Error("Unable to create dummy framebuffer");}this._dummyFramebuffer=dummy;}gl.bindFramebuffer(gl.FRAMEBUFFER,this._dummyFramebuffer);if(faceIndex>-1){gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,(_a=texture._hardwareTexture)===null||_a===void 0?void 0:_a.underlyingResource,level);}else{gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,(_b=texture._hardwareTexture)===null||_b===void 0?void 0:_b.underlyingResource,level);}var readType=texture.type!==void 0?this._getWebGLTextureType(texture.type):gl.UNSIGNED_BYTE;if(!noDataConversion){switch(readType){case gl.UNSIGNED_BYTE:if(!buffer){buffer=new Uint8Array(4*width*height);}readType=gl.UNSIGNED_BYTE;break;default:if(!buffer){buffer=new Float32Array(4*width*height);}readType=gl.FLOAT;break;}}else if(!buffer){buffer=allocateAndCopyTypedBuffer(texture.type,4*width*height);}if(flushRenderer){this.flushFramebuffer();}gl.readPixels(x,y,width,height,gl.RGBA,readType,buffer);gl.bindFramebuffer(gl.FRAMEBUFFER,this._currentFramebuffer);return buffer;};ThinEngine.prototype._readTexturePixels=function(texture,width,height){var faceIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var level=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var buffer=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var flushRenderer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;var noDataConversion=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var x=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var y=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(texture,width,height,faceIndex,level,buffer,flushRenderer,noDataConversion,x,y));};// node_modules/@babylonjs/core/Engines/Extensions/engine.dynamicBuffer.js
ThinEngine.prototype.updateDynamicIndexBuffer=function(indexBuffer,indices){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null;this.bindIndexBuffer(indexBuffer);var view;if(indexBuffer.is32Bits){view=indices instanceof Uint32Array?indices:new Uint32Array(indices);}else{view=indices instanceof Uint16Array?indices:new Uint16Array(indices);}this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,view,this._gl.DYNAMIC_DRAW);this._resetIndexBufferBinding();};ThinEngine.prototype.updateDynamicVertexBuffer=function(vertexBuffer,data,byteOffset,byteLength){this.bindArrayBuffer(vertexBuffer);if(byteOffset===void 0){byteOffset=0;}var dataLength=data.byteLength||data.length;if(byteLength===void 0||byteLength>=dataLength&&byteOffset===0){if(data instanceof Array){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,byteOffset,new Float32Array(data));}else{this._gl.bufferSubData(this._gl.ARRAY_BUFFER,byteOffset,data);}}else{if(data instanceof Array){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(data).subarray(byteOffset,byteOffset+byteLength));}else{if(data instanceof ArrayBuffer){data=new Uint8Array(data,byteOffset,byteLength);}else{data=new Uint8Array(data.buffer,data.byteOffset+byteOffset,byteLength);}this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,data);}}this._resetVertexBufferBinding();};// node_modules/@babylonjs/core/Engines/engine.js
var Engine=/*#__PURE__*/function(_ThinEngine){_inherits(Engine,_ThinEngine);var _super20=_createSuper(Engine);function Engine(canvasOrContext,antialias,options){var _this64;var adaptToDeviceRatio=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;_classCallCheck(this,Engine);_this64=_super20.call(this,canvasOrContext,antialias,options,adaptToDeviceRatio);_this64.enableOfflineSupport=false;_this64.disableManifestCheck=false;_this64.disableContextMenu=true;_this64.scenes=new Array();_this64._virtualScenes=new Array();_this64.onNewSceneAddedObservable=new Observable();_this64.postProcesses=new Array();_this64.isPointerLock=false;_this64.onResizeObservable=new Observable();_this64.onCanvasBlurObservable=new Observable();_this64.onCanvasFocusObservable=new Observable();_this64.onCanvasPointerOutObservable=new Observable();_this64.onBeginFrameObservable=new Observable();_this64.customAnimationFrameRequester=null;_this64.onEndFrameObservable=new Observable();_this64.onBeforeShaderCompilationObservable=new Observable();_this64.onAfterShaderCompilationObservable=new Observable();_this64._deterministicLockstep=false;_this64._lockstepMaxSteps=4;_this64._timeStep=1/60;_this64._fps=60;_this64._deltaTime=0;_this64._drawCalls=new PerfCounter();_this64.canvasTabIndex=1;_this64.disablePerformanceMonitorInBackground=false;_this64._performanceMonitor=new PerformanceMonitor();_this64._compatibilityMode=true;_this64.currentRenderPassId=0;_this64._renderPassNames=["main"];Engine.Instances.push(_assertThisInitialized(_this64));if(!canvasOrContext){return _possibleConstructorReturn(_this64);}_this64._features.supportRenderPasses=true;options=_this64._creationOptions;if(canvasOrContext.getContext){var canvas=canvasOrContext;_this64._sharedInit(canvas);_this64._connectVREvents();}_this64._prepareVRComponent();if(options.autoEnableWebVR){_this64.initWebVR();}return _this64;}_createClass(Engine,[{key:"_createImageBitmapFromSource",value:function _createImageBitmapFromSource(imageSource,options){var _this65=this;var promise=new Promise(function(resolve,reject){var image=new Image();image.onload=function(){image.decode().then(function(){_this65.createImageBitmap(image,options).then(function(imageBitmap){resolve(imageBitmap);});});};image.onerror=function(){reject("Error loading image ".concat(image.src));};image.src=imageSource;});return promise;}},{key:"createImageBitmap",value:function(_createImageBitmap){function createImageBitmap(_x6,_x7){return _createImageBitmap.apply(this,arguments);}createImageBitmap.toString=function(){return _createImageBitmap.toString();};return createImageBitmap;}(function(image,options){return createImageBitmap(image,options);})},{key:"resizeImageBitmap",value:function resizeImageBitmap(image,bufferWidth,bufferHeight){var canvas=this.createCanvas(bufferWidth,bufferHeight);var context=canvas.getContext("2d");if(!context){throw new Error("Unable to get 2d context for resizeImageBitmap");}context.drawImage(image,0,0);var buffer=context.getImageData(0,0,bufferWidth,bufferHeight).data;return buffer;}},{key:"_supportsHardwareTextureRescaling",get:function get(){return!!Engine._RescalePostProcessFactory;}},{key:"performanceMonitor",get:function get(){return this._performanceMonitor;}},{key:"compatibilityMode",get:function get(){return this._compatibilityMode;},set:function set(mode){this._compatibilityMode=true;}},{key:"getInputElement",value:function getInputElement(){return this._renderingCanvas;}},{key:"_initGLContext",value:function _initGLContext(){_get(_getPrototypeOf(Engine.prototype),"_initGLContext",this).call(this);this._rescalePostProcess=null;}},{key:"_sharedInit",value:function _sharedInit(canvas){var _this66=this;_get(_getPrototypeOf(Engine.prototype),"_sharedInit",this).call(this,canvas);this._onCanvasFocus=function(){_this66.onCanvasFocusObservable.notifyObservers(_this66);};this._onCanvasBlur=function(){_this66.onCanvasBlurObservable.notifyObservers(_this66);};this._onCanvasContextMenu=function(evt){if(_this66.disableContextMenu){evt.preventDefault();}};canvas.addEventListener("focus",this._onCanvasFocus);canvas.addEventListener("blur",this._onCanvasBlur);canvas.addEventListener("contextmenu",this._onCanvasContextMenu);this._onBlur=function(){if(_this66.disablePerformanceMonitorInBackground){_this66._performanceMonitor.disable();}_this66._windowIsBackground=true;};this._onFocus=function(){if(_this66.disablePerformanceMonitorInBackground){_this66._performanceMonitor.enable();}_this66._windowIsBackground=false;};this._onCanvasPointerOut=function(ev){if(document.elementFromPoint(ev.clientX,ev.clientY)!==canvas){_this66.onCanvasPointerOutObservable.notifyObservers(ev);}};var hostWindow=this.getHostWindow();if(hostWindow&&typeof hostWindow.addEventListener==="function"){hostWindow.addEventListener("blur",this._onBlur);hostWindow.addEventListener("focus",this._onFocus);}canvas.addEventListener("pointerout",this._onCanvasPointerOut);if(!this._creationOptions.doNotHandleTouchAction){this._disableTouchAction();}if(!Engine.audioEngine&&this._creationOptions.audioEngine&&Engine.AudioEngineFactory){Engine.audioEngine=Engine.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination());}if(IsDocumentAvailable()){this._onFullscreenChange=function(){_this66.isFullscreen=!!document.fullscreenElement;if(_this66.isFullscreen&&_this66._pointerLockRequested&&canvas){Engine._RequestPointerlock(canvas);}};document.addEventListener("fullscreenchange",this._onFullscreenChange,false);document.addEventListener("webkitfullscreenchange",this._onFullscreenChange,false);this._onPointerLockChange=function(){_this66.isPointerLock=document.pointerLockElement===canvas;};document.addEventListener("pointerlockchange",this._onPointerLockChange,false);document.addEventListener("webkitpointerlockchange",this._onPointerLockChange,false);}this.enableOfflineSupport=Engine.OfflineProviderFactory!==void 0;this._deterministicLockstep=!!this._creationOptions.deterministicLockstep;this._lockstepMaxSteps=this._creationOptions.lockstepMaxSteps||0;this._timeStep=this._creationOptions.timeStep||1/60;}},{key:"getAspectRatio",value:function getAspectRatio(viewportOwner){var useScreen=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var viewport=viewportOwner.viewport;return this.getRenderWidth(useScreen)*viewport.width/(this.getRenderHeight(useScreen)*viewport.height);}},{key:"getScreenAspectRatio",value:function getScreenAspectRatio(){return this.getRenderWidth(true)/this.getRenderHeight(true);}},{key:"getRenderingCanvasClientRect",value:function getRenderingCanvasClientRect(){if(!this._renderingCanvas){return null;}return this._renderingCanvas.getBoundingClientRect();}},{key:"getInputElementClientRect",value:function getInputElementClientRect(){if(!this._renderingCanvas){return null;}return this.getInputElement().getBoundingClientRect();}},{key:"isDeterministicLockStep",value:function isDeterministicLockStep(){return this._deterministicLockstep;}},{key:"getLockstepMaxSteps",value:function getLockstepMaxSteps(){return this._lockstepMaxSteps;}},{key:"getTimeStep",value:function getTimeStep(){return this._timeStep*1e3;}},{key:"generateMipMapsForCubemap",value:function generateMipMapsForCubemap(texture){var unbind=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(texture.generateMipMaps){var gl=this._gl;this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);gl.generateMipmap(gl.TEXTURE_CUBE_MAP);if(unbind){this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);}}}},{key:"getDepthWrite",value:function getDepthWrite(){return this._depthCullingState.depthMask;}},{key:"setDepthWrite",value:function setDepthWrite(enable){this._depthCullingState.depthMask=enable;}},{key:"getStencilBuffer",value:function getStencilBuffer(){return this._stencilState.stencilTest;}},{key:"setStencilBuffer",value:function setStencilBuffer(enable){this._stencilState.stencilTest=enable;}},{key:"getStencilMask",value:function getStencilMask(){return this._stencilState.stencilMask;}},{key:"setStencilMask",value:function setStencilMask(mask){this._stencilState.stencilMask=mask;}},{key:"getStencilFunction",value:function getStencilFunction(){return this._stencilState.stencilFunc;}},{key:"getStencilFunctionReference",value:function getStencilFunctionReference(){return this._stencilState.stencilFuncRef;}},{key:"getStencilFunctionMask",value:function getStencilFunctionMask(){return this._stencilState.stencilFuncMask;}},{key:"setStencilFunction",value:function setStencilFunction(stencilFunc){this._stencilState.stencilFunc=stencilFunc;}},{key:"setStencilFunctionReference",value:function setStencilFunctionReference(reference){this._stencilState.stencilFuncRef=reference;}},{key:"setStencilFunctionMask",value:function setStencilFunctionMask(mask){this._stencilState.stencilFuncMask=mask;}},{key:"getStencilOperationFail",value:function getStencilOperationFail(){return this._stencilState.stencilOpStencilFail;}},{key:"getStencilOperationDepthFail",value:function getStencilOperationDepthFail(){return this._stencilState.stencilOpDepthFail;}},{key:"getStencilOperationPass",value:function getStencilOperationPass(){return this._stencilState.stencilOpStencilDepthPass;}},{key:"setStencilOperationFail",value:function setStencilOperationFail(operation){this._stencilState.stencilOpStencilFail=operation;}},{key:"setStencilOperationDepthFail",value:function setStencilOperationDepthFail(operation){this._stencilState.stencilOpDepthFail=operation;}},{key:"setStencilOperationPass",value:function setStencilOperationPass(operation){this._stencilState.stencilOpStencilDepthPass=operation;}},{key:"setDitheringState",value:function setDitheringState(value){if(value){this._gl.enable(this._gl.DITHER);}else{this._gl.disable(this._gl.DITHER);}}},{key:"setRasterizerState",value:function setRasterizerState(value){if(value){this._gl.disable(this._gl.RASTERIZER_DISCARD);}else{this._gl.enable(this._gl.RASTERIZER_DISCARD);}}},{key:"getDepthFunction",value:function getDepthFunction(){return this._depthCullingState.depthFunc;}},{key:"setDepthFunction",value:function setDepthFunction(depthFunc){this._depthCullingState.depthFunc=depthFunc;}},{key:"setDepthFunctionToGreater",value:function setDepthFunctionToGreater(){this.setDepthFunction(516);}},{key:"setDepthFunctionToGreaterOrEqual",value:function setDepthFunctionToGreaterOrEqual(){this.setDepthFunction(518);}},{key:"setDepthFunctionToLess",value:function setDepthFunctionToLess(){this.setDepthFunction(513);}},{key:"setDepthFunctionToLessOrEqual",value:function setDepthFunctionToLessOrEqual(){this.setDepthFunction(515);}},{key:"cacheStencilState",value:function cacheStencilState(){this._cachedStencilBuffer=this.getStencilBuffer();this._cachedStencilFunction=this.getStencilFunction();this._cachedStencilMask=this.getStencilMask();this._cachedStencilOperationPass=this.getStencilOperationPass();this._cachedStencilOperationFail=this.getStencilOperationFail();this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail();this._cachedStencilReference=this.getStencilFunctionReference();}},{key:"restoreStencilState",value:function restoreStencilState(){this.setStencilFunction(this._cachedStencilFunction);this.setStencilMask(this._cachedStencilMask);this.setStencilBuffer(this._cachedStencilBuffer);this.setStencilOperationPass(this._cachedStencilOperationPass);this.setStencilOperationFail(this._cachedStencilOperationFail);this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail);this.setStencilFunctionReference(this._cachedStencilReference);}},{key:"setDirectViewport",value:function setDirectViewport(x,y,width,height){var currentViewport=this._cachedViewport;this._cachedViewport=null;this._viewport(x,y,width,height);return currentViewport;}},{key:"scissorClear",value:function scissorClear(x,y,width,height,clearColor){this.enableScissor(x,y,width,height);this.clear(clearColor,true,true,true);this.disableScissor();}},{key:"enableScissor",value:function enableScissor(x,y,width,height){var gl=this._gl;gl.enable(gl.SCISSOR_TEST);gl.scissor(x,y,width,height);}},{key:"disableScissor",value:function disableScissor(){var gl=this._gl;gl.disable(gl.SCISSOR_TEST);}},{key:"_reportDrawCall",value:function _reportDrawCall(){var numDrawCalls=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;this._drawCalls.addCount(numDrawCalls,false);}},{key:"initWebVR",value:function initWebVR(){throw _WarnImport("WebVRCamera");}},{key:"_prepareVRComponent",value:function _prepareVRComponent(){}},{key:"_connectVREvents",value:function _connectVREvents(canvas,document2){}},{key:"_submitVRFrame",value:function _submitVRFrame(){}},{key:"disableVR",value:function disableVR(){}},{key:"isVRPresenting",value:function isVRPresenting(){return false;}},{key:"_requestVRFrame",value:function _requestVRFrame(){}},{key:"_loadFileAsync",value:function _loadFileAsync(url,offlineProvider,useArrayBuffer){var _this67=this;return new Promise(function(resolve,reject){_this67._loadFile(url,function(data){resolve(data);},void 0,offlineProvider,useArrayBuffer,function(request,exception){reject(exception);});});}},{key:"getVertexShaderSource",value:function getVertexShaderSource(program){var shaders=this._gl.getAttachedShaders(program);if(!shaders){return null;}return this._gl.getShaderSource(shaders[0]);}},{key:"getFragmentShaderSource",value:function getFragmentShaderSource(program){var shaders=this._gl.getAttachedShaders(program);if(!shaders){return null;}return this._gl.getShaderSource(shaders[1]);}},{key:"setDepthStencilTexture",value:function setDepthStencilTexture(channel,uniform,texture,name135){if(channel===void 0){return;}if(uniform){this._boundUniforms[channel]=uniform;}if(!texture||!texture.depthStencilTexture){this._setTexture(channel,null,void 0,void 0,name135);}else{this._setTexture(channel,texture,false,true,name135);}}},{key:"setTextureFromPostProcess",value:function setTextureFromPostProcess(channel,postProcess,name135){var _a;var postProcessInput=null;if(postProcess){if(postProcess._textures.data[postProcess._currentRenderTextureInd]){postProcessInput=postProcess._textures.data[postProcess._currentRenderTextureInd];}else if(postProcess._forcedOutputTexture){postProcessInput=postProcess._forcedOutputTexture;}}this._bindTexture(channel,(_a=postProcessInput===null||postProcessInput===void 0?void 0:postProcessInput.texture)!==null&&_a!==void 0?_a:null,name135);}},{key:"setTextureFromPostProcessOutput",value:function setTextureFromPostProcessOutput(channel,postProcess,name135){var _a,_b;this._bindTexture(channel,(_b=(_a=postProcess===null||postProcess===void 0?void 0:postProcess._outputTexture)===null||_a===void 0?void 0:_a.texture)!==null&&_b!==void 0?_b:null,name135);}},{key:"_rebuildBuffers",value:function _rebuildBuffers(){var _iterator69=_createForOfIteratorHelper(this.scenes),_step78;try{for(_iterator69.s();!(_step78=_iterator69.n()).done;){var scene2=_step78.value;scene2.resetCachedMaterial();scene2._rebuildGeometries();scene2._rebuildTextures();}}catch(err){_iterator69.e(err);}finally{_iterator69.f();}var _iterator70=_createForOfIteratorHelper(this._virtualScenes),_step79;try{for(_iterator70.s();!(_step79=_iterator70.n()).done;){var _scene3=_step79.value;_scene3.resetCachedMaterial();_scene3._rebuildGeometries();_scene3._rebuildTextures();}}catch(err){_iterator70.e(err);}finally{_iterator70.f();}_get(_getPrototypeOf(Engine.prototype),"_rebuildBuffers",this).call(this);}},{key:"_renderFrame",value:function _renderFrame(){for(var index=0;index<this._activeRenderLoops.length;index++){var renderFunction=this._activeRenderLoops[index];renderFunction();}}},{key:"_renderLoop",value:function _renderLoop(){if(!this._contextWasLost){var shouldRender=true;if(!this.renderEvenInBackground&&this._windowIsBackground){shouldRender=false;}if(shouldRender){this.beginFrame();if(!this._renderViews()){this._renderFrame();}this.endFrame();}}if(this._activeRenderLoops.length>0){if(this.customAnimationFrameRequester){this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester);this._frameHandler=this.customAnimationFrameRequester.requestID;}else if(this.isVRPresenting()){this._requestVRFrame();}else{this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow());}}else{this._renderingQueueLaunched=false;}}},{key:"_renderViews",value:function _renderViews(){return false;}},{key:"switchFullscreen",value:function switchFullscreen(requestPointerLock){if(this.isFullscreen){this.exitFullscreen();}else{this.enterFullscreen(requestPointerLock);}}},{key:"enterFullscreen",value:function enterFullscreen(requestPointerLock){if(!this.isFullscreen){this._pointerLockRequested=requestPointerLock;if(this._renderingCanvas){Engine._RequestFullscreen(this._renderingCanvas);}}}},{key:"exitFullscreen",value:function exitFullscreen(){if(this.isFullscreen){Engine._ExitFullscreen();}}},{key:"enterPointerlock",value:function enterPointerlock(){if(this._renderingCanvas){Engine._RequestPointerlock(this._renderingCanvas);}}},{key:"exitPointerlock",value:function exitPointerlock(){Engine._ExitPointerlock();}},{key:"beginFrame",value:function beginFrame(){this._measureFps();this.onBeginFrameObservable.notifyObservers(this);_get(_getPrototypeOf(Engine.prototype),"beginFrame",this).call(this);}},{key:"endFrame",value:function endFrame(){_get(_getPrototypeOf(Engine.prototype),"endFrame",this).call(this);this._submitVRFrame();this.onEndFrameObservable.notifyObservers(this);}},{key:"resize",value:function resize(){var forceSetSize=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.isVRPresenting()){return;}_get(_getPrototypeOf(Engine.prototype),"resize",this).call(this,forceSetSize);}},{key:"setSize",value:function setSize(width,height){var forceSetSize=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._renderingCanvas){return false;}if(!_get(_getPrototypeOf(Engine.prototype),"setSize",this).call(this,width,height,forceSetSize)){return false;}if(this.scenes){for(var index=0;index<this.scenes.length;index++){var scene2=this.scenes[index];for(var camIndex=0;camIndex<scene2.cameras.length;camIndex++){var cam=scene2.cameras[camIndex];cam._currentRenderId=0;}}if(this.onResizeObservable.hasObservers()){this.onResizeObservable.notifyObservers(this);}}return true;}},{key:"_deletePipelineContext",value:function _deletePipelineContext(pipelineContext){var webGLPipelineContext=pipelineContext;if(webGLPipelineContext&&webGLPipelineContext.program){if(webGLPipelineContext.transformFeedback){this.deleteTransformFeedback(webGLPipelineContext.transformFeedback);webGLPipelineContext.transformFeedback=null;}}_get(_getPrototypeOf(Engine.prototype),"_deletePipelineContext",this).call(this,pipelineContext);}},{key:"createShaderProgram",value:function createShaderProgram(pipelineContext,vertexCode,fragmentCode,defines,context){var transformFeedbackVaryings=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;context=context||this._gl;this.onBeforeShaderCompilationObservable.notifyObservers(this);var program=_get(_getPrototypeOf(Engine.prototype),"createShaderProgram",this).call(this,pipelineContext,vertexCode,fragmentCode,defines,context,transformFeedbackVaryings);this.onAfterShaderCompilationObservable.notifyObservers(this);return program;}},{key:"_createShaderProgram",value:function _createShaderProgram(pipelineContext,vertexShader,fragmentShader,context){var transformFeedbackVaryings=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var shaderProgram=context.createProgram();pipelineContext.program=shaderProgram;if(!shaderProgram){throw new Error("Unable to create program");}context.attachShader(shaderProgram,vertexShader);context.attachShader(shaderProgram,fragmentShader);if(this.webGLVersion>1&&transformFeedbackVaryings){var transformFeedback=this.createTransformFeedback();this.bindTransformFeedback(transformFeedback);this.setTranformFeedbackVaryings(shaderProgram,transformFeedbackVaryings);pipelineContext.transformFeedback=transformFeedback;}context.linkProgram(shaderProgram);if(this.webGLVersion>1&&transformFeedbackVaryings){this.bindTransformFeedback(null);}pipelineContext.context=context;pipelineContext.vertexShader=vertexShader;pipelineContext.fragmentShader=fragmentShader;if(!pipelineContext.isParallelCompiled){this._finalizePipelineContext(pipelineContext);}return shaderProgram;}},{key:"_releaseTexture",value:function _releaseTexture(texture){_get(_getPrototypeOf(Engine.prototype),"_releaseTexture",this).call(this,texture);}},{key:"_releaseRenderTargetWrapper",value:function _releaseRenderTargetWrapper(rtWrapper){_get(_getPrototypeOf(Engine.prototype),"_releaseRenderTargetWrapper",this).call(this,rtWrapper);this.scenes.forEach(function(scene2){scene2.postProcesses.forEach(function(postProcess){if(postProcess._outputTexture===rtWrapper){postProcess._outputTexture=null;}});scene2.cameras.forEach(function(camera){camera._postProcesses.forEach(function(postProcess){if(postProcess){if(postProcess._outputTexture===rtWrapper){postProcess._outputTexture=null;}}});});});}},{key:"getRenderPassNames",value:function getRenderPassNames(){return this._renderPassNames;}},{key:"getCurrentRenderPassName",value:function getCurrentRenderPassName(){return this._renderPassNames[this.currentRenderPassId];}},{key:"createRenderPassId",value:function createRenderPassId(name135){var id=++Engine._RenderPassIdCounter;this._renderPassNames[id]=name135!==null&&name135!==void 0?name135:"NONAME";return id;}},{key:"releaseRenderPassId",value:function releaseRenderPassId(id){this._renderPassNames[id]=void 0;for(var s=0;s<this.scenes.length;++s){var scene2=this.scenes[s];for(var m=0;m<scene2.meshes.length;++m){var mesh=scene2.meshes[m];if(mesh.subMeshes){for(var b=0;b<mesh.subMeshes.length;++b){var subMesh=mesh.subMeshes[b];subMesh._removeDrawWrapper(id);}}}}}},{key:"_rescaleTexture",value:function _rescaleTexture(source,destination,scene2,internalFormat,onComplete){var _this68=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var rtt=this.createRenderTargetTexture({width:destination.width,height:destination.height},{generateMipMaps:false,type:0,samplingMode:2,generateDepthBuffer:false,generateStencilBuffer:false});if(!this._rescalePostProcess&&Engine._RescalePostProcessFactory){this._rescalePostProcess=Engine._RescalePostProcessFactory(this);}if(this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=true;this._rescalePostProcess.getEffect().executeWhenCompiled(function(){_this68._rescalePostProcess.onApply=function(effect){effect._bindTexture("textureSampler",source);};var hostingScene=scene2;if(!hostingScene){hostingScene=_this68.scenes[_this68.scenes.length-1];}hostingScene.postProcessManager.directRender([_this68._rescalePostProcess],rtt,true);_this68._bindTextureDirectly(_this68._gl.TEXTURE_2D,destination,true);_this68._gl.copyTexImage2D(_this68._gl.TEXTURE_2D,0,internalFormat,0,0,destination.width,destination.height,0);_this68.unBindFramebuffer(rtt);rtt.dispose();if(onComplete){onComplete();}});}}},{key:"getFps",value:function getFps(){return this._fps;}},{key:"getDeltaTime",value:function getDeltaTime(){return this._deltaTime;}},{key:"_measureFps",value:function _measureFps(){this._performanceMonitor.sampleFrame();this._fps=this._performanceMonitor.averageFPS;this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0;}},{key:"wrapWebGLTexture",value:function wrapWebGLTexture(texture){var hardwareTexture=new WebGLHardwareTexture(texture,this._gl);var internalTexture=new InternalTexture(this,InternalTextureSource.Unknown,true);internalTexture._hardwareTexture=hardwareTexture;internalTexture.isReady=true;return internalTexture;}},{key:"_uploadImageToTexture",value:function _uploadImageToTexture(texture,image){var faceIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var lod=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var gl=this._gl;var textureType=this._getWebGLTextureType(texture.type);var format=this._getInternalFormat(texture.format);var internalFormat=this._getRGBABufferInternalSizedFormat(texture.type,format);var bindTarget=texture.isCube?gl.TEXTURE_CUBE_MAP:gl.TEXTURE_2D;this._bindTextureDirectly(bindTarget,texture,true);this._unpackFlipY(texture.invertY);var target=gl.TEXTURE_2D;if(texture.isCube){target=gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex;}gl.texImage2D(target,lod,internalFormat,format,textureType,image);this._bindTextureDirectly(bindTarget,null,true);}},{key:"updateTextureComparisonFunction",value:function updateTextureComparisonFunction(texture,comparisonFunction){if(this.webGLVersion===1){Logger.Error("WebGL 1 does not support texture comparison.");return;}var gl=this._gl;if(texture.isCube){this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,texture,true);if(comparisonFunction===0){gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_FUNC,515);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_MODE,gl.NONE);}else{gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_FUNC,comparisonFunction);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_COMPARE_MODE,gl.COMPARE_REF_TO_TEXTURE);}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null);}else{this._bindTextureDirectly(this._gl.TEXTURE_2D,texture,true);if(comparisonFunction===0){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_FUNC,515);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_MODE,gl.NONE);}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_FUNC,comparisonFunction);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_COMPARE_MODE,gl.COMPARE_REF_TO_TEXTURE);}this._bindTextureDirectly(this._gl.TEXTURE_2D,null);}texture._comparisonFunction=comparisonFunction;}},{key:"createInstancesBuffer",value:function createInstancesBuffer(capacity){var buffer=this._gl.createBuffer();if(!buffer){throw new Error("Unable to create instance buffer");}var result=new WebGLDataBuffer(buffer);result.capacity=capacity;this.bindArrayBuffer(result);this._gl.bufferData(this._gl.ARRAY_BUFFER,capacity,this._gl.DYNAMIC_DRAW);result.references=1;return result;}},{key:"deleteInstancesBuffer",value:function deleteInstancesBuffer(buffer){this._gl.deleteBuffer(buffer);}},{key:"_clientWaitAsync",value:function _clientWaitAsync(sync){var flags=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var intervalms=arguments.length>2&&arguments[2]!==undefined?arguments[2]:10;var gl=this._gl;return new Promise(function(resolve,reject){var check=function check(){var res=gl.clientWaitSync(sync,flags,0);if(res==gl.WAIT_FAILED){reject();return;}if(res==gl.TIMEOUT_EXPIRED){setTimeout(check,intervalms);return;}resolve();};check();});}},{key:"_readPixelsAsync",value:function _readPixelsAsync(x,y,w,h,format,type,outputBuffer){if(this._webGLVersion<2){throw new Error("_readPixelsAsync only work on WebGL2+");}var gl=this._gl;var buf=gl.createBuffer();gl.bindBuffer(gl.PIXEL_PACK_BUFFER,buf);gl.bufferData(gl.PIXEL_PACK_BUFFER,outputBuffer.byteLength,gl.STREAM_READ);gl.readPixels(x,y,w,h,format,type,0);gl.bindBuffer(gl.PIXEL_PACK_BUFFER,null);var sync=gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE,0);if(!sync){return null;}gl.flush();return this._clientWaitAsync(sync,0,10).then(function(){gl.deleteSync(sync);gl.bindBuffer(gl.PIXEL_PACK_BUFFER,buf);gl.getBufferSubData(gl.PIXEL_PACK_BUFFER,0,outputBuffer);gl.bindBuffer(gl.PIXEL_PACK_BUFFER,null);gl.deleteBuffer(buf);return outputBuffer;});}},{key:"dispose",value:function dispose(){this.hideLoadingUI();this.onNewSceneAddedObservable.clear();while(this.postProcesses.length){this.postProcesses[0].dispose();}if(this._rescalePostProcess){this._rescalePostProcess.dispose();}while(this.scenes.length){this.scenes[0].dispose();}while(this._virtualScenes.length){this._virtualScenes[0].dispose();}if(Engine.Instances.length===1&&Engine.audioEngine){Engine.audioEngine.dispose();Engine.audioEngine=null;}this.disableVR();var hostWindow=this.getHostWindow();if(hostWindow&&typeof hostWindow.removeEventListener==="function"){hostWindow.removeEventListener("blur",this._onBlur);hostWindow.removeEventListener("focus",this._onFocus);}if(this._renderingCanvas){this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus);this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur);this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut);this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu);}if(IsDocumentAvailable()){document.removeEventListener("fullscreenchange",this._onFullscreenChange);document.removeEventListener("mozfullscreenchange",this._onFullscreenChange);document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange);document.removeEventListener("msfullscreenchange",this._onFullscreenChange);document.removeEventListener("pointerlockchange",this._onPointerLockChange);document.removeEventListener("mspointerlockchange",this._onPointerLockChange);document.removeEventListener("mozpointerlockchange",this._onPointerLockChange);document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange);}_get(_getPrototypeOf(Engine.prototype),"dispose",this).call(this);var index=Engine.Instances.indexOf(this);if(index>=0){Engine.Instances.splice(index,1);}this.onResizeObservable.clear();this.onCanvasBlurObservable.clear();this.onCanvasFocusObservable.clear();this.onCanvasPointerOutObservable.clear();this.onBeginFrameObservable.clear();this.onEndFrameObservable.clear();}},{key:"_disableTouchAction",value:function _disableTouchAction(){if(!this._renderingCanvas||!this._renderingCanvas.setAttribute){return;}this._renderingCanvas.setAttribute("touch-action","none");this._renderingCanvas.style.touchAction="none";this._renderingCanvas.style.webkitTapHighlightColor="transparent";}},{key:"displayLoadingUI",value:function displayLoadingUI(){if(!IsWindowObjectExist()){return;}var loadingScreen=this.loadingScreen;if(loadingScreen){loadingScreen.displayLoadingUI();}}},{key:"hideLoadingUI",value:function hideLoadingUI(){if(!IsWindowObjectExist()){return;}var loadingScreen=this._loadingScreen;if(loadingScreen){loadingScreen.hideLoadingUI();}}},{key:"loadingScreen",get:function get(){if(!this._loadingScreen&&this._renderingCanvas){this._loadingScreen=Engine.DefaultLoadingScreenFactory(this._renderingCanvas);}return this._loadingScreen;},set:function set(loadingScreen){this._loadingScreen=loadingScreen;}},{key:"loadingUIText",set:function set(text){this.loadingScreen.loadingUIText=text;}},{key:"loadingUIBackgroundColor",set:function set(color){this.loadingScreen.loadingUIBackgroundColor=color;}},{key:"createVideoElement",value:function createVideoElement(constraints){return document.createElement("video");}},{key:"getFontOffset",value:function getFontOffset(font){var text=document.createElement("span");text.innerHTML="Hg";text.setAttribute("style","font: ".concat(font," !important"));var block=document.createElement("div");block.style.display="inline-block";block.style.width="1px";block.style.height="0px";block.style.verticalAlign="bottom";var div=document.createElement("div");div.style.whiteSpace="nowrap";div.appendChild(text);div.appendChild(block);document.body.appendChild(div);var fontAscent=0;var fontHeight=0;try{fontHeight=block.getBoundingClientRect().top-text.getBoundingClientRect().top;block.style.verticalAlign="baseline";fontAscent=block.getBoundingClientRect().top-text.getBoundingClientRect().top;}finally{document.body.removeChild(div);}return{ascent:fontAscent,height:fontHeight,descent:fontHeight-fontAscent};}}],[{key:"NpmPackage",get:function get(){return ThinEngine.NpmPackage;}},{key:"Version",get:function get(){return ThinEngine.Version;}},{key:"Instances",get:function get(){return EngineStore.Instances;}},{key:"LastCreatedEngine",get:function get(){return EngineStore.LastCreatedEngine;}},{key:"LastCreatedScene",get:function get(){return EngineStore.LastCreatedScene;}},{key:"MarkAllMaterialsAsDirty",value:function MarkAllMaterialsAsDirty(flag,predicate){for(var engineIndex=0;engineIndex<Engine.Instances.length;engineIndex++){var engine=Engine.Instances[engineIndex];for(var sceneIndex=0;sceneIndex<engine.scenes.length;sceneIndex++){engine.scenes[sceneIndex].markAllMaterialsAsDirty(flag,predicate);}}}},{key:"DefaultLoadingScreenFactory",value:function DefaultLoadingScreenFactory(canvas){throw _WarnImport("LoadingScreen");}},{key:"_RequestPointerlock",value:function _RequestPointerlock(element){if(element.requestPointerLock){var promise=element.requestPointerLock();if(promise instanceof Promise)promise.then(function(){element.focus();})["catch"](function(){});else element.focus();}}},{key:"_ExitPointerlock",value:function _ExitPointerlock(){if(document.exitPointerLock){document.exitPointerLock();}}},{key:"_RequestFullscreen",value:function _RequestFullscreen(element){var requestFunction=element.requestFullscreen||element.webkitRequestFullscreen;if(!requestFunction){return;}requestFunction.call(element);}},{key:"_ExitFullscreen",value:function _ExitFullscreen(){var anyDoc=document;if(document.exitFullscreen){document.exitFullscreen();}else if(anyDoc.webkitCancelFullScreen){anyDoc.webkitCancelFullScreen();}}}]);return Engine;}(ThinEngine);Engine.ALPHA_DISABLE=0;Engine.ALPHA_ADD=1;Engine.ALPHA_COMBINE=2;Engine.ALPHA_SUBTRACT=3;Engine.ALPHA_MULTIPLY=4;Engine.ALPHA_MAXIMIZED=5;Engine.ALPHA_ONEONE=6;Engine.ALPHA_PREMULTIPLIED=7;Engine.ALPHA_PREMULTIPLIED_PORTERDUFF=8;Engine.ALPHA_INTERPOLATE=9;Engine.ALPHA_SCREENMODE=10;Engine.DELAYLOADSTATE_NONE=0;Engine.DELAYLOADSTATE_LOADED=1;Engine.DELAYLOADSTATE_LOADING=2;Engine.DELAYLOADSTATE_NOTLOADED=4;Engine.NEVER=512;Engine.ALWAYS=519;Engine.LESS=513;Engine.EQUAL=514;Engine.LEQUAL=515;Engine.GREATER=516;Engine.GEQUAL=518;Engine.NOTEQUAL=517;Engine.KEEP=7680;Engine.REPLACE=7681;Engine.INCR=7682;Engine.DECR=7683;Engine.INVERT=5386;Engine.INCR_WRAP=34055;Engine.DECR_WRAP=34056;Engine.TEXTURE_CLAMP_ADDRESSMODE=0;Engine.TEXTURE_WRAP_ADDRESSMODE=1;Engine.TEXTURE_MIRROR_ADDRESSMODE=2;Engine.TEXTUREFORMAT_ALPHA=0;Engine.TEXTUREFORMAT_LUMINANCE=1;Engine.TEXTUREFORMAT_LUMINANCE_ALPHA=2;Engine.TEXTUREFORMAT_RGB=4;Engine.TEXTUREFORMAT_RGBA=5;Engine.TEXTUREFORMAT_RED=6;Engine.TEXTUREFORMAT_R=6;Engine.TEXTUREFORMAT_RG=7;Engine.TEXTUREFORMAT_RED_INTEGER=8;Engine.TEXTUREFORMAT_R_INTEGER=8;Engine.TEXTUREFORMAT_RG_INTEGER=9;Engine.TEXTUREFORMAT_RGB_INTEGER=10;Engine.TEXTUREFORMAT_RGBA_INTEGER=11;Engine.TEXTURETYPE_UNSIGNED_BYTE=0;Engine.TEXTURETYPE_UNSIGNED_INT=0;Engine.TEXTURETYPE_FLOAT=1;Engine.TEXTURETYPE_HALF_FLOAT=2;Engine.TEXTURETYPE_BYTE=3;Engine.TEXTURETYPE_SHORT=4;Engine.TEXTURETYPE_UNSIGNED_SHORT=5;Engine.TEXTURETYPE_INT=6;Engine.TEXTURETYPE_UNSIGNED_INTEGER=7;Engine.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8;Engine.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9;Engine.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10;Engine.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11;Engine.TEXTURETYPE_UNSIGNED_INT_24_8=12;Engine.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13;Engine.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14;Engine.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15;Engine.TEXTURE_NEAREST_SAMPLINGMODE=1;Engine.TEXTURE_BILINEAR_SAMPLINGMODE=2;Engine.TEXTURE_TRILINEAR_SAMPLINGMODE=3;Engine.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8;Engine.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11;Engine.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3;Engine.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4;Engine.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5;Engine.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6;Engine.TEXTURE_NEAREST_LINEAR=7;Engine.TEXTURE_NEAREST_NEAREST=1;Engine.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9;Engine.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10;Engine.TEXTURE_LINEAR_LINEAR=2;Engine.TEXTURE_LINEAR_NEAREST=12;Engine.TEXTURE_EXPLICIT_MODE=0;Engine.TEXTURE_SPHERICAL_MODE=1;Engine.TEXTURE_PLANAR_MODE=2;Engine.TEXTURE_CUBIC_MODE=3;Engine.TEXTURE_PROJECTION_MODE=4;Engine.TEXTURE_SKYBOX_MODE=5;Engine.TEXTURE_INVCUBIC_MODE=6;Engine.TEXTURE_EQUIRECTANGULAR_MODE=7;Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8;Engine.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;Engine.SCALEMODE_FLOOR=1;Engine.SCALEMODE_NEAREST=2;Engine.SCALEMODE_CEILING=3;Engine._RescalePostProcessFactory=null;Engine._RenderPassIdCounter=0;// node_modules/@babylonjs/core/Loading/sceneLoaderFlags.js
var SceneLoaderFlags=/*#__PURE__*/function(){function SceneLoaderFlags(){_classCallCheck(this,SceneLoaderFlags);}_createClass(SceneLoaderFlags,null,[{key:"ForceFullSceneLoadingForIncremental",get:function get(){return SceneLoaderFlags._ForceFullSceneLoadingForIncremental;},set:function set(value){SceneLoaderFlags._ForceFullSceneLoadingForIncremental=value;}},{key:"ShowLoadingScreen",get:function get(){return SceneLoaderFlags._ShowLoadingScreen;},set:function set(value){SceneLoaderFlags._ShowLoadingScreen=value;}},{key:"loggingLevel",get:function get(){return SceneLoaderFlags._LoggingLevel;},set:function set(value){SceneLoaderFlags._LoggingLevel=value;}},{key:"CleanBoneMatrixWeights",get:function get(){return SceneLoaderFlags._CleanBoneMatrixWeights;},set:function set(value){SceneLoaderFlags._CleanBoneMatrixWeights=value;}}]);return SceneLoaderFlags;}();SceneLoaderFlags._ForceFullSceneLoadingForIncremental=false;SceneLoaderFlags._ShowLoadingScreen=true;SceneLoaderFlags._CleanBoneMatrixWeights=false;SceneLoaderFlags._LoggingLevel=0;// node_modules/@babylonjs/core/Loading/sceneLoader.js
var SceneLoaderAnimationGroupLoadingMode;(function(SceneLoaderAnimationGroupLoadingMode2){SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2["Clean"]=0]="Clean";SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2["Stop"]=1]="Stop";SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2["Sync"]=2]="Sync";SceneLoaderAnimationGroupLoadingMode2[SceneLoaderAnimationGroupLoadingMode2["NoSync"]=3]="NoSync";})(SceneLoaderAnimationGroupLoadingMode||(SceneLoaderAnimationGroupLoadingMode={}));var SceneLoader=/*#__PURE__*/function(){function SceneLoader(){_classCallCheck(this,SceneLoader);}_createClass(SceneLoader,null,[{key:"ForceFullSceneLoadingForIncremental",get:function get(){return SceneLoaderFlags.ForceFullSceneLoadingForIncremental;},set:function set(value){SceneLoaderFlags.ForceFullSceneLoadingForIncremental=value;}},{key:"ShowLoadingScreen",get:function get(){return SceneLoaderFlags.ShowLoadingScreen;},set:function set(value){SceneLoaderFlags.ShowLoadingScreen=value;}},{key:"loggingLevel",get:function get(){return SceneLoaderFlags.loggingLevel;},set:function set(value){SceneLoaderFlags.loggingLevel=value;}},{key:"CleanBoneMatrixWeights",get:function get(){return SceneLoaderFlags.CleanBoneMatrixWeights;},set:function set(value){SceneLoaderFlags.CleanBoneMatrixWeights=value;}},{key:"GetDefaultPlugin",value:function GetDefaultPlugin(){return SceneLoader._RegisteredPlugins[".babylon"];}},{key:"_GetPluginForExtension",value:function _GetPluginForExtension(extension){var registeredPlugin=SceneLoader._RegisteredPlugins[extension];if(registeredPlugin){return registeredPlugin;}Logger.Warn("Unable to find a plugin to load "+extension+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes");return SceneLoader.GetDefaultPlugin();}},{key:"_GetPluginForDirectLoad",value:function _GetPluginForDirectLoad(data){for(var extension in SceneLoader._RegisteredPlugins){var plugin=SceneLoader._RegisteredPlugins[extension].plugin;if(plugin.canDirectLoad&&plugin.canDirectLoad(data)){return SceneLoader._RegisteredPlugins[extension];}}return SceneLoader.GetDefaultPlugin();}},{key:"_GetPluginForFilename",value:function _GetPluginForFilename(sceneFilename){var queryStringPosition=sceneFilename.indexOf("?");if(queryStringPosition!==-1){sceneFilename=sceneFilename.substring(0,queryStringPosition);}var dotPosition=sceneFilename.lastIndexOf(".");var extension=sceneFilename.substring(dotPosition,sceneFilename.length).toLowerCase();return SceneLoader._GetPluginForExtension(extension);}},{key:"_GetDirectLoad",value:function _GetDirectLoad(sceneFilename){if(sceneFilename.substr(0,5)==="data:"){return sceneFilename.substr(5);}return null;}},{key:"_FormatErrorMessage",value:function _FormatErrorMessage(fileInfo,message,exception){var errorMessage="Unable to load from "+fileInfo.url;if(message){errorMessage+=": ".concat(message);}else if(exception){errorMessage+=": ".concat(exception);}return errorMessage;}},{key:"_LoadData",value:function _LoadData(fileInfo,scene2,onSuccess,onProgress,onError,onDispose,pluginExtension){var directLoad=SceneLoader._GetDirectLoad(fileInfo.url);var registeredPlugin=pluginExtension?SceneLoader._GetPluginForExtension(pluginExtension):directLoad?SceneLoader._GetPluginForDirectLoad(fileInfo.url):SceneLoader._GetPluginForFilename(fileInfo.url);var plugin;if(registeredPlugin.plugin.createPlugin!==void 0){plugin=registeredPlugin.plugin.createPlugin();}else{plugin=registeredPlugin.plugin;}if(!plugin){throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";}SceneLoader.OnPluginActivatedObservable.notifyObservers(plugin);if(directLoad&&(plugin.canDirectLoad&&plugin.canDirectLoad(fileInfo.url)||!IsBase64DataUrl(fileInfo.url))){if(plugin.directLoad){var result=plugin.directLoad(scene2,directLoad);if(result.then){result.then(function(data){onSuccess(plugin,data);})["catch"](function(error){onError("Error in directLoad of _loadData: "+error,error);});}else{onSuccess(plugin,result);}}else{onSuccess(plugin,directLoad);}return plugin;}var useArrayBuffer=registeredPlugin.isBinary;var dataCallback=function dataCallback(data,responseURL){if(scene2.isDisposed){onError("Scene has been disposed");return;}onSuccess(plugin,data,responseURL);};var request=null;var pluginDisposed=false;var onDisposeObservable=plugin.onDisposeObservable;if(onDisposeObservable){onDisposeObservable.add(function(){pluginDisposed=true;if(request){request.abort();request=null;}onDispose();});}var manifestChecked=function manifestChecked(){if(pluginDisposed){return;}var errorCallback=function errorCallback(request2,exception){onError(request2===null||request2===void 0?void 0:request2.statusText,exception);};var fileOrUrl=fileInfo.file||fileInfo.url;request=plugin.loadFile?plugin.loadFile(scene2,fileOrUrl,dataCallback,onProgress,useArrayBuffer,errorCallback):scene2._loadFile(fileOrUrl,dataCallback,onProgress,true,useArrayBuffer,errorCallback);};var engine=scene2.getEngine();var canUseOfflineSupport=engine.enableOfflineSupport;if(canUseOfflineSupport){var exceptionFound=false;var _iterator71=_createForOfIteratorHelper(scene2.disableOfflineSupportExceptionRules),_step80;try{for(_iterator71.s();!(_step80=_iterator71.n()).done;){var regex=_step80.value;if(regex.test(fileInfo.url)){exceptionFound=true;break;}}}catch(err){_iterator71.e(err);}finally{_iterator71.f();}canUseOfflineSupport=!exceptionFound;}if(canUseOfflineSupport&&Engine.OfflineProviderFactory){scene2.offlineProvider=Engine.OfflineProviderFactory(fileInfo.url,manifestChecked,engine.disableManifestCheck);}else{manifestChecked();}return plugin;}},{key:"_GetFileInfo",value:function _GetFileInfo(rootUrl,sceneFilename){var url;var name135;var file=null;if(!sceneFilename){url=rootUrl;name135=Tools.GetFilename(rootUrl);rootUrl=Tools.GetFolderPath(rootUrl);}else if(sceneFilename.name){var sceneFile=sceneFilename;url="file:".concat(sceneFile.name);name135=sceneFile.name;file=sceneFile;}else if(typeof sceneFilename==="string"&&sceneFilename.startsWith("data:")){url=sceneFilename;name135="";}else{var filename=sceneFilename;if(filename.substr(0,1)==="/"){Tools.Error("Wrong sceneFilename parameter");return null;}url=rootUrl+filename;name135=filename;}return{url:url,rootUrl:rootUrl,name:name135,file:file};}},{key:"GetPluginForExtension",value:function GetPluginForExtension(extension){return SceneLoader._GetPluginForExtension(extension).plugin;}},{key:"IsPluginForExtensionAvailable",value:function IsPluginForExtensionAvailable(extension){return!!SceneLoader._RegisteredPlugins[extension];}},{key:"RegisterPlugin",value:function RegisterPlugin(plugin){if(typeof plugin.extensions==="string"){var extension=plugin.extensions;SceneLoader._RegisteredPlugins[extension.toLowerCase()]={plugin:plugin,isBinary:false};}else{var extensions=plugin.extensions;Object.keys(extensions).forEach(function(extension){SceneLoader._RegisteredPlugins[extension.toLowerCase()]={plugin:plugin,isBinary:extensions[extension].isBinary};});}}},{key:"ImportMesh",value:function ImportMesh(meshNames,rootUrl){var sceneFilename=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var scene2=arguments.length>3&&arguments[3]!==undefined?arguments[3]:EngineStore.LastCreatedScene;var onSuccess=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onProgress=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onError=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var pluginExtension=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;if(!scene2){Logger.Error("No scene available to import mesh to");return null;}var fileInfo=SceneLoader._GetFileInfo(rootUrl,sceneFilename);if(!fileInfo){return null;}var loadingToken={};scene2.addPendingData(loadingToken);var disposeHandler=function disposeHandler(){scene2.removePendingData(loadingToken);};var errorHandler=function errorHandler(message,exception){var errorMessage=SceneLoader._FormatErrorMessage(fileInfo,message,exception);if(onError){onError(scene2,errorMessage,new RuntimeError(errorMessage,ErrorCodes.SceneLoaderError,exception));}else{Logger.Error(errorMessage);}disposeHandler();};var progressHandler=onProgress?function(event){try{onProgress(event);}catch(e){errorHandler("Error in onProgress callback: "+e,e);}}:void 0;var successHandler=function successHandler(meshes,particleSystems,skeletons,animationGroups,transformNodes,geometries,lights){scene2.importedMeshesFiles.push(fileInfo.url);if(onSuccess){try{onSuccess(meshes,particleSystems,skeletons,animationGroups,transformNodes,geometries,lights);}catch(e){errorHandler("Error in onSuccess callback: "+e,e);}}scene2.removePendingData(loadingToken);};return SceneLoader._LoadData(fileInfo,scene2,function(plugin,data,responseURL){if(plugin.rewriteRootURL){fileInfo.rootUrl=plugin.rewriteRootURL(fileInfo.rootUrl,responseURL);}if(plugin.importMesh){var syncedPlugin=plugin;var meshes=new Array();var particleSystems=new Array();var skeletons=new Array();if(!syncedPlugin.importMesh(meshNames,scene2,data,fileInfo.rootUrl,meshes,particleSystems,skeletons,errorHandler)){return;}scene2.loadingPluginName=plugin.name;successHandler(meshes,particleSystems,skeletons,[],[],[],[]);}else{var asyncedPlugin=plugin;asyncedPlugin.importMeshAsync(meshNames,scene2,data,fileInfo.rootUrl,progressHandler,fileInfo.name).then(function(result){scene2.loadingPluginName=plugin.name;successHandler(result.meshes,result.particleSystems,result.skeletons,result.animationGroups,result.transformNodes,result.geometries,result.lights);})["catch"](function(error){errorHandler(error.message,error);});}},progressHandler,errorHandler,disposeHandler,pluginExtension);}},{key:"ImportMeshAsync",value:function ImportMeshAsync(meshNames,rootUrl){var sceneFilename=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var scene2=arguments.length>3&&arguments[3]!==undefined?arguments[3]:EngineStore.LastCreatedScene;var onProgress=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var pluginExtension=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;return new Promise(function(resolve,reject){SceneLoader.ImportMesh(meshNames,rootUrl,sceneFilename,scene2,function(meshes,particleSystems,skeletons,animationGroups,transformNodes,geometries,lights){resolve({meshes:meshes,particleSystems:particleSystems,skeletons:skeletons,animationGroups:animationGroups,transformNodes:transformNodes,geometries:geometries,lights:lights});},onProgress,function(scene3,message,exception){reject(exception||new Error(message));},pluginExtension);});}},{key:"Load",value:function Load(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var engine=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedEngine;var onSuccess=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var onProgress=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onError=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var pluginExtension=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;if(!engine){Tools.Error("No engine available");return null;}return SceneLoader.Append(rootUrl,sceneFilename,new Scene(engine),onSuccess,onProgress,onError,pluginExtension);}},{key:"LoadAsync",value:function LoadAsync(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var engine=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedEngine;var onProgress=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var pluginExtension=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;return new Promise(function(resolve,reject){SceneLoader.Load(rootUrl,sceneFilename,engine,function(scene2){resolve(scene2);},onProgress,function(scene2,message,exception){reject(exception||new Error(message));},pluginExtension);});}},{key:"Append",value:function Append(rootUrl){var _this69=this;var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedScene;var onSuccess=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var onProgress=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onError=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var pluginExtension=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;if(!scene2){Logger.Error("No scene available to append to");return null;}var fileInfo=SceneLoader._GetFileInfo(rootUrl,sceneFilename);if(!fileInfo){return null;}var loadingToken={};scene2.addPendingData(loadingToken);var disposeHandler=function disposeHandler(){scene2.removePendingData(loadingToken);};if(SceneLoader.ShowLoadingScreen&&!this._ShowingLoadingScreen){this._ShowingLoadingScreen=true;scene2.getEngine().displayLoadingUI();scene2.executeWhenReady(function(){scene2.getEngine().hideLoadingUI();_this69._ShowingLoadingScreen=false;});}var errorHandler=function errorHandler(message,exception){var errorMessage=SceneLoader._FormatErrorMessage(fileInfo,message,exception);if(onError){onError(scene2,errorMessage,new RuntimeError(errorMessage,ErrorCodes.SceneLoaderError,exception));}else{Logger.Error(errorMessage);}disposeHandler();};var progressHandler=onProgress?function(event){try{onProgress(event);}catch(e){errorHandler("Error in onProgress callback",e);}}:void 0;var successHandler=function successHandler(){if(onSuccess){try{onSuccess(scene2);}catch(e){errorHandler("Error in onSuccess callback",e);}}scene2.removePendingData(loadingToken);};return SceneLoader._LoadData(fileInfo,scene2,function(plugin,data){if(plugin.load){var syncedPlugin=plugin;if(!syncedPlugin.load(scene2,data,fileInfo.rootUrl,errorHandler)){return;}scene2.loadingPluginName=plugin.name;successHandler();}else{var asyncedPlugin=plugin;asyncedPlugin.loadAsync(scene2,data,fileInfo.rootUrl,progressHandler,fileInfo.name).then(function(){scene2.loadingPluginName=plugin.name;successHandler();})["catch"](function(error){errorHandler(error.message,error);});}},progressHandler,errorHandler,disposeHandler,pluginExtension);}},{key:"AppendAsync",value:function AppendAsync(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedScene;var onProgress=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var pluginExtension=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;return new Promise(function(resolve,reject){SceneLoader.Append(rootUrl,sceneFilename,scene2,function(scene3){resolve(scene3);},onProgress,function(scene3,message,exception){reject(exception||new Error(message));},pluginExtension);});}},{key:"LoadAssetContainer",value:function LoadAssetContainer(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedScene;var onSuccess=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var onProgress=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onError=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var pluginExtension=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;if(!scene2){Logger.Error("No scene available to load asset container to");return null;}var fileInfo=SceneLoader._GetFileInfo(rootUrl,sceneFilename);if(!fileInfo){return null;}var loadingToken={};scene2.addPendingData(loadingToken);var disposeHandler=function disposeHandler(){scene2.removePendingData(loadingToken);};var errorHandler=function errorHandler(message,exception){var errorMessage=SceneLoader._FormatErrorMessage(fileInfo,message,exception);if(onError){onError(scene2,errorMessage,new RuntimeError(errorMessage,ErrorCodes.SceneLoaderError,exception));}else{Logger.Error(errorMessage);}disposeHandler();};var progressHandler=onProgress?function(event){try{onProgress(event);}catch(e){errorHandler("Error in onProgress callback",e);}}:void 0;var successHandler=function successHandler(assets){if(onSuccess){try{onSuccess(assets);}catch(e){errorHandler("Error in onSuccess callback",e);}}scene2.removePendingData(loadingToken);};return SceneLoader._LoadData(fileInfo,scene2,function(plugin,data){if(plugin.loadAssetContainer){var syncedPlugin=plugin;var assetContainer=syncedPlugin.loadAssetContainer(scene2,data,fileInfo.rootUrl,errorHandler);if(!assetContainer){return;}scene2.loadingPluginName=plugin.name;successHandler(assetContainer);}else if(plugin.loadAssetContainerAsync){var asyncedPlugin=plugin;asyncedPlugin.loadAssetContainerAsync(scene2,data,fileInfo.rootUrl,progressHandler,fileInfo.name).then(function(assetContainer){scene2.loadingPluginName=plugin.name;successHandler(assetContainer);})["catch"](function(error){errorHandler(error.message,error);});}else{errorHandler("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.");}},progressHandler,errorHandler,disposeHandler,pluginExtension);}},{key:"LoadAssetContainerAsync",value:function LoadAssetContainerAsync(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedScene;var onProgress=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var pluginExtension=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;return new Promise(function(resolve,reject){SceneLoader.LoadAssetContainer(rootUrl,sceneFilename,scene2,function(assetContainer){resolve(assetContainer);},onProgress,function(scene3,message,exception){reject(exception||new Error(message));},pluginExtension);});}},{key:"ImportAnimations",value:function ImportAnimations(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedScene;var overwriteAnimations=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var animationGroupLoadingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:SceneLoaderAnimationGroupLoadingMode.Clean;var targetConverter=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onSuccess=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var onProgress=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var onError=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var pluginExtension=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;if(!scene2){Logger.Error("No scene available to load animations to");return;}if(overwriteAnimations){var _iterator72=_createForOfIteratorHelper(scene2.animatables),_step81;try{for(_iterator72.s();!(_step81=_iterator72.n()).done;){var animatable=_step81.value;animatable.reset();}}catch(err){_iterator72.e(err);}finally{_iterator72.f();}scene2.stopAllAnimations();scene2.animationGroups.slice().forEach(function(animationGroup){animationGroup.dispose();});var nodes=scene2.getNodes();nodes.forEach(function(node){if(node.animations){node.animations=[];}});}else{switch(animationGroupLoadingMode){case SceneLoaderAnimationGroupLoadingMode.Clean:scene2.animationGroups.slice().forEach(function(animationGroup){animationGroup.dispose();});break;case SceneLoaderAnimationGroupLoadingMode.Stop:scene2.animationGroups.forEach(function(animationGroup){animationGroup.stop();});break;case SceneLoaderAnimationGroupLoadingMode.Sync:scene2.animationGroups.forEach(function(animationGroup){animationGroup.reset();animationGroup.restart();});break;case SceneLoaderAnimationGroupLoadingMode.NoSync:break;default:Logger.Error("Unknown animation group loading mode value '"+animationGroupLoadingMode+"'");return;}}var startingIndexForNewAnimatables=scene2.animatables.length;var onAssetContainerLoaded=function onAssetContainerLoaded(container){container.mergeAnimationsTo(scene2,scene2.animatables.slice(startingIndexForNewAnimatables),targetConverter);container.dispose();scene2.onAnimationFileImportedObservable.notifyObservers(scene2);if(onSuccess){onSuccess(scene2);}};this.LoadAssetContainer(rootUrl,sceneFilename,scene2,onAssetContainerLoaded,onProgress,onError,pluginExtension);}},{key:"ImportAnimationsAsync",value:function ImportAnimationsAsync(rootUrl){var sceneFilename=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:EngineStore.LastCreatedScene;var overwriteAnimations=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var animationGroupLoadingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:SceneLoaderAnimationGroupLoadingMode.Clean;var targetConverter=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onSuccess=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var onProgress=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var onError=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var pluginExtension=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;return new Promise(function(resolve,reject){SceneLoader.ImportAnimations(rootUrl,sceneFilename,scene2,overwriteAnimations,animationGroupLoadingMode,targetConverter,function(_scene){resolve(_scene);},onProgress,function(_scene,message,exception){reject(exception||new Error(message));},pluginExtension);});}}]);return SceneLoader;}();SceneLoader.NO_LOGGING=0;SceneLoader.MINIMAL_LOGGING=1;SceneLoader.SUMMARY_LOGGING=2;SceneLoader.DETAILED_LOGGING=3;SceneLoader.OnPluginActivatedObservable=new Observable();SceneLoader._RegisteredPlugins={};SceneLoader._ShowingLoadingScreen=false;// node_modules/@babylonjs/core/Misc/coroutine.js
function inlineScheduler(coroutine,onStep,onError){try{var step=coroutine.next();if(step.done){onStep(step);}else if(!step.value){onStep(step);}else{step.value.then(function(){step.value=void 0;onStep(step);},onError);}}catch(error){onError(error);}}function createYieldingScheduler(){var yieldAfterMS=arguments.length>0&&arguments[0]!==undefined?arguments[0]:25;var startTime;return function(coroutine,onStep,onError){var currentTime=performance.now();if(startTime===void 0||currentTime-startTime>yieldAfterMS){startTime=currentTime;setTimeout(function(){inlineScheduler(coroutine,onStep,onError);},0);}else{inlineScheduler(coroutine,onStep,onError);}};}function runCoroutine(coroutine,scheduler,onSuccess,onError,abortSignal){var resume=function resume(){var reschedule;var onStep=function onStep(stepResult){if(stepResult.done){onSuccess(stepResult.value);}else{if(reschedule===void 0){reschedule=true;}else{resume();}}};do{reschedule=void 0;if(!abortSignal||!abortSignal.aborted){scheduler(coroutine,onStep,onError);}else{onError(new Error("Aborted"));}if(reschedule===void 0){reschedule=false;}}while(reschedule);};resume();}function runCoroutineSync(coroutine,abortSignal){var result;runCoroutine(coroutine,inlineScheduler,function(r){return result=r;},function(e){throw e;},abortSignal);return result;}function runCoroutineAsync(coroutine,scheduler,abortSignal){return new Promise(function(resolve,reject){runCoroutine(coroutine,scheduler,resolve,reject,abortSignal);});}function makeSyncFunction(coroutineFactory,abortSignal){return function(){return runCoroutineSync(coroutineFactory.apply(void 0,arguments),abortSignal);};}// node_modules/@babylonjs/core/node.js
var _InternalNodeDataInfo=/*#__PURE__*/_createClass(function _InternalNodeDataInfo(){_classCallCheck(this,_InternalNodeDataInfo);this._doNotSerialize=false;this._isDisposed=false;this._sceneRootNodesIndex=-1;this._isEnabled=true;this._isParentEnabled=true;this._isReady=true;this._onEnabledStateChangedObservable=new Observable();this._onClonedObservable=new Observable();});var Node=/*#__PURE__*/function(){function Node(name135){var scene2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,Node);this._isDirty=false;this._nodeDataStorage=new _InternalNodeDataInfo();this.state="";this.metadata=null;this.reservedDataStore=null;this._accessibilityTag=null;this.onAccessibilityTagChangedObservable=new Observable();this._parentContainer=null;this.animations=new Array();this._ranges={};this.onReady=null;this._currentRenderId=-1;this._parentUpdateId=-1;this._childUpdateId=-1;this._waitingParentId=null;this._waitingParentInstanceIndex=null;this._waitingParsedUniqueId=null;this._cache={};this._parentNode=null;this._children=null;this._worldMatrix=Matrix.Identity();this._worldMatrixDeterminant=0;this._worldMatrixDeterminantIsDirty=true;this._animationPropertiesOverride=null;this._isNode=true;this.onDisposeObservable=new Observable();this._onDisposeObserver=null;this._behaviors=new Array();this.name=name135;this.id=name135;this._scene=scene2||EngineStore.LastCreatedScene;this.uniqueId=this._scene.getUniqueId();this._initCache();}_createClass(Node,[{key:"accessibilityTag",get:function get(){return this._accessibilityTag;},set:function set(value){this._accessibilityTag=value;this.onAccessibilityTagChangedObservable.notifyObservers(value);}},{key:"doNotSerialize",get:function get(){if(this._nodeDataStorage._doNotSerialize){return true;}if(this._parentNode){return this._parentNode.doNotSerialize;}return false;},set:function set(value){this._nodeDataStorage._doNotSerialize=value;}},{key:"isDisposed",value:function isDisposed(){return this._nodeDataStorage._isDisposed;}},{key:"parent",get:function get(){return this._parentNode;},set:function set(parent){if(this._parentNode===parent){return;}var previousParentNode=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var index=this._parentNode._children.indexOf(this);if(index!==-1){this._parentNode._children.splice(index,1);}if(!parent&&!this._nodeDataStorage._isDisposed){this._addToSceneRootNodes();}}this._parentNode=parent;if(this._parentNode){if(this._parentNode._children===void 0||this._parentNode._children===null){this._parentNode._children=new Array();}this._parentNode._children.push(this);if(!previousParentNode){this._removeFromSceneRootNodes();}}this._syncParentEnabledState();}},{key:"_serializeAsParent",value:function _serializeAsParent(serializationObject){serializationObject.parentId=this.uniqueId;}},{key:"_addToSceneRootNodes",value:function _addToSceneRootNodes(){if(this._nodeDataStorage._sceneRootNodesIndex===-1){this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length;this._scene.rootNodes.push(this);}}},{key:"_removeFromSceneRootNodes",value:function _removeFromSceneRootNodes(){if(this._nodeDataStorage._sceneRootNodesIndex!==-1){var rootNodes=this._scene.rootNodes;var lastIdx=rootNodes.length-1;rootNodes[this._nodeDataStorage._sceneRootNodesIndex]=rootNodes[lastIdx];rootNodes[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex;this._scene.rootNodes.pop();this._nodeDataStorage._sceneRootNodesIndex=-1;}}},{key:"animationPropertiesOverride",get:function get(){if(!this._animationPropertiesOverride){return this._scene.animationPropertiesOverride;}return this._animationPropertiesOverride;},set:function set(value){this._animationPropertiesOverride=value;}},{key:"getClassName",value:function getClassName(){return"Node";}},{key:"onDispose",set:function set(callback){if(this._onDisposeObserver){this.onDisposeObservable.remove(this._onDisposeObserver);}this._onDisposeObserver=this.onDisposeObservable.add(callback);}},{key:"onEnabledStateChangedObservable",get:function get(){return this._nodeDataStorage._onEnabledStateChangedObservable;}},{key:"onClonedObservable",get:function get(){return this._nodeDataStorage._onClonedObservable;}},{key:"getScene",value:function getScene(){return this._scene;}},{key:"getEngine",value:function getEngine(){return this._scene.getEngine();}},{key:"addBehavior",value:function addBehavior(behavior){var _this70=this;var attachImmediately=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var index=this._behaviors.indexOf(behavior);if(index!==-1){return this;}behavior.init();if(this._scene.isLoading&&!attachImmediately){this._scene.onDataLoadedObservable.addOnce(function(){behavior.attach(_this70);});}else{behavior.attach(this);}this._behaviors.push(behavior);return this;}},{key:"removeBehavior",value:function removeBehavior(behavior){var index=this._behaviors.indexOf(behavior);if(index===-1){return this;}this._behaviors[index].detach();this._behaviors.splice(index,1);return this;}},{key:"behaviors",get:function get(){return this._behaviors;}},{key:"getBehaviorByName",value:function getBehaviorByName(name135){var _iterator73=_createForOfIteratorHelper(this._behaviors),_step82;try{for(_iterator73.s();!(_step82=_iterator73.n()).done;){var behavior=_step82.value;if(behavior.name===name135){return behavior;}}}catch(err){_iterator73.e(err);}finally{_iterator73.f();}return null;}},{key:"getWorldMatrix",value:function getWorldMatrix(){if(this._currentRenderId!==this._scene.getRenderId()){this.computeWorldMatrix();}return this._worldMatrix;}},{key:"_getWorldMatrixDeterminant",value:function _getWorldMatrixDeterminant(){if(this._worldMatrixDeterminantIsDirty){this._worldMatrixDeterminantIsDirty=false;this._worldMatrixDeterminant=this._worldMatrix.determinant();}return this._worldMatrixDeterminant;}},{key:"worldMatrixFromCache",get:function get(){return this._worldMatrix;}},{key:"_initCache",value:function _initCache(){this._cache={};this._cache.parent=void 0;}},{key:"updateCache",value:function updateCache(force){if(!force&&this.isSynchronized()){return;}this._cache.parent=this.parent;this._updateCache();}},{key:"_getActionManagerForTrigger",value:function _getActionManagerForTrigger(trigger){var _initialCall=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this.parent){return null;}return this.parent._getActionManagerForTrigger(trigger,false);}},{key:"_updateCache",value:function _updateCache(_ignoreParentClass){}},{key:"_isSynchronized",value:function _isSynchronized(){return true;}},{key:"_markSyncedWithParent",value:function _markSyncedWithParent(){if(this._parentNode){this._parentUpdateId=this._parentNode._childUpdateId;}}},{key:"isSynchronizedWithParent",value:function isSynchronizedWithParent(){if(!this._parentNode){return true;}if(this._parentNode._isDirty||this._parentUpdateId!==this._parentNode._childUpdateId){return false;}return this._parentNode.isSynchronized();}},{key:"isSynchronized",value:function isSynchronized(){if(this._cache.parent!==this._parentNode){this._cache.parent=this._parentNode;return false;}if(this._parentNode&&!this.isSynchronizedWithParent()){return false;}return this._isSynchronized();}},{key:"isReady",value:function isReady(){var _completeCheck=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this._nodeDataStorage._isReady;}},{key:"markAsDirty",value:function markAsDirty(_property){this._currentRenderId=Number.MAX_VALUE;this._isDirty=true;return this;}},{key:"isEnabled",value:function isEnabled(){var checkAncestors=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(checkAncestors===false){return this._nodeDataStorage._isEnabled;}if(!this._nodeDataStorage._isEnabled){return false;}return this._nodeDataStorage._isParentEnabled;}},{key:"_syncParentEnabledState",value:function _syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=this._parentNode?this._parentNode.isEnabled():true;if(this._children){this._children.forEach(function(c){c._syncParentEnabledState();});}}},{key:"setEnabled",value:function setEnabled(value){if(this._nodeDataStorage._isEnabled===value){return;}this._nodeDataStorage._isEnabled=value;this._syncParentEnabledState();this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(value);}},{key:"isDescendantOf",value:function isDescendantOf(ancestor){if(this.parent){if(this.parent===ancestor){return true;}return this.parent.isDescendantOf(ancestor);}return false;}},{key:"_getDescendants",value:function _getDescendants(results){var directDescendantsOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var predicate=arguments.length>2?arguments[2]:undefined;if(!this._children){return;}for(var index=0;index<this._children.length;index++){var item=this._children[index];if(!predicate||predicate(item)){results.push(item);}if(!directDescendantsOnly){item._getDescendants(results,false,predicate);}}}},{key:"getDescendants",value:function getDescendants(directDescendantsOnly,predicate){var results=new Array();this._getDescendants(results,directDescendantsOnly,predicate);return results;}},{key:"getChildMeshes",value:function getChildMeshes(directDescendantsOnly,predicate){var results=[];this._getDescendants(results,directDescendantsOnly,function(node){return(!predicate||predicate(node))&&node.cullingStrategy!==void 0;});return results;}},{key:"getChildren",value:function getChildren(predicate){var directDescendantsOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return this.getDescendants(directDescendantsOnly,predicate);}},{key:"_setReady",value:function _setReady(state){if(state===this._nodeDataStorage._isReady){return;}if(!state){this._nodeDataStorage._isReady=false;return;}if(this.onReady){this.onReady(this);}this._nodeDataStorage._isReady=true;}},{key:"getAnimationByName",value:function getAnimationByName(name135){for(var i=0;i<this.animations.length;i++){var animation=this.animations[i];if(animation.name===name135){return animation;}}return null;}},{key:"createAnimationRange",value:function createAnimationRange(name135,from,to){if(!this._ranges[name135]){this._ranges[name135]=Node._AnimationRangeFactory(name135,from,to);for(var i=0,nAnimations=this.animations.length;i<nAnimations;i++){if(this.animations[i]){this.animations[i].createRange(name135,from,to);}}}}},{key:"deleteAnimationRange",value:function deleteAnimationRange(name135){var deleteFrames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;for(var i=0,nAnimations=this.animations.length;i<nAnimations;i++){if(this.animations[i]){this.animations[i].deleteRange(name135,deleteFrames);}}this._ranges[name135]=null;}},{key:"getAnimationRange",value:function getAnimationRange(name135){return this._ranges[name135]||null;}},{key:"getAnimationRanges",value:function getAnimationRanges(){var animationRanges=[];var name135;for(name135 in this._ranges){animationRanges.push(this._ranges[name135]);}return animationRanges;}},{key:"beginAnimation",value:function beginAnimation(name135,loop,speedRatio,onAnimationEnd){var range=this.getAnimationRange(name135);if(!range){return null;}return this._scene.beginAnimation(this,range.from,range.to,loop,speedRatio,onAnimationEnd);}},{key:"serializeAnimationRanges",value:function serializeAnimationRanges(){var serializationRanges=[];for(var name135 in this._ranges){var localRange=this._ranges[name135];if(!localRange){continue;}var range={};range.name=name135;range.from=localRange.from;range.to=localRange.to;serializationRanges.push(range);}return serializationRanges;}},{key:"computeWorldMatrix",value:function computeWorldMatrix(_force){if(!this._worldMatrix){this._worldMatrix=Matrix.Identity();}return this._worldMatrix;}},{key:"dispose",value:function dispose(doNotRecurse){var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._nodeDataStorage._isDisposed=true;if(!doNotRecurse){var nodes=this.getDescendants(true);var _iterator74=_createForOfIteratorHelper(nodes),_step83;try{for(_iterator74.s();!(_step83=_iterator74.n()).done;){var node=_step83.value;node.dispose(doNotRecurse,disposeMaterialAndTextures);}}catch(err){_iterator74.e(err);}finally{_iterator74.f();}}if(!this.parent){this._removeFromSceneRootNodes();}else{this.parent=null;}this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.onEnabledStateChangedObservable.clear();this.onClonedObservable.clear();var _iterator75=_createForOfIteratorHelper(this._behaviors),_step84;try{for(_iterator75.s();!(_step84=_iterator75.n()).done;){var behavior=_step84.value;behavior.detach();}}catch(err){_iterator75.e(err);}finally{_iterator75.f();}this._behaviors.length=0;this.metadata=null;}},{key:"getHierarchyBoundingVectors",value:function getHierarchyBoundingVectors(){var includeDescendants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var predicate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this.getScene().incrementRenderId();this.computeWorldMatrix(true);var min;var max;var thisAbstractMesh=this;if(thisAbstractMesh.getBoundingInfo&&thisAbstractMesh.subMeshes){var boundingInfo=thisAbstractMesh.getBoundingInfo();min=boundingInfo.boundingBox.minimumWorld.clone();max=boundingInfo.boundingBox.maximumWorld.clone();}else{min=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);max=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);}if(includeDescendants){var descendants=this.getDescendants(false);var _iterator76=_createForOfIteratorHelper(descendants),_step85;try{for(_iterator76.s();!(_step85=_iterator76.n()).done;){var descendant=_step85.value;var childMesh=descendant;childMesh.computeWorldMatrix(true);if(predicate&&!predicate(childMesh)){continue;}if(!childMesh.getBoundingInfo||childMesh.getTotalVertices()===0){continue;}var childBoundingInfo=childMesh.getBoundingInfo();var boundingBox=childBoundingInfo.boundingBox;var minBox=boundingBox.minimumWorld;var maxBox=boundingBox.maximumWorld;Vector3.CheckExtends(minBox,min,max);Vector3.CheckExtends(maxBox,min,max);}}catch(err){_iterator76.e(err);}finally{_iterator76.f();}}return{min:min,max:max};}}],[{key:"AddNodeConstructor",value:function AddNodeConstructor(type,constructorFunc){this._NodeConstructors[type]=constructorFunc;}},{key:"Construct",value:function Construct(type,name135,scene2,options){var constructorFunc=this._NodeConstructors[type];if(!constructorFunc){return null;}return constructorFunc(name135,scene2,options);}},{key:"ParseAnimationRanges",value:function ParseAnimationRanges(node,parsedNode,_scene){if(parsedNode.ranges){for(var index=0;index<parsedNode.ranges.length;index++){var data=parsedNode.ranges[index];node.createAnimationRange(data.name,data.from,data.to);}}}}]);return Node;}();Node._AnimationRangeFactory=function(_name,_from,_to){throw _WarnImport("AnimationRange");};Node._NodeConstructors={};__decorate([serialize()],Node.prototype,"name",void 0);__decorate([serialize()],Node.prototype,"id",void 0);__decorate([serialize()],Node.prototype,"uniqueId",void 0);__decorate([serialize()],Node.prototype,"state",void 0);__decorate([serialize()],Node.prototype,"metadata",void 0);// node_modules/@babylonjs/core/Maths/math.viewport.js
var Viewport=/*#__PURE__*/function(){function Viewport(x,y,width,height){_classCallCheck(this,Viewport);this.x=x;this.y=y;this.width=width;this.height=height;}_createClass(Viewport,[{key:"toGlobal",value:function toGlobal(renderWidth,renderHeight){return new Viewport(this.x*renderWidth,this.y*renderHeight,this.width*renderWidth,this.height*renderHeight);}},{key:"toGlobalToRef",value:function toGlobalToRef(renderWidth,renderHeight,ref){ref.x=this.x*renderWidth;ref.y=this.y*renderHeight;ref.width=this.width*renderWidth;ref.height=this.height*renderHeight;return this;}},{key:"clone",value:function clone(){return new Viewport(this.x,this.y,this.width,this.height);}}]);return Viewport;}();// node_modules/@babylonjs/core/Cameras/camera.js
var Camera=/*#__PURE__*/function(_Node){_inherits(Camera,_Node);var _super21=_createSuper(Camera);function Camera(name135,position,scene2){var _this71;var setActiveOnSceneIfNoneActive=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;_classCallCheck(this,Camera);_this71=_super21.call(this,name135,scene2);_this71._position=Vector3.Zero();_this71._upVector=Vector3.Up();_this71._orthoLeft=null;_this71._orthoRight=null;_this71._orthoBottom=null;_this71._orthoTop=null;_this71.fov=0.8;_this71.projectionPlaneTilt=0;_this71.minZ=1;_this71.maxZ=1e4;_this71.inertia=0.9;_this71._mode=Camera.PERSPECTIVE_CAMERA;_this71.isIntermediate=false;_this71.viewport=new Viewport(0,0,1,1);_this71.layerMask=268435455;_this71.fovMode=Camera.FOVMODE_VERTICAL_FIXED;_this71.cameraRigMode=Camera.RIG_MODE_NONE;_this71.customRenderTargets=new Array();_this71.outputRenderTarget=null;_this71.onViewMatrixChangedObservable=new Observable();_this71.onProjectionMatrixChangedObservable=new Observable();_this71.onAfterCheckInputsObservable=new Observable();_this71.onRestoreStateObservable=new Observable();_this71.isRigCamera=false;_this71._rigCameras=new Array();_this71._webvrViewMatrix=Matrix.Identity();_this71._skipRendering=false;_this71._projectionMatrix=new Matrix();_this71._postProcesses=new Array();_this71._activeMeshes=new SmartArray(256);_this71._globalPosition=Vector3.Zero();_this71._computedViewMatrix=Matrix.Identity();_this71._doNotComputeProjectionMatrix=false;_this71._transformMatrix=Matrix.Zero();_this71._refreshFrustumPlanes=true;_this71._absoluteRotation=Quaternion.Identity();_this71._isCamera=true;_this71._isLeftCamera=false;_this71._isRightCamera=false;_this71.getScene().addCamera(_assertThisInitialized(_this71));if(setActiveOnSceneIfNoneActive&&!_this71.getScene().activeCamera){_this71.getScene().activeCamera=_assertThisInitialized(_this71);}_this71.position=position;_this71.renderPassId=_this71.getScene().getEngine().createRenderPassId("Camera ".concat(name135));return _this71;}_createClass(Camera,[{key:"position",get:function get(){return this._position;},set:function set(newPosition){this._position=newPosition;}},{key:"upVector",get:function get(){return this._upVector;},set:function set(vec){this._upVector=vec;}},{key:"screenArea",get:function get(){var _a,_b,_c,_d;var x=0;var y=0;if(this.mode===Camera.PERSPECTIVE_CAMERA){if(this.fovMode===Camera.FOVMODE_VERTICAL_FIXED){y=this.minZ*2*Math.tan(this.fov/2);x=this.getEngine().getAspectRatio(this)*y;}else{x=this.minZ*2*Math.tan(this.fov/2);y=x/this.getEngine().getAspectRatio(this);}}else{var halfWidth=this.getEngine().getRenderWidth()/2;var halfHeight=this.getEngine().getRenderHeight()/2;x=((_a=this.orthoRight)!==null&&_a!==void 0?_a:halfWidth)-((_b=this.orthoLeft)!==null&&_b!==void 0?_b:-halfWidth);y=((_c=this.orthoTop)!==null&&_c!==void 0?_c:halfHeight)-((_d=this.orthoBottom)!==null&&_d!==void 0?_d:-halfHeight);}return x*y;}},{key:"orthoLeft",get:function get(){return this._orthoLeft;},set:function set(value){this._orthoLeft=value;var _iterator77=_createForOfIteratorHelper(this._rigCameras),_step86;try{for(_iterator77.s();!(_step86=_iterator77.n()).done;){var rigCamera=_step86.value;rigCamera.orthoLeft=value;}}catch(err){_iterator77.e(err);}finally{_iterator77.f();}}},{key:"orthoRight",get:function get(){return this._orthoRight;},set:function set(value){this._orthoRight=value;var _iterator78=_createForOfIteratorHelper(this._rigCameras),_step87;try{for(_iterator78.s();!(_step87=_iterator78.n()).done;){var rigCamera=_step87.value;rigCamera.orthoRight=value;}}catch(err){_iterator78.e(err);}finally{_iterator78.f();}}},{key:"orthoBottom",get:function get(){return this._orthoBottom;},set:function set(value){this._orthoBottom=value;var _iterator79=_createForOfIteratorHelper(this._rigCameras),_step88;try{for(_iterator79.s();!(_step88=_iterator79.n()).done;){var rigCamera=_step88.value;rigCamera.orthoBottom=value;}}catch(err){_iterator79.e(err);}finally{_iterator79.f();}}},{key:"orthoTop",get:function get(){return this._orthoTop;},set:function set(value){this._orthoTop=value;var _iterator80=_createForOfIteratorHelper(this._rigCameras),_step89;try{for(_iterator80.s();!(_step89=_iterator80.n()).done;){var rigCamera=_step89.value;rigCamera.orthoTop=value;}}catch(err){_iterator80.e(err);}finally{_iterator80.f();}}},{key:"mode",get:function get(){return this._mode;},set:function set(mode){this._mode=mode;var _iterator81=_createForOfIteratorHelper(this._rigCameras),_step90;try{for(_iterator81.s();!(_step90=_iterator81.n()).done;){var rigCamera=_step90.value;rigCamera.mode=mode;}}catch(err){_iterator81.e(err);}finally{_iterator81.f();}}},{key:"storeState",value:function storeState(){this._stateStored=true;this._storedFov=this.fov;return this;}},{key:"_restoreStateValues",value:function _restoreStateValues(){if(!this._stateStored){return false;}this.fov=this._storedFov;return true;}},{key:"restoreState",value:function restoreState(){if(this._restoreStateValues()){this.onRestoreStateObservable.notifyObservers(this);return true;}return false;}},{key:"getClassName",value:function getClassName(){return"Camera";}},{key:"toString",value:function toString(fullDetails){var ret="Name: "+this.name;ret+=", type: "+this.getClassName();if(this.animations){for(var i=0;i<this.animations.length;i++){ret+=", animation[0]: "+this.animations[i].toString(fullDetails);}}return ret;}},{key:"applyVerticalCorrection",value:function applyVerticalCorrection(){var rot=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-rot.x:rot.x;}},{key:"globalPosition",get:function get(){return this._globalPosition;}},{key:"getActiveMeshes",value:function getActiveMeshes(){return this._activeMeshes;}},{key:"isActiveMesh",value:function isActiveMesh(mesh){return this._activeMeshes.indexOf(mesh)!==-1;}},{key:"isReady",value:function isReady(){var completeCheck=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(completeCheck){var _iterator82=_createForOfIteratorHelper(this._postProcesses),_step91;try{for(_iterator82.s();!(_step91=_iterator82.n()).done;){var pp=_step91.value;if(pp&&!pp.isReady()){return false;}}}catch(err){_iterator82.e(err);}finally{_iterator82.f();}}return _get(_getPrototypeOf(Camera.prototype),"isReady",this).call(this,completeCheck);}},{key:"_initCache",value:function _initCache(){_get(_getPrototypeOf(Camera.prototype),"_initCache",this).call(this);this._cache.position=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.upVector=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.mode=void 0;this._cache.minZ=void 0;this._cache.maxZ=void 0;this._cache.fov=void 0;this._cache.fovMode=void 0;this._cache.aspectRatio=void 0;this._cache.orthoLeft=void 0;this._cache.orthoRight=void 0;this._cache.orthoBottom=void 0;this._cache.orthoTop=void 0;this._cache.renderWidth=void 0;this._cache.renderHeight=void 0;}},{key:"_updateCache",value:function _updateCache(ignoreParentClass){if(!ignoreParentClass){_get(_getPrototypeOf(Camera.prototype),"_updateCache",this).call(this);}this._cache.position.copyFrom(this.position);this._cache.upVector.copyFrom(this.upVector);}},{key:"_isSynchronized",value:function _isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix();}},{key:"_isSynchronizedViewMatrix",value:function _isSynchronizedViewMatrix(){if(!_get(_getPrototypeOf(Camera.prototype),"_isSynchronized",this).call(this)){return false;}return this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent();}},{key:"_isSynchronizedProjectionMatrix",value:function _isSynchronizedProjectionMatrix(){var check=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!check){return false;}var engine=this.getEngine();if(this.mode===Camera.PERSPECTIVE_CAMERA){check=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===engine.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt;}else{check=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===engine.getRenderWidth()&&this._cache.renderHeight===engine.getRenderHeight();}return check;}},{key:"attachControl",value:function attachControl(_ignored,_noPreventDefault){}},{key:"detachControl",value:function detachControl(_ignored){}},{key:"update",value:function update(){this._checkInputs();if(this.cameraRigMode!==Camera.RIG_MODE_NONE){this._updateRigCameras();}this.getViewMatrix();this.getProjectionMatrix();}},{key:"_checkInputs",value:function _checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this);}},{key:"rigCameras",get:function get(){return this._rigCameras;}},{key:"rigPostProcess",get:function get(){return this._rigPostProcess;}},{key:"_getFirstPostProcess",value:function _getFirstPostProcess(){for(var ppIndex=0;ppIndex<this._postProcesses.length;ppIndex++){if(this._postProcesses[ppIndex]!==null){return this._postProcesses[ppIndex];}}return null;}},{key:"_cascadePostProcessesToRigCams",value:function _cascadePostProcessesToRigCams(){var firstPostProcess=this._getFirstPostProcess();if(firstPostProcess){firstPostProcess.markTextureDirty();}for(var i=0,len=this._rigCameras.length;i<len;i++){var cam=this._rigCameras[i];var rigPostProcess=cam._rigPostProcess;if(rigPostProcess){var isPass=rigPostProcess.getEffectName()==="pass";if(isPass){cam.isIntermediate=this._postProcesses.length===0;}cam._postProcesses=this._postProcesses.slice(0).concat(rigPostProcess);rigPostProcess.markTextureDirty();}else{cam._postProcesses=this._postProcesses.slice(0);}}}},{key:"attachPostProcess",value:function attachPostProcess(postProcess){var insertAt=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!postProcess.isReusable()&&this._postProcesses.indexOf(postProcess)>-1){Logger.Error("You're trying to reuse a post process not defined as reusable.");return 0;}if(insertAt==null||insertAt<0){this._postProcesses.push(postProcess);}else if(this._postProcesses[insertAt]===null){this._postProcesses[insertAt]=postProcess;}else{this._postProcesses.splice(insertAt,0,postProcess);}this._cascadePostProcessesToRigCams();if(this._scene.prePassRenderer){this._scene.prePassRenderer.markAsDirty();}return this._postProcesses.indexOf(postProcess);}},{key:"detachPostProcess",value:function detachPostProcess(postProcess){var idx=this._postProcesses.indexOf(postProcess);if(idx!==-1){this._postProcesses[idx]=null;}if(this._scene.prePassRenderer){this._scene.prePassRenderer.markAsDirty();}this._cascadePostProcessesToRigCams();}},{key:"getWorldMatrix",value:function getWorldMatrix(){if(this._isSynchronizedViewMatrix()){return this._worldMatrix;}this.getViewMatrix();return this._worldMatrix;}},{key:"_getViewMatrix",value:function _getViewMatrix(){return Matrix.Identity();}},{key:"getViewMatrix",value:function getViewMatrix(force){if(!force&&this._isSynchronizedViewMatrix()){return this._computedViewMatrix;}this.updateCache();this._computedViewMatrix=this._getViewMatrix();this._currentRenderId=this.getScene().getRenderId();this._childUpdateId++;this._refreshFrustumPlanes=true;if(this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix){this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix);}if(this.parent&&this.parent.onViewMatrixChangedObservable){this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent);}this.onViewMatrixChangedObservable.notifyObservers(this);this._computedViewMatrix.invertToRef(this._worldMatrix);return this._computedViewMatrix;}},{key:"freezeProjectionMatrix",value:function freezeProjectionMatrix(projection){this._doNotComputeProjectionMatrix=true;if(projection!==void 0){this._projectionMatrix=projection;}}},{key:"unfreezeProjectionMatrix",value:function unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=false;}},{key:"getProjectionMatrix",value:function getProjectionMatrix(force){var _a,_b,_c,_d,_e,_f,_g,_h;if(this._doNotComputeProjectionMatrix||!force&&this._isSynchronizedProjectionMatrix()){return this._projectionMatrix;}this._cache.mode=this.mode;this._cache.minZ=this.minZ;this._cache.maxZ=this.maxZ;this._refreshFrustumPlanes=true;var engine=this.getEngine();var scene2=this.getScene();var reverseDepth=engine.useReverseDepthBuffer;if(this.mode===Camera.PERSPECTIVE_CAMERA){this._cache.fov=this.fov;this._cache.fovMode=this.fovMode;this._cache.aspectRatio=engine.getAspectRatio(this);this._cache.projectionPlaneTilt=this.projectionPlaneTilt;if(this.minZ<=0){this.minZ=0.1;}var getProjectionMatrix;if(scene2.useRightHandedSystem){getProjectionMatrix=Matrix.PerspectiveFovRHToRef;}else{getProjectionMatrix=Matrix.PerspectiveFovLHToRef;}getProjectionMatrix(this.fov,engine.getAspectRatio(this),reverseDepth?this.maxZ:this.minZ,reverseDepth?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===Camera.FOVMODE_VERTICAL_FIXED,engine.isNDCHalfZRange,this.projectionPlaneTilt,reverseDepth);}else{var halfWidth=engine.getRenderWidth()/2;var halfHeight=engine.getRenderHeight()/2;if(scene2.useRightHandedSystem){Matrix.OrthoOffCenterRHToRef((_a=this.orthoLeft)!==null&&_a!==void 0?_a:-halfWidth,(_b=this.orthoRight)!==null&&_b!==void 0?_b:halfWidth,(_c=this.orthoBottom)!==null&&_c!==void 0?_c:-halfHeight,(_d=this.orthoTop)!==null&&_d!==void 0?_d:halfHeight,reverseDepth?this.maxZ:this.minZ,reverseDepth?this.minZ:this.maxZ,this._projectionMatrix,engine.isNDCHalfZRange);}else{Matrix.OrthoOffCenterLHToRef((_e=this.orthoLeft)!==null&&_e!==void 0?_e:-halfWidth,(_f=this.orthoRight)!==null&&_f!==void 0?_f:halfWidth,(_g=this.orthoBottom)!==null&&_g!==void 0?_g:-halfHeight,(_h=this.orthoTop)!==null&&_h!==void 0?_h:halfHeight,reverseDepth?this.maxZ:this.minZ,reverseDepth?this.minZ:this.maxZ,this._projectionMatrix,engine.isNDCHalfZRange);}this._cache.orthoLeft=this.orthoLeft;this._cache.orthoRight=this.orthoRight;this._cache.orthoBottom=this.orthoBottom;this._cache.orthoTop=this.orthoTop;this._cache.renderWidth=engine.getRenderWidth();this._cache.renderHeight=engine.getRenderHeight();}this.onProjectionMatrixChangedObservable.notifyObservers(this);return this._projectionMatrix;}},{key:"getTransformationMatrix",value:function getTransformationMatrix(){this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix);return this._transformMatrix;}},{key:"_updateFrustumPlanes",value:function _updateFrustumPlanes(){if(!this._refreshFrustumPlanes){return;}this.getTransformationMatrix();if(!this._frustumPlanes){this._frustumPlanes=Frustum.GetPlanes(this._transformMatrix);}else{Frustum.GetPlanesToRef(this._transformMatrix,this._frustumPlanes);}this._refreshFrustumPlanes=false;}},{key:"isInFrustum",value:function isInFrustum(target){var checkRigCameras=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._updateFrustumPlanes();if(checkRigCameras&&this.rigCameras.length>0){var result=false;this.rigCameras.forEach(function(cam){cam._updateFrustumPlanes();result=result||target.isInFrustum(cam._frustumPlanes);});return result;}else{return target.isInFrustum(this._frustumPlanes);}}},{key:"isCompletelyInFrustum",value:function isCompletelyInFrustum(target){this._updateFrustumPlanes();return target.isCompletelyInFrustum(this._frustumPlanes);}},{key:"getForwardRay",value:function getForwardRay(){var length=arguments.length>0&&arguments[0]!==undefined?arguments[0]:100;var transform=arguments.length>1?arguments[1]:undefined;var origin=arguments.length>2?arguments[2]:undefined;throw _WarnImport("Ray");}},{key:"getForwardRayToRef",value:function getForwardRayToRef(refRay){var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var transform=arguments.length>2?arguments[2]:undefined;var origin=arguments.length>3?arguments[3]:undefined;throw _WarnImport("Ray");}},{key:"dispose",value:function dispose(doNotRecurse){var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.onViewMatrixChangedObservable.clear();this.onProjectionMatrixChangedObservable.clear();this.onAfterCheckInputsObservable.clear();this.onRestoreStateObservable.clear();if(this.inputs){this.inputs.clear();}this.getScene().stopAnimation(this);this.getScene().removeCamera(this);while(this._rigCameras.length>0){var camera=this._rigCameras.pop();if(camera){camera.dispose();}}if(this._parentContainer){var index=this._parentContainer.cameras.indexOf(this);if(index>-1){this._parentContainer.cameras.splice(index,1);}this._parentContainer=null;}if(this._rigPostProcess){this._rigPostProcess.dispose(this);this._rigPostProcess=null;this._postProcesses.length=0;}else if(this.cameraRigMode!==Camera.RIG_MODE_NONE){this._rigPostProcess=null;this._postProcesses.length=0;}else{var i2=this._postProcesses.length;while(--i2>=0){var postProcess=this._postProcesses[i2];if(postProcess){postProcess.dispose(this);}}}var i=this.customRenderTargets.length;while(--i>=0){this.customRenderTargets[i].dispose();}this.customRenderTargets.length=0;this._activeMeshes.dispose();this.getScene().getEngine().releaseRenderPassId(this.renderPassId);_get(_getPrototypeOf(Camera.prototype),"dispose",this).call(this,doNotRecurse,disposeMaterialAndTextures);}},{key:"isLeftCamera",get:function get(){return this._isLeftCamera;}},{key:"isRightCamera",get:function get(){return this._isRightCamera;}},{key:"leftCamera",get:function get(){if(this._rigCameras.length<1){return null;}return this._rigCameras[0];}},{key:"rightCamera",get:function get(){if(this._rigCameras.length<2){return null;}return this._rigCameras[1];}},{key:"getLeftTarget",value:function getLeftTarget(){if(this._rigCameras.length<1){return null;}return this._rigCameras[0].getTarget();}},{key:"getRightTarget",value:function getRightTarget(){if(this._rigCameras.length<2){return null;}return this._rigCameras[1].getTarget();}},{key:"setCameraRigMode",value:function setCameraRigMode(mode,rigParams){if(this.cameraRigMode===mode){return;}while(this._rigCameras.length>0){var camera=this._rigCameras.pop();if(camera){camera.dispose();}}this.cameraRigMode=mode;this._cameraRigParams={};this._cameraRigParams.interaxialDistance=rigParams.interaxialDistance||0.0637;this._cameraRigParams.stereoHalfAngle=Tools.ToRadians(this._cameraRigParams.interaxialDistance/0.0637);if(this.cameraRigMode!==Camera.RIG_MODE_NONE){var leftCamera=this.createRigCamera(this.name+"_L",0);if(leftCamera){leftCamera._isLeftCamera=true;}var rightCamera=this.createRigCamera(this.name+"_R",1);if(rightCamera){rightCamera._isRightCamera=true;}if(leftCamera&&rightCamera){this._rigCameras.push(leftCamera);this._rigCameras.push(rightCamera);}}this._setRigMode(rigParams);this._cascadePostProcessesToRigCams();this.update();}},{key:"_setRigMode",value:function _setRigMode(rigParams){}},{key:"_getVRProjectionMatrix",value:function _getVRProjectionMatrix(){Matrix.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,true,this.getEngine().isNDCHalfZRange);this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix);return this._projectionMatrix;}},{key:"_updateCameraRotationMatrix",value:function _updateCameraRotationMatrix(){}},{key:"_updateWebVRCameraRotationMatrix",value:function _updateWebVRCameraRotationMatrix(){}},{key:"_getWebVRProjectionMatrix",value:function _getWebVRProjectionMatrix(){return Matrix.Identity();}},{key:"_getWebVRViewMatrix",value:function _getWebVRViewMatrix(){return Matrix.Identity();}},{key:"setCameraRigParameter",value:function setCameraRigParameter(name135,value){if(!this._cameraRigParams){this._cameraRigParams={};}this._cameraRigParams[name135]=value;if(name135==="interaxialDistance"){this._cameraRigParams.stereoHalfAngle=Tools.ToRadians(value/0.0637);}}},{key:"createRigCamera",value:function createRigCamera(name135,cameraIndex){return null;}},{key:"_updateRigCameras",value:function _updateRigCameras(){for(var i=0;i<this._rigCameras.length;i++){this._rigCameras[i].minZ=this.minZ;this._rigCameras[i].maxZ=this.maxZ;this._rigCameras[i].fov=this.fov;this._rigCameras[i].upVector.copyFrom(this.upVector);}if(this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH){this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport;}}},{key:"_setupInputs",value:function _setupInputs(){}},{key:"serialize",value:function serialize(){var serializationObject=SerializationHelper.Serialize(this);serializationObject.uniqueId=this.uniqueId;serializationObject.type=this.getClassName();if(this.parent){this.parent._serializeAsParent(serializationObject);}if(this.inputs){this.inputs.serialize(serializationObject);}SerializationHelper.AppendSerializedAnimations(this,serializationObject);serializationObject.ranges=this.serializeAnimationRanges();serializationObject.isEnabled=this.isEnabled();return serializationObject;}},{key:"clone",value:function clone(name135){var newParent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var camera=SerializationHelper.Clone(Camera.GetConstructorFromName(this.getClassName(),name135,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);camera.name=name135;camera.parent=newParent;this.onClonedObservable.notifyObservers(camera);return camera;}},{key:"getDirection",value:function getDirection(localAxis){var result=Vector3.Zero();this.getDirectionToRef(localAxis,result);return result;}},{key:"absoluteRotation",get:function get(){this.getWorldMatrix().decompose(void 0,this._absoluteRotation);return this._absoluteRotation;}},{key:"getDirectionToRef",value:function getDirectionToRef(localAxis,result){Vector3.TransformNormalToRef(localAxis,this.getWorldMatrix(),result);}},{key:"computeWorldMatrix",value:function computeWorldMatrix(){return this.getWorldMatrix();}}],[{key:"GetConstructorFromName",value:function GetConstructorFromName(type,name135,scene2){var interaxial_distance=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var isStereoscopicSideBySide=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var constructorFunc=Node.Construct(type,name135,scene2,{interaxial_distance:interaxial_distance,isStereoscopicSideBySide:isStereoscopicSideBySide});if(constructorFunc){return constructorFunc;}return function(){return Camera._CreateDefaultParsedCamera(name135,scene2);};}},{key:"Parse",value:function Parse(parsedCamera,scene2){var type=parsedCamera.type;var construct=Camera.GetConstructorFromName(type,parsedCamera.name,scene2,parsedCamera.interaxial_distance,parsedCamera.isStereoscopicSideBySide);var camera=SerializationHelper.Parse(construct,parsedCamera,scene2);if(parsedCamera.parentId!==void 0){camera._waitingParentId=parsedCamera.parentId;}if(parsedCamera.parentInstanceIndex!==void 0){camera._waitingParentInstanceIndex=parsedCamera.parentInstanceIndex;}if(camera.inputs){camera.inputs.parse(parsedCamera);camera._setupInputs();}if(parsedCamera.upVector){camera.upVector=Vector3.FromArray(parsedCamera.upVector);}if(camera.setPosition){camera.position.copyFromFloats(0,0,0);camera.setPosition(Vector3.FromArray(parsedCamera.position));}if(parsedCamera.target){if(camera.setTarget){camera.setTarget(Vector3.FromArray(parsedCamera.target));}}if(parsedCamera.cameraRigMode){var rigParams=parsedCamera.interaxial_distance?{interaxialDistance:parsedCamera.interaxial_distance}:{};camera.setCameraRigMode(parsedCamera.cameraRigMode,rigParams);}if(parsedCamera.animations){for(var animationIndex=0;animationIndex<parsedCamera.animations.length;animationIndex++){var parsedAnimation=parsedCamera.animations[animationIndex];var internalClass=GetClass("BABYLON.Animation");if(internalClass){camera.animations.push(internalClass.Parse(parsedAnimation));}}Node.ParseAnimationRanges(camera,parsedCamera,scene2);}if(parsedCamera.autoAnimate){scene2.beginAnimation(camera,parsedCamera.autoAnimateFrom,parsedCamera.autoAnimateTo,parsedCamera.autoAnimateLoop,parsedCamera.autoAnimateSpeed||1);}if(parsedCamera.isEnabled!==void 0){camera.setEnabled(parsedCamera.isEnabled);}return camera;}}]);return Camera;}(Node);Camera._CreateDefaultParsedCamera=function(name135,scene2){throw _WarnImport("UniversalCamera");};Camera.PERSPECTIVE_CAMERA=0;Camera.ORTHOGRAPHIC_CAMERA=1;Camera.FOVMODE_VERTICAL_FIXED=0;Camera.FOVMODE_HORIZONTAL_FIXED=1;Camera.RIG_MODE_NONE=0;Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10;Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11;Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12;Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER=13;Camera.RIG_MODE_STEREOSCOPIC_INTERLACED=14;Camera.RIG_MODE_VR=20;Camera.RIG_MODE_WEBVR=21;Camera.RIG_MODE_CUSTOM=22;Camera.ForceAttachControlToAlwaysPreventDefault=false;__decorate([serializeAsVector3("position")],Camera.prototype,"_position",void 0);__decorate([serializeAsVector3("upVector")],Camera.prototype,"_upVector",void 0);__decorate([serialize()],Camera.prototype,"orthoLeft",null);__decorate([serialize()],Camera.prototype,"orthoRight",null);__decorate([serialize()],Camera.prototype,"orthoBottom",null);__decorate([serialize()],Camera.prototype,"orthoTop",null);__decorate([serialize()],Camera.prototype,"fov",void 0);__decorate([serialize()],Camera.prototype,"projectionPlaneTilt",void 0);__decorate([serialize()],Camera.prototype,"minZ",void 0);__decorate([serialize()],Camera.prototype,"maxZ",void 0);__decorate([serialize()],Camera.prototype,"inertia",void 0);__decorate([serialize()],Camera.prototype,"mode",null);__decorate([serialize()],Camera.prototype,"layerMask",void 0);__decorate([serialize()],Camera.prototype,"fovMode",void 0);__decorate([serialize()],Camera.prototype,"cameraRigMode",void 0);__decorate([serialize()],Camera.prototype,"interaxialDistance",void 0);__decorate([serialize()],Camera.prototype,"isStereoscopicSideBySide",void 0);// node_modules/@babylonjs/core/Meshes/mesh.vertexData.js
var VertexData=/*#__PURE__*/function(){function VertexData(){_classCallCheck(this,VertexData);this._applyTo=makeSyncFunction(this._applyToCoroutine.bind(this));}_createClass(VertexData,[{key:"set",value:function set(data,kind){if(!data.length){Logger.Warn("Setting vertex data kind '".concat(kind,"' with an empty array"));}switch(kind){case VertexBuffer.PositionKind:this.positions=data;break;case VertexBuffer.NormalKind:this.normals=data;break;case VertexBuffer.TangentKind:this.tangents=data;break;case VertexBuffer.UVKind:this.uvs=data;break;case VertexBuffer.UV2Kind:this.uvs2=data;break;case VertexBuffer.UV3Kind:this.uvs3=data;break;case VertexBuffer.UV4Kind:this.uvs4=data;break;case VertexBuffer.UV5Kind:this.uvs5=data;break;case VertexBuffer.UV6Kind:this.uvs6=data;break;case VertexBuffer.ColorKind:this.colors=data;break;case VertexBuffer.MatricesIndicesKind:this.matricesIndices=data;break;case VertexBuffer.MatricesWeightsKind:this.matricesWeights=data;break;case VertexBuffer.MatricesIndicesExtraKind:this.matricesIndicesExtra=data;break;case VertexBuffer.MatricesWeightsExtraKind:this.matricesWeightsExtra=data;break;}}},{key:"applyToMesh",value:function applyToMesh(mesh,updatable){this._applyTo(mesh,updatable,false);return this;}},{key:"applyToGeometry",value:function applyToGeometry(geometry,updatable){this._applyTo(geometry,updatable,false);return this;}},{key:"updateMesh",value:function updateMesh(mesh){this._update(mesh);return this;}},{key:"updateGeometry",value:function updateGeometry(geometry){this._update(geometry);return this;}},{key:"_applyToCoroutine",value:function _applyToCoroutine(meshOrGeometry){var _this72=this;var updatable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var isAsync=arguments.length>2?arguments[2]:undefined;return/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(!_this72.positions){_context3.next=5;break;}meshOrGeometry.setVerticesData(VertexBuffer.PositionKind,_this72.positions,updatable);if(!isAsync){_context3.next=5;break;}_context3.next=5;return;case 5:if(!_this72.normals){_context3.next=10;break;}meshOrGeometry.setVerticesData(VertexBuffer.NormalKind,_this72.normals,updatable);if(!isAsync){_context3.next=10;break;}_context3.next=10;return;case 10:if(!_this72.tangents){_context3.next=15;break;}meshOrGeometry.setVerticesData(VertexBuffer.TangentKind,_this72.tangents,updatable);if(!isAsync){_context3.next=15;break;}_context3.next=15;return;case 15:if(!_this72.uvs){_context3.next=20;break;}meshOrGeometry.setVerticesData(VertexBuffer.UVKind,_this72.uvs,updatable);if(!isAsync){_context3.next=20;break;}_context3.next=20;return;case 20:if(!_this72.uvs2){_context3.next=25;break;}meshOrGeometry.setVerticesData(VertexBuffer.UV2Kind,_this72.uvs2,updatable);if(!isAsync){_context3.next=25;break;}_context3.next=25;return;case 25:if(!_this72.uvs3){_context3.next=30;break;}meshOrGeometry.setVerticesData(VertexBuffer.UV3Kind,_this72.uvs3,updatable);if(!isAsync){_context3.next=30;break;}_context3.next=30;return;case 30:if(!_this72.uvs4){_context3.next=35;break;}meshOrGeometry.setVerticesData(VertexBuffer.UV4Kind,_this72.uvs4,updatable);if(!isAsync){_context3.next=35;break;}_context3.next=35;return;case 35:if(!_this72.uvs5){_context3.next=40;break;}meshOrGeometry.setVerticesData(VertexBuffer.UV5Kind,_this72.uvs5,updatable);if(!isAsync){_context3.next=40;break;}_context3.next=40;return;case 40:if(!_this72.uvs6){_context3.next=45;break;}meshOrGeometry.setVerticesData(VertexBuffer.UV6Kind,_this72.uvs6,updatable);if(!isAsync){_context3.next=45;break;}_context3.next=45;return;case 45:if(!_this72.colors){_context3.next=50;break;}meshOrGeometry.setVerticesData(VertexBuffer.ColorKind,_this72.colors,updatable);if(!isAsync){_context3.next=50;break;}_context3.next=50;return;case 50:if(!_this72.matricesIndices){_context3.next=55;break;}meshOrGeometry.setVerticesData(VertexBuffer.MatricesIndicesKind,_this72.matricesIndices,updatable);if(!isAsync){_context3.next=55;break;}_context3.next=55;return;case 55:if(!_this72.matricesWeights){_context3.next=60;break;}meshOrGeometry.setVerticesData(VertexBuffer.MatricesWeightsKind,_this72.matricesWeights,updatable);if(!isAsync){_context3.next=60;break;}_context3.next=60;return;case 60:if(!_this72.matricesIndicesExtra){_context3.next=65;break;}meshOrGeometry.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,_this72.matricesIndicesExtra,updatable);if(!isAsync){_context3.next=65;break;}_context3.next=65;return;case 65:if(!_this72.matricesWeightsExtra){_context3.next=70;break;}meshOrGeometry.setVerticesData(VertexBuffer.MatricesWeightsExtraKind,_this72.matricesWeightsExtra,updatable);if(!isAsync){_context3.next=70;break;}_context3.next=70;return;case 70:if(!_this72.indices){_context3.next=77;break;}meshOrGeometry.setIndices(_this72.indices,null,updatable);if(!isAsync){_context3.next=75;break;}_context3.next=75;return;case 75:_context3.next=78;break;case 77:meshOrGeometry.setIndices([],null);case 78:return _context3.abrupt("return",_this72);case 79:case"end":return _context3.stop();}},_callee3);})();}},{key:"_update",value:function _update(meshOrGeometry,updateExtends,makeItUnique){if(this.positions){meshOrGeometry.updateVerticesData(VertexBuffer.PositionKind,this.positions,updateExtends,makeItUnique);}if(this.normals){meshOrGeometry.updateVerticesData(VertexBuffer.NormalKind,this.normals,updateExtends,makeItUnique);}if(this.tangents){meshOrGeometry.updateVerticesData(VertexBuffer.TangentKind,this.tangents,updateExtends,makeItUnique);}if(this.uvs){meshOrGeometry.updateVerticesData(VertexBuffer.UVKind,this.uvs,updateExtends,makeItUnique);}if(this.uvs2){meshOrGeometry.updateVerticesData(VertexBuffer.UV2Kind,this.uvs2,updateExtends,makeItUnique);}if(this.uvs3){meshOrGeometry.updateVerticesData(VertexBuffer.UV3Kind,this.uvs3,updateExtends,makeItUnique);}if(this.uvs4){meshOrGeometry.updateVerticesData(VertexBuffer.UV4Kind,this.uvs4,updateExtends,makeItUnique);}if(this.uvs5){meshOrGeometry.updateVerticesData(VertexBuffer.UV5Kind,this.uvs5,updateExtends,makeItUnique);}if(this.uvs6){meshOrGeometry.updateVerticesData(VertexBuffer.UV6Kind,this.uvs6,updateExtends,makeItUnique);}if(this.colors){meshOrGeometry.updateVerticesData(VertexBuffer.ColorKind,this.colors,updateExtends,makeItUnique);}if(this.matricesIndices){meshOrGeometry.updateVerticesData(VertexBuffer.MatricesIndicesKind,this.matricesIndices,updateExtends,makeItUnique);}if(this.matricesWeights){meshOrGeometry.updateVerticesData(VertexBuffer.MatricesWeightsKind,this.matricesWeights,updateExtends,makeItUnique);}if(this.matricesIndicesExtra){meshOrGeometry.updateVerticesData(VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra,updateExtends,makeItUnique);}if(this.matricesWeightsExtra){meshOrGeometry.updateVerticesData(VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra,updateExtends,makeItUnique);}if(this.indices){meshOrGeometry.setIndices(this.indices,null);}return this;}},{key:"transform",value:function transform(matrix){var flip=matrix.determinant()<0;if(this.positions){VertexData._TransformVector3Coordinates(this.positions,matrix);}if(this.normals){VertexData._TransformVector3Normals(this.normals,matrix);}if(this.tangents){VertexData._TransformVector4Normals(this.tangents,matrix);}if(flip&&this.indices){VertexData._FlipFaces(this.indices);}return this;}},{key:"merge",value:function merge(others){var use32BitsIndices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var forceCloneIndices=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var vertexDatas=Array.isArray(others)?others.map(function(other){return[other,void 0];}):[[others,void 0]];return runCoroutineSync(this._mergeCoroutine(void 0,vertexDatas,use32BitsIndices,false,forceCloneIndices));}},{key:"_mergeCoroutine",value:function _mergeCoroutine(transform,vertexDatas){var _this73=this;var use32BitsIndices=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var isAsync=arguments.length>3?arguments[3]:undefined;var forceCloneIndices=arguments.length>4?arguments[4]:undefined;return/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var _a,_b,_c,_d,others,_iterator83,_step92,_other,totalIndices,sliceIndices,indices,indicesOffset,temp,positionsOffset,_iterator84,_step93,_step93$value,other,transform2,index;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:_this73._validate();others=vertexDatas.map(function(vertexData){return vertexData[0];});_iterator83=_createForOfIteratorHelper(others);_context4.prev=3;_iterator83.s();case 5:if((_step92=_iterator83.n()).done){_context4.next=12;break;}_other=_step92.value;_other._validate();if(!(!_this73.normals!==!_other.normals||!_this73.tangents!==!_other.tangents||!_this73.uvs!==!_other.uvs||!_this73.uvs2!==!_other.uvs2||!_this73.uvs3!==!_other.uvs3||!_this73.uvs4!==!_other.uvs4||!_this73.uvs5!==!_other.uvs5||!_this73.uvs6!==!_other.uvs6||!_this73.colors!==!_other.colors||!_this73.matricesIndices!==!_other.matricesIndices||!_this73.matricesWeights!==!_other.matricesWeights||!_this73.matricesIndicesExtra!==!_other.matricesIndicesExtra||!_this73.matricesWeightsExtra!==!_other.matricesWeightsExtra)){_context4.next=10;break;}throw new Error("Cannot merge vertex data that do not have the same set of attributes");case 10:_context4.next=5;break;case 12:_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4["catch"](3);_iterator83.e(_context4.t0);case 17:_context4.prev=17;_iterator83.f();return _context4.finish(17);case 20:totalIndices=others.reduce(function(indexSum,vertexData){var _a2,_b2;return indexSum+((_b2=(_a2=vertexData.indices)===null||_a2===void 0?void 0:_a2.length)!==null&&_b2!==void 0?_b2:0);},(_b=(_a=_this73.indices)===null||_a===void 0?void 0:_a.length)!==null&&_b!==void 0?_b:0);sliceIndices=forceCloneIndices||others.some(function(vertexData){return vertexData.indices===_this73.indices;});indices=sliceIndices?(_c=_this73.indices)===null||_c===void 0?void 0:_c.slice():_this73.indices;if(!(totalIndices>0)){_context4.next=51;break;}indicesOffset=(_d=indices===null||indices===void 0?void 0:indices.length)!==null&&_d!==void 0?_d:0;if(!indices){indices=new Array(totalIndices);}if(indices.length!==totalIndices){if(Array.isArray(indices)){indices.length=totalIndices;}else{temp=use32BitsIndices||indices instanceof Uint32Array?new Uint32Array(totalIndices):new Uint16Array(totalIndices);temp.set(indices);indices=temp;}if(transform&&transform.determinant()<0){VertexData._FlipFaces(indices,0,indicesOffset);}}positionsOffset=_this73.positions?_this73.positions.length/3:0;_iterator84=_createForOfIteratorHelper(vertexDatas);_context4.prev=29;_iterator84.s();case 31:if((_step93=_iterator84.n()).done){_context4.next=43;break;}_step93$value=_slicedToArray(_step93.value,2),other=_step93$value[0],transform2=_step93$value[1];if(!other.indices){_context4.next=41;break;}for(index=0;index<other.indices.length;index++){indices[indicesOffset+index]=other.indices[index]+positionsOffset;}if(transform2&&transform2.determinant()<0){VertexData._FlipFaces(indices,indicesOffset,other.indices.length);}positionsOffset+=other.positions.length/3;indicesOffset+=other.indices.length;if(!isAsync){_context4.next=41;break;}_context4.next=41;return;case 41:_context4.next=31;break;case 43:_context4.next=48;break;case 45:_context4.prev=45;_context4.t1=_context4["catch"](29);_iterator84.e(_context4.t1);case 48:_context4.prev=48;_iterator84.f();return _context4.finish(48);case 51:_this73.indices=indices;_this73.positions=VertexData._MergeElement(VertexBuffer.PositionKind,_this73.positions,transform,vertexDatas.map(function(other){return[other[0].positions,other[1]];}));if(!isAsync){_context4.next=56;break;}_context4.next=56;return;case 56:_this73.normals=VertexData._MergeElement(VertexBuffer.NormalKind,_this73.normals,transform,vertexDatas.map(function(other){return[other[0].normals,other[1]];}));if(!isAsync){_context4.next=60;break;}_context4.next=60;return;case 60:_this73.tangents=VertexData._MergeElement(VertexBuffer.TangentKind,_this73.tangents,transform,vertexDatas.map(function(other){return[other[0].tangents,other[1]];}));if(!isAsync){_context4.next=64;break;}_context4.next=64;return;case 64:_this73.uvs=VertexData._MergeElement(VertexBuffer.UVKind,_this73.uvs,transform,vertexDatas.map(function(other){return[other[0].uvs,other[1]];}));if(!isAsync){_context4.next=68;break;}_context4.next=68;return;case 68:_this73.uvs2=VertexData._MergeElement(VertexBuffer.UV2Kind,_this73.uvs2,transform,vertexDatas.map(function(other){return[other[0].uvs2,other[1]];}));if(!isAsync){_context4.next=72;break;}_context4.next=72;return;case 72:_this73.uvs3=VertexData._MergeElement(VertexBuffer.UV3Kind,_this73.uvs3,transform,vertexDatas.map(function(other){return[other[0].uvs3,other[1]];}));if(!isAsync){_context4.next=76;break;}_context4.next=76;return;case 76:_this73.uvs4=VertexData._MergeElement(VertexBuffer.UV4Kind,_this73.uvs4,transform,vertexDatas.map(function(other){return[other[0].uvs4,other[1]];}));if(!isAsync){_context4.next=80;break;}_context4.next=80;return;case 80:_this73.uvs5=VertexData._MergeElement(VertexBuffer.UV5Kind,_this73.uvs5,transform,vertexDatas.map(function(other){return[other[0].uvs5,other[1]];}));if(!isAsync){_context4.next=84;break;}_context4.next=84;return;case 84:_this73.uvs6=VertexData._MergeElement(VertexBuffer.UV6Kind,_this73.uvs6,transform,vertexDatas.map(function(other){return[other[0].uvs6,other[1]];}));if(!isAsync){_context4.next=88;break;}_context4.next=88;return;case 88:_this73.colors=VertexData._MergeElement(VertexBuffer.ColorKind,_this73.colors,transform,vertexDatas.map(function(other){return[other[0].colors,other[1]];}));if(!isAsync){_context4.next=92;break;}_context4.next=92;return;case 92:_this73.matricesIndices=VertexData._MergeElement(VertexBuffer.MatricesIndicesKind,_this73.matricesIndices,transform,vertexDatas.map(function(other){return[other[0].matricesIndices,other[1]];}));if(!isAsync){_context4.next=96;break;}_context4.next=96;return;case 96:_this73.matricesWeights=VertexData._MergeElement(VertexBuffer.MatricesWeightsKind,_this73.matricesWeights,transform,vertexDatas.map(function(other){return[other[0].matricesWeights,other[1]];}));if(!isAsync){_context4.next=100;break;}_context4.next=100;return;case 100:_this73.matricesIndicesExtra=VertexData._MergeElement(VertexBuffer.MatricesIndicesExtraKind,_this73.matricesIndicesExtra,transform,vertexDatas.map(function(other){return[other[0].matricesIndicesExtra,other[1]];}));if(!isAsync){_context4.next=104;break;}_context4.next=104;return;case 104:_this73.matricesWeightsExtra=VertexData._MergeElement(VertexBuffer.MatricesWeightsExtraKind,_this73.matricesWeightsExtra,transform,vertexDatas.map(function(other){return[other[0].matricesWeightsExtra,other[1]];}));return _context4.abrupt("return",_this73);case 106:case"end":return _context4.stop();}},_callee4,null,[[3,14,17,20],[29,45,48,51]]);})();}},{key:"_validate",value:function _validate(){if(!this.positions){throw new RuntimeError("Positions are required",ErrorCodes.MeshInvalidPositionsError);}var getElementCount=function getElementCount(kind,values){var stride=VertexBuffer.DeduceStride(kind);if(values.length%stride!==0){throw new Error("The "+kind+"s array count must be a multiple of "+stride);}return values.length/stride;};var positionsElementCount=getElementCount(VertexBuffer.PositionKind,this.positions);var validateElementCount=function validateElementCount(kind,values){var elementCount=getElementCount(kind,values);if(elementCount!==positionsElementCount){throw new Error("The "+kind+"s element count ("+elementCount+") does not match the positions count ("+positionsElementCount+")");}};if(this.normals){validateElementCount(VertexBuffer.NormalKind,this.normals);}if(this.tangents){validateElementCount(VertexBuffer.TangentKind,this.tangents);}if(this.uvs){validateElementCount(VertexBuffer.UVKind,this.uvs);}if(this.uvs2){validateElementCount(VertexBuffer.UV2Kind,this.uvs2);}if(this.uvs3){validateElementCount(VertexBuffer.UV3Kind,this.uvs3);}if(this.uvs4){validateElementCount(VertexBuffer.UV4Kind,this.uvs4);}if(this.uvs5){validateElementCount(VertexBuffer.UV5Kind,this.uvs5);}if(this.uvs6){validateElementCount(VertexBuffer.UV6Kind,this.uvs6);}if(this.colors){validateElementCount(VertexBuffer.ColorKind,this.colors);}if(this.matricesIndices){validateElementCount(VertexBuffer.MatricesIndicesKind,this.matricesIndices);}if(this.matricesWeights){validateElementCount(VertexBuffer.MatricesWeightsKind,this.matricesWeights);}if(this.matricesIndicesExtra){validateElementCount(VertexBuffer.MatricesIndicesExtraKind,this.matricesIndicesExtra);}if(this.matricesWeightsExtra){validateElementCount(VertexBuffer.MatricesWeightsExtraKind,this.matricesWeightsExtra);}}},{key:"serialize",value:function serialize(){var serializationObject={};if(this.positions){serializationObject.positions=this.positions;}if(this.normals){serializationObject.normals=this.normals;}if(this.tangents){serializationObject.tangents=this.tangents;}if(this.uvs){serializationObject.uvs=this.uvs;}if(this.uvs2){serializationObject.uvs2=this.uvs2;}if(this.uvs3){serializationObject.uvs3=this.uvs3;}if(this.uvs4){serializationObject.uvs4=this.uvs4;}if(this.uvs5){serializationObject.uvs5=this.uvs5;}if(this.uvs6){serializationObject.uvs6=this.uvs6;}if(this.colors){serializationObject.colors=this.colors;}if(this.matricesIndices){serializationObject.matricesIndices=this.matricesIndices;serializationObject.matricesIndices._isExpanded=true;}if(this.matricesWeights){serializationObject.matricesWeights=this.matricesWeights;}if(this.matricesIndicesExtra){serializationObject.matricesIndicesExtra=this.matricesIndicesExtra;serializationObject.matricesIndicesExtra._isExpanded=true;}if(this.matricesWeightsExtra){serializationObject.matricesWeightsExtra=this.matricesWeightsExtra;}serializationObject.indices=this.indices;return serializationObject;}}],[{key:"_TransformVector3Coordinates",value:function _TransformVector3Coordinates(coordinates,transformation){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var length=arguments.length>3&&arguments[3]!==undefined?arguments[3]:coordinates.length;var coordinate=TmpVectors.Vector3[0];var transformedCoordinate=TmpVectors.Vector3[1];for(var index=offset;index<offset+length;index+=3){Vector3.FromArrayToRef(coordinates,index,coordinate);Vector3.TransformCoordinatesToRef(coordinate,transformation,transformedCoordinate);coordinates[index]=transformedCoordinate.x;coordinates[index+1]=transformedCoordinate.y;coordinates[index+2]=transformedCoordinate.z;}}},{key:"_TransformVector3Normals",value:function _TransformVector3Normals(normals,transformation){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var length=arguments.length>3&&arguments[3]!==undefined?arguments[3]:normals.length;var normal=TmpVectors.Vector3[0];var transformedNormal=TmpVectors.Vector3[1];for(var index=offset;index<offset+length;index+=3){Vector3.FromArrayToRef(normals,index,normal);Vector3.TransformNormalToRef(normal,transformation,transformedNormal);normals[index]=transformedNormal.x;normals[index+1]=transformedNormal.y;normals[index+2]=transformedNormal.z;}}},{key:"_TransformVector4Normals",value:function _TransformVector4Normals(normals,transformation){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var length=arguments.length>3&&arguments[3]!==undefined?arguments[3]:normals.length;var normal=TmpVectors.Vector4[0];var transformedNormal=TmpVectors.Vector4[1];for(var index=offset;index<offset+length;index+=4){Vector4.FromArrayToRef(normals,index,normal);Vector4.TransformNormalToRef(normal,transformation,transformedNormal);normals[index]=transformedNormal.x;normals[index+1]=transformedNormal.y;normals[index+2]=transformedNormal.z;normals[index+3]=transformedNormal.w;}}},{key:"_FlipFaces",value:function _FlipFaces(indices){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:indices.length;for(var index=offset;index<offset+length;index+=3){var tmp=indices[index+1];indices[index+1]=indices[index+2];indices[index+2]=tmp;}}},{key:"_MergeElement",value:function _MergeElement(kind,source,transform,others){var nonNullOthers=others.filter(function(other){return other[0]!==null&&other[0]!==void 0;});if(!source&&nonNullOthers.length==0){return source;}if(!source){return this._MergeElement(kind,nonNullOthers[0][0],nonNullOthers[0][1],nonNullOthers.slice(1));}var len=nonNullOthers.reduce(function(sumLen,elements){return sumLen+elements[0].length;},source.length);var transformRange=kind===VertexBuffer.PositionKind?VertexData._TransformVector3Coordinates:kind===VertexBuffer.NormalKind?VertexData._TransformVector3Normals:kind===VertexBuffer.TangentKind?VertexData._TransformVector4Normals:function(){};if(source instanceof Float32Array){var ret32=new Float32Array(len);ret32.set(source);transform&&transformRange(ret32,transform,0,source.length);var offset=source.length;var _iterator85=_createForOfIteratorHelper(nonNullOthers),_step94;try{for(_iterator85.s();!(_step94=_iterator85.n()).done;){var _step94$value=_slicedToArray(_step94.value,2),vertexData=_step94$value[0],transform2=_step94$value[1];ret32.set(vertexData,offset);transform2&&transformRange(ret32,transform2,offset,vertexData.length);offset+=vertexData.length;}}catch(err){_iterator85.e(err);}finally{_iterator85.f();}return ret32;}else{var ret=new Array(len);for(var i=0;i<source.length;i++){ret[i]=source[i];}transform&&transformRange(ret,transform,0,source.length);var _offset2=source.length;var _iterator86=_createForOfIteratorHelper(nonNullOthers),_step95;try{for(_iterator86.s();!(_step95=_iterator86.n()).done;){var _step95$value=_slicedToArray(_step95.value,2),_vertexData=_step95$value[0],_transform=_step95$value[1];for(var _i12=0;_i12<_vertexData.length;_i12++){ret[_offset2+_i12]=_vertexData[_i12];}_transform&&transformRange(ret,_transform,_offset2,_vertexData.length);_offset2+=_vertexData.length;}}catch(err){_iterator86.e(err);}finally{_iterator86.f();}return ret;}}},{key:"ExtractFromMesh",value:function ExtractFromMesh(mesh,copyWhenShared,forceCopy){return VertexData._ExtractFrom(mesh,copyWhenShared,forceCopy);}},{key:"ExtractFromGeometry",value:function ExtractFromGeometry(geometry,copyWhenShared,forceCopy){return VertexData._ExtractFrom(geometry,copyWhenShared,forceCopy);}},{key:"_ExtractFrom",value:function _ExtractFrom(meshOrGeometry,copyWhenShared,forceCopy){var result=new VertexData();if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.PositionKind)){result.positions=meshOrGeometry.getVerticesData(VertexBuffer.PositionKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.NormalKind)){result.normals=meshOrGeometry.getVerticesData(VertexBuffer.NormalKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.TangentKind)){result.tangents=meshOrGeometry.getVerticesData(VertexBuffer.TangentKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.UVKind)){result.uvs=meshOrGeometry.getVerticesData(VertexBuffer.UVKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.UV2Kind)){result.uvs2=meshOrGeometry.getVerticesData(VertexBuffer.UV2Kind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.UV3Kind)){result.uvs3=meshOrGeometry.getVerticesData(VertexBuffer.UV3Kind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.UV4Kind)){result.uvs4=meshOrGeometry.getVerticesData(VertexBuffer.UV4Kind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.UV5Kind)){result.uvs5=meshOrGeometry.getVerticesData(VertexBuffer.UV5Kind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.UV6Kind)){result.uvs6=meshOrGeometry.getVerticesData(VertexBuffer.UV6Kind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.ColorKind)){result.colors=meshOrGeometry.getVerticesData(VertexBuffer.ColorKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)){result.matricesIndices=meshOrGeometry.getVerticesData(VertexBuffer.MatricesIndicesKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)){result.matricesWeights=meshOrGeometry.getVerticesData(VertexBuffer.MatricesWeightsKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.MatricesIndicesExtraKind)){result.matricesIndicesExtra=meshOrGeometry.getVerticesData(VertexBuffer.MatricesIndicesExtraKind,copyWhenShared,forceCopy);}if(meshOrGeometry.isVerticesDataPresent(VertexBuffer.MatricesWeightsExtraKind)){result.matricesWeightsExtra=meshOrGeometry.getVerticesData(VertexBuffer.MatricesWeightsExtraKind,copyWhenShared,forceCopy);}result.indices=meshOrGeometry.getIndices(copyWhenShared,forceCopy);return result;}},{key:"CreateRibbon",value:function CreateRibbon(options){throw _WarnImport("ribbonBuilder");}},{key:"CreateBox",value:function CreateBox(options){throw _WarnImport("boxBuilder");}},{key:"CreateTiledBox",value:function CreateTiledBox(options){throw _WarnImport("tiledBoxBuilder");}},{key:"CreateTiledPlane",value:function CreateTiledPlane(options){throw _WarnImport("tiledPlaneBuilder");}},{key:"CreateSphere",value:function CreateSphere(options){throw _WarnImport("sphereBuilder");}},{key:"CreateCylinder",value:function CreateCylinder(options){throw _WarnImport("cylinderBuilder");}},{key:"CreateTorus",value:function CreateTorus(options){throw _WarnImport("torusBuilder");}},{key:"CreateLineSystem",value:function CreateLineSystem(options){throw _WarnImport("linesBuilder");}},{key:"CreateDashedLines",value:function CreateDashedLines(options){throw _WarnImport("linesBuilder");}},{key:"CreateGround",value:function CreateGround(options){throw _WarnImport("groundBuilder");}},{key:"CreateTiledGround",value:function CreateTiledGround(options){throw _WarnImport("groundBuilder");}},{key:"CreateGroundFromHeightMap",value:function CreateGroundFromHeightMap(options){throw _WarnImport("groundBuilder");}},{key:"CreatePlane",value:function CreatePlane(options){throw _WarnImport("planeBuilder");}},{key:"CreateDisc",value:function CreateDisc(options){throw _WarnImport("discBuilder");}},{key:"CreatePolygon",value:function CreatePolygon(polygon,sideOrientation,fUV,fColors,frontUVs,backUVs,wrap){throw _WarnImport("polygonBuilder");}},{key:"CreateIcoSphere",value:function CreateIcoSphere(options){throw _WarnImport("icoSphereBuilder");}},{key:"CreatePolyhedron",value:function CreatePolyhedron(options){throw _WarnImport("polyhedronBuilder");}},{key:"CreateCapsule",value:function CreateCapsule(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{orientation:Vector3.Up(),subdivisions:2,tessellation:16,height:1,radius:0.25,capSubdivisions:6};throw _WarnImport("capsuleBuilder");}},{key:"CreateTorusKnot",value:function CreateTorusKnot(options){throw _WarnImport("torusKnotBuilder");}},{key:"ComputeNormals",value:function ComputeNormals(positions,indices,normals,options){var index=0;var p1p2x=0;var p1p2y=0;var p1p2z=0;var p3p2x=0;var p3p2y=0;var p3p2z=0;var faceNormalx=0;var faceNormaly=0;var faceNormalz=0;var length=0;var v1x=0;var v1y=0;var v1z=0;var v2x=0;var v2y=0;var v2z=0;var v3x=0;var v3y=0;var v3z=0;var computeFacetNormals=false;var computeFacetPositions=false;var computeFacetPartitioning=false;var computeDepthSort=false;var faceNormalSign=1;var ratio=0;var distanceTo=null;if(options){computeFacetNormals=options.facetNormals?true:false;computeFacetPositions=options.facetPositions?true:false;computeFacetPartitioning=options.facetPartitioning?true:false;faceNormalSign=options.useRightHandedSystem===true?-1:1;ratio=options.ratio||0;computeDepthSort=options.depthSort?true:false;distanceTo=options.distanceTo;if(computeDepthSort){if(distanceTo===void 0){distanceTo=Vector3.Zero();}}}var xSubRatio=0;var ySubRatio=0;var zSubRatio=0;var subSq=0;if(computeFacetPartitioning&&options&&options.bbSize){xSubRatio=options.subDiv.X*ratio/options.bbSize.x;ySubRatio=options.subDiv.Y*ratio/options.bbSize.y;zSubRatio=options.subDiv.Z*ratio/options.bbSize.z;subSq=options.subDiv.max*options.subDiv.max;options.facetPartitioning.length=0;}for(index=0;index<positions.length;index++){normals[index]=0;}var nbFaces=indices.length/3|0;for(index=0;index<nbFaces;index++){v1x=indices[index*3]*3;v1y=v1x+1;v1z=v1x+2;v2x=indices[index*3+1]*3;v2y=v2x+1;v2z=v2x+2;v3x=indices[index*3+2]*3;v3y=v3x+1;v3z=v3x+2;p1p2x=positions[v1x]-positions[v2x];p1p2y=positions[v1y]-positions[v2y];p1p2z=positions[v1z]-positions[v2z];p3p2x=positions[v3x]-positions[v2x];p3p2y=positions[v3y]-positions[v2y];p3p2z=positions[v3z]-positions[v2z];faceNormalx=faceNormalSign*(p1p2y*p3p2z-p1p2z*p3p2y);faceNormaly=faceNormalSign*(p1p2z*p3p2x-p1p2x*p3p2z);faceNormalz=faceNormalSign*(p1p2x*p3p2y-p1p2y*p3p2x);length=Math.sqrt(faceNormalx*faceNormalx+faceNormaly*faceNormaly+faceNormalz*faceNormalz);length=length===0?1:length;faceNormalx/=length;faceNormaly/=length;faceNormalz/=length;if(computeFacetNormals&&options){options.facetNormals[index].x=faceNormalx;options.facetNormals[index].y=faceNormaly;options.facetNormals[index].z=faceNormalz;}if(computeFacetPositions&&options){options.facetPositions[index].x=(positions[v1x]+positions[v2x]+positions[v3x])/3;options.facetPositions[index].y=(positions[v1y]+positions[v2y]+positions[v3y])/3;options.facetPositions[index].z=(positions[v1z]+positions[v2z]+positions[v3z])/3;}if(computeFacetPartitioning&&options){var ox=Math.floor((options.facetPositions[index].x-options.bInfo.minimum.x*ratio)*xSubRatio);var oy=Math.floor((options.facetPositions[index].y-options.bInfo.minimum.y*ratio)*ySubRatio);var oz=Math.floor((options.facetPositions[index].z-options.bInfo.minimum.z*ratio)*zSubRatio);var b1x=Math.floor((positions[v1x]-options.bInfo.minimum.x*ratio)*xSubRatio);var b1y=Math.floor((positions[v1y]-options.bInfo.minimum.y*ratio)*ySubRatio);var b1z=Math.floor((positions[v1z]-options.bInfo.minimum.z*ratio)*zSubRatio);var b2x=Math.floor((positions[v2x]-options.bInfo.minimum.x*ratio)*xSubRatio);var b2y=Math.floor((positions[v2y]-options.bInfo.minimum.y*ratio)*ySubRatio);var b2z=Math.floor((positions[v2z]-options.bInfo.minimum.z*ratio)*zSubRatio);var b3x=Math.floor((positions[v3x]-options.bInfo.minimum.x*ratio)*xSubRatio);var b3y=Math.floor((positions[v3y]-options.bInfo.minimum.y*ratio)*ySubRatio);var b3z=Math.floor((positions[v3z]-options.bInfo.minimum.z*ratio)*zSubRatio);var block_idx_v1=b1x+options.subDiv.max*b1y+subSq*b1z;var block_idx_v2=b2x+options.subDiv.max*b2y+subSq*b2z;var block_idx_v3=b3x+options.subDiv.max*b3y+subSq*b3z;var block_idx_o=ox+options.subDiv.max*oy+subSq*oz;options.facetPartitioning[block_idx_o]=options.facetPartitioning[block_idx_o]?options.facetPartitioning[block_idx_o]:new Array();options.facetPartitioning[block_idx_v1]=options.facetPartitioning[block_idx_v1]?options.facetPartitioning[block_idx_v1]:new Array();options.facetPartitioning[block_idx_v2]=options.facetPartitioning[block_idx_v2]?options.facetPartitioning[block_idx_v2]:new Array();options.facetPartitioning[block_idx_v3]=options.facetPartitioning[block_idx_v3]?options.facetPartitioning[block_idx_v3]:new Array();options.facetPartitioning[block_idx_v1].push(index);if(block_idx_v2!=block_idx_v1){options.facetPartitioning[block_idx_v2].push(index);}if(!(block_idx_v3==block_idx_v2||block_idx_v3==block_idx_v1)){options.facetPartitioning[block_idx_v3].push(index);}if(!(block_idx_o==block_idx_v1||block_idx_o==block_idx_v2||block_idx_o==block_idx_v3)){options.facetPartitioning[block_idx_o].push(index);}}if(computeDepthSort&&options&&options.facetPositions){var dsf=options.depthSortedFacets[index];dsf.ind=index*3;dsf.sqDistance=Vector3.DistanceSquared(options.facetPositions[index],distanceTo);}normals[v1x]+=faceNormalx;normals[v1y]+=faceNormaly;normals[v1z]+=faceNormalz;normals[v2x]+=faceNormalx;normals[v2y]+=faceNormaly;normals[v2z]+=faceNormalz;normals[v3x]+=faceNormalx;normals[v3y]+=faceNormaly;normals[v3z]+=faceNormalz;}for(index=0;index<normals.length/3;index++){faceNormalx=normals[index*3];faceNormaly=normals[index*3+1];faceNormalz=normals[index*3+2];length=Math.sqrt(faceNormalx*faceNormalx+faceNormaly*faceNormaly+faceNormalz*faceNormalz);length=length===0?1:length;faceNormalx/=length;faceNormaly/=length;faceNormalz/=length;normals[index*3]=faceNormalx;normals[index*3+1]=faceNormaly;normals[index*3+2]=faceNormalz;}}},{key:"_ComputeSides",value:function _ComputeSides(sideOrientation,positions,indices,normals,uvs,frontUVs,backUVs){var li=indices.length;var ln=normals.length;var i;var n;sideOrientation=sideOrientation||VertexData.DEFAULTSIDE;switch(sideOrientation){case VertexData.FRONTSIDE:break;case VertexData.BACKSIDE:for(i=0;i<li;i+=3){var tmp=indices[i];indices[i]=indices[i+2];indices[i+2]=tmp;}for(n=0;n<ln;n++){normals[n]=-normals[n];}break;case VertexData.DOUBLESIDE:{var lp=positions.length;var l=lp/3;for(var p=0;p<lp;p++){positions[lp+p]=positions[p];}for(i=0;i<li;i+=3){indices[i+li]=indices[i+2]+l;indices[i+1+li]=indices[i+1]+l;indices[i+2+li]=indices[i]+l;}for(n=0;n<ln;n++){normals[ln+n]=-normals[n];}var lu=uvs.length;var u=0;for(u=0;u<lu;u++){uvs[u+lu]=uvs[u];}frontUVs=frontUVs?frontUVs:new Vector4(0,0,1,1);backUVs=backUVs?backUVs:new Vector4(0,0,1,1);u=0;for(i=0;i<lu/2;i++){uvs[u]=frontUVs.x+(frontUVs.z-frontUVs.x)*uvs[u];uvs[u+1]=frontUVs.y+(frontUVs.w-frontUVs.y)*uvs[u+1];uvs[u+lu]=backUVs.x+(backUVs.z-backUVs.x)*uvs[u+lu];uvs[u+lu+1]=backUVs.y+(backUVs.w-backUVs.y)*uvs[u+lu+1];u+=2;}break;}}}},{key:"ImportVertexData",value:function ImportVertexData(parsedVertexData,geometry){var vertexData=new VertexData();var positions=parsedVertexData.positions;if(positions){vertexData.set(positions,VertexBuffer.PositionKind);}var normals=parsedVertexData.normals;if(normals){vertexData.set(normals,VertexBuffer.NormalKind);}var tangents=parsedVertexData.tangents;if(tangents){vertexData.set(tangents,VertexBuffer.TangentKind);}var uvs=parsedVertexData.uvs;if(uvs){vertexData.set(uvs,VertexBuffer.UVKind);}var uv2s=parsedVertexData.uv2s;if(uv2s){vertexData.set(uv2s,VertexBuffer.UV2Kind);}var uv3s=parsedVertexData.uv3s;if(uv3s){vertexData.set(uv3s,VertexBuffer.UV3Kind);}var uv4s=parsedVertexData.uv4s;if(uv4s){vertexData.set(uv4s,VertexBuffer.UV4Kind);}var uv5s=parsedVertexData.uv5s;if(uv5s){vertexData.set(uv5s,VertexBuffer.UV5Kind);}var uv6s=parsedVertexData.uv6s;if(uv6s){vertexData.set(uv6s,VertexBuffer.UV6Kind);}var colors=parsedVertexData.colors;if(colors){vertexData.set(Color4.CheckColors4(colors,positions.length/3),VertexBuffer.ColorKind);}var matricesIndices=parsedVertexData.matricesIndices;if(matricesIndices){vertexData.set(matricesIndices,VertexBuffer.MatricesIndicesKind);}var matricesWeights=parsedVertexData.matricesWeights;if(matricesWeights){vertexData.set(matricesWeights,VertexBuffer.MatricesWeightsKind);}var indices=parsedVertexData.indices;if(indices){vertexData.indices=indices;}geometry.setAllVerticesData(vertexData,parsedVertexData.updatable);}}]);return VertexData;}();VertexData.FRONTSIDE=0;VertexData.BACKSIDE=1;VertexData.DOUBLESIDE=2;VertexData.DEFAULTSIDE=0;__decorate([nativeOverride.filter(function(){for(var _len4=arguments.length,_ref8=new Array(_len4),_key4=0;_key4<_len4;_key4++){_ref8[_key4]=arguments[_key4];}var coordinates=_ref8[0];return!Array.isArray(coordinates);})],VertexData,"_TransformVector3Coordinates",null);__decorate([nativeOverride.filter(function(){for(var _len5=arguments.length,_ref9=new Array(_len5),_key5=0;_key5<_len5;_key5++){_ref9[_key5]=arguments[_key5];}var normals=_ref9[0];return!Array.isArray(normals);})],VertexData,"_TransformVector3Normals",null);__decorate([nativeOverride.filter(function(){for(var _len6=arguments.length,_ref10=new Array(_len6),_key6=0;_key6<_len6;_key6++){_ref10[_key6]=arguments[_key6];}var normals=_ref10[0];return!Array.isArray(normals);})],VertexData,"_TransformVector4Normals",null);__decorate([nativeOverride.filter(function(){for(var _len7=arguments.length,_ref11=new Array(_len7),_key7=0;_key7<_len7;_key7++){_ref11[_key7]=arguments[_key7];}var indices=_ref11[0];return!Array.isArray(indices);})],VertexData,"_FlipFaces",null);// node_modules/@babylonjs/core/Collisions/intersectionInfo.js
var IntersectionInfo=/*#__PURE__*/_createClass(function IntersectionInfo(bu,bv,distance){_classCallCheck(this,IntersectionInfo);this.bu=bu;this.bv=bv;this.distance=distance;this.faceId=0;this.subMeshId=0;});// node_modules/@babylonjs/core/Culling/boundingBox.js
var BoundingBox=/*#__PURE__*/function(){function BoundingBox(min,max,worldMatrix){_classCallCheck(this,BoundingBox);this.vectors=ArrayTools.BuildArray(8,Vector3.Zero);this.center=Vector3.Zero();this.centerWorld=Vector3.Zero();this.extendSize=Vector3.Zero();this.extendSizeWorld=Vector3.Zero();this.directions=ArrayTools.BuildArray(3,Vector3.Zero);this.vectorsWorld=ArrayTools.BuildArray(8,Vector3.Zero);this.minimumWorld=Vector3.Zero();this.maximumWorld=Vector3.Zero();this.minimum=Vector3.Zero();this.maximum=Vector3.Zero();this._drawWrapperFront=null;this._drawWrapperBack=null;this.reConstruct(min,max,worldMatrix);}_createClass(BoundingBox,[{key:"reConstruct",value:function reConstruct(min,max,worldMatrix){var minX=min.x,minY=min.y,minZ=min.z,maxX=max.x,maxY=max.y,maxZ=max.z;var vectors=this.vectors;this.minimum.copyFromFloats(minX,minY,minZ);this.maximum.copyFromFloats(maxX,maxY,maxZ);vectors[0].copyFromFloats(minX,minY,minZ);vectors[1].copyFromFloats(maxX,maxY,maxZ);vectors[2].copyFromFloats(maxX,minY,minZ);vectors[3].copyFromFloats(minX,maxY,minZ);vectors[4].copyFromFloats(minX,minY,maxZ);vectors[5].copyFromFloats(maxX,maxY,minZ);vectors[6].copyFromFloats(minX,maxY,maxZ);vectors[7].copyFromFloats(maxX,minY,maxZ);max.addToRef(min,this.center).scaleInPlace(0.5);max.subtractToRef(min,this.extendSize).scaleInPlace(0.5);this._worldMatrix=worldMatrix||Matrix.IdentityReadOnly;this._update(this._worldMatrix);}},{key:"scale",value:function scale(factor){var tmpVectors=BoundingBox._TmpVector3;var diff=this.maximum.subtractToRef(this.minimum,tmpVectors[0]);var len=diff.length();diff.normalizeFromLength(len);var distance=len*factor;var newRadius=diff.scaleInPlace(distance*0.5);var min=this.center.subtractToRef(newRadius,tmpVectors[1]);var max=this.center.addToRef(newRadius,tmpVectors[2]);this.reConstruct(min,max,this._worldMatrix);return this;}},{key:"getWorldMatrix",value:function getWorldMatrix(){return this._worldMatrix;}},{key:"_update",value:function _update(world){var minWorld=this.minimumWorld;var maxWorld=this.maximumWorld;var directions=this.directions;var vectorsWorld=this.vectorsWorld;var vectors=this.vectors;if(!world.isIdentity()){minWorld.setAll(Number.MAX_VALUE);maxWorld.setAll(-Number.MAX_VALUE);for(var index=0;index<8;++index){var v=vectorsWorld[index];Vector3.TransformCoordinatesToRef(vectors[index],world,v);minWorld.minimizeInPlace(v);maxWorld.maximizeInPlace(v);}maxWorld.subtractToRef(minWorld,this.extendSizeWorld).scaleInPlace(0.5);maxWorld.addToRef(minWorld,this.centerWorld).scaleInPlace(0.5);}else{minWorld.copyFrom(this.minimum);maxWorld.copyFrom(this.maximum);for(var _index9=0;_index9<8;++_index9){vectorsWorld[_index9].copyFrom(vectors[_index9]);}this.extendSizeWorld.copyFrom(this.extendSize);this.centerWorld.copyFrom(this.center);}Vector3.FromArrayToRef(world.m,0,directions[0]);Vector3.FromArrayToRef(world.m,4,directions[1]);Vector3.FromArrayToRef(world.m,8,directions[2]);this._worldMatrix=world;}},{key:"isInFrustum",value:function isInFrustum(frustumPlanes){return BoundingBox.IsInFrustum(this.vectorsWorld,frustumPlanes);}},{key:"isCompletelyInFrustum",value:function isCompletelyInFrustum(frustumPlanes){return BoundingBox.IsCompletelyInFrustum(this.vectorsWorld,frustumPlanes);}},{key:"intersectsPoint",value:function intersectsPoint(point){var min=this.minimumWorld;var max=this.maximumWorld;var minX=min.x,minY=min.y,minZ=min.z,maxX=max.x,maxY=max.y,maxZ=max.z;var pointX=point.x,pointY=point.y,pointZ=point.z;var delta=-Epsilon;if(maxX-pointX<delta||delta>pointX-minX){return false;}if(maxY-pointY<delta||delta>pointY-minY){return false;}if(maxZ-pointZ<delta||delta>pointZ-minZ){return false;}return true;}},{key:"intersectsSphere",value:function intersectsSphere(sphere){return BoundingBox.IntersectsSphere(this.minimumWorld,this.maximumWorld,sphere.centerWorld,sphere.radiusWorld);}},{key:"intersectsMinMax",value:function intersectsMinMax(min,max){var myMin=this.minimumWorld;var myMax=this.maximumWorld;var myMinX=myMin.x,myMinY=myMin.y,myMinZ=myMin.z,myMaxX=myMax.x,myMaxY=myMax.y,myMaxZ=myMax.z;var minX=min.x,minY=min.y,minZ=min.z,maxX=max.x,maxY=max.y,maxZ=max.z;if(myMaxX<minX||myMinX>maxX){return false;}if(myMaxY<minY||myMinY>maxY){return false;}if(myMaxZ<minZ||myMinZ>maxZ){return false;}return true;}},{key:"dispose",value:function dispose(){var _a,_b;(_a=this._drawWrapperFront)===null||_a===void 0?void 0:_a.dispose();(_b=this._drawWrapperBack)===null||_b===void 0?void 0:_b.dispose();}}],[{key:"Intersects",value:function Intersects(box0,box1){return box0.intersectsMinMax(box1.minimumWorld,box1.maximumWorld);}},{key:"IntersectsSphere",value:function IntersectsSphere(minPoint,maxPoint,sphereCenter,sphereRadius){var vector=BoundingBox._TmpVector3[0];Vector3.ClampToRef(sphereCenter,minPoint,maxPoint,vector);var num=Vector3.DistanceSquared(sphereCenter,vector);return num<=sphereRadius*sphereRadius;}},{key:"IsCompletelyInFrustum",value:function IsCompletelyInFrustum(boundingVectors,frustumPlanes){for(var p=0;p<6;++p){var frustumPlane=frustumPlanes[p];for(var i=0;i<8;++i){if(frustumPlane.dotCoordinate(boundingVectors[i])<0){return false;}}}return true;}},{key:"IsInFrustum",value:function IsInFrustum(boundingVectors,frustumPlanes){for(var p=0;p<6;++p){var canReturnFalse=true;var frustumPlane=frustumPlanes[p];for(var i=0;i<8;++i){if(frustumPlane.dotCoordinate(boundingVectors[i])>=0){canReturnFalse=false;break;}}if(canReturnFalse){return false;}}return true;}}]);return BoundingBox;}();BoundingBox._TmpVector3=ArrayTools.BuildArray(3,Vector3.Zero);// node_modules/@babylonjs/core/Culling/boundingSphere.js
var BoundingSphere=/*#__PURE__*/function(){function BoundingSphere(min,max,worldMatrix){_classCallCheck(this,BoundingSphere);this.center=Vector3.Zero();this.centerWorld=Vector3.Zero();this.minimum=Vector3.Zero();this.maximum=Vector3.Zero();this.reConstruct(min,max,worldMatrix);}_createClass(BoundingSphere,[{key:"reConstruct",value:function reConstruct(min,max,worldMatrix){this.minimum.copyFrom(min);this.maximum.copyFrom(max);var distance=Vector3.Distance(min,max);max.addToRef(min,this.center).scaleInPlace(0.5);this.radius=distance*0.5;this._update(worldMatrix||Matrix.IdentityReadOnly);}},{key:"scale",value:function scale(factor){var newRadius=this.radius*factor;var tmpVectors=BoundingSphere._TmpVector3;var tempRadiusVector=tmpVectors[0].setAll(newRadius);var min=this.center.subtractToRef(tempRadiusVector,tmpVectors[1]);var max=this.center.addToRef(tempRadiusVector,tmpVectors[2]);this.reConstruct(min,max,this._worldMatrix);return this;}},{key:"getWorldMatrix",value:function getWorldMatrix(){return this._worldMatrix;}},{key:"_update",value:function _update(worldMatrix){if(!worldMatrix.isIdentity()){Vector3.TransformCoordinatesToRef(this.center,worldMatrix,this.centerWorld);var tempVector=BoundingSphere._TmpVector3[0];Vector3.TransformNormalFromFloatsToRef(1,1,1,worldMatrix,tempVector);this.radiusWorld=Math.max(Math.abs(tempVector.x),Math.abs(tempVector.y),Math.abs(tempVector.z))*this.radius;}else{this.centerWorld.copyFrom(this.center);this.radiusWorld=this.radius;}}},{key:"isInFrustum",value:function isInFrustum(frustumPlanes){var center=this.centerWorld;var radius=this.radiusWorld;for(var i=0;i<6;i++){if(frustumPlanes[i].dotCoordinate(center)<=-radius){return false;}}return true;}},{key:"isCenterInFrustum",value:function isCenterInFrustum(frustumPlanes){var center=this.centerWorld;for(var i=0;i<6;i++){if(frustumPlanes[i].dotCoordinate(center)<0){return false;}}return true;}},{key:"intersectsPoint",value:function intersectsPoint(point){var squareDistance=Vector3.DistanceSquared(this.centerWorld,point);if(this.radiusWorld*this.radiusWorld<squareDistance){return false;}return true;}}],[{key:"Intersects",value:function Intersects(sphere0,sphere1){var squareDistance=Vector3.DistanceSquared(sphere0.centerWorld,sphere1.centerWorld);var radiusSum=sphere0.radiusWorld+sphere1.radiusWorld;if(radiusSum*radiusSum<squareDistance){return false;}return true;}},{key:"CreateFromCenterAndRadius",value:function CreateFromCenterAndRadius(center,radius,matrix){this._TmpVector3[0].copyFrom(center);this._TmpVector3[1].copyFromFloats(0,0,radius);this._TmpVector3[2].copyFrom(center);this._TmpVector3[0].addInPlace(this._TmpVector3[1]);this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var sphere=new BoundingSphere(this._TmpVector3[0],this._TmpVector3[2]);if(matrix){sphere._worldMatrix=matrix;}else{sphere._worldMatrix=Matrix.Identity();}return sphere;}}]);return BoundingSphere;}();BoundingSphere._TmpVector3=ArrayTools.BuildArray(3,Vector3.Zero);// node_modules/@babylonjs/core/Culling/boundingInfo.js
var _result0={min:0,max:0};var _result1={min:0,max:0};var computeBoxExtents=function computeBoxExtents(axis,box,result){var p=Vector3.Dot(box.centerWorld,axis);var r0=Math.abs(Vector3.Dot(box.directions[0],axis))*box.extendSize.x;var r1=Math.abs(Vector3.Dot(box.directions[1],axis))*box.extendSize.y;var r2=Math.abs(Vector3.Dot(box.directions[2],axis))*box.extendSize.z;var r=r0+r1+r2;result.min=p-r;result.max=p+r;};var axisOverlap=function axisOverlap(axis,box0,box1){computeBoxExtents(axis,box0,_result0);computeBoxExtents(axis,box1,_result1);return!(_result0.min>_result1.max||_result1.min>_result0.max);};var BoundingInfo=/*#__PURE__*/function(){function BoundingInfo(minimum,maximum,worldMatrix){_classCallCheck(this,BoundingInfo);this._isLocked=false;this.boundingBox=new BoundingBox(minimum,maximum,worldMatrix);this.boundingSphere=new BoundingSphere(minimum,maximum,worldMatrix);}_createClass(BoundingInfo,[{key:"reConstruct",value:function reConstruct(min,max,worldMatrix){this.boundingBox.reConstruct(min,max,worldMatrix);this.boundingSphere.reConstruct(min,max,worldMatrix);}},{key:"minimum",get:function get(){return this.boundingBox.minimum;}},{key:"maximum",get:function get(){return this.boundingBox.maximum;}},{key:"isLocked",get:function get(){return this._isLocked;},set:function set(value){this._isLocked=value;}},{key:"update",value:function update(world){if(this._isLocked){return;}this.boundingBox._update(world);this.boundingSphere._update(world);}},{key:"centerOn",value:function centerOn(center,extend){var minimum=BoundingInfo._TmpVector3[0].copyFrom(center).subtractInPlace(extend);var maximum=BoundingInfo._TmpVector3[1].copyFrom(center).addInPlace(extend);this.boundingBox.reConstruct(minimum,maximum,this.boundingBox.getWorldMatrix());this.boundingSphere.reConstruct(minimum,maximum,this.boundingBox.getWorldMatrix());return this;}},{key:"encapsulate",value:function encapsulate(point){var minimum=Vector3.Minimize(this.minimum,point);var maximum=Vector3.Maximize(this.maximum,point);this.reConstruct(minimum,maximum,this.boundingBox.getWorldMatrix());return this;}},{key:"encapsulateBoundingInfo",value:function encapsulateBoundingInfo(toEncapsulate){this.encapsulate(toEncapsulate.boundingBox.centerWorld.subtract(toEncapsulate.boundingBox.extendSizeWorld));this.encapsulate(toEncapsulate.boundingBox.centerWorld.add(toEncapsulate.boundingBox.extendSizeWorld));return this;}},{key:"scale",value:function scale(factor){this.boundingBox.scale(factor);this.boundingSphere.scale(factor);return this;}},{key:"isInFrustum",value:function isInFrustum(frustumPlanes){var strategy=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var inclusionTest=strategy===2||strategy===3;if(inclusionTest){if(this.boundingSphere.isCenterInFrustum(frustumPlanes)){return true;}}if(!this.boundingSphere.isInFrustum(frustumPlanes)){return false;}var bSphereOnlyTest=strategy===1||strategy===3;if(bSphereOnlyTest){return true;}return this.boundingBox.isInFrustum(frustumPlanes);}},{key:"diagonalLength",get:function get(){var boundingBox=this.boundingBox;var diag=boundingBox.maximumWorld.subtractToRef(boundingBox.minimumWorld,BoundingInfo._TmpVector3[0]);return diag.length();}},{key:"isCompletelyInFrustum",value:function isCompletelyInFrustum(frustumPlanes){return this.boundingBox.isCompletelyInFrustum(frustumPlanes);}},{key:"_checkCollision",value:function _checkCollision(collider){return collider._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld);}},{key:"intersectsPoint",value:function intersectsPoint(point){if(!this.boundingSphere.centerWorld){return false;}if(!this.boundingSphere.intersectsPoint(point)){return false;}if(!this.boundingBox.intersectsPoint(point)){return false;}return true;}},{key:"intersects",value:function intersects(boundingInfo,precise){if(!BoundingSphere.Intersects(this.boundingSphere,boundingInfo.boundingSphere)){return false;}if(!BoundingBox.Intersects(this.boundingBox,boundingInfo.boundingBox)){return false;}if(!precise){return true;}var box0=this.boundingBox;var box1=boundingInfo.boundingBox;if(!axisOverlap(box0.directions[0],box0,box1)){return false;}if(!axisOverlap(box0.directions[1],box0,box1)){return false;}if(!axisOverlap(box0.directions[2],box0,box1)){return false;}if(!axisOverlap(box1.directions[0],box0,box1)){return false;}if(!axisOverlap(box1.directions[1],box0,box1)){return false;}if(!axisOverlap(box1.directions[2],box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[0],box1.directions[0]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[0],box1.directions[1]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[0],box1.directions[2]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[1],box1.directions[0]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[1],box1.directions[1]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[1],box1.directions[2]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[2],box1.directions[0]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[2],box1.directions[1]),box0,box1)){return false;}if(!axisOverlap(Vector3.Cross(box0.directions[2],box1.directions[2]),box0,box1)){return false;}return true;}}]);return BoundingInfo;}();BoundingInfo._TmpVector3=ArrayTools.BuildArray(2,Vector3.Zero);// node_modules/@babylonjs/core/Maths/math.functions.js
var MathHelpers=/*#__PURE__*/function(){function MathHelpers(){_classCallCheck(this,MathHelpers);}_createClass(MathHelpers,null,[{key:"extractMinAndMaxIndexed",value:function extractMinAndMaxIndexed(positions,indices,indexStart,indexCount,minimum,maximum){for(var index=indexStart;index<indexStart+indexCount;index++){var offset=indices[index]*3;var x=positions[offset];var y=positions[offset+1];var z=positions[offset+2];minimum.minimizeInPlaceFromFloats(x,y,z);maximum.maximizeInPlaceFromFloats(x,y,z);}}},{key:"extractMinAndMax",value:function extractMinAndMax(positions,start,count,stride,minimum,maximum){for(var index=start,offset=start*stride;index<start+count;index++,offset+=stride){var x=positions[offset];var y=positions[offset+1];var z=positions[offset+2];minimum.minimizeInPlaceFromFloats(x,y,z);maximum.maximizeInPlaceFromFloats(x,y,z);}}}]);return MathHelpers;}();__decorate([nativeOverride.filter(function(){for(var _len8=arguments.length,_ref12=new Array(_len8),_key8=0;_key8<_len8;_key8++){_ref12[_key8]=arguments[_key8];}var positions=_ref12[0],indices=_ref12[1];return!Array.isArray(positions)&&!Array.isArray(indices);})],MathHelpers,"extractMinAndMaxIndexed",null);__decorate([nativeOverride.filter(function(){for(var _len9=arguments.length,_ref13=new Array(_len9),_key9=0;_key9<_len9;_key9++){_ref13[_key9]=arguments[_key9];}var positions=_ref13[0];return!Array.isArray(positions);})],MathHelpers,"extractMinAndMax",null);function extractMinAndMaxIndexed(positions,indices,indexStart,indexCount){var bias=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var minimum=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);var maximum=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);MathHelpers.extractMinAndMaxIndexed(positions,indices,indexStart,indexCount,minimum,maximum);if(bias){minimum.x-=minimum.x*bias.x+bias.y;minimum.y-=minimum.y*bias.x+bias.y;minimum.z-=minimum.z*bias.x+bias.y;maximum.x+=maximum.x*bias.x+bias.y;maximum.y+=maximum.y*bias.x+bias.y;maximum.z+=maximum.z*bias.x+bias.y;}return{minimum:minimum,maximum:maximum};}function extractMinAndMax(positions,start,count){var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var stride=arguments.length>4?arguments[4]:undefined;var minimum=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);var maximum=new Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(!stride){stride=3;}MathHelpers.extractMinAndMax(positions,start,count,stride,minimum,maximum);if(bias){minimum.x-=minimum.x*bias.x+bias.y;minimum.y-=minimum.y*bias.x+bias.y;minimum.z-=minimum.z*bias.x+bias.y;maximum.x+=maximum.x*bias.x+bias.y;maximum.y+=maximum.y*bias.x+bias.y;maximum.z+=maximum.z*bias.x+bias.y;}return{minimum:minimum,maximum:maximum};}// node_modules/@babylonjs/core/Meshes/subMesh.js
var SubMesh=/*#__PURE__*/function(){function SubMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh,renderingMesh){var createBoundingBox=arguments.length>7&&arguments[7]!==undefined?arguments[7]:true;var addToMesh=arguments.length>8&&arguments[8]!==undefined?arguments[8]:true;_classCallCheck(this,SubMesh);this.materialIndex=materialIndex;this.verticesStart=verticesStart;this.verticesCount=verticesCount;this.indexStart=indexStart;this.indexCount=indexCount;this._mainDrawWrapperOverride=null;this._linesIndexCount=0;this._linesIndexBuffer=null;this._lastColliderWorldVertices=null;this._lastColliderTransformMatrix=null;this._wasDispatched=false;this._renderId=0;this._alphaIndex=0;this._distanceToCamera=0;this._currentMaterial=null;this._mesh=mesh;this._renderingMesh=renderingMesh||mesh;if(addToMesh){mesh.subMeshes.push(this);}this._engine=this._mesh.getScene().getEngine();this.resetDrawCache();this._trianglePlanes=[];this._id=mesh.subMeshes.length-1;if(createBoundingBox){this.refreshBoundingInfo();mesh.computeWorldMatrix(true);}}_createClass(SubMesh,[{key:"materialDefines",get:function get(){var _a;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:(_a=this._getDrawWrapper())===null||_a===void 0?void 0:_a.defines;},set:function set(defines){var _a;var drawWrapper=(_a=this._mainDrawWrapperOverride)!==null&&_a!==void 0?_a:this._getDrawWrapper(void 0,true);drawWrapper.defines=defines;}},{key:"_getDrawWrapper",value:function _getDrawWrapper(passId){var createIfNotExisting=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;passId=passId!==null&&passId!==void 0?passId:this._engine.currentRenderPassId;var drawWrapper=this._drawWrappers[passId];if(!drawWrapper&&createIfNotExisting){this._drawWrappers[passId]=drawWrapper=new DrawWrapper(this._mesh.getScene().getEngine());}return drawWrapper;}},{key:"_removeDrawWrapper",value:function _removeDrawWrapper(passId){var disposeWrapper=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var _a;if(disposeWrapper){(_a=this._drawWrappers[passId])===null||_a===void 0?void 0:_a.dispose();}this._drawWrappers[passId]=void 0;}},{key:"effect",get:function get(){var _a,_b;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(_b=(_a=this._getDrawWrapper())===null||_a===void 0?void 0:_a.effect)!==null&&_b!==void 0?_b:null;}},{key:"_drawWrapper",get:function get(){var _a;return(_a=this._mainDrawWrapperOverride)!==null&&_a!==void 0?_a:this._getDrawWrapper(void 0,true);}},{key:"_drawWrapperOverride",get:function get(){return this._mainDrawWrapperOverride;}},{key:"_setMainDrawWrapperOverride",value:function _setMainDrawWrapperOverride(wrapper){this._mainDrawWrapperOverride=wrapper;}},{key:"setEffect",value:function setEffect(effect){var defines=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var materialContext=arguments.length>2?arguments[2]:undefined;var resetContext=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var drawWrapper=this._drawWrapper;drawWrapper.setEffect(effect,defines,resetContext);if(materialContext!==void 0){drawWrapper.materialContext=materialContext;}if(!effect){drawWrapper.defines=null;drawWrapper.materialContext=void 0;}}},{key:"resetDrawCache",value:function resetDrawCache(passId){if(this._drawWrappers){if(passId!==void 0){this._removeDrawWrapper(passId);return;}else{var _iterator87=_createForOfIteratorHelper(this._drawWrappers),_step96;try{for(_iterator87.s();!(_step96=_iterator87.n()).done;){var drawWrapper=_step96.value;drawWrapper===null||drawWrapper===void 0?void 0:drawWrapper.dispose();}}catch(err){_iterator87.e(err);}finally{_iterator87.f();}}}this._drawWrappers=[];}},{key:"IsGlobal",get:function get(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()&&this.indexStart===0&&this.indexCount===this._mesh.getTotalIndices();}},{key:"getBoundingInfo",value:function getBoundingInfo(){if(this.IsGlobal){return this._mesh.getBoundingInfo();}return this._boundingInfo;}},{key:"setBoundingInfo",value:function setBoundingInfo(boundingInfo){this._boundingInfo=boundingInfo;return this;}},{key:"getMesh",value:function getMesh(){return this._mesh;}},{key:"getRenderingMesh",value:function getRenderingMesh(){return this._renderingMesh;}},{key:"getReplacementMesh",value:function getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;}},{key:"getEffectiveMesh",value:function getEffectiveMesh(){var replacementMesh=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return replacementMesh?replacementMesh:this._renderingMesh;}},{key:"getMaterial",value:function getMaterial(){var getDefaultMaterial=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var _a;var rootMaterial=(_a=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))!==null&&_a!==void 0?_a:this._renderingMesh.material;if(!rootMaterial){return getDefaultMaterial?this._mesh.getScene().defaultMaterial:null;}else if(this._isMultiMaterial(rootMaterial)){var effectiveMaterial=rootMaterial.getSubMaterial(this.materialIndex);if(this._currentMaterial!==effectiveMaterial){this._currentMaterial=effectiveMaterial;this.resetDrawCache();}return effectiveMaterial;}return rootMaterial;}},{key:"_isMultiMaterial",value:function _isMultiMaterial(material){return material.getSubMaterial!==void 0;}},{key:"refreshBoundingInfo",value:function refreshBoundingInfo(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this._lastColliderWorldVertices=null;if(this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry){return this;}if(!data){data=this._renderingMesh.getVerticesData(VertexBuffer.PositionKind);}if(!data){this._boundingInfo=this._mesh.getBoundingInfo();return this;}var indices=this._renderingMesh.getIndices();var extend;if(this.indexStart===0&&this.indexCount===indices.length){var boundingInfo=this._renderingMesh.getBoundingInfo();extend={minimum:boundingInfo.minimum.clone(),maximum:boundingInfo.maximum.clone()};}else{extend=extractMinAndMaxIndexed(data,indices,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);}if(this._boundingInfo){this._boundingInfo.reConstruct(extend.minimum,extend.maximum);}else{this._boundingInfo=new BoundingInfo(extend.minimum,extend.maximum);}return this;}},{key:"_checkCollision",value:function _checkCollision(collider){var boundingInfo=this.getBoundingInfo();return boundingInfo._checkCollision(collider);}},{key:"updateBoundingInfo",value:function updateBoundingInfo(world){var boundingInfo=this.getBoundingInfo();if(!boundingInfo){this.refreshBoundingInfo();boundingInfo=this.getBoundingInfo();}if(boundingInfo){boundingInfo.update(world);}return this;}},{key:"isInFrustum",value:function isInFrustum(frustumPlanes){var boundingInfo=this.getBoundingInfo();if(!boundingInfo){return false;}return boundingInfo.isInFrustum(frustumPlanes,this._mesh.cullingStrategy);}},{key:"isCompletelyInFrustum",value:function isCompletelyInFrustum(frustumPlanes){var boundingInfo=this.getBoundingInfo();if(!boundingInfo){return false;}return boundingInfo.isCompletelyInFrustum(frustumPlanes);}},{key:"render",value:function render(enableAlphaMode){this._renderingMesh.render(this,enableAlphaMode,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0);return this;}},{key:"_getLinesIndexBuffer",value:function _getLinesIndexBuffer(indices,engine){if(!this._linesIndexBuffer){var linesIndices=[];for(var index=this.indexStart;index<this.indexStart+this.indexCount;index+=3){linesIndices.push(indices[index],indices[index+1],indices[index+1],indices[index+2],indices[index+2],indices[index]);}this._linesIndexBuffer=engine.createIndexBuffer(linesIndices);this._linesIndexCount=linesIndices.length;}return this._linesIndexBuffer;}},{key:"canIntersects",value:function canIntersects(ray){var boundingInfo=this.getBoundingInfo();if(!boundingInfo){return false;}return ray.intersectsBox(boundingInfo.boundingBox);}},{key:"intersects",value:function intersects(ray,positions,indices,fastCheck,trianglePredicate){var material=this.getMaterial();if(!material){return null;}var step=3;var checkStopper=false;switch(material.fillMode){case 3:case 5:case 6:case 8:return null;case 7:step=1;checkStopper=true;break;default:break;}if(material.fillMode===4){if(!indices.length){return this._intersectUnIndexedLines(ray,positions,indices,this._mesh.intersectionThreshold,fastCheck);}return this._intersectLines(ray,positions,indices,this._mesh.intersectionThreshold,fastCheck);}else{if(!indices.length&&this._mesh._unIndexed){return this._intersectUnIndexedTriangles(ray,positions,indices,fastCheck,trianglePredicate);}return this._intersectTriangles(ray,positions,indices,step,checkStopper,fastCheck,trianglePredicate);}}},{key:"_intersectLines",value:function _intersectLines(ray,positions,indices,intersectionThreshold,fastCheck){var intersectInfo=null;for(var index=this.indexStart;index<this.indexStart+this.indexCount;index+=2){var p0=positions[indices[index]];var p1=positions[indices[index+1]];var length=ray.intersectionSegment(p0,p1,intersectionThreshold);if(length<0){continue;}if(fastCheck||!intersectInfo||length<intersectInfo.distance){intersectInfo=new IntersectionInfo(null,null,length);intersectInfo.faceId=index/2;if(fastCheck){break;}}}return intersectInfo;}},{key:"_intersectUnIndexedLines",value:function _intersectUnIndexedLines(ray,positions,indices,intersectionThreshold,fastCheck){var intersectInfo=null;for(var index=this.verticesStart;index<this.verticesStart+this.verticesCount;index+=2){var p0=positions[index];var p1=positions[index+1];var length=ray.intersectionSegment(p0,p1,intersectionThreshold);if(length<0){continue;}if(fastCheck||!intersectInfo||length<intersectInfo.distance){intersectInfo=new IntersectionInfo(null,null,length);intersectInfo.faceId=index/2;if(fastCheck){break;}}}return intersectInfo;}},{key:"_intersectTriangles",value:function _intersectTriangles(ray,positions,indices,step,checkStopper,fastCheck,trianglePredicate){var intersectInfo=null;var faceId=-1;for(var index=this.indexStart;index<this.indexStart+this.indexCount-(3-step);index+=step){faceId++;var indexA=indices[index];var indexB=indices[index+1];var indexC=indices[index+2];if(checkStopper&&indexC===4294967295){index+=2;continue;}var p0=positions[indexA];var p1=positions[indexB];var p2=positions[indexC];if(!p0||!p1||!p2){continue;}if(trianglePredicate&&!trianglePredicate(p0,p1,p2,ray,indexA,indexB,indexC)){continue;}var currentIntersectInfo=ray.intersectsTriangle(p0,p1,p2);if(currentIntersectInfo){if(currentIntersectInfo.distance<0){continue;}if(fastCheck||!intersectInfo||currentIntersectInfo.distance<intersectInfo.distance){intersectInfo=currentIntersectInfo;intersectInfo.faceId=faceId;if(fastCheck){break;}}}}return intersectInfo;}},{key:"_intersectUnIndexedTriangles",value:function _intersectUnIndexedTriangles(ray,positions,indices,fastCheck,trianglePredicate){var intersectInfo=null;for(var index=this.verticesStart;index<this.verticesStart+this.verticesCount;index+=3){var p0=positions[index];var p1=positions[index+1];var p2=positions[index+2];if(trianglePredicate&&!trianglePredicate(p0,p1,p2,ray,-1,-1,-1)){continue;}var currentIntersectInfo=ray.intersectsTriangle(p0,p1,p2);if(currentIntersectInfo){if(currentIntersectInfo.distance<0){continue;}if(fastCheck||!intersectInfo||currentIntersectInfo.distance<intersectInfo.distance){intersectInfo=currentIntersectInfo;intersectInfo.faceId=index/3;if(fastCheck){break;}}}}return intersectInfo;}},{key:"_rebuild",value:function _rebuild(){if(this._linesIndexBuffer){this._linesIndexBuffer=null;}}},{key:"clone",value:function clone(newMesh,newRenderingMesh){var result=new SubMesh(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,newMesh,newRenderingMesh,false);if(!this.IsGlobal){var boundingInfo=this.getBoundingInfo();if(!boundingInfo){return result;}result._boundingInfo=new BoundingInfo(boundingInfo.minimum,boundingInfo.maximum);}return result;}},{key:"dispose",value:function dispose(){if(this._linesIndexBuffer){this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer);this._linesIndexBuffer=null;}var index=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(index,1);this.resetDrawCache();}},{key:"getClassName",value:function getClassName(){return"SubMesh";}}],[{key:"AddToMesh",value:function AddToMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh,renderingMesh){var createBoundingBox=arguments.length>7&&arguments[7]!==undefined?arguments[7]:true;return new SubMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh,renderingMesh,createBoundingBox);}},{key:"CreateFromIndices",value:function CreateFromIndices(materialIndex,startIndex,indexCount,mesh,renderingMesh){var createBoundingBox=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var minVertexIndex=Number.MAX_VALUE;var maxVertexIndex=-Number.MAX_VALUE;var whatWillRender=renderingMesh||mesh;var indices=whatWillRender.getIndices();for(var index=startIndex;index<startIndex+indexCount;index++){var vertexIndex=indices[index];if(vertexIndex<minVertexIndex){minVertexIndex=vertexIndex;}if(vertexIndex>maxVertexIndex){maxVertexIndex=vertexIndex;}}return new SubMesh(materialIndex,minVertexIndex,maxVertexIndex-minVertexIndex+1,startIndex,indexCount,mesh,renderingMesh,createBoundingBox);}}]);return SubMesh;}();// node_modules/@babylonjs/core/Compat/compatibilityOptions.js
var CompatibilityOptions=/*#__PURE__*/_createClass(function CompatibilityOptions(){_classCallCheck(this,CompatibilityOptions);});CompatibilityOptions.UseOpenGLOrientationForUV=false;// node_modules/@babylonjs/core/Meshes/geometry.js
var Geometry=/*#__PURE__*/function(){function Geometry(id,scene2,vertexData){var updatable=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var mesh=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;_classCallCheck(this,Geometry);this.delayLoadState=0;this._totalVertices=0;this._isDisposed=false;this._indexBufferIsUpdatable=false;this._positionsCache=[];this._parentContainer=null;this.useBoundingInfoFromGeometry=false;this._scene=scene2||EngineStore.LastCreatedScene;if(!this._scene){return;}this.id=id;this.uniqueId=this._scene.getUniqueId();this._engine=this._scene.getEngine();this._meshes=[];this._vertexBuffers={};this._indices=[];this._updatable=updatable;if(vertexData){this.setAllVerticesData(vertexData,updatable);}else{this._totalVertices=0;}if(this._engine.getCaps().vertexArrayObject){this._vertexArrayObjects={};}if(mesh){this.applyToMesh(mesh);mesh.computeWorldMatrix(true);}}_createClass(Geometry,[{key:"boundingBias",get:function get(){return this._boundingBias;},set:function set(value){if(this._boundingBias){this._boundingBias.copyFrom(value);}else{this._boundingBias=value.clone();}this._updateBoundingInfo(true,null);}},{key:"meshes",get:function get(){return this._meshes;}},{key:"extend",get:function get(){return this._extend;}},{key:"getScene",value:function getScene(){return this._scene;}},{key:"getEngine",value:function getEngine(){return this._engine;}},{key:"isReady",value:function isReady(){return this.delayLoadState===1||this.delayLoadState===0;}},{key:"doNotSerialize",get:function get(){for(var index=0;index<this._meshes.length;index++){if(!this._meshes[index].doNotSerialize){return false;}}return true;}},{key:"_rebuild",value:function _rebuild(){if(this._vertexArrayObjects){this._vertexArrayObjects={};}if(this._meshes.length!==0&&this._indices){this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable);}for(var key in this._vertexBuffers){var vertexBuffer=this._vertexBuffers[key];vertexBuffer._rebuild();}}},{key:"setAllVerticesData",value:function setAllVerticesData(vertexData,updatable){vertexData.applyToGeometry(this,updatable);this._notifyUpdate();}},{key:"setVerticesData",value:function setVerticesData(kind,data){var updatable=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var stride=arguments.length>3?arguments[3]:undefined;if(updatable&&Array.isArray(data)){data=new Float32Array(data);}var buffer=new VertexBuffer(this._engine,data,kind,updatable,this._meshes.length===0,stride);this.setVerticesBuffer(buffer);}},{key:"removeVerticesData",value:function removeVerticesData(kind){if(this._vertexBuffers[kind]){this._vertexBuffers[kind].dispose();delete this._vertexBuffers[kind];}if(this._vertexArrayObjects){this._disposeVertexArrayObjects();}}},{key:"setVerticesBuffer",value:function setVerticesBuffer(buffer){var totalVertices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var disposeExistingBuffer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var kind=buffer.getKind();if(this._vertexBuffers[kind]&&disposeExistingBuffer){this._vertexBuffers[kind].dispose();}if(buffer._buffer){buffer._buffer._increaseReferences();}this._vertexBuffers[kind]=buffer;var meshes=this._meshes;var numOfMeshes=meshes.length;if(kind===VertexBuffer.PositionKind){var data=buffer.getData();if(totalVertices!=null){this._totalVertices=totalVertices;}else{if(data!=null){this._totalVertices=data.length/(buffer.type===VertexBuffer.BYTE?buffer.byteStride:buffer.byteStride/4);}}this._updateExtend(data);this._resetPointsArrayCache();for(var index=0;index<numOfMeshes;index++){var mesh=meshes[index];mesh.buildBoundingInfo(this._extend.minimum,this._extend.maximum);mesh._createGlobalSubMesh(mesh.isUnIndexed);mesh.computeWorldMatrix(true);mesh.synchronizeInstances();}}this._notifyUpdate(kind);}},{key:"updateVerticesDataDirectly",value:function updateVerticesDataDirectly(kind,data,offset){var useBytes=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var vertexBuffer=this.getVertexBuffer(kind);if(!vertexBuffer){return;}vertexBuffer.updateDirectly(data,offset,useBytes);this._notifyUpdate(kind);}},{key:"updateVerticesData",value:function updateVerticesData(kind,data){var updateExtends=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var vertexBuffer=this.getVertexBuffer(kind);if(!vertexBuffer){return;}vertexBuffer.update(data);if(kind===VertexBuffer.PositionKind){this._updateBoundingInfo(updateExtends,data);}this._notifyUpdate(kind);}},{key:"_updateBoundingInfo",value:function _updateBoundingInfo(updateExtends,data){if(updateExtends){this._updateExtend(data);}this._resetPointsArrayCache();if(updateExtends){var meshes=this._meshes;var _iterator88=_createForOfIteratorHelper(meshes),_step97;try{for(_iterator88.s();!(_step97=_iterator88.n()).done;){var mesh=_step97.value;if(mesh.hasBoundingInfo){mesh.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum);}else{mesh.buildBoundingInfo(this._extend.minimum,this._extend.maximum);}var subMeshes=mesh.subMeshes;var _iterator89=_createForOfIteratorHelper(subMeshes),_step98;try{for(_iterator89.s();!(_step98=_iterator89.n()).done;){var subMesh=_step98.value;subMesh.refreshBoundingInfo();}}catch(err){_iterator89.e(err);}finally{_iterator89.f();}}}catch(err){_iterator88.e(err);}finally{_iterator88.f();}}}},{key:"_bind",value:function _bind(effect,indexToBind,overrideVertexBuffers,overrideVertexArrayObjects){if(!effect){return;}if(indexToBind===void 0){indexToBind=this._indexBuffer;}var vbs=this.getVertexBuffers();if(!vbs){return;}if(indexToBind!=this._indexBuffer||!this._vertexArrayObjects&&!overrideVertexArrayObjects){this._engine.bindBuffers(vbs,indexToBind,effect,overrideVertexBuffers);return;}var vaos=overrideVertexArrayObjects?overrideVertexArrayObjects:this._vertexArrayObjects;if(!vaos[effect.key]){vaos[effect.key]=this._engine.recordVertexArrayObject(vbs,indexToBind,effect,overrideVertexBuffers);}this._engine.bindVertexArrayObject(vaos[effect.key],indexToBind);}},{key:"getTotalVertices",value:function getTotalVertices(){if(!this.isReady()){return 0;}return this._totalVertices;}},{key:"getVerticesData",value:function getVerticesData(kind,copyWhenShared,forceCopy){var vertexBuffer=this.getVertexBuffer(kind);if(!vertexBuffer){return null;}return vertexBuffer.getFloatData(this._totalVertices,forceCopy||copyWhenShared&&this._meshes.length!==1);}},{key:"isVertexBufferUpdatable",value:function isVertexBufferUpdatable(kind){var vb=this._vertexBuffers[kind];if(!vb){return false;}return vb.isUpdatable();}},{key:"getVertexBuffer",value:function getVertexBuffer(kind){if(!this.isReady()){return null;}return this._vertexBuffers[kind];}},{key:"getVertexBuffers",value:function getVertexBuffers(){if(!this.isReady()){return null;}return this._vertexBuffers;}},{key:"isVerticesDataPresent",value:function isVerticesDataPresent(kind){if(!this._vertexBuffers){if(this._delayInfo){return this._delayInfo.indexOf(kind)!==-1;}return false;}return this._vertexBuffers[kind]!==void 0;}},{key:"getVerticesDataKinds",value:function getVerticesDataKinds(){var result=[];var kind;if(!this._vertexBuffers&&this._delayInfo){for(kind in this._delayInfo){result.push(kind);}}else{for(kind in this._vertexBuffers){result.push(kind);}}return result;}},{key:"updateIndices",value:function updateIndices(indices,offset){var gpuMemoryOnly=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._indexBuffer){return;}if(!this._indexBufferIsUpdatable){this.setIndices(indices,null,true);}else{var needToUpdateSubMeshes=indices.length!==this._indices.length;if(!gpuMemoryOnly){this._indices=indices.slice();}this._engine.updateDynamicIndexBuffer(this._indexBuffer,indices,offset);if(needToUpdateSubMeshes){var _iterator90=_createForOfIteratorHelper(this._meshes),_step99;try{for(_iterator90.s();!(_step99=_iterator90.n()).done;){var mesh=_step99.value;mesh._createGlobalSubMesh(true);}}catch(err){_iterator90.e(err);}finally{_iterator90.f();}}}}},{key:"setIndices",value:function setIndices(indices){var totalVertices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var updatable=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this._indexBuffer){this._engine._releaseBuffer(this._indexBuffer);}this._indices=indices;this._indexBufferIsUpdatable=updatable;if(this._meshes.length!==0&&this._indices){this._indexBuffer=this._engine.createIndexBuffer(this._indices,updatable);}if(totalVertices!=void 0){this._totalVertices=totalVertices;}var _iterator91=_createForOfIteratorHelper(this._meshes),_step100;try{for(_iterator91.s();!(_step100=_iterator91.n()).done;){var mesh=_step100.value;mesh._createGlobalSubMesh(true);mesh.synchronizeInstances();}}catch(err){_iterator91.e(err);}finally{_iterator91.f();}this._notifyUpdate();}},{key:"getTotalIndices",value:function getTotalIndices(){if(!this.isReady()){return 0;}return this._indices.length;}},{key:"getIndices",value:function getIndices(copyWhenShared,forceCopy){if(!this.isReady()){return null;}var orig=this._indices;if(!forceCopy&&(!copyWhenShared||this._meshes.length===1)){return orig;}else{return orig.slice();}}},{key:"getIndexBuffer",value:function getIndexBuffer(){if(!this.isReady()){return null;}return this._indexBuffer;}},{key:"_releaseVertexArrayObject",value:function _releaseVertexArrayObject(){var effect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!effect||!this._vertexArrayObjects){return;}if(this._vertexArrayObjects[effect.key]){this._engine.releaseVertexArrayObject(this._vertexArrayObjects[effect.key]);delete this._vertexArrayObjects[effect.key];}}},{key:"releaseForMesh",value:function releaseForMesh(mesh,shouldDispose){var meshes=this._meshes;var index=meshes.indexOf(mesh);if(index===-1){return;}meshes.splice(index,1);if(this._vertexArrayObjects){mesh._invalidateInstanceVertexArrayObject();}mesh._geometry=null;if(meshes.length===0&&shouldDispose){this.dispose();}}},{key:"applyToMesh",value:function applyToMesh(mesh){if(mesh._geometry===this){return;}var previousGeometry=mesh._geometry;if(previousGeometry){previousGeometry.releaseForMesh(mesh);}if(this._vertexArrayObjects){mesh._invalidateInstanceVertexArrayObject();}var meshes=this._meshes;mesh._geometry=this;mesh._internalAbstractMeshDataInfo._positions=null;this._scene.pushGeometry(this);meshes.push(mesh);if(this.isReady()){this._applyToMesh(mesh);}else if(this._boundingInfo){mesh.setBoundingInfo(this._boundingInfo);}}},{key:"_updateExtend",value:function _updateExtend(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo){this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};}else{if(!data){data=this.getVerticesData(VertexBuffer.PositionKind);if(!data){return;}}this._extend=extractMinAndMax(data,0,this._totalVertices,this.boundingBias,3);}}},{key:"_applyToMesh",value:function _applyToMesh(mesh){var numOfMeshes=this._meshes.length;for(var kind in this._vertexBuffers){if(numOfMeshes===1){this._vertexBuffers[kind].create();}if(kind===VertexBuffer.PositionKind){if(!this._extend){this._updateExtend();}mesh.buildBoundingInfo(this._extend.minimum,this._extend.maximum);mesh._createGlobalSubMesh(mesh.isUnIndexed);mesh._updateBoundingInfo();}}if(numOfMeshes===1&&this._indices&&this._indices.length>0){this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable);}mesh._syncGeometryWithMorphTargetManager();mesh.synchronizeInstances();}},{key:"_notifyUpdate",value:function _notifyUpdate(kind){if(this.onGeometryUpdated){this.onGeometryUpdated(this,kind);}if(this._vertexArrayObjects){this._disposeVertexArrayObjects();}var _iterator92=_createForOfIteratorHelper(this._meshes),_step101;try{for(_iterator92.s();!(_step101=_iterator92.n()).done;){var mesh=_step101.value;mesh._markSubMeshesAsAttributesDirty();}}catch(err){_iterator92.e(err);}finally{_iterator92.f();}}},{key:"load",value:function load(scene2,onLoaded){if(this.delayLoadState===2){return;}if(this.isReady()){if(onLoaded){onLoaded();}return;}this.delayLoadState=2;this._queueLoad(scene2,onLoaded);}},{key:"_queueLoad",value:function _queueLoad(scene2,onLoaded){var _this74=this;if(!this.delayLoadingFile){return;}scene2.addPendingData(this);scene2._loadFile(this.delayLoadingFile,function(data){if(!_this74._delayLoadingFunction){return;}_this74._delayLoadingFunction(JSON.parse(data),_this74);_this74.delayLoadState=1;_this74._delayInfo=[];scene2.removePendingData(_this74);var meshes=_this74._meshes;var numOfMeshes=meshes.length;for(var index=0;index<numOfMeshes;index++){_this74._applyToMesh(meshes[index]);}if(onLoaded){onLoaded();}},void 0,true);}},{key:"toLeftHanded",value:function toLeftHanded(){var tIndices=this.getIndices(false);if(tIndices!=null&&tIndices.length>0){for(var i=0;i<tIndices.length;i+=3){var tTemp=tIndices[i+0];tIndices[i+0]=tIndices[i+2];tIndices[i+2]=tTemp;}this.setIndices(tIndices);}var tPositions=this.getVerticesData(VertexBuffer.PositionKind,false);if(tPositions!=null&&tPositions.length>0){for(var _i13=0;_i13<tPositions.length;_i13+=3){tPositions[_i13+2]=-tPositions[_i13+2];}this.setVerticesData(VertexBuffer.PositionKind,tPositions,false);}var tNormals=this.getVerticesData(VertexBuffer.NormalKind,false);if(tNormals!=null&&tNormals.length>0){for(var _i14=0;_i14<tNormals.length;_i14+=3){tNormals[_i14+2]=-tNormals[_i14+2];}this.setVerticesData(VertexBuffer.NormalKind,tNormals,false);}}},{key:"_resetPointsArrayCache",value:function _resetPointsArrayCache(){this._positions=null;}},{key:"_generatePointsArray",value:function _generatePointsArray(){if(this._positions){return true;}var data=this.getVerticesData(VertexBuffer.PositionKind);if(!data||data.length===0){return false;}for(var index=this._positionsCache.length*3,arrayIdx=this._positionsCache.length;index<data.length;index+=3,++arrayIdx){this._positionsCache[arrayIdx]=Vector3.FromArray(data,index);}for(var _index10=0,_arrayIdx=0;_index10<data.length;_index10+=3,++_arrayIdx){this._positionsCache[_arrayIdx].set(data[0+_index10],data[1+_index10],data[2+_index10]);}this._positionsCache.length=data.length/3;this._positions=this._positionsCache;return true;}},{key:"isDisposed",value:function isDisposed(){return this._isDisposed;}},{key:"_disposeVertexArrayObjects",value:function _disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(var kind in this._vertexArrayObjects){this._engine.releaseVertexArrayObject(this._vertexArrayObjects[kind]);}this._vertexArrayObjects={};var meshes=this._meshes;var numOfMeshes=meshes.length;for(var index=0;index<numOfMeshes;index++){meshes[index]._invalidateInstanceVertexArrayObject();}}}},{key:"dispose",value:function dispose(){var meshes=this._meshes;var numOfMeshes=meshes.length;var index;for(index=0;index<numOfMeshes;index++){this.releaseForMesh(meshes[index]);}this._meshes.length=0;this._disposeVertexArrayObjects();for(var kind in this._vertexBuffers){this._vertexBuffers[kind].dispose();}this._vertexBuffers={};this._totalVertices=0;if(this._indexBuffer){this._engine._releaseBuffer(this._indexBuffer);}this._indexBuffer=null;this._indices=[];this.delayLoadState=0;this.delayLoadingFile=null;this._delayLoadingFunction=null;this._delayInfo=[];this._boundingInfo=null;this._scene.removeGeometry(this);if(this._parentContainer){var index2=this._parentContainer.geometries.indexOf(this);if(index2>-1){this._parentContainer.geometries.splice(index2,1);}this._parentContainer=null;}this._isDisposed=true;}},{key:"copy",value:function copy(id){var vertexData=new VertexData();vertexData.indices=[];var indices=this.getIndices();if(indices){for(var index=0;index<indices.length;index++){vertexData.indices.push(indices[index]);}}var updatable=false;var stopChecking=false;var kind;for(kind in this._vertexBuffers){var data=this.getVerticesData(kind);if(data){if(data instanceof Float32Array){vertexData.set(new Float32Array(data),kind);}else{vertexData.set(data.slice(0),kind);}if(!stopChecking){var vb=this.getVertexBuffer(kind);if(vb){updatable=vb.isUpdatable();stopChecking=!updatable;}}}}var geometry=new Geometry(id,this._scene,vertexData,updatable);geometry.delayLoadState=this.delayLoadState;geometry.delayLoadingFile=this.delayLoadingFile;geometry._delayLoadingFunction=this._delayLoadingFunction;for(kind in this._delayInfo){geometry._delayInfo=geometry._delayInfo||[];geometry._delayInfo.push(kind);}geometry._boundingInfo=new BoundingInfo(this._extend.minimum,this._extend.maximum);return geometry;}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.id=this.id;serializationObject.uniqueId=this.uniqueId;serializationObject.updatable=this._updatable;if(Tags&&Tags.HasTags(this)){serializationObject.tags=Tags.GetTags(this);}return serializationObject;}},{key:"_toNumberArray",value:function _toNumberArray(origin){if(Array.isArray(origin)){return origin;}else{return Array.prototype.slice.call(origin);}}},{key:"clearCachedData",value:function clearCachedData(){this._indices=[];this._resetPointsArrayCache();for(var vbName in this._vertexBuffers){if(!Object.prototype.hasOwnProperty.call(this._vertexBuffers,vbName)){continue;}this._vertexBuffers[vbName]._buffer._data=null;}}},{key:"serializeVerticeData",value:function serializeVerticeData(){var serializationObject=this.serialize();if(this.isVerticesDataPresent(VertexBuffer.PositionKind)){serializationObject.positions=this._toNumberArray(this.getVerticesData(VertexBuffer.PositionKind));if(this.isVertexBufferUpdatable(VertexBuffer.PositionKind)){serializationObject.positions._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.NormalKind)){serializationObject.normals=this._toNumberArray(this.getVerticesData(VertexBuffer.NormalKind));if(this.isVertexBufferUpdatable(VertexBuffer.NormalKind)){serializationObject.normals._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.TangentKind)){serializationObject.tangents=this._toNumberArray(this.getVerticesData(VertexBuffer.TangentKind));if(this.isVertexBufferUpdatable(VertexBuffer.TangentKind)){serializationObject.tangents._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.UVKind)){serializationObject.uvs=this._toNumberArray(this.getVerticesData(VertexBuffer.UVKind));if(this.isVertexBufferUpdatable(VertexBuffer.UVKind)){serializationObject.uvs._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.UV2Kind)){serializationObject.uv2s=this._toNumberArray(this.getVerticesData(VertexBuffer.UV2Kind));if(this.isVertexBufferUpdatable(VertexBuffer.UV2Kind)){serializationObject.uv2s._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.UV3Kind)){serializationObject.uv3s=this._toNumberArray(this.getVerticesData(VertexBuffer.UV3Kind));if(this.isVertexBufferUpdatable(VertexBuffer.UV3Kind)){serializationObject.uv3s._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.UV4Kind)){serializationObject.uv4s=this._toNumberArray(this.getVerticesData(VertexBuffer.UV4Kind));if(this.isVertexBufferUpdatable(VertexBuffer.UV4Kind)){serializationObject.uv4s._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.UV5Kind)){serializationObject.uv5s=this._toNumberArray(this.getVerticesData(VertexBuffer.UV5Kind));if(this.isVertexBufferUpdatable(VertexBuffer.UV5Kind)){serializationObject.uv5s._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.UV6Kind)){serializationObject.uv6s=this._toNumberArray(this.getVerticesData(VertexBuffer.UV6Kind));if(this.isVertexBufferUpdatable(VertexBuffer.UV6Kind)){serializationObject.uv6s._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.ColorKind)){serializationObject.colors=this._toNumberArray(this.getVerticesData(VertexBuffer.ColorKind));if(this.isVertexBufferUpdatable(VertexBuffer.ColorKind)){serializationObject.colors._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)){serializationObject.matricesIndices=this._toNumberArray(this.getVerticesData(VertexBuffer.MatricesIndicesKind));serializationObject.matricesIndices._isExpanded=true;if(this.isVertexBufferUpdatable(VertexBuffer.MatricesIndicesKind)){serializationObject.matricesIndices._updatable=true;}}if(this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)){serializationObject.matricesWeights=this._toNumberArray(this.getVerticesData(VertexBuffer.MatricesWeightsKind));if(this.isVertexBufferUpdatable(VertexBuffer.MatricesWeightsKind)){serializationObject.matricesWeights._updatable=true;}}serializationObject.indices=this._toNumberArray(this.getIndices());return serializationObject;}}],[{key:"CreateGeometryForMesh",value:function CreateGeometryForMesh(mesh){var geometry=new Geometry(Geometry.RandomId(),mesh.getScene());geometry.applyToMesh(mesh);return geometry;}},{key:"ExtractFromMesh",value:function ExtractFromMesh(mesh,id){var geometry=mesh._geometry;if(!geometry){return null;}return geometry.copy(id);}},{key:"RandomId",value:function RandomId(){return Tools.RandomId();}},{key:"_GetGeometryByLoadedUniqueId",value:function _GetGeometryByLoadedUniqueId(uniqueId,scene2){for(var index=0;index<scene2.geometries.length;index++){if(scene2.geometries[index]._loadedUniqueId===uniqueId){return scene2.geometries[index];}}return null;}},{key:"_ImportGeometry",value:function _ImportGeometry(parsedGeometry,mesh){var scene2=mesh.getScene();var geometryUniqueId=parsedGeometry.geometryUniqueId;var geometryId=parsedGeometry.geometryId;if(geometryUniqueId||geometryId){var geometry=geometryUniqueId?this._GetGeometryByLoadedUniqueId(geometryUniqueId,scene2):scene2.getGeometryById(geometryId);if(geometry){geometry.applyToMesh(mesh);}}else if(parsedGeometry instanceof ArrayBuffer){var binaryInfo=mesh._binaryInfo;if(binaryInfo.positionsAttrDesc&&binaryInfo.positionsAttrDesc.count>0){var positionsData=new Float32Array(parsedGeometry,binaryInfo.positionsAttrDesc.offset,binaryInfo.positionsAttrDesc.count);mesh.setVerticesData(VertexBuffer.PositionKind,positionsData,false);}if(binaryInfo.normalsAttrDesc&&binaryInfo.normalsAttrDesc.count>0){var normalsData=new Float32Array(parsedGeometry,binaryInfo.normalsAttrDesc.offset,binaryInfo.normalsAttrDesc.count);mesh.setVerticesData(VertexBuffer.NormalKind,normalsData,false);}if(binaryInfo.tangetsAttrDesc&&binaryInfo.tangetsAttrDesc.count>0){var tangentsData=new Float32Array(parsedGeometry,binaryInfo.tangetsAttrDesc.offset,binaryInfo.tangetsAttrDesc.count);mesh.setVerticesData(VertexBuffer.TangentKind,tangentsData,false);}if(binaryInfo.uvsAttrDesc&&binaryInfo.uvsAttrDesc.count>0){var uvsData=new Float32Array(parsedGeometry,binaryInfo.uvsAttrDesc.offset,binaryInfo.uvsAttrDesc.count);if(CompatibilityOptions.UseOpenGLOrientationForUV){for(var index=1;index<uvsData.length;index+=2){uvsData[index]=1-uvsData[index];}}mesh.setVerticesData(VertexBuffer.UVKind,uvsData,false);}if(binaryInfo.uvs2AttrDesc&&binaryInfo.uvs2AttrDesc.count>0){var uvs2Data=new Float32Array(parsedGeometry,binaryInfo.uvs2AttrDesc.offset,binaryInfo.uvs2AttrDesc.count);if(CompatibilityOptions.UseOpenGLOrientationForUV){for(var _index11=1;_index11<uvs2Data.length;_index11+=2){uvs2Data[_index11]=1-uvs2Data[_index11];}}mesh.setVerticesData(VertexBuffer.UV2Kind,uvs2Data,false);}if(binaryInfo.uvs3AttrDesc&&binaryInfo.uvs3AttrDesc.count>0){var uvs3Data=new Float32Array(parsedGeometry,binaryInfo.uvs3AttrDesc.offset,binaryInfo.uvs3AttrDesc.count);if(CompatibilityOptions.UseOpenGLOrientationForUV){for(var _index12=1;_index12<uvs3Data.length;_index12+=2){uvs3Data[_index12]=1-uvs3Data[_index12];}}mesh.setVerticesData(VertexBuffer.UV3Kind,uvs3Data,false);}if(binaryInfo.uvs4AttrDesc&&binaryInfo.uvs4AttrDesc.count>0){var uvs4Data=new Float32Array(parsedGeometry,binaryInfo.uvs4AttrDesc.offset,binaryInfo.uvs4AttrDesc.count);if(CompatibilityOptions.UseOpenGLOrientationForUV){for(var _index13=1;_index13<uvs4Data.length;_index13+=2){uvs4Data[_index13]=1-uvs4Data[_index13];}}mesh.setVerticesData(VertexBuffer.UV4Kind,uvs4Data,false);}if(binaryInfo.uvs5AttrDesc&&binaryInfo.uvs5AttrDesc.count>0){var uvs5Data=new Float32Array(parsedGeometry,binaryInfo.uvs5AttrDesc.offset,binaryInfo.uvs5AttrDesc.count);if(CompatibilityOptions.UseOpenGLOrientationForUV){for(var _index14=1;_index14<uvs5Data.length;_index14+=2){uvs5Data[_index14]=1-uvs5Data[_index14];}}mesh.setVerticesData(VertexBuffer.UV5Kind,uvs5Data,false);}if(binaryInfo.uvs6AttrDesc&&binaryInfo.uvs6AttrDesc.count>0){var uvs6Data=new Float32Array(parsedGeometry,binaryInfo.uvs6AttrDesc.offset,binaryInfo.uvs6AttrDesc.count);if(CompatibilityOptions.UseOpenGLOrientationForUV){for(var _index15=1;_index15<uvs6Data.length;_index15+=2){uvs6Data[_index15]=1-uvs6Data[_index15];}}mesh.setVerticesData(VertexBuffer.UV6Kind,uvs6Data,false);}if(binaryInfo.colorsAttrDesc&&binaryInfo.colorsAttrDesc.count>0){var colorsData=new Float32Array(parsedGeometry,binaryInfo.colorsAttrDesc.offset,binaryInfo.colorsAttrDesc.count);mesh.setVerticesData(VertexBuffer.ColorKind,colorsData,false,binaryInfo.colorsAttrDesc.stride);}if(binaryInfo.matricesIndicesAttrDesc&&binaryInfo.matricesIndicesAttrDesc.count>0){var matricesIndicesData=new Int32Array(parsedGeometry,binaryInfo.matricesIndicesAttrDesc.offset,binaryInfo.matricesIndicesAttrDesc.count);var floatIndices=[];for(var i=0;i<matricesIndicesData.length;i++){var _index16=matricesIndicesData[i];floatIndices.push(_index16&255);floatIndices.push((_index16&65280)>>8);floatIndices.push((_index16&16711680)>>16);floatIndices.push(_index16>>24&255);}mesh.setVerticesData(VertexBuffer.MatricesIndicesKind,floatIndices,false);}if(binaryInfo.matricesIndicesExtraAttrDesc&&binaryInfo.matricesIndicesExtraAttrDesc.count>0){var _matricesIndicesData=new Int32Array(parsedGeometry,binaryInfo.matricesIndicesExtraAttrDesc.offset,binaryInfo.matricesIndicesExtraAttrDesc.count);var _floatIndices=[];for(var _i15=0;_i15<_matricesIndicesData.length;_i15++){var _index17=_matricesIndicesData[_i15];_floatIndices.push(_index17&255);_floatIndices.push((_index17&65280)>>8);_floatIndices.push((_index17&16711680)>>16);_floatIndices.push(_index17>>24&255);}mesh.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,_floatIndices,false);}if(binaryInfo.matricesWeightsAttrDesc&&binaryInfo.matricesWeightsAttrDesc.count>0){var matricesWeightsData=new Float32Array(parsedGeometry,binaryInfo.matricesWeightsAttrDesc.offset,binaryInfo.matricesWeightsAttrDesc.count);mesh.setVerticesData(VertexBuffer.MatricesWeightsKind,matricesWeightsData,false);}if(binaryInfo.indicesAttrDesc&&binaryInfo.indicesAttrDesc.count>0){var indicesData=new Int32Array(parsedGeometry,binaryInfo.indicesAttrDesc.offset,binaryInfo.indicesAttrDesc.count);mesh.setIndices(indicesData,null);}if(binaryInfo.subMeshesAttrDesc&&binaryInfo.subMeshesAttrDesc.count>0){var subMeshesData=new Int32Array(parsedGeometry,binaryInfo.subMeshesAttrDesc.offset,binaryInfo.subMeshesAttrDesc.count*5);mesh.subMeshes=[];for(var _i16=0;_i16<binaryInfo.subMeshesAttrDesc.count;_i16++){var materialIndex=subMeshesData[_i16*5+0];var verticesStart=subMeshesData[_i16*5+1];var verticesCount=subMeshesData[_i16*5+2];var indexStart=subMeshesData[_i16*5+3];var indexCount=subMeshesData[_i16*5+4];SubMesh.AddToMesh(materialIndex,verticesStart,verticesCount,indexStart,indexCount,mesh);}}}else if(parsedGeometry.positions&&parsedGeometry.normals&&parsedGeometry.indices){mesh.setVerticesData(VertexBuffer.PositionKind,parsedGeometry.positions,parsedGeometry.positions._updatable);mesh.setVerticesData(VertexBuffer.NormalKind,parsedGeometry.normals,parsedGeometry.normals._updatable);if(parsedGeometry.tangents){mesh.setVerticesData(VertexBuffer.TangentKind,parsedGeometry.tangents,parsedGeometry.tangents._updatable);}if(parsedGeometry.uvs){mesh.setVerticesData(VertexBuffer.UVKind,parsedGeometry.uvs,parsedGeometry.uvs._updatable);}if(parsedGeometry.uvs2){mesh.setVerticesData(VertexBuffer.UV2Kind,parsedGeometry.uvs2,parsedGeometry.uvs2._updatable);}if(parsedGeometry.uvs3){mesh.setVerticesData(VertexBuffer.UV3Kind,parsedGeometry.uvs3,parsedGeometry.uvs3._updatable);}if(parsedGeometry.uvs4){mesh.setVerticesData(VertexBuffer.UV4Kind,parsedGeometry.uvs4,parsedGeometry.uvs4._updatable);}if(parsedGeometry.uvs5){mesh.setVerticesData(VertexBuffer.UV5Kind,parsedGeometry.uvs5,parsedGeometry.uvs5._updatable);}if(parsedGeometry.uvs6){mesh.setVerticesData(VertexBuffer.UV6Kind,parsedGeometry.uvs6,parsedGeometry.uvs6._updatable);}if(parsedGeometry.colors){mesh.setVerticesData(VertexBuffer.ColorKind,Color4.CheckColors4(parsedGeometry.colors,parsedGeometry.positions.length/3),parsedGeometry.colors._updatable);}if(parsedGeometry.matricesIndices){if(!parsedGeometry.matricesIndices._isExpanded){var _floatIndices2=[];for(var _i17=0;_i17<parsedGeometry.matricesIndices.length;_i17++){var matricesIndex=parsedGeometry.matricesIndices[_i17];_floatIndices2.push(matricesIndex&255);_floatIndices2.push((matricesIndex&65280)>>8);_floatIndices2.push((matricesIndex&16711680)>>16);_floatIndices2.push(matricesIndex>>24&255);}mesh.setVerticesData(VertexBuffer.MatricesIndicesKind,_floatIndices2,parsedGeometry.matricesIndices._updatable);}else{delete parsedGeometry.matricesIndices._isExpanded;mesh.setVerticesData(VertexBuffer.MatricesIndicesKind,parsedGeometry.matricesIndices,parsedGeometry.matricesIndices._updatable);}}if(parsedGeometry.matricesIndicesExtra){if(!parsedGeometry.matricesIndicesExtra._isExpanded){var _floatIndices3=[];for(var _i18=0;_i18<parsedGeometry.matricesIndicesExtra.length;_i18++){var _matricesIndex=parsedGeometry.matricesIndicesExtra[_i18];_floatIndices3.push(_matricesIndex&255);_floatIndices3.push((_matricesIndex&65280)>>8);_floatIndices3.push((_matricesIndex&16711680)>>16);_floatIndices3.push(_matricesIndex>>24&255);}mesh.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,_floatIndices3,parsedGeometry.matricesIndicesExtra._updatable);}else{delete parsedGeometry.matricesIndices._isExpanded;mesh.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,parsedGeometry.matricesIndicesExtra,parsedGeometry.matricesIndicesExtra._updatable);}}if(parsedGeometry.matricesWeights){Geometry._CleanMatricesWeights(parsedGeometry,mesh);mesh.setVerticesData(VertexBuffer.MatricesWeightsKind,parsedGeometry.matricesWeights,parsedGeometry.matricesWeights._updatable);}if(parsedGeometry.matricesWeightsExtra){mesh.setVerticesData(VertexBuffer.MatricesWeightsExtraKind,parsedGeometry.matricesWeightsExtra,parsedGeometry.matricesWeights._updatable);}mesh.setIndices(parsedGeometry.indices,null);}if(parsedGeometry.subMeshes){mesh.subMeshes=[];for(var subIndex=0;subIndex<parsedGeometry.subMeshes.length;subIndex++){var parsedSubMesh=parsedGeometry.subMeshes[subIndex];SubMesh.AddToMesh(parsedSubMesh.materialIndex,parsedSubMesh.verticesStart,parsedSubMesh.verticesCount,parsedSubMesh.indexStart,parsedSubMesh.indexCount,mesh);}}if(mesh._shouldGenerateFlatShading){mesh.convertToFlatShadedMesh();mesh._shouldGenerateFlatShading=false;}mesh.computeWorldMatrix(true);scene2.onMeshImportedObservable.notifyObservers(mesh);}},{key:"_CleanMatricesWeights",value:function _CleanMatricesWeights(parsedGeometry,mesh){var epsilon=1e-3;if(!SceneLoaderFlags.CleanBoneMatrixWeights){return;}var noInfluenceBoneIndex=0;if(parsedGeometry.skeletonId>-1){var skeleton=mesh.getScene().getLastSkeletonById(parsedGeometry.skeletonId);if(!skeleton){return;}noInfluenceBoneIndex=skeleton.bones.length;}else{return;}var matricesIndices=mesh.getVerticesData(VertexBuffer.MatricesIndicesKind);var matricesIndicesExtra=mesh.getVerticesData(VertexBuffer.MatricesIndicesExtraKind);var matricesWeights=parsedGeometry.matricesWeights;var matricesWeightsExtra=parsedGeometry.matricesWeightsExtra;var influencers=parsedGeometry.numBoneInfluencer;var size=matricesWeights.length;for(var i=0;i<size;i+=4){var weight=0;var firstZeroWeight=-1;for(var j=0;j<4;j++){var w=matricesWeights[i+j];weight+=w;if(w<epsilon&&firstZeroWeight<0){firstZeroWeight=j;}}if(matricesWeightsExtra){for(var _j2=0;_j2<4;_j2++){var _w2=matricesWeightsExtra[i+_j2];weight+=_w2;if(_w2<epsilon&&firstZeroWeight<0){firstZeroWeight=_j2+4;}}}if(firstZeroWeight<0||firstZeroWeight>influencers-1){firstZeroWeight=influencers-1;}if(weight>epsilon){var mweight=1/weight;for(var _j3=0;_j3<4;_j3++){matricesWeights[i+_j3]*=mweight;}if(matricesWeightsExtra){for(var _j4=0;_j4<4;_j4++){matricesWeightsExtra[i+_j4]*=mweight;}}}else{if(firstZeroWeight>=4){matricesWeightsExtra[i+firstZeroWeight-4]=1-weight;matricesIndicesExtra[i+firstZeroWeight-4]=noInfluenceBoneIndex;}else{matricesWeights[i+firstZeroWeight]=1-weight;matricesIndices[i+firstZeroWeight]=noInfluenceBoneIndex;}}}mesh.setVerticesData(VertexBuffer.MatricesIndicesKind,matricesIndices);if(parsedGeometry.matricesWeightsExtra){mesh.setVerticesData(VertexBuffer.MatricesIndicesExtraKind,matricesIndicesExtra);}}},{key:"Parse",value:function Parse(parsedVertexData,scene2,rootUrl){var geometry=new Geometry(parsedVertexData.id,scene2,void 0,parsedVertexData.updatable);geometry._loadedUniqueId=parsedVertexData.uniqueId;if(Tags){Tags.AddTagsTo(geometry,parsedVertexData.tags);}if(parsedVertexData.delayLoadingFile){geometry.delayLoadState=4;geometry.delayLoadingFile=rootUrl+parsedVertexData.delayLoadingFile;geometry._boundingInfo=new BoundingInfo(Vector3.FromArray(parsedVertexData.boundingBoxMinimum),Vector3.FromArray(parsedVertexData.boundingBoxMaximum));geometry._delayInfo=[];if(parsedVertexData.hasUVs){geometry._delayInfo.push(VertexBuffer.UVKind);}if(parsedVertexData.hasUVs2){geometry._delayInfo.push(VertexBuffer.UV2Kind);}if(parsedVertexData.hasUVs3){geometry._delayInfo.push(VertexBuffer.UV3Kind);}if(parsedVertexData.hasUVs4){geometry._delayInfo.push(VertexBuffer.UV4Kind);}if(parsedVertexData.hasUVs5){geometry._delayInfo.push(VertexBuffer.UV5Kind);}if(parsedVertexData.hasUVs6){geometry._delayInfo.push(VertexBuffer.UV6Kind);}if(parsedVertexData.hasColors){geometry._delayInfo.push(VertexBuffer.ColorKind);}if(parsedVertexData.hasMatricesIndices){geometry._delayInfo.push(VertexBuffer.MatricesIndicesKind);}if(parsedVertexData.hasMatricesWeights){geometry._delayInfo.push(VertexBuffer.MatricesWeightsKind);}geometry._delayLoadingFunction=VertexData.ImportVertexData;}else{VertexData.ImportVertexData(parsedVertexData,geometry);}scene2.pushGeometry(geometry,true);return geometry;}}]);return Geometry;}();// node_modules/@babylonjs/core/Maths/math.axis.js
var Space;(function(Space2){Space2[Space2["LOCAL"]=0]="LOCAL";Space2[Space2["WORLD"]=1]="WORLD";Space2[Space2["BONE"]=2]="BONE";})(Space||(Space={}));var Axis=/*#__PURE__*/_createClass(function Axis(){_classCallCheck(this,Axis);});Axis.X=new Vector3(1,0,0);Axis.Y=new Vector3(0,1,0);Axis.Z=new Vector3(0,0,1);var Coordinate;(function(Coordinate2){Coordinate2[Coordinate2["X"]=0]="X";Coordinate2[Coordinate2["Y"]=1]="Y";Coordinate2[Coordinate2["Z"]=2]="Z";})(Coordinate||(Coordinate={}));// node_modules/@babylonjs/core/Meshes/transformNode.js
var TransformNode=/*#__PURE__*/function(_Node2){_inherits(TransformNode,_Node2);var _super22=_createSuper(TransformNode);function TransformNode(name135){var _this75;var scene2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var isPure=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,TransformNode);_this75=_super22.call(this,name135,scene2);_this75._forward=new Vector3(0,0,1);_this75._up=new Vector3(0,1,0);_this75._right=new Vector3(1,0,0);_this75._position=Vector3.Zero();_this75._rotation=Vector3.Zero();_this75._rotationQuaternion=null;_this75._scaling=Vector3.One();_this75._transformToBoneReferal=null;_this75._isAbsoluteSynced=false;_this75._billboardMode=TransformNode.BILLBOARDMODE_NONE;_this75._preserveParentRotationForBillboard=false;_this75.scalingDeterminant=1;_this75._infiniteDistance=false;_this75.ignoreNonUniformScaling=false;_this75.reIntegrateRotationIntoRotationQuaternion=false;_this75._poseMatrix=null;_this75._localMatrix=Matrix.Zero();_this75._usePivotMatrix=false;_this75._absolutePosition=Vector3.Zero();_this75._absoluteScaling=Vector3.Zero();_this75._absoluteRotationQuaternion=Quaternion.Identity();_this75._pivotMatrix=Matrix.Identity();_this75._postMultiplyPivotMatrix=false;_this75._isWorldMatrixFrozen=false;_this75._indexInSceneTransformNodesArray=-1;_this75.onAfterWorldMatrixUpdateObservable=new Observable();_this75._nonUniformScaling=false;if(isPure){_this75.getScene().addTransformNode(_assertThisInitialized(_this75));}return _this75;}_createClass(TransformNode,[{key:"billboardMode",get:function get(){return this._billboardMode;},set:function set(value){if(this._billboardMode===value){return;}this._billboardMode=value;this._cache.useBillboardPosition=(this._billboardMode&TransformNode.BILLBOARDMODE_USE_POSITION)!==0;this._computeUseBillboardPath();}},{key:"preserveParentRotationForBillboard",get:function get(){return this._preserveParentRotationForBillboard;},set:function set(value){if(value===this._preserveParentRotationForBillboard){return;}this._preserveParentRotationForBillboard=value;this._computeUseBillboardPath();}},{key:"_computeUseBillboardPath",value:function _computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==TransformNode.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;}},{key:"infiniteDistance",get:function get(){return this._infiniteDistance;},set:function set(value){if(this._infiniteDistance===value){return;}this._infiniteDistance=value;}},{key:"getClassName",value:function getClassName(){return"TransformNode";}},{key:"position",get:function get(){return this._position;},set:function set(newPosition){this._position=newPosition;this._isDirty=true;}},{key:"isUsingPivotMatrix",value:function isUsingPivotMatrix(){return this._usePivotMatrix;}},{key:"rotation",get:function get(){return this._rotation;},set:function set(newRotation){this._rotation=newRotation;this._rotationQuaternion=null;this._isDirty=true;}},{key:"scaling",get:function get(){return this._scaling;},set:function set(newScaling){this._scaling=newScaling;this._isDirty=true;}},{key:"rotationQuaternion",get:function get(){return this._rotationQuaternion;},set:function set(quaternion){this._rotationQuaternion=quaternion;if(quaternion){this._rotation.setAll(0);}this._isDirty=true;}},{key:"forward",get:function get(){Vector3.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward);return this._forward.normalize();}},{key:"up",get:function get(){Vector3.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up);return this._up.normalize();}},{key:"right",get:function get(){Vector3.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right);return this._right.normalize();}},{key:"updatePoseMatrix",value:function updatePoseMatrix(matrix){if(!this._poseMatrix){this._poseMatrix=matrix.clone();return this;}this._poseMatrix.copyFrom(matrix);return this;}},{key:"getPoseMatrix",value:function getPoseMatrix(){if(!this._poseMatrix){this._poseMatrix=Matrix.Identity();}return this._poseMatrix;}},{key:"_isSynchronized",value:function _isSynchronized(){var cache=this._cache;if(this._billboardMode!==cache.billboardMode||this._billboardMode!==TransformNode.BILLBOARDMODE_NONE){return false;}if(cache.pivotMatrixUpdated){return false;}if(this._infiniteDistance){return false;}if(this._position._isDirty){return false;}if(this._scaling._isDirty){return false;}if(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty){return false;}return true;}},{key:"_initCache",value:function _initCache(){_get(_getPrototypeOf(TransformNode.prototype),"_initCache",this).call(this);var cache=this._cache;cache.localMatrixUpdated=false;cache.billboardMode=-1;cache.infiniteDistance=false;cache.useBillboardPosition=false;cache.useBillboardPath=false;}},{key:"absolutePosition",get:function get(){return this.getAbsolutePosition();}},{key:"absoluteScaling",get:function get(){this._syncAbsoluteScalingAndRotation();return this._absoluteScaling;}},{key:"absoluteRotationQuaternion",get:function get(){this._syncAbsoluteScalingAndRotation();return this._absoluteRotationQuaternion;}},{key:"setPreTransformMatrix",value:function setPreTransformMatrix(matrix){return this.setPivotMatrix(matrix,false);}},{key:"setPivotMatrix",value:function setPivotMatrix(matrix){var postMultiplyPivotMatrix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this._pivotMatrix.copyFrom(matrix);this._usePivotMatrix=!this._pivotMatrix.isIdentity();this._cache.pivotMatrixUpdated=true;this._postMultiplyPivotMatrix=postMultiplyPivotMatrix;if(this._postMultiplyPivotMatrix){if(!this._pivotMatrixInverse){this._pivotMatrixInverse=Matrix.Invert(this._pivotMatrix);}else{this._pivotMatrix.invertToRef(this._pivotMatrixInverse);}}return this;}},{key:"getPivotMatrix",value:function getPivotMatrix(){return this._pivotMatrix;}},{key:"instantiateHierarchy",value:function instantiateHierarchy(){var newParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var options=arguments.length>1?arguments[1]:undefined;var onNewNodeCreated=arguments.length>2?arguments[2]:undefined;var clone=this.clone("Clone of "+(this.name||this.id),newParent||this.parent,true);if(clone){if(onNewNodeCreated){onNewNodeCreated(this,clone);}}var _iterator93=_createForOfIteratorHelper(this.getChildTransformNodes(true)),_step102;try{for(_iterator93.s();!(_step102=_iterator93.n()).done;){var child=_step102.value;child.instantiateHierarchy(clone,options,onNewNodeCreated);}}catch(err){_iterator93.e(err);}finally{_iterator93.f();}return clone;}},{key:"freezeWorldMatrix",value:function freezeWorldMatrix(){var newWorldMatrix=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var decompose=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(newWorldMatrix){if(decompose){this._rotation.setAll(0);this._rotationQuaternion=this._rotationQuaternion||Quaternion.Identity();newWorldMatrix.decompose(this._scaling,this._rotationQuaternion,this._position);this.computeWorldMatrix(true);}else{this._worldMatrix=newWorldMatrix;this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);this._afterComputeWorldMatrix();}}else{this._isWorldMatrixFrozen=false;this.computeWorldMatrix(true);}this._isDirty=false;this._isWorldMatrixFrozen=true;return this;}},{key:"unfreezeWorldMatrix",value:function unfreezeWorldMatrix(){this._isWorldMatrixFrozen=false;this.computeWorldMatrix(true);return this;}},{key:"isWorldMatrixFrozen",get:function get(){return this._isWorldMatrixFrozen;}},{key:"getAbsolutePosition",value:function getAbsolutePosition(){this.computeWorldMatrix();return this._absolutePosition;}},{key:"setAbsolutePosition",value:function setAbsolutePosition(absolutePosition){if(!absolutePosition){return this;}var absolutePositionX;var absolutePositionY;var absolutePositionZ;if(absolutePosition.x===void 0){if(arguments.length<3){return this;}absolutePositionX=arguments[0];absolutePositionY=arguments[1];absolutePositionZ=arguments[2];}else{absolutePositionX=absolutePosition.x;absolutePositionY=absolutePosition.y;absolutePositionZ=absolutePosition.z;}if(this.parent){var invertParentWorldMatrix=TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(invertParentWorldMatrix);Vector3.TransformCoordinatesFromFloatsToRef(absolutePositionX,absolutePositionY,absolutePositionZ,invertParentWorldMatrix,this.position);}else{this.position.x=absolutePositionX;this.position.y=absolutePositionY;this.position.z=absolutePositionZ;}this._absolutePosition.copyFrom(absolutePosition);return this;}},{key:"setPositionWithLocalVector",value:function setPositionWithLocalVector(vector3){this.computeWorldMatrix();this.position=Vector3.TransformNormal(vector3,this._localMatrix);return this;}},{key:"getPositionExpressedInLocalSpace",value:function getPositionExpressedInLocalSpace(){this.computeWorldMatrix();var invLocalWorldMatrix=TmpVectors.Matrix[0];this._localMatrix.invertToRef(invLocalWorldMatrix);return Vector3.TransformNormal(this.position,invLocalWorldMatrix);}},{key:"locallyTranslate",value:function locallyTranslate(vector3){this.computeWorldMatrix(true);this.position=Vector3.TransformCoordinates(vector3,this._localMatrix);return this;}},{key:"lookAt",value:function lookAt(targetPoint){var yawCor=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var pitchCor=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var rollCor=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var space=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Space.LOCAL;var dv=TransformNode._LookAtVectorCache;var pos=space===Space.LOCAL?this.position:this.getAbsolutePosition();targetPoint.subtractToRef(pos,dv);this.setDirection(dv,yawCor,pitchCor,rollCor);if(space===Space.WORLD&&this.parent){if(this.rotationQuaternion){var rotationMatrix=TmpVectors.Matrix[0];this.rotationQuaternion.toRotationMatrix(rotationMatrix);var parentRotationMatrix=TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(parentRotationMatrix);parentRotationMatrix.invert();rotationMatrix.multiplyToRef(parentRotationMatrix,rotationMatrix);this.rotationQuaternion.fromRotationMatrix(rotationMatrix);}else{var quaternionRotation=TmpVectors.Quaternion[0];Quaternion.FromEulerVectorToRef(this.rotation,quaternionRotation);var _rotationMatrix=TmpVectors.Matrix[0];quaternionRotation.toRotationMatrix(_rotationMatrix);var _parentRotationMatrix=TmpVectors.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(_parentRotationMatrix);_parentRotationMatrix.invert();_rotationMatrix.multiplyToRef(_parentRotationMatrix,_rotationMatrix);quaternionRotation.fromRotationMatrix(_rotationMatrix);quaternionRotation.toEulerAnglesToRef(this.rotation);}}return this;}},{key:"getDirection",value:function getDirection(localAxis){var result=Vector3.Zero();this.getDirectionToRef(localAxis,result);return result;}},{key:"getDirectionToRef",value:function getDirectionToRef(localAxis,result){Vector3.TransformNormalToRef(localAxis,this.getWorldMatrix(),result);return this;}},{key:"setDirection",value:function setDirection(localAxis){var yawCor=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var pitchCor=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var rollCor=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var yaw=-Math.atan2(localAxis.z,localAxis.x)+Math.PI/2;var len=Math.sqrt(localAxis.x*localAxis.x+localAxis.z*localAxis.z);var pitch=-Math.atan2(localAxis.y,len);if(this.rotationQuaternion){Quaternion.RotationYawPitchRollToRef(yaw+yawCor,pitch+pitchCor,rollCor,this.rotationQuaternion);}else{this.rotation.x=pitch+pitchCor;this.rotation.y=yaw+yawCor;this.rotation.z=rollCor;}return this;}},{key:"setPivotPoint",value:function setPivotPoint(point){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;if(this.getScene().getRenderId()==0){this.computeWorldMatrix(true);}var wm=this.getWorldMatrix();if(space==Space.WORLD){var tmat=TmpVectors.Matrix[0];wm.invertToRef(tmat);point=Vector3.TransformCoordinates(point,tmat);}return this.setPivotMatrix(Matrix.Translation(-point.x,-point.y,-point.z),true);}},{key:"getPivotPoint",value:function getPivotPoint(){var point=Vector3.Zero();this.getPivotPointToRef(point);return point;}},{key:"getPivotPointToRef",value:function getPivotPointToRef(result){result.x=-this._pivotMatrix.m[12];result.y=-this._pivotMatrix.m[13];result.z=-this._pivotMatrix.m[14];return this;}},{key:"getAbsolutePivotPoint",value:function getAbsolutePivotPoint(){var point=Vector3.Zero();this.getAbsolutePivotPointToRef(point);return point;}},{key:"getAbsolutePivotPointToRef",value:function getAbsolutePivotPointToRef(result){this.getPivotPointToRef(result);Vector3.TransformCoordinatesToRef(result,this.getWorldMatrix(),result);return this;}},{key:"markAsDirty",value:function markAsDirty(property){if(this._isDirty){return this;}if(this._children){var _iterator94=_createForOfIteratorHelper(this._children),_step103;try{for(_iterator94.s();!(_step103=_iterator94.n()).done;){var child=_step103.value;child.markAsDirty(property);}}catch(err){_iterator94.e(err);}finally{_iterator94.f();}}return _get(_getPrototypeOf(TransformNode.prototype),"markAsDirty",this).call(this,property);}},{key:"setParent",value:function setParent(node){var preserveScalingSign=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var updatePivot=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!node&&!this.parent){return this;}var quatRotation=TmpVectors.Quaternion[0];var position=TmpVectors.Vector3[0];var scale=TmpVectors.Vector3[1];var invParentMatrix=TmpVectors.Matrix[1];Matrix.IdentityToRef(invParentMatrix);var composedMatrix=TmpVectors.Matrix[0];this.computeWorldMatrix(true);var currentRotation=this.rotationQuaternion;if(!currentRotation){currentRotation=TransformNode._TmpRotation;Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,currentRotation);}Matrix.ComposeToRef(this.scaling,currentRotation,this.position,composedMatrix);if(this.parent){composedMatrix.multiplyToRef(this.parent.computeWorldMatrix(true),composedMatrix);}if(node){node.computeWorldMatrix(true).invertToRef(invParentMatrix);composedMatrix.multiplyToRef(invParentMatrix,composedMatrix);}composedMatrix.decompose(scale,quatRotation,position,preserveScalingSign?this:void 0);if(this.rotationQuaternion){this.rotationQuaternion.copyFrom(quatRotation);}else{quatRotation.toEulerAnglesToRef(this.rotation);}this.scaling.copyFrom(scale);this.position.copyFrom(position);this.parent=node;if(updatePivot){this.setPivotMatrix(Matrix.Identity());}return this;}},{key:"nonUniformScaling",get:function get(){return this._nonUniformScaling;}},{key:"_updateNonUniformScalingState",value:function _updateNonUniformScalingState(value){if(this._nonUniformScaling===value){return false;}this._nonUniformScaling=value;return true;}},{key:"attachToBone",value:function attachToBone(bone,affectedTransformNode){this._currentParentWhenAttachingToBone=this.parent;this._transformToBoneReferal=affectedTransformNode;this.parent=bone;bone.getSkeleton().prepare();if(bone.getWorldMatrix().determinant()<0){this.scalingDeterminant*=-1;}return this;}},{key:"detachFromBone",value:function detachFromBone(){var resetToPreviousParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.parent){if(resetToPreviousParent){this.parent=this._currentParentWhenAttachingToBone;}return this;}if(this.parent.getWorldMatrix().determinant()<0){this.scalingDeterminant*=-1;}this._transformToBoneReferal=null;if(resetToPreviousParent){this.parent=this._currentParentWhenAttachingToBone;}else{this.parent=null;}return this;}},{key:"rotate",value:function rotate(axis,amount,space){axis.normalize();if(!this.rotationQuaternion){this.rotationQuaternion=this.rotation.toQuaternion();this.rotation.setAll(0);}var rotationQuaternion;if(!space||space===Space.LOCAL){rotationQuaternion=Quaternion.RotationAxisToRef(axis,amount,TransformNode._RotationAxisCache);this.rotationQuaternion.multiplyToRef(rotationQuaternion,this.rotationQuaternion);}else{if(this.parent){var invertParentWorldMatrix=TmpVectors.Matrix[0];this.parent.getWorldMatrix().invertToRef(invertParentWorldMatrix);axis=Vector3.TransformNormal(axis,invertParentWorldMatrix);}rotationQuaternion=Quaternion.RotationAxisToRef(axis,amount,TransformNode._RotationAxisCache);rotationQuaternion.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion);}return this;}},{key:"rotateAround",value:function rotateAround(point,axis,amount){axis.normalize();if(!this.rotationQuaternion){this.rotationQuaternion=Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);this.rotation.setAll(0);}var tmpVector=TmpVectors.Vector3[0];var finalScale=TmpVectors.Vector3[1];var finalTranslation=TmpVectors.Vector3[2];var finalRotation=TmpVectors.Quaternion[0];var translationMatrix=TmpVectors.Matrix[0];var translationMatrixInv=TmpVectors.Matrix[1];var rotationMatrix=TmpVectors.Matrix[2];var finalMatrix=TmpVectors.Matrix[3];point.subtractToRef(this.position,tmpVector);Matrix.TranslationToRef(tmpVector.x,tmpVector.y,tmpVector.z,translationMatrix);Matrix.TranslationToRef(-tmpVector.x,-tmpVector.y,-tmpVector.z,translationMatrixInv);Matrix.RotationAxisToRef(axis,amount,rotationMatrix);translationMatrixInv.multiplyToRef(rotationMatrix,finalMatrix);finalMatrix.multiplyToRef(translationMatrix,finalMatrix);finalMatrix.decompose(finalScale,finalRotation,finalTranslation);this.position.addInPlace(finalTranslation);finalRotation.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion);return this;}},{key:"translate",value:function translate(axis,distance,space){var displacementVector=axis.scale(distance);if(!space||space===Space.LOCAL){var tempV3=this.getPositionExpressedInLocalSpace().add(displacementVector);this.setPositionWithLocalVector(tempV3);}else{this.setAbsolutePosition(this.getAbsolutePosition().add(displacementVector));}return this;}},{key:"addRotation",value:function addRotation(x,y,z){var rotationQuaternion;if(this.rotationQuaternion){rotationQuaternion=this.rotationQuaternion;}else{rotationQuaternion=TmpVectors.Quaternion[1];Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,rotationQuaternion);}var accumulation=TmpVectors.Quaternion[0];Quaternion.RotationYawPitchRollToRef(y,x,z,accumulation);rotationQuaternion.multiplyInPlace(accumulation);if(!this.rotationQuaternion){rotationQuaternion.toEulerAnglesToRef(this.rotation);}return this;}},{key:"_getEffectiveParent",value:function _getEffectiveParent(){return this.parent;}},{key:"isWorldMatrixCameraDependent",value:function isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==TransformNode.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;}},{key:"computeWorldMatrix",value:function computeWorldMatrix(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var camera=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty){return this._worldMatrix;}var currentRenderId=this.getScene().getRenderId();if(!this._isDirty&&!force&&(this._currentRenderId===currentRenderId||this.isSynchronized())){this._currentRenderId=currentRenderId;return this._worldMatrix;}camera=camera||this.getScene().activeCamera;this._updateCache();var cache=this._cache;cache.pivotMatrixUpdated=false;cache.billboardMode=this.billboardMode;cache.infiniteDistance=this.infiniteDistance;cache.parent=this._parentNode;this._currentRenderId=currentRenderId;this._childUpdateId+=1;this._isDirty=false;this._position._isDirty=false;this._rotation._isDirty=false;this._scaling._isDirty=false;var parent=this._getEffectiveParent();var scaling=TransformNode._TmpScaling;var translation=this._position;if(this._infiniteDistance){if(!this.parent&&camera){var cameraWorldMatrix=camera.getWorldMatrix();var cameraGlobalPosition=new Vector3(cameraWorldMatrix.m[12],cameraWorldMatrix.m[13],cameraWorldMatrix.m[14]);translation=TransformNode._TmpTranslation;translation.copyFromFloats(this._position.x+cameraGlobalPosition.x,this._position.y+cameraGlobalPosition.y,this._position.z+cameraGlobalPosition.z);}}scaling.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var rotation;if(this._rotationQuaternion){this._rotationQuaternion._isDirty=false;rotation=this._rotationQuaternion;if(this.reIntegrateRotationIntoRotationQuaternion){var len=this.rotation.lengthSquared();if(len){this._rotationQuaternion.multiplyInPlace(Quaternion.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z));this._rotation.copyFromFloats(0,0,0);}}}else{rotation=TransformNode._TmpRotation;Quaternion.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,rotation);}if(this._usePivotMatrix){var scaleMatrix=TmpVectors.Matrix[1];Matrix.ScalingToRef(scaling.x,scaling.y,scaling.z,scaleMatrix);var rotationMatrix=TmpVectors.Matrix[0];rotation.toRotationMatrix(rotationMatrix);this._pivotMatrix.multiplyToRef(scaleMatrix,TmpVectors.Matrix[4]);TmpVectors.Matrix[4].multiplyToRef(rotationMatrix,this._localMatrix);if(this._postMultiplyPivotMatrix){this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix);}this._localMatrix.addTranslationFromFloats(translation.x,translation.y,translation.z);}else{Matrix.ComposeToRef(scaling,rotation,translation,this._localMatrix);}if(parent&&parent.getWorldMatrix){if(force){parent.computeWorldMatrix(force);}if(cache.useBillboardPath){if(this._transformToBoneReferal){parent.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),TmpVectors.Matrix[7]);}else{TmpVectors.Matrix[7].copyFrom(parent.getWorldMatrix());}var translation2=TmpVectors.Vector3[5];var scale=TmpVectors.Vector3[6];var orientation=TmpVectors.Quaternion[0];TmpVectors.Matrix[7].decompose(scale,orientation,translation2);Matrix.ScalingToRef(scale.x,scale.y,scale.z,TmpVectors.Matrix[7]);TmpVectors.Matrix[7].setTranslation(translation2);if(TransformNode.BillboardUseParentOrientation){this._position.applyRotationQuaternionToRef(orientation,translation2);this._localMatrix.setTranslation(translation2);}this._localMatrix.multiplyToRef(TmpVectors.Matrix[7],this._worldMatrix);}else{if(this._transformToBoneReferal){this._localMatrix.multiplyToRef(parent.getWorldMatrix(),TmpVectors.Matrix[6]);TmpVectors.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix);}else{this._localMatrix.multiplyToRef(parent.getWorldMatrix(),this._worldMatrix);}}this._markSyncedWithParent();}else{this._worldMatrix.copyFrom(this._localMatrix);}if(cache.useBillboardPath&&camera&&this.billboardMode&&!cache.useBillboardPosition){var storedTranslation=TmpVectors.Vector3[0];this._worldMatrix.getTranslationToRef(storedTranslation);TmpVectors.Matrix[1].copyFrom(camera.getViewMatrix());TmpVectors.Matrix[1].setTranslationFromFloats(0,0,0);TmpVectors.Matrix[1].invertToRef(TmpVectors.Matrix[0]);if((this.billboardMode&TransformNode.BILLBOARDMODE_ALL)!==TransformNode.BILLBOARDMODE_ALL){TmpVectors.Matrix[0].decompose(void 0,TmpVectors.Quaternion[0],void 0);var eulerAngles=TmpVectors.Vector3[1];TmpVectors.Quaternion[0].toEulerAnglesToRef(eulerAngles);if((this.billboardMode&TransformNode.BILLBOARDMODE_X)!==TransformNode.BILLBOARDMODE_X){eulerAngles.x=0;}if((this.billboardMode&TransformNode.BILLBOARDMODE_Y)!==TransformNode.BILLBOARDMODE_Y){eulerAngles.y=0;}if((this.billboardMode&TransformNode.BILLBOARDMODE_Z)!==TransformNode.BILLBOARDMODE_Z){eulerAngles.z=0;}Matrix.RotationYawPitchRollToRef(eulerAngles.y,eulerAngles.x,eulerAngles.z,TmpVectors.Matrix[0]);}this._worldMatrix.setTranslationFromFloats(0,0,0);this._worldMatrix.multiplyToRef(TmpVectors.Matrix[0],this._worldMatrix);this._worldMatrix.setTranslation(TmpVectors.Vector3[0]);}else if(cache.useBillboardPath&&camera&&cache.useBillboardPosition){var _storedTranslation=TmpVectors.Vector3[0];this._worldMatrix.getTranslationToRef(_storedTranslation);var cameraPosition=camera.globalPosition;this._worldMatrix.invertToRef(TmpVectors.Matrix[1]);var camInObjSpace=TmpVectors.Vector3[1];Vector3.TransformCoordinatesToRef(cameraPosition,TmpVectors.Matrix[1],camInObjSpace);camInObjSpace.normalize();var yaw=-Math.atan2(camInObjSpace.z,camInObjSpace.x)+Math.PI/2;var _len10=Math.sqrt(camInObjSpace.x*camInObjSpace.x+camInObjSpace.z*camInObjSpace.z);var pitch=-Math.atan2(camInObjSpace.y,_len10);Quaternion.RotationYawPitchRollToRef(yaw,pitch,0,TmpVectors.Quaternion[0]);if((this.billboardMode&TransformNode.BILLBOARDMODE_ALL)!==TransformNode.BILLBOARDMODE_ALL){var _eulerAngles=TmpVectors.Vector3[1];TmpVectors.Quaternion[0].toEulerAnglesToRef(_eulerAngles);if((this.billboardMode&TransformNode.BILLBOARDMODE_X)!==TransformNode.BILLBOARDMODE_X){_eulerAngles.x=0;}if((this.billboardMode&TransformNode.BILLBOARDMODE_Y)!==TransformNode.BILLBOARDMODE_Y){_eulerAngles.y=0;}if((this.billboardMode&TransformNode.BILLBOARDMODE_Z)!==TransformNode.BILLBOARDMODE_Z){_eulerAngles.z=0;}Matrix.RotationYawPitchRollToRef(_eulerAngles.y,_eulerAngles.x,_eulerAngles.z,TmpVectors.Matrix[0]);}else{Matrix.FromQuaternionToRef(TmpVectors.Quaternion[0],TmpVectors.Matrix[0]);}this._worldMatrix.setTranslationFromFloats(0,0,0);this._worldMatrix.multiplyToRef(TmpVectors.Matrix[0],this._worldMatrix);this._worldMatrix.setTranslation(TmpVectors.Vector3[0]);}if(!this.ignoreNonUniformScaling){if(this._scaling.isNonUniformWithinEpsilon(1e-6)){this._updateNonUniformScalingState(true);}else if(parent&&parent._nonUniformScaling){this._updateNonUniformScalingState(parent._nonUniformScaling);}else{this._updateNonUniformScalingState(false);}}else{this._updateNonUniformScalingState(false);}this._afterComputeWorldMatrix();this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]);this._isAbsoluteSynced=false;this.onAfterWorldMatrixUpdateObservable.notifyObservers(this);if(!this._poseMatrix){this._poseMatrix=Matrix.Invert(this._worldMatrix);}this._worldMatrixDeterminantIsDirty=true;return this._worldMatrix;}},{key:"resetLocalMatrix",value:function resetLocalMatrix(){var independentOfChildren=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.computeWorldMatrix();if(independentOfChildren){var children=this.getChildren();for(var i=0;i<children.length;++i){var child=children[i];if(child){child.computeWorldMatrix();var bakedMatrix=TmpVectors.Matrix[0];child._localMatrix.multiplyToRef(this._localMatrix,bakedMatrix);var tmpRotationQuaternion=TmpVectors.Quaternion[0];bakedMatrix.decompose(child.scaling,tmpRotationQuaternion,child.position);if(child.rotationQuaternion){child.rotationQuaternion.copyFrom(tmpRotationQuaternion);}else{tmpRotationQuaternion.toEulerAnglesToRef(child.rotation);}}}}this.scaling.copyFromFloats(1,1,1);this.position.copyFromFloats(0,0,0);this.rotation.copyFromFloats(0,0,0);if(this.rotationQuaternion){this.rotationQuaternion=Quaternion.Identity();}this._worldMatrix=Matrix.Identity();}},{key:"_afterComputeWorldMatrix",value:function _afterComputeWorldMatrix(){}},{key:"registerAfterWorldMatrixUpdate",value:function registerAfterWorldMatrixUpdate(func){this.onAfterWorldMatrixUpdateObservable.add(func);return this;}},{key:"unregisterAfterWorldMatrixUpdate",value:function unregisterAfterWorldMatrixUpdate(func){this.onAfterWorldMatrixUpdateObservable.removeCallback(func);return this;}},{key:"getPositionInCameraSpace",value:function getPositionInCameraSpace(){var camera=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!camera){camera=this.getScene().activeCamera;}return Vector3.TransformCoordinates(this.getAbsolutePosition(),camera.getViewMatrix());}},{key:"getDistanceToCamera",value:function getDistanceToCamera(){var camera=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;if(!camera){camera=this.getScene().activeCamera;}return this.getAbsolutePosition().subtract(camera.globalPosition).length();}},{key:"clone",value:function clone(name135,newParent,doNotCloneChildren){var _this76=this;var result=SerializationHelper.Clone(function(){return new TransformNode(name135,_this76.getScene());},this);result.name=name135;result.id=name135;if(newParent){result.parent=newParent;}if(!doNotCloneChildren){var directDescendants=this.getDescendants(true);for(var index=0;index<directDescendants.length;index++){var child=directDescendants[index];if(child.clone){child.clone(name135+"."+child.name,result);}}}return result;}},{key:"serialize",value:function serialize(currentSerializationObject){var serializationObject=SerializationHelper.Serialize(this,currentSerializationObject);serializationObject.type=this.getClassName();serializationObject.uniqueId=this.uniqueId;if(this.parent){this.parent._serializeAsParent(serializationObject);}serializationObject.localMatrix=this.getPivotMatrix().asArray();serializationObject.isEnabled=this.isEnabled();return serializationObject;}},{key:"getChildTransformNodes",value:function getChildTransformNodes(directDescendantsOnly,predicate){var results=[];this._getDescendants(results,directDescendantsOnly,function(node){return(!predicate||predicate(node))&&node instanceof TransformNode;});return results;}},{key:"dispose",value:function dispose(doNotRecurse){var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.getScene().stopAnimation(this);this.getScene().removeTransformNode(this);if(this._parentContainer){var index=this._parentContainer.transformNodes.indexOf(this);if(index>-1){this._parentContainer.transformNodes.splice(index,1);}this._parentContainer=null;}this.onAfterWorldMatrixUpdateObservable.clear();if(doNotRecurse){var transformNodes=this.getChildTransformNodes(true);var _iterator95=_createForOfIteratorHelper(transformNodes),_step104;try{for(_iterator95.s();!(_step104=_iterator95.n()).done;){var transformNode=_step104.value;transformNode.parent=null;transformNode.computeWorldMatrix(true);}}catch(err){_iterator95.e(err);}finally{_iterator95.f();}}_get(_getPrototypeOf(TransformNode.prototype),"dispose",this).call(this,doNotRecurse,disposeMaterialAndTextures);}},{key:"normalizeToUnitCube",value:function normalizeToUnitCube(){var includeDescendants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var ignoreRotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var predicate=arguments.length>2?arguments[2]:undefined;var storedRotation=null;var storedRotationQuaternion=null;if(ignoreRotation){if(this.rotationQuaternion){storedRotationQuaternion=this.rotationQuaternion.clone();this.rotationQuaternion.copyFromFloats(0,0,0,1);}else if(this.rotation){storedRotation=this.rotation.clone();this.rotation.copyFromFloats(0,0,0);}}var boundingVectors=this.getHierarchyBoundingVectors(includeDescendants,predicate);var sizeVec=boundingVectors.max.subtract(boundingVectors.min);var maxDimension=Math.max(sizeVec.x,sizeVec.y,sizeVec.z);if(maxDimension===0){return this;}var scale=1/maxDimension;this.scaling.scaleInPlace(scale);if(ignoreRotation){if(this.rotationQuaternion&&storedRotationQuaternion){this.rotationQuaternion.copyFrom(storedRotationQuaternion);}else if(this.rotation&&storedRotation){this.rotation.copyFrom(storedRotation);}}return this;}},{key:"_syncAbsoluteScalingAndRotation",value:function _syncAbsoluteScalingAndRotation(){if(!this._isAbsoluteSynced){this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion);this._isAbsoluteSynced=true;}}}],[{key:"Parse",value:function Parse(parsedTransformNode,scene2,rootUrl){var transformNode=SerializationHelper.Parse(function(){return new TransformNode(parsedTransformNode.name,scene2);},parsedTransformNode,scene2,rootUrl);if(parsedTransformNode.localMatrix){transformNode.setPreTransformMatrix(Matrix.FromArray(parsedTransformNode.localMatrix));}else if(parsedTransformNode.pivotMatrix){transformNode.setPivotMatrix(Matrix.FromArray(parsedTransformNode.pivotMatrix));}transformNode.setEnabled(parsedTransformNode.isEnabled);transformNode._waitingParsedUniqueId=parsedTransformNode.uniqueId;if(parsedTransformNode.parentId!==void 0){transformNode._waitingParentId=parsedTransformNode.parentId;}if(parsedTransformNode.parentInstanceIndex!==void 0){transformNode._waitingParentInstanceIndex=parsedTransformNode.parentInstanceIndex;}return transformNode;}}]);return TransformNode;}(Node);TransformNode.BILLBOARDMODE_NONE=0;TransformNode.BILLBOARDMODE_X=1;TransformNode.BILLBOARDMODE_Y=2;TransformNode.BILLBOARDMODE_Z=4;TransformNode.BILLBOARDMODE_ALL=7;TransformNode.BILLBOARDMODE_USE_POSITION=128;TransformNode.BillboardUseParentOrientation=false;TransformNode._TmpRotation=Quaternion.Zero();TransformNode._TmpScaling=Vector3.Zero();TransformNode._TmpTranslation=Vector3.Zero();TransformNode._LookAtVectorCache=new Vector3(0,0,0);TransformNode._RotationAxisCache=new Quaternion();__decorate([serializeAsVector3("position")],TransformNode.prototype,"_position",void 0);__decorate([serializeAsVector3("rotation")],TransformNode.prototype,"_rotation",void 0);__decorate([serializeAsQuaternion("rotationQuaternion")],TransformNode.prototype,"_rotationQuaternion",void 0);__decorate([serializeAsVector3("scaling")],TransformNode.prototype,"_scaling",void 0);__decorate([serialize("billboardMode")],TransformNode.prototype,"_billboardMode",void 0);__decorate([serialize()],TransformNode.prototype,"scalingDeterminant",void 0);__decorate([serialize("infiniteDistance")],TransformNode.prototype,"_infiniteDistance",void 0);__decorate([serialize()],TransformNode.prototype,"ignoreNonUniformScaling",void 0);__decorate([serialize()],TransformNode.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0);// node_modules/@babylonjs/core/Collisions/meshCollisionData.js
var _MeshCollisionData=/*#__PURE__*/_createClass(function _MeshCollisionData(){_classCallCheck(this,_MeshCollisionData);this._checkCollisions=false;this._collisionMask=-1;this._collisionGroup=-1;this._surroundingMeshes=null;this._collider=null;this._oldPositionForCollisions=new Vector3(0,0,0);this._diffPositionForCollisions=new Vector3(0,0,0);this._collisionResponse=true;});// node_modules/@babylonjs/core/Meshes/abstractMesh.js
var _FacetDataStorage=/*#__PURE__*/_createClass(function _FacetDataStorage(){_classCallCheck(this,_FacetDataStorage);this.facetNb=0;this.partitioningSubdivisions=10;this.partitioningBBoxRatio=1.01;this.facetDataEnabled=false;this.facetParameters={};this.bbSize=Vector3.Zero();this.subDiv={max:1,X:1,Y:1,Z:1};this.facetDepthSort=false;this.facetDepthSortEnabled=false;});var _InternalAbstractMeshDataInfo=/*#__PURE__*/_createClass(function _InternalAbstractMeshDataInfo(){_classCallCheck(this,_InternalAbstractMeshDataInfo);this._hasVertexAlpha=false;this._useVertexColors=true;this._numBoneInfluencers=4;this._applyFog=true;this._receiveShadows=false;this._facetData=new _FacetDataStorage();this._visibility=1;this._skeleton=null;this._layerMask=268435455;this._computeBonesUsingShaders=true;this._isActive=false;this._onlyForInstances=false;this._isActiveIntermediate=false;this._onlyForInstancesIntermediate=false;this._actAsRegularMesh=false;this._currentLOD=null;this._currentLODIsUpToDate=false;this._collisionRetryCount=3;this._morphTargetManager=null;this._renderingGroupId=0;this._bakedVertexAnimationManager=null;this._material=null;this._positions=null;this._pointerOverDisableMeshTesting=false;this._meshCollisionData=new _MeshCollisionData();this._enableDistantPicking=false;});var AbstractMesh=/*#__PURE__*/function(_TransformNode){_inherits(AbstractMesh,_TransformNode);var _super23=_createSuper(AbstractMesh);function AbstractMesh(name135){var _this77;var scene2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,AbstractMesh);_this77=_super23.call(this,name135,scene2,false);_this77._internalAbstractMeshDataInfo=new _InternalAbstractMeshDataInfo();_this77._waitingMaterialId=null;_this77.cullingStrategy=AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY;_this77.onCollideObservable=new Observable();_this77.onCollisionPositionChangeObservable=new Observable();_this77.onMaterialChangedObservable=new Observable();_this77.definedFacingForward=true;_this77._occlusionQuery=null;_this77._renderingGroup=null;_this77.alphaIndex=Number.MAX_VALUE;_this77.isVisible=true;_this77.isPickable=true;_this77.isNearPickable=false;_this77.isNearGrabbable=false;_this77.showSubMeshesBoundingBox=false;_this77.isBlocker=false;_this77.enablePointerMoveEvents=false;_this77.outlineColor=Color3.Red();_this77.outlineWidth=0.02;_this77.overlayColor=Color3.Red();_this77.overlayAlpha=0.5;_this77.useOctreeForRenderingSelection=true;_this77.useOctreeForPicking=true;_this77.useOctreeForCollisions=true;_this77.alwaysSelectAsActiveMesh=false;_this77.doNotSyncBoundingInfo=false;_this77.actionManager=null;_this77.ellipsoid=new Vector3(0.5,1,0.5);_this77.ellipsoidOffset=new Vector3(0,0,0);_this77.edgesWidth=1;_this77.edgesColor=new Color4(1,0,0,1);_this77._edgesRenderer=null;_this77._masterMesh=null;_this77._boundingInfo=null;_this77._boundingInfoIsDirty=true;_this77._renderId=0;_this77._intersectionsInProgress=new Array();_this77._unIndexed=false;_this77._lightSources=new Array();_this77._waitingData={lods:null,actions:null,freezeWorldMatrix:null};_this77._bonesTransformMatrices=null;_this77._transformMatrixTexture=null;_this77.onRebuildObservable=new Observable();_this77._onCollisionPositionChange=function(collisionId,newPosition){var collidedMesh=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;newPosition.subtractToRef(_this77._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,_this77._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions);if(_this77._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Engine.CollisionsEpsilon){_this77.position.addInPlace(_this77._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions);}if(collidedMesh){_this77.onCollideObservable.notifyObservers(collidedMesh);}_this77.onCollisionPositionChangeObservable.notifyObservers(_this77.position);};scene2=_this77.getScene();scene2.addMesh(_assertThisInitialized(_this77));_this77._resyncLightSources();_this77._uniformBuffer=new UniformBuffer(_this77.getScene().getEngine(),void 0,void 0,name135,!_this77.getScene().getEngine().isWebGPU);_this77._buildUniformLayout();switch(scene2.performancePriority){case ScenePerformancePriority.Aggressive:_this77.doNotSyncBoundingInfo=true;case ScenePerformancePriority.Intermediate:_this77.alwaysSelectAsActiveMesh=true;_this77.isPickable=false;break;}return _this77;}_createClass(AbstractMesh,[{key:"facetNb",get:function get(){return this._internalAbstractMeshDataInfo._facetData.facetNb;}},{key:"partitioningSubdivisions",get:function get(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions;},set:function set(nb){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=nb;}},{key:"partitioningBBoxRatio",get:function get(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio;},set:function set(ratio){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=ratio;}},{key:"mustDepthSortFacets",get:function get(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort;},set:function set(sort){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=sort;}},{key:"facetDepthSortFrom",get:function get(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom;},set:function set(location2){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=location2;}},{key:"collisionRetryCount",get:function get(){return this._internalAbstractMeshDataInfo._collisionRetryCount;},set:function set(retryCount){this._internalAbstractMeshDataInfo._collisionRetryCount=retryCount;}},{key:"isFacetDataEnabled",get:function get(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled;}},{key:"morphTargetManager",get:function get(){return this._internalAbstractMeshDataInfo._morphTargetManager;},set:function set(value){if(this._internalAbstractMeshDataInfo._morphTargetManager===value){return;}this._internalAbstractMeshDataInfo._morphTargetManager=value;this._syncGeometryWithMorphTargetManager();}},{key:"bakedVertexAnimationManager",get:function get(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager;},set:function set(value){if(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager===value){return;}this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=value;this._markSubMeshesAsAttributesDirty();}},{key:"_syncGeometryWithMorphTargetManager",value:function _syncGeometryWithMorphTargetManager(){}},{key:"_updateNonUniformScalingState",value:function _updateNonUniformScalingState(value){if(!_get(_getPrototypeOf(AbstractMesh.prototype),"_updateNonUniformScalingState",this).call(this,value)){return false;}this._markSubMeshesAsMiscDirty();return true;}},{key:"onCollide",set:function set(callback){if(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver){this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver);}this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(callback);}},{key:"onCollisionPositionChange",set:function set(callback){if(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver){this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver);}this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(callback);}},{key:"visibility",get:function get(){return this._internalAbstractMeshDataInfo._visibility;},set:function set(value){if(this._internalAbstractMeshDataInfo._visibility===value){return;}var oldValue=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=value;if(oldValue===1&&value!==1||oldValue!==1&&value===1){this._markSubMeshesAsMiscDirty();}}},{key:"pointerOverDisableMeshTesting",get:function get(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting;},set:function set(disable){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=disable;}},{key:"renderingGroupId",get:function get(){return this._internalAbstractMeshDataInfo._renderingGroupId;},set:function set(value){this._internalAbstractMeshDataInfo._renderingGroupId=value;}},{key:"material",get:function get(){return this._internalAbstractMeshDataInfo._material;},set:function set(value){if(this._internalAbstractMeshDataInfo._material===value){return;}if(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap){this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0;}this._internalAbstractMeshDataInfo._material=value;if(value&&value.meshMap){value.meshMap[this.uniqueId]=this;}if(this.onMaterialChangedObservable.hasObservers()){this.onMaterialChangedObservable.notifyObservers(this);}if(!this.subMeshes){return;}this.resetDrawCache();this._unBindEffect();}},{key:"getMaterialForRenderPass",value:function getMaterialForRenderPass(renderPassId){var _a;return(_a=this._internalAbstractMeshDataInfo._materialForRenderPass)===null||_a===void 0?void 0:_a[renderPassId];}},{key:"setMaterialForRenderPass",value:function setMaterialForRenderPass(renderPassId,material){this.resetDrawCache(renderPassId);if(!this._internalAbstractMeshDataInfo._materialForRenderPass){this._internalAbstractMeshDataInfo._materialForRenderPass=[];}this._internalAbstractMeshDataInfo._materialForRenderPass[renderPassId]=material;}},{key:"receiveShadows",get:function get(){return this._internalAbstractMeshDataInfo._receiveShadows;},set:function set(value){if(this._internalAbstractMeshDataInfo._receiveShadows===value){return;}this._internalAbstractMeshDataInfo._receiveShadows=value;this._markSubMeshesAsLightDirty();}},{key:"hasVertexAlpha",get:function get(){return this._internalAbstractMeshDataInfo._hasVertexAlpha;},set:function set(value){if(this._internalAbstractMeshDataInfo._hasVertexAlpha===value){return;}this._internalAbstractMeshDataInfo._hasVertexAlpha=value;this._markSubMeshesAsAttributesDirty();this._markSubMeshesAsMiscDirty();}},{key:"useVertexColors",get:function get(){return this._internalAbstractMeshDataInfo._useVertexColors;},set:function set(value){if(this._internalAbstractMeshDataInfo._useVertexColors===value){return;}this._internalAbstractMeshDataInfo._useVertexColors=value;this._markSubMeshesAsAttributesDirty();}},{key:"computeBonesUsingShaders",get:function get(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders;},set:function set(value){if(this._internalAbstractMeshDataInfo._computeBonesUsingShaders===value){return;}this._internalAbstractMeshDataInfo._computeBonesUsingShaders=value;this._markSubMeshesAsAttributesDirty();}},{key:"numBoneInfluencers",get:function get(){return this._internalAbstractMeshDataInfo._numBoneInfluencers;},set:function set(value){if(this._internalAbstractMeshDataInfo._numBoneInfluencers===value){return;}this._internalAbstractMeshDataInfo._numBoneInfluencers=value;this._markSubMeshesAsAttributesDirty();}},{key:"applyFog",get:function get(){return this._internalAbstractMeshDataInfo._applyFog;},set:function set(value){if(this._internalAbstractMeshDataInfo._applyFog===value){return;}this._internalAbstractMeshDataInfo._applyFog=value;this._markSubMeshesAsMiscDirty();}},{key:"enableDistantPicking",get:function get(){return this._internalAbstractMeshDataInfo._enableDistantPicking;},set:function set(value){this._internalAbstractMeshDataInfo._enableDistantPicking=value;}},{key:"layerMask",get:function get(){return this._internalAbstractMeshDataInfo._layerMask;},set:function set(value){if(value===this._internalAbstractMeshDataInfo._layerMask){return;}this._internalAbstractMeshDataInfo._layerMask=value;this._resyncLightSources();}},{key:"collisionMask",get:function get(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask;},set:function set(mask){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=!isNaN(mask)?mask:-1;}},{key:"collisionResponse",get:function get(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse;},set:function set(response){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=response;}},{key:"collisionGroup",get:function get(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup;},set:function set(mask){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=!isNaN(mask)?mask:-1;}},{key:"surroundingMeshes",get:function get(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes;},set:function set(meshes){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=meshes;}},{key:"lightSources",get:function get(){return this._lightSources;}},{key:"_positions",get:function get(){return null;}},{key:"skeleton",get:function get(){return this._internalAbstractMeshDataInfo._skeleton;},set:function set(value){var skeleton=this._internalAbstractMeshDataInfo._skeleton;if(skeleton&&skeleton.needInitialSkinMatrix){skeleton._unregisterMeshWithPoseMatrix(this);}if(value&&value.needInitialSkinMatrix){value._registerMeshWithPoseMatrix(this);}this._internalAbstractMeshDataInfo._skeleton=value;if(!this._internalAbstractMeshDataInfo._skeleton){this._bonesTransformMatrices=null;}this._markSubMeshesAsAttributesDirty();}},{key:"_buildUniformLayout",value:function _buildUniformLayout(){this._uniformBuffer.addUniform("world",16);this._uniformBuffer.addUniform("visibility",1);this._uniformBuffer.create();}},{key:"transferToEffect",value:function transferToEffect(world){var ubo=this._uniformBuffer;ubo.updateMatrix("world",world);ubo.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility);ubo.update();}},{key:"getMeshUniformBuffer",value:function getMeshUniformBuffer(){return this._uniformBuffer;}},{key:"getClassName",value:function getClassName(){return"AbstractMesh";}},{key:"toString",value:function toString(fullDetails){var ret="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");ret+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var skeleton=this._internalAbstractMeshDataInfo._skeleton;if(skeleton){ret+=", skeleton: "+skeleton.name;}if(fullDetails){ret+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode];ret+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO");}return ret;}},{key:"_getEffectiveParent",value:function _getEffectiveParent(){if(this._masterMesh&&this.billboardMode!==TransformNode.BILLBOARDMODE_NONE){return this._masterMesh;}return _get(_getPrototypeOf(AbstractMesh.prototype),"_getEffectiveParent",this).call(this);}},{key:"_getActionManagerForTrigger",value:function _getActionManagerForTrigger(trigger){var initialCall=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this.actionManager&&(initialCall||this.actionManager.isRecursive)){if(trigger){if(this.actionManager.hasSpecificTrigger(trigger)){return this.actionManager;}}else{return this.actionManager;}}if(!this.parent){return null;}return this.parent._getActionManagerForTrigger(trigger,false);}},{key:"_rebuild",value:function _rebuild(){var dispose=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.onRebuildObservable.notifyObservers(this);if(this._occlusionQuery!==null){this._occlusionQuery=null;}if(!this.subMeshes){return;}var _iterator96=_createForOfIteratorHelper(this.subMeshes),_step105;try{for(_iterator96.s();!(_step105=_iterator96.n()).done;){var subMesh=_step105.value;subMesh._rebuild();}}catch(err){_iterator96.e(err);}finally{_iterator96.f();}}},{key:"_resyncLightSources",value:function _resyncLightSources(){this._lightSources.length=0;var _iterator97=_createForOfIteratorHelper(this.getScene().lights),_step106;try{for(_iterator97.s();!(_step106=_iterator97.n()).done;){var light=_step106.value;if(!light.isEnabled()){continue;}if(light.canAffectMesh(this)){this._lightSources.push(light);}}}catch(err){_iterator97.e(err);}finally{_iterator97.f();}this._markSubMeshesAsLightDirty();}},{key:"_resyncLightSource",value:function _resyncLightSource(light){var isIn=light.isEnabled()&&light.canAffectMesh(this);var index=this._lightSources.indexOf(light);var removed=false;if(index===-1){if(!isIn){return;}this._lightSources.push(light);}else{if(isIn){return;}removed=true;this._lightSources.splice(index,1);}this._markSubMeshesAsLightDirty(removed);}},{key:"_unBindEffect",value:function _unBindEffect(){var _iterator98=_createForOfIteratorHelper(this.subMeshes),_step107;try{for(_iterator98.s();!(_step107=_iterator98.n()).done;){var subMesh=_step107.value;subMesh.setEffect(null);}}catch(err){_iterator98.e(err);}finally{_iterator98.f();}}},{key:"_removeLightSource",value:function _removeLightSource(light,dispose){var index=this._lightSources.indexOf(light);if(index===-1){return;}this._lightSources.splice(index,1);this._markSubMeshesAsLightDirty(dispose);}},{key:"_markSubMeshesAsDirty",value:function _markSubMeshesAsDirty(func){if(!this.subMeshes){return;}var _iterator99=_createForOfIteratorHelper(this.subMeshes),_step108;try{for(_iterator99.s();!(_step108=_iterator99.n()).done;){var subMesh=_step108.value;for(var i=0;i<subMesh._drawWrappers.length;++i){var drawWrapper=subMesh._drawWrappers[i];if(!drawWrapper||!drawWrapper.defines||!drawWrapper.defines.markAllAsDirty){continue;}func(drawWrapper.defines);}}}catch(err){_iterator99.e(err);}finally{_iterator99.f();}}},{key:"_markSubMeshesAsLightDirty",value:function _markSubMeshesAsLightDirty(){var dispose=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this._markSubMeshesAsDirty(function(defines){return defines.markAsLightDirty(dispose);});}},{key:"_markSubMeshesAsAttributesDirty",value:function _markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty(function(defines){return defines.markAsAttributesDirty();});}},{key:"_markSubMeshesAsMiscDirty",value:function _markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty(function(defines){return defines.markAsMiscDirty();});}},{key:"markAsDirty",value:function markAsDirty(property){this._currentRenderId=Number.MAX_VALUE;this._isDirty=true;return this;}},{key:"resetDrawCache",value:function resetDrawCache(passId){if(!this.subMeshes){return;}var _iterator100=_createForOfIteratorHelper(this.subMeshes),_step109;try{for(_iterator100.s();!(_step109=_iterator100.n()).done;){var subMesh=_step109.value;subMesh.resetDrawCache(passId);}}catch(err){_iterator100.e(err);}finally{_iterator100.f();}}},{key:"isBlocked",get:function get(){return false;}},{key:"getLOD",value:function getLOD(camera){return this;}},{key:"getTotalVertices",value:function getTotalVertices(){return 0;}},{key:"getTotalIndices",value:function getTotalIndices(){return 0;}},{key:"getIndices",value:function getIndices(){return null;}},{key:"getVerticesData",value:function getVerticesData(kind){return null;}},{key:"setVerticesData",value:function setVerticesData(kind,data,updatable,stride){return this;}},{key:"updateVerticesData",value:function updateVerticesData(kind,data,updateExtends,makeItUnique){return this;}},{key:"setIndices",value:function setIndices(indices,totalVertices){return this;}},{key:"isVerticesDataPresent",value:function isVerticesDataPresent(kind){return false;}},{key:"getBoundingInfo",value:function getBoundingInfo(){if(this._masterMesh){return this._masterMesh.getBoundingInfo();}if(this._boundingInfoIsDirty){this._boundingInfoIsDirty=false;this._updateBoundingInfo();}return this._boundingInfo;}},{key:"setBoundingInfo",value:function setBoundingInfo(boundingInfo){this._boundingInfo=boundingInfo;return this;}},{key:"hasBoundingInfo",get:function get(){return this._boundingInfo!==null;}},{key:"buildBoundingInfo",value:function buildBoundingInfo(minimum,maximum,worldMatrix){this._boundingInfo=new BoundingInfo(minimum,maximum,worldMatrix);return this._boundingInfo;}},{key:"normalizeToUnitCube",value:function normalizeToUnitCube(){var includeDescendants=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var ignoreRotation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var predicate=arguments.length>2?arguments[2]:undefined;return _get(_getPrototypeOf(AbstractMesh.prototype),"normalizeToUnitCube",this).call(this,includeDescendants,ignoreRotation,predicate);}},{key:"useBones",get:function get(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)&&this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind);}},{key:"_preActivate",value:function _preActivate(){}},{key:"_preActivateForIntermediateRendering",value:function _preActivateForIntermediateRendering(renderId){}},{key:"_activate",value:function _activate(renderId,intermediateRendering){this._renderId=renderId;return true;}},{key:"_postActivate",value:function _postActivate(){}},{key:"_freeze",value:function _freeze(){}},{key:"_unFreeze",value:function _unFreeze(){}},{key:"getWorldMatrix",value:function getWorldMatrix(){if(this._masterMesh&&this.billboardMode===TransformNode.BILLBOARDMODE_NONE){return this._masterMesh.getWorldMatrix();}return _get(_getPrototypeOf(AbstractMesh.prototype),"getWorldMatrix",this).call(this);}},{key:"_getWorldMatrixDeterminant",value:function _getWorldMatrixDeterminant(){if(this._masterMesh){return this._masterMesh._getWorldMatrixDeterminant();}return _get(_getPrototypeOf(AbstractMesh.prototype),"_getWorldMatrixDeterminant",this).call(this);}},{key:"isAnInstance",get:function get(){return false;}},{key:"hasInstances",get:function get(){return false;}},{key:"hasThinInstances",get:function get(){return false;}},{key:"movePOV",value:function movePOV(amountRight,amountUp,amountForward){this.position.addInPlace(this.calcMovePOV(amountRight,amountUp,amountForward));return this;}},{key:"calcMovePOV",value:function calcMovePOV(amountRight,amountUp,amountForward){var rotMatrix=new Matrix();var rotQuaternion=this.rotationQuaternion?this.rotationQuaternion:Quaternion.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);rotQuaternion.toRotationMatrix(rotMatrix);var translationDelta=Vector3.Zero();var defForwardMult=this.definedFacingForward?-1:1;Vector3.TransformCoordinatesFromFloatsToRef(amountRight*defForwardMult,amountUp,amountForward*defForwardMult,rotMatrix,translationDelta);return translationDelta;}},{key:"rotatePOV",value:function rotatePOV(flipBack,twirlClockwise,tiltRight){this.rotation.addInPlace(this.calcRotatePOV(flipBack,twirlClockwise,tiltRight));return this;}},{key:"calcRotatePOV",value:function calcRotatePOV(flipBack,twirlClockwise,tiltRight){var defForwardMult=this.definedFacingForward?1:-1;return new Vector3(flipBack*defForwardMult,twirlClockwise,tiltRight*defForwardMult);}},{key:"refreshBoundingInfo",value:function refreshBoundingInfo(){var applySkeleton=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applyMorph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._boundingInfo&&this._boundingInfo.isLocked){return this;}this._refreshBoundingInfo(this._getPositionData(applySkeleton,applyMorph),null);return this;}},{key:"_refreshBoundingInfo",value:function _refreshBoundingInfo(data,bias){if(data){var extend=extractMinAndMax(data,0,this.getTotalVertices(),bias);if(this._boundingInfo){this._boundingInfo.reConstruct(extend.minimum,extend.maximum);}else{this._boundingInfo=new BoundingInfo(extend.minimum,extend.maximum);}}if(this.subMeshes){for(var index=0;index<this.subMeshes.length;index++){this.subMeshes[index].refreshBoundingInfo(data);}}this._updateBoundingInfo();}},{key:"_getData",value:function _getData(){var applySkeleton=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applyMorph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var data=arguments.length>2?arguments[2]:undefined;var kind=arguments.length>3&&arguments[3]!==undefined?arguments[3]:VertexBuffer.PositionKind;data=data!==null&&data!==void 0?data:this.getVerticesData(kind).slice();if(data&&applyMorph&&this.morphTargetManager){var faceIndexCount=0;var positionIndex=0;for(var vertexCount=0;vertexCount<data.length;vertexCount++){for(var targetCount=0;targetCount<this.morphTargetManager.numTargets;targetCount++){var targetMorph=this.morphTargetManager.getTarget(targetCount);var influence=targetMorph.influence;if(influence>0){var morphTargetPositions=targetMorph.getPositions();if(morphTargetPositions){data[vertexCount]+=(morphTargetPositions[vertexCount]-data[vertexCount])*influence;}}}faceIndexCount++;if(kind===VertexBuffer.PositionKind){if(this._positions&&faceIndexCount===3){faceIndexCount=0;var index=positionIndex*3;this._positions[positionIndex++].copyFromFloats(data[index],data[index+1],data[index+2]);}}}}if(data&&applySkeleton&&this.skeleton){var matricesIndicesData=this.getVerticesData(VertexBuffer.MatricesIndicesKind);var matricesWeightsData=this.getVerticesData(VertexBuffer.MatricesWeightsKind);if(matricesWeightsData&&matricesIndicesData){var needExtras=this.numBoneInfluencers>4;var matricesIndicesExtraData=needExtras?this.getVerticesData(VertexBuffer.MatricesIndicesExtraKind):null;var matricesWeightsExtraData=needExtras?this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind):null;var skeletonMatrices=this.skeleton.getTransformMatrices(this);var tempVector=TmpVectors.Vector3[0];var finalMatrix=TmpVectors.Matrix[0];var tempMatrix=TmpVectors.Matrix[1];var matWeightIdx=0;for(var _index18=0;_index18<data.length;_index18+=3,matWeightIdx+=4){finalMatrix.reset();var inf=void 0;var weight=void 0;for(inf=0;inf<4;inf++){weight=matricesWeightsData[matWeightIdx+inf];if(weight>0){Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,Math.floor(matricesIndicesData[matWeightIdx+inf]*16),weight,tempMatrix);finalMatrix.addToSelf(tempMatrix);}}if(needExtras){for(inf=0;inf<4;inf++){weight=matricesWeightsExtraData[matWeightIdx+inf];if(weight>0){Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,Math.floor(matricesIndicesExtraData[matWeightIdx+inf]*16),weight,tempMatrix);finalMatrix.addToSelf(tempMatrix);}}}if(kind===VertexBuffer.NormalKind){Vector3.TransformNormalFromFloatsToRef(data[_index18],data[_index18+1],data[_index18+2],finalMatrix,tempVector);}else{Vector3.TransformCoordinatesFromFloatsToRef(data[_index18],data[_index18+1],data[_index18+2],finalMatrix,tempVector);}tempVector.toArray(data,_index18);if(kind===VertexBuffer.PositionKind&&this._positions){this._positions[_index18/3].copyFrom(tempVector);}}}}return data;}},{key:"getNormalsData",value:function getNormalsData(){var applySkeleton=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applyMorph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return this._getData(applySkeleton,applyMorph,null,VertexBuffer.NormalKind);}},{key:"getPositionData",value:function getPositionData(){var applySkeleton=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applyMorph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var data=arguments.length>2?arguments[2]:undefined;return this._getData(applySkeleton,applyMorph,data,VertexBuffer.PositionKind);}},{key:"_getPositionData",value:function _getPositionData(applySkeleton,applyMorph){var _a;var data=this.getVerticesData(VertexBuffer.PositionKind);if(this._internalAbstractMeshDataInfo._positions){this._internalAbstractMeshDataInfo._positions=null;}if(data&&(applySkeleton&&this.skeleton||applyMorph&&this.morphTargetManager)){data=data.slice();this._generatePointsArray();if(this._positions){var pos=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(pos.length);for(var i=0;i<pos.length;i++){this._internalAbstractMeshDataInfo._positions[i]=((_a=pos[i])===null||_a===void 0?void 0:_a.clone())||new Vector3();}}return this.getPositionData(applySkeleton,applyMorph,data);}return data;}},{key:"_updateBoundingInfo",value:function _updateBoundingInfo(){if(this._boundingInfo){this._boundingInfo.update(this.worldMatrixFromCache);}else{this._boundingInfo=new BoundingInfo(Vector3.Zero(),Vector3.Zero(),this.worldMatrixFromCache);}this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache);return this;}},{key:"_updateSubMeshesBoundingInfo",value:function _updateSubMeshesBoundingInfo(matrix){if(!this.subMeshes){return this;}var count=this.subMeshes.length;for(var subIndex=0;subIndex<count;subIndex++){var subMesh=this.subMeshes[subIndex];if(count>1||!subMesh.IsGlobal){subMesh.updateBoundingInfo(matrix);}}return this;}},{key:"_afterComputeWorldMatrix",value:function _afterComputeWorldMatrix(){if(this.doNotSyncBoundingInfo){return;}this._boundingInfoIsDirty=true;}},{key:"isInFrustum",value:function isInFrustum(frustumPlanes){return this.getBoundingInfo().isInFrustum(frustumPlanes,this.cullingStrategy);}},{key:"isCompletelyInFrustum",value:function isCompletelyInFrustum(frustumPlanes){return this.getBoundingInfo().isCompletelyInFrustum(frustumPlanes);}},{key:"intersectsMesh",value:function intersectsMesh(mesh){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var includeDescendants=arguments.length>2?arguments[2]:undefined;var boundingInfo=this.getBoundingInfo();var otherBoundingInfo=mesh.getBoundingInfo();if(boundingInfo.intersects(otherBoundingInfo,precise)){return true;}if(includeDescendants){var _iterator101=_createForOfIteratorHelper(this.getChildMeshes()),_step110;try{for(_iterator101.s();!(_step110=_iterator101.n()).done;){var child=_step110.value;if(child.intersectsMesh(mesh,precise,true)){return true;}}}catch(err){_iterator101.e(err);}finally{_iterator101.f();}}return false;}},{key:"intersectsPoint",value:function intersectsPoint(point){return this.getBoundingInfo().intersectsPoint(point);}},{key:"checkCollisions",get:function get(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions;},set:function set(collisionEnabled){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=collisionEnabled;}},{key:"collider",get:function get(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider;}},{key:"moveWithCollisions",value:function moveWithCollisions(displacement){var globalPosition=this.getAbsolutePosition();globalPosition.addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var coordinator=this.getScene().collisionCoordinator;if(!this._internalAbstractMeshDataInfo._meshCollisionData._collider){this._internalAbstractMeshDataInfo._meshCollisionData._collider=coordinator.createCollider();}this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid;coordinator.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,displacement,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId);return this;}},{key:"_collideForSubMesh",value:function _collideForSubMesh(subMesh,transformMatrix,collider){var _a;this._generatePointsArray();if(!this._positions){return this;}if(!subMesh._lastColliderWorldVertices||!subMesh._lastColliderTransformMatrix.equals(transformMatrix)){subMesh._lastColliderTransformMatrix=transformMatrix.clone();subMesh._lastColliderWorldVertices=[];subMesh._trianglePlanes=[];var start=subMesh.verticesStart;var end=subMesh.verticesStart+subMesh.verticesCount;for(var i=start;i<end;i++){subMesh._lastColliderWorldVertices.push(Vector3.TransformCoordinates(this._positions[i],transformMatrix));}}collider._collide(subMesh._trianglePlanes,subMesh._lastColliderWorldVertices,this.getIndices(),subMesh.indexStart,subMesh.indexStart+subMesh.indexCount,subMesh.verticesStart,!!subMesh.getMaterial(),this,this._shouldConvertRHS(),((_a=subMesh.getMaterial())===null||_a===void 0?void 0:_a.fillMode)===7);return this;}},{key:"_processCollisionsForSubMeshes",value:function _processCollisionsForSubMeshes(collider,transformMatrix){var subMeshes=this._scene.getCollidingSubMeshCandidates(this,collider);var len=subMeshes.length;for(var index=0;index<len;index++){var subMesh=subMeshes.data[index];if(len>1&&!subMesh._checkCollision(collider)){continue;}this._collideForSubMesh(subMesh,transformMatrix,collider);}return this;}},{key:"_shouldConvertRHS",value:function _shouldConvertRHS(){return false;}},{key:"_checkCollision",value:function _checkCollision(collider){if(!this.getBoundingInfo()._checkCollision(collider)){return this;}var collisionsScalingMatrix=TmpVectors.Matrix[0];var collisionsTransformMatrix=TmpVectors.Matrix[1];Matrix.ScalingToRef(1/collider._radius.x,1/collider._radius.y,1/collider._radius.z,collisionsScalingMatrix);this.worldMatrixFromCache.multiplyToRef(collisionsScalingMatrix,collisionsTransformMatrix);this._processCollisionsForSubMeshes(collider,collisionsTransformMatrix);return this;}},{key:"_generatePointsArray",value:function _generatePointsArray(){return false;}},{key:"intersects",value:function intersects(ray,fastCheck,trianglePredicate){var onlyBoundingInfo=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var worldToUse=arguments.length>4?arguments[4]:undefined;var skipBoundingInfo=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var pickingInfo=new PickingInfo();var intersectionThreshold=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0;var boundingInfo=this.getBoundingInfo();if(!this.subMeshes){return pickingInfo;}if(!skipBoundingInfo&&(!ray.intersectsSphere(boundingInfo.boundingSphere,intersectionThreshold)||!ray.intersectsBox(boundingInfo.boundingBox,intersectionThreshold))){return pickingInfo;}if(onlyBoundingInfo){pickingInfo.hit=skipBoundingInfo?false:true;pickingInfo.pickedMesh=skipBoundingInfo?null:this;pickingInfo.distance=skipBoundingInfo?0:Vector3.Distance(ray.origin,boundingInfo.boundingSphere.center);pickingInfo.subMeshId=0;return pickingInfo;}if(!this._generatePointsArray()){return pickingInfo;}var intersectInfo=null;var subMeshes=this._scene.getIntersectingSubMeshCandidates(this,ray);var len=subMeshes.length;var anySubmeshSupportIntersect=false;for(var index=0;index<len;index++){var subMesh=subMeshes.data[index];var material=subMesh.getMaterial();if(!material){continue;}if(material.fillMode==7||material.fillMode==0||material.fillMode==1||material.fillMode==2||material.fillMode==4){anySubmeshSupportIntersect=true;break;}}if(!anySubmeshSupportIntersect){pickingInfo.hit=true;pickingInfo.pickedMesh=this;pickingInfo.distance=Vector3.Distance(ray.origin,boundingInfo.boundingSphere.center);pickingInfo.subMeshId=-1;return pickingInfo;}for(var _index19=0;_index19<len;_index19++){var _subMesh=subMeshes.data[_index19];if(len>1&&!_subMesh.canIntersects(ray)){continue;}var currentIntersectInfo=_subMesh.intersects(ray,this._positions,this.getIndices(),fastCheck,trianglePredicate);if(currentIntersectInfo){if(fastCheck||!intersectInfo||currentIntersectInfo.distance<intersectInfo.distance){intersectInfo=currentIntersectInfo;intersectInfo.subMeshId=_index19;if(fastCheck){break;}}}}if(intersectInfo){var world=worldToUse!==null&&worldToUse!==void 0?worldToUse:this.getWorldMatrix();var worldOrigin=TmpVectors.Vector3[0];var direction=TmpVectors.Vector3[1];Vector3.TransformCoordinatesToRef(ray.origin,world,worldOrigin);ray.direction.scaleToRef(intersectInfo.distance,direction);var worldDirection=Vector3.TransformNormal(direction,world);var pickedPoint=worldDirection.addInPlace(worldOrigin);pickingInfo.hit=true;pickingInfo.distance=Vector3.Distance(worldOrigin,pickedPoint);pickingInfo.pickedPoint=pickedPoint;pickingInfo.pickedMesh=this;pickingInfo.bu=intersectInfo.bu||0;pickingInfo.bv=intersectInfo.bv||0;pickingInfo.subMeshFaceId=intersectInfo.faceId;pickingInfo.faceId=intersectInfo.faceId+subMeshes.data[intersectInfo.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3);pickingInfo.subMeshId=intersectInfo.subMeshId;return pickingInfo;}return pickingInfo;}},{key:"clone",value:function clone(name135,newParent,doNotCloneChildren){return null;}},{key:"releaseSubMeshes",value:function releaseSubMeshes(){if(this.subMeshes){while(this.subMeshes.length){this.subMeshes[0].dispose();}}else{this.subMeshes=new Array();}return this;}},{key:"dispose",value:function dispose(doNotRecurse){var _this78=this;var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var index;if(this._scene.useMaterialMeshMap){if(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap){this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0;}}this.getScene().freeActiveMeshes();this.getScene().freeRenderingGroups();if(this.actionManager!==void 0&&this.actionManager!==null){this.actionManager.dispose();this.actionManager=null;}this._internalAbstractMeshDataInfo._skeleton=null;if(this._transformMatrixTexture){this._transformMatrixTexture.dispose();this._transformMatrixTexture=null;}for(index=0;index<this._intersectionsInProgress.length;index++){var other=this._intersectionsInProgress[index];var pos=other._intersectionsInProgress.indexOf(this);other._intersectionsInProgress.splice(pos,1);}this._intersectionsInProgress.length=0;var lights=this.getScene().lights;lights.forEach(function(light){var meshIndex=light.includedOnlyMeshes.indexOf(_this78);if(meshIndex!==-1){light.includedOnlyMeshes.splice(meshIndex,1);}meshIndex=light.excludedMeshes.indexOf(_this78);if(meshIndex!==-1){light.excludedMeshes.splice(meshIndex,1);}var generators=light.getShadowGenerators();if(generators){var iterator=generators.values();for(var key=iterator.next();key.done!==true;key=iterator.next()){var generator=key.value;var shadowMap=generator.getShadowMap();if(shadowMap&&shadowMap.renderList){meshIndex=shadowMap.renderList.indexOf(_this78);if(meshIndex!==-1){shadowMap.renderList.splice(meshIndex,1);}}}}});if(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh"){this.releaseSubMeshes();}var engine=this.getScene().getEngine();if(this._occlusionQuery!==null){this.isOcclusionQueryInProgress=false;engine.deleteQuery(this._occlusionQuery);this._occlusionQuery=null;}engine.wipeCaches();this.getScene().removeMesh(this);if(this._parentContainer){var index2=this._parentContainer.meshes.indexOf(this);if(index2>-1){this._parentContainer.meshes.splice(index2,1);}this._parentContainer=null;}if(disposeMaterialAndTextures){if(this.material){if(this.material.getClassName()==="MultiMaterial"){this.material.dispose(false,true,true);}else{this.material.dispose(false,true);}}}if(!doNotRecurse){for(index=0;index<this.getScene().particleSystems.length;index++){if(this.getScene().particleSystems[index].emitter===this){this.getScene().particleSystems[index].dispose();index--;}}}if(this._internalAbstractMeshDataInfo._facetData.facetDataEnabled){this.disableFacetData();}this._uniformBuffer.dispose();this.onAfterWorldMatrixUpdateObservable.clear();this.onCollideObservable.clear();this.onCollisionPositionChangeObservable.clear();this.onRebuildObservable.clear();_get(_getPrototypeOf(AbstractMesh.prototype),"dispose",this).call(this,doNotRecurse,disposeMaterialAndTextures);}},{key:"addChild",value:function addChild(mesh){var preserveScalingSign=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;mesh.setParent(this,preserveScalingSign);return this;}},{key:"removeChild",value:function removeChild(mesh){var preserveScalingSign=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;mesh.setParent(null,preserveScalingSign);return this;}},{key:"_initFacetData",value:function _initFacetData(){var data=this._internalAbstractMeshDataInfo._facetData;if(!data.facetNormals){data.facetNormals=new Array();}if(!data.facetPositions){data.facetPositions=new Array();}if(!data.facetPartitioning){data.facetPartitioning=new Array();}data.facetNb=this.getIndices().length/3|0;data.partitioningSubdivisions=data.partitioningSubdivisions?data.partitioningSubdivisions:10;data.partitioningBBoxRatio=data.partitioningBBoxRatio?data.partitioningBBoxRatio:1.01;for(var f=0;f<data.facetNb;f++){data.facetNormals[f]=Vector3.Zero();data.facetPositions[f]=Vector3.Zero();}data.facetDataEnabled=true;return this;}},{key:"updateFacetData",value:function updateFacetData(){var data=this._internalAbstractMeshDataInfo._facetData;if(!data.facetDataEnabled){this._initFacetData();}var positions=this.getVerticesData(VertexBuffer.PositionKind);var indices=this.getIndices();var normals=this.getVerticesData(VertexBuffer.NormalKind);var bInfo=this.getBoundingInfo();if(data.facetDepthSort&&!data.facetDepthSortEnabled){data.facetDepthSortEnabled=true;if(indices instanceof Uint16Array){data.depthSortedIndices=new Uint16Array(indices);}else if(indices instanceof Uint32Array){data.depthSortedIndices=new Uint32Array(indices);}else{var needs32bits=false;for(var i=0;i<indices.length;i++){if(indices[i]>65535){needs32bits=true;break;}}if(needs32bits){data.depthSortedIndices=new Uint32Array(indices);}else{data.depthSortedIndices=new Uint16Array(indices);}}data.facetDepthSortFunction=function(f1,f2){return f2.sqDistance-f1.sqDistance;};if(!data.facetDepthSortFrom){var camera=this.getScene().activeCamera;data.facetDepthSortFrom=camera?camera.position:Vector3.Zero();}data.depthSortedFacets=[];for(var f=0;f<data.facetNb;f++){var depthSortedFacet={ind:f*3,sqDistance:0};data.depthSortedFacets.push(depthSortedFacet);}data.invertedMatrix=Matrix.Identity();data.facetDepthSortOrigin=Vector3.Zero();}data.bbSize.x=bInfo.maximum.x-bInfo.minimum.x>Epsilon?bInfo.maximum.x-bInfo.minimum.x:Epsilon;data.bbSize.y=bInfo.maximum.y-bInfo.minimum.y>Epsilon?bInfo.maximum.y-bInfo.minimum.y:Epsilon;data.bbSize.z=bInfo.maximum.z-bInfo.minimum.z>Epsilon?bInfo.maximum.z-bInfo.minimum.z:Epsilon;var bbSizeMax=data.bbSize.x>data.bbSize.y?data.bbSize.x:data.bbSize.y;bbSizeMax=bbSizeMax>data.bbSize.z?bbSizeMax:data.bbSize.z;data.subDiv.max=data.partitioningSubdivisions;data.subDiv.X=Math.floor(data.subDiv.max*data.bbSize.x/bbSizeMax);data.subDiv.Y=Math.floor(data.subDiv.max*data.bbSize.y/bbSizeMax);data.subDiv.Z=Math.floor(data.subDiv.max*data.bbSize.z/bbSizeMax);data.subDiv.X=data.subDiv.X<1?1:data.subDiv.X;data.subDiv.Y=data.subDiv.Y<1?1:data.subDiv.Y;data.subDiv.Z=data.subDiv.Z<1?1:data.subDiv.Z;data.facetParameters.facetNormals=this.getFacetLocalNormals();data.facetParameters.facetPositions=this.getFacetLocalPositions();data.facetParameters.facetPartitioning=this.getFacetLocalPartitioning();data.facetParameters.bInfo=bInfo;data.facetParameters.bbSize=data.bbSize;data.facetParameters.subDiv=data.subDiv;data.facetParameters.ratio=this.partitioningBBoxRatio;data.facetParameters.depthSort=data.facetDepthSort;if(data.facetDepthSort&&data.facetDepthSortEnabled){this.computeWorldMatrix(true);this._worldMatrix.invertToRef(data.invertedMatrix);Vector3.TransformCoordinatesToRef(data.facetDepthSortFrom,data.invertedMatrix,data.facetDepthSortOrigin);data.facetParameters.distanceTo=data.facetDepthSortOrigin;}data.facetParameters.depthSortedFacets=data.depthSortedFacets;if(normals){VertexData.ComputeNormals(positions,indices,normals,data.facetParameters);}if(data.facetDepthSort&&data.facetDepthSortEnabled){data.depthSortedFacets.sort(data.facetDepthSortFunction);var l=data.depthSortedIndices.length/3|0;for(var _f2=0;_f2<l;_f2++){var sind=data.depthSortedFacets[_f2].ind;data.depthSortedIndices[_f2*3]=indices[sind];data.depthSortedIndices[_f2*3+1]=indices[sind+1];data.depthSortedIndices[_f2*3+2]=indices[sind+2];}this.updateIndices(data.depthSortedIndices,void 0,true);}return this;}},{key:"getFacetLocalNormals",value:function getFacetLocalNormals(){var facetData=this._internalAbstractMeshDataInfo._facetData;if(!facetData.facetNormals){this.updateFacetData();}return facetData.facetNormals;}},{key:"getFacetLocalPositions",value:function getFacetLocalPositions(){var facetData=this._internalAbstractMeshDataInfo._facetData;if(!facetData.facetPositions){this.updateFacetData();}return facetData.facetPositions;}},{key:"getFacetLocalPartitioning",value:function getFacetLocalPartitioning(){var facetData=this._internalAbstractMeshDataInfo._facetData;if(!facetData.facetPartitioning){this.updateFacetData();}return facetData.facetPartitioning;}},{key:"getFacetPosition",value:function getFacetPosition(i){var pos=Vector3.Zero();this.getFacetPositionToRef(i,pos);return pos;}},{key:"getFacetPositionToRef",value:function getFacetPositionToRef(i,ref){var localPos=this.getFacetLocalPositions()[i];var world=this.getWorldMatrix();Vector3.TransformCoordinatesToRef(localPos,world,ref);return this;}},{key:"getFacetNormal",value:function getFacetNormal(i){var norm=Vector3.Zero();this.getFacetNormalToRef(i,norm);return norm;}},{key:"getFacetNormalToRef",value:function getFacetNormalToRef(i,ref){var localNorm=this.getFacetLocalNormals()[i];Vector3.TransformNormalToRef(localNorm,this.getWorldMatrix(),ref);return this;}},{key:"getFacetsAtLocalCoordinates",value:function getFacetsAtLocalCoordinates(x,y,z){var bInfo=this.getBoundingInfo();var data=this._internalAbstractMeshDataInfo._facetData;var ox=Math.floor((x-bInfo.minimum.x*data.partitioningBBoxRatio)*data.subDiv.X*data.partitioningBBoxRatio/data.bbSize.x);var oy=Math.floor((y-bInfo.minimum.y*data.partitioningBBoxRatio)*data.subDiv.Y*data.partitioningBBoxRatio/data.bbSize.y);var oz=Math.floor((z-bInfo.minimum.z*data.partitioningBBoxRatio)*data.subDiv.Z*data.partitioningBBoxRatio/data.bbSize.z);if(ox<0||ox>data.subDiv.max||oy<0||oy>data.subDiv.max||oz<0||oz>data.subDiv.max){return null;}return data.facetPartitioning[ox+data.subDiv.max*oy+data.subDiv.max*data.subDiv.max*oz];}},{key:"getClosestFacetAtCoordinates",value:function getClosestFacetAtCoordinates(x,y,z,projected){var checkFace=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var facing=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var world=this.getWorldMatrix();var invMat=TmpVectors.Matrix[5];world.invertToRef(invMat);var invVect=TmpVectors.Vector3[8];Vector3.TransformCoordinatesFromFloatsToRef(x,y,z,invMat,invVect);var closest=this.getClosestFacetAtLocalCoordinates(invVect.x,invVect.y,invVect.z,projected,checkFace,facing);if(projected){Vector3.TransformCoordinatesFromFloatsToRef(projected.x,projected.y,projected.z,world,projected);}return closest;}},{key:"getClosestFacetAtLocalCoordinates",value:function getClosestFacetAtLocalCoordinates(x,y,z,projected){var checkFace=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var facing=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var closest=null;var tmpx=0;var tmpy=0;var tmpz=0;var d=0;var t0=0;var projx=0;var projy=0;var projz=0;var facetPositions=this.getFacetLocalPositions();var facetNormals=this.getFacetLocalNormals();var facetsInBlock=this.getFacetsAtLocalCoordinates(x,y,z);if(!facetsInBlock){return null;}var shortest=Number.MAX_VALUE;var tmpDistance=shortest;var fib;var norm;var p0;for(var idx=0;idx<facetsInBlock.length;idx++){fib=facetsInBlock[idx];norm=facetNormals[fib];p0=facetPositions[fib];d=(x-p0.x)*norm.x+(y-p0.y)*norm.y+(z-p0.z)*norm.z;if(!checkFace||checkFace&&facing&&d>=0||checkFace&&!facing&&d<=0){d=norm.x*p0.x+norm.y*p0.y+norm.z*p0.z;t0=-(norm.x*x+norm.y*y+norm.z*z-d)/(norm.x*norm.x+norm.y*norm.y+norm.z*norm.z);projx=x+norm.x*t0;projy=y+norm.y*t0;projz=z+norm.z*t0;tmpx=projx-x;tmpy=projy-y;tmpz=projz-z;tmpDistance=tmpx*tmpx+tmpy*tmpy+tmpz*tmpz;if(tmpDistance<shortest){shortest=tmpDistance;closest=fib;if(projected){projected.x=projx;projected.y=projy;projected.z=projz;}}}}return closest;}},{key:"getFacetDataParameters",value:function getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters;}},{key:"disableFacetData",value:function disableFacetData(){var facetData=this._internalAbstractMeshDataInfo._facetData;if(facetData.facetDataEnabled){facetData.facetDataEnabled=false;facetData.facetPositions=new Array();facetData.facetNormals=new Array();facetData.facetPartitioning=new Array();facetData.facetParameters=null;facetData.depthSortedIndices=new Uint32Array(0);}return this;}},{key:"updateIndices",value:function updateIndices(indices,offset){var gpuMemoryOnly=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return this;}},{key:"createNormals",value:function createNormals(updatable){var positions=this.getVerticesData(VertexBuffer.PositionKind);var indices=this.getIndices();var normals;if(this.isVerticesDataPresent(VertexBuffer.NormalKind)){normals=this.getVerticesData(VertexBuffer.NormalKind);}else{normals=[];}VertexData.ComputeNormals(positions,indices,normals,{useRightHandedSystem:this.getScene().useRightHandedSystem});this.setVerticesData(VertexBuffer.NormalKind,normals,updatable);return this;}},{key:"alignWithNormal",value:function alignWithNormal(normal,upDirection){if(!upDirection){upDirection=Axis.Y;}var axisX=TmpVectors.Vector3[0];var axisZ=TmpVectors.Vector3[1];Vector3.CrossToRef(upDirection,normal,axisZ);Vector3.CrossToRef(normal,axisZ,axisX);if(this.rotationQuaternion){Quaternion.RotationQuaternionFromAxisToRef(axisX,normal,axisZ,this.rotationQuaternion);}else{Vector3.RotationFromAxisToRef(axisX,normal,axisZ,this.rotation);}return this;}},{key:"_checkOcclusionQuery",value:function _checkOcclusionQuery(){return false;}},{key:"disableEdgesRendering",value:function disableEdgesRendering(){throw _WarnImport("EdgesRenderer");}},{key:"enableEdgesRendering",value:function enableEdgesRendering(epsilon,checkVerticesInsteadOfIndices,options){throw _WarnImport("EdgesRenderer");}},{key:"getConnectedParticleSystems",value:function getConnectedParticleSystems(){var _this79=this;return this._scene.particleSystems.filter(function(particleSystem){return particleSystem.emitter===_this79;});}}],[{key:"BILLBOARDMODE_NONE",get:function get(){return TransformNode.BILLBOARDMODE_NONE;}},{key:"BILLBOARDMODE_X",get:function get(){return TransformNode.BILLBOARDMODE_X;}},{key:"BILLBOARDMODE_Y",get:function get(){return TransformNode.BILLBOARDMODE_Y;}},{key:"BILLBOARDMODE_Z",get:function get(){return TransformNode.BILLBOARDMODE_Z;}},{key:"BILLBOARDMODE_ALL",get:function get(){return TransformNode.BILLBOARDMODE_ALL;}},{key:"BILLBOARDMODE_USE_POSITION",get:function get(){return TransformNode.BILLBOARDMODE_USE_POSITION;}}]);return AbstractMesh;}(TransformNode);AbstractMesh.OCCLUSION_TYPE_NONE=0;AbstractMesh.OCCLUSION_TYPE_OPTIMISTIC=1;AbstractMesh.OCCLUSION_TYPE_STRICT=2;AbstractMesh.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0;AbstractMesh.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1;AbstractMesh.CULLINGSTRATEGY_STANDARD=0;AbstractMesh.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1;AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2;AbstractMesh.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3;RegisterClass("BABYLON.AbstractMesh",AbstractMesh);// node_modules/@babylonjs/core/Materials/clipPlaneMaterialHelper.js
function addClipPlaneUniforms(uniforms){if(uniforms.indexOf("vClipPlane")===-1){uniforms.push("vClipPlane");}if(uniforms.indexOf("vClipPlane2")===-1){uniforms.push("vClipPlane2");}if(uniforms.indexOf("vClipPlane3")===-1){uniforms.push("vClipPlane3");}if(uniforms.indexOf("vClipPlane4")===-1){uniforms.push("vClipPlane4");}if(uniforms.indexOf("vClipPlane5")===-1){uniforms.push("vClipPlane5");}if(uniforms.indexOf("vClipPlane6")===-1){uniforms.push("vClipPlane6");}}function prepareDefinesForClipPlanes(primaryHolder,secondaryHolder,defines){var _a,_b,_c,_d,_e,_f;var changed=false;var clipPlane=(_a=primaryHolder.clipPlane)!==null&&_a!==void 0?_a:secondaryHolder.clipPlane;changed=addDefine(clipPlane,defines,"CLIPPLANE","#define CLIPPLANE")||changed;clipPlane=(_b=primaryHolder.clipPlane2)!==null&&_b!==void 0?_b:secondaryHolder.clipPlane2;changed=addDefine(clipPlane,defines,"CLIPPLANE2","#define CLIPPLANE2")||changed;clipPlane=(_c=primaryHolder.clipPlane3)!==null&&_c!==void 0?_c:secondaryHolder.clipPlane3;changed=addDefine(clipPlane,defines,"CLIPPLANE3","#define CLIPPLANE3")||changed;clipPlane=(_d=primaryHolder.clipPlane4)!==null&&_d!==void 0?_d:secondaryHolder.clipPlane4;changed=addDefine(clipPlane,defines,"CLIPPLANE4","#define CLIPPLANE4")||changed;clipPlane=(_e=primaryHolder.clipPlane5)!==null&&_e!==void 0?_e:secondaryHolder.clipPlane5;changed=addDefine(clipPlane,defines,"CLIPPLANE5","#define CLIPPLANE5")||changed;clipPlane=(_f=primaryHolder.clipPlane6)!==null&&_f!==void 0?_f:secondaryHolder.clipPlane6;changed=addDefine(clipPlane,defines,"CLIPPLANE6","#define CLIPPLANE6")||changed;return changed;}function bindClipPlane(effect,primaryHolder,secondaryHolder){var _a,_b,_c,_d,_e,_f;var clipPlane=(_a=primaryHolder.clipPlane)!==null&&_a!==void 0?_a:secondaryHolder.clipPlane;setClipPlane(effect,"vClipPlane",clipPlane);clipPlane=(_b=primaryHolder.clipPlane2)!==null&&_b!==void 0?_b:secondaryHolder.clipPlane2;setClipPlane(effect,"vClipPlane2",clipPlane);clipPlane=(_c=primaryHolder.clipPlane3)!==null&&_c!==void 0?_c:secondaryHolder.clipPlane3;setClipPlane(effect,"vClipPlane3",clipPlane);clipPlane=(_d=primaryHolder.clipPlane4)!==null&&_d!==void 0?_d:secondaryHolder.clipPlane4;setClipPlane(effect,"vClipPlane4",clipPlane);clipPlane=(_e=primaryHolder.clipPlane5)!==null&&_e!==void 0?_e:secondaryHolder.clipPlane5;setClipPlane(effect,"vClipPlane5",clipPlane);clipPlane=(_f=primaryHolder.clipPlane6)!==null&&_f!==void 0?_f:secondaryHolder.clipPlane6;setClipPlane(effect,"vClipPlane6",clipPlane);}function setClipPlane(effect,uniformName,clipPlane){if(clipPlane){effect.setFloat4(uniformName,clipPlane.normal.x,clipPlane.normal.y,clipPlane.normal.z,clipPlane.d);}}function addDefine(clipPlane,defines,defineName,defineString){var defineClipPlane=clipPlane?true:false;var alreadySet;if(Array.isArray(defines)){var defineIndex=defines.indexOf(defineString);alreadySet=defineIndex!==-1;if(!alreadySet&&clipPlane){defines.push(defineString);}else if(alreadySet&&!clipPlane){defines.splice(defineIndex,1);}}else{alreadySet=defines[defineName];defines[defineName]=defineClipPlane;}var changed=alreadySet!==defineClipPlane;return changed;}// node_modules/@babylonjs/core/Materials/materialHelper.js
var MaterialHelper=/*#__PURE__*/function(){function MaterialHelper(){_classCallCheck(this,MaterialHelper);}_createClass(MaterialHelper,null,[{key:"BindSceneUniformBuffer",value:function BindSceneUniformBuffer(effect,sceneUbo){sceneUbo.bindToEffect(effect,"Scene");}},{key:"PrepareDefinesForMergedUV",value:function PrepareDefinesForMergedUV(texture,defines,key){defines._needUVs=true;defines[key]=true;if(texture.optimizeUVAllocation&&texture.getTextureMatrix().isIdentityAs3x2()){defines[key+"DIRECTUV"]=texture.coordinatesIndex+1;defines["MAINUV"+(texture.coordinatesIndex+1)]=true;}else{defines[key+"DIRECTUV"]=0;}}},{key:"BindTextureMatrix",value:function BindTextureMatrix(texture,uniformBuffer,key){var matrix=texture.getTextureMatrix();uniformBuffer.updateMatrix(key+"Matrix",matrix);}},{key:"GetFogState",value:function GetFogState(mesh,scene2){return scene2.fogEnabled&&mesh.applyFog&&scene2.fogMode!==Scene.FOGMODE_NONE;}},{key:"PrepareDefinesForMisc",value:function PrepareDefinesForMisc(mesh,scene2,useLogarithmicDepth,pointsCloud,fogEnabled,alphaTest,defines){if(defines._areMiscDirty){defines["LOGARITHMICDEPTH"]=useLogarithmicDepth;defines["POINTSIZE"]=pointsCloud;defines["FOG"]=fogEnabled&&this.GetFogState(mesh,scene2);defines["NONUNIFORMSCALING"]=mesh.nonUniformScaling;defines["ALPHATEST"]=alphaTest;}}},{key:"PrepareDefinesForCamera",value:function PrepareDefinesForCamera(scene2,defines){var changed=false;if(scene2.activeCamera){var wasOrtho=defines["CAMERA_ORTHOGRAPHIC"]?1:0;var wasPersp=defines["CAMERA_PERSPECTIVE"]?1:0;var isOrtho=scene2.activeCamera.mode===Camera.ORTHOGRAPHIC_CAMERA?1:0;var isPersp=scene2.activeCamera.mode===Camera.PERSPECTIVE_CAMERA?1:0;if(wasOrtho^isOrtho||wasPersp^isPersp){defines["CAMERA_ORTHOGRAPHIC"]=isOrtho===1;defines["CAMERA_PERSPECTIVE"]=isPersp===1;changed=true;}}return changed;}},{key:"PrepareDefinesForFrameBoundValues",value:function PrepareDefinesForFrameBoundValues(scene2,engine,material,defines,useInstances){var useClipPlane=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var useThinInstances=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var changed=MaterialHelper.PrepareDefinesForCamera(scene2,defines);if(useClipPlane!==false){changed=prepareDefinesForClipPlanes(material,scene2,defines);}if(defines["DEPTHPREPASS"]!==!engine.getColorWrite()){defines["DEPTHPREPASS"]=!defines["DEPTHPREPASS"];changed=true;}if(defines["INSTANCES"]!==useInstances){defines["INSTANCES"]=useInstances;changed=true;}if(defines["THIN_INSTANCES"]!==useThinInstances){defines["THIN_INSTANCES"]=useThinInstances;changed=true;}if(changed){defines.markAsUnprocessed();}}},{key:"PrepareDefinesForBones",value:function PrepareDefinesForBones(mesh,defines){if(mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton){defines["NUM_BONE_INFLUENCERS"]=mesh.numBoneInfluencers;var materialSupportsBoneTexture=defines["BONETEXTURE"]!==void 0;if(mesh.skeleton.isUsingTextureForMatrices&&materialSupportsBoneTexture){defines["BONETEXTURE"]=true;}else{defines["BonesPerMesh"]=mesh.skeleton.bones.length+1;defines["BONETEXTURE"]=materialSupportsBoneTexture?false:void 0;var prePassRenderer=mesh.getScene().prePassRenderer;if(prePassRenderer&&prePassRenderer.enabled){var nonExcluded=prePassRenderer.excludedSkinnedMesh.indexOf(mesh)===-1;defines["BONES_VELOCITY_ENABLED"]=nonExcluded;}}}else{defines["NUM_BONE_INFLUENCERS"]=0;defines["BonesPerMesh"]=0;if(defines["BONETEXTURE"]!==void 0){defines["BONETEXTURE"]=false;}}}},{key:"PrepareDefinesForMorphTargets",value:function PrepareDefinesForMorphTargets(mesh,defines){var manager=mesh.morphTargetManager;if(manager){defines["MORPHTARGETS_UV"]=manager.supportsUVs&&defines["UV1"];defines["MORPHTARGETS_TANGENT"]=manager.supportsTangents&&defines["TANGENT"];defines["MORPHTARGETS_NORMAL"]=manager.supportsNormals&&defines["NORMAL"];defines["MORPHTARGETS"]=manager.numInfluencers>0;defines["NUM_MORPH_INFLUENCERS"]=manager.numInfluencers;defines["MORPHTARGETS_TEXTURE"]=manager.isUsingTextureForTargets;}else{defines["MORPHTARGETS_UV"]=false;defines["MORPHTARGETS_TANGENT"]=false;defines["MORPHTARGETS_NORMAL"]=false;defines["MORPHTARGETS"]=false;defines["NUM_MORPH_INFLUENCERS"]=0;}}},{key:"PrepareDefinesForBakedVertexAnimation",value:function PrepareDefinesForBakedVertexAnimation(mesh,defines){var manager=mesh.bakedVertexAnimationManager;defines["BAKED_VERTEX_ANIMATION_TEXTURE"]=manager&&manager.isEnabled?true:false;}},{key:"PrepareDefinesForAttributes",value:function PrepareDefinesForAttributes(mesh,defines,useVertexColor,useBones){var useMorphTargets=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var useVertexAlpha=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var useBakedVertexAnimation=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;if(!defines._areAttributesDirty&&defines._needNormals===defines._normals&&defines._needUVs===defines._uvs){return false;}defines._normals=defines._needNormals;defines._uvs=defines._needUVs;defines["NORMAL"]=defines._needNormals&&mesh.isVerticesDataPresent(VertexBuffer.NormalKind);if(defines._needNormals&&mesh.isVerticesDataPresent(VertexBuffer.TangentKind)){defines["TANGENT"]=true;}for(var i=1;i<=6;++i){defines["UV"+i]=defines._needUVs?mesh.isVerticesDataPresent("uv".concat(i===1?"":i)):false;}if(useVertexColor){var hasVertexColors=mesh.useVertexColors&&mesh.isVerticesDataPresent(VertexBuffer.ColorKind);defines["VERTEXCOLOR"]=hasVertexColors;defines["VERTEXALPHA"]=mesh.hasVertexAlpha&&hasVertexColors&&useVertexAlpha;}if(mesh.isVerticesDataPresent(VertexBuffer.ColorInstanceKind)&&(mesh.hasInstances||mesh.hasThinInstances)){defines["INSTANCESCOLOR"]=true;}if(useBones){this.PrepareDefinesForBones(mesh,defines);}if(useMorphTargets){this.PrepareDefinesForMorphTargets(mesh,defines);}if(useBakedVertexAnimation){this.PrepareDefinesForBakedVertexAnimation(mesh,defines);}return true;}},{key:"PrepareDefinesForMultiview",value:function PrepareDefinesForMultiview(scene2,defines){if(scene2.activeCamera){var previousMultiview=defines.MULTIVIEW;defines.MULTIVIEW=scene2.activeCamera.outputRenderTarget!==null&&scene2.activeCamera.outputRenderTarget.getViewCount()>1;if(defines.MULTIVIEW!=previousMultiview){defines.markAsUnprocessed();}}}},{key:"PrepareDefinesForOIT",value:function PrepareDefinesForOIT(scene2,defines,needAlphaBlending){var previousDefine=defines.ORDER_INDEPENDENT_TRANSPARENCY;var previousDefine16Bits=defines.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;defines.ORDER_INDEPENDENT_TRANSPARENCY=scene2.useOrderIndependentTransparency&&needAlphaBlending;defines.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!scene2.getEngine().getCaps().textureFloatLinearFiltering;if(previousDefine!==defines.ORDER_INDEPENDENT_TRANSPARENCY||previousDefine16Bits!==defines.ORDER_INDEPENDENT_TRANSPARENCY_16BITS){defines.markAsUnprocessed();}}},{key:"PrepareDefinesForPrePass",value:function PrepareDefinesForPrePass(scene2,defines,canRenderToMRT){var previousPrePass=defines.PREPASS;if(!defines._arePrePassDirty){return;}var texturesList=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(scene2.prePassRenderer&&scene2.prePassRenderer.enabled&&canRenderToMRT){defines.PREPASS=true;defines.SCENE_MRT_COUNT=scene2.prePassRenderer.mrtCount;for(var i=0;i<texturesList.length;i++){var index=scene2.prePassRenderer.getIndex(texturesList[i].type);if(index!==-1){defines[texturesList[i].define]=true;defines[texturesList[i].index]=index;}else{defines[texturesList[i].define]=false;}}}else{defines.PREPASS=false;for(var _i19=0;_i19<texturesList.length;_i19++){defines[texturesList[_i19].define]=false;}}if(defines.PREPASS!=previousPrePass){defines.markAsUnprocessed();defines.markAsImageProcessingDirty();}}},{key:"PrepareDefinesForLight",value:function PrepareDefinesForLight(scene2,mesh,light,lightIndex,defines,specularSupported,state){var _a;state.needNormals=true;if(defines["LIGHT"+lightIndex]===void 0){state.needRebuild=true;}defines["LIGHT"+lightIndex]=true;defines["SPOTLIGHT"+lightIndex]=false;defines["HEMILIGHT"+lightIndex]=false;defines["POINTLIGHT"+lightIndex]=false;defines["DIRLIGHT"+lightIndex]=false;light.prepareLightSpecificDefines(defines,lightIndex);defines["LIGHT_FALLOFF_PHYSICAL"+lightIndex]=false;defines["LIGHT_FALLOFF_GLTF"+lightIndex]=false;defines["LIGHT_FALLOFF_STANDARD"+lightIndex]=false;switch(light.falloffType){case LightConstants.FALLOFF_GLTF:defines["LIGHT_FALLOFF_GLTF"+lightIndex]=true;break;case LightConstants.FALLOFF_PHYSICAL:defines["LIGHT_FALLOFF_PHYSICAL"+lightIndex]=true;break;case LightConstants.FALLOFF_STANDARD:defines["LIGHT_FALLOFF_STANDARD"+lightIndex]=true;break;}if(specularSupported&&!light.specular.equalsFloats(0,0,0)){state.specularEnabled=true;}defines["SHADOW"+lightIndex]=false;defines["SHADOWCSM"+lightIndex]=false;defines["SHADOWCSMDEBUG"+lightIndex]=false;defines["SHADOWCSMNUM_CASCADES"+lightIndex]=false;defines["SHADOWCSMUSESHADOWMAXZ"+lightIndex]=false;defines["SHADOWCSMNOBLEND"+lightIndex]=false;defines["SHADOWCSM_RIGHTHANDED"+lightIndex]=false;defines["SHADOWPCF"+lightIndex]=false;defines["SHADOWPCSS"+lightIndex]=false;defines["SHADOWPOISSON"+lightIndex]=false;defines["SHADOWESM"+lightIndex]=false;defines["SHADOWCLOSEESM"+lightIndex]=false;defines["SHADOWCUBE"+lightIndex]=false;defines["SHADOWLOWQUALITY"+lightIndex]=false;defines["SHADOWMEDIUMQUALITY"+lightIndex]=false;if(mesh&&mesh.receiveShadows&&scene2.shadowsEnabled&&light.shadowEnabled){var shadowGenerator=(_a=light.getShadowGenerator(scene2.activeCamera))!==null&&_a!==void 0?_a:light.getShadowGenerator();if(shadowGenerator){var shadowMap=shadowGenerator.getShadowMap();if(shadowMap){if(shadowMap.renderList&&shadowMap.renderList.length>0){state.shadowEnabled=true;shadowGenerator.prepareDefines(defines,lightIndex);}}}}if(light.lightmapMode!=LightConstants.LIGHTMAP_DEFAULT){state.lightmapMode=true;defines["LIGHTMAPEXCLUDED"+lightIndex]=true;defines["LIGHTMAPNOSPECULAR"+lightIndex]=light.lightmapMode==LightConstants.LIGHTMAP_SHADOWSONLY;}else{defines["LIGHTMAPEXCLUDED"+lightIndex]=false;defines["LIGHTMAPNOSPECULAR"+lightIndex]=false;}}},{key:"PrepareDefinesForLights",value:function PrepareDefinesForLights(scene2,mesh,defines,specularSupported){var maxSimultaneousLights=arguments.length>4&&arguments[4]!==undefined?arguments[4]:4;var disableLighting=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(!defines._areLightsDirty){return defines._needNormals;}var lightIndex=0;var state={needNormals:defines._needNormals,needRebuild:false,lightmapMode:false,shadowEnabled:false,specularEnabled:false};if(scene2.lightsEnabled&&!disableLighting){var _iterator102=_createForOfIteratorHelper(mesh.lightSources),_step111;try{for(_iterator102.s();!(_step111=_iterator102.n()).done;){var light=_step111.value;this.PrepareDefinesForLight(scene2,mesh,light,lightIndex,defines,specularSupported,state);lightIndex++;if(lightIndex===maxSimultaneousLights){break;}}}catch(err){_iterator102.e(err);}finally{_iterator102.f();}}defines["SPECULARTERM"]=state.specularEnabled;defines["SHADOWS"]=state.shadowEnabled;for(var index=lightIndex;index<maxSimultaneousLights;index++){if(defines["LIGHT"+index]!==void 0){defines["LIGHT"+index]=false;defines["HEMILIGHT"+index]=false;defines["POINTLIGHT"+index]=false;defines["DIRLIGHT"+index]=false;defines["SPOTLIGHT"+index]=false;defines["SHADOW"+index]=false;defines["SHADOWCSM"+index]=false;defines["SHADOWCSMDEBUG"+index]=false;defines["SHADOWCSMNUM_CASCADES"+index]=false;defines["SHADOWCSMUSESHADOWMAXZ"+index]=false;defines["SHADOWCSMNOBLEND"+index]=false;defines["SHADOWCSM_RIGHTHANDED"+index]=false;defines["SHADOWPCF"+index]=false;defines["SHADOWPCSS"+index]=false;defines["SHADOWPOISSON"+index]=false;defines["SHADOWESM"+index]=false;defines["SHADOWCLOSEESM"+index]=false;defines["SHADOWCUBE"+index]=false;defines["SHADOWLOWQUALITY"+index]=false;defines["SHADOWMEDIUMQUALITY"+index]=false;}}var caps=scene2.getEngine().getCaps();if(defines["SHADOWFLOAT"]===void 0){state.needRebuild=true;}defines["SHADOWFLOAT"]=state.shadowEnabled&&(caps.textureFloatRender&&caps.textureFloatLinearFiltering||caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering);defines["LIGHTMAPEXCLUDED"]=state.lightmapMode;if(state.needRebuild){defines.rebuild();}return state.needNormals;}},{key:"PrepareUniformsAndSamplersForLight",value:function PrepareUniformsAndSamplersForLight(lightIndex,uniformsList,samplersList,projectedLightTexture){var uniformBuffersList=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var updateOnlyBuffersList=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;if(uniformBuffersList){uniformBuffersList.push("Light"+lightIndex);}if(updateOnlyBuffersList){return;}uniformsList.push("vLightData"+lightIndex,"vLightDiffuse"+lightIndex,"vLightSpecular"+lightIndex,"vLightDirection"+lightIndex,"vLightFalloff"+lightIndex,"vLightGround"+lightIndex,"lightMatrix"+lightIndex,"shadowsInfo"+lightIndex,"depthValues"+lightIndex);samplersList.push("shadowSampler"+lightIndex);samplersList.push("depthSampler"+lightIndex);uniformsList.push("viewFrustumZ"+lightIndex,"cascadeBlendFactor"+lightIndex,"lightSizeUVCorrection"+lightIndex,"depthCorrection"+lightIndex,"penumbraDarkness"+lightIndex,"frustumLengths"+lightIndex);if(projectedLightTexture){samplersList.push("projectionLightSampler"+lightIndex);uniformsList.push("textureProjectionMatrix"+lightIndex);}}},{key:"PrepareUniformsAndSamplersList",value:function PrepareUniformsAndSamplersList(uniformsListOrOptions,samplersList,defines){var maxSimultaneousLights=arguments.length>3&&arguments[3]!==undefined?arguments[3]:4;var uniformsList;var uniformBuffersList=null;if(uniformsListOrOptions.uniformsNames){var options=uniformsListOrOptions;uniformsList=options.uniformsNames;uniformBuffersList=options.uniformBuffersNames;samplersList=options.samplers;defines=options.defines;maxSimultaneousLights=options.maxSimultaneousLights||0;}else{uniformsList=uniformsListOrOptions;if(!samplersList){samplersList=[];}}for(var lightIndex=0;lightIndex<maxSimultaneousLights;lightIndex++){if(!defines["LIGHT"+lightIndex]){break;}this.PrepareUniformsAndSamplersForLight(lightIndex,uniformsList,samplersList,defines["PROJECTEDLIGHTTEXTURE"+lightIndex],uniformBuffersList);}if(defines["NUM_MORPH_INFLUENCERS"]){uniformsList.push("morphTargetInfluences");}if(defines["BAKED_VERTEX_ANIMATION_TEXTURE"]){uniformsList.push("bakedVertexAnimationSettings");uniformsList.push("bakedVertexAnimationTextureSizeInverted");uniformsList.push("bakedVertexAnimationTime");samplersList.push("bakedVertexAnimationTexture");}}},{key:"HandleFallbacksForShadows",value:function HandleFallbacksForShadows(defines,fallbacks){var maxSimultaneousLights=arguments.length>2&&arguments[2]!==undefined?arguments[2]:4;var rank=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var lightFallbackRank=0;for(var lightIndex=0;lightIndex<maxSimultaneousLights;lightIndex++){if(!defines["LIGHT"+lightIndex]){break;}if(lightIndex>0){lightFallbackRank=rank+lightIndex;fallbacks.addFallback(lightFallbackRank,"LIGHT"+lightIndex);}if(!defines["SHADOWS"]){if(defines["SHADOW"+lightIndex]){fallbacks.addFallback(rank,"SHADOW"+lightIndex);}if(defines["SHADOWPCF"+lightIndex]){fallbacks.addFallback(rank,"SHADOWPCF"+lightIndex);}if(defines["SHADOWPCSS"+lightIndex]){fallbacks.addFallback(rank,"SHADOWPCSS"+lightIndex);}if(defines["SHADOWPOISSON"+lightIndex]){fallbacks.addFallback(rank,"SHADOWPOISSON"+lightIndex);}if(defines["SHADOWESM"+lightIndex]){fallbacks.addFallback(rank,"SHADOWESM"+lightIndex);}if(defines["SHADOWCLOSEESM"+lightIndex]){fallbacks.addFallback(rank,"SHADOWCLOSEESM"+lightIndex);}}}return lightFallbackRank++;}},{key:"PrepareAttributesForMorphTargetsInfluencers",value:function PrepareAttributesForMorphTargetsInfluencers(attribs,mesh,influencers){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=influencers;this.PrepareAttributesForMorphTargets(attribs,mesh,this._TmpMorphInfluencers);}},{key:"PrepareAttributesForMorphTargets",value:function PrepareAttributesForMorphTargets(attribs,mesh,defines){var influencers=defines["NUM_MORPH_INFLUENCERS"];if(influencers>0&&EngineStore.LastCreatedEngine){var maxAttributesCount=EngineStore.LastCreatedEngine.getCaps().maxVertexAttribs;var manager=mesh.morphTargetManager;if(manager===null||manager===void 0?void 0:manager.isUsingTextureForTargets){return;}var normal=manager&&manager.supportsNormals&&defines["NORMAL"];var tangent=manager&&manager.supportsTangents&&defines["TANGENT"];var uv=manager&&manager.supportsUVs&&defines["UV1"];for(var index=0;index<influencers;index++){attribs.push(VertexBuffer.PositionKind+index);if(normal){attribs.push(VertexBuffer.NormalKind+index);}if(tangent){attribs.push(VertexBuffer.TangentKind+index);}if(uv){attribs.push(VertexBuffer.UVKind+"_"+index);}if(attribs.length>maxAttributesCount){Logger.Error("Cannot add more vertex attributes for mesh "+mesh.name);}}}}},{key:"PrepareAttributesForBakedVertexAnimation",value:function PrepareAttributesForBakedVertexAnimation(attribs,mesh,defines){var enabled=defines["BAKED_VERTEX_ANIMATION_TEXTURE"]&&defines["INSTANCES"];if(enabled){attribs.push("bakedVertexAnimationSettingsInstanced");}}},{key:"PrepareAttributesForBones",value:function PrepareAttributesForBones(attribs,mesh,defines,fallbacks){if(defines["NUM_BONE_INFLUENCERS"]>0){fallbacks.addCPUSkinningFallback(0,mesh);attribs.push(VertexBuffer.MatricesIndicesKind);attribs.push(VertexBuffer.MatricesWeightsKind);if(defines["NUM_BONE_INFLUENCERS"]>4){attribs.push(VertexBuffer.MatricesIndicesExtraKind);attribs.push(VertexBuffer.MatricesWeightsExtraKind);}}}},{key:"PrepareAttributesForInstances",value:function PrepareAttributesForInstances(attribs,defines){if(defines["INSTANCES"]||defines["THIN_INSTANCES"]){this.PushAttributesForInstances(attribs,!!defines["PREPASS_VELOCITY"]);}if(defines.INSTANCESCOLOR){attribs.push(VertexBuffer.ColorInstanceKind);}}},{key:"PushAttributesForInstances",value:function PushAttributesForInstances(attribs){var needsPreviousMatrices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;attribs.push("world0");attribs.push("world1");attribs.push("world2");attribs.push("world3");if(needsPreviousMatrices){attribs.push("previousWorld0");attribs.push("previousWorld1");attribs.push("previousWorld2");attribs.push("previousWorld3");}}},{key:"BindLightProperties",value:function BindLightProperties(light,effect,lightIndex){light.transferToEffect(effect,lightIndex+"");}},{key:"BindLight",value:function BindLight(light,lightIndex,scene2,effect,useSpecular){var receiveShadows=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;light._bindLight(lightIndex,scene2,effect,useSpecular,receiveShadows);}},{key:"BindLights",value:function BindLights(scene2,mesh,effect,defines){var maxSimultaneousLights=arguments.length>4&&arguments[4]!==undefined?arguments[4]:4;var len=Math.min(mesh.lightSources.length,maxSimultaneousLights);for(var i=0;i<len;i++){var light=mesh.lightSources[i];this.BindLight(light,i,scene2,effect,typeof defines==="boolean"?defines:defines["SPECULARTERM"],mesh.receiveShadows);}}},{key:"BindFogParameters",value:function BindFogParameters(scene2,mesh,effect){var linearSpace=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(scene2.fogEnabled&&mesh.applyFog&&scene2.fogMode!==Scene.FOGMODE_NONE){effect.setFloat4("vFogInfos",scene2.fogMode,scene2.fogStart,scene2.fogEnd,scene2.fogDensity);if(linearSpace){scene2.fogColor.toLinearSpaceToRef(this._TempFogColor);effect.setColor3("vFogColor",this._TempFogColor);}else{effect.setColor3("vFogColor",scene2.fogColor);}}}},{key:"BindBonesParameters",value:function BindBonesParameters(mesh,effect,prePassConfiguration){if(!effect||!mesh){return;}if(mesh.computeBonesUsingShaders&&effect._bonesComputationForcedToCPU){mesh.computeBonesUsingShaders=false;}if(mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton){var skeleton=mesh.skeleton;if(skeleton.isUsingTextureForMatrices&&effect.getUniformIndex("boneTextureWidth")>-1){var boneTexture=skeleton.getTransformMatrixTexture(mesh);effect.setTexture("boneSampler",boneTexture);effect.setFloat("boneTextureWidth",4*(skeleton.bones.length+1));}else{var matrices=skeleton.getTransformMatrices(mesh);if(matrices){effect.setMatrices("mBones",matrices);if(prePassConfiguration&&mesh.getScene().prePassRenderer&&mesh.getScene().prePassRenderer.getIndex(2)){if(!prePassConfiguration.previousBones[mesh.uniqueId]){prePassConfiguration.previousBones[mesh.uniqueId]=matrices.slice();}effect.setMatrices("mPreviousBones",prePassConfiguration.previousBones[mesh.uniqueId]);MaterialHelper._CopyBonesTransformationMatrices(matrices,prePassConfiguration.previousBones[mesh.uniqueId]);}}}}}},{key:"_CopyBonesTransformationMatrices",value:function _CopyBonesTransformationMatrices(source,target){target.set(source);return target;}},{key:"BindMorphTargetParameters",value:function BindMorphTargetParameters(abstractMesh,effect){var manager=abstractMesh.morphTargetManager;if(!abstractMesh||!manager){return;}effect.setFloatArray("morphTargetInfluences",manager.influences);}},{key:"BindLogDepth",value:function BindLogDepth(defines,effect,scene2){if(!defines||defines["LOGARITHMICDEPTH"]||defines.indexOf&&defines.indexOf("LOGARITHMICDEPTH")>=0){var camera=scene2.activeCamera;if(camera.mode===Camera.ORTHOGRAPHIC_CAMERA){Logger.Error("Logarithmic depth is not compatible with orthographic cameras!",20);}effect.setFloat("logarithmicDepthConstant",2/(Math.log(camera.maxZ+1)/Math.LN2));}}}]);return MaterialHelper;}();MaterialHelper._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0};MaterialHelper._TempFogColor=Color3.Black();// node_modules/@babylonjs/core/Materials/materialStencilState.js
var MaterialStencilState=/*#__PURE__*/function(){function MaterialStencilState(){_classCallCheck(this,MaterialStencilState);this.reset();}_createClass(MaterialStencilState,[{key:"reset",value:function reset(){this.enabled=false;this.mask=255;this.func=519;this.funcRef=1;this.funcMask=255;this.opStencilFail=7680;this.opDepthFail=7680;this.opStencilDepthPass=7681;}},{key:"func",get:function get(){return this._func;},set:function set(value){this._func=value;}},{key:"funcRef",get:function get(){return this._funcRef;},set:function set(value){this._funcRef=value;}},{key:"funcMask",get:function get(){return this._funcMask;},set:function set(value){this._funcMask=value;}},{key:"opStencilFail",get:function get(){return this._opStencilFail;},set:function set(value){this._opStencilFail=value;}},{key:"opDepthFail",get:function get(){return this._opDepthFail;},set:function set(value){this._opDepthFail=value;}},{key:"opStencilDepthPass",get:function get(){return this._opStencilDepthPass;},set:function set(value){this._opStencilDepthPass=value;}},{key:"mask",get:function get(){return this._mask;},set:function set(value){this._mask=value;}},{key:"enabled",get:function get(){return this._enabled;},set:function set(value){this._enabled=value;}},{key:"getClassName",value:function getClassName(){return"MaterialStencilState";}},{key:"copyTo",value:function copyTo(stencilState){SerializationHelper.Clone(function(){return stencilState;},this);}},{key:"serialize",value:function serialize(){return SerializationHelper.Serialize(this);}},{key:"parse",value:function parse(source,scene2,rootUrl){var _this80=this;SerializationHelper.Parse(function(){return _this80;},source,scene2,rootUrl);}}]);return MaterialStencilState;}();__decorate([serialize()],MaterialStencilState.prototype,"func",null);__decorate([serialize()],MaterialStencilState.prototype,"funcRef",null);__decorate([serialize()],MaterialStencilState.prototype,"funcMask",null);__decorate([serialize()],MaterialStencilState.prototype,"opStencilFail",null);__decorate([serialize()],MaterialStencilState.prototype,"opDepthFail",null);__decorate([serialize()],MaterialStencilState.prototype,"opStencilDepthPass",null);__decorate([serialize()],MaterialStencilState.prototype,"mask",null);__decorate([serialize()],MaterialStencilState.prototype,"enabled",null);// node_modules/@babylonjs/core/Materials/materialPluginEvent.js
var MaterialPluginEvent;(function(MaterialPluginEvent2){MaterialPluginEvent2[MaterialPluginEvent2["Created"]=1]="Created";MaterialPluginEvent2[MaterialPluginEvent2["Disposed"]=2]="Disposed";MaterialPluginEvent2[MaterialPluginEvent2["GetDefineNames"]=4]="GetDefineNames";MaterialPluginEvent2[MaterialPluginEvent2["PrepareUniformBuffer"]=8]="PrepareUniformBuffer";MaterialPluginEvent2[MaterialPluginEvent2["IsReadyForSubMesh"]=16]="IsReadyForSubMesh";MaterialPluginEvent2[MaterialPluginEvent2["PrepareDefines"]=32]="PrepareDefines";MaterialPluginEvent2[MaterialPluginEvent2["BindForSubMesh"]=64]="BindForSubMesh";MaterialPluginEvent2[MaterialPluginEvent2["PrepareEffect"]=128]="PrepareEffect";MaterialPluginEvent2[MaterialPluginEvent2["GetAnimatables"]=256]="GetAnimatables";MaterialPluginEvent2[MaterialPluginEvent2["GetActiveTextures"]=512]="GetActiveTextures";MaterialPluginEvent2[MaterialPluginEvent2["HasTexture"]=1024]="HasTexture";MaterialPluginEvent2[MaterialPluginEvent2["FillRenderTargetTextures"]=2048]="FillRenderTargetTextures";MaterialPluginEvent2[MaterialPluginEvent2["HasRenderTargetTextures"]=4096]="HasRenderTargetTextures";MaterialPluginEvent2[MaterialPluginEvent2["HardBindForSubMesh"]=8192]="HardBindForSubMesh";})(MaterialPluginEvent||(MaterialPluginEvent={}));// node_modules/@babylonjs/core/Materials/material.js
var Material=/*#__PURE__*/function(){function Material(name135,scene2,doNotAdd){_classCallCheck(this,Material);this.shadowDepthWrapper=null;this.allowShaderHotSwapping=true;this.metadata=null;this.reservedDataStore=null;this.checkReadyOnEveryCall=false;this.checkReadyOnlyOnce=false;this.state="";this._alpha=1;this._backFaceCulling=true;this._cullBackFaces=true;this._blockDirtyMechanism=false;this.onCompiled=null;this.onError=null;this.getRenderTargetTextures=null;this.doNotSerialize=false;this._storeEffectOnSubMeshes=false;this.animations=null;this.onDisposeObservable=new Observable();this._onDisposeObserver=null;this._onUnBindObservable=null;this._onBindObserver=null;this._alphaMode=2;this._needDepthPrePass=false;this.disableDepthWrite=false;this.disableColorWrite=false;this.forceDepthWrite=false;this.depthFunction=0;this.separateCullingPass=false;this._fogEnabled=true;this.pointSize=1;this.zOffset=0;this.zOffsetUnits=0;this.stencil=new MaterialStencilState();this._useUBO=false;this._fillMode=Material.TriangleFillMode;this._cachedDepthWriteState=false;this._cachedColorWriteState=false;this._cachedDepthFunctionState=0;this._indexInSceneMaterialArray=-1;this.meshMap=null;this._parentContainer=null;this._uniformBufferLayoutBuilt=false;this._eventInfo={};this._callbackPluginEventGeneric=function(){return void 0;};this._callbackPluginEventIsReadyForSubMesh=function(){return void 0;};this._callbackPluginEventPrepareDefines=function(){return void 0;};this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){return void 0;};this._callbackPluginEventHardBindForSubMesh=function(){return void 0;};this._callbackPluginEventBindForSubMesh=function(){return void 0;};this._callbackPluginEventHasRenderTargetTextures=function(){return void 0;};this._callbackPluginEventFillRenderTargetTextures=function(){return void 0;};this._forceAlphaTest=false;this._transparencyMode=null;this.name=name135;var setScene=scene2||EngineStore.LastCreatedScene;if(!setScene){return;}this._scene=setScene;this._dirtyCallbacks={};this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this);this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this);this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this);this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this);this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this);this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this);this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this);this.id=name135||Tools.RandomId();this.uniqueId=this._scene.getUniqueId();this._materialContext=this._scene.getEngine().createMaterialContext();this._drawWrapper=new DrawWrapper(this._scene.getEngine(),false);this._drawWrapper.materialContext=this._materialContext;if(this._scene.useRightHandedSystem){this.sideOrientation=Material.ClockWiseSideOrientation;}else{this.sideOrientation=Material.CounterClockWiseSideOrientation;}this._uniformBuffer=new UniformBuffer(this._scene.getEngine(),void 0,void 0,name135);this._useUBO=this.getScene().getEngine().supportsUniformBuffers;if(!doNotAdd){this._scene.addMaterial(this);}if(this._scene.useMaterialMeshMap){this.meshMap={};}Material.OnEventObservable.notifyObservers(this,MaterialPluginEvent.Created);}_createClass(Material,[{key:"canRenderToMRT",get:function get(){return false;}},{key:"alpha",get:function get(){return this._alpha;},set:function set(value){if(this._alpha===value){return;}var oldValue=this._alpha;this._alpha=value;if(oldValue===1||value===1){this.markAsDirty(Material.MiscDirtyFlag);}}},{key:"backFaceCulling",get:function get(){return this._backFaceCulling;},set:function set(value){if(this._backFaceCulling===value){return;}this._backFaceCulling=value;this.markAsDirty(Material.TextureDirtyFlag);}},{key:"cullBackFaces",get:function get(){return this._cullBackFaces;},set:function set(value){if(this._cullBackFaces===value){return;}this._cullBackFaces=value;this.markAsDirty(Material.TextureDirtyFlag);}},{key:"blockDirtyMechanism",get:function get(){return this._blockDirtyMechanism;},set:function set(value){if(this._blockDirtyMechanism===value){return;}this._blockDirtyMechanism=value;if(!value){this.markDirty();}}},{key:"atomicMaterialsUpdate",value:function atomicMaterialsUpdate(callback){this.blockDirtyMechanism=true;try{callback(this);}finally{this.blockDirtyMechanism=false;}}},{key:"hasRenderTargetTextures",get:function get(){this._eventInfo.hasRenderTargetTextures=false;this._callbackPluginEventHasRenderTargetTextures(this._eventInfo);return this._eventInfo.hasRenderTargetTextures;}},{key:"onDispose",set:function set(callback){if(this._onDisposeObserver){this.onDisposeObservable.remove(this._onDisposeObserver);}this._onDisposeObserver=this.onDisposeObservable.add(callback);}},{key:"onBindObservable",get:function get(){if(!this._onBindObservable){this._onBindObservable=new Observable();}return this._onBindObservable;}},{key:"onBind",set:function set(callback){if(this._onBindObserver){this.onBindObservable.remove(this._onBindObserver);}this._onBindObserver=this.onBindObservable.add(callback);}},{key:"onUnBindObservable",get:function get(){if(!this._onUnBindObservable){this._onUnBindObservable=new Observable();}return this._onUnBindObservable;}},{key:"onEffectCreatedObservable",get:function get(){if(!this._onEffectCreatedObservable){this._onEffectCreatedObservable=new Observable();}return this._onEffectCreatedObservable;}},{key:"alphaMode",get:function get(){return this._alphaMode;},set:function set(value){if(this._alphaMode===value){return;}this._alphaMode=value;this.markAsDirty(Material.TextureDirtyFlag);}},{key:"needDepthPrePass",get:function get(){return this._needDepthPrePass;},set:function set(value){if(this._needDepthPrePass===value){return;}this._needDepthPrePass=value;if(this._needDepthPrePass){this.checkReadyOnEveryCall=true;}}},{key:"isPrePassCapable",get:function get(){return false;}},{key:"fogEnabled",get:function get(){return this._fogEnabled;},set:function set(value){if(this._fogEnabled===value){return;}this._fogEnabled=value;this.markAsDirty(Material.MiscDirtyFlag);}},{key:"wireframe",get:function get(){switch(this._fillMode){case Material.WireFrameFillMode:case Material.LineListDrawMode:case Material.LineLoopDrawMode:case Material.LineStripDrawMode:return true;}return this._scene.forceWireframe;},set:function set(value){this.fillMode=value?Material.WireFrameFillMode:Material.TriangleFillMode;}},{key:"pointsCloud",get:function get(){switch(this._fillMode){case Material.PointFillMode:case Material.PointListDrawMode:return true;}return this._scene.forcePointsCloud;},set:function set(value){this.fillMode=value?Material.PointFillMode:Material.TriangleFillMode;}},{key:"fillMode",get:function get(){return this._fillMode;},set:function set(value){if(this._fillMode===value){return;}this._fillMode=value;this.markAsDirty(Material.MiscDirtyFlag);}},{key:"_getDrawWrapper",value:function _getDrawWrapper(){return this._drawWrapper;}},{key:"_setDrawWrapper",value:function _setDrawWrapper(drawWrapper){this._drawWrapper=drawWrapper;}},{key:"toString",value:function toString(fullDetails){var ret="Name: "+this.name;return ret;}},{key:"getClassName",value:function getClassName(){return"Material";}},{key:"_isMaterial",get:function get(){return true;}},{key:"isFrozen",get:function get(){return this.checkReadyOnlyOnce;}},{key:"freeze",value:function freeze(){this.markDirty();this.checkReadyOnlyOnce=true;}},{key:"unfreeze",value:function unfreeze(){this.markDirty();this.checkReadyOnlyOnce=false;}},{key:"isReady",value:function isReady(mesh,useInstances){return true;}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(mesh,subMesh,useInstances){var defines=subMesh.materialDefines;if(!defines){return false;}this._eventInfo.isReadyForSubMesh=true;this._eventInfo.defines=defines;this._callbackPluginEventIsReadyForSubMesh(this._eventInfo);return this._eventInfo.isReadyForSubMesh;}},{key:"getEffect",value:function getEffect(){return this._drawWrapper.effect;}},{key:"getScene",value:function getScene(){return this._scene;}},{key:"transparencyMode",get:function get(){return this._transparencyMode;},set:function set(value){if(this._transparencyMode===value){return;}this._transparencyMode=value;this._forceAlphaTest=value===Material.MATERIAL_ALPHATESTANDBLEND;this._markAllSubMeshesAsTexturesAndMiscDirty();}},{key:"_disableAlphaBlending",get:function get(){return this._transparencyMode===Material.MATERIAL_OPAQUE||this._transparencyMode===Material.MATERIAL_ALPHATEST;}},{key:"needAlphaBlending",value:function needAlphaBlending(){if(this._disableAlphaBlending){return false;}return this.alpha<1;}},{key:"needAlphaBlendingForMesh",value:function needAlphaBlendingForMesh(mesh){if(mesh.visibility<1){return true;}if(this._disableAlphaBlending){return false;}return mesh.hasVertexAlpha||this.needAlphaBlending();}},{key:"needAlphaTesting",value:function needAlphaTesting(){if(this._forceAlphaTest){return true;}return false;}},{key:"_shouldTurnAlphaTestOn",value:function _shouldTurnAlphaTestOn(mesh){return!this.needAlphaBlendingForMesh(mesh)&&this.needAlphaTesting();}},{key:"getAlphaTestTexture",value:function getAlphaTestTexture(){return null;}},{key:"markDirty",value:function markDirty(){var forceMaterialDirty=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var meshes=this.getScene().meshes;var _iterator103=_createForOfIteratorHelper(meshes),_step112;try{for(_iterator103.s();!(_step112=_iterator103.n()).done;){var mesh=_step112.value;if(!mesh.subMeshes){continue;}var _iterator104=_createForOfIteratorHelper(mesh.subMeshes),_step113;try{for(_iterator104.s();!(_step113=_iterator104.n()).done;){var subMesh=_step113.value;if(subMesh.getMaterial()!==this){continue;}if(!subMesh.effect){continue;}subMesh.effect._wasPreviouslyReady=false;subMesh.effect._wasPreviouslyUsingInstances=null;subMesh.effect._forceRebindOnNextCall=forceMaterialDirty;}}catch(err){_iterator104.e(err);}finally{_iterator104.f();}}}catch(err){_iterator103.e(err);}finally{_iterator103.f();}if(forceMaterialDirty){this.markAsDirty(Material.AllDirtyFlag);}}},{key:"_preBind",value:function _preBind(effect){var overrideOrientation=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var engine=this._scene.getEngine();var orientation=overrideOrientation==null?this.sideOrientation:overrideOrientation;var reverse=orientation===Material.ClockWiseSideOrientation;engine.enableEffect(effect?effect:this._getDrawWrapper());engine.setState(this.backFaceCulling,this.zOffset,false,reverse,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits);return reverse;}},{key:"bind",value:function bind(world,mesh){}},{key:"buildUniformLayout",value:function buildUniformLayout(){var ubo=this._uniformBuffer;this._eventInfo.ubo=ubo;this._callbackPluginEventGeneric(MaterialPluginEvent.PrepareUniformBuffer,this._eventInfo);ubo.create();this._uniformBufferLayoutBuilt=true;}},{key:"bindForSubMesh",value:function bindForSubMesh(world,mesh,subMesh){var effect=subMesh.effect;if(!effect){return;}this._eventInfo.subMesh=subMesh;this._callbackPluginEventBindForSubMesh(this._eventInfo);effect._forceRebindOnNextCall=false;}},{key:"bindOnlyWorldMatrix",value:function bindOnlyWorldMatrix(world){}},{key:"bindView",value:function bindView(effect){if(!this._useUBO){effect.setMatrix("view",this.getScene().getViewMatrix());}else{this._needToBindSceneUbo=true;}}},{key:"bindViewProjection",value:function bindViewProjection(effect){if(!this._useUBO){effect.setMatrix("viewProjection",this.getScene().getTransformMatrix());effect.setMatrix("projection",this.getScene().getProjectionMatrix());}else{this._needToBindSceneUbo=true;}}},{key:"bindEyePosition",value:function bindEyePosition(effect,variableName){if(!this._useUBO){this._scene.bindEyePosition(effect,variableName);}else{this._needToBindSceneUbo=true;}}},{key:"_afterBind",value:function _afterBind(mesh){var effect=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this._scene._cachedMaterial=this;if(this._needToBindSceneUbo){if(effect){this._needToBindSceneUbo=false;MaterialHelper.BindSceneUniformBuffer(effect,this.getScene().getSceneUniformBuffer());this._scene.finalizeSceneUbo();}}if(mesh){this._scene._cachedVisibility=mesh.visibility;}else{this._scene._cachedVisibility=1;}if(this._onBindObservable&&mesh){this._onBindObservable.notifyObservers(mesh);}if(this.disableDepthWrite){var engine=this._scene.getEngine();this._cachedDepthWriteState=engine.getDepthWrite();engine.setDepthWrite(false);}if(this.disableColorWrite){var _engine=this._scene.getEngine();this._cachedColorWriteState=_engine.getColorWrite();_engine.setColorWrite(false);}if(this.depthFunction!==0){var _engine2=this._scene.getEngine();this._cachedDepthFunctionState=_engine2.getDepthFunction()||0;_engine2.setDepthFunction(this.depthFunction);}}},{key:"unbind",value:function unbind(){if(this._onUnBindObservable){this._onUnBindObservable.notifyObservers(this);}if(this.depthFunction!==0){var engine=this._scene.getEngine();engine.setDepthFunction(this._cachedDepthFunctionState);}if(this.disableDepthWrite){var _engine3=this._scene.getEngine();_engine3.setDepthWrite(this._cachedDepthWriteState);}if(this.disableColorWrite){var _engine4=this._scene.getEngine();_engine4.setColorWrite(this._cachedColorWriteState);}}},{key:"getAnimatables",value:function getAnimatables(){this._eventInfo.animatables=[];this._callbackPluginEventGeneric(MaterialPluginEvent.GetAnimatables,this._eventInfo);return this._eventInfo.animatables;}},{key:"getActiveTextures",value:function getActiveTextures(){this._eventInfo.activeTextures=[];this._callbackPluginEventGeneric(MaterialPluginEvent.GetActiveTextures,this._eventInfo);return this._eventInfo.activeTextures;}},{key:"hasTexture",value:function hasTexture(texture){this._eventInfo.hasTexture=false;this._eventInfo.texture=texture;this._callbackPluginEventGeneric(MaterialPluginEvent.HasTexture,this._eventInfo);return this._eventInfo.hasTexture;}},{key:"clone",value:function clone(name135){return null;}},{key:"getBindedMeshes",value:function getBindedMeshes(){var _this81=this;if(this.meshMap){var result=new Array();for(var meshId in this.meshMap){var mesh=this.meshMap[meshId];if(mesh){result.push(mesh);}}return result;}else{var meshes=this._scene.meshes;return meshes.filter(function(mesh){return mesh.material===_this81;});}}},{key:"forceCompilation",value:function forceCompilation(mesh,onCompiled,options,onError){var _this82=this;var localOptions=_objectSpread({clipPlane:false,useInstances:false},options);var scene2=this.getScene();var currentHotSwapingState=this.allowShaderHotSwapping;this.allowShaderHotSwapping=false;var checkReady=function checkReady(){if(!_this82._scene||!_this82._scene.getEngine()){return;}var clipPlaneState=scene2.clipPlane;if(localOptions.clipPlane){scene2.clipPlane=new Plane(0,0,0,1);}if(_this82._storeEffectOnSubMeshes){var allDone=true,lastError=null;if(mesh.subMeshes){var tempSubMesh=new SubMesh(0,0,0,0,0,mesh,void 0,false,false);if(tempSubMesh.materialDefines){tempSubMesh.materialDefines._renderId=-1;}if(!_this82.isReadyForSubMesh(mesh,tempSubMesh,localOptions.useInstances)){if(tempSubMesh.effect&&tempSubMesh.effect.getCompilationError()&&tempSubMesh.effect.allFallbacksProcessed()){lastError=tempSubMesh.effect.getCompilationError();}else{allDone=false;setTimeout(checkReady,16);}}}if(allDone){_this82.allowShaderHotSwapping=currentHotSwapingState;if(lastError){if(onError){onError(lastError);}}if(onCompiled){onCompiled(_this82);}}}else{if(_this82.isReady()){_this82.allowShaderHotSwapping=currentHotSwapingState;if(onCompiled){onCompiled(_this82);}}else{setTimeout(checkReady,16);}}if(localOptions.clipPlane){scene2.clipPlane=clipPlaneState;}};checkReady();}},{key:"forceCompilationAsync",value:function forceCompilationAsync(mesh,options){var _this83=this;return new Promise(function(resolve,reject){_this83.forceCompilation(mesh,function(){resolve();},options,function(reason){reject(reason);});});}},{key:"markAsDirty",value:function markAsDirty(flag){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism){return;}Material._DirtyCallbackArray.length=0;if(flag&Material.TextureDirtyFlag){Material._DirtyCallbackArray.push(Material._TextureDirtyCallBack);}if(flag&Material.LightDirtyFlag){Material._DirtyCallbackArray.push(Material._LightsDirtyCallBack);}if(flag&Material.FresnelDirtyFlag){Material._DirtyCallbackArray.push(Material._FresnelDirtyCallBack);}if(flag&Material.AttributesDirtyFlag){Material._DirtyCallbackArray.push(Material._AttributeDirtyCallBack);}if(flag&Material.MiscDirtyFlag){Material._DirtyCallbackArray.push(Material._MiscDirtyCallBack);}if(flag&Material.PrePassDirtyFlag){Material._DirtyCallbackArray.push(Material._PrePassDirtyCallBack);}if(Material._DirtyCallbackArray.length){this._markAllSubMeshesAsDirty(Material._RunDirtyCallBacks);}this.getScene().resetCachedMaterial();}},{key:"resetDrawCache",value:function resetDrawCache(){var meshes=this.getScene().meshes;var _iterator105=_createForOfIteratorHelper(meshes),_step114;try{for(_iterator105.s();!(_step114=_iterator105.n()).done;){var mesh=_step114.value;if(!mesh.subMeshes){continue;}var _iterator106=_createForOfIteratorHelper(mesh.subMeshes),_step115;try{for(_iterator106.s();!(_step115=_iterator106.n()).done;){var subMesh=_step115.value;if(subMesh.getMaterial()!==this){continue;}subMesh.resetDrawCache();}}catch(err){_iterator106.e(err);}finally{_iterator106.f();}}}catch(err){_iterator105.e(err);}finally{_iterator105.f();}}},{key:"_markAllSubMeshesAsDirty",value:function _markAllSubMeshesAsDirty(func){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism){return;}var meshes=this.getScene().meshes;var _iterator107=_createForOfIteratorHelper(meshes),_step116;try{for(_iterator107.s();!(_step116=_iterator107.n()).done;){var mesh=_step116.value;if(!mesh.subMeshes){continue;}var _iterator108=_createForOfIteratorHelper(mesh.subMeshes),_step117;try{for(_iterator108.s();!(_step117=_iterator108.n()).done;){var subMesh=_step117.value;if(subMesh.getMaterial(false)!==this){continue;}var _iterator109=_createForOfIteratorHelper(subMesh._drawWrappers),_step118;try{for(_iterator109.s();!(_step118=_iterator109.n()).done;){var drawWrapper=_step118.value;if(!drawWrapper||!drawWrapper.defines||!drawWrapper.defines.markAllAsDirty){continue;}if(this._materialContext===drawWrapper.materialContext){func(drawWrapper.defines);}}}catch(err){_iterator109.e(err);}finally{_iterator109.f();}}}catch(err){_iterator108.e(err);}finally{_iterator108.f();}}}catch(err){_iterator107.e(err);}finally{_iterator107.f();}}},{key:"_markScenePrePassDirty",value:function _markScenePrePassDirty(){if(this.getScene().blockMaterialDirtyMechanism||this._blockDirtyMechanism){return;}var prePassRenderer=this.getScene().enablePrePassRenderer();if(prePassRenderer){prePassRenderer.markAsDirty();}}},{key:"_markAllSubMeshesAsAllDirty",value:function _markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(Material._AllDirtyCallBack);}},{key:"_markAllSubMeshesAsImageProcessingDirty",value:function _markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(Material._ImageProcessingDirtyCallBack);}},{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(Material._TextureDirtyCallBack);}},{key:"_markAllSubMeshesAsFresnelDirty",value:function _markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(Material._FresnelDirtyCallBack);}},{key:"_markAllSubMeshesAsFresnelAndMiscDirty",value:function _markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(Material._FresnelAndMiscDirtyCallBack);}},{key:"_markAllSubMeshesAsLightsDirty",value:function _markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(Material._LightsDirtyCallBack);}},{key:"_markAllSubMeshesAsAttributesDirty",value:function _markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(Material._AttributeDirtyCallBack);}},{key:"_markAllSubMeshesAsMiscDirty",value:function _markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(Material._MiscDirtyCallBack);}},{key:"_markAllSubMeshesAsPrePassDirty",value:function _markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(Material._MiscDirtyCallBack);}},{key:"_markAllSubMeshesAsTexturesAndMiscDirty",value:function _markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(Material._TextureAndMiscDirtyCallBack);}},{key:"setPrePassRenderer",value:function setPrePassRenderer(prePassRenderer){return false;}},{key:"dispose",value:function dispose(forceDisposeEffect,forceDisposeTextures,notBoundToMesh){var scene2=this.getScene();scene2.stopAnimation(this);scene2.freeProcessedMaterials();scene2.removeMaterial(this);this._eventInfo.forceDisposeTextures=forceDisposeTextures;this._callbackPluginEventGeneric(MaterialPluginEvent.Disposed,this._eventInfo);if(this._parentContainer){var index=this._parentContainer.materials.indexOf(this);if(index>-1){this._parentContainer.materials.splice(index,1);}this._parentContainer=null;}if(notBoundToMesh!==true){if(this.meshMap){for(var meshId in this.meshMap){var mesh=this.meshMap[meshId];if(mesh){mesh.material=null;this.releaseVertexArrayObject(mesh,forceDisposeEffect);}}}else{var meshes=scene2.meshes;var _iterator110=_createForOfIteratorHelper(meshes),_step119;try{for(_iterator110.s();!(_step119=_iterator110.n()).done;){var _mesh2=_step119.value;if(_mesh2.material===this&&!_mesh2.sourceMesh){_mesh2.material=null;this.releaseVertexArrayObject(_mesh2,forceDisposeEffect);}}}catch(err){_iterator110.e(err);}finally{_iterator110.f();}}}this._uniformBuffer.dispose();if(forceDisposeEffect&&this._drawWrapper.effect){if(!this._storeEffectOnSubMeshes){this._drawWrapper.effect.dispose();}this._drawWrapper.effect=null;}this.metadata=null;this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();if(this._onBindObservable){this._onBindObservable.clear();}if(this._onUnBindObservable){this._onUnBindObservable.clear();}if(this._onEffectCreatedObservable){this._onEffectCreatedObservable.clear();}if(this._eventInfo){this._eventInfo={};}}},{key:"releaseVertexArrayObject",value:function releaseVertexArrayObject(mesh,forceDisposeEffect){if(mesh.geometry){var geometry=mesh.geometry;if(this._storeEffectOnSubMeshes){var _iterator111=_createForOfIteratorHelper(mesh.subMeshes),_step120;try{for(_iterator111.s();!(_step120=_iterator111.n()).done;){var subMesh=_step120.value;geometry._releaseVertexArrayObject(subMesh.effect);if(forceDisposeEffect&&subMesh.effect){subMesh.effect.dispose();}}}catch(err){_iterator111.e(err);}finally{_iterator111.f();}}else{geometry._releaseVertexArrayObject(this._drawWrapper.effect);}}}},{key:"serialize",value:function serialize(){var serializationObject=SerializationHelper.Serialize(this);serializationObject.stencil=this.stencil.serialize();serializationObject.uniqueId=this.uniqueId;return serializationObject;}}],[{key:"Parse",value:function Parse(parsedMaterial,scene2,rootUrl){if(!parsedMaterial.customType){parsedMaterial.customType="BABYLON.StandardMaterial";}else if(parsedMaterial.customType==="BABYLON.PBRMaterial"&&parsedMaterial.overloadedAlbedo){parsedMaterial.customType="BABYLON.LegacyPBRMaterial";if(!BABYLON.LegacyPBRMaterial){Logger.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library.");return null;}}var materialType=Tools.Instantiate(parsedMaterial.customType);var material=materialType.Parse(parsedMaterial,scene2,rootUrl);material._loadedUniqueId=parsedMaterial.uniqueId;return material;}}]);return Material;}();Material.TriangleFillMode=0;Material.WireFrameFillMode=1;Material.PointFillMode=2;Material.PointListDrawMode=3;Material.LineListDrawMode=4;Material.LineLoopDrawMode=5;Material.LineStripDrawMode=6;Material.TriangleStripDrawMode=7;Material.TriangleFanDrawMode=8;Material.ClockWiseSideOrientation=0;Material.CounterClockWiseSideOrientation=1;Material.TextureDirtyFlag=1;Material.LightDirtyFlag=2;Material.FresnelDirtyFlag=4;Material.AttributesDirtyFlag=8;Material.MiscDirtyFlag=16;Material.PrePassDirtyFlag=32;Material.AllDirtyFlag=63;Material.MATERIAL_OPAQUE=0;Material.MATERIAL_ALPHATEST=1;Material.MATERIAL_ALPHABLEND=2;Material.MATERIAL_ALPHATESTANDBLEND=3;Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0;Material.MATERIAL_NORMALBLENDMETHOD_RNM=1;Material.OnEventObservable=new Observable();Material._AllDirtyCallBack=function(defines){return defines.markAllAsDirty();};Material._ImageProcessingDirtyCallBack=function(defines){return defines.markAsImageProcessingDirty();};Material._TextureDirtyCallBack=function(defines){return defines.markAsTexturesDirty();};Material._FresnelDirtyCallBack=function(defines){return defines.markAsFresnelDirty();};Material._MiscDirtyCallBack=function(defines){return defines.markAsMiscDirty();};Material._PrePassDirtyCallBack=function(defines){return defines.markAsPrePassDirty();};Material._LightsDirtyCallBack=function(defines){return defines.markAsLightDirty();};Material._AttributeDirtyCallBack=function(defines){return defines.markAsAttributesDirty();};Material._FresnelAndMiscDirtyCallBack=function(defines){Material._FresnelDirtyCallBack(defines);Material._MiscDirtyCallBack(defines);};Material._TextureAndMiscDirtyCallBack=function(defines){Material._TextureDirtyCallBack(defines);Material._MiscDirtyCallBack(defines);};Material._DirtyCallbackArray=[];Material._RunDirtyCallBacks=function(defines){var _iterator112=_createForOfIteratorHelper(Material._DirtyCallbackArray),_step121;try{for(_iterator112.s();!(_step121=_iterator112.n()).done;){var cb=_step121.value;cb(defines);}}catch(err){_iterator112.e(err);}finally{_iterator112.f();}};__decorate([serialize()],Material.prototype,"id",void 0);__decorate([serialize()],Material.prototype,"uniqueId",void 0);__decorate([serialize()],Material.prototype,"name",void 0);__decorate([serialize()],Material.prototype,"metadata",void 0);__decorate([serialize()],Material.prototype,"checkReadyOnEveryCall",void 0);__decorate([serialize()],Material.prototype,"checkReadyOnlyOnce",void 0);__decorate([serialize()],Material.prototype,"state",void 0);__decorate([serialize("alpha")],Material.prototype,"_alpha",void 0);__decorate([serialize("backFaceCulling")],Material.prototype,"_backFaceCulling",void 0);__decorate([serialize("cullBackFaces")],Material.prototype,"_cullBackFaces",void 0);__decorate([serialize()],Material.prototype,"sideOrientation",void 0);__decorate([serialize("alphaMode")],Material.prototype,"_alphaMode",void 0);__decorate([serialize()],Material.prototype,"_needDepthPrePass",void 0);__decorate([serialize()],Material.prototype,"disableDepthWrite",void 0);__decorate([serialize()],Material.prototype,"disableColorWrite",void 0);__decorate([serialize()],Material.prototype,"forceDepthWrite",void 0);__decorate([serialize()],Material.prototype,"depthFunction",void 0);__decorate([serialize()],Material.prototype,"separateCullingPass",void 0);__decorate([serialize("fogEnabled")],Material.prototype,"_fogEnabled",void 0);__decorate([serialize()],Material.prototype,"pointSize",void 0);__decorate([serialize()],Material.prototype,"zOffset",void 0);__decorate([serialize()],Material.prototype,"zOffsetUnits",void 0);__decorate([serialize()],Material.prototype,"pointsCloud",null);__decorate([serialize()],Material.prototype,"fillMode",null);__decorate([serialize()],Material.prototype,"transparencyMode",null);// node_modules/@babylonjs/core/Materials/multiMaterial.js
var MultiMaterial=/*#__PURE__*/function(_Material){_inherits(MultiMaterial,_Material);var _super24=_createSuper(MultiMaterial);function MultiMaterial(name135,scene2){var _this84;_classCallCheck(this,MultiMaterial);_this84=_super24.call(this,name135,scene2,true);_this84._waitingSubMaterialsUniqueIds=[];_this84.getScene().multiMaterials.push(_assertThisInitialized(_this84));_this84.subMaterials=new Array();_this84._storeEffectOnSubMeshes=true;return _this84;}_createClass(MultiMaterial,[{key:"subMaterials",get:function get(){return this._subMaterials;},set:function set(value){this._subMaterials=value;this._hookArray(value);}},{key:"getChildren",value:function getChildren(){return this.subMaterials;}},{key:"_hookArray",value:function _hookArray(array){var _this85=this;var oldPush=array.push;array.push=function(){for(var _len11=arguments.length,items=new Array(_len11),_key10=0;_key10<_len11;_key10++){items[_key10]=arguments[_key10];}var result=oldPush.apply(array,items);_this85._markAllSubMeshesAsTexturesDirty();return result;};var oldSplice=array.splice;array.splice=function(index,deleteCount){var deleted=oldSplice.apply(array,[index,deleteCount]);_this85._markAllSubMeshesAsTexturesDirty();return deleted;};}},{key:"getSubMaterial",value:function getSubMaterial(index){if(index<0||index>=this.subMaterials.length){return this.getScene().defaultMaterial;}return this.subMaterials[index];}},{key:"getActiveTextures",value:function getActiveTextures(){var _get$call;return(_get$call=_get(_getPrototypeOf(MultiMaterial.prototype),"getActiveTextures",this).call(this)).concat.apply(_get$call,_toConsumableArray(this.subMaterials.map(function(subMaterial){if(subMaterial){return subMaterial.getActiveTextures();}else{return[];}})));}},{key:"hasTexture",value:function hasTexture(texture){var _a;if(_get(_getPrototypeOf(MultiMaterial.prototype),"hasTexture",this).call(this,texture)){return true;}for(var i=0;i<this.subMaterials.length;i++){if((_a=this.subMaterials[i])===null||_a===void 0?void 0:_a.hasTexture(texture)){return true;}}return false;}},{key:"getClassName",value:function getClassName(){return"MultiMaterial";}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(mesh,subMesh,useInstances){for(var index=0;index<this.subMaterials.length;index++){var subMaterial=this.subMaterials[index];if(subMaterial){if(subMaterial._storeEffectOnSubMeshes){if(!subMaterial.isReadyForSubMesh(mesh,subMesh,useInstances)){return false;}continue;}if(!subMaterial.isReady(mesh)){return false;}}}return true;}},{key:"clone",value:function clone(name135,cloneChildren){var newMultiMaterial=new MultiMaterial(name135,this.getScene());for(var index=0;index<this.subMaterials.length;index++){var subMaterial=null;var current=this.subMaterials[index];if(cloneChildren&&current){subMaterial=current.clone(name135+"-"+current.name);}else{subMaterial=this.subMaterials[index];}newMultiMaterial.subMaterials.push(subMaterial);}return newMultiMaterial;}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.name=this.name;serializationObject.id=this.id;serializationObject.uniqueId=this.uniqueId;if(Tags){serializationObject.tags=Tags.GetTags(this);}serializationObject.materialsUniqueIds=[];serializationObject.materials=[];for(var matIndex=0;matIndex<this.subMaterials.length;matIndex++){var subMat=this.subMaterials[matIndex];if(subMat){serializationObject.materialsUniqueIds.push(subMat.uniqueId);serializationObject.materials.push(subMat.id);}else{serializationObject.materialsUniqueIds.push(null);serializationObject.materials.push(null);}}return serializationObject;}},{key:"dispose",value:function dispose(forceDisposeEffect,forceDisposeTextures,forceDisposeChildren){var scene2=this.getScene();if(!scene2){return;}if(forceDisposeChildren){for(var index2=0;index2<this.subMaterials.length;index2++){var subMaterial=this.subMaterials[index2];if(subMaterial){subMaterial.dispose(forceDisposeEffect,forceDisposeTextures);}}}var index=scene2.multiMaterials.indexOf(this);if(index>=0){scene2.multiMaterials.splice(index,1);}_get(_getPrototypeOf(MultiMaterial.prototype),"dispose",this).call(this,forceDisposeEffect,forceDisposeTextures);}}],[{key:"ParseMultiMaterial",value:function ParseMultiMaterial(parsedMultiMaterial,scene2){var multiMaterial=new MultiMaterial(parsedMultiMaterial.name,scene2);multiMaterial.id=parsedMultiMaterial.id;multiMaterial._loadedUniqueId=parsedMultiMaterial.uniqueId;if(Tags){Tags.AddTagsTo(multiMaterial,parsedMultiMaterial.tags);}if(parsedMultiMaterial.materialsUniqueIds){multiMaterial._waitingSubMaterialsUniqueIds=parsedMultiMaterial.materialsUniqueIds;}else{parsedMultiMaterial.materials.forEach(function(subMatId){return multiMaterial.subMaterials.push(scene2.getLastMaterialById(subMatId));});}return multiMaterial;}}]);return MultiMaterial;}(Material);RegisterClass("BABYLON.MultiMaterial",MultiMaterial);// node_modules/@babylonjs/core/Meshes/meshLODLevel.js
var MeshLODLevel=/*#__PURE__*/_createClass(function MeshLODLevel(distanceOrScreenCoverage,mesh){_classCallCheck(this,MeshLODLevel);this.distanceOrScreenCoverage=distanceOrScreenCoverage;this.mesh=mesh;});// node_modules/@babylonjs/core/Meshes/mesh.js
var _InstanceDataStorage=/*#__PURE__*/_createClass(function _InstanceDataStorage(){_classCallCheck(this,_InstanceDataStorage);this.visibleInstances={};this.batchCache=new _InstancesBatch();this.batchCacheReplacementModeInFrozenMode=new _InstancesBatch();this.instancesBufferSize=32*16*4;});var _InstancesBatch=/*#__PURE__*/_createClass(function _InstancesBatch(){_classCallCheck(this,_InstancesBatch);this.mustReturn=false;this.visibleInstances=new Array();this.renderSelf=new Array();this.hardwareInstancedRendering=new Array();});var _ThinInstanceDataStorage=/*#__PURE__*/_createClass(function _ThinInstanceDataStorage(){_classCallCheck(this,_ThinInstanceDataStorage);this.instancesCount=0;this.matrixBuffer=null;this.previousMatrixBuffer=null;this.matrixBufferSize=32*16;this.matrixData=null;this.boundingVectors=[];this.worldMatrices=null;});var _InternalMeshDataInfo=/*#__PURE__*/_createClass(function _InternalMeshDataInfo(){_classCallCheck(this,_InternalMeshDataInfo);this._areNormalsFrozen=false;this._source=null;this.meshMap=null;this._preActivateId=-1;this._LODLevels=new Array();this._useLODScreenCoverage=false;this._effectiveMaterial=null;this._forcedInstanceCount=0;});var Mesh=/*#__PURE__*/function(_AbstractMesh){_inherits(Mesh,_AbstractMesh);var _super25=_createSuper(Mesh);function Mesh(name135){var _this86;var scene2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var parent=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var source=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var doNotCloneChildren=arguments.length>4?arguments[4]:undefined;var clonePhysicsImpostor=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;_classCallCheck(this,Mesh);_this86=_super25.call(this,name135,scene2);_this86._internalMeshDataInfo=new _InternalMeshDataInfo();_this86.delayLoadState=0;_this86.instances=new Array();_this86._creationDataStorage=null;_this86._geometry=null;_this86._instanceDataStorage=new _InstanceDataStorage();_this86._thinInstanceDataStorage=new _ThinInstanceDataStorage();_this86._shouldGenerateFlatShading=false;_this86._originalBuilderSideOrientation=Mesh.DEFAULTSIDE;_this86.overrideMaterialSideOrientation=null;_this86.ignoreCameraMaxZ=false;scene2=_this86.getScene();_this86._onBeforeDraw=function(isInstance,world,effectiveMaterial){if(isInstance&&effectiveMaterial){if(_this86._uniformBuffer){_this86.transferToEffect(world);}else{effectiveMaterial.bindOnlyWorldMatrix(world);}}};if(source){if(source._geometry){source._geometry.applyToMesh(_assertThisInitialized(_this86));}DeepCopier.DeepCopy(source,_assertThisInitialized(_this86),["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]);_this86._internalMeshDataInfo._source=source;if(scene2.useClonedMeshMap){if(!source._internalMeshDataInfo.meshMap){source._internalMeshDataInfo.meshMap={};}source._internalMeshDataInfo.meshMap[_this86.uniqueId]=_assertThisInitialized(_this86);}_this86._originalBuilderSideOrientation=source._originalBuilderSideOrientation;_this86._creationDataStorage=source._creationDataStorage;if(source._ranges){var ranges=source._ranges;for(var name136 in ranges){if(!Object.prototype.hasOwnProperty.call(ranges,name136)){continue;}if(!ranges[name136]){continue;}_this86.createAnimationRange(name136,ranges[name136].from,ranges[name136].to);}}if(source.metadata&&source.metadata.clone){_this86.metadata=source.metadata.clone();}else{_this86.metadata=source.metadata;}_this86._internalMetadata=source._internalMetadata;if(Tags&&Tags.HasTags(source)){Tags.AddTagsTo(_assertThisInitialized(_this86),Tags.GetTags(source,true));}_this86.setEnabled(source.isEnabled(false));_this86.parent=source.parent;_this86.setPivotMatrix(source.getPivotMatrix());_this86.id=name135+"."+source.id;_this86.material=source.material;if(!doNotCloneChildren){var directDescendants=source.getDescendants(true);for(var index=0;index<directDescendants.length;index++){var child=directDescendants[index];if(child.clone){child.clone(name135+"."+child.name,_assertThisInitialized(_this86));}}}if(source.morphTargetManager){_this86.morphTargetManager=source.morphTargetManager;}if(scene2.getPhysicsEngine){var physicsEngine=scene2.getPhysicsEngine();if(clonePhysicsImpostor&&physicsEngine&&physicsEngine.getPluginVersion()===1){var impostor=physicsEngine.getImpostorForPhysicsObject(source);if(impostor){_this86.physicsImpostor=impostor.clone(_assertThisInitialized(_this86));}}}for(var _index20=0;_index20<scene2.particleSystems.length;_index20++){var system=scene2.particleSystems[_index20];if(system.emitter===source){system.clone(system.name,_assertThisInitialized(_this86));}}_this86.skeleton=source.skeleton;_this86.refreshBoundingInfo(true,true);_this86.computeWorldMatrix(true);}if(parent!==null){_this86.parent=parent;}_this86._instanceDataStorage.hardwareInstancedRendering=_this86.getEngine().getCaps().instancedArrays;_this86._internalMeshDataInfo._onMeshReadyObserverAdded=function(observer){observer.unregisterOnNextCall=true;if(_this86.isReady(true)){_this86.onMeshReadyObservable.notifyObservers(_assertThisInitialized(_this86));}else{if(!_this86._internalMeshDataInfo._checkReadinessObserver){_this86._internalMeshDataInfo._checkReadinessObserver=_this86._scene.onBeforeRenderObservable.add(function(){if(_this86.isReady(true)){_this86._scene.onBeforeRenderObservable.remove(_this86._internalMeshDataInfo._checkReadinessObserver);_this86._internalMeshDataInfo._checkReadinessObserver=null;_this86.onMeshReadyObservable.notifyObservers(_assertThisInitialized(_this86));}});}}};_this86.onMeshReadyObservable=new Observable(_this86._internalMeshDataInfo._onMeshReadyObserverAdded);if(source){source.onClonedObservable.notifyObservers(_assertThisInitialized(_this86));}return _this86;}_createClass(Mesh,[{key:"useLODScreenCoverage",get:function get(){return this._internalMeshDataInfo._useLODScreenCoverage;},set:function set(value){this._internalMeshDataInfo._useLODScreenCoverage=value;this._sortLODLevels();}},{key:"computeBonesUsingShaders",get:function get(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders;},set:function set(value){if(this._internalAbstractMeshDataInfo._computeBonesUsingShaders===value){return;}if(value&&this._internalMeshDataInfo._sourcePositions){this.setVerticesData(VertexBuffer.PositionKind,this._internalMeshDataInfo._sourcePositions,true);if(this._internalMeshDataInfo._sourceNormals){this.setVerticesData(VertexBuffer.NormalKind,this._internalMeshDataInfo._sourceNormals,true);}this._internalMeshDataInfo._sourcePositions=null;this._internalMeshDataInfo._sourceNormals=null;}this._internalAbstractMeshDataInfo._computeBonesUsingShaders=value;this._markSubMeshesAsAttributesDirty();}},{key:"onBeforeRenderObservable",get:function get(){if(!this._internalMeshDataInfo._onBeforeRenderObservable){this._internalMeshDataInfo._onBeforeRenderObservable=new Observable();}return this._internalMeshDataInfo._onBeforeRenderObservable;}},{key:"onBeforeBindObservable",get:function get(){if(!this._internalMeshDataInfo._onBeforeBindObservable){this._internalMeshDataInfo._onBeforeBindObservable=new Observable();}return this._internalMeshDataInfo._onBeforeBindObservable;}},{key:"onAfterRenderObservable",get:function get(){if(!this._internalMeshDataInfo._onAfterRenderObservable){this._internalMeshDataInfo._onAfterRenderObservable=new Observable();}return this._internalMeshDataInfo._onAfterRenderObservable;}},{key:"onBetweenPassObservable",get:function get(){if(!this._internalMeshDataInfo._onBetweenPassObservable){this._internalMeshDataInfo._onBetweenPassObservable=new Observable();}return this._internalMeshDataInfo._onBetweenPassObservable;}},{key:"onBeforeDrawObservable",get:function get(){if(!this._internalMeshDataInfo._onBeforeDrawObservable){this._internalMeshDataInfo._onBeforeDrawObservable=new Observable();}return this._internalMeshDataInfo._onBeforeDrawObservable;}},{key:"onBeforeDraw",set:function set(callback){if(this._onBeforeDrawObserver){this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver);}this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(callback);}},{key:"hasInstances",get:function get(){return this.instances.length>0;}},{key:"hasThinInstances",get:function get(){var _a;return((_a=this._thinInstanceDataStorage.instancesCount)!==null&&_a!==void 0?_a:0)>0;}},{key:"forcedInstanceCount",get:function get(){return this._internalMeshDataInfo._forcedInstanceCount;},set:function set(count){this._internalMeshDataInfo._forcedInstanceCount=count;}},{key:"source",get:function get(){return this._internalMeshDataInfo._source;}},{key:"cloneMeshMap",get:function get(){return this._internalMeshDataInfo.meshMap;}},{key:"isUnIndexed",get:function get(){return this._unIndexed;},set:function set(value){if(this._unIndexed!==value){this._unIndexed=value;this._markSubMeshesAsAttributesDirty();}}},{key:"worldMatrixInstancedBuffer",get:function get(){return this._instanceDataStorage.instancesData;}},{key:"previousWorldMatrixInstancedBuffer",get:function get(){return this._instanceDataStorage.instancesPreviousData;}},{key:"manualUpdateOfWorldMatrixInstancedBuffer",get:function get(){return this._instanceDataStorage.manualUpdate;},set:function set(value){this._instanceDataStorage.manualUpdate=value;}},{key:"manualUpdateOfPreviousWorldMatrixInstancedBuffer",get:function get(){return this._instanceDataStorage.previousManualUpdate;},set:function set(value){this._instanceDataStorage.previousManualUpdate=value;}},{key:"forceWorldMatrixInstancedBufferUpdate",get:function get(){return this._instanceDataStorage.forceMatrixUpdates;},set:function set(value){this._instanceDataStorage.forceMatrixUpdates=value;}},{key:"instantiateHierarchy",value:function instantiateHierarchy(){var newParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var options=arguments.length>1?arguments[1]:undefined;var onNewNodeCreated=arguments.length>2?arguments[2]:undefined;var instance=this.getTotalVertices()===0||options&&options.doNotInstantiate&&(options.doNotInstantiate===true||options.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),newParent||this.parent,true):this.createInstance("instance of "+(this.name||this.id));instance.parent=newParent||this.parent;instance.position=this.position.clone();instance.scaling=this.scaling.clone();if(this.rotationQuaternion){instance.rotationQuaternion=this.rotationQuaternion.clone();}else{instance.rotation=this.rotation.clone();}if(onNewNodeCreated){onNewNodeCreated(this,instance);}var _iterator113=_createForOfIteratorHelper(this.getChildTransformNodes(true)),_step122;try{for(_iterator113.s();!(_step122=_iterator113.n()).done;){var child=_step122.value;if(child.getClassName()==="InstancedMesh"&&instance.getClassName()==="Mesh"&&child.sourceMesh===this){child.instantiateHierarchy(instance,{doNotInstantiate:options&&options.doNotInstantiate||false,newSourcedMesh:instance},onNewNodeCreated);}else{child.instantiateHierarchy(instance,options,onNewNodeCreated);}}}catch(err){_iterator113.e(err);}finally{_iterator113.f();}return instance;}},{key:"getClassName",value:function getClassName(){return"Mesh";}},{key:"_isMesh",get:function get(){return true;}},{key:"toString",value:function toString(fullDetails){var ret=_get(_getPrototypeOf(Mesh.prototype),"toString",this).call(this,fullDetails);ret+=", n vertices: "+this.getTotalVertices();ret+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE");if(this.animations){for(var i=0;i<this.animations.length;i++){ret+=", animation[0]: "+this.animations[i].toString(fullDetails);}}if(fullDetails){if(this._geometry){var ib=this.getIndices();var vb=this.getVerticesData(VertexBuffer.PositionKind);if(vb&&ib){ret+=", flat shading: "+(vb.length/3===ib.length?"YES":"NO");}}else{ret+=", flat shading: UNKNOWN";}}return ret;}},{key:"_unBindEffect",value:function _unBindEffect(){_get(_getPrototypeOf(Mesh.prototype),"_unBindEffect",this).call(this);var _iterator114=_createForOfIteratorHelper(this.instances),_step123;try{for(_iterator114.s();!(_step123=_iterator114.n()).done;){var instance=_step123.value;instance._unBindEffect();}}catch(err){_iterator114.e(err);}finally{_iterator114.f();}}},{key:"hasLODLevels",get:function get(){return this._internalMeshDataInfo._LODLevels.length>0;}},{key:"getLODLevels",value:function getLODLevels(){return this._internalMeshDataInfo._LODLevels;}},{key:"_sortLODLevels",value:function _sortLODLevels(){var sortingOrderFactor=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(function(a,b){if(a.distanceOrScreenCoverage<b.distanceOrScreenCoverage){return sortingOrderFactor;}if(a.distanceOrScreenCoverage>b.distanceOrScreenCoverage){return-sortingOrderFactor;}return 0;});}},{key:"addLODLevel",value:function addLODLevel(distanceOrScreenCoverage,mesh){if(mesh&&mesh._masterMesh){Logger.Warn("You cannot use a mesh as LOD level twice");return this;}var level=new MeshLODLevel(distanceOrScreenCoverage,mesh);this._internalMeshDataInfo._LODLevels.push(level);if(mesh){mesh._masterMesh=this;}this._sortLODLevels();return this;}},{key:"getLODLevelAtDistance",value:function getLODLevelAtDistance(distance){var internalDataInfo=this._internalMeshDataInfo;for(var index=0;index<internalDataInfo._LODLevels.length;index++){var level=internalDataInfo._LODLevels[index];if(level.distanceOrScreenCoverage===distance){return level.mesh;}}return null;}},{key:"removeLODLevel",value:function removeLODLevel(mesh){var internalDataInfo=this._internalMeshDataInfo;for(var index=0;index<internalDataInfo._LODLevels.length;index++){if(internalDataInfo._LODLevels[index].mesh===mesh){internalDataInfo._LODLevels.splice(index,1);if(mesh){mesh._masterMesh=null;}}}this._sortLODLevels();return this;}},{key:"getLOD",value:function getLOD(camera,boundingSphere){var internalDataInfo=this._internalMeshDataInfo;if(!internalDataInfo._LODLevels||internalDataInfo._LODLevels.length===0){return this;}var bSphere=boundingSphere||this.getBoundingInfo().boundingSphere;var distanceToCamera=camera.mode===Camera.ORTHOGRAPHIC_CAMERA?camera.minZ:bSphere.centerWorld.subtract(camera.globalPosition).length();var compareValue=distanceToCamera;var compareSign=1;if(internalDataInfo._useLODScreenCoverage){var screenArea=camera.screenArea;var meshArea=bSphere.radiusWorld*camera.minZ/distanceToCamera;meshArea=meshArea*meshArea*Math.PI;compareValue=meshArea/screenArea;compareSign=-1;}if(compareSign*internalDataInfo._LODLevels[internalDataInfo._LODLevels.length-1].distanceOrScreenCoverage>compareSign*compareValue){if(this.onLODLevelSelection){this.onLODLevelSelection(compareValue,this,this);}return this;}for(var index=0;index<internalDataInfo._LODLevels.length;index++){var level=internalDataInfo._LODLevels[index];if(compareSign*level.distanceOrScreenCoverage<compareSign*compareValue){if(level.mesh){if(level.mesh.delayLoadState===4){level.mesh._checkDelayState();return this;}if(level.mesh.delayLoadState===2){return this;}level.mesh._preActivate();level.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache);}if(this.onLODLevelSelection){this.onLODLevelSelection(compareValue,this,level.mesh);}return level.mesh;}}if(this.onLODLevelSelection){this.onLODLevelSelection(compareValue,this,this);}return this;}},{key:"geometry",get:function get(){return this._geometry;}},{key:"getTotalVertices",value:function getTotalVertices(){if(this._geometry===null||this._geometry===void 0){return 0;}return this._geometry.getTotalVertices();}},{key:"getVerticesData",value:function getVerticesData(kind,copyWhenShared,forceCopy){var _a,_b;if(!this._geometry){return null;}var data=(_b=(_a=this._userInstancedBuffersStorage)===null||_a===void 0?void 0:_a.vertexBuffers[kind])===null||_b===void 0?void 0:_b.getFloatData(this._geometry.getTotalVertices(),forceCopy||copyWhenShared&&this._geometry.meshes.length!==1);if(!data){data=this._geometry.getVerticesData(kind,copyWhenShared,forceCopy);}return data;}},{key:"getVertexBuffer",value:function getVertexBuffer(kind){var _a,_b;if(!this._geometry){return null;}return(_b=(_a=this._userInstancedBuffersStorage)===null||_a===void 0?void 0:_a.vertexBuffers[kind])!==null&&_b!==void 0?_b:this._geometry.getVertexBuffer(kind);}},{key:"isVerticesDataPresent",value:function isVerticesDataPresent(kind){var _a;if(!this._geometry){if(this._delayInfo){return this._delayInfo.indexOf(kind)!==-1;}return false;}return((_a=this._userInstancedBuffersStorage)===null||_a===void 0?void 0:_a.vertexBuffers[kind])!==void 0||this._geometry.isVerticesDataPresent(kind);}},{key:"isVertexBufferUpdatable",value:function isVertexBufferUpdatable(kind){var _a,_b;if(!this._geometry){if(this._delayInfo){return this._delayInfo.indexOf(kind)!==-1;}return false;}return((_b=(_a=this._userInstancedBuffersStorage)===null||_a===void 0?void 0:_a.vertexBuffers[kind])===null||_b===void 0?void 0:_b.isUpdatable())||this._geometry.isVertexBufferUpdatable(kind);}},{key:"getVerticesDataKinds",value:function getVerticesDataKinds(){if(!this._geometry){var result=new Array();if(this._delayInfo){this._delayInfo.forEach(function(kind){result.push(kind);});}return result;}var kinds=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage){for(var kind in this._userInstancedBuffersStorage.vertexBuffers){kinds.push(kind);}}return kinds;}},{key:"getTotalIndices",value:function getTotalIndices(){if(!this._geometry){return 0;}return this._geometry.getTotalIndices();}},{key:"getIndices",value:function getIndices(copyWhenShared,forceCopy){if(!this._geometry){return[];}return this._geometry.getIndices(copyWhenShared,forceCopy);}},{key:"isBlocked",get:function get(){return this._masterMesh!==null&&this._masterMesh!==void 0;}},{key:"isReady",value:function isReady(){var completeCheck=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var forceInstanceSupport=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _a,_b,_c,_d,_e,_f;if(this.delayLoadState===2){return false;}if(!_get(_getPrototypeOf(Mesh.prototype),"isReady",this).call(this,completeCheck)){return false;}if(!this.subMeshes||this.subMeshes.length===0){return true;}if(!completeCheck){return true;}var engine=this.getEngine();var scene2=this.getScene();var hardwareInstancedRendering=forceInstanceSupport||engine.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var mat=this.material||scene2.defaultMaterial;if(mat){if(mat._storeEffectOnSubMeshes){var _iterator115=_createForOfIteratorHelper(this.subMeshes),_step124;try{for(_iterator115.s();!(_step124=_iterator115.n()).done;){var subMesh=_step124.value;var effectiveMaterial=subMesh.getMaterial();if(effectiveMaterial){if(effectiveMaterial._storeEffectOnSubMeshes){if(!effectiveMaterial.isReadyForSubMesh(this,subMesh,hardwareInstancedRendering)){return false;}}else{if(!effectiveMaterial.isReady(this,hardwareInstancedRendering)){return false;}}}}}catch(err){_iterator115.e(err);}finally{_iterator115.f();}}else{if(!mat.isReady(this,hardwareInstancedRendering)){return false;}}}var currentRenderPassId=engine.currentRenderPassId;var _iterator116=_createForOfIteratorHelper(this.lightSources),_step125;try{for(_iterator116.s();!(_step125=_iterator116.n()).done;){var light=_step125.value;var generators=light.getShadowGenerators();if(!generators){continue;}var iterator=generators.values();for(var key=iterator.next();key.done!==true;key=iterator.next()){var generator=key.value;if(generator&&(!((_a=generator.getShadowMap())===null||_a===void 0?void 0:_a.renderList)||((_b=generator.getShadowMap())===null||_b===void 0?void 0:_b.renderList)&&((_d=(_c=generator.getShadowMap())===null||_c===void 0?void 0:_c.renderList)===null||_d===void 0?void 0:_d.indexOf(this))!==-1)){if(generator.getShadowMap()){engine.currentRenderPassId=generator.getShadowMap().renderPassId;}var _iterator118=_createForOfIteratorHelper(this.subMeshes),_step127;try{for(_iterator118.s();!(_step127=_iterator118.n()).done;){var _subMesh2=_step127.value;if(!generator.isReady(_subMesh2,hardwareInstancedRendering,(_f=(_e=_subMesh2.getMaterial())===null||_e===void 0?void 0:_e.needAlphaBlendingForMesh(this))!==null&&_f!==void 0?_f:false)){engine.currentRenderPassId=currentRenderPassId;return false;}}}catch(err){_iterator118.e(err);}finally{_iterator118.f();}engine.currentRenderPassId=currentRenderPassId;}}}}catch(err){_iterator116.e(err);}finally{_iterator116.f();}var _iterator117=_createForOfIteratorHelper(this._internalMeshDataInfo._LODLevels),_step126;try{for(_iterator117.s();!(_step126=_iterator117.n()).done;){var lod=_step126.value;if(lod.mesh&&!lod.mesh.isReady(hardwareInstancedRendering)){return false;}}}catch(err){_iterator117.e(err);}finally{_iterator117.f();}return true;}},{key:"areNormalsFrozen",get:function get(){return this._internalMeshDataInfo._areNormalsFrozen;}},{key:"freezeNormals",value:function freezeNormals(){this._internalMeshDataInfo._areNormalsFrozen=true;return this;}},{key:"unfreezeNormals",value:function unfreezeNormals(){this._internalMeshDataInfo._areNormalsFrozen=false;return this;}},{key:"overridenInstanceCount",set:function set(count){this._instanceDataStorage.overridenInstanceCount=count;}},{key:"_preActivate",value:function _preActivate(){var internalDataInfo=this._internalMeshDataInfo;var sceneRenderId=this.getScene().getRenderId();if(internalDataInfo._preActivateId===sceneRenderId){return this;}internalDataInfo._preActivateId=sceneRenderId;this._instanceDataStorage.visibleInstances=null;return this;}},{key:"_preActivateForIntermediateRendering",value:function _preActivateForIntermediateRendering(renderId){if(this._instanceDataStorage.visibleInstances){this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=renderId;}return this;}},{key:"_registerInstanceForRenderId",value:function _registerInstanceForRenderId(instance,renderId){if(!this._instanceDataStorage.visibleInstances){this._instanceDataStorage.visibleInstances={defaultRenderId:renderId,selfDefaultRenderId:this._renderId};}if(!this._instanceDataStorage.visibleInstances[renderId]){if(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen){this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null;}this._instanceDataStorage.previousRenderId=renderId;this._instanceDataStorage.visibleInstances[renderId]=new Array();}this._instanceDataStorage.visibleInstances[renderId].push(instance);return this;}},{key:"_afterComputeWorldMatrix",value:function _afterComputeWorldMatrix(){_get(_getPrototypeOf(Mesh.prototype),"_afterComputeWorldMatrix",this).call(this);if(!this.hasThinInstances){return;}if(!this.doNotSyncBoundingInfo){this.thinInstanceRefreshBoundingInfo(false);}}},{key:"_postActivate",value:function _postActivate(){if(this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup){this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer);this.edgesRenderer.customInstances.push(this.getWorldMatrix());}}},{key:"refreshBoundingInfo",value:function refreshBoundingInfo(){var applySkeleton=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applyMorph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked){return this;}var bias=this.geometry?this.geometry.boundingBias:null;this._refreshBoundingInfo(this._getPositionData(applySkeleton,applyMorph),bias);return this;}},{key:"_createGlobalSubMesh",value:function _createGlobalSubMesh(force){var totalVertices=this.getTotalVertices();if(!totalVertices||!this.getIndices()){return null;}if(this.subMeshes&&this.subMeshes.length>0){var ib=this.getIndices();if(!ib){return null;}var totalIndices=ib.length;var needToRecreate=false;if(force){needToRecreate=true;}else{var _iterator119=_createForOfIteratorHelper(this.subMeshes),_step128;try{for(_iterator119.s();!(_step128=_iterator119.n()).done;){var submesh=_step128.value;if(submesh.indexStart+submesh.indexCount>totalIndices){needToRecreate=true;break;}if(submesh.verticesStart+submesh.verticesCount>totalVertices){needToRecreate=true;break;}}}catch(err){_iterator119.e(err);}finally{_iterator119.f();}}if(!needToRecreate){return this.subMeshes[0];}}this.releaseSubMeshes();return new SubMesh(0,0,totalVertices,0,this.getTotalIndices(),this);}},{key:"subdivide",value:function subdivide(count){if(count<1){return;}var totalIndices=this.getTotalIndices();var subdivisionSize=totalIndices/count|0;var offset=0;while(subdivisionSize%3!==0){subdivisionSize++;}this.releaseSubMeshes();for(var index=0;index<count;index++){if(offset>=totalIndices){break;}SubMesh.CreateFromIndices(0,offset,index===count-1?totalIndices-offset:subdivisionSize,this);offset+=subdivisionSize;}this.synchronizeInstances();}},{key:"setVerticesData",value:function setVerticesData(kind,data){var updatable=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var stride=arguments.length>3?arguments[3]:undefined;if(!this._geometry){var vertexData=new VertexData();vertexData.set(data,kind);var scene2=this.getScene();new Geometry(Geometry.RandomId(),scene2,vertexData,updatable,this);}else{this._geometry.setVerticesData(kind,data,updatable,stride);}return this;}},{key:"removeVerticesData",value:function removeVerticesData(kind){if(!this._geometry){return;}this._geometry.removeVerticesData(kind);}},{key:"markVerticesDataAsUpdatable",value:function markVerticesDataAsUpdatable(kind){var updatable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var vb=this.getVertexBuffer(kind);if(!vb||vb.isUpdatable()===updatable){return;}this.setVerticesData(kind,this.getVerticesData(kind),updatable);}},{key:"setVerticesBuffer",value:function setVerticesBuffer(buffer){var disposeExistingBuffer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this._geometry){this._geometry=Geometry.CreateGeometryForMesh(this);}this._geometry.setVerticesBuffer(buffer,null,disposeExistingBuffer);return this;}},{key:"updateVerticesData",value:function updateVerticesData(kind,data,updateExtends,makeItUnique){if(!this._geometry){return this;}if(!makeItUnique){this._geometry.updateVerticesData(kind,data,updateExtends);}else{this.makeGeometryUnique();this.updateVerticesData(kind,data,updateExtends,false);}return this;}},{key:"updateMeshPositions",value:function updateMeshPositions(positionFunction){var computeNormals=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var positions=this.getVerticesData(VertexBuffer.PositionKind);if(!positions){return this;}positionFunction(positions);this.updateVerticesData(VertexBuffer.PositionKind,positions,false,false);if(computeNormals){var indices=this.getIndices();var normals=this.getVerticesData(VertexBuffer.NormalKind);if(!normals){return this;}VertexData.ComputeNormals(positions,indices,normals);this.updateVerticesData(VertexBuffer.NormalKind,normals,false,false);}return this;}},{key:"makeGeometryUnique",value:function makeGeometryUnique(){if(!this._geometry){return this;}if(this._geometry.meshes.length===1){return this;}var oldGeometry=this._geometry;var geometry=this._geometry.copy(Geometry.RandomId());oldGeometry.releaseForMesh(this,true);geometry.applyToMesh(this);return this;}},{key:"setIndices",value:function setIndices(indices){var totalVertices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var updatable=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._geometry){var vertexData=new VertexData();vertexData.indices=indices;var scene2=this.getScene();new Geometry(Geometry.RandomId(),scene2,vertexData,updatable,this);}else{this._geometry.setIndices(indices,totalVertices,updatable);}return this;}},{key:"updateIndices",value:function updateIndices(indices,offset){var gpuMemoryOnly=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._geometry){return this;}this._geometry.updateIndices(indices,offset,gpuMemoryOnly);return this;}},{key:"toLeftHanded",value:function toLeftHanded(){if(!this._geometry){return this;}this._geometry.toLeftHanded();return this;}},{key:"_bind",value:function _bind(subMesh,effect,fillMode){if(!this._geometry){return this;}var engine=this.getScene().getEngine();if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets){this.morphTargetManager._bind(effect);}var indexToBind;if(this._unIndexed){indexToBind=null;}else{switch(fillMode){case Material.PointFillMode:indexToBind=null;break;case Material.WireFrameFillMode:indexToBind=subMesh._getLinesIndexBuffer(this.getIndices(),engine);break;default:case Material.TriangleFillMode:indexToBind=this._geometry.getIndexBuffer();break;}}if(!this._userInstancedBuffersStorage||this.hasThinInstances){this._geometry._bind(effect,indexToBind);}else{this._geometry._bind(effect,indexToBind,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects);}return this;}},{key:"_draw",value:function _draw(subMesh,fillMode,instancesCount){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer()){return this;}if(this._internalMeshDataInfo._onBeforeDrawObservable){this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);}var scene2=this.getScene();var engine=scene2.getEngine();if(this._unIndexed||fillMode==Material.PointFillMode){engine.drawArraysType(fillMode,subMesh.verticesStart,subMesh.verticesCount,this.forcedInstanceCount||instancesCount);}else if(fillMode==Material.WireFrameFillMode){engine.drawElementsType(fillMode,0,subMesh._linesIndexCount,this.forcedInstanceCount||instancesCount);}else{engine.drawElementsType(fillMode,subMesh.indexStart,subMesh.indexCount,this.forcedInstanceCount||instancesCount);}return this;}},{key:"registerBeforeRender",value:function registerBeforeRender(func){this.onBeforeRenderObservable.add(func);return this;}},{key:"unregisterBeforeRender",value:function unregisterBeforeRender(func){this.onBeforeRenderObservable.removeCallback(func);return this;}},{key:"registerAfterRender",value:function registerAfterRender(func){this.onAfterRenderObservable.add(func);return this;}},{key:"unregisterAfterRender",value:function unregisterAfterRender(func){this.onAfterRenderObservable.removeCallback(func);return this;}},{key:"_getInstancesRenderList",value:function _getInstancesRenderList(subMeshId){var isReplacementMode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._instanceDataStorage.isFrozen){if(isReplacementMode){this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[subMeshId]=false;this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[subMeshId]=true;return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;}if(this._instanceDataStorage.previousBatch){return this._instanceDataStorage.previousBatch;}}var scene2=this.getScene();var isInIntermediateRendering=scene2._isInIntermediateRendering();var onlyForInstances=isInIntermediateRendering?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances;var batchCache=this._instanceDataStorage.batchCache;batchCache.mustReturn=false;batchCache.renderSelf[subMeshId]=isReplacementMode||!onlyForInstances&&this.isEnabled()&&this.isVisible;batchCache.visibleInstances[subMeshId]=null;if(this._instanceDataStorage.visibleInstances&&!isReplacementMode){var visibleInstances=this._instanceDataStorage.visibleInstances;var currentRenderId=scene2.getRenderId();var defaultRenderId=isInIntermediateRendering?visibleInstances.intermediateDefaultRenderId:visibleInstances.defaultRenderId;batchCache.visibleInstances[subMeshId]=visibleInstances[currentRenderId];if(!batchCache.visibleInstances[subMeshId]&&defaultRenderId){batchCache.visibleInstances[subMeshId]=visibleInstances[defaultRenderId];}}batchCache.hardwareInstancedRendering[subMeshId]=!isReplacementMode&&this._instanceDataStorage.hardwareInstancedRendering&&batchCache.visibleInstances[subMeshId]!==null&&batchCache.visibleInstances[subMeshId]!==void 0;this._instanceDataStorage.previousBatch=batchCache;return batchCache;}},{key:"_renderWithInstances",value:function _renderWithInstances(subMesh,fillMode,batch,effect,engine){var _a;var visibleInstances=batch.visibleInstances[subMesh._id];var visibleInstanceCount=visibleInstances?visibleInstances.length:0;var instanceStorage=this._instanceDataStorage;var currentInstancesBufferSize=instanceStorage.instancesBufferSize;var instancesBuffer=instanceStorage.instancesBuffer;var instancesPreviousBuffer=instanceStorage.instancesPreviousBuffer;var matricesCount=visibleInstanceCount+1;var bufferSize=matricesCount*16*4;while(instanceStorage.instancesBufferSize<bufferSize){instanceStorage.instancesBufferSize*=2;}if(!instanceStorage.instancesData||currentInstancesBufferSize!=instanceStorage.instancesBufferSize){instanceStorage.instancesData=new Float32Array(instanceStorage.instancesBufferSize/4);}if(this._scene.needsPreviousWorldMatrices&&!instanceStorage.instancesPreviousData||currentInstancesBufferSize!=instanceStorage.instancesBufferSize){instanceStorage.instancesPreviousData=new Float32Array(instanceStorage.instancesBufferSize/4);}var offset=0;var instancesCount=0;var renderSelf=batch.renderSelf[subMesh._id];var needUpdateBuffer=!instancesBuffer||currentInstancesBufferSize!==instanceStorage.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!instanceStorage.instancesPreviousBuffer;if(!this._instanceDataStorage.manualUpdate&&(!instanceStorage.isFrozen||needUpdateBuffer)){var world=this.getWorldMatrix();if(renderSelf){if(this._scene.needsPreviousWorldMatrices){if(!instanceStorage.masterMeshPreviousWorldMatrix){instanceStorage.masterMeshPreviousWorldMatrix=world.clone();instanceStorage.masterMeshPreviousWorldMatrix.copyToArray(instanceStorage.instancesPreviousData,offset);}else{instanceStorage.masterMeshPreviousWorldMatrix.copyToArray(instanceStorage.instancesPreviousData,offset);instanceStorage.masterMeshPreviousWorldMatrix.copyFrom(world);}}world.copyToArray(instanceStorage.instancesData,offset);offset+=16;instancesCount++;}if(visibleInstances){if(Mesh.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&((_a=subMesh.getMaterial())===null||_a===void 0?void 0:_a.needAlphaBlendingForMesh(subMesh.getRenderingMesh()))){var cameraPosition=this._scene.activeCamera.globalPosition;for(var instanceIndex=0;instanceIndex<visibleInstances.length;instanceIndex++){var instanceMesh=visibleInstances[instanceIndex];instanceMesh._distanceToCamera=Vector3.Distance(instanceMesh.getBoundingInfo().boundingSphere.centerWorld,cameraPosition);}visibleInstances.sort(function(m1,m2){return m1._distanceToCamera>m2._distanceToCamera?-1:m1._distanceToCamera<m2._distanceToCamera?1:0;});}for(var _instanceIndex=0;_instanceIndex<visibleInstances.length;_instanceIndex++){var instance=visibleInstances[_instanceIndex];var matrix=instance.getWorldMatrix();matrix.copyToArray(instanceStorage.instancesData,offset);if(this._scene.needsPreviousWorldMatrices){if(!instance._previousWorldMatrix){instance._previousWorldMatrix=matrix.clone();instance._previousWorldMatrix.copyToArray(instanceStorage.instancesPreviousData,offset);}else{instance._previousWorldMatrix.copyToArray(instanceStorage.instancesPreviousData,offset);instance._previousWorldMatrix.copyFrom(matrix);}}offset+=16;instancesCount++;}}}else{instancesCount=(renderSelf?1:0)+visibleInstanceCount;}if(needUpdateBuffer){if(instancesBuffer){instancesBuffer.dispose();}if(instancesPreviousBuffer){instancesPreviousBuffer.dispose();}instancesBuffer=new Buffer2(engine,instanceStorage.instancesData,true,16,false,true);instanceStorage.instancesBuffer=instancesBuffer;if(!this._userInstancedBuffersStorage){this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0};}this._userInstancedBuffersStorage.vertexBuffers["world0"]=instancesBuffer.createVertexBuffer("world0",0,4);this._userInstancedBuffersStorage.vertexBuffers["world1"]=instancesBuffer.createVertexBuffer("world1",4,4);this._userInstancedBuffersStorage.vertexBuffers["world2"]=instancesBuffer.createVertexBuffer("world2",8,4);this._userInstancedBuffersStorage.vertexBuffers["world3"]=instancesBuffer.createVertexBuffer("world3",12,4);if(this._scene.needsPreviousWorldMatrices){instancesPreviousBuffer=new Buffer2(engine,instanceStorage.instancesPreviousData,true,16,false,true);instanceStorage.instancesPreviousBuffer=instancesPreviousBuffer;this._userInstancedBuffersStorage.vertexBuffers["previousWorld0"]=instancesPreviousBuffer.createVertexBuffer("previousWorld0",0,4);this._userInstancedBuffersStorage.vertexBuffers["previousWorld1"]=instancesPreviousBuffer.createVertexBuffer("previousWorld1",4,4);this._userInstancedBuffersStorage.vertexBuffers["previousWorld2"]=instancesPreviousBuffer.createVertexBuffer("previousWorld2",8,4);this._userInstancedBuffersStorage.vertexBuffers["previousWorld3"]=instancesPreviousBuffer.createVertexBuffer("previousWorld3",12,4);}this._invalidateInstanceVertexArrayObject();}else{if(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates){instancesBuffer.updateDirectly(instanceStorage.instancesData,0,instancesCount);if(this._scene.needsPreviousWorldMatrices&&(!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.previousManualUpdate)){instancesPreviousBuffer.updateDirectly(instanceStorage.instancesPreviousData,0,instancesCount);}}}this._processInstancedBuffers(visibleInstances,renderSelf);this.getScene()._activeIndices.addCount(subMesh.indexCount*instancesCount,false);if(engine._currentDrawContext){engine._currentDrawContext.useInstancing=true;}this._bind(subMesh,effect,fillMode);this._draw(subMesh,fillMode,instancesCount);if(this._scene.needsPreviousWorldMatrices&&!needUpdateBuffer&&this._instanceDataStorage.manualUpdate&&(!this._instanceDataStorage.isFrozen||this._instanceDataStorage.forceMatrixUpdates)&&!this._instanceDataStorage.previousManualUpdate){instancesPreviousBuffer.updateDirectly(instanceStorage.instancesData,0,instancesCount);}engine.unbindInstanceAttributes();return this;}},{key:"_renderWithThinInstances",value:function _renderWithThinInstances(subMesh,fillMode,effect,engine){var _a,_b;var instancesCount=(_b=(_a=this._thinInstanceDataStorage)===null||_a===void 0?void 0:_a.instancesCount)!==null&&_b!==void 0?_b:0;this.getScene()._activeIndices.addCount(subMesh.indexCount*instancesCount,false);if(engine._currentDrawContext){engine._currentDrawContext.useInstancing=true;}this._bind(subMesh,effect,fillMode);this._draw(subMesh,fillMode,instancesCount);if(this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData){if(!this._thinInstanceDataStorage.previousMatrixBuffer){this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,false);}else{this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,instancesCount);}}engine.unbindInstanceAttributes();}},{key:"_processInstancedBuffers",value:function _processInstancedBuffers(visibleInstances,renderSelf){}},{key:"_processRendering",value:function _processRendering(renderingMesh,subMesh,effect,fillMode,batch,hardwareInstancedRendering,onBeforeDraw,effectiveMaterial){var scene2=this.getScene();var engine=scene2.getEngine();if(hardwareInstancedRendering&&subMesh.getRenderingMesh().hasThinInstances){this._renderWithThinInstances(subMesh,fillMode,effect,engine);return this;}if(hardwareInstancedRendering){this._renderWithInstances(subMesh,fillMode,batch,effect,engine);}else{if(engine._currentDrawContext){engine._currentDrawContext.useInstancing=false;}var instanceCount=0;if(batch.renderSelf[subMesh._id]){if(onBeforeDraw){onBeforeDraw(false,renderingMesh.getWorldMatrix(),effectiveMaterial);}instanceCount++;this._draw(subMesh,fillMode,this._instanceDataStorage.overridenInstanceCount);}var visibleInstancesForSubMesh=batch.visibleInstances[subMesh._id];if(visibleInstancesForSubMesh){var visibleInstanceCount=visibleInstancesForSubMesh.length;instanceCount+=visibleInstanceCount;for(var instanceIndex=0;instanceIndex<visibleInstanceCount;instanceIndex++){var instance=visibleInstancesForSubMesh[instanceIndex];var world=instance.getWorldMatrix();if(onBeforeDraw){onBeforeDraw(true,world,effectiveMaterial);}this._draw(subMesh,fillMode);}}scene2._activeIndices.addCount(subMesh.indexCount*instanceCount,false);}return this;}},{key:"_rebuild",value:function _rebuild(){var dispose=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this._instanceDataStorage.instancesBuffer){if(dispose){this._instanceDataStorage.instancesBuffer.dispose();}this._instanceDataStorage.instancesBuffer=null;}if(this._userInstancedBuffersStorage){for(var kind in this._userInstancedBuffersStorage.vertexBuffers){var buffer=this._userInstancedBuffersStorage.vertexBuffers[kind];if(buffer){if(dispose){buffer.dispose();}this._userInstancedBuffersStorage.vertexBuffers[kind]=null;}}if(this._userInstancedBuffersStorage.vertexArrayObjects){this._userInstancedBuffersStorage.vertexArrayObjects={};}}this._internalMeshDataInfo._effectiveMaterial=null;_get(_getPrototypeOf(Mesh.prototype),"_rebuild",this).call(this,dispose);}},{key:"_freeze",value:function _freeze(){if(!this.subMeshes){return;}for(var index=0;index<this.subMeshes.length;index++){this._getInstancesRenderList(index);}this._internalMeshDataInfo._effectiveMaterial=null;this._instanceDataStorage.isFrozen=true;}},{key:"_unFreeze",value:function _unFreeze(){this._instanceDataStorage.isFrozen=false;this._instanceDataStorage.previousBatch=null;}},{key:"render",value:function render(subMesh,enableAlphaMode,effectiveMeshReplacement){var _a,_b,_c;var scene2=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate){this._internalAbstractMeshDataInfo._isActiveIntermediate=false;}else{this._internalAbstractMeshDataInfo._isActive=false;}if(this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded){return this;}var batch=this._getInstancesRenderList(subMesh._id,!!effectiveMeshReplacement);if(batch.mustReturn){return this;}if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer()){return this;}var engine=scene2.getEngine();var oldCameraMaxZ=0;var oldCamera=null;if(this.ignoreCameraMaxZ&&scene2.activeCamera&&!scene2._isInIntermediateRendering()){oldCameraMaxZ=scene2.activeCamera.maxZ;oldCamera=scene2.activeCamera;scene2.activeCamera.maxZ=0;scene2.updateTransformMatrix(true);}if(this._internalMeshDataInfo._onBeforeRenderObservable){this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);}var renderingMesh=subMesh.getRenderingMesh();var hardwareInstancedRendering=batch.hardwareInstancedRendering[subMesh._id]||renderingMesh.hasThinInstances||!!this._userInstancedBuffersStorage&&!subMesh.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh;var instanceDataStorage=this._instanceDataStorage;var material=subMesh.getMaterial();if(!material){if(oldCamera){oldCamera.maxZ=oldCameraMaxZ;scene2.updateTransformMatrix(true);}return this;}if(!instanceDataStorage.isFrozen||!this._internalMeshDataInfo._effectiveMaterial||this._internalMeshDataInfo._effectiveMaterial!==material){if(material._storeEffectOnSubMeshes){if(!material.isReadyForSubMesh(this,subMesh,hardwareInstancedRendering)){if(oldCamera){oldCamera.maxZ=oldCameraMaxZ;scene2.updateTransformMatrix(true);}return this;}}else if(!material.isReady(this,hardwareInstancedRendering)){if(oldCamera){oldCamera.maxZ=oldCameraMaxZ;scene2.updateTransformMatrix(true);}return this;}this._internalMeshDataInfo._effectiveMaterial=material;}else if(material._storeEffectOnSubMeshes&&!((_a=subMesh.effect)===null||_a===void 0?void 0:_a._wasPreviouslyReady)||!material._storeEffectOnSubMeshes&&!((_b=material.getEffect())===null||_b===void 0?void 0:_b._wasPreviouslyReady)){if(oldCamera){oldCamera.maxZ=oldCameraMaxZ;scene2.updateTransformMatrix(true);}return this;}if(enableAlphaMode){engine.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);}var drawWrapper;if(this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes){drawWrapper=subMesh._drawWrapper;}else{drawWrapper=this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();}var effect=(_c=drawWrapper===null||drawWrapper===void 0?void 0:drawWrapper.effect)!==null&&_c!==void 0?_c:null;var _iterator120=_createForOfIteratorHelper(scene2._beforeRenderingMeshStage),_step129;try{for(_iterator120.s();!(_step129=_iterator120.n()).done;){var step=_step129.value;step.action(this,subMesh,batch,effect);}}catch(err){_iterator120.e(err);}finally{_iterator120.f();}if(!drawWrapper||!effect){if(oldCamera){oldCamera.maxZ=oldCameraMaxZ;scene2.updateTransformMatrix(true);}return this;}var effectiveMesh=effectiveMeshReplacement||this;var sideOrientation;if(!instanceDataStorage.isFrozen&&(this._internalMeshDataInfo._effectiveMaterial.backFaceCulling||this.overrideMaterialSideOrientation!==null)){var mainDeterminant=effectiveMesh._getWorldMatrixDeterminant();sideOrientation=this.overrideMaterialSideOrientation;if(sideOrientation==null){sideOrientation=this._internalMeshDataInfo._effectiveMaterial.sideOrientation;}if(mainDeterminant<0){sideOrientation=sideOrientation===Material.ClockWiseSideOrientation?Material.CounterClockWiseSideOrientation:Material.ClockWiseSideOrientation;}instanceDataStorage.sideOrientation=sideOrientation;}else{sideOrientation=instanceDataStorage.sideOrientation;}var reverse=this._internalMeshDataInfo._effectiveMaterial._preBind(drawWrapper,sideOrientation);if(this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite){engine.setDepthWrite(true);}var fillMode=scene2.forcePointsCloud?Material.PointFillMode:scene2.forceWireframe?Material.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;if(this._internalMeshDataInfo._onBeforeBindObservable){this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this);}if(!hardwareInstancedRendering){this._bind(subMesh,effect,fillMode);}var effectiveMaterial=this._internalMeshDataInfo._effectiveMaterial;var world=effectiveMesh.getWorldMatrix();if(effectiveMaterial._storeEffectOnSubMeshes){effectiveMaterial.bindForSubMesh(world,this,subMesh);}else{effectiveMaterial.bind(world,this);}if(!effectiveMaterial.backFaceCulling&&effectiveMaterial.separateCullingPass){engine.setState(true,effectiveMaterial.zOffset,false,!reverse,effectiveMaterial.cullBackFaces,effectiveMaterial.stencil,effectiveMaterial.zOffsetUnits);this._processRendering(this,subMesh,effect,fillMode,batch,hardwareInstancedRendering,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial);engine.setState(true,effectiveMaterial.zOffset,false,reverse,effectiveMaterial.cullBackFaces,effectiveMaterial.stencil,effectiveMaterial.zOffsetUnits);if(this._internalMeshDataInfo._onBetweenPassObservable){this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(subMesh);}}this._processRendering(this,subMesh,effect,fillMode,batch,hardwareInstancedRendering,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial);this._internalMeshDataInfo._effectiveMaterial.unbind();var _iterator121=_createForOfIteratorHelper(scene2._afterRenderingMeshStage),_step130;try{for(_iterator121.s();!(_step130=_iterator121.n()).done;){var _step131=_step130.value;_step131.action(this,subMesh,batch,effect);}}catch(err){_iterator121.e(err);}finally{_iterator121.f();}if(this._internalMeshDataInfo._onAfterRenderObservable){this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this);}if(oldCamera){oldCamera.maxZ=oldCameraMaxZ;scene2.updateTransformMatrix(true);}if(scene2.performancePriority===ScenePerformancePriority.Aggressive&&!instanceDataStorage.isFrozen){this._freeze();}return this;}},{key:"cleanMatrixWeights",value:function cleanMatrixWeights(){if(this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)){if(this.isVerticesDataPresent(VertexBuffer.MatricesWeightsExtraKind)){this._normalizeSkinWeightsAndExtra();}else{this._normalizeSkinFourWeights();}}}},{key:"_normalizeSkinFourWeights",value:function _normalizeSkinFourWeights(){var matricesWeights=this.getVerticesData(VertexBuffer.MatricesWeightsKind);var numWeights=matricesWeights.length;for(var a=0;a<numWeights;a+=4){var t=matricesWeights[a]+matricesWeights[a+1]+matricesWeights[a+2]+matricesWeights[a+3];if(t===0){matricesWeights[a]=1;}else{var recip=1/t;matricesWeights[a]*=recip;matricesWeights[a+1]*=recip;matricesWeights[a+2]*=recip;matricesWeights[a+3]*=recip;}}this.setVerticesData(VertexBuffer.MatricesWeightsKind,matricesWeights);}},{key:"_normalizeSkinWeightsAndExtra",value:function _normalizeSkinWeightsAndExtra(){var matricesWeightsExtra=this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind);var matricesWeights=this.getVerticesData(VertexBuffer.MatricesWeightsKind);var numWeights=matricesWeights.length;for(var a=0;a<numWeights;a+=4){var t=matricesWeights[a]+matricesWeights[a+1]+matricesWeights[a+2]+matricesWeights[a+3];t+=matricesWeightsExtra[a]+matricesWeightsExtra[a+1]+matricesWeightsExtra[a+2]+matricesWeightsExtra[a+3];if(t===0){matricesWeights[a]=1;}else{var recip=1/t;matricesWeights[a]*=recip;matricesWeights[a+1]*=recip;matricesWeights[a+2]*=recip;matricesWeights[a+3]*=recip;matricesWeightsExtra[a]*=recip;matricesWeightsExtra[a+1]*=recip;matricesWeightsExtra[a+2]*=recip;matricesWeightsExtra[a+3]*=recip;}}this.setVerticesData(VertexBuffer.MatricesWeightsKind,matricesWeights);this.setVerticesData(VertexBuffer.MatricesWeightsKind,matricesWeightsExtra);}},{key:"validateSkinning",value:function validateSkinning(){var matricesWeightsExtra=this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind);var matricesWeights=this.getVerticesData(VertexBuffer.MatricesWeightsKind);if(matricesWeights===null||this.skeleton==null){return{skinned:false,valid:true,report:"not skinned"};}var numWeights=matricesWeights.length;var numberNotSorted=0;var missingWeights=0;var maxUsedWeights=0;var numberNotNormalized=0;var numInfluences=matricesWeightsExtra===null?4:8;var usedWeightCounts=new Array();for(var a=0;a<=numInfluences;a++){usedWeightCounts[a]=0;}var toleranceEpsilon=1e-3;for(var _a4=0;_a4<numWeights;_a4+=4){var lastWeight=matricesWeights[_a4];var t=lastWeight;var usedWeights=t===0?0:1;for(var b=1;b<numInfluences;b++){var d=b<4?matricesWeights[_a4+b]:matricesWeightsExtra[_a4+b-4];if(d>lastWeight){numberNotSorted++;}if(d!==0){usedWeights++;}t+=d;lastWeight=d;}usedWeightCounts[usedWeights]++;if(usedWeights>maxUsedWeights){maxUsedWeights=usedWeights;}if(t===0){missingWeights++;}else{var recip=1/t;var tolerance=0;for(var _b4=0;_b4<numInfluences;_b4++){if(_b4<4){tolerance+=Math.abs(matricesWeights[_a4+_b4]-matricesWeights[_a4+_b4]*recip);}else{tolerance+=Math.abs(matricesWeightsExtra[_a4+_b4-4]-matricesWeightsExtra[_a4+_b4-4]*recip);}}if(tolerance>toleranceEpsilon){numberNotNormalized++;}}}var numBones=this.skeleton.bones.length;var matricesIndices=this.getVerticesData(VertexBuffer.MatricesIndicesKind);var matricesIndicesExtra=this.getVerticesData(VertexBuffer.MatricesIndicesExtraKind);var numBadBoneIndices=0;for(var _a5=0;_a5<numWeights;_a5+=4){for(var _b5=0;_b5<numInfluences;_b5++){var index=_b5<4?matricesIndices[_a5+_b5]:matricesIndicesExtra[_a5+_b5-4];if(index>=numBones||index<0){numBadBoneIndices++;}}}var output="Number of Weights = "+numWeights/4+"\nMaximum influences = "+maxUsedWeights+"\nMissing Weights = "+missingWeights+"\nNot Sorted = "+numberNotSorted+"\nNot Normalized = "+numberNotNormalized+"\nWeightCounts = ["+usedWeightCounts+"]\nNumber of bones = "+numBones+"\nBad Bone Indices = "+numBadBoneIndices;return{skinned:true,valid:missingWeights===0&&numberNotNormalized===0&&numBadBoneIndices===0,report:output};}},{key:"_checkDelayState",value:function _checkDelayState(){var scene2=this.getScene();if(this._geometry){this._geometry.load(scene2);}else if(this.delayLoadState===4){this.delayLoadState=2;this._queueLoad(scene2);}return this;}},{key:"_queueLoad",value:function _queueLoad(scene2){var _this87=this;scene2.addPendingData(this);var getBinaryData=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;Tools.LoadFile(this.delayLoadingFile,function(data){if(data instanceof ArrayBuffer){_this87._delayLoadingFunction(data,_this87);}else{_this87._delayLoadingFunction(JSON.parse(data),_this87);}_this87.instances.forEach(function(instance){instance.refreshBoundingInfo();instance._syncSubMeshes();});_this87.delayLoadState=1;scene2.removePendingData(_this87);},function(){},scene2.offlineProvider,getBinaryData);return this;}},{key:"isInFrustum",value:function isInFrustum(frustumPlanes){if(this.delayLoadState===2){return false;}if(!_get(_getPrototypeOf(Mesh.prototype),"isInFrustum",this).call(this,frustumPlanes)){return false;}this._checkDelayState();return true;}},{key:"setMaterialById",value:function setMaterialById(id){var materials=this.getScene().materials;var index;for(index=materials.length-1;index>-1;index--){if(materials[index].id===id){this.material=materials[index];return this;}}var multiMaterials=this.getScene().multiMaterials;for(index=multiMaterials.length-1;index>-1;index--){if(multiMaterials[index].id===id){this.material=multiMaterials[index];return this;}}return this;}},{key:"getAnimatables",value:function getAnimatables(){var results=new Array();if(this.material){results.push(this.material);}if(this.skeleton){results.push(this.skeleton);}return results;}},{key:"bakeTransformIntoVertices",value:function bakeTransformIntoVertices(transform){if(!this.isVerticesDataPresent(VertexBuffer.PositionKind)){return this;}var submeshes=this.subMeshes.splice(0);this._resetPointsArrayCache();var data=this.getVerticesData(VertexBuffer.PositionKind);var temp=Vector3.Zero();var index;for(index=0;index<data.length;index+=3){Vector3.TransformCoordinatesFromFloatsToRef(data[index],data[index+1],data[index+2],transform,temp).toArray(data,index);}this.setVerticesData(VertexBuffer.PositionKind,data,this.getVertexBuffer(VertexBuffer.PositionKind).isUpdatable());if(this.isVerticesDataPresent(VertexBuffer.NormalKind)){data=this.getVerticesData(VertexBuffer.NormalKind);for(index=0;index<data.length;index+=3){Vector3.TransformNormalFromFloatsToRef(data[index],data[index+1],data[index+2],transform,temp).normalize().toArray(data,index);}this.setVerticesData(VertexBuffer.NormalKind,data,this.getVertexBuffer(VertexBuffer.NormalKind).isUpdatable());}if(transform.determinant()<0){this.flipFaces();}this.releaseSubMeshes();this.subMeshes=submeshes;return this;}},{key:"bakeCurrentTransformIntoVertices",value:function bakeCurrentTransformIntoVertices(){var bakeIndependentlyOfChildren=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.bakeTransformIntoVertices(this.computeWorldMatrix(true));this.resetLocalMatrix(bakeIndependentlyOfChildren);return this;}},{key:"_positions",get:function get(){if(this._internalAbstractMeshDataInfo._positions){return this._internalAbstractMeshDataInfo._positions;}if(this._geometry){return this._geometry._positions;}return null;}},{key:"_resetPointsArrayCache",value:function _resetPointsArrayCache(){if(this._geometry){this._geometry._resetPointsArrayCache();}return this;}},{key:"_generatePointsArray",value:function _generatePointsArray(){if(this._geometry){return this._geometry._generatePointsArray();}return false;}},{key:"clone",value:function clone(){var name135=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var newParent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var doNotCloneChildren=arguments.length>2?arguments[2]:undefined;var clonePhysicsImpostor=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return new Mesh(name135,this.getScene(),newParent,this,doNotCloneChildren,clonePhysicsImpostor);}},{key:"dispose",value:function dispose(doNotRecurse){var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.morphTargetManager=null;if(this._geometry){this._geometry.releaseForMesh(this,true);}var internalDataInfo=this._internalMeshDataInfo;if(internalDataInfo._onBeforeDrawObservable){internalDataInfo._onBeforeDrawObservable.clear();}if(internalDataInfo._onBeforeBindObservable){internalDataInfo._onBeforeBindObservable.clear();}if(internalDataInfo._onBeforeRenderObservable){internalDataInfo._onBeforeRenderObservable.clear();}if(internalDataInfo._onAfterRenderObservable){internalDataInfo._onAfterRenderObservable.clear();}if(internalDataInfo._onBetweenPassObservable){internalDataInfo._onBetweenPassObservable.clear();}if(this._scene.useClonedMeshMap){if(internalDataInfo.meshMap){for(var uniqueId in internalDataInfo.meshMap){var mesh=internalDataInfo.meshMap[uniqueId];if(mesh){mesh._internalMeshDataInfo._source=null;internalDataInfo.meshMap[uniqueId]=void 0;}}}if(internalDataInfo._source&&internalDataInfo._source._internalMeshDataInfo.meshMap){internalDataInfo._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0;}}else{var meshes=this.getScene().meshes;var _iterator122=_createForOfIteratorHelper(meshes),_step132;try{for(_iterator122.s();!(_step132=_iterator122.n()).done;){var abstractMesh=_step132.value;var _mesh3=abstractMesh;if(_mesh3._internalMeshDataInfo&&_mesh3._internalMeshDataInfo._source&&_mesh3._internalMeshDataInfo._source===this){_mesh3._internalMeshDataInfo._source=null;}}}catch(err){_iterator122.e(err);}finally{_iterator122.f();}}internalDataInfo._source=null;this._disposeInstanceSpecificData();this._disposeThinInstanceSpecificData();if(this._internalMeshDataInfo._checkReadinessObserver){this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver);}_get(_getPrototypeOf(Mesh.prototype),"dispose",this).call(this,doNotRecurse,disposeMaterialAndTextures);}},{key:"_disposeInstanceSpecificData",value:function _disposeInstanceSpecificData(){}},{key:"_disposeThinInstanceSpecificData",value:function _disposeThinInstanceSpecificData(){}},{key:"_invalidateInstanceVertexArrayObject",value:function _invalidateInstanceVertexArrayObject(){}},{key:"applyDisplacementMap",value:function applyDisplacementMap(url,minHeight,maxHeight,onSuccess,uvOffset,uvScale){var _this88=this;var forceUpdate=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var scene2=this.getScene();var onload=function onload(img){var heightMapWidth=img.width;var heightMapHeight=img.height;var canvas=_this88.getEngine().createCanvas(heightMapWidth,heightMapHeight);var context=canvas.getContext("2d");context.drawImage(img,0,0);var buffer=context.getImageData(0,0,heightMapWidth,heightMapHeight).data;_this88.applyDisplacementMapFromBuffer(buffer,heightMapWidth,heightMapHeight,minHeight,maxHeight,uvOffset,uvScale,forceUpdate);if(onSuccess){onSuccess(_this88);}};Tools.LoadImage(url,onload,function(){},scene2.offlineProvider);return this;}},{key:"applyDisplacementMapFromBuffer",value:function applyDisplacementMapFromBuffer(buffer,heightMapWidth,heightMapHeight,minHeight,maxHeight,uvOffset,uvScale){var forceUpdate=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;if(!this.isVerticesDataPresent(VertexBuffer.PositionKind)||!this.isVerticesDataPresent(VertexBuffer.NormalKind)||!this.isVerticesDataPresent(VertexBuffer.UVKind)){Logger.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing");return this;}var positions=this.getVerticesData(VertexBuffer.PositionKind,true,true);var normals=this.getVerticesData(VertexBuffer.NormalKind);var uvs=this.getVerticesData(VertexBuffer.UVKind);var position=Vector3.Zero();var normal=Vector3.Zero();var uv=Vector2.Zero();uvOffset=uvOffset||Vector2.Zero();uvScale=uvScale||new Vector2(1,1);for(var index=0;index<positions.length;index+=3){Vector3.FromArrayToRef(positions,index,position);Vector3.FromArrayToRef(normals,index,normal);Vector2.FromArrayToRef(uvs,index/3*2,uv);var u=Math.abs(uv.x*uvScale.x+uvOffset.x%1)*(heightMapWidth-1)%heightMapWidth|0;var v=Math.abs(uv.y*uvScale.y+uvOffset.y%1)*(heightMapHeight-1)%heightMapHeight|0;var pos=(u+v*heightMapWidth)*4;var r=buffer[pos]/255;var g=buffer[pos+1]/255;var b=buffer[pos+2]/255;var gradient=r*0.3+g*0.59+b*0.11;normal.normalize();normal.scaleInPlace(minHeight+(maxHeight-minHeight)*gradient);position=position.add(normal);position.toArray(positions,index);}VertexData.ComputeNormals(positions,this.getIndices(),normals);if(forceUpdate){this.setVerticesData(VertexBuffer.PositionKind,positions);this.setVerticesData(VertexBuffer.NormalKind,normals);this.setVerticesData(VertexBuffer.UVKind,uvs);}else{this.updateVerticesData(VertexBuffer.PositionKind,positions);this.updateVerticesData(VertexBuffer.NormalKind,normals);}return this;}},{key:"convertToFlatShadedMesh",value:function convertToFlatShadedMesh(){var kinds=this.getVerticesDataKinds();var vbs={};var data={};var newdata={};var updatableNormals=false;var kindIndex;var kind;for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];var vertexBuffer=this.getVertexBuffer(kind);var vertexData=vertexBuffer.getData();if(vertexData instanceof Array||vertexData instanceof Float32Array){if(vertexData.length===0){continue;}}if(kind===VertexBuffer.NormalKind){updatableNormals=vertexBuffer.isUpdatable();kinds.splice(kindIndex,1);kindIndex--;continue;}vbs[kind]=vertexBuffer;data[kind]=this.getVerticesData(kind);newdata[kind]=[];}var previousSubmeshes=this.subMeshes.slice(0);var indices=this.getIndices();var totalIndices=this.getTotalIndices();var index;for(index=0;index<totalIndices;index++){var vertexIndex=indices[index];for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];if(!vbs[kind]){continue;}var stride=vbs[kind].getStrideSize();for(var offset=0;offset<stride;offset++){newdata[kind].push(data[kind][vertexIndex*stride+offset]);}}}var normals=[];var positions=newdata[VertexBuffer.PositionKind];var useRightHandedSystem=this.getScene().useRightHandedSystem;var flipNormalGeneration;if(useRightHandedSystem){flipNormalGeneration=this.overrideMaterialSideOrientation===1;}else{flipNormalGeneration=this.overrideMaterialSideOrientation===0;}for(index=0;index<totalIndices;index+=3){indices[index]=index;indices[index+1]=index+1;indices[index+2]=index+2;var p1=Vector3.FromArray(positions,index*3);var p2=Vector3.FromArray(positions,(index+1)*3);var p3=Vector3.FromArray(positions,(index+2)*3);var p1p2=p1.subtract(p2);var p3p2=p3.subtract(p2);var normal=Vector3.Normalize(Vector3.Cross(p1p2,p3p2));if(flipNormalGeneration){normal.scaleInPlace(-1);}for(var localIndex=0;localIndex<3;localIndex++){normals.push(normal.x);normals.push(normal.y);normals.push(normal.z);}}this.setIndices(indices);this.setVerticesData(VertexBuffer.NormalKind,normals,updatableNormals);for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];if(!newdata[kind]){continue;}this.setVerticesData(kind,newdata[kind],vbs[kind].isUpdatable());}this.releaseSubMeshes();for(var submeshIndex=0;submeshIndex<previousSubmeshes.length;submeshIndex++){var previousOne=previousSubmeshes[submeshIndex];SubMesh.AddToMesh(previousOne.materialIndex,previousOne.indexStart,previousOne.indexCount,previousOne.indexStart,previousOne.indexCount,this);}this.synchronizeInstances();return this;}},{key:"convertToUnIndexedMesh",value:function convertToUnIndexedMesh(){var kinds=this.getVerticesDataKinds();var vbs={};var data={};var newdata={};var kindIndex;var kind;for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];var vertexBuffer=this.getVertexBuffer(kind);vbs[kind]=vertexBuffer;data[kind]=vbs[kind].getData();newdata[kind]=[];}var previousSubmeshes=this.subMeshes.slice(0);var indices=this.getIndices();var totalIndices=this.getTotalIndices();var index;for(index=0;index<totalIndices;index++){var vertexIndex=indices[index];for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];var stride=vbs[kind].getStrideSize();for(var offset=0;offset<stride;offset++){newdata[kind].push(data[kind][vertexIndex*stride+offset]);}}}for(index=0;index<totalIndices;index+=3){indices[index]=index;indices[index+1]=index+1;indices[index+2]=index+2;}this.setIndices(indices);for(kindIndex=0;kindIndex<kinds.length;kindIndex++){kind=kinds[kindIndex];this.setVerticesData(kind,newdata[kind],vbs[kind].isUpdatable(),vbs[kind].getStrideSize());}this.releaseSubMeshes();for(var submeshIndex=0;submeshIndex<previousSubmeshes.length;submeshIndex++){var previousOne=previousSubmeshes[submeshIndex];SubMesh.AddToMesh(previousOne.materialIndex,previousOne.indexStart,previousOne.indexCount,previousOne.indexStart,previousOne.indexCount,this);}this._unIndexed=true;this.synchronizeInstances();return this;}},{key:"flipFaces",value:function flipFaces(){var flipNormals=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var vertex_data=VertexData.ExtractFromMesh(this);var i;if(flipNormals&&this.isVerticesDataPresent(VertexBuffer.NormalKind)&&vertex_data.normals){for(i=0;i<vertex_data.normals.length;i++){vertex_data.normals[i]*=-1;}}if(vertex_data.indices){var temp;for(i=0;i<vertex_data.indices.length;i+=3){temp=vertex_data.indices[i+1];vertex_data.indices[i+1]=vertex_data.indices[i+2];vertex_data.indices[i+2]=temp;}}vertex_data.applyToMesh(this,this.isVertexBufferUpdatable(VertexBuffer.PositionKind));return this;}},{key:"increaseVertices",value:function increaseVertices(){var numberPerEdge=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;var vertex_data=VertexData.ExtractFromMesh(this);var currentIndices=vertex_data.indices&&!Array.isArray(vertex_data.indices)&&Array.from?Array.from(vertex_data.indices):vertex_data.indices;var positions=vertex_data.positions&&!Array.isArray(vertex_data.positions)&&Array.from?Array.from(vertex_data.positions):vertex_data.positions;var uvs=vertex_data.uvs&&!Array.isArray(vertex_data.uvs)&&Array.from?Array.from(vertex_data.uvs):vertex_data.uvs;var normals=vertex_data.normals&&!Array.isArray(vertex_data.normals)&&Array.from?Array.from(vertex_data.normals):vertex_data.normals;if(!currentIndices||!positions){Logger.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions");}else{vertex_data.indices=currentIndices;vertex_data.positions=positions;if(uvs){vertex_data.uvs=uvs;}if(normals){vertex_data.normals=normals;}var segments=numberPerEdge+1;var tempIndices=new Array();for(var i=0;i<segments+1;i++){tempIndices[i]=new Array();}var a;var b;var deltaPosition=new Vector3(0,0,0);var deltaNormal=new Vector3(0,0,0);var deltaUV=new Vector2(0,0);var indices=new Array();var vertexIndex=new Array();var side=new Array();var len;var positionPtr=positions.length;var uvPtr;if(uvs){uvPtr=uvs.length;}var normalsPtr;if(normals){normalsPtr=normals.length;}for(var _i20=0;_i20<currentIndices.length;_i20+=3){vertexIndex[0]=currentIndices[_i20];vertexIndex[1]=currentIndices[_i20+1];vertexIndex[2]=currentIndices[_i20+2];for(var j=0;j<3;j++){a=vertexIndex[j];b=vertexIndex[(j+1)%3];if(side[a]===void 0&&side[b]===void 0){side[a]=new Array();side[b]=new Array();}else{if(side[a]===void 0){side[a]=new Array();}if(side[b]===void 0){side[b]=new Array();}}if(side[a][b]===void 0&&side[b][a]===void 0){side[a][b]=[];deltaPosition.x=(positions[3*b]-positions[3*a])/segments;deltaPosition.y=(positions[3*b+1]-positions[3*a+1])/segments;deltaPosition.z=(positions[3*b+2]-positions[3*a+2])/segments;if(normals){deltaNormal.x=(normals[3*b]-normals[3*a])/segments;deltaNormal.y=(normals[3*b+1]-normals[3*a+1])/segments;deltaNormal.z=(normals[3*b+2]-normals[3*a+2])/segments;}if(uvs){deltaUV.x=(uvs[2*b]-uvs[2*a])/segments;deltaUV.y=(uvs[2*b+1]-uvs[2*a+1])/segments;}side[a][b].push(a);for(var k=1;k<segments;k++){side[a][b].push(positions.length/3);positions[positionPtr++]=positions[3*a]+k*deltaPosition.x;positions[positionPtr++]=positions[3*a+1]+k*deltaPosition.y;positions[positionPtr++]=positions[3*a+2]+k*deltaPosition.z;if(normals){normals[normalsPtr++]=normals[3*a]+k*deltaNormal.x;normals[normalsPtr++]=normals[3*a+1]+k*deltaNormal.y;normals[normalsPtr++]=normals[3*a+2]+k*deltaNormal.z;}if(uvs){uvs[uvPtr++]=uvs[2*a]+k*deltaUV.x;uvs[uvPtr++]=uvs[2*a+1]+k*deltaUV.y;}}side[a][b].push(b);side[b][a]=new Array();len=side[a][b].length;for(var idx=0;idx<len;idx++){side[b][a][idx]=side[a][b][len-1-idx];}}}tempIndices[0][0]=currentIndices[_i20];tempIndices[1][0]=side[currentIndices[_i20]][currentIndices[_i20+1]][1];tempIndices[1][1]=side[currentIndices[_i20]][currentIndices[_i20+2]][1];for(var _k2=2;_k2<segments;_k2++){tempIndices[_k2][0]=side[currentIndices[_i20]][currentIndices[_i20+1]][_k2];tempIndices[_k2][_k2]=side[currentIndices[_i20]][currentIndices[_i20+2]][_k2];deltaPosition.x=(positions[3*tempIndices[_k2][_k2]]-positions[3*tempIndices[_k2][0]])/_k2;deltaPosition.y=(positions[3*tempIndices[_k2][_k2]+1]-positions[3*tempIndices[_k2][0]+1])/_k2;deltaPosition.z=(positions[3*tempIndices[_k2][_k2]+2]-positions[3*tempIndices[_k2][0]+2])/_k2;if(normals){deltaNormal.x=(normals[3*tempIndices[_k2][_k2]]-normals[3*tempIndices[_k2][0]])/_k2;deltaNormal.y=(normals[3*tempIndices[_k2][_k2]+1]-normals[3*tempIndices[_k2][0]+1])/_k2;deltaNormal.z=(normals[3*tempIndices[_k2][_k2]+2]-normals[3*tempIndices[_k2][0]+2])/_k2;}if(uvs){deltaUV.x=(uvs[2*tempIndices[_k2][_k2]]-uvs[2*tempIndices[_k2][0]])/_k2;deltaUV.y=(uvs[2*tempIndices[_k2][_k2]+1]-uvs[2*tempIndices[_k2][0]+1])/_k2;}for(var _j5=1;_j5<_k2;_j5++){tempIndices[_k2][_j5]=positions.length/3;positions[positionPtr++]=positions[3*tempIndices[_k2][0]]+_j5*deltaPosition.x;positions[positionPtr++]=positions[3*tempIndices[_k2][0]+1]+_j5*deltaPosition.y;positions[positionPtr++]=positions[3*tempIndices[_k2][0]+2]+_j5*deltaPosition.z;if(normals){normals[normalsPtr++]=normals[3*tempIndices[_k2][0]]+_j5*deltaNormal.x;normals[normalsPtr++]=normals[3*tempIndices[_k2][0]+1]+_j5*deltaNormal.y;normals[normalsPtr++]=normals[3*tempIndices[_k2][0]+2]+_j5*deltaNormal.z;}if(uvs){uvs[uvPtr++]=uvs[2*tempIndices[_k2][0]]+_j5*deltaUV.x;uvs[uvPtr++]=uvs[2*tempIndices[_k2][0]+1]+_j5*deltaUV.y;}}}tempIndices[segments]=side[currentIndices[_i20+1]][currentIndices[_i20+2]];indices.push(tempIndices[0][0],tempIndices[1][0],tempIndices[1][1]);for(var _k3=1;_k3<segments;_k3++){var _j6=void 0;for(_j6=0;_j6<_k3;_j6++){indices.push(tempIndices[_k3][_j6],tempIndices[_k3+1][_j6],tempIndices[_k3+1][_j6+1]);indices.push(tempIndices[_k3][_j6],tempIndices[_k3+1][_j6+1],tempIndices[_k3][_j6+1]);}indices.push(tempIndices[_k3][_j6],tempIndices[_k3+1][_j6],tempIndices[_k3+1][_j6+1]);}}vertex_data.indices=indices;vertex_data.applyToMesh(this,this.isVertexBufferUpdatable(VertexBuffer.PositionKind));}}},{key:"forceSharedVertices",value:function forceSharedVertices(){var vertex_data=VertexData.ExtractFromMesh(this);var currentUVs=vertex_data.uvs;var currentIndices=vertex_data.indices;var currentPositions=vertex_data.positions;var currentColors=vertex_data.colors;var currentMatrixIndices=vertex_data.matricesIndices;var currentMatrixWeights=vertex_data.matricesWeights;var currentMatrixIndicesExtra=vertex_data.matricesIndicesExtra;var currentMatrixWeightsExtra=vertex_data.matricesWeightsExtra;if(currentIndices===void 0||currentPositions===void 0||currentIndices===null||currentPositions===null){Logger.Warn("VertexData contains empty entries");}else{var positions=new Array();var indices=new Array();var uvs=new Array();var colors=new Array();var matrixIndices=new Array();var matrixWeights=new Array();var matrixIndicesExtra=new Array();var matrixWeightsExtra=new Array();var pstring=new Array();var indexPtr=0;var uniquePositions={};var ptr;var facet;for(var i=0;i<currentIndices.length;i+=3){facet=[currentIndices[i],currentIndices[i+1],currentIndices[i+2]];pstring=new Array();for(var j=0;j<3;j++){pstring[j]="";for(var k=0;k<3;k++){if(Math.abs(currentPositions[3*facet[j]+k])<1e-8){currentPositions[3*facet[j]+k]=0;}pstring[j]+=currentPositions[3*facet[j]+k]+"|";}}if(!(pstring[0]==pstring[1]||pstring[0]==pstring[2]||pstring[1]==pstring[2])){for(var _j7=0;_j7<3;_j7++){ptr=uniquePositions[pstring[_j7]];if(ptr===void 0){uniquePositions[pstring[_j7]]=indexPtr;ptr=indexPtr++;for(var _k4=0;_k4<3;_k4++){positions.push(currentPositions[3*facet[_j7]+_k4]);}if(currentColors!==null&&currentColors!==void 0){for(var _k5=0;_k5<4;_k5++){colors.push(currentColors[4*facet[_j7]+_k5]);}}if(currentUVs!==null&&currentUVs!==void 0){for(var _k6=0;_k6<2;_k6++){uvs.push(currentUVs[2*facet[_j7]+_k6]);}}if(currentMatrixIndices!==null&&currentMatrixIndices!==void 0){for(var _k7=0;_k7<4;_k7++){matrixIndices.push(currentMatrixIndices[4*facet[_j7]+_k7]);}}if(currentMatrixWeights!==null&&currentMatrixWeights!==void 0){for(var _k8=0;_k8<4;_k8++){matrixWeights.push(currentMatrixWeights[4*facet[_j7]+_k8]);}}if(currentMatrixIndicesExtra!==null&&currentMatrixIndicesExtra!==void 0){for(var _k9=0;_k9<4;_k9++){matrixIndicesExtra.push(currentMatrixIndicesExtra[4*facet[_j7]+_k9]);}}if(currentMatrixWeightsExtra!==null&&currentMatrixWeightsExtra!==void 0){for(var _k10=0;_k10<4;_k10++){matrixWeightsExtra.push(currentMatrixWeightsExtra[4*facet[_j7]+_k10]);}}}indices.push(ptr);}}}var normals=new Array();VertexData.ComputeNormals(positions,indices,normals);vertex_data.positions=positions;vertex_data.indices=indices;vertex_data.normals=normals;if(currentUVs!==null&&currentUVs!==void 0){vertex_data.uvs=uvs;}if(currentColors!==null&&currentColors!==void 0){vertex_data.colors=colors;}if(currentMatrixIndices!==null&&currentMatrixIndices!==void 0){vertex_data.matricesIndices=matrixIndices;}if(currentMatrixWeights!==null&&currentMatrixWeights!==void 0){vertex_data.matricesWeights=matrixWeights;}if(currentMatrixIndicesExtra!==null&&currentMatrixIndicesExtra!==void 0){vertex_data.matricesIndicesExtra=matrixIndicesExtra;}if(currentMatrixWeights!==null&&currentMatrixWeights!==void 0){vertex_data.matricesWeightsExtra=matrixWeightsExtra;}vertex_data.applyToMesh(this,this.isVertexBufferUpdatable(VertexBuffer.PositionKind));}}},{key:"createInstance",value:function createInstance(name135){return Mesh._instancedMeshFactory(name135,this);}},{key:"synchronizeInstances",value:function synchronizeInstances(){for(var instanceIndex=0;instanceIndex<this.instances.length;instanceIndex++){var instance=this.instances[instanceIndex];instance._syncSubMeshes();}return this;}},{key:"optimizeIndices",value:function optimizeIndices(successCallback){var _this89=this;var indices=this.getIndices();var positions=this.getVerticesData(VertexBuffer.PositionKind);if(!positions||!indices){return this;}var vectorPositions=new Array();for(var pos=0;pos<positions.length;pos=pos+3){vectorPositions.push(Vector3.FromArray(positions,pos));}var dupes=new Array();AsyncLoop.SyncAsyncForLoop(vectorPositions.length,40,function(iteration){var realPos=vectorPositions.length-1-iteration;var testedPosition=vectorPositions[realPos];for(var j=0;j<realPos;++j){var againstPosition=vectorPositions[j];if(testedPosition.equals(againstPosition)){dupes[realPos]=j;break;}}},function(){for(var i=0;i<indices.length;++i){indices[i]=dupes[indices[i]]||indices[i];}var originalSubMeshes=_this89.subMeshes.slice(0);_this89.setIndices(indices);_this89.subMeshes=originalSubMeshes;if(successCallback){successCallback(_this89);}});return this;}},{key:"serialize",value:function serialize(){var serializationObject=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};serializationObject.name=this.name;serializationObject.id=this.id;serializationObject.uniqueId=this.uniqueId;serializationObject.type=this.getClassName();if(Tags&&Tags.HasTags(this)){serializationObject.tags=Tags.GetTags(this);}serializationObject.position=this.position.asArray();if(this.rotationQuaternion){serializationObject.rotationQuaternion=this.rotationQuaternion.asArray();}else if(this.rotation){serializationObject.rotation=this.rotation.asArray();}serializationObject.scaling=this.scaling.asArray();if(this._postMultiplyPivotMatrix){serializationObject.pivotMatrix=this.getPivotMatrix().asArray();}else{serializationObject.localMatrix=this.getPivotMatrix().asArray();}serializationObject.isEnabled=this.isEnabled(false);serializationObject.isVisible=this.isVisible;serializationObject.infiniteDistance=this.infiniteDistance;serializationObject.pickable=this.isPickable;serializationObject.receiveShadows=this.receiveShadows;serializationObject.billboardMode=this.billboardMode;serializationObject.visibility=this.visibility;serializationObject.checkCollisions=this.checkCollisions;serializationObject.isBlocker=this.isBlocker;serializationObject.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation;if(this.parent){this.parent._serializeAsParent(serializationObject);}serializationObject.isUnIndexed=this.isUnIndexed;var geometry=this._geometry;if(geometry&&this.subMeshes){serializationObject.geometryUniqueId=geometry.uniqueId;serializationObject.geometryId=geometry.id;serializationObject.subMeshes=[];for(var subIndex=0;subIndex<this.subMeshes.length;subIndex++){var subMesh=this.subMeshes[subIndex];serializationObject.subMeshes.push({materialIndex:subMesh.materialIndex,verticesStart:subMesh.verticesStart,verticesCount:subMesh.verticesCount,indexStart:subMesh.indexStart,indexCount:subMesh.indexCount});}}if(this.material){if(!this.material.doNotSerialize){serializationObject.materialUniqueId=this.material.uniqueId;serializationObject.materialId=this.material.id;}}else{this.material=null;serializationObject.materialUniqueId=this._scene.defaultMaterial.uniqueId;serializationObject.materialId=this._scene.defaultMaterial.id;}if(this.morphTargetManager){serializationObject.morphTargetManagerId=this.morphTargetManager.uniqueId;}if(this.skeleton){serializationObject.skeletonId=this.skeleton.id;serializationObject.numBoneInfluencers=this.numBoneInfluencers;}if(this.getScene()._getComponent(SceneComponentConstants.NAME_PHYSICSENGINE)){var impostor=this.getPhysicsImpostor();if(impostor){serializationObject.physicsMass=impostor.getParam("mass");serializationObject.physicsFriction=impostor.getParam("friction");serializationObject.physicsRestitution=impostor.getParam("mass");serializationObject.physicsImpostor=impostor.type;}}if(this.metadata){serializationObject.metadata=this.metadata;}serializationObject.instances=[];for(var index=0;index<this.instances.length;index++){var instance=this.instances[index];if(instance.doNotSerialize){continue;}var serializationInstance={name:instance.name,id:instance.id,isEnabled:instance.isEnabled(false),isVisible:instance.isVisible,isPickable:instance.isPickable,checkCollisions:instance.checkCollisions,position:instance.position.asArray(),scaling:instance.scaling.asArray()};if(instance.parent){instance.parent._serializeAsParent(serializationInstance);}if(instance.rotationQuaternion){serializationInstance.rotationQuaternion=instance.rotationQuaternion.asArray();}else if(instance.rotation){serializationInstance.rotation=instance.rotation.asArray();}if(this.getScene()._getComponent(SceneComponentConstants.NAME_PHYSICSENGINE)){var _impostor=instance.getPhysicsImpostor();if(_impostor){serializationInstance.physicsMass=_impostor.getParam("mass");serializationInstance.physicsFriction=_impostor.getParam("friction");serializationInstance.physicsRestitution=_impostor.getParam("mass");serializationInstance.physicsImpostor=_impostor.type;}}if(instance.metadata){serializationInstance.metadata=instance.metadata;}if(instance.actionManager){serializationInstance.actions=instance.actionManager.serialize(instance.name);}serializationObject.instances.push(serializationInstance);SerializationHelper.AppendSerializedAnimations(instance,serializationInstance);serializationInstance.ranges=instance.serializeAnimationRanges();}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData){serializationObject.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking};if(this._userThinInstanceBuffersStorage){var userThinInstance={data:{},sizes:{},strides:{}};for(var kind in this._userThinInstanceBuffersStorage.data){userThinInstance.data[kind]=Array.from(this._userThinInstanceBuffersStorage.data[kind]);userThinInstance.sizes[kind]=this._userThinInstanceBuffersStorage.sizes[kind];userThinInstance.strides[kind]=this._userThinInstanceBuffersStorage.strides[kind];}serializationObject.thinInstances.userThinInstance=userThinInstance;}}SerializationHelper.AppendSerializedAnimations(this,serializationObject);serializationObject.ranges=this.serializeAnimationRanges();serializationObject.layerMask=this.layerMask;serializationObject.alphaIndex=this.alphaIndex;serializationObject.hasVertexAlpha=this.hasVertexAlpha;serializationObject.overlayAlpha=this.overlayAlpha;serializationObject.overlayColor=this.overlayColor.asArray();serializationObject.renderOverlay=this.renderOverlay;serializationObject.applyFog=this.applyFog;if(this.actionManager){serializationObject.actions=this.actionManager.serialize(this.name);}return serializationObject;}},{key:"_syncGeometryWithMorphTargetManager",value:function _syncGeometryWithMorphTargetManager(){if(!this.geometry){return;}this._markSubMeshesAsAttributesDirty();var morphTargetManager=this._internalAbstractMeshDataInfo._morphTargetManager;if(morphTargetManager&&morphTargetManager.vertexCount){if(morphTargetManager.vertexCount!==this.getTotalVertices()){Logger.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count.");this.morphTargetManager=null;return;}if(morphTargetManager.isUsingTextureForTargets){return;}for(var index=0;index<morphTargetManager.numInfluencers;index++){var morphTarget=morphTargetManager.getActiveTarget(index);var positions=morphTarget.getPositions();if(!positions){Logger.Error("Invalid morph target. Target must have positions.");return;}this.geometry.setVerticesData(VertexBuffer.PositionKind+index,positions,false,3);var normals=morphTarget.getNormals();if(normals){this.geometry.setVerticesData(VertexBuffer.NormalKind+index,normals,false,3);}var tangents=morphTarget.getTangents();if(tangents){this.geometry.setVerticesData(VertexBuffer.TangentKind+index,tangents,false,3);}var uvs=morphTarget.getUVs();if(uvs){this.geometry.setVerticesData(VertexBuffer.UVKind+"_"+index,uvs,false,2);}}}else{var _index21=0;while(this.geometry.isVerticesDataPresent(VertexBuffer.PositionKind+_index21)){this.geometry.removeVerticesData(VertexBuffer.PositionKind+_index21);if(this.geometry.isVerticesDataPresent(VertexBuffer.NormalKind+_index21)){this.geometry.removeVerticesData(VertexBuffer.NormalKind+_index21);}if(this.geometry.isVerticesDataPresent(VertexBuffer.TangentKind+_index21)){this.geometry.removeVerticesData(VertexBuffer.TangentKind+_index21);}if(this.geometry.isVerticesDataPresent(VertexBuffer.UVKind+_index21)){this.geometry.removeVerticesData(VertexBuffer.UVKind+"_"+_index21);}_index21++;}}}},{key:"setPositionsForCPUSkinning",value:function setPositionsForCPUSkinning(){var internalDataInfo=this._internalMeshDataInfo;if(!internalDataInfo._sourcePositions){var source=this.getVerticesData(VertexBuffer.PositionKind);if(!source){return internalDataInfo._sourcePositions;}internalDataInfo._sourcePositions=new Float32Array(source);if(!this.isVertexBufferUpdatable(VertexBuffer.PositionKind)){this.setVerticesData(VertexBuffer.PositionKind,source,true);}}return internalDataInfo._sourcePositions;}},{key:"setNormalsForCPUSkinning",value:function setNormalsForCPUSkinning(){var internalDataInfo=this._internalMeshDataInfo;if(!internalDataInfo._sourceNormals){var source=this.getVerticesData(VertexBuffer.NormalKind);if(!source){return internalDataInfo._sourceNormals;}internalDataInfo._sourceNormals=new Float32Array(source);if(!this.isVertexBufferUpdatable(VertexBuffer.NormalKind)){this.setVerticesData(VertexBuffer.NormalKind,source,true);}}return internalDataInfo._sourceNormals;}},{key:"applySkeleton",value:function applySkeleton(skeleton){if(!this.geometry){return this;}if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId()){return this;}this.geometry._softwareSkinningFrameId=this.getScene().getFrameId();if(!this.isVerticesDataPresent(VertexBuffer.PositionKind)){return this;}if(!this.isVerticesDataPresent(VertexBuffer.MatricesIndicesKind)){return this;}if(!this.isVerticesDataPresent(VertexBuffer.MatricesWeightsKind)){return this;}var hasNormals=this.isVerticesDataPresent(VertexBuffer.NormalKind);var internalDataInfo=this._internalMeshDataInfo;if(!internalDataInfo._sourcePositions){var submeshes=this.subMeshes.slice();this.setPositionsForCPUSkinning();this.subMeshes=submeshes;}if(hasNormals&&!internalDataInfo._sourceNormals){this.setNormalsForCPUSkinning();}var positionsData=this.getVerticesData(VertexBuffer.PositionKind);if(!positionsData){return this;}if(!(positionsData instanceof Float32Array)){positionsData=new Float32Array(positionsData);}var normalsData=this.getVerticesData(VertexBuffer.NormalKind);if(hasNormals){if(!normalsData){return this;}if(!(normalsData instanceof Float32Array)){normalsData=new Float32Array(normalsData);}}var matricesIndicesData=this.getVerticesData(VertexBuffer.MatricesIndicesKind);var matricesWeightsData=this.getVerticesData(VertexBuffer.MatricesWeightsKind);if(!matricesWeightsData||!matricesIndicesData){return this;}var needExtras=this.numBoneInfluencers>4;var matricesIndicesExtraData=needExtras?this.getVerticesData(VertexBuffer.MatricesIndicesExtraKind):null;var matricesWeightsExtraData=needExtras?this.getVerticesData(VertexBuffer.MatricesWeightsExtraKind):null;var skeletonMatrices=skeleton.getTransformMatrices(this);var tempVector3=Vector3.Zero();var finalMatrix=new Matrix();var tempMatrix=new Matrix();var matWeightIdx=0;var inf;for(var index=0;index<positionsData.length;index+=3,matWeightIdx+=4){var weight=void 0;for(inf=0;inf<4;inf++){weight=matricesWeightsData[matWeightIdx+inf];if(weight>0){Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,Math.floor(matricesIndicesData[matWeightIdx+inf]*16),weight,tempMatrix);finalMatrix.addToSelf(tempMatrix);}}if(needExtras){for(inf=0;inf<4;inf++){weight=matricesWeightsExtraData[matWeightIdx+inf];if(weight>0){Matrix.FromFloat32ArrayToRefScaled(skeletonMatrices,Math.floor(matricesIndicesExtraData[matWeightIdx+inf]*16),weight,tempMatrix);finalMatrix.addToSelf(tempMatrix);}}}Vector3.TransformCoordinatesFromFloatsToRef(internalDataInfo._sourcePositions[index],internalDataInfo._sourcePositions[index+1],internalDataInfo._sourcePositions[index+2],finalMatrix,tempVector3);tempVector3.toArray(positionsData,index);if(hasNormals){Vector3.TransformNormalFromFloatsToRef(internalDataInfo._sourceNormals[index],internalDataInfo._sourceNormals[index+1],internalDataInfo._sourceNormals[index+2],finalMatrix,tempVector3);tempVector3.toArray(normalsData,index);}finalMatrix.reset();}this.updateVerticesData(VertexBuffer.PositionKind,positionsData);if(hasNormals){this.updateVerticesData(VertexBuffer.NormalKind,normalsData);}return this;}},{key:"addInstance",value:function addInstance(instance){instance._indexInSourceMeshInstanceArray=this.instances.length;this.instances.push(instance);}},{key:"removeInstance",value:function removeInstance(instance){var index=instance._indexInSourceMeshInstanceArray;if(index!=-1){if(index!==this.instances.length-1){var last=this.instances[this.instances.length-1];this.instances[index]=last;last._indexInSourceMeshInstanceArray=index;}instance._indexInSourceMeshInstanceArray=-1;this.instances.pop();}}},{key:"_shouldConvertRHS",value:function _shouldConvertRHS(){return this.overrideMaterialSideOrientation===Material.CounterClockWiseSideOrientation;}}],[{key:"_GetDefaultSideOrientation",value:function _GetDefaultSideOrientation(orientation){return orientation||Mesh.FRONTSIDE;}},{key:"_instancedMeshFactory",value:function _instancedMeshFactory(name135,mesh){throw _WarnImport("InstancedMesh");}},{key:"_PhysicsImpostorParser",value:function _PhysicsImpostorParser(scene2,physicObject,jsonObject){throw _WarnImport("PhysicsImpostor");}},{key:"Parse",value:function Parse(parsedMesh,scene2,rootUrl){var mesh;if(parsedMesh.type&&parsedMesh.type==="LinesMesh"){mesh=Mesh._LinesMeshParser(parsedMesh,scene2);}else if(parsedMesh.type&&parsedMesh.type==="GroundMesh"){mesh=Mesh._GroundMeshParser(parsedMesh,scene2);}else if(parsedMesh.type&&parsedMesh.type==="GoldbergMesh"){mesh=Mesh._GoldbergMeshParser(parsedMesh,scene2);}else{mesh=new Mesh(parsedMesh.name,scene2);}mesh.id=parsedMesh.id;mesh._waitingParsedUniqueId=parsedMesh.uniqueId;if(Tags){Tags.AddTagsTo(mesh,parsedMesh.tags);}mesh.position=Vector3.FromArray(parsedMesh.position);if(parsedMesh.metadata!==void 0){mesh.metadata=parsedMesh.metadata;}if(parsedMesh.rotationQuaternion){mesh.rotationQuaternion=Quaternion.FromArray(parsedMesh.rotationQuaternion);}else if(parsedMesh.rotation){mesh.rotation=Vector3.FromArray(parsedMesh.rotation);}mesh.scaling=Vector3.FromArray(parsedMesh.scaling);if(parsedMesh.localMatrix){mesh.setPreTransformMatrix(Matrix.FromArray(parsedMesh.localMatrix));}else if(parsedMesh.pivotMatrix){mesh.setPivotMatrix(Matrix.FromArray(parsedMesh.pivotMatrix));}mesh.setEnabled(parsedMesh.isEnabled);mesh.isVisible=parsedMesh.isVisible;mesh.infiniteDistance=parsedMesh.infiniteDistance;mesh.showBoundingBox=parsedMesh.showBoundingBox;mesh.showSubMeshesBoundingBox=parsedMesh.showSubMeshesBoundingBox;if(parsedMesh.applyFog!==void 0){mesh.applyFog=parsedMesh.applyFog;}if(parsedMesh.pickable!==void 0){mesh.isPickable=parsedMesh.pickable;}if(parsedMesh.alphaIndex!==void 0){mesh.alphaIndex=parsedMesh.alphaIndex;}mesh.receiveShadows=parsedMesh.receiveShadows;if(parsedMesh.billboardMode!==void 0){mesh.billboardMode=parsedMesh.billboardMode;}if(parsedMesh.visibility!==void 0){mesh.visibility=parsedMesh.visibility;}mesh.checkCollisions=parsedMesh.checkCollisions;mesh.overrideMaterialSideOrientation=parsedMesh.overrideMaterialSideOrientation;if(parsedMesh.isBlocker!==void 0){mesh.isBlocker=parsedMesh.isBlocker;}mesh._shouldGenerateFlatShading=parsedMesh.useFlatShading;if(parsedMesh.freezeWorldMatrix){mesh._waitingData.freezeWorldMatrix=parsedMesh.freezeWorldMatrix;}if(parsedMesh.parentId!==void 0){mesh._waitingParentId=parsedMesh.parentId;}if(parsedMesh.parentInstanceIndex!==void 0){mesh._waitingParentInstanceIndex=parsedMesh.parentInstanceIndex;}if(parsedMesh.actions!==void 0){mesh._waitingData.actions=parsedMesh.actions;}if(parsedMesh.overlayAlpha!==void 0){mesh.overlayAlpha=parsedMesh.overlayAlpha;}if(parsedMesh.overlayColor!==void 0){mesh.overlayColor=Color3.FromArray(parsedMesh.overlayColor);}if(parsedMesh.renderOverlay!==void 0){mesh.renderOverlay=parsedMesh.renderOverlay;}mesh.isUnIndexed=!!parsedMesh.isUnIndexed;mesh.hasVertexAlpha=parsedMesh.hasVertexAlpha;if(parsedMesh.delayLoadingFile){mesh.delayLoadState=4;mesh.delayLoadingFile=rootUrl+parsedMesh.delayLoadingFile;mesh.buildBoundingInfo(Vector3.FromArray(parsedMesh.boundingBoxMinimum),Vector3.FromArray(parsedMesh.boundingBoxMaximum));if(parsedMesh._binaryInfo){mesh._binaryInfo=parsedMesh._binaryInfo;}mesh._delayInfo=[];if(parsedMesh.hasUVs){mesh._delayInfo.push(VertexBuffer.UVKind);}if(parsedMesh.hasUVs2){mesh._delayInfo.push(VertexBuffer.UV2Kind);}if(parsedMesh.hasUVs3){mesh._delayInfo.push(VertexBuffer.UV3Kind);}if(parsedMesh.hasUVs4){mesh._delayInfo.push(VertexBuffer.UV4Kind);}if(parsedMesh.hasUVs5){mesh._delayInfo.push(VertexBuffer.UV5Kind);}if(parsedMesh.hasUVs6){mesh._delayInfo.push(VertexBuffer.UV6Kind);}if(parsedMesh.hasColors){mesh._delayInfo.push(VertexBuffer.ColorKind);}if(parsedMesh.hasMatricesIndices){mesh._delayInfo.push(VertexBuffer.MatricesIndicesKind);}if(parsedMesh.hasMatricesWeights){mesh._delayInfo.push(VertexBuffer.MatricesWeightsKind);}mesh._delayLoadingFunction=Geometry._ImportGeometry;if(SceneLoaderFlags.ForceFullSceneLoadingForIncremental){mesh._checkDelayState();}}else{Geometry._ImportGeometry(parsedMesh,mesh);}if(parsedMesh.materialUniqueId){mesh._waitingMaterialId=parsedMesh.materialUniqueId;}else if(parsedMesh.materialId){mesh._waitingMaterialId=parsedMesh.materialId;}if(parsedMesh.morphTargetManagerId>-1){mesh.morphTargetManager=scene2.getMorphTargetManagerById(parsedMesh.morphTargetManagerId);}if(parsedMesh.skeletonId!==void 0&&parsedMesh.skeletonId!==null){mesh.skeleton=scene2.getLastSkeletonById(parsedMesh.skeletonId);if(parsedMesh.numBoneInfluencers){mesh.numBoneInfluencers=parsedMesh.numBoneInfluencers;}}if(parsedMesh.animations){for(var animationIndex=0;animationIndex<parsedMesh.animations.length;animationIndex++){var parsedAnimation=parsedMesh.animations[animationIndex];var internalClass=GetClass("BABYLON.Animation");if(internalClass){mesh.animations.push(internalClass.Parse(parsedAnimation));}}Node.ParseAnimationRanges(mesh,parsedMesh,scene2);}if(parsedMesh.autoAnimate){scene2.beginAnimation(mesh,parsedMesh.autoAnimateFrom,parsedMesh.autoAnimateTo,parsedMesh.autoAnimateLoop,parsedMesh.autoAnimateSpeed||1);}if(parsedMesh.layerMask&&!isNaN(parsedMesh.layerMask)){mesh.layerMask=Math.abs(parseInt(parsedMesh.layerMask));}else{mesh.layerMask=268435455;}if(parsedMesh.physicsImpostor){Mesh._PhysicsImpostorParser(scene2,mesh,parsedMesh);}if(parsedMesh.lodMeshIds){mesh._waitingData.lods={ids:parsedMesh.lodMeshIds,distances:parsedMesh.lodDistances?parsedMesh.lodDistances:null,coverages:parsedMesh.lodCoverages?parsedMesh.lodCoverages:null};}if(parsedMesh.instances){for(var index=0;index<parsedMesh.instances.length;index++){var parsedInstance=parsedMesh.instances[index];var instance=mesh.createInstance(parsedInstance.name);if(parsedInstance.id){instance.id=parsedInstance.id;}if(Tags){if(parsedInstance.tags){Tags.AddTagsTo(instance,parsedInstance.tags);}else{Tags.AddTagsTo(instance,parsedMesh.tags);}}instance.position=Vector3.FromArray(parsedInstance.position);if(parsedInstance.metadata!==void 0){instance.metadata=parsedInstance.metadata;}if(parsedInstance.parentId!==void 0){instance._waitingParentId=parsedInstance.parentId;}if(parsedInstance.parentInstanceIndex!==void 0){instance._waitingParentInstanceIndex=parsedInstance.parentInstanceIndex;}if(parsedInstance.isEnabled!==void 0&&parsedInstance.isEnabled!==null){instance.setEnabled(parsedInstance.isEnabled);}if(parsedInstance.isVisible!==void 0&&parsedInstance.isVisible!==null){instance.isVisible=parsedInstance.isVisible;}if(parsedInstance.isPickable!==void 0&&parsedInstance.isPickable!==null){instance.isPickable=parsedInstance.isPickable;}if(parsedInstance.rotationQuaternion){instance.rotationQuaternion=Quaternion.FromArray(parsedInstance.rotationQuaternion);}else if(parsedInstance.rotation){instance.rotation=Vector3.FromArray(parsedInstance.rotation);}instance.scaling=Vector3.FromArray(parsedInstance.scaling);if(parsedInstance.checkCollisions!=void 0&&parsedInstance.checkCollisions!=null){instance.checkCollisions=parsedInstance.checkCollisions;}if(parsedInstance.pickable!=void 0&&parsedInstance.pickable!=null){instance.isPickable=parsedInstance.pickable;}if(parsedInstance.showBoundingBox!=void 0&&parsedInstance.showBoundingBox!=null){instance.showBoundingBox=parsedInstance.showBoundingBox;}if(parsedInstance.showSubMeshesBoundingBox!=void 0&&parsedInstance.showSubMeshesBoundingBox!=null){instance.showSubMeshesBoundingBox=parsedInstance.showSubMeshesBoundingBox;}if(parsedInstance.alphaIndex!=void 0&&parsedInstance.showSubMeshesBoundingBox!=null){instance.alphaIndex=parsedInstance.alphaIndex;}if(parsedInstance.physicsImpostor){Mesh._PhysicsImpostorParser(scene2,instance,parsedInstance);}if(parsedInstance.actions!==void 0){instance._waitingData.actions=parsedInstance.actions;}if(parsedInstance.animations){for(var _animationIndex=0;_animationIndex<parsedInstance.animations.length;_animationIndex++){var _parsedAnimation=parsedInstance.animations[_animationIndex];var _internalClass=GetClass("BABYLON.Animation");if(_internalClass){instance.animations.push(_internalClass.Parse(_parsedAnimation));}}Node.ParseAnimationRanges(instance,parsedInstance,scene2);if(parsedInstance.autoAnimate){scene2.beginAnimation(instance,parsedInstance.autoAnimateFrom,parsedInstance.autoAnimateTo,parsedInstance.autoAnimateLoop,parsedInstance.autoAnimateSpeed||1);}}}}if(parsedMesh.thinInstances){var thinInstances=parsedMesh.thinInstances;mesh.thinInstanceEnablePicking=!!thinInstances.enablePicking;if(thinInstances.matrixData){mesh.thinInstanceSetBuffer("matrix",new Float32Array(thinInstances.matrixData),16,false);mesh._thinInstanceDataStorage.matrixBufferSize=thinInstances.matrixBufferSize;mesh._thinInstanceDataStorage.instancesCount=thinInstances.instancesCount;}else{mesh._thinInstanceDataStorage.matrixBufferSize=thinInstances.matrixBufferSize;}if(parsedMesh.thinInstances.userThinInstance){var userThinInstance=parsedMesh.thinInstances.userThinInstance;for(var kind in userThinInstance.data){mesh.thinInstanceSetBuffer(kind,new Float32Array(userThinInstance.data[kind]),userThinInstance.strides[kind],false);mesh._userThinInstanceBuffersStorage.sizes[kind]=userThinInstance.sizes[kind];}}}return mesh;}},{key:"MinMax",value:function MinMax(meshes){var minVector=null;var maxVector=null;meshes.forEach(function(mesh){var boundingInfo=mesh.getBoundingInfo();var boundingBox=boundingInfo.boundingBox;if(!minVector||!maxVector){minVector=boundingBox.minimumWorld;maxVector=boundingBox.maximumWorld;}else{minVector.minimizeInPlace(boundingBox.minimumWorld);maxVector.maximizeInPlace(boundingBox.maximumWorld);}});if(!minVector||!maxVector){return{min:Vector3.Zero(),max:Vector3.Zero()};}return{min:minVector,max:maxVector};}},{key:"Center",value:function Center(meshesOrMinMaxVector){var minMaxVector=meshesOrMinMaxVector instanceof Array?Mesh.MinMax(meshesOrMinMaxVector):meshesOrMinMaxVector;return Vector3.Center(minMaxVector.min,minMaxVector.max);}},{key:"MergeMeshes",value:function MergeMeshes(meshes){var disposeSource=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var allow32BitsIndices=arguments.length>2?arguments[2]:undefined;var meshSubclass=arguments.length>3?arguments[3]:undefined;var subdivideWithSubMeshes=arguments.length>4?arguments[4]:undefined;var multiMultiMaterials=arguments.length>5?arguments[5]:undefined;return runCoroutineSync(Mesh._MergeMeshesCoroutine(meshes,disposeSource,allow32BitsIndices,meshSubclass,subdivideWithSubMeshes,multiMultiMaterials,false));}},{key:"MergeMeshesAsync",value:function MergeMeshesAsync(meshes){var disposeSource=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var allow32BitsIndices=arguments.length>2?arguments[2]:undefined;var meshSubclass=arguments.length>3?arguments[3]:undefined;var subdivideWithSubMeshes=arguments.length>4?arguments[4]:undefined;var multiMultiMaterials=arguments.length>5?arguments[5]:undefined;return runCoroutineAsync(Mesh._MergeMeshesCoroutine(meshes,disposeSource,allow32BitsIndices,meshSubclass,subdivideWithSubMeshes,multiMultiMaterials,true),createYieldingScheduler());}},{key:"_MergeMeshesCoroutine",value:function _MergeMeshesCoroutine(meshes){var disposeSource=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var allow32BitsIndices=arguments.length>2?arguments[2]:undefined;var meshSubclass=arguments.length>3?arguments[3]:undefined;var subdivideWithSubMeshes=arguments.length>4?arguments[4]:undefined;var multiMultiMaterials=arguments.length>5?arguments[5]:undefined;var isAsync=arguments.length>6?arguments[6]:undefined;return/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(){var index,totalVertices,materialArray,materialIndexArray,indiceArray,currentOverrideMaterialSideOrientation,mesh,material,matIndex,subIndex,_subIndex,_subIndex2,source,getVertexDataFromMesh,_getVertexDataFromMes,_getVertexDataFromMes2,sourceVertexData,sourceTransform,meshVertexDatas,i,mergeCoroutine,mergeCoroutineStep,vertexData,applyToCoroutine,applyToCoroutineStep,offset,_iterator123,_step133,subMesh,newMultiMaterial,_subIndex3;return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:meshes=meshes.filter(Boolean);if(!(meshes.length===0)){_context5.next=3;break;}return _context5.abrupt("return",null);case 3:if(allow32BitsIndices){_context5.next=14;break;}totalVertices=0;index=0;case 6:if(!(index<meshes.length)){_context5.next=14;break;}totalVertices+=meshes[index].getTotalVertices();if(!(totalVertices>=65536)){_context5.next=11;break;}Logger.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices");return _context5.abrupt("return",null);case 11:index++;_context5.next=6;break;case 14:if(multiMultiMaterials){subdivideWithSubMeshes=false;}materialArray=new Array();materialIndexArray=new Array();indiceArray=new Array();currentOverrideMaterialSideOrientation=meshes[0].overrideMaterialSideOrientation;index=0;case 20:if(!(index<meshes.length)){_context5.next=33;break;}mesh=meshes[index];if(!mesh.isAnInstance){_context5.next=25;break;}Logger.Warn("Cannot merge instance meshes.");return _context5.abrupt("return",null);case 25:if(!(currentOverrideMaterialSideOrientation!==mesh.overrideMaterialSideOrientation)){_context5.next=28;break;}Logger.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values.");return _context5.abrupt("return",null);case 28:if(subdivideWithSubMeshes){indiceArray.push(mesh.getTotalIndices());}if(multiMultiMaterials){if(mesh.material){material=mesh.material;if(material instanceof MultiMaterial){for(matIndex=0;matIndex<material.subMaterials.length;matIndex++){if(materialArray.indexOf(material.subMaterials[matIndex])<0){materialArray.push(material.subMaterials[matIndex]);}}for(subIndex=0;subIndex<mesh.subMeshes.length;subIndex++){materialIndexArray.push(materialArray.indexOf(material.subMaterials[mesh.subMeshes[subIndex].materialIndex]));indiceArray.push(mesh.subMeshes[subIndex].indexCount);}}else{if(materialArray.indexOf(material)<0){materialArray.push(material);}for(_subIndex=0;_subIndex<mesh.subMeshes.length;_subIndex++){materialIndexArray.push(materialArray.indexOf(material));indiceArray.push(mesh.subMeshes[_subIndex].indexCount);}}}else{for(_subIndex2=0;_subIndex2<mesh.subMeshes.length;_subIndex2++){materialIndexArray.push(0);indiceArray.push(mesh.subMeshes[_subIndex2].indexCount);}}}case 30:index++;_context5.next=20;break;case 33:source=meshes[0];getVertexDataFromMesh=function getVertexDataFromMesh(mesh){var wm=mesh.computeWorldMatrix(true);var vertexData2=VertexData.ExtractFromMesh(mesh,false,false);return[vertexData2,wm];};_getVertexDataFromMes=getVertexDataFromMesh(source),_getVertexDataFromMes2=_slicedToArray(_getVertexDataFromMes,2),sourceVertexData=_getVertexDataFromMes2[0],sourceTransform=_getVertexDataFromMes2[1];if(!isAsync){_context5.next=39;break;}_context5.next=39;return;case 39:meshVertexDatas=new Array(meshes.length-1);i=1;case 41:if(!(i<meshes.length)){_context5.next=49;break;}meshVertexDatas[i-1]=getVertexDataFromMesh(meshes[i]);if(!isAsync){_context5.next=46;break;}_context5.next=46;return;case 46:i++;_context5.next=41;break;case 49:mergeCoroutine=sourceVertexData._mergeCoroutine(sourceTransform,meshVertexDatas,allow32BitsIndices,isAsync,!disposeSource);mergeCoroutineStep=mergeCoroutine.next();case 51:if(mergeCoroutineStep.done){_context5.next=58;break;}if(!isAsync){_context5.next=55;break;}_context5.next=55;return;case 55:mergeCoroutineStep=mergeCoroutine.next();_context5.next=51;break;case 58:vertexData=mergeCoroutineStep.value;if(!meshSubclass){meshSubclass=new Mesh(source.name+"_merged",source.getScene());}applyToCoroutine=vertexData._applyToCoroutine(meshSubclass,void 0,isAsync);applyToCoroutineStep=applyToCoroutine.next();case 62:if(applyToCoroutineStep.done){_context5.next=69;break;}if(!isAsync){_context5.next=66;break;}_context5.next=66;return;case 66:applyToCoroutineStep=applyToCoroutine.next();_context5.next=62;break;case 69:meshSubclass.checkCollisions=source.checkCollisions;meshSubclass.overrideMaterialSideOrientation=source.overrideMaterialSideOrientation;if(disposeSource){for(index=0;index<meshes.length;index++){meshes[index].dispose();}}if(subdivideWithSubMeshes||multiMultiMaterials){meshSubclass.releaseSubMeshes();index=0;offset=0;while(index<indiceArray.length){SubMesh.CreateFromIndices(0,offset,indiceArray[index],meshSubclass,void 0,false);offset+=indiceArray[index];index++;}_iterator123=_createForOfIteratorHelper(meshSubclass.subMeshes);try{for(_iterator123.s();!(_step133=_iterator123.n()).done;){subMesh=_step133.value;subMesh.refreshBoundingInfo();}}catch(err){_iterator123.e(err);}finally{_iterator123.f();}meshSubclass.computeWorldMatrix(true);}if(multiMultiMaterials){newMultiMaterial=new MultiMaterial(source.name+"_merged",source.getScene());newMultiMaterial.subMaterials=materialArray;for(_subIndex3=0;_subIndex3<meshSubclass.subMeshes.length;_subIndex3++){meshSubclass.subMeshes[_subIndex3].materialIndex=materialIndexArray[_subIndex3];}meshSubclass.material=newMultiMaterial;}else{meshSubclass.material=source.material;}return _context5.abrupt("return",meshSubclass);case 75:case"end":return _context5.stop();}},_callee5);})();}}]);return Mesh;}(AbstractMesh);Mesh.FRONTSIDE=VertexData.FRONTSIDE;Mesh.BACKSIDE=VertexData.BACKSIDE;Mesh.DOUBLESIDE=VertexData.DOUBLESIDE;Mesh.DEFAULTSIDE=VertexData.DEFAULTSIDE;Mesh.NO_CAP=0;Mesh.CAP_START=1;Mesh.CAP_END=2;Mesh.CAP_ALL=3;Mesh.NO_FLIP=0;Mesh.FLIP_TILE=1;Mesh.ROTATE_TILE=2;Mesh.FLIP_ROW=3;Mesh.ROTATE_ROW=4;Mesh.FLIP_N_ROTATE_TILE=5;Mesh.FLIP_N_ROTATE_ROW=6;Mesh.CENTER=0;Mesh.LEFT=1;Mesh.RIGHT=2;Mesh.TOP=3;Mesh.BOTTOM=4;Mesh.INSTANCEDMESH_SORT_TRANSPARENT=false;Mesh._GroundMeshParser=function(parsedMesh,scene2){throw _WarnImport("GroundMesh");};Mesh._GoldbergMeshParser=function(parsedMesh,scene2){throw _WarnImport("GoldbergMesh");};Mesh._LinesMeshParser=function(parsedMesh,scene2){throw _WarnImport("LinesMesh");};RegisterClass("BABYLON.Mesh",Mesh);Mesh.prototype.setMaterialByID=function(id){return this.setMaterialById(id);};Mesh.CreateDisc=Mesh.CreateDisc||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateBox=Mesh.CreateBox||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateSphere=Mesh.CreateSphere||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateCylinder=Mesh.CreateCylinder||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateTorusKnot=Mesh.CreateTorusKnot||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateTorus=Mesh.CreateTorus||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreatePlane=Mesh.CreatePlane||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateGround=Mesh.CreateGround||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateTiledGround=Mesh.CreateTiledGround||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateGroundFromHeightMap=Mesh.CreateGroundFromHeightMap||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateTube=Mesh.CreateTube||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreatePolyhedron=Mesh.CreatePolyhedron||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateIcoSphere=Mesh.CreateIcoSphere||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateDecal=Mesh.CreateDecal||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.CreateCapsule=Mesh.CreateCapsule||function(){throw new Error("Import MeshBuilder to populate this function");};Mesh.ExtendToGoldberg=Mesh.ExtendToGoldberg||function(){throw new Error("Import MeshBuilder to populate this function");};// node_modules/@babylonjs/core/Meshes/instancedMesh.js
Mesh._instancedMeshFactory=function(name135,mesh){var instance=new InstancedMesh(name135,mesh);if(mesh.instancedBuffers){instance.instancedBuffers={};for(var key in mesh.instancedBuffers){instance.instancedBuffers[key]=mesh.instancedBuffers[key];}}return instance;};var InstancedMesh=/*#__PURE__*/function(_AbstractMesh2){_inherits(InstancedMesh,_AbstractMesh2);var _super26=_createSuper(InstancedMesh);function InstancedMesh(name135,source){var _this90;_classCallCheck(this,InstancedMesh);_this90=_super26.call(this,name135,source.getScene());_this90._indexInSourceMeshInstanceArray=-1;_this90._distanceToCamera=0;source.addInstance(_assertThisInitialized(_this90));_this90._sourceMesh=source;_this90._unIndexed=source._unIndexed;_this90.position.copyFrom(source.position);_this90.rotation.copyFrom(source.rotation);_this90.scaling.copyFrom(source.scaling);if(source.rotationQuaternion){_this90.rotationQuaternion=source.rotationQuaternion.clone();}_this90.animations=source.animations.slice();var _iterator124=_createForOfIteratorHelper(source.getAnimationRanges()),_step134;try{for(_iterator124.s();!(_step134=_iterator124.n()).done;){var range=_step134.value;if(range!=null){_this90.createAnimationRange(range.name,range.from,range.to);}}}catch(err){_iterator124.e(err);}finally{_iterator124.f();}_this90.infiniteDistance=source.infiniteDistance;_this90.setPivotMatrix(source.getPivotMatrix());_this90.refreshBoundingInfo(true,true);_this90._syncSubMeshes();return _this90;}_createClass(InstancedMesh,[{key:"getClassName",value:function getClassName(){return"InstancedMesh";}},{key:"lightSources",get:function get(){return this._sourceMesh._lightSources;}},{key:"_resyncLightSources",value:function _resyncLightSources(){}},{key:"_resyncLightSource",value:function _resyncLightSource(){}},{key:"_removeLightSource",value:function _removeLightSource(){}},{key:"receiveShadows",get:function get(){return this._sourceMesh.receiveShadows;}},{key:"material",get:function get(){return this._sourceMesh.material;}},{key:"visibility",get:function get(){return this._sourceMesh.visibility;}},{key:"skeleton",get:function get(){return this._sourceMesh.skeleton;}},{key:"renderingGroupId",get:function get(){return this._sourceMesh.renderingGroupId;},set:function set(value){if(!this._sourceMesh||value===this._sourceMesh.renderingGroupId){return;}Logger.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene");}},{key:"getTotalVertices",value:function getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0;}},{key:"getTotalIndices",value:function getTotalIndices(){return this._sourceMesh.getTotalIndices();}},{key:"sourceMesh",get:function get(){return this._sourceMesh;}},{key:"createInstance",value:function createInstance(name135){return this._sourceMesh.createInstance(name135);}},{key:"isReady",value:function isReady(){var completeCheck=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;return this._sourceMesh.isReady(completeCheck,true);}},{key:"getVerticesData",value:function getVerticesData(kind,copyWhenShared){return this._sourceMesh.getVerticesData(kind,copyWhenShared);}},{key:"setVerticesData",value:function setVerticesData(kind,data,updatable,stride){if(this.sourceMesh){this.sourceMesh.setVerticesData(kind,data,updatable,stride);}return this.sourceMesh;}},{key:"updateVerticesData",value:function updateVerticesData(kind,data,updateExtends,makeItUnique){if(this.sourceMesh){this.sourceMesh.updateVerticesData(kind,data,updateExtends,makeItUnique);}return this.sourceMesh;}},{key:"setIndices",value:function setIndices(indices){var totalVertices=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(this.sourceMesh){this.sourceMesh.setIndices(indices,totalVertices);}return this.sourceMesh;}},{key:"isVerticesDataPresent",value:function isVerticesDataPresent(kind){return this._sourceMesh.isVerticesDataPresent(kind);}},{key:"getIndices",value:function getIndices(){return this._sourceMesh.getIndices();}},{key:"_positions",get:function get(){return this._sourceMesh._positions;}},{key:"refreshBoundingInfo",value:function refreshBoundingInfo(){var applySkeleton=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applyMorph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked){return this;}var bias=this._sourceMesh.geometry?this._sourceMesh.geometry.boundingBias:null;this._refreshBoundingInfo(this._sourceMesh._getPositionData(applySkeleton,applyMorph),bias);return this;}},{key:"_preActivate",value:function _preActivate(){if(this._currentLOD){this._currentLOD._preActivate();}return this;}},{key:"_activate",value:function _activate(renderId,intermediateRendering){_get(_getPrototypeOf(InstancedMesh.prototype),"_activate",this).call(this,renderId,intermediateRendering);if(!this._sourceMesh.subMeshes){Logger.Warn("Instances should only be created for meshes with geometry.");}if(this._currentLOD){var differentSign=this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0;if(differentSign){this._internalAbstractMeshDataInfo._actAsRegularMesh=true;return true;}this._internalAbstractMeshDataInfo._actAsRegularMesh=false;this._currentLOD._registerInstanceForRenderId(this,renderId);if(intermediateRendering){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate){this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=true;return true;}}else{if(!this._currentLOD._internalAbstractMeshDataInfo._isActive){this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=true;return true;}}}return false;}},{key:"_postActivate",value:function _postActivate(){if(this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup){this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer);this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix());}else if(this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup){this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer);}}},{key:"getWorldMatrix",value:function getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==TransformNode.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){if(!this._billboardWorldMatrix){this._billboardWorldMatrix=new Matrix();}var tempMaster=this._currentLOD._masterMesh;this._currentLOD._masterMesh=this;TmpVectors.Vector3[7].copyFrom(this._currentLOD.position);this._currentLOD.position.set(0,0,0);this._billboardWorldMatrix.copyFrom(this._currentLOD.computeWorldMatrix(true));this._currentLOD.position.copyFrom(TmpVectors.Vector3[7]);this._currentLOD._masterMesh=tempMaster;return this._billboardWorldMatrix;}return _get(_getPrototypeOf(InstancedMesh.prototype),"getWorldMatrix",this).call(this);}},{key:"isAnInstance",get:function get(){return true;}},{key:"getLOD",value:function getLOD(camera){if(!camera){return this;}var sourceMeshLODLevels=this.sourceMesh.getLODLevels();if(!sourceMeshLODLevels||sourceMeshLODLevels.length===0){this._currentLOD=this.sourceMesh;}else{var boundingInfo=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(camera,boundingInfo.boundingSphere);}return this._currentLOD;}},{key:"_preActivateForIntermediateRendering",value:function _preActivateForIntermediateRendering(renderId){return this.sourceMesh._preActivateForIntermediateRendering(renderId);}},{key:"_syncSubMeshes",value:function _syncSubMeshes(){this.releaseSubMeshes();if(this._sourceMesh.subMeshes){for(var index=0;index<this._sourceMesh.subMeshes.length;index++){this._sourceMesh.subMeshes[index].clone(this,this._sourceMesh);}}return this;}},{key:"_generatePointsArray",value:function _generatePointsArray(){return this._sourceMesh._generatePointsArray();}},{key:"_updateBoundingInfo",value:function _updateBoundingInfo(){if(this.hasBoundingInfo){this.getBoundingInfo().update(this.worldMatrixFromCache);}else{this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache);}this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache);return this;}},{key:"clone",value:function clone(name135){var newParent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var doNotCloneChildren=arguments.length>2?arguments[2]:undefined;var newSourceMesh=arguments.length>3?arguments[3]:undefined;var result=(newSourceMesh||this._sourceMesh).createInstance(name135);DeepCopier.DeepCopy(this,result,["name","subMeshes","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]);this.refreshBoundingInfo();if(newParent){result.parent=newParent;}if(!doNotCloneChildren){for(var index=0;index<this.getScene().meshes.length;index++){var mesh=this.getScene().meshes[index];if(mesh.parent===this){mesh.clone(mesh.name,result);}}}result.computeWorldMatrix(true);this.onClonedObservable.notifyObservers(result);return result;}},{key:"dispose",value:function dispose(doNotRecurse){var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._sourceMesh.removeInstance(this);_get(_getPrototypeOf(InstancedMesh.prototype),"dispose",this).call(this,doNotRecurse,disposeMaterialAndTextures);}},{key:"_serializeAsParent",value:function _serializeAsParent(serializationObject){_get(_getPrototypeOf(InstancedMesh.prototype),"_serializeAsParent",this).call(this,serializationObject);serializationObject.parentId=this._sourceMesh.uniqueId;serializationObject.parentInstanceIndex=this._indexInSourceMeshInstanceArray;}},{key:"instantiateHierarchy",value:function instantiateHierarchy(){var newParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var options=arguments.length>1?arguments[1]:undefined;var onNewNodeCreated=arguments.length>2?arguments[2]:undefined;var clone=this.clone("Clone of "+(this.name||this.id),newParent||this.parent,true,options&&options.newSourcedMesh);if(clone){if(onNewNodeCreated){onNewNodeCreated(this,clone);}}var _iterator125=_createForOfIteratorHelper(this.getChildTransformNodes(true)),_step135;try{for(_iterator125.s();!(_step135=_iterator125.n()).done;){var child=_step135.value;child.instantiateHierarchy(clone,options,onNewNodeCreated);}}catch(err){_iterator125.e(err);}finally{_iterator125.f();}return clone;}}]);return InstancedMesh;}(AbstractMesh);Mesh.prototype.registerInstancedBuffer=function(kind,stride){var _a,_b;(_b=(_a=this._userInstancedBuffersStorage)===null||_a===void 0?void 0:_a.vertexBuffers[kind])===null||_b===void 0?void 0:_b.dispose();if(!this.instancedBuffers){this.instancedBuffers={};var _iterator126=_createForOfIteratorHelper(this.instances),_step136;try{for(_iterator126.s();!(_step136=_iterator126.n()).done;){var instance=_step136.value;instance.instancedBuffers={};}}catch(err){_iterator126.e(err);}finally{_iterator126.f();}if(!this._userInstancedBuffersStorage){this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0};}}this.instancedBuffers[kind]=null;this._userInstancedBuffersStorage.strides[kind]=stride;this._userInstancedBuffersStorage.sizes[kind]=stride*32;this._userInstancedBuffersStorage.data[kind]=new Float32Array(this._userInstancedBuffersStorage.sizes[kind]);this._userInstancedBuffersStorage.vertexBuffers[kind]=new VertexBuffer(this.getEngine(),this._userInstancedBuffersStorage.data[kind],kind,true,false,stride,true);var _iterator127=_createForOfIteratorHelper(this.instances),_step137;try{for(_iterator127.s();!(_step137=_iterator127.n()).done;){var _instance=_step137.value;_instance.instancedBuffers[kind]=null;}}catch(err){_iterator127.e(err);}finally{_iterator127.f();}this._invalidateInstanceVertexArrayObject();this._markSubMeshesAsAttributesDirty();};Mesh.prototype._processInstancedBuffers=function(visibleInstances,renderSelf){var instanceCount=visibleInstances?visibleInstances.length:0;for(var kind in this.instancedBuffers){var size=this._userInstancedBuffersStorage.sizes[kind];var stride=this._userInstancedBuffersStorage.strides[kind];var expectedSize=(instanceCount+1)*stride;while(size<expectedSize){size*=2;}if(this._userInstancedBuffersStorage.data[kind].length!=size){this._userInstancedBuffersStorage.data[kind]=new Float32Array(size);this._userInstancedBuffersStorage.sizes[kind]=size;if(this._userInstancedBuffersStorage.vertexBuffers[kind]){this._userInstancedBuffersStorage.vertexBuffers[kind].dispose();this._userInstancedBuffersStorage.vertexBuffers[kind]=null;}}var data=this._userInstancedBuffersStorage.data[kind];var offset=0;if(renderSelf){var value=this.instancedBuffers[kind];if(value.toArray){value.toArray(data,offset);}else if(value.copyToArray){value.copyToArray(data,offset);}else{data[offset]=value;}offset+=stride;}for(var instanceIndex=0;instanceIndex<instanceCount;instanceIndex++){var instance=visibleInstances[instanceIndex];var _value4=instance.instancedBuffers[kind];if(_value4.toArray){_value4.toArray(data,offset);}else if(_value4.copyToArray){_value4.copyToArray(data,offset);}else{data[offset]=_value4;}offset+=stride;}if(!this._userInstancedBuffersStorage.vertexBuffers[kind]){this._userInstancedBuffersStorage.vertexBuffers[kind]=new VertexBuffer(this.getEngine(),this._userInstancedBuffersStorage.data[kind],kind,true,false,stride,true);this._invalidateInstanceVertexArrayObject();}else{this._userInstancedBuffersStorage.vertexBuffers[kind].updateDirectly(data,0);}}};Mesh.prototype._invalidateInstanceVertexArrayObject=function(){if(!this._userInstancedBuffersStorage||this._userInstancedBuffersStorage.vertexArrayObjects===void 0){return;}for(var kind in this._userInstancedBuffersStorage.vertexArrayObjects){this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[kind]);}this._userInstancedBuffersStorage.vertexArrayObjects={};};Mesh.prototype._disposeInstanceSpecificData=function(){if(this._instanceDataStorage.instancesBuffer){this._instanceDataStorage.instancesBuffer.dispose();this._instanceDataStorage.instancesBuffer=null;}while(this.instances.length){this.instances[0].dispose();}for(var kind in this.instancedBuffers){if(this._userInstancedBuffersStorage.vertexBuffers[kind]){this._userInstancedBuffersStorage.vertexBuffers[kind].dispose();}}this._invalidateInstanceVertexArrayObject();this.instancedBuffers={};};// node_modules/@babylonjs/core/Lights/light.js
var Light=/*#__PURE__*/function(_Node3){_inherits(Light,_Node3);var _super27=_createSuper(Light);function Light(name135,scene2){var _this91;_classCallCheck(this,Light);_this91=_super27.call(this,name135,scene2);_this91.diffuse=new Color3(1,1,1);_this91.specular=new Color3(1,1,1);_this91.falloffType=Light.FALLOFF_DEFAULT;_this91.intensity=1;_this91._range=Number.MAX_VALUE;_this91._inverseSquaredRange=0;_this91._photometricScale=1;_this91._intensityMode=Light.INTENSITYMODE_AUTOMATIC;_this91._radius=1e-5;_this91.renderPriority=0;_this91._shadowEnabled=true;_this91._excludeWithLayerMask=0;_this91._includeOnlyWithLayerMask=0;_this91._lightmapMode=0;_this91._shadowGenerators=null;_this91._excludedMeshesIds=new Array();_this91._includedOnlyMeshesIds=new Array();_this91._isLight=true;_this91.getScene().addLight(_assertThisInitialized(_this91));_this91._uniformBuffer=new UniformBuffer(_this91.getScene().getEngine(),void 0,void 0,name135);_this91._buildUniformLayout();_this91.includedOnlyMeshes=new Array();_this91.excludedMeshes=new Array();_this91._resyncMeshes();return _this91;}_createClass(Light,[{key:"range",get:function get(){return this._range;},set:function set(value){this._range=value;this._inverseSquaredRange=1/(this.range*this.range);}},{key:"intensityMode",get:function get(){return this._intensityMode;},set:function set(value){this._intensityMode=value;this._computePhotometricScale();}},{key:"radius",get:function get(){return this._radius;},set:function set(value){this._radius=value;this._computePhotometricScale();}},{key:"shadowEnabled",get:function get(){return this._shadowEnabled;},set:function set(value){if(this._shadowEnabled===value){return;}this._shadowEnabled=value;this._markMeshesAsLightDirty();}},{key:"includedOnlyMeshes",get:function get(){return this._includedOnlyMeshes;},set:function set(value){this._includedOnlyMeshes=value;this._hookArrayForIncludedOnly(value);}},{key:"excludedMeshes",get:function get(){return this._excludedMeshes;},set:function set(value){this._excludedMeshes=value;this._hookArrayForExcluded(value);}},{key:"excludeWithLayerMask",get:function get(){return this._excludeWithLayerMask;},set:function set(value){this._excludeWithLayerMask=value;this._resyncMeshes();}},{key:"includeOnlyWithLayerMask",get:function get(){return this._includeOnlyWithLayerMask;},set:function set(value){this._includeOnlyWithLayerMask=value;this._resyncMeshes();}},{key:"lightmapMode",get:function get(){return this._lightmapMode;},set:function set(value){if(this._lightmapMode===value){return;}this._lightmapMode=value;this._markMeshesAsLightDirty();}},{key:"transferTexturesToEffect",value:function transferTexturesToEffect(effect,lightIndex){return this;}},{key:"_bindLight",value:function _bindLight(lightIndex,scene2,effect,useSpecular){var receiveShadows=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var _a;var iAsString=lightIndex.toString();var needUpdate=false;this._uniformBuffer.bindToEffect(effect,"Light"+iAsString);if(this._renderId!==scene2.getRenderId()||this._lastUseSpecular!==useSpecular||!this._uniformBuffer.useUbo){this._renderId=scene2.getRenderId();this._lastUseSpecular=useSpecular;var scaledIntensity=this.getScaledIntensity();this.transferToEffect(effect,iAsString);this.diffuse.scaleToRef(scaledIntensity,TmpColors.Color3[0]);this._uniformBuffer.updateColor4("vLightDiffuse",TmpColors.Color3[0],this.range,iAsString);if(useSpecular){this.specular.scaleToRef(scaledIntensity,TmpColors.Color3[1]);this._uniformBuffer.updateColor4("vLightSpecular",TmpColors.Color3[1],this.radius,iAsString);}needUpdate=true;}this.transferTexturesToEffect(effect,iAsString);if(scene2.shadowsEnabled&&this.shadowEnabled&&receiveShadows){var shadowGenerator=(_a=this.getShadowGenerator(scene2.activeCamera))!==null&&_a!==void 0?_a:this.getShadowGenerator();if(shadowGenerator){shadowGenerator.bindShadowLight(iAsString,effect);needUpdate=true;}}if(needUpdate){this._uniformBuffer.update();}else{this._uniformBuffer.bindUniformBuffer();}}},{key:"getClassName",value:function getClassName(){return"Light";}},{key:"toString",value:function toString(fullDetails){var ret="Name: "+this.name;ret+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()];if(this.animations){for(var i=0;i<this.animations.length;i++){ret+=", animation[0]: "+this.animations[i].toString(fullDetails);}}return ret;}},{key:"_syncParentEnabledState",value:function _syncParentEnabledState(){_get(_getPrototypeOf(Light.prototype),"_syncParentEnabledState",this).call(this);if(!this.isDisposed()){this._resyncMeshes();}}},{key:"setEnabled",value:function setEnabled(value){_get(_getPrototypeOf(Light.prototype),"setEnabled",this).call(this,value);this._resyncMeshes();}},{key:"getShadowGenerator",value:function getShadowGenerator(){var camera=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var _a;if(this._shadowGenerators===null){return null;}return(_a=this._shadowGenerators.get(camera))!==null&&_a!==void 0?_a:null;}},{key:"getShadowGenerators",value:function getShadowGenerators(){return this._shadowGenerators;}},{key:"getAbsolutePosition",value:function getAbsolutePosition(){return Vector3.Zero();}},{key:"canAffectMesh",value:function canAffectMesh(mesh){if(!mesh){return true;}if(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(mesh)===-1){return false;}if(this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(mesh)!==-1){return false;}if(this.includeOnlyWithLayerMask!==0&&(this.includeOnlyWithLayerMask&mesh.layerMask)===0){return false;}if(this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&mesh.layerMask){return false;}return true;}},{key:"dispose",value:function dispose(doNotRecurse){var disposeMaterialAndTextures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._shadowGenerators){var iterator=this._shadowGenerators.values();for(var key=iterator.next();key.done!==true;key=iterator.next()){var shadowGenerator=key.value;shadowGenerator.dispose();}this._shadowGenerators=null;}this.getScene().stopAnimation(this);if(this._parentContainer){var index=this._parentContainer.lights.indexOf(this);if(index>-1){this._parentContainer.lights.splice(index,1);}this._parentContainer=null;}var _iterator128=_createForOfIteratorHelper(this.getScene().meshes),_step138;try{for(_iterator128.s();!(_step138=_iterator128.n()).done;){var mesh=_step138.value;mesh._removeLightSource(this,true);}}catch(err){_iterator128.e(err);}finally{_iterator128.f();}this._uniformBuffer.dispose();this.getScene().removeLight(this);_get(_getPrototypeOf(Light.prototype),"dispose",this).call(this,doNotRecurse,disposeMaterialAndTextures);}},{key:"getTypeID",value:function getTypeID(){return 0;}},{key:"getScaledIntensity",value:function getScaledIntensity(){return this._photometricScale*this.intensity;}},{key:"clone",value:function clone(name135){var newParent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var constructor=Light.GetConstructorFromName(this.getTypeID(),name135,this.getScene());if(!constructor){return null;}var clonedLight=SerializationHelper.Clone(constructor,this);if(name135){clonedLight.name=name135;}if(newParent){clonedLight.parent=newParent;}clonedLight.setEnabled(this.isEnabled());this.onClonedObservable.notifyObservers(clonedLight);return clonedLight;}},{key:"serialize",value:function serialize(){var serializationObject=SerializationHelper.Serialize(this);serializationObject.uniqueId=this.uniqueId;serializationObject.type=this.getTypeID();if(this.parent){this.parent._serializeAsParent(serializationObject);}if(this.excludedMeshes.length>0){serializationObject.excludedMeshesIds=[];this.excludedMeshes.forEach(function(mesh){serializationObject.excludedMeshesIds.push(mesh.id);});}if(this.includedOnlyMeshes.length>0){serializationObject.includedOnlyMeshesIds=[];this.includedOnlyMeshes.forEach(function(mesh){serializationObject.includedOnlyMeshesIds.push(mesh.id);});}SerializationHelper.AppendSerializedAnimations(this,serializationObject);serializationObject.ranges=this.serializeAnimationRanges();serializationObject.isEnabled=this.isEnabled();return serializationObject;}},{key:"_hookArrayForExcluded",value:function _hookArrayForExcluded(array){var _this92=this;var oldPush=array.push;array.push=function(){for(var _len12=arguments.length,items=new Array(_len12),_key11=0;_key11<_len12;_key11++){items[_key11]=arguments[_key11];}var result=oldPush.apply(array,items);for(var _i21=0,_items=items;_i21<_items.length;_i21++){var item=_items[_i21];item._resyncLightSource(_this92);}return result;};var oldSplice=array.splice;array.splice=function(index,deleteCount){var deleted=oldSplice.apply(array,[index,deleteCount]);var _iterator129=_createForOfIteratorHelper(deleted),_step139;try{for(_iterator129.s();!(_step139=_iterator129.n()).done;){var item=_step139.value;item._resyncLightSource(_this92);}}catch(err){_iterator129.e(err);}finally{_iterator129.f();}return deleted;};var _iterator130=_createForOfIteratorHelper(array),_step140;try{for(_iterator130.s();!(_step140=_iterator130.n()).done;){var item=_step140.value;item._resyncLightSource(this);}}catch(err){_iterator130.e(err);}finally{_iterator130.f();}}},{key:"_hookArrayForIncludedOnly",value:function _hookArrayForIncludedOnly(array){var _this93=this;var oldPush=array.push;array.push=function(){for(var _len13=arguments.length,items=new Array(_len13),_key12=0;_key12<_len13;_key12++){items[_key12]=arguments[_key12];}var result=oldPush.apply(array,items);_this93._resyncMeshes();return result;};var oldSplice=array.splice;array.splice=function(index,deleteCount){var deleted=oldSplice.apply(array,[index,deleteCount]);_this93._resyncMeshes();return deleted;};this._resyncMeshes();}},{key:"_resyncMeshes",value:function _resyncMeshes(){var _iterator131=_createForOfIteratorHelper(this.getScene().meshes),_step141;try{for(_iterator131.s();!(_step141=_iterator131.n()).done;){var mesh=_step141.value;mesh._resyncLightSource(this);}}catch(err){_iterator131.e(err);}finally{_iterator131.f();}}},{key:"_markMeshesAsLightDirty",value:function _markMeshesAsLightDirty(){var _iterator132=_createForOfIteratorHelper(this.getScene().meshes),_step142;try{for(_iterator132.s();!(_step142=_iterator132.n()).done;){var mesh=_step142.value;if(mesh.lightSources.indexOf(this)!==-1){mesh._markSubMeshesAsLightDirty();}}}catch(err){_iterator132.e(err);}finally{_iterator132.f();}}},{key:"_computePhotometricScale",value:function _computePhotometricScale(){this._photometricScale=this._getPhotometricScale();this.getScene().resetCachedMaterial();}},{key:"_getPhotometricScale",value:function _getPhotometricScale(){var photometricScale=0;var lightTypeID=this.getTypeID();var photometricMode=this.intensityMode;if(photometricMode===Light.INTENSITYMODE_AUTOMATIC){if(lightTypeID===Light.LIGHTTYPEID_DIRECTIONALLIGHT){photometricMode=Light.INTENSITYMODE_ILLUMINANCE;}else{photometricMode=Light.INTENSITYMODE_LUMINOUSINTENSITY;}}switch(lightTypeID){case Light.LIGHTTYPEID_POINTLIGHT:case Light.LIGHTTYPEID_SPOTLIGHT:switch(photometricMode){case Light.INTENSITYMODE_LUMINOUSPOWER:photometricScale=1/(4*Math.PI);break;case Light.INTENSITYMODE_LUMINOUSINTENSITY:photometricScale=1;break;case Light.INTENSITYMODE_LUMINANCE:photometricScale=this.radius*this.radius;break;}break;case Light.LIGHTTYPEID_DIRECTIONALLIGHT:switch(photometricMode){case Light.INTENSITYMODE_ILLUMINANCE:photometricScale=1;break;case Light.INTENSITYMODE_LUMINANCE:{var apexAngleRadians=this.radius;apexAngleRadians=Math.max(apexAngleRadians,1e-3);var solidAngle=2*Math.PI*(1-Math.cos(apexAngleRadians));photometricScale=solidAngle;break;}}break;case Light.LIGHTTYPEID_HEMISPHERICLIGHT:photometricScale=1;break;}return photometricScale;}},{key:"_reorderLightsInScene",value:function _reorderLightsInScene(){var scene2=this.getScene();if(this._renderPriority!=0){scene2.requireLightSorting=true;}this.getScene().sortLightsByPriority();}}],[{key:"GetConstructorFromName",value:function GetConstructorFromName(type,name135,scene2){var constructorFunc=Node.Construct("Light_Type_"+type,name135,scene2);if(constructorFunc){return constructorFunc;}return null;}},{key:"Parse",value:function Parse(parsedLight,scene2){var constructor=Light.GetConstructorFromName(parsedLight.type,parsedLight.name,scene2);if(!constructor){return null;}var light=SerializationHelper.Parse(constructor,parsedLight,scene2);if(parsedLight.excludedMeshesIds){light._excludedMeshesIds=parsedLight.excludedMeshesIds;}if(parsedLight.includedOnlyMeshesIds){light._includedOnlyMeshesIds=parsedLight.includedOnlyMeshesIds;}if(parsedLight.parentId!==void 0){light._waitingParentId=parsedLight.parentId;}if(parsedLight.parentInstanceIndex!==void 0){light._waitingParentInstanceIndex=parsedLight.parentInstanceIndex;}if(parsedLight.falloffType!==void 0){light.falloffType=parsedLight.falloffType;}if(parsedLight.lightmapMode!==void 0){light.lightmapMode=parsedLight.lightmapMode;}if(parsedLight.animations){for(var animationIndex=0;animationIndex<parsedLight.animations.length;animationIndex++){var parsedAnimation=parsedLight.animations[animationIndex];var internalClass=GetClass("BABYLON.Animation");if(internalClass){light.animations.push(internalClass.Parse(parsedAnimation));}}Node.ParseAnimationRanges(light,parsedLight,scene2);}if(parsedLight.autoAnimate){scene2.beginAnimation(light,parsedLight.autoAnimateFrom,parsedLight.autoAnimateTo,parsedLight.autoAnimateLoop,parsedLight.autoAnimateSpeed||1);}if(parsedLight.isEnabled!==void 0){light.setEnabled(parsedLight.isEnabled);}return light;}}]);return Light;}(Node);Light.FALLOFF_DEFAULT=LightConstants.FALLOFF_DEFAULT;Light.FALLOFF_PHYSICAL=LightConstants.FALLOFF_PHYSICAL;Light.FALLOFF_GLTF=LightConstants.FALLOFF_GLTF;Light.FALLOFF_STANDARD=LightConstants.FALLOFF_STANDARD;Light.LIGHTMAP_DEFAULT=LightConstants.LIGHTMAP_DEFAULT;Light.LIGHTMAP_SPECULAR=LightConstants.LIGHTMAP_SPECULAR;Light.LIGHTMAP_SHADOWSONLY=LightConstants.LIGHTMAP_SHADOWSONLY;Light.INTENSITYMODE_AUTOMATIC=LightConstants.INTENSITYMODE_AUTOMATIC;Light.INTENSITYMODE_LUMINOUSPOWER=LightConstants.INTENSITYMODE_LUMINOUSPOWER;Light.INTENSITYMODE_LUMINOUSINTENSITY=LightConstants.INTENSITYMODE_LUMINOUSINTENSITY;Light.INTENSITYMODE_ILLUMINANCE=LightConstants.INTENSITYMODE_ILLUMINANCE;Light.INTENSITYMODE_LUMINANCE=LightConstants.INTENSITYMODE_LUMINANCE;Light.LIGHTTYPEID_POINTLIGHT=LightConstants.LIGHTTYPEID_POINTLIGHT;Light.LIGHTTYPEID_DIRECTIONALLIGHT=LightConstants.LIGHTTYPEID_DIRECTIONALLIGHT;Light.LIGHTTYPEID_SPOTLIGHT=LightConstants.LIGHTTYPEID_SPOTLIGHT;Light.LIGHTTYPEID_HEMISPHERICLIGHT=LightConstants.LIGHTTYPEID_HEMISPHERICLIGHT;__decorate([serializeAsColor3()],Light.prototype,"diffuse",void 0);__decorate([serializeAsColor3()],Light.prototype,"specular",void 0);__decorate([serialize()],Light.prototype,"falloffType",void 0);__decorate([serialize()],Light.prototype,"intensity",void 0);__decorate([serialize()],Light.prototype,"range",null);__decorate([serialize()],Light.prototype,"intensityMode",null);__decorate([serialize()],Light.prototype,"radius",null);__decorate([serialize()],Light.prototype,"_renderPriority",void 0);__decorate([expandToProperty("_reorderLightsInScene")],Light.prototype,"renderPriority",void 0);__decorate([serialize("shadowEnabled")],Light.prototype,"_shadowEnabled",void 0);__decorate([serialize("excludeWithLayerMask")],Light.prototype,"_excludeWithLayerMask",void 0);__decorate([serialize("includeOnlyWithLayerMask")],Light.prototype,"_includeOnlyWithLayerMask",void 0);__decorate([serialize("lightmapMode")],Light.prototype,"_lightmapMode",void 0);// node_modules/@babylonjs/core/assetContainer.js
var KeepAssets=/*#__PURE__*/function(_AbstractScene2){_inherits(KeepAssets,_AbstractScene2);var _super28=_createSuper(KeepAssets);function KeepAssets(){_classCallCheck(this,KeepAssets);return _super28.apply(this,arguments);}return _createClass(KeepAssets);}(AbstractScene);var InstantiatedEntries=/*#__PURE__*/function(){function InstantiatedEntries(){_classCallCheck(this,InstantiatedEntries);this.rootNodes=[];this.skeletons=[];this.animationGroups=[];}_createClass(InstantiatedEntries,[{key:"dispose",value:function dispose(){this.rootNodes.slice(0).forEach(function(o){o.dispose();});this.rootNodes.length=0;this.skeletons.slice(0).forEach(function(o){o.dispose();});this.skeletons.length=0;this.animationGroups.slice(0).forEach(function(o){o.dispose();});this.animationGroups.length=0;}}]);return InstantiatedEntries;}();var AssetContainer=/*#__PURE__*/function(_AbstractScene3){_inherits(AssetContainer,_AbstractScene3);var _super29=_createSuper(AssetContainer);function AssetContainer(scene2){var _this94;_classCallCheck(this,AssetContainer);_this94=_super29.call(this);_this94._wasAddedToScene=false;scene2=scene2||EngineStore.LastCreatedScene;if(!scene2){return _possibleConstructorReturn(_this94);}_this94.scene=scene2;_this94["sounds"]=[];_this94["effectLayers"]=[];_this94["layers"]=[];_this94["lensFlareSystems"]=[];_this94["proceduralTextures"]=[];_this94["reflectionProbes"]=[];scene2.onDisposeObservable.add(function(){if(!_this94._wasAddedToScene){_this94.dispose();}});_this94._onContextRestoredObserver=scene2.getEngine().onContextRestoredObservable.add(function(){var _iterator133=_createForOfIteratorHelper(_this94.geometries),_step143;try{for(_iterator133.s();!(_step143=_iterator133.n()).done;){var geometry=_step143.value;geometry._rebuild();}}catch(err){_iterator133.e(err);}finally{_iterator133.f();}var _iterator134=_createForOfIteratorHelper(_this94.meshes),_step144;try{for(_iterator134.s();!(_step144=_iterator134.n()).done;){var mesh=_step144.value;mesh._rebuild();}}catch(err){_iterator134.e(err);}finally{_iterator134.f();}var _iterator135=_createForOfIteratorHelper(_this94.particleSystems),_step145;try{for(_iterator135.s();!(_step145=_iterator135.n()).done;){var system=_step145.value;system.rebuild();}}catch(err){_iterator135.e(err);}finally{_iterator135.f();}var _iterator136=_createForOfIteratorHelper(_this94.textures),_step146;try{for(_iterator136.s();!(_step146=_iterator136.n()).done;){var texture=_step146.value;texture._rebuild();}}catch(err){_iterator136.e(err);}finally{_iterator136.f();}});return _this94;}_createClass(AssetContainer,[{key:"_topologicalSort",value:function _topologicalSort(nodes){var nodesUidMap=/* @__PURE__ */new Map();var _iterator137=_createForOfIteratorHelper(nodes),_step147;try{for(_iterator137.s();!(_step147=_iterator137.n()).done;){var node=_step147.value;nodesUidMap.set(node.uniqueId,node);}}catch(err){_iterator137.e(err);}finally{_iterator137.f();}var dependencyGraph={dependsOn:/* @__PURE__ */new Map(),dependedBy:/* @__PURE__ */new Map()};var _iterator138=_createForOfIteratorHelper(nodes),_step148;try{for(_iterator138.s();!(_step148=_iterator138.n()).done;){var _node=_step148.value;var nodeId=_node.uniqueId;dependencyGraph.dependsOn.set(nodeId,/* @__PURE__ */new Set());dependencyGraph.dependedBy.set(nodeId,/* @__PURE__ */new Set());}}catch(err){_iterator138.e(err);}finally{_iterator138.f();}var _iterator139=_createForOfIteratorHelper(nodes),_step149;try{for(_iterator139.s();!(_step149=_iterator139.n()).done;){var _node2=_step149.value;var _nodeId=_node2.uniqueId;var dependsOn=dependencyGraph.dependsOn.get(_nodeId);if(_node2 instanceof InstancedMesh){var masterMesh=_node2.sourceMesh;if(nodesUidMap.has(masterMesh.uniqueId)){dependsOn.add(masterMesh.uniqueId);dependencyGraph.dependedBy.get(masterMesh.uniqueId).add(_nodeId);}}var dependedBy=dependencyGraph.dependedBy.get(_nodeId);var _iterator141=_createForOfIteratorHelper(_node2.getDescendants()),_step151;try{for(_iterator141.s();!(_step151=_iterator141.n()).done;){var child=_step151.value;var childId=child.uniqueId;if(nodesUidMap.has(childId)){dependedBy.add(childId);var childDependsOn=dependencyGraph.dependsOn.get(childId);childDependsOn.add(_nodeId);}}}catch(err){_iterator141.e(err);}finally{_iterator141.f();}}}catch(err){_iterator139.e(err);}finally{_iterator139.f();}var sortedNodes=[];var leaves=[];var _iterator140=_createForOfIteratorHelper(nodes),_step150;try{for(_iterator140.s();!(_step150=_iterator140.n()).done;){var _node3=_step150.value;var _nodeId2=_node3.uniqueId;if(dependencyGraph.dependsOn.get(_nodeId2).size===0){leaves.push(_node3);nodesUidMap["delete"](_nodeId2);}}}catch(err){_iterator140.e(err);}finally{_iterator140.f();}var visitList=leaves;while(visitList.length>0){var nodeToVisit=visitList.shift();sortedNodes.push(nodeToVisit);var dependedByVisitedNode=dependencyGraph.dependedBy.get(nodeToVisit.uniqueId);for(var _i22=0,_Array$from=Array.from(dependedByVisitedNode.values());_i22<_Array$from.length;_i22++){var dependedByVisitedNodeId=_Array$from[_i22];var dependsOnDependedByVisitedNode=dependencyGraph.dependsOn.get(dependedByVisitedNodeId);dependsOnDependedByVisitedNode["delete"](nodeToVisit.uniqueId);if(dependsOnDependedByVisitedNode.size===0&&nodesUidMap.get(dependedByVisitedNodeId)){visitList.push(nodesUidMap.get(dependedByVisitedNodeId));nodesUidMap["delete"](dependedByVisitedNodeId);}}}if(nodesUidMap.size>0){console.error("SceneSerializer._topologicalSort: There were unvisited nodes:");nodesUidMap.forEach(function(node){return console.error(node.name);});}return sortedNodes;}},{key:"_addNodeAndDescendantsToList",value:function _addNodeAndDescendantsToList(list,addedIds,rootNode,predicate){if(predicate&&!predicate(rootNode)||addedIds.has(rootNode.uniqueId)){return;}list.push(rootNode);addedIds.add(rootNode.uniqueId);var _iterator142=_createForOfIteratorHelper(rootNode.getDescendants(true)),_step152;try{for(_iterator142.s();!(_step152=_iterator142.n()).done;){var child=_step152.value;this._addNodeAndDescendantsToList(list,addedIds,child,predicate);}}catch(err){_iterator142.e(err);}finally{_iterator142.f();}}},{key:"_isNodeInContainer",value:function _isNodeInContainer(node){if(node instanceof Mesh&&this.meshes.indexOf(node)!==-1){return true;}if(node instanceof TransformNode&&this.transformNodes.indexOf(node)!==-1){return true;}if(node instanceof Light&&this.lights.indexOf(node)!==-1){return true;}if(node instanceof Camera&&this.cameras.indexOf(node)!==-1){return true;}return false;}},{key:"_isValidHierarchy",value:function _isValidHierarchy(){var _iterator143=_createForOfIteratorHelper(this.meshes),_step153;try{for(_iterator143.s();!(_step153=_iterator143.n()).done;){var node=_step153.value;if(node.parent&&!this._isNodeInContainer(node.parent)){Logger.Warn("Node ".concat(node.name," has a parent that is not in the container."));return false;}}}catch(err){_iterator143.e(err);}finally{_iterator143.f();}var _iterator144=_createForOfIteratorHelper(this.transformNodes),_step154;try{for(_iterator144.s();!(_step154=_iterator144.n()).done;){var _node4=_step154.value;if(_node4.parent&&!this._isNodeInContainer(_node4.parent)){Logger.Warn("Node ".concat(_node4.name," has a parent that is not in the container."));return false;}}}catch(err){_iterator144.e(err);}finally{_iterator144.f();}var _iterator145=_createForOfIteratorHelper(this.lights),_step155;try{for(_iterator145.s();!(_step155=_iterator145.n()).done;){var _node5=_step155.value;if(_node5.parent&&!this._isNodeInContainer(_node5.parent)){Logger.Warn("Node ".concat(_node5.name," has a parent that is not in the container."));return false;}}}catch(err){_iterator145.e(err);}finally{_iterator145.f();}var _iterator146=_createForOfIteratorHelper(this.cameras),_step156;try{for(_iterator146.s();!(_step156=_iterator146.n()).done;){var _node6=_step156.value;if(_node6.parent&&!this._isNodeInContainer(_node6.parent)){Logger.Warn("Node ".concat(_node6.name," has a parent that is not in the container."));return false;}}}catch(err){_iterator146.e(err);}finally{_iterator146.f();}return true;}},{key:"instantiateModelsToScene",value:function instantiateModelsToScene(nameFunction){var _this95=this;var cloneMaterials=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var options=arguments.length>2?arguments[2]:undefined;if(!this._isValidHierarchy()){Tools.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");}var conversionMap={};var storeMap={};var result=new InstantiatedEntries();var alreadySwappedSkeletons=[];var alreadySwappedMaterials=[];var localOptions=_objectSpread({doNotInstantiate:true},options);if(!localOptions.doNotInstantiate){localOptions.doNotInstantiate=function(node){return!!node.skeleton;};}var onClone=function onClone(source,clone){conversionMap[source.uniqueId]=clone.uniqueId;storeMap[clone.uniqueId]=clone;if(nameFunction){clone.name=nameFunction(source.name);}if(clone instanceof Mesh){var clonedMesh=clone;if(clonedMesh.morphTargetManager){var oldMorphTargetManager=source.morphTargetManager;clonedMesh.morphTargetManager=oldMorphTargetManager.clone();for(var index=0;index<oldMorphTargetManager.numTargets;index++){var oldTarget=oldMorphTargetManager.getTarget(index);var newTarget=clonedMesh.morphTargetManager.getTarget(index);conversionMap[oldTarget.uniqueId]=newTarget.uniqueId;storeMap[newTarget.uniqueId]=newTarget;}}}};var nodesToSort=[];var idsOnSortList=/* @__PURE__ */new Set();var _iterator147=_createForOfIteratorHelper(this.transformNodes),_step157;try{for(_iterator147.s();!(_step157=_iterator147.n()).done;){var transformNode=_step157.value;if(transformNode.parent===null){this._addNodeAndDescendantsToList(nodesToSort,idsOnSortList,transformNode,localOptions.predicate);}}}catch(err){_iterator147.e(err);}finally{_iterator147.f();}var _iterator148=_createForOfIteratorHelper(this.meshes),_step158;try{for(_iterator148.s();!(_step158=_iterator148.n()).done;){var mesh=_step158.value;if(mesh.parent===null){this._addNodeAndDescendantsToList(nodesToSort,idsOnSortList,mesh,localOptions.predicate);}}}catch(err){_iterator148.e(err);}finally{_iterator148.f();}var sortedNodes=this._topologicalSort(nodesToSort);var onNewCreated=function onNewCreated(source,clone){onClone(source,clone);if(source.parent){var replicatedParentId=conversionMap[source.parent.uniqueId];var replicatedParent=storeMap[replicatedParentId];if(replicatedParent){clone.parent=replicatedParent;}else{clone.parent=source.parent;}}clone.position.copyFrom(source.position);clone.rotation.copyFrom(source.rotation);clone.scaling.copyFrom(source.scaling);if(clone.material){var mesh=clone;if(mesh.material){if(cloneMaterials){var sourceMaterial=source.material;if(alreadySwappedMaterials.indexOf(sourceMaterial)===-1){var swap=sourceMaterial.clone(nameFunction?nameFunction(sourceMaterial.name):"Clone of "+sourceMaterial.name);alreadySwappedMaterials.push(sourceMaterial);conversionMap[sourceMaterial.uniqueId]=swap.uniqueId;storeMap[swap.uniqueId]=swap;if(sourceMaterial.getClassName()==="MultiMaterial"){var multi=sourceMaterial;var _iterator149=_createForOfIteratorHelper(multi.subMaterials),_step159;try{for(_iterator149.s();!(_step159=_iterator149.n()).done;){var material=_step159.value;if(!material){continue;}swap=material.clone(nameFunction?nameFunction(material.name):"Clone of "+material.name);alreadySwappedMaterials.push(material);conversionMap[material.uniqueId]=swap.uniqueId;storeMap[swap.uniqueId]=swap;}}catch(err){_iterator149.e(err);}finally{_iterator149.f();}multi.subMaterials=multi.subMaterials.map(function(m){return m&&storeMap[conversionMap[m.uniqueId]];});}}if(mesh.getClassName()!=="InstancedMesh"){mesh.material=storeMap[conversionMap[sourceMaterial.uniqueId]];}}else{if(mesh.material.getClassName()==="MultiMaterial"){if(_this95.scene.multiMaterials.indexOf(mesh.material)===-1){_this95.scene.addMultiMaterial(mesh.material);}}else{if(_this95.scene.materials.indexOf(mesh.material)===-1){_this95.scene.addMaterial(mesh.material);}}}}}if(clone.parent===null){result.rootNodes.push(clone);}};sortedNodes.forEach(function(node){if(node.getClassName()==="InstancedMesh"){var instancedNode=node;var sourceMesh=instancedNode.sourceMesh;var replicatedSourceId=conversionMap[sourceMesh.uniqueId];var replicatedSource=typeof replicatedSourceId==="number"?storeMap[replicatedSourceId]:sourceMesh;var replicatedInstancedNode=replicatedSource.createInstance(instancedNode.name);onNewCreated(instancedNode,replicatedInstancedNode);}else{var canInstance=!(localOptions===null||localOptions===void 0?void 0:localOptions.doNotInstantiate)&&node.getTotalVertices()>0;var replicatedNode=canInstance?node.createInstance("instance of ".concat(node.name)):node.clone("Clone of ".concat(node.name),null,true);if(!replicatedNode){throw new Error("Could not clone or instantiate node on Asset Container ".concat(node.name));}onNewCreated(node,replicatedNode);}});this.skeletons.forEach(function(s){if(localOptions.predicate&&!localOptions.predicate(s)){return;}var clone=s.clone(nameFunction?nameFunction(s.name):"Clone of "+s.name);var _iterator150=_createForOfIteratorHelper(_this95.meshes),_step160;try{for(_iterator150.s();!(_step160=_iterator150.n()).done;){var m=_step160.value;if(m.skeleton===s&&!m.isAnInstance){var copy=storeMap[conversionMap[m.uniqueId]];if(copy.isAnInstance){continue;}copy.skeleton=clone;if(alreadySwappedSkeletons.indexOf(clone)!==-1){continue;}alreadySwappedSkeletons.push(clone);var _iterator151=_createForOfIteratorHelper(clone.bones),_step161;try{for(_iterator151.s();!(_step161=_iterator151.n()).done;){var bone=_step161.value;if(bone._linkedTransformNode){bone._linkedTransformNode=storeMap[conversionMap[bone._linkedTransformNode.uniqueId]];}}}catch(err){_iterator151.e(err);}finally{_iterator151.f();}}}}catch(err){_iterator150.e(err);}finally{_iterator150.f();}result.skeletons.push(clone);});this.animationGroups.forEach(function(o){if(localOptions.predicate&&!localOptions.predicate(o)){return;}var clone=o.clone(nameFunction?nameFunction(o.name):"Clone of "+o.name,function(oldTarget){var newTarget=storeMap[conversionMap[oldTarget.uniqueId]];return newTarget||oldTarget;});result.animationGroups.push(clone);});return result;}},{key:"addAllToScene",value:function addAllToScene(){if(this._wasAddedToScene){return;}if(!this._isValidHierarchy()){Tools.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid.");}this._wasAddedToScene=true;this.addToScene(null);if(this.environmentTexture){this.scene.environmentTexture=this.environmentTexture;}var _iterator152=_createForOfIteratorHelper(this.scene._serializableComponents),_step162;try{for(_iterator152.s();!(_step162=_iterator152.n()).done;){var component=_step162.value;component.addFromContainer(this);}}catch(err){_iterator152.e(err);}finally{_iterator152.f();}this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver);this._onContextRestoredObserver=null;}},{key:"addToScene",value:function addToScene(){var _this96=this;var predicate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.cameras.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addCamera(o);});this.lights.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addLight(o);});this.meshes.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addMesh(o);});this.skeletons.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addSkeleton(o);});this.animations.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addAnimation(o);});this.animationGroups.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addAnimationGroup(o);});this.multiMaterials.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addMultiMaterial(o);});this.materials.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addMaterial(o);});this.morphTargetManagers.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addMorphTargetManager(o);});this.geometries.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addGeometry(o);});this.transformNodes.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addTransformNode(o);});this.actionManagers.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addActionManager(o);});this.textures.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addTexture(o);});this.reflectionProbes.forEach(function(o){if(predicate&&!predicate(o)){return;}_this96.scene.addReflectionProbe(o);});}},{key:"removeAllFromScene",value:function removeAllFromScene(){if(!this._isValidHierarchy()){Tools.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid.");}this._wasAddedToScene=false;this.removeFromScene(null);if(this.environmentTexture===this.scene.environmentTexture){this.scene.environmentTexture=null;}var _iterator153=_createForOfIteratorHelper(this.scene._serializableComponents),_step163;try{for(_iterator153.s();!(_step163=_iterator153.n()).done;){var component=_step163.value;component.removeFromContainer(this);}}catch(err){_iterator153.e(err);}finally{_iterator153.f();}}},{key:"removeFromScene",value:function removeFromScene(){var _this97=this;var predicate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;this.cameras.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeCamera(o);});this.lights.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeLight(o);});this.meshes.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeMesh(o);});this.skeletons.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeSkeleton(o);});this.animations.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeAnimation(o);});this.animationGroups.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeAnimationGroup(o);});this.multiMaterials.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeMultiMaterial(o);});this.materials.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeMaterial(o);});this.morphTargetManagers.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeMorphTargetManager(o);});this.geometries.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeGeometry(o);});this.transformNodes.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeTransformNode(o);});this.actionManagers.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeActionManager(o);});this.textures.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeTexture(o);});this.reflectionProbes.forEach(function(o){if(predicate&&!predicate(o)){return;}_this97.scene.removeReflectionProbe(o);});}},{key:"dispose",value:function dispose(){this.cameras.slice(0).forEach(function(o){o.dispose();});this.cameras.length=0;this.lights.slice(0).forEach(function(o){o.dispose();});this.lights.length=0;this.meshes.slice(0).forEach(function(o){o.dispose();});this.meshes.length=0;this.skeletons.slice(0).forEach(function(o){o.dispose();});this.skeletons.length=0;this.animationGroups.slice(0).forEach(function(o){o.dispose();});this.animationGroups.length=0;this.multiMaterials.slice(0).forEach(function(o){o.dispose();});this.multiMaterials.length=0;this.materials.slice(0).forEach(function(o){o.dispose();});this.materials.length=0;this.geometries.slice(0).forEach(function(o){o.dispose();});this.geometries.length=0;this.transformNodes.slice(0).forEach(function(o){o.dispose();});this.transformNodes.length=0;this.actionManagers.slice(0).forEach(function(o){o.dispose();});this.actionManagers.length=0;this.textures.slice(0).forEach(function(o){o.dispose();});this.textures.length=0;this.reflectionProbes.slice(0).forEach(function(o){o.dispose();});this.reflectionProbes.length=0;if(this.environmentTexture){this.environmentTexture.dispose();this.environmentTexture=null;}var _iterator154=_createForOfIteratorHelper(this.scene._serializableComponents),_step164;try{for(_iterator154.s();!(_step164=_iterator154.n()).done;){var component=_step164.value;component.removeFromContainer(this,true);}}catch(err){_iterator154.e(err);}finally{_iterator154.f();}if(this._onContextRestoredObserver){this.scene.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver);this._onContextRestoredObserver=null;}}},{key:"_moveAssets",value:function _moveAssets(sourceAssets,targetAssets,keepAssets){if(!sourceAssets||!targetAssets){return;}var _iterator155=_createForOfIteratorHelper(sourceAssets),_step165;try{for(_iterator155.s();!(_step165=_iterator155.n()).done;){var asset=_step165.value;var move=true;if(keepAssets){var _iterator156=_createForOfIteratorHelper(keepAssets),_step166;try{for(_iterator156.s();!(_step166=_iterator156.n()).done;){var keepAsset=_step166.value;if(asset===keepAsset){move=false;break;}}}catch(err){_iterator156.e(err);}finally{_iterator156.f();}}if(move){targetAssets.push(asset);asset._parentContainer=this;}}}catch(err){_iterator155.e(err);}finally{_iterator155.f();}}},{key:"moveAllFromScene",value:function moveAllFromScene(keepAssets){this._wasAddedToScene=false;if(keepAssets===void 0){keepAssets=new KeepAssets();}for(var key in this){if(Object.prototype.hasOwnProperty.call(this,key)){this[key]=this[key]||(key==="_environmentTexture"?null:[]);this._moveAssets(this.scene[key],this[key],keepAssets[key]);}}this.environmentTexture=this.scene.environmentTexture;this.removeAllFromScene();}},{key:"createRootMesh",value:function createRootMesh(){var rootMesh=new Mesh("assetContainerRootMesh",this.scene);this.meshes.forEach(function(m){if(!m.parent){rootMesh.addChild(m);}});this.meshes.unshift(rootMesh);return rootMesh;}},{key:"mergeAnimationsTo",value:function mergeAnimationsTo(){var scene2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:EngineStore.LastCreatedScene;var animatables=arguments.length>1?arguments[1]:undefined;var targetConverter=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(!scene2){Logger.Error("No scene available to merge animations to");return[];}var _targetConverter=targetConverter?targetConverter:function(target){var node=null;var targetProperty=target.animations.length?target.animations[0].targetProperty:"";var name135=target.name.split(".").join("").split("_primitive")[0];switch(targetProperty){case"position":case"rotationQuaternion":node=scene2.getTransformNodeByName(target.name)||scene2.getTransformNodeByName(name135);break;case"influence":node=scene2.getMorphTargetByName(target.name)||scene2.getMorphTargetByName(name135);break;default:node=scene2.getNodeByName(target.name)||scene2.getNodeByName(name135);}return node;};var nodesInAC=this.getNodes();nodesInAC.forEach(function(nodeInAC){var nodeInScene=_targetConverter(nodeInAC);if(nodeInScene!==null){var _iterator157=_createForOfIteratorHelper(nodeInAC.animations),_step167;try{var _loop4=function _loop4(){var animationInAC=_step167.value;var animationsWithSameProperty=nodeInScene.animations.filter(function(animationInScene){return animationInScene.targetProperty===animationInAC.targetProperty;});var _iterator158=_createForOfIteratorHelper(animationsWithSameProperty),_step168;try{for(_iterator158.s();!(_step168=_iterator158.n()).done;){var animationWithSameProperty=_step168.value;var index=nodeInScene.animations.indexOf(animationWithSameProperty,0);if(index>-1){nodeInScene.animations.splice(index,1);}}}catch(err){_iterator158.e(err);}finally{_iterator158.f();}};for(_iterator157.s();!(_step167=_iterator157.n()).done;){_loop4();}}catch(err){_iterator157.e(err);}finally{_iterator157.f();}nodeInScene.animations=nodeInScene.animations.concat(nodeInAC.animations);}});var newAnimationGroups=new Array();this.animationGroups.slice().forEach(function(animationGroupInAC){newAnimationGroups.push(animationGroupInAC.clone(animationGroupInAC.name,_targetConverter));animationGroupInAC.animatables.forEach(function(animatable){animatable.stop();});});animatables.forEach(function(animatable){var target=_targetConverter(animatable.target);if(target){scene2.beginAnimation(target,animatable.fromFrame,animatable.toFrame,animatable.loopAnimation,animatable.speedRatio,animatable.onAnimationEnd?animatable.onAnimationEnd:void 0,void 0,true,void 0,animatable.onAnimationLoop?animatable.onAnimationLoop:void 0);scene2.stopAnimation(animatable.target);}});return newAnimationGroups;}}]);return AssetContainer;}(AbstractScene);// node_modules/@babylonjs/core/Misc/dataReader.js
var DataReader=/*#__PURE__*/function(){function DataReader(buffer){_classCallCheck(this,DataReader);this.byteOffset=0;this.buffer=buffer;}_createClass(DataReader,[{key:"loadAsync",value:function loadAsync(byteLength){var _this98=this;return this.buffer.readAsync(this.byteOffset,byteLength).then(function(data){_this98._dataView=new DataView(data.buffer,data.byteOffset,data.byteLength);_this98._dataByteOffset=0;});}},{key:"readUint32",value:function readUint32(){var value=this._dataView.getUint32(this._dataByteOffset,true);this._dataByteOffset+=4;this.byteOffset+=4;return value;}},{key:"readUint8Array",value:function readUint8Array(byteLength){var value=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,byteLength);this._dataByteOffset+=byteLength;this.byteOffset+=byteLength;return value;}},{key:"readString",value:function readString(byteLength){return Decode(this.readUint8Array(byteLength));}},{key:"skipBytes",value:function skipBytes(byteLength){this._dataByteOffset+=byteLength;this.byteOffset+=byteLength;}}]);return DataReader;}();// node_modules/@babylonjs/loaders/glTF/glTFValidation.js
function validateAsync(data,rootUrl,fileName,getExternalResource){var options={externalResourceFunction:function externalResourceFunction(uri){return getExternalResource(uri).then(function(value){return new Uint8Array(value);});}};if(fileName){options.uri=rootUrl==="file:"?fileName:rootUrl+fileName;}return data instanceof ArrayBuffer?GLTFValidator.validateBytes(new Uint8Array(data),options):GLTFValidator.validateString(data,options);}function workerFunc(){var pendingExternalResources=[];onmessage=function onmessage(message){var data=message.data;switch(data.id){case"init":{importScripts(data.url);break;}case"validate":{validateAsync(data.data,data.rootUrl,data.fileName,function(uri){return new Promise(function(resolve,reject){var index=pendingExternalResources.length;pendingExternalResources.push({resolve:resolve,reject:reject});postMessage({id:"getExternalResource",index:index,uri:uri});});}).then(function(value){postMessage({id:"validate.resolve",value:value});},function(reason){postMessage({id:"validate.reject",reason:reason});});break;}case"getExternalResource.resolve":{pendingExternalResources[data.index].resolve(data.value);break;}case"getExternalResource.reject":{pendingExternalResources[data.index].reject(data.reason);break;}}};}var GLTFValidation=/*#__PURE__*/function(){function GLTFValidation(){_classCallCheck(this,GLTFValidation);}_createClass(GLTFValidation,null,[{key:"ValidateAsync",value:function ValidateAsync(data,rootUrl,fileName,getExternalResource){var _this99=this;if(typeof Worker==="function"){return new Promise(function(resolve,reject){var workerContent="".concat(validateAsync,"(").concat(workerFunc,")()");var workerBlobUrl=URL.createObjectURL(new Blob([workerContent],{type:"application/javascript"}));var worker2=new Worker(workerBlobUrl);var onError=function onError(error){worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);reject(error);};var onMessage=function onMessage(message){var data2=message.data;switch(data2.id){case"getExternalResource":{getExternalResource(data2.uri).then(function(value){worker2.postMessage({id:"getExternalResource.resolve",index:data2.index,value:value},[value]);},function(reason){worker2.postMessage({id:"getExternalResource.reject",index:data2.index,reason:reason});});break;}case"validate.resolve":{worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);resolve(data2.value);worker2.terminate();break;}case"validate.reject":{worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);reject(data2.reason);worker2.terminate();}}};worker2.addEventListener("error",onError);worker2.addEventListener("message",onMessage);worker2.postMessage({id:"init",url:_this99.Configuration.url});worker2.postMessage({id:"validate",data:data,rootUrl:rootUrl,fileName:fileName});});}else{if(!this._LoadScriptPromise){this._LoadScriptPromise=Tools.LoadScriptAsync(this.Configuration.url);}return this._LoadScriptPromise.then(function(){return validateAsync(data,rootUrl,fileName,getExternalResource);});}}}]);return GLTFValidation;}();GLTFValidation.Configuration={url:"https://preview.babylonjs.com/gltf_validator.js"};// node_modules/@babylonjs/loaders/glTF/glTFFileLoader.js
function _readAsync(arrayBuffer,byteOffset,byteLength){try{return Promise.resolve(new Uint8Array(arrayBuffer,byteOffset,byteLength));}catch(e){return Promise.reject(e);}}var GLTFLoaderCoordinateSystemMode;(function(GLTFLoaderCoordinateSystemMode2){GLTFLoaderCoordinateSystemMode2[GLTFLoaderCoordinateSystemMode2["AUTO"]=0]="AUTO";GLTFLoaderCoordinateSystemMode2[GLTFLoaderCoordinateSystemMode2["FORCE_RIGHT_HANDED"]=1]="FORCE_RIGHT_HANDED";})(GLTFLoaderCoordinateSystemMode||(GLTFLoaderCoordinateSystemMode={}));var GLTFLoaderAnimationStartMode;(function(GLTFLoaderAnimationStartMode2){GLTFLoaderAnimationStartMode2[GLTFLoaderAnimationStartMode2["NONE"]=0]="NONE";GLTFLoaderAnimationStartMode2[GLTFLoaderAnimationStartMode2["FIRST"]=1]="FIRST";GLTFLoaderAnimationStartMode2[GLTFLoaderAnimationStartMode2["ALL"]=2]="ALL";})(GLTFLoaderAnimationStartMode||(GLTFLoaderAnimationStartMode={}));var GLTFLoaderState;(function(GLTFLoaderState2){GLTFLoaderState2[GLTFLoaderState2["LOADING"]=0]="LOADING";GLTFLoaderState2[GLTFLoaderState2["READY"]=1]="READY";GLTFLoaderState2[GLTFLoaderState2["COMPLETE"]=2]="COMPLETE";})(GLTFLoaderState||(GLTFLoaderState={}));var GLTFFileLoader=/*#__PURE__*/function(){function GLTFFileLoader(){_classCallCheck(this,GLTFFileLoader);this.onParsedObservable=new Observable();this.coordinateSystemMode=GLTFLoaderCoordinateSystemMode.AUTO;this.animationStartMode=GLTFLoaderAnimationStartMode.FIRST;this.compileMaterials=false;this.useClipPlane=false;this.compileShadowGenerators=false;this.transparencyAsCoverage=false;this.useRangeRequests=false;this.createInstances=true;this.alwaysComputeBoundingBox=false;this.loadAllMaterials=false;this.loadOnlyMaterials=false;this.skipMaterials=false;this.useSRGBBuffers=true;this.targetFps=60;this.alwaysComputeSkeletonRootNode=false;this.preprocessUrlAsync=function(url){return Promise.resolve(url);};this.onMeshLoadedObservable=new Observable();this.onSkinLoadedObservable=new Observable();this.onTextureLoadedObservable=new Observable();this.onMaterialLoadedObservable=new Observable();this.onCameraLoadedObservable=new Observable();this.onCompleteObservable=new Observable();this.onErrorObservable=new Observable();this.onDisposeObservable=new Observable();this.onExtensionLoadedObservable=new Observable();this.validate=false;this.onValidatedObservable=new Observable();this._loader=null;this._state=null;this._requests=new Array();this.name="gltf";this.extensions={".gltf":{isBinary:false},".glb":{isBinary:true}};this.onLoaderStateChangedObservable=new Observable();this._logIndentLevel=0;this._loggingEnabled=false;this._log=this._logDisabled;this._capturePerformanceCounters=false;this._startPerformanceCounter=this._startPerformanceCounterDisabled;this._endPerformanceCounter=this._endPerformanceCounterDisabled;}_createClass(GLTFFileLoader,[{key:"onParsed",set:function set(callback){if(this._onParsedObserver){this.onParsedObservable.remove(this._onParsedObserver);}this._onParsedObserver=this.onParsedObservable.add(callback);}},{key:"onMeshLoaded",set:function set(callback){if(this._onMeshLoadedObserver){this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver);}this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(callback);}},{key:"onTextureLoaded",set:function set(callback){if(this._onTextureLoadedObserver){this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver);}this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(callback);}},{key:"onMaterialLoaded",set:function set(callback){if(this._onMaterialLoadedObserver){this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver);}this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(callback);}},{key:"onCameraLoaded",set:function set(callback){if(this._onCameraLoadedObserver){this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver);}this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(callback);}},{key:"onComplete",set:function set(callback){if(this._onCompleteObserver){this.onCompleteObservable.remove(this._onCompleteObserver);}this._onCompleteObserver=this.onCompleteObservable.add(callback);}},{key:"onError",set:function set(callback){if(this._onErrorObserver){this.onErrorObservable.remove(this._onErrorObserver);}this._onErrorObserver=this.onErrorObservable.add(callback);}},{key:"onDispose",set:function set(callback){if(this._onDisposeObserver){this.onDisposeObservable.remove(this._onDisposeObserver);}this._onDisposeObserver=this.onDisposeObservable.add(callback);}},{key:"onExtensionLoaded",set:function set(callback){if(this._onExtensionLoadedObserver){this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver);}this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(callback);}},{key:"loggingEnabled",get:function get(){return this._loggingEnabled;},set:function set(value){if(this._loggingEnabled===value){return;}this._loggingEnabled=value;if(this._loggingEnabled){this._log=this._logEnabled;}else{this._log=this._logDisabled;}}},{key:"capturePerformanceCounters",get:function get(){return this._capturePerformanceCounters;},set:function set(value){if(this._capturePerformanceCounters===value){return;}this._capturePerformanceCounters=value;if(this._capturePerformanceCounters){this._startPerformanceCounter=this._startPerformanceCounterEnabled;this._endPerformanceCounter=this._endPerformanceCounterEnabled;}else{this._startPerformanceCounter=this._startPerformanceCounterDisabled;this._endPerformanceCounter=this._endPerformanceCounterDisabled;}}},{key:"onValidated",set:function set(callback){if(this._onValidatedObserver){this.onValidatedObservable.remove(this._onValidatedObserver);}this._onValidatedObserver=this.onValidatedObservable.add(callback);}},{key:"dispose",value:function dispose(){if(this._loader){this._loader.dispose();this._loader=null;}var _iterator159=_createForOfIteratorHelper(this._requests),_step169;try{for(_iterator159.s();!(_step169=_iterator159.n()).done;){var request=_step169.value;request.abort();}}catch(err){_iterator159.e(err);}finally{_iterator159.f();}this._requests.length=0;delete this._progressCallback;this.preprocessUrlAsync=function(url){return Promise.resolve(url);};this.onMeshLoadedObservable.clear();this.onSkinLoadedObservable.clear();this.onTextureLoadedObservable.clear();this.onMaterialLoadedObservable.clear();this.onCameraLoadedObservable.clear();this.onCompleteObservable.clear();this.onExtensionLoadedObservable.clear();this.onDisposeObservable.notifyObservers(void 0);this.onDisposeObservable.clear();}},{key:"loadFile",value:function loadFile(scene2,fileOrUrl,onSuccess,onProgress,useArrayBuffer,onError){var _this100=this;this._progressCallback=onProgress;var rootUrl=fileOrUrl.name?"file:":Tools.GetFolderPath(fileOrUrl);var fileName=fileOrUrl.name||Tools.GetFilename(fileOrUrl);if(useArrayBuffer){if(this.useRangeRequests){if(this.validate){Logger.Warn("glTF validation is not supported when range requests are enabled");}var fileRequest={abort:function abort(){},onCompleteObservable:new Observable()};var dataBuffer={readAsync:function readAsync(byteOffset,byteLength){return new Promise(function(resolve,reject){_this100._loadFile(scene2,fileOrUrl,function(data){resolve(new Uint8Array(data));},true,function(error){reject(error);},function(webRequest){webRequest.setRequestHeader("Range","bytes=".concat(byteOffset,"-").concat(byteOffset+byteLength-1));});});},byteLength:0};this._unpackBinaryAsync(new DataReader(dataBuffer)).then(function(loaderData){fileRequest.onCompleteObservable.notifyObservers(fileRequest);onSuccess(loaderData);},onError?function(error){return onError(void 0,error);}:void 0);return fileRequest;}return this._loadFile(scene2,fileOrUrl,function(data){_this100._validate(scene2,data,rootUrl,fileName);_this100._unpackBinaryAsync(new DataReader({readAsync:function readAsync(byteOffset,byteLength){return _readAsync(data,byteOffset,byteLength);},byteLength:data.byteLength})).then(function(loaderData){onSuccess(loaderData);},onError?function(error){return onError(void 0,error);}:void 0);},true,onError);}return this._loadFile(scene2,fileOrUrl,function(data){_this100._validate(scene2,data,rootUrl,fileName);onSuccess({json:_this100._parseJson(data)});},useArrayBuffer,onError);}},{key:"importMeshAsync",value:function importMeshAsync(meshesNames,scene2,data,rootUrl,onProgress,fileName){var _this101=this;return Promise.resolve().then(function(){_this101.onParsedObservable.notifyObservers(data);_this101.onParsedObservable.clear();_this101._log("Loading ".concat(fileName||""));_this101._loader=_this101._getLoader(data);return _this101._loader.importMeshAsync(meshesNames,scene2,null,data,rootUrl,onProgress,fileName);});}},{key:"loadAsync",value:function loadAsync(scene2,data,rootUrl,onProgress,fileName){var _this102=this;return Promise.resolve().then(function(){_this102.onParsedObservable.notifyObservers(data);_this102.onParsedObservable.clear();_this102._log("Loading ".concat(fileName||""));_this102._loader=_this102._getLoader(data);return _this102._loader.loadAsync(scene2,data,rootUrl,onProgress,fileName);});}},{key:"loadAssetContainerAsync",value:function loadAssetContainerAsync(scene2,data,rootUrl,onProgress,fileName){var _this103=this;return Promise.resolve().then(function(){_this103.onParsedObservable.notifyObservers(data);_this103.onParsedObservable.clear();_this103._log("Loading ".concat(fileName||""));_this103._loader=_this103._getLoader(data);var container=new AssetContainer(scene2);var materials=[];_this103.onMaterialLoadedObservable.add(function(material){materials.push(material);});var textures=[];_this103.onTextureLoadedObservable.add(function(texture){textures.push(texture);});var cameras=[];_this103.onCameraLoadedObservable.add(function(camera){cameras.push(camera);});return _this103._loader.importMeshAsync(null,scene2,container,data,rootUrl,onProgress,fileName).then(function(result){Array.prototype.push.apply(container.geometries,result.geometries);Array.prototype.push.apply(container.meshes,result.meshes);Array.prototype.push.apply(container.particleSystems,result.particleSystems);Array.prototype.push.apply(container.skeletons,result.skeletons);Array.prototype.push.apply(container.animationGroups,result.animationGroups);Array.prototype.push.apply(container.materials,materials);Array.prototype.push.apply(container.textures,textures);Array.prototype.push.apply(container.lights,result.lights);Array.prototype.push.apply(container.transformNodes,result.transformNodes);Array.prototype.push.apply(container.cameras,cameras);return container;});});}},{key:"canDirectLoad",value:function canDirectLoad(data){return data.indexOf("asset")!==-1&&data.indexOf("version")!==-1||data.startsWith("data:base64,"+GLTFFileLoader._MagicBase64Encoded)||data.startsWith("data:;base64,"+GLTFFileLoader._MagicBase64Encoded)||data.startsWith("data:application/octet-stream;base64,"+GLTFFileLoader._MagicBase64Encoded)||data.startsWith("data:model/gltf-binary;base64,"+GLTFFileLoader._MagicBase64Encoded);}},{key:"directLoad",value:function directLoad(scene2,data){if(data.startsWith("base64,"+GLTFFileLoader._MagicBase64Encoded)||data.startsWith(";base64,"+GLTFFileLoader._MagicBase64Encoded)||data.startsWith("application/octet-stream;base64,"+GLTFFileLoader._MagicBase64Encoded)||data.startsWith("model/gltf-binary;base64,"+GLTFFileLoader._MagicBase64Encoded)){var arrayBuffer=DecodeBase64UrlToBinary(data);this._validate(scene2,arrayBuffer);return this._unpackBinaryAsync(new DataReader({readAsync:function readAsync(byteOffset,byteLength){return _readAsync(arrayBuffer,byteOffset,byteLength);},byteLength:arrayBuffer.byteLength}));}this._validate(scene2,data);return Promise.resolve({json:this._parseJson(data)});}},{key:"createPlugin",value:function createPlugin(){return new GLTFFileLoader();}},{key:"loaderState",get:function get(){return this._state;}},{key:"whenCompleteAsync",value:function whenCompleteAsync(){var _this104=this;return new Promise(function(resolve,reject){_this104.onCompleteObservable.addOnce(function(){resolve();});_this104.onErrorObservable.addOnce(function(reason){reject(reason);});});}},{key:"_setState",value:function _setState(state){if(this._state===state){return;}this._state=state;this.onLoaderStateChangedObservable.notifyObservers(this._state);this._log(GLTFLoaderState[this._state]);}},{key:"_loadFile",value:function _loadFile(scene2,fileOrUrl,onSuccess,useArrayBuffer,onError,onOpened){var _this105=this;var request=scene2._loadFile(fileOrUrl,onSuccess,function(event){_this105._onProgress(event,request);},true,useArrayBuffer,onError,onOpened);request.onCompleteObservable.add(function(request2){_this105._requests.splice(_this105._requests.indexOf(request2),1);});this._requests.push(request);return request;}},{key:"_onProgress",value:function _onProgress(event,request){if(!this._progressCallback){return;}request._lengthComputable=event.lengthComputable;request._loaded=event.loaded;request._total=event.total;var lengthComputable=true;var loaded=0;var total=0;var _iterator160=_createForOfIteratorHelper(this._requests),_step170;try{for(_iterator160.s();!(_step170=_iterator160.n()).done;){var request2=_step170.value;if(request2._lengthComputable===void 0||request2._loaded===void 0||request2._total===void 0){return;}lengthComputable=lengthComputable&&request2._lengthComputable;loaded+=request2._loaded;total+=request2._total;}}catch(err){_iterator160.e(err);}finally{_iterator160.f();}this._progressCallback({lengthComputable:lengthComputable,loaded:loaded,total:lengthComputable?total:0});}},{key:"_validate",value:function _validate(scene2,data){var _this106=this;var rootUrl=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var fileName=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";if(!this.validate){return;}this._startPerformanceCounter("Validate JSON");GLTFValidation.ValidateAsync(data,rootUrl,fileName,function(uri){return _this106.preprocessUrlAsync(rootUrl+uri).then(function(url){return scene2._loadFileAsync(url,void 0,true,true);});}).then(function(result){_this106._endPerformanceCounter("Validate JSON");_this106.onValidatedObservable.notifyObservers(result);_this106.onValidatedObservable.clear();},function(reason){_this106._endPerformanceCounter("Validate JSON");Tools.Warn("Failed to validate: ".concat(reason.message));_this106.onValidatedObservable.clear();});}},{key:"_getLoader",value:function _getLoader(loaderData){var asset=loaderData.json.asset||{};this._log("Asset version: ".concat(asset.version));asset.minVersion&&this._log("Asset minimum version: ".concat(asset.minVersion));asset.generator&&this._log("Asset generator: ".concat(asset.generator));var version=GLTFFileLoader._parseVersion(asset.version);if(!version){throw new Error("Invalid version: "+asset.version);}if(asset.minVersion!==void 0){var minVersion=GLTFFileLoader._parseVersion(asset.minVersion);if(!minVersion){throw new Error("Invalid minimum version: "+asset.minVersion);}if(GLTFFileLoader._compareVersion(minVersion,{major:2,minor:0})>0){throw new Error("Incompatible minimum version: "+asset.minVersion);}}var createLoaders={1:GLTFFileLoader._CreateGLTF1Loader,2:GLTFFileLoader._CreateGLTF2Loader};var createLoader=createLoaders[version.major];if(!createLoader){throw new Error("Unsupported version: "+asset.version);}return createLoader(this);}},{key:"_parseJson",value:function _parseJson(json){this._startPerformanceCounter("Parse JSON");this._log("JSON length: ".concat(json.length));var parsed=JSON.parse(json);this._endPerformanceCounter("Parse JSON");return parsed;}},{key:"_unpackBinaryAsync",value:function _unpackBinaryAsync(dataReader){var _this107=this;this._startPerformanceCounter("Unpack Binary");return dataReader.loadAsync(20).then(function(){var Binary={Magic:1179937895};var magic=dataReader.readUint32();if(magic!==Binary.Magic){throw new RuntimeError("Unexpected magic: "+magic,ErrorCodes.GLTFLoaderUnexpectedMagicError);}var version=dataReader.readUint32();if(_this107.loggingEnabled){_this107._log("Binary version: ".concat(version));}var length=dataReader.readUint32();if(!_this107.useRangeRequests&&length!==dataReader.buffer.byteLength){Logger.Warn("Length in header does not match actual data length: ".concat(length," != ").concat(dataReader.buffer.byteLength));}var unpacked;switch(version){case 1:{unpacked=_this107._unpackBinaryV1Async(dataReader,length);break;}case 2:{unpacked=_this107._unpackBinaryV2Async(dataReader,length);break;}default:{throw new Error("Unsupported version: "+version);}}_this107._endPerformanceCounter("Unpack Binary");return unpacked;});}},{key:"_unpackBinaryV1Async",value:function _unpackBinaryV1Async(dataReader,length){var ContentFormat={JSON:0};var contentLength=dataReader.readUint32();var contentFormat=dataReader.readUint32();if(contentFormat!==ContentFormat.JSON){throw new Error("Unexpected content format: ".concat(contentFormat));}var bodyLength=length-dataReader.byteOffset;var data={json:this._parseJson(dataReader.readString(contentLength)),bin:null};if(bodyLength!==0){var startByteOffset=dataReader.byteOffset;data.bin={readAsync:function readAsync(byteOffset,byteLength){return dataReader.buffer.readAsync(startByteOffset+byteOffset,byteLength);},byteLength:bodyLength};}return Promise.resolve(data);}},{key:"_unpackBinaryV2Async",value:function _unpackBinaryV2Async(dataReader,length){var _this108=this;var ChunkFormat={JSON:1313821514,BIN:5130562};var chunkLength=dataReader.readUint32();var chunkFormat=dataReader.readUint32();if(chunkFormat!==ChunkFormat.JSON){throw new Error("First chunk format is not JSON");}if(dataReader.byteOffset+chunkLength===length){return dataReader.loadAsync(chunkLength).then(function(){return{json:_this108._parseJson(dataReader.readString(chunkLength)),bin:null};});}return dataReader.loadAsync(chunkLength+8).then(function(){var data={json:_this108._parseJson(dataReader.readString(chunkLength)),bin:null};var readAsync2=function readAsync2(){var chunkLength2=dataReader.readUint32();var chunkFormat2=dataReader.readUint32();switch(chunkFormat2){case ChunkFormat.JSON:{throw new Error("Unexpected JSON chunk");}case ChunkFormat.BIN:{var startByteOffset=dataReader.byteOffset;data.bin={readAsync:function readAsync(byteOffset,byteLength){return dataReader.buffer.readAsync(startByteOffset+byteOffset,byteLength);},byteLength:chunkLength2};dataReader.skipBytes(chunkLength2);break;}default:{dataReader.skipBytes(chunkLength2);break;}}if(dataReader.byteOffset!==length){return dataReader.loadAsync(8).then(readAsync2);}return Promise.resolve(data);};return readAsync2();});}},{key:"_logOpen",value:function _logOpen(message){this._log(message);this._logIndentLevel++;}},{key:"_logClose",value:function _logClose(){--this._logIndentLevel;}},{key:"_logEnabled",value:function _logEnabled(message){var spaces=GLTFFileLoader._logSpaces.substr(0,this._logIndentLevel*2);Logger.Log("".concat(spaces).concat(message));}},{key:"_logDisabled",value:function _logDisabled(message){}},{key:"_startPerformanceCounterEnabled",value:function _startPerformanceCounterEnabled(counterName){Tools.StartPerformanceCounter(counterName);}},{key:"_startPerformanceCounterDisabled",value:function _startPerformanceCounterDisabled(counterName){}},{key:"_endPerformanceCounterEnabled",value:function _endPerformanceCounterEnabled(counterName){Tools.EndPerformanceCounter(counterName);}},{key:"_endPerformanceCounterDisabled",value:function _endPerformanceCounterDisabled(counterName){}}],[{key:"_parseVersion",value:function _parseVersion(version){if(version==="1.0"||version==="1.0.1"){return{major:1,minor:0};}var match=(version+"").match(/^(\d+)\.(\d+)/);if(!match){return null;}return{major:parseInt(match[1]),minor:parseInt(match[2])};}},{key:"_compareVersion",value:function _compareVersion(a,b){if(a.major>b.major){return 1;}if(a.major<b.major){return-1;}if(a.minor>b.minor){return 1;}if(a.minor<b.minor){return-1;}return 0;}}]);return GLTFFileLoader;}();GLTFFileLoader.IncrementalLoading=true;GLTFFileLoader.HomogeneousCoordinates=false;GLTFFileLoader._MagicBase64Encoded="Z2xURg";GLTFFileLoader._logSpaces="                                ";if(SceneLoader){SceneLoader.RegisterPlugin(new GLTFFileLoader());}// node_modules/@babylonjs/loaders/glTF/1.0/glTFLoaderInterfaces.js
var EComponentType;(function(EComponentType2){EComponentType2[EComponentType2["BYTE"]=5120]="BYTE";EComponentType2[EComponentType2["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE";EComponentType2[EComponentType2["SHORT"]=5122]="SHORT";EComponentType2[EComponentType2["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT";EComponentType2[EComponentType2["FLOAT"]=5126]="FLOAT";})(EComponentType||(EComponentType={}));var EShaderType;(function(EShaderType2){EShaderType2[EShaderType2["FRAGMENT"]=35632]="FRAGMENT";EShaderType2[EShaderType2["VERTEX"]=35633]="VERTEX";})(EShaderType||(EShaderType={}));var EParameterType;(function(EParameterType2){EParameterType2[EParameterType2["BYTE"]=5120]="BYTE";EParameterType2[EParameterType2["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE";EParameterType2[EParameterType2["SHORT"]=5122]="SHORT";EParameterType2[EParameterType2["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT";EParameterType2[EParameterType2["INT"]=5124]="INT";EParameterType2[EParameterType2["UNSIGNED_INT"]=5125]="UNSIGNED_INT";EParameterType2[EParameterType2["FLOAT"]=5126]="FLOAT";EParameterType2[EParameterType2["FLOAT_VEC2"]=35664]="FLOAT_VEC2";EParameterType2[EParameterType2["FLOAT_VEC3"]=35665]="FLOAT_VEC3";EParameterType2[EParameterType2["FLOAT_VEC4"]=35666]="FLOAT_VEC4";EParameterType2[EParameterType2["INT_VEC2"]=35667]="INT_VEC2";EParameterType2[EParameterType2["INT_VEC3"]=35668]="INT_VEC3";EParameterType2[EParameterType2["INT_VEC4"]=35669]="INT_VEC4";EParameterType2[EParameterType2["BOOL"]=35670]="BOOL";EParameterType2[EParameterType2["BOOL_VEC2"]=35671]="BOOL_VEC2";EParameterType2[EParameterType2["BOOL_VEC3"]=35672]="BOOL_VEC3";EParameterType2[EParameterType2["BOOL_VEC4"]=35673]="BOOL_VEC4";EParameterType2[EParameterType2["FLOAT_MAT2"]=35674]="FLOAT_MAT2";EParameterType2[EParameterType2["FLOAT_MAT3"]=35675]="FLOAT_MAT3";EParameterType2[EParameterType2["FLOAT_MAT4"]=35676]="FLOAT_MAT4";EParameterType2[EParameterType2["SAMPLER_2D"]=35678]="SAMPLER_2D";})(EParameterType||(EParameterType={}));var ETextureWrapMode;(function(ETextureWrapMode2){ETextureWrapMode2[ETextureWrapMode2["CLAMP_TO_EDGE"]=33071]="CLAMP_TO_EDGE";ETextureWrapMode2[ETextureWrapMode2["MIRRORED_REPEAT"]=33648]="MIRRORED_REPEAT";ETextureWrapMode2[ETextureWrapMode2["REPEAT"]=10497]="REPEAT";})(ETextureWrapMode||(ETextureWrapMode={}));var ETextureFilterType;(function(ETextureFilterType2){ETextureFilterType2[ETextureFilterType2["NEAREST"]=9728]="NEAREST";ETextureFilterType2[ETextureFilterType2["LINEAR"]=9728]="LINEAR";ETextureFilterType2[ETextureFilterType2["NEAREST_MIPMAP_NEAREST"]=9984]="NEAREST_MIPMAP_NEAREST";ETextureFilterType2[ETextureFilterType2["LINEAR_MIPMAP_NEAREST"]=9985]="LINEAR_MIPMAP_NEAREST";ETextureFilterType2[ETextureFilterType2["NEAREST_MIPMAP_LINEAR"]=9986]="NEAREST_MIPMAP_LINEAR";ETextureFilterType2[ETextureFilterType2["LINEAR_MIPMAP_LINEAR"]=9987]="LINEAR_MIPMAP_LINEAR";})(ETextureFilterType||(ETextureFilterType={}));var ETextureFormat;(function(ETextureFormat2){ETextureFormat2[ETextureFormat2["ALPHA"]=6406]="ALPHA";ETextureFormat2[ETextureFormat2["RGB"]=6407]="RGB";ETextureFormat2[ETextureFormat2["RGBA"]=6408]="RGBA";ETextureFormat2[ETextureFormat2["LUMINANCE"]=6409]="LUMINANCE";ETextureFormat2[ETextureFormat2["LUMINANCE_ALPHA"]=6410]="LUMINANCE_ALPHA";})(ETextureFormat||(ETextureFormat={}));var ECullingType;(function(ECullingType2){ECullingType2[ECullingType2["FRONT"]=1028]="FRONT";ECullingType2[ECullingType2["BACK"]=1029]="BACK";ECullingType2[ECullingType2["FRONT_AND_BACK"]=1032]="FRONT_AND_BACK";})(ECullingType||(ECullingType={}));var EBlendingFunction;(function(EBlendingFunction2){EBlendingFunction2[EBlendingFunction2["ZERO"]=0]="ZERO";EBlendingFunction2[EBlendingFunction2["ONE"]=1]="ONE";EBlendingFunction2[EBlendingFunction2["SRC_COLOR"]=768]="SRC_COLOR";EBlendingFunction2[EBlendingFunction2["ONE_MINUS_SRC_COLOR"]=769]="ONE_MINUS_SRC_COLOR";EBlendingFunction2[EBlendingFunction2["DST_COLOR"]=774]="DST_COLOR";EBlendingFunction2[EBlendingFunction2["ONE_MINUS_DST_COLOR"]=775]="ONE_MINUS_DST_COLOR";EBlendingFunction2[EBlendingFunction2["SRC_ALPHA"]=770]="SRC_ALPHA";EBlendingFunction2[EBlendingFunction2["ONE_MINUS_SRC_ALPHA"]=771]="ONE_MINUS_SRC_ALPHA";EBlendingFunction2[EBlendingFunction2["DST_ALPHA"]=772]="DST_ALPHA";EBlendingFunction2[EBlendingFunction2["ONE_MINUS_DST_ALPHA"]=773]="ONE_MINUS_DST_ALPHA";EBlendingFunction2[EBlendingFunction2["CONSTANT_COLOR"]=32769]="CONSTANT_COLOR";EBlendingFunction2[EBlendingFunction2["ONE_MINUS_CONSTANT_COLOR"]=32770]="ONE_MINUS_CONSTANT_COLOR";EBlendingFunction2[EBlendingFunction2["CONSTANT_ALPHA"]=32771]="CONSTANT_ALPHA";EBlendingFunction2[EBlendingFunction2["ONE_MINUS_CONSTANT_ALPHA"]=32772]="ONE_MINUS_CONSTANT_ALPHA";EBlendingFunction2[EBlendingFunction2["SRC_ALPHA_SATURATE"]=776]="SRC_ALPHA_SATURATE";})(EBlendingFunction||(EBlendingFunction={}));// node_modules/@babylonjs/core/Cameras/targetCamera.js
var TargetCamera=/*#__PURE__*/function(_Camera){_inherits(TargetCamera,_Camera);var _super30=_createSuper(TargetCamera);function TargetCamera(name135,position,scene2){var _this109;var setActiveOnSceneIfNoneActive=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;_classCallCheck(this,TargetCamera);_this109=_super30.call(this,name135,position,scene2,setActiveOnSceneIfNoneActive);_this109._tmpUpVector=Vector3.Zero();_this109._tmpTargetVector=Vector3.Zero();_this109.cameraDirection=new Vector3(0,0,0);_this109.cameraRotation=new Vector2(0,0);_this109.ignoreParentScaling=false;_this109.updateUpVectorFromRotation=false;_this109._tmpQuaternion=new Quaternion();_this109.rotation=new Vector3(0,0,0);_this109.speed=2;_this109.noRotationConstraint=false;_this109.invertRotation=false;_this109.inverseRotationSpeed=0.2;_this109.lockedTarget=null;_this109._currentTarget=Vector3.Zero();_this109._initialFocalDistance=1;_this109._viewMatrix=Matrix.Zero();_this109._camMatrix=Matrix.Zero();_this109._cameraTransformMatrix=Matrix.Zero();_this109._cameraRotationMatrix=Matrix.Zero();_this109._referencePoint=new Vector3(0,0,1);_this109._transformedReferencePoint=Vector3.Zero();_this109._defaultUp=Vector3.Up();_this109._cachedRotationZ=0;_this109._cachedQuaternionRotationZ=0;return _this109;}_createClass(TargetCamera,[{key:"getFrontPosition",value:function getFrontPosition(distance){this.getWorldMatrix();var direction=this.getTarget().subtract(this.position);direction.normalize();direction.scaleInPlace(distance);return this.globalPosition.add(direction);}},{key:"_getLockedTargetPosition",value:function _getLockedTargetPosition(){if(!this.lockedTarget){return null;}if(this.lockedTarget.absolutePosition){this.lockedTarget.computeWorldMatrix();}return this.lockedTarget.absolutePosition||this.lockedTarget;}},{key:"storeState",value:function storeState(){this._storedPosition=this.position.clone();this._storedRotation=this.rotation.clone();if(this.rotationQuaternion){this._storedRotationQuaternion=this.rotationQuaternion.clone();}return _get(_getPrototypeOf(TargetCamera.prototype),"storeState",this).call(this);}},{key:"_restoreStateValues",value:function _restoreStateValues(){if(!_get(_getPrototypeOf(TargetCamera.prototype),"_restoreStateValues",this).call(this)){return false;}this.position=this._storedPosition.clone();this.rotation=this._storedRotation.clone();if(this.rotationQuaternion){this.rotationQuaternion=this._storedRotationQuaternion.clone();}this.cameraDirection.copyFromFloats(0,0,0);this.cameraRotation.copyFromFloats(0,0);return true;}},{key:"_initCache",value:function _initCache(){_get(_getPrototypeOf(TargetCamera.prototype),"_initCache",this).call(this);this._cache.lockedTarget=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotation=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cache.rotationQuaternion=new Quaternion(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);}},{key:"_updateCache",value:function _updateCache(ignoreParentClass){if(!ignoreParentClass){_get(_getPrototypeOf(TargetCamera.prototype),"_updateCache",this).call(this);}var lockedTargetPosition=this._getLockedTargetPosition();if(!lockedTargetPosition){this._cache.lockedTarget=null;}else{if(!this._cache.lockedTarget){this._cache.lockedTarget=lockedTargetPosition.clone();}else{this._cache.lockedTarget.copyFrom(lockedTargetPosition);}}this._cache.rotation.copyFrom(this.rotation);if(this.rotationQuaternion){this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion);}}},{key:"_isSynchronizedViewMatrix",value:function _isSynchronizedViewMatrix(){if(!_get(_getPrototypeOf(TargetCamera.prototype),"_isSynchronizedViewMatrix",this).call(this)){return false;}var lockedTargetPosition=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(lockedTargetPosition):!lockedTargetPosition)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation));}},{key:"_computeLocalCameraSpeed",value:function _computeLocalCameraSpeed(){var engine=this.getEngine();return this.speed*Math.sqrt(engine.getDeltaTime()/(engine.getFps()*100));}},{key:"setTarget",value:function setTarget(target){this.upVector.normalize();this._initialFocalDistance=target.subtract(this.position).length();if(this.position.z===target.z){this.position.z+=Epsilon;}this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance);Matrix.LookAtLHToRef(this.position,target,this._defaultUp,this._camMatrix);this._camMatrix.invert();this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var vDir=target.subtract(this.position);if(vDir.x>=0){this.rotation.y=-Math.atan(vDir.z/vDir.x)+Math.PI/2;}else{this.rotation.y=-Math.atan(vDir.z/vDir.x)-Math.PI/2;}this.rotation.z=0;if(isNaN(this.rotation.x)){this.rotation.x=0;}if(isNaN(this.rotation.y)){this.rotation.y=0;}if(isNaN(this.rotation.z)){this.rotation.z=0;}if(this.rotationQuaternion){Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);}}},{key:"target",get:function get(){return this.getTarget();},set:function set(value){this.setTarget(value);}},{key:"getTarget",value:function getTarget(){return this._currentTarget;}},{key:"_decideIfNeedsToMove",value:function _decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0;}},{key:"_updatePosition",value:function _updatePosition(){if(this.parent){this.parent.getWorldMatrix().invertToRef(TmpVectors.Matrix[0]);Vector3.TransformNormalToRef(this.cameraDirection,TmpVectors.Matrix[0],TmpVectors.Vector3[0]);this.position.addInPlace(TmpVectors.Vector3[0]);return;}this.position.addInPlace(this.cameraDirection);}},{key:"_checkInputs",value:function _checkInputs(){var directionMultiplier=this.invertRotation?-this.inverseRotationSpeed:1;var needToMove=this._decideIfNeedsToMove();var needToRotate=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(needToMove){this._updatePosition();}if(needToRotate){if(this.rotationQuaternion){this.rotationQuaternion.toEulerAnglesToRef(this.rotation);}this.rotation.x+=this.cameraRotation.x*directionMultiplier;this.rotation.y+=this.cameraRotation.y*directionMultiplier;if(!this.noRotationConstraint){var limit=1.570796;if(this.rotation.x>limit){this.rotation.x=limit;}if(this.rotation.x<-limit){this.rotation.x=-limit;}}if(this.rotationQuaternion){var len=this.rotation.lengthSquared();if(len){Quaternion.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion);}}}if(needToMove){if(Math.abs(this.cameraDirection.x)<this.speed*Epsilon){this.cameraDirection.x=0;}if(Math.abs(this.cameraDirection.y)<this.speed*Epsilon){this.cameraDirection.y=0;}if(Math.abs(this.cameraDirection.z)<this.speed*Epsilon){this.cameraDirection.z=0;}this.cameraDirection.scaleInPlace(this.inertia);}if(needToRotate){if(Math.abs(this.cameraRotation.x)<this.speed*Epsilon){this.cameraRotation.x=0;}if(Math.abs(this.cameraRotation.y)<this.speed*Epsilon){this.cameraRotation.y=0;}this.cameraRotation.scaleInPlace(this.inertia);}_get(_getPrototypeOf(TargetCamera.prototype),"_checkInputs",this).call(this);}},{key:"_updateCameraRotationMatrix",value:function _updateCameraRotationMatrix(){if(this.rotationQuaternion){this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix);}else{Matrix.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix);}}},{key:"_rotateUpVectorWithCameraRotationMatrix",value:function _rotateUpVectorWithCameraRotationMatrix(){Vector3.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector);return this;}},{key:"_getViewMatrix",value:function _getViewMatrix(){if(this.lockedTarget){this.setTarget(this._getLockedTargetPosition());}this._updateCameraRotationMatrix();if(this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z){this._rotateUpVectorWithCameraRotationMatrix();this._cachedQuaternionRotationZ=this.rotationQuaternion.z;}else if(this._cachedRotationZ!==this.rotation.z){this._rotateUpVectorWithCameraRotationMatrix();this._cachedRotationZ=this.rotation.z;}Vector3.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint);this.position.addToRef(this._transformedReferencePoint,this._currentTarget);if(this.updateUpVectorFromRotation){if(this.rotationQuaternion){Axis.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector);}else{Quaternion.FromEulerVectorToRef(this.rotation,this._tmpQuaternion);Axis.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector);}}this._computeViewMatrix(this.position,this._currentTarget,this.upVector);return this._viewMatrix;}},{key:"_computeViewMatrix",value:function _computeViewMatrix(position,target,up){if(this.ignoreParentScaling){if(this.parent){var parentWorldMatrix=this.parent.getWorldMatrix();Vector3.TransformCoordinatesToRef(position,parentWorldMatrix,this._globalPosition);Vector3.TransformCoordinatesToRef(target,parentWorldMatrix,this._tmpTargetVector);Vector3.TransformNormalToRef(up,parentWorldMatrix,this._tmpUpVector);this._markSyncedWithParent();}else{this._globalPosition.copyFrom(position);this._tmpTargetVector.copyFrom(target);this._tmpUpVector.copyFrom(up);}if(this.getScene().useRightHandedSystem){Matrix.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);}else{Matrix.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);}return;}if(this.getScene().useRightHandedSystem){Matrix.LookAtRHToRef(position,target,up,this._viewMatrix);}else{Matrix.LookAtLHToRef(position,target,up,this._viewMatrix);}if(this.parent){var _parentWorldMatrix=this.parent.getWorldMatrix();this._viewMatrix.invert();this._viewMatrix.multiplyToRef(_parentWorldMatrix,this._viewMatrix);this._viewMatrix.getTranslationToRef(this._globalPosition);this._viewMatrix.invert();this._markSyncedWithParent();}else{this._globalPosition.copyFrom(position);}}},{key:"createRigCamera",value:function createRigCamera(name135,cameraIndex){if(this.cameraRigMode!==Camera.RIG_MODE_NONE){var rigCamera=new TargetCamera(name135,this.position.clone(),this.getScene());rigCamera.isRigCamera=true;rigCamera.rigParent=this;if(this.cameraRigMode===Camera.RIG_MODE_VR||this.cameraRigMode===Camera.RIG_MODE_WEBVR){if(!this.rotationQuaternion){this.rotationQuaternion=new Quaternion();}rigCamera._cameraRigParams={};rigCamera.rotationQuaternion=new Quaternion();}rigCamera.mode=this.mode;rigCamera.orthoLeft=this.orthoLeft;rigCamera.orthoRight=this.orthoRight;rigCamera.orthoTop=this.orthoTop;rigCamera.orthoBottom=this.orthoBottom;return rigCamera;}return null;}},{key:"_updateRigCameras",value:function _updateRigCameras(){var camLeft=this._rigCameras[0];var camRight=this._rigCameras[1];this.computeWorldMatrix();switch(this.cameraRigMode){case Camera.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case Camera.RIG_MODE_STEREOSCOPIC_OVERUNDER:case Camera.RIG_MODE_STEREOSCOPIC_INTERLACED:{var leftSign=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1;var rightSign=this.cameraRigMode===Camera.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*leftSign,camLeft);this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*rightSign,camRight);break;}case Camera.RIG_MODE_VR:if(camLeft.rotationQuaternion){camLeft.rotationQuaternion.copyFrom(this.rotationQuaternion);camRight.rotationQuaternion.copyFrom(this.rotationQuaternion);}else{camLeft.rotation.copyFrom(this.rotation);camRight.rotation.copyFrom(this.rotation);}camLeft.position.copyFrom(this.position);camRight.position.copyFrom(this.position);break;}_get(_getPrototypeOf(TargetCamera.prototype),"_updateRigCameras",this).call(this);}},{key:"_getRigCamPositionAndTarget",value:function _getRigCamPositionAndTarget(halfSpace,rigCamera){var target=this.getTarget();target.subtractToRef(this.position,TargetCamera._TargetFocalPoint);TargetCamera._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var newFocalTarget=TargetCamera._TargetFocalPoint.addInPlace(this.position);Matrix.TranslationToRef(-newFocalTarget.x,-newFocalTarget.y,-newFocalTarget.z,TargetCamera._TargetTransformMatrix);TargetCamera._TargetTransformMatrix.multiplyToRef(Matrix.RotationAxis(rigCamera.upVector,halfSpace),TargetCamera._RigCamTransformMatrix);Matrix.TranslationToRef(newFocalTarget.x,newFocalTarget.y,newFocalTarget.z,TargetCamera._TargetTransformMatrix);TargetCamera._RigCamTransformMatrix.multiplyToRef(TargetCamera._TargetTransformMatrix,TargetCamera._RigCamTransformMatrix);Vector3.TransformCoordinatesToRef(this.position,TargetCamera._RigCamTransformMatrix,rigCamera.position);rigCamera.setTarget(newFocalTarget);}},{key:"getClassName",value:function getClassName(){return"TargetCamera";}}]);return TargetCamera;}(Camera);TargetCamera._RigCamTransformMatrix=new Matrix();TargetCamera._TargetTransformMatrix=new Matrix();TargetCamera._TargetFocalPoint=new Vector3();__decorate([serializeAsVector3()],TargetCamera.prototype,"rotation",void 0);__decorate([serialize()],TargetCamera.prototype,"speed",void 0);__decorate([serializeAsMeshReference("lockedTargetId")],TargetCamera.prototype,"lockedTarget",void 0);// node_modules/@babylonjs/core/Cameras/cameraInputsManager.js
var CameraInputTypes={};var CameraInputsManager=/*#__PURE__*/function(){function CameraInputsManager(camera){_classCallCheck(this,CameraInputsManager);this.attachedToElement=false;this.attached={};this.camera=camera;this.checkInputs=function(){};}_createClass(CameraInputsManager,[{key:"add",value:function add(input){var type=input.getSimpleName();if(this.attached[type]){Logger.Warn("camera input of type "+type+" already exists on camera");return;}this.attached[type]=input;input.camera=this.camera;if(input.checkInputs){this.checkInputs=this._addCheckInputs(input.checkInputs.bind(input));}if(this.attachedToElement){input.attachControl(this.noPreventDefault);}}},{key:"remove",value:function remove(inputToRemove){for(var cam in this.attached){var input=this.attached[cam];if(input===inputToRemove){input.detachControl();input.camera=null;delete this.attached[cam];this.rebuildInputCheck();return;}}}},{key:"removeByType",value:function removeByType(inputType){for(var cam in this.attached){var input=this.attached[cam];if(input.getClassName()===inputType){input.detachControl();input.camera=null;delete this.attached[cam];this.rebuildInputCheck();}}}},{key:"_addCheckInputs",value:function _addCheckInputs(fn){var current=this.checkInputs;return function(){current();fn();};}},{key:"attachInput",value:function attachInput(input){if(this.attachedToElement){input.attachControl(this.noPreventDefault);}}},{key:"attachElement",value:function attachElement(){var noPreventDefault=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.attachedToElement){return;}noPreventDefault=Camera.ForceAttachControlToAlwaysPreventDefault?false:noPreventDefault;this.attachedToElement=true;this.noPreventDefault=noPreventDefault;for(var cam in this.attached){this.attached[cam].attachControl(noPreventDefault);}}},{key:"detachElement",value:function detachElement(){var disconnect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;for(var cam in this.attached){this.attached[cam].detachControl();if(disconnect){this.attached[cam].camera=null;}}this.attachedToElement=false;}},{key:"rebuildInputCheck",value:function rebuildInputCheck(){this.checkInputs=function(){};for(var cam in this.attached){var input=this.attached[cam];if(input.checkInputs){this.checkInputs=this._addCheckInputs(input.checkInputs.bind(input));}}}},{key:"clear",value:function clear(){if(this.attachedToElement){this.detachElement(true);}this.attached={};this.attachedToElement=false;this.checkInputs=function(){};}},{key:"serialize",value:function serialize(serializedCamera){var inputs={};for(var cam in this.attached){var input=this.attached[cam];var res=SerializationHelper.Serialize(input);inputs[input.getClassName()]=res;}serializedCamera.inputsmgr=inputs;}},{key:"parse",value:function parse(parsedCamera){var _this110=this;var parsedInputs=parsedCamera.inputsmgr;if(parsedInputs){this.clear();var _loop5=function _loop5(){var construct=CameraInputTypes[n];if(construct){var parsedinput=parsedInputs[n];var input=SerializationHelper.Parse(function(){return new construct();},parsedinput,null);_this110.add(input);}};for(var n in parsedInputs){_loop5();}}else{var _loop6=function _loop6(){var construct=CameraInputTypes[_this110.attached[_n].getClassName()];if(construct){var input=SerializationHelper.Parse(function(){return new construct();},parsedCamera,null);_this110.remove(_this110.attached[_n]);_this110.add(input);}};for(var _n in this.attached){_loop6();}}}}]);return CameraInputsManager;}();// node_modules/@babylonjs/core/Cameras/Inputs/freeCameraKeyboardMoveInput.js
var FreeCameraKeyboardMoveInput=/*#__PURE__*/function(){function FreeCameraKeyboardMoveInput(){_classCallCheck(this,FreeCameraKeyboardMoveInput);this.keysUp=[38];this.keysUpward=[33];this.keysDown=[40];this.keysDownward=[34];this.keysLeft=[37];this.keysRight=[39];this.rotationSpeed=0.5;this.keysRotateLeft=[];this.keysRotateRight=[];this._keys=new Array();}_createClass(FreeCameraKeyboardMoveInput,[{key:"attachControl",value:function attachControl(noPreventDefault){var _this111=this;noPreventDefault=Tools.BackCompatCameraNoPreventDefault(arguments);if(this._onCanvasBlurObserver){return;}this._scene=this.camera.getScene();this._engine=this._scene.getEngine();this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){_this111._keys.length=0;});this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(info){var evt=info.event;if(!evt.metaKey){if(info.type===KeyboardEventTypes.KEYDOWN){if(_this111.keysUp.indexOf(evt.keyCode)!==-1||_this111.keysDown.indexOf(evt.keyCode)!==-1||_this111.keysLeft.indexOf(evt.keyCode)!==-1||_this111.keysRight.indexOf(evt.keyCode)!==-1||_this111.keysUpward.indexOf(evt.keyCode)!==-1||_this111.keysDownward.indexOf(evt.keyCode)!==-1||_this111.keysRotateLeft.indexOf(evt.keyCode)!==-1||_this111.keysRotateRight.indexOf(evt.keyCode)!==-1){var index=_this111._keys.indexOf(evt.keyCode);if(index===-1){_this111._keys.push(evt.keyCode);}if(!noPreventDefault){evt.preventDefault();}}}else{if(_this111.keysUp.indexOf(evt.keyCode)!==-1||_this111.keysDown.indexOf(evt.keyCode)!==-1||_this111.keysLeft.indexOf(evt.keyCode)!==-1||_this111.keysRight.indexOf(evt.keyCode)!==-1||_this111.keysUpward.indexOf(evt.keyCode)!==-1||_this111.keysDownward.indexOf(evt.keyCode)!==-1||_this111.keysRotateLeft.indexOf(evt.keyCode)!==-1||_this111.keysRotateRight.indexOf(evt.keyCode)!==-1){var _index22=_this111._keys.indexOf(evt.keyCode);if(_index22>=0){_this111._keys.splice(_index22,1);}if(!noPreventDefault){evt.preventDefault();}}}}});}},{key:"detachControl",value:function detachControl(){if(this._scene){if(this._onKeyboardObserver){this._scene.onKeyboardObservable.remove(this._onKeyboardObserver);}if(this._onCanvasBlurObserver){this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver);}this._onKeyboardObserver=null;this._onCanvasBlurObserver=null;}this._keys.length=0;}},{key:"checkInputs",value:function checkInputs(){if(this._onKeyboardObserver){var camera=this.camera;for(var index=0;index<this._keys.length;index++){var keyCode=this._keys[index];var speed=camera._computeLocalCameraSpeed();if(this.keysLeft.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(-speed,0,0);}else if(this.keysUp.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(0,0,speed);}else if(this.keysRight.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(speed,0,0);}else if(this.keysDown.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(0,0,-speed);}else if(this.keysUpward.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(0,speed,0);}else if(this.keysDownward.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(0,-speed,0);}else if(this.keysRotateLeft.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(0,0,0);camera.cameraRotation.y-=this._getLocalRotation();}else if(this.keysRotateRight.indexOf(keyCode)!==-1){camera._localDirection.copyFromFloats(0,0,0);camera.cameraRotation.y+=this._getLocalRotation();}if(camera.getScene().useRightHandedSystem){camera._localDirection.z*=-1;}camera.getViewMatrix().invertToRef(camera._cameraTransformMatrix);Vector3.TransformNormalToRef(camera._localDirection,camera._cameraTransformMatrix,camera._transformedDirection);camera.cameraDirection.addInPlace(camera._transformedDirection);}}}},{key:"getClassName",value:function getClassName(){return"FreeCameraKeyboardMoveInput";}},{key:"_onLostFocus",value:function _onLostFocus(){this._keys.length=0;}},{key:"getSimpleName",value:function getSimpleName(){return"keyboard";}},{key:"_getLocalRotation",value:function _getLocalRotation(){var rotation=this.rotationSpeed*this._engine.getDeltaTime()/1e3;if(this.camera.getScene().useRightHandedSystem){rotation*=-1;}if(this.camera.parent&&this.camera.parent._getWorldMatrixDeterminant()<0){rotation*=-1;}return rotation;}}]);return FreeCameraKeyboardMoveInput;}();__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysUp",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysUpward",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysDown",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysDownward",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysLeft",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRight",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"rotationSpeed",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRotateLeft",void 0);__decorate([serialize()],FreeCameraKeyboardMoveInput.prototype,"keysRotateRight",void 0);CameraInputTypes["FreeCameraKeyboardMoveInput"]=FreeCameraKeyboardMoveInput;// node_modules/@babylonjs/core/Cameras/Inputs/freeCameraMouseInput.js
var FreeCameraMouseInput=/*#__PURE__*/function(){function FreeCameraMouseInput(){var touchEnabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_classCallCheck(this,FreeCameraMouseInput);this.touchEnabled=touchEnabled;this.buttons=[0,1,2];this.angularSensibility=2e3;this._previousPosition=null;this.onPointerMovedObservable=new Observable();this._allowCameraRotation=true;this._currentActiveButton=-1;this._activePointerId=-1;}_createClass(FreeCameraMouseInput,[{key:"attachControl",value:function attachControl(noPreventDefault){var _this112=this;noPreventDefault=Tools.BackCompatCameraNoPreventDefault(arguments);var engine=this.camera.getEngine();var element=engine.getInputElement();if(!this._pointerInput){this._pointerInput=function(p){var evt=p.event;var isTouch=evt.pointerType==="touch";if(engine.isInVRExclusivePointerMode){return;}if(!_this112.touchEnabled&&isTouch){return;}if(p.type!==PointerEventTypes.POINTERMOVE&&_this112.buttons.indexOf(evt.button)===-1){return;}var srcElement=evt.target;if(p.type===PointerEventTypes.POINTERDOWN){if(isTouch&&_this112._activePointerId!==-1||!isTouch&&_this112._currentActiveButton!==-1){return;}_this112._activePointerId=evt.pointerId;try{srcElement===null||srcElement===void 0?void 0:srcElement.setPointerCapture(evt.pointerId);}catch(e){}if(_this112._currentActiveButton===-1){_this112._currentActiveButton=evt.button;}_this112._previousPosition={x:evt.clientX,y:evt.clientY};if(!noPreventDefault){evt.preventDefault();element&&element.focus();}if(engine.isPointerLock&&_this112._onMouseMove){_this112._onMouseMove(p.event);}}else if(p.type===PointerEventTypes.POINTERUP){if(isTouch&&_this112._activePointerId!==evt.pointerId||!isTouch&&_this112._currentActiveButton!==evt.button){return;}try{srcElement===null||srcElement===void 0?void 0:srcElement.releasePointerCapture(evt.pointerId);}catch(e){}_this112._currentActiveButton=-1;_this112._previousPosition=null;if(!noPreventDefault){evt.preventDefault();}_this112._activePointerId=-1;}else if(p.type===PointerEventTypes.POINTERMOVE&&(_this112._activePointerId===evt.pointerId||!isTouch)){if(engine.isPointerLock&&_this112._onMouseMove){_this112._onMouseMove(p.event);}else if(_this112._previousPosition){var offsetX=evt.clientX-_this112._previousPosition.x;var offsetY=evt.clientY-_this112._previousPosition.y;if(_this112.camera.getScene().useRightHandedSystem){offsetX*=-1;}if(_this112.camera.parent&&_this112.camera.parent._getWorldMatrixDeterminant()<0){offsetX*=-1;}if(_this112._allowCameraRotation){_this112.camera.cameraRotation.y+=offsetX/_this112.angularSensibility;_this112.camera.cameraRotation.x+=offsetY/_this112.angularSensibility;}_this112.onPointerMovedObservable.notifyObservers({offsetX:offsetX,offsetY:offsetY});_this112._previousPosition={x:evt.clientX,y:evt.clientY};if(!noPreventDefault){evt.preventDefault();}}}};}this._onMouseMove=function(evt){if(!engine.isPointerLock){return;}if(engine.isInVRExclusivePointerMode){return;}var offsetX=evt.movementX;if(_this112.camera.getScene().useRightHandedSystem){offsetX*=-1;}if(_this112.camera.parent&&_this112.camera.parent._getWorldMatrixDeterminant()<0){offsetX*=-1;}_this112.camera.cameraRotation.y+=offsetX/_this112.angularSensibility;var offsetY=evt.movementY;_this112.camera.cameraRotation.x+=offsetY/_this112.angularSensibility;_this112._previousPosition=null;if(!noPreventDefault){evt.preventDefault();}};this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,PointerEventTypes.POINTERDOWN|PointerEventTypes.POINTERUP|PointerEventTypes.POINTERMOVE);if(element){this._contextMenuBind=this.onContextMenu.bind(this);element.addEventListener("contextmenu",this._contextMenuBind,false);}}},{key:"onContextMenu",value:function onContextMenu(evt){evt.preventDefault();}},{key:"detachControl",value:function detachControl(){if(this._observer){this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer);if(this._contextMenuBind){var engine=this.camera.getEngine();var element=engine.getInputElement();element&&element.removeEventListener("contextmenu",this._contextMenuBind);}if(this.onPointerMovedObservable){this.onPointerMovedObservable.clear();}this._observer=null;this._onMouseMove=null;this._previousPosition=null;}this._currentActiveButton=-1;}},{key:"getClassName",value:function getClassName(){return"FreeCameraMouseInput";}},{key:"getSimpleName",value:function getSimpleName(){return"mouse";}}]);return FreeCameraMouseInput;}();__decorate([serialize()],FreeCameraMouseInput.prototype,"buttons",void 0);__decorate([serialize()],FreeCameraMouseInput.prototype,"angularSensibility",void 0);CameraInputTypes["FreeCameraMouseInput"]=FreeCameraMouseInput;// node_modules/@babylonjs/core/Cameras/Inputs/BaseCameraMouseWheelInput.js
var BaseCameraMouseWheelInput=/*#__PURE__*/function(){function BaseCameraMouseWheelInput(){_classCallCheck(this,BaseCameraMouseWheelInput);this.wheelPrecisionX=3;this.wheelPrecisionY=3;this.wheelPrecisionZ=3;this.onChangedObservable=new Observable();this._wheelDeltaX=0;this._wheelDeltaY=0;this._wheelDeltaZ=0;this._ffMultiplier=12;this._normalize=120;}_createClass(BaseCameraMouseWheelInput,[{key:"attachControl",value:function attachControl(noPreventDefault){var _this113=this;noPreventDefault=Tools.BackCompatCameraNoPreventDefault(arguments);this._wheel=function(pointer){if(pointer.type!==PointerEventTypes.POINTERWHEEL){return;}var event=pointer.event;var platformScale=event.deltaMode===EventConstants.DOM_DELTA_LINE?_this113._ffMultiplier:1;_this113._wheelDeltaX+=_this113.wheelPrecisionX*platformScale*event.deltaX/_this113._normalize;_this113._wheelDeltaY-=_this113.wheelPrecisionY*platformScale*event.deltaY/_this113._normalize;_this113._wheelDeltaZ+=_this113.wheelPrecisionZ*platformScale*event.deltaZ/_this113._normalize;if(event.preventDefault){if(!noPreventDefault){event.preventDefault();}}};this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._wheel,PointerEventTypes.POINTERWHEEL);}},{key:"detachControl",value:function detachControl(){if(this._observer){this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer);this._observer=null;this._wheel=null;}if(this.onChangedObservable){this.onChangedObservable.clear();}}},{key:"checkInputs",value:function checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ});this._wheelDeltaX=0;this._wheelDeltaY=0;this._wheelDeltaZ=0;}},{key:"getClassName",value:function getClassName(){return"BaseCameraMouseWheelInput";}},{key:"getSimpleName",value:function getSimpleName(){return"mousewheel";}}]);return BaseCameraMouseWheelInput;}();__decorate([serialize()],BaseCameraMouseWheelInput.prototype,"wheelPrecisionX",void 0);__decorate([serialize()],BaseCameraMouseWheelInput.prototype,"wheelPrecisionY",void 0);__decorate([serialize()],BaseCameraMouseWheelInput.prototype,"wheelPrecisionZ",void 0);// node_modules/@babylonjs/core/Cameras/Inputs/freeCameraMouseWheelInput.js
var _CameraProperty;(function(_CameraProperty2){_CameraProperty2[_CameraProperty2["MoveRelative"]=0]="MoveRelative";_CameraProperty2[_CameraProperty2["RotateRelative"]=1]="RotateRelative";_CameraProperty2[_CameraProperty2["MoveScene"]=2]="MoveScene";})(_CameraProperty||(_CameraProperty={}));var FreeCameraMouseWheelInput=/*#__PURE__*/function(_BaseCameraMouseWheel){_inherits(FreeCameraMouseWheelInput,_BaseCameraMouseWheel);var _super31=_createSuper(FreeCameraMouseWheelInput);function FreeCameraMouseWheelInput(){var _this114;_classCallCheck(this,FreeCameraMouseWheelInput);_this114=_super31.apply(this,arguments);_this114._moveRelative=Vector3.Zero();_this114._rotateRelative=Vector3.Zero();_this114._moveScene=Vector3.Zero();_this114._wheelXAction=_CameraProperty.MoveRelative;_this114._wheelXActionCoordinate=Coordinate.X;_this114._wheelYAction=_CameraProperty.MoveRelative;_this114._wheelYActionCoordinate=Coordinate.Z;_this114._wheelZAction=null;_this114._wheelZActionCoordinate=null;return _this114;}_createClass(FreeCameraMouseWheelInput,[{key:"getClassName",value:function getClassName(){return"FreeCameraMouseWheelInput";}},{key:"wheelXMoveRelative",get:function get(){if(this._wheelXAction!==_CameraProperty.MoveRelative){return null;}return this._wheelXActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelXAction!==_CameraProperty.MoveRelative){return;}this._wheelXAction=_CameraProperty.MoveRelative;this._wheelXActionCoordinate=axis;}},{key:"wheelYMoveRelative",get:function get(){if(this._wheelYAction!==_CameraProperty.MoveRelative){return null;}return this._wheelYActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelYAction!==_CameraProperty.MoveRelative){return;}this._wheelYAction=_CameraProperty.MoveRelative;this._wheelYActionCoordinate=axis;}},{key:"wheelZMoveRelative",get:function get(){if(this._wheelZAction!==_CameraProperty.MoveRelative){return null;}return this._wheelZActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelZAction!==_CameraProperty.MoveRelative){return;}this._wheelZAction=_CameraProperty.MoveRelative;this._wheelZActionCoordinate=axis;}},{key:"wheelXRotateRelative",get:function get(){if(this._wheelXAction!==_CameraProperty.RotateRelative){return null;}return this._wheelXActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelXAction!==_CameraProperty.RotateRelative){return;}this._wheelXAction=_CameraProperty.RotateRelative;this._wheelXActionCoordinate=axis;}},{key:"wheelYRotateRelative",get:function get(){if(this._wheelYAction!==_CameraProperty.RotateRelative){return null;}return this._wheelYActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelYAction!==_CameraProperty.RotateRelative){return;}this._wheelYAction=_CameraProperty.RotateRelative;this._wheelYActionCoordinate=axis;}},{key:"wheelZRotateRelative",get:function get(){if(this._wheelZAction!==_CameraProperty.RotateRelative){return null;}return this._wheelZActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelZAction!==_CameraProperty.RotateRelative){return;}this._wheelZAction=_CameraProperty.RotateRelative;this._wheelZActionCoordinate=axis;}},{key:"wheelXMoveScene",get:function get(){if(this._wheelXAction!==_CameraProperty.MoveScene){return null;}return this._wheelXActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelXAction!==_CameraProperty.MoveScene){return;}this._wheelXAction=_CameraProperty.MoveScene;this._wheelXActionCoordinate=axis;}},{key:"wheelYMoveScene",get:function get(){if(this._wheelYAction!==_CameraProperty.MoveScene){return null;}return this._wheelYActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelYAction!==_CameraProperty.MoveScene){return;}this._wheelYAction=_CameraProperty.MoveScene;this._wheelYActionCoordinate=axis;}},{key:"wheelZMoveScene",get:function get(){if(this._wheelZAction!==_CameraProperty.MoveScene){return null;}return this._wheelZActionCoordinate;},set:function set(axis){if(axis===null&&this._wheelZAction!==_CameraProperty.MoveScene){return;}this._wheelZAction=_CameraProperty.MoveScene;this._wheelZActionCoordinate=axis;}},{key:"checkInputs",value:function checkInputs(){if(this._wheelDeltaX===0&&this._wheelDeltaY===0&&this._wheelDeltaZ==0){return;}this._moveRelative.setAll(0);this._rotateRelative.setAll(0);this._moveScene.setAll(0);this._updateCamera();if(this.camera.getScene().useRightHandedSystem){this._moveRelative.z*=-1;}var cameraTransformMatrix=Matrix.Zero();this.camera.getViewMatrix().invertToRef(cameraTransformMatrix);var transformedDirection=Vector3.Zero();Vector3.TransformNormalToRef(this._moveRelative,cameraTransformMatrix,transformedDirection);this.camera.cameraRotation.x+=this._rotateRelative.x/200;this.camera.cameraRotation.y+=this._rotateRelative.y/200;this.camera.cameraDirection.addInPlace(transformedDirection);this.camera.cameraDirection.addInPlace(this._moveScene);_get(_getPrototypeOf(FreeCameraMouseWheelInput.prototype),"checkInputs",this).call(this);}},{key:"_updateCamera",value:function _updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate);this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate);this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate);}},{key:"_updateCameraProperty",value:function _updateCameraProperty(value,cameraProperty,coordinate){if(value===0){return;}if(cameraProperty===null||coordinate===null){return;}var action=null;switch(cameraProperty){case _CameraProperty.MoveRelative:action=this._moveRelative;break;case _CameraProperty.RotateRelative:action=this._rotateRelative;break;case _CameraProperty.MoveScene:action=this._moveScene;break;}switch(coordinate){case Coordinate.X:action.set(value,0,0);break;case Coordinate.Y:action.set(0,value,0);break;case Coordinate.Z:action.set(0,0,value);break;}}}]);return FreeCameraMouseWheelInput;}(BaseCameraMouseWheelInput);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelXMoveRelative",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelYMoveRelative",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelZMoveRelative",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelXRotateRelative",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelYRotateRelative",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelZRotateRelative",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelXMoveScene",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelYMoveScene",null);__decorate([serialize()],FreeCameraMouseWheelInput.prototype,"wheelZMoveScene",null);CameraInputTypes["FreeCameraMouseWheelInput"]=FreeCameraMouseWheelInput;// node_modules/@babylonjs/core/Cameras/Inputs/freeCameraTouchInput.js
var FreeCameraTouchInput=/*#__PURE__*/function(){function FreeCameraTouchInput(){var allowMouse=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_classCallCheck(this,FreeCameraTouchInput);this.allowMouse=allowMouse;this.touchAngularSensibility=2e5;this.touchMoveSensibility=250;this.singleFingerRotate=false;this._offsetX=null;this._offsetY=null;this._pointerPressed=new Array();this._isSafari=Tools.IsSafari();}_createClass(FreeCameraTouchInput,[{key:"attachControl",value:function attachControl(noPreventDefault){var _this115=this;noPreventDefault=Tools.BackCompatCameraNoPreventDefault(arguments);var previousPosition=null;if(this._pointerInput===void 0){this._onLostFocus=function(){_this115._offsetX=null;_this115._offsetY=null;};this._pointerInput=function(p){var evt=p.event;var isMouseEvent=evt.pointerType==="mouse"||_this115._isSafari&&typeof evt.pointerType==="undefined";if(!_this115.allowMouse&&isMouseEvent){return;}if(p.type===PointerEventTypes.POINTERDOWN){if(!noPreventDefault){evt.preventDefault();}_this115._pointerPressed.push(evt.pointerId);if(_this115._pointerPressed.length!==1){return;}previousPosition={x:evt.clientX,y:evt.clientY};}else if(p.type===PointerEventTypes.POINTERUP){if(!noPreventDefault){evt.preventDefault();}var index=_this115._pointerPressed.indexOf(evt.pointerId);if(index===-1){return;}_this115._pointerPressed.splice(index,1);if(index!=0){return;}previousPosition=null;_this115._offsetX=null;_this115._offsetY=null;}else if(p.type===PointerEventTypes.POINTERMOVE){if(!noPreventDefault){evt.preventDefault();}if(!previousPosition){return;}var _index23=_this115._pointerPressed.indexOf(evt.pointerId);if(_index23!=0){return;}_this115._offsetX=evt.clientX-previousPosition.x;_this115._offsetY=-(evt.clientY-previousPosition.y);}};}this._observer=this.camera.getScene()._inputManager._addCameraPointerObserver(this._pointerInput,PointerEventTypes.POINTERDOWN|PointerEventTypes.POINTERUP|PointerEventTypes.POINTERMOVE);if(this._onLostFocus){var engine=this.camera.getEngine();var element=engine.getInputElement();element&&element.addEventListener("blur",this._onLostFocus);}}},{key:"detachControl",value:function detachControl(){if(this._pointerInput){if(this._observer){this.camera.getScene()._inputManager._removeCameraPointerObserver(this._observer);this._observer=null;}if(this._onLostFocus){var engine=this.camera.getEngine();var element=engine.getInputElement();element&&element.removeEventListener("blur",this._onLostFocus);this._onLostFocus=null;}this._pointerPressed.length=0;this._offsetX=null;this._offsetY=null;}}},{key:"checkInputs",value:function checkInputs(){if(this._offsetX===null||this._offsetY===null){return;}if(this._offsetX===0&&this._offsetY===0){return;}var camera=this.camera;camera.cameraRotation.y=this._offsetX/this.touchAngularSensibility;var rotateCamera=this.singleFingerRotate&&this._pointerPressed.length===1||!this.singleFingerRotate&&this._pointerPressed.length>1;if(rotateCamera){camera.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;}else{var speed=camera._computeLocalCameraSpeed();var direction=new Vector3(0,0,this.touchMoveSensibility!==0?speed*this._offsetY/this.touchMoveSensibility:0);Matrix.RotationYawPitchRollToRef(camera.rotation.y,camera.rotation.x,0,camera._cameraRotationMatrix);camera.cameraDirection.addInPlace(Vector3.TransformCoordinates(direction,camera._cameraRotationMatrix));}}},{key:"getClassName",value:function getClassName(){return"FreeCameraTouchInput";}},{key:"getSimpleName",value:function getSimpleName(){return"touch";}}]);return FreeCameraTouchInput;}();__decorate([serialize()],FreeCameraTouchInput.prototype,"touchAngularSensibility",void 0);__decorate([serialize()],FreeCameraTouchInput.prototype,"touchMoveSensibility",void 0);CameraInputTypes["FreeCameraTouchInput"]=FreeCameraTouchInput;// node_modules/@babylonjs/core/Cameras/freeCameraInputsManager.js
var FreeCameraInputsManager=/*#__PURE__*/function(_CameraInputsManager){_inherits(FreeCameraInputsManager,_CameraInputsManager);var _super32=_createSuper(FreeCameraInputsManager);function FreeCameraInputsManager(camera){var _this116;_classCallCheck(this,FreeCameraInputsManager);_this116=_super32.call(this,camera);_this116._mouseInput=null;_this116._mouseWheelInput=null;return _this116;}_createClass(FreeCameraInputsManager,[{key:"addKeyboard",value:function addKeyboard(){this.add(new FreeCameraKeyboardMoveInput());return this;}},{key:"addMouse",value:function addMouse(){var touchEnabled=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(!this._mouseInput){this._mouseInput=new FreeCameraMouseInput(touchEnabled);this.add(this._mouseInput);}return this;}},{key:"removeMouse",value:function removeMouse(){if(this._mouseInput){this.remove(this._mouseInput);}return this;}},{key:"addMouseWheel",value:function addMouseWheel(){if(!this._mouseWheelInput){this._mouseWheelInput=new FreeCameraMouseWheelInput();this.add(this._mouseWheelInput);}return this;}},{key:"removeMouseWheel",value:function removeMouseWheel(){if(this._mouseWheelInput){this.remove(this._mouseWheelInput);}return this;}},{key:"addTouch",value:function addTouch(){this.add(new FreeCameraTouchInput());return this;}},{key:"clear",value:function clear(){_get(_getPrototypeOf(FreeCameraInputsManager.prototype),"clear",this).call(this);this._mouseInput=null;}}]);return FreeCameraInputsManager;}(CameraInputsManager);// node_modules/@babylonjs/core/Cameras/freeCamera.js
var FreeCamera=/*#__PURE__*/function(_TargetCamera){_inherits(FreeCamera,_TargetCamera);var _super33=_createSuper(FreeCamera);function FreeCamera(name135,position,scene2){var _this117;var setActiveOnSceneIfNoneActive=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;_classCallCheck(this,FreeCamera);_this117=_super33.call(this,name135,position,scene2,setActiveOnSceneIfNoneActive);_this117.ellipsoid=new Vector3(0.5,1,0.5);_this117.ellipsoidOffset=new Vector3(0,0,0);_this117.checkCollisions=false;_this117.applyGravity=false;_this117._needMoveForGravity=false;_this117._oldPosition=Vector3.Zero();_this117._diffPosition=Vector3.Zero();_this117._newPosition=Vector3.Zero();_this117._collisionMask=-1;_this117._onCollisionPositionChange=function(collisionId,newPosition){var collidedMesh=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var updatePosition=function updatePosition(newPos){_this117._newPosition.copyFrom(newPos);_this117._newPosition.subtractToRef(_this117._oldPosition,_this117._diffPosition);if(_this117._diffPosition.length()>Engine.CollisionsEpsilon){_this117.position.addInPlace(_this117._diffPosition);if(_this117.onCollide&&collidedMesh){_this117.onCollide(collidedMesh);}}};updatePosition(newPosition);};_this117.inputs=new FreeCameraInputsManager(_assertThisInitialized(_this117));_this117.inputs.addKeyboard().addMouse();return _this117;}_createClass(FreeCamera,[{key:"angularSensibility",get:function get(){var mouse=this.inputs.attached["mouse"];if(mouse){return mouse.angularSensibility;}return 0;},set:function set(value){var mouse=this.inputs.attached["mouse"];if(mouse){mouse.angularSensibility=value;}}},{key:"keysUp",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysUp;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysUp=value;}}},{key:"keysUpward",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysUpward;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysUpward=value;}}},{key:"keysDown",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysDown;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysDown=value;}}},{key:"keysDownward",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysDownward;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysDownward=value;}}},{key:"keysLeft",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysLeft;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysLeft=value;}}},{key:"keysRight",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysRight;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysRight=value;}}},{key:"keysRotateLeft",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysRotateLeft;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysRotateLeft=value;}}},{key:"keysRotateRight",get:function get(){var keyboard=this.inputs.attached["keyboard"];if(keyboard){return keyboard.keysRotateRight;}return[];},set:function set(value){var keyboard=this.inputs.attached["keyboard"];if(keyboard){keyboard.keysRotateRight=value;}}},{key:"attachControl",value:function attachControl(ignored,noPreventDefault){noPreventDefault=Tools.BackCompatCameraNoPreventDefault(arguments);this.inputs.attachElement(noPreventDefault);}},{key:"detachControl",value:function detachControl(){this.inputs.detachElement();this.cameraDirection=new Vector3(0,0,0);this.cameraRotation=new Vector2(0,0);}},{key:"collisionMask",get:function get(){return this._collisionMask;},set:function set(mask){this._collisionMask=!isNaN(mask)?mask:-1;}},{key:"_collideWithWorld",value:function _collideWithWorld(displacement){var globalPosition;if(this.parent){globalPosition=Vector3.TransformCoordinates(this.position,this.parent.getWorldMatrix());}else{globalPosition=this.position;}globalPosition.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition);this._oldPosition.addInPlace(this.ellipsoidOffset);var coordinator=this.getScene().collisionCoordinator;if(!this._collider){this._collider=coordinator.createCollider();}this._collider._radius=this.ellipsoid;this._collider.collisionMask=this._collisionMask;var actualDisplacement=displacement;if(this.applyGravity){actualDisplacement=displacement.add(this.getScene().gravity);}coordinator.getNewPosition(this._oldPosition,actualDisplacement,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId);}},{key:"_checkInputs",value:function _checkInputs(){if(!this._localDirection){this._localDirection=Vector3.Zero();this._transformedDirection=Vector3.Zero();}this.inputs.checkInputs();_get(_getPrototypeOf(FreeCamera.prototype),"_checkInputs",this).call(this);}},{key:"_decideIfNeedsToMove",value:function _decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0;}},{key:"_updatePosition",value:function _updatePosition(){if(this.checkCollisions&&this.getScene().collisionsEnabled){this._collideWithWorld(this.cameraDirection);}else{_get(_getPrototypeOf(FreeCamera.prototype),"_updatePosition",this).call(this);}}},{key:"dispose",value:function dispose(){this.inputs.clear();_get(_getPrototypeOf(FreeCamera.prototype),"dispose",this).call(this);}},{key:"getClassName",value:function getClassName(){return"FreeCamera";}}]);return FreeCamera;}(TargetCamera);__decorate([serializeAsVector3()],FreeCamera.prototype,"ellipsoid",void 0);__decorate([serializeAsVector3()],FreeCamera.prototype,"ellipsoidOffset",void 0);__decorate([serialize()],FreeCamera.prototype,"checkCollisions",void 0);__decorate([serialize()],FreeCamera.prototype,"applyGravity",void 0);// node_modules/@babylonjs/core/Animations/animationKey.js
var AnimationKeyInterpolation;(function(AnimationKeyInterpolation2){AnimationKeyInterpolation2[AnimationKeyInterpolation2["NONE"]=0]="NONE";AnimationKeyInterpolation2[AnimationKeyInterpolation2["STEP"]=1]="STEP";})(AnimationKeyInterpolation||(AnimationKeyInterpolation={}));// node_modules/@babylonjs/core/Animations/animationRange.js
var AnimationRange=/*#__PURE__*/function(){function AnimationRange(name135,from,to){_classCallCheck(this,AnimationRange);this.name=name135;this.from=from;this.to=to;}_createClass(AnimationRange,[{key:"clone",value:function clone(){return new AnimationRange(this.name,this.from,this.to);}}]);return AnimationRange;}();// node_modules/@babylonjs/core/Maths/math.size.js
var Size=/*#__PURE__*/function(){function Size(width,height){_classCallCheck(this,Size);this.width=width;this.height=height;}_createClass(Size,[{key:"toString",value:function toString(){return"{W: ".concat(this.width,", H: ").concat(this.height,"}");}},{key:"getClassName",value:function getClassName(){return"Size";}},{key:"getHashCode",value:function getHashCode(){var hash=this.width|0;hash=hash*397^(this.height|0);return hash;}},{key:"copyFrom",value:function copyFrom(src){this.width=src.width;this.height=src.height;}},{key:"copyFromFloats",value:function copyFromFloats(width,height){this.width=width;this.height=height;return this;}},{key:"set",value:function set(width,height){return this.copyFromFloats(width,height);}},{key:"multiplyByFloats",value:function multiplyByFloats(w,h){return new Size(this.width*w,this.height*h);}},{key:"clone",value:function clone(){return new Size(this.width,this.height);}},{key:"equals",value:function equals(other){if(!other){return false;}return this.width===other.width&&this.height===other.height;}},{key:"surface",get:function get(){return this.width*this.height;}},{key:"add",value:function add(otherSize){var r=new Size(this.width+otherSize.width,this.height+otherSize.height);return r;}},{key:"subtract",value:function subtract(otherSize){var r=new Size(this.width-otherSize.width,this.height-otherSize.height);return r;}}],[{key:"Zero",value:function Zero(){return new Size(0,0);}},{key:"Lerp",value:function Lerp(start,end,amount){var w=start.width+(end.width-start.width)*amount;var h=start.height+(end.height-start.height)*amount;return new Size(w,h);}}]);return Size;}();// node_modules/@babylonjs/core/Animations/animation.js
var Animation=/*#__PURE__*/function(){function Animation(name135,targetProperty,framePerSecond,dataType,loopMode,enableBlending){_classCallCheck(this,Animation);this.name=name135;this.targetProperty=targetProperty;this.framePerSecond=framePerSecond;this.dataType=dataType;this.loopMode=loopMode;this.enableBlending=enableBlending;this._easingFunction=null;this._runtimeAnimations=new Array();this._events=new Array();this.blendingSpeed=0.01;this._ranges={};this.targetPropertyPath=targetProperty.split(".");this.dataType=dataType;this.loopMode=loopMode===void 0?Animation.ANIMATIONLOOPMODE_CYCLE:loopMode;this.uniqueId=Animation._UniqueIdGenerator++;}_createClass(Animation,[{key:"runtimeAnimations",get:function get(){return this._runtimeAnimations;}},{key:"hasRunningRuntimeAnimations",get:function get(){var _iterator161=_createForOfIteratorHelper(this._runtimeAnimations),_step171;try{for(_iterator161.s();!(_step171=_iterator161.n()).done;){var runtimeAnimation=_step171.value;if(!runtimeAnimation.isStopped()){return true;}}}catch(err){_iterator161.e(err);}finally{_iterator161.f();}return false;}},{key:"toString",value:function toString(fullDetails){var ret="Name: "+this.name+", property: "+this.targetProperty;ret+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType];ret+=", nKeys: "+(this._keys?this._keys.length:"none");ret+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none");if(fullDetails){ret+=", Ranges: {";var first=true;for(var name135 in this._ranges){if(first){ret+=", ";first=false;}ret+=name135;}ret+="}";}return ret;}},{key:"addEvent",value:function addEvent(event){this._events.push(event);this._events.sort(function(a,b){return a.frame-b.frame;});}},{key:"removeEvents",value:function removeEvents(frame){for(var index=0;index<this._events.length;index++){if(this._events[index].frame===frame){this._events.splice(index,1);index--;}}}},{key:"getEvents",value:function getEvents(){return this._events;}},{key:"createRange",value:function createRange(name135,from,to){if(!this._ranges[name135]){this._ranges[name135]=new AnimationRange(name135,from,to);}}},{key:"deleteRange",value:function deleteRange(name135){var deleteFrames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var range=this._ranges[name135];if(!range){return;}if(deleteFrames){var from=range.from;var to=range.to;for(var key=this._keys.length-1;key>=0;key--){if(this._keys[key].frame>=from&&this._keys[key].frame<=to){this._keys.splice(key,1);}}}this._ranges[name135]=null;}},{key:"getRange",value:function getRange(name135){return this._ranges[name135];}},{key:"getKeys",value:function getKeys(){return this._keys;}},{key:"getHighestFrame",value:function getHighestFrame(){var ret=0;for(var key=0,nKeys=this._keys.length;key<nKeys;key++){if(ret<this._keys[key].frame){ret=this._keys[key].frame;}}return ret;}},{key:"getEasingFunction",value:function getEasingFunction(){return this._easingFunction;}},{key:"setEasingFunction",value:function setEasingFunction(easingFunction){this._easingFunction=easingFunction;}},{key:"floatInterpolateFunction",value:function floatInterpolateFunction(startValue,endValue,gradient){return Scalar.Lerp(startValue,endValue,gradient);}},{key:"floatInterpolateFunctionWithTangents",value:function floatInterpolateFunctionWithTangents(startValue,outTangent,endValue,inTangent,gradient){return Scalar.Hermite(startValue,outTangent,endValue,inTangent,gradient);}},{key:"quaternionInterpolateFunction",value:function quaternionInterpolateFunction(startValue,endValue,gradient){return Quaternion.Slerp(startValue,endValue,gradient);}},{key:"quaternionInterpolateFunctionWithTangents",value:function quaternionInterpolateFunctionWithTangents(startValue,outTangent,endValue,inTangent,gradient){return Quaternion.Hermite(startValue,outTangent,endValue,inTangent,gradient).normalize();}},{key:"vector3InterpolateFunction",value:function vector3InterpolateFunction(startValue,endValue,gradient){return Vector3.Lerp(startValue,endValue,gradient);}},{key:"vector3InterpolateFunctionWithTangents",value:function vector3InterpolateFunctionWithTangents(startValue,outTangent,endValue,inTangent,gradient){return Vector3.Hermite(startValue,outTangent,endValue,inTangent,gradient);}},{key:"vector2InterpolateFunction",value:function vector2InterpolateFunction(startValue,endValue,gradient){return Vector2.Lerp(startValue,endValue,gradient);}},{key:"vector2InterpolateFunctionWithTangents",value:function vector2InterpolateFunctionWithTangents(startValue,outTangent,endValue,inTangent,gradient){return Vector2.Hermite(startValue,outTangent,endValue,inTangent,gradient);}},{key:"sizeInterpolateFunction",value:function sizeInterpolateFunction(startValue,endValue,gradient){return Size.Lerp(startValue,endValue,gradient);}},{key:"color3InterpolateFunction",value:function color3InterpolateFunction(startValue,endValue,gradient){return Color3.Lerp(startValue,endValue,gradient);}},{key:"color3InterpolateFunctionWithTangents",value:function color3InterpolateFunctionWithTangents(startValue,outTangent,endValue,inTangent,gradient){return Color3.Hermite(startValue,outTangent,endValue,inTangent,gradient);}},{key:"color4InterpolateFunction",value:function color4InterpolateFunction(startValue,endValue,gradient){return Color4.Lerp(startValue,endValue,gradient);}},{key:"color4InterpolateFunctionWithTangents",value:function color4InterpolateFunctionWithTangents(startValue,outTangent,endValue,inTangent,gradient){return Color4.Hermite(startValue,outTangent,endValue,inTangent,gradient);}},{key:"_getKeyValue",value:function _getKeyValue(value){if(typeof value==="function"){return value();}return value;}},{key:"evaluate",value:function evaluate(currentFrame){return this._interpolate(currentFrame,{key:0,repeatCount:0,loopMode:Animation.ANIMATIONLOOPMODE_CONSTANT});}},{key:"_interpolate",value:function _interpolate(currentFrame,state){if(state.loopMode===Animation.ANIMATIONLOOPMODE_CONSTANT&&state.repeatCount>0){return state.highLimitValue.clone?state.highLimitValue.clone():state.highLimitValue;}var keys=this._keys;var keysLength=keys.length;var key=state.key;while(key>=0&&currentFrame<keys[key].frame){--key;}while(key+1<=keysLength-1&&currentFrame>=keys[key+1].frame){++key;}state.key=key;if(key<0){return this._getKeyValue(keys[0].value);}else if(key+1>keysLength-1){return this._getKeyValue(keys[keysLength-1].value);}var startKey=keys[key];var endKey=keys[key+1];var startValue=this._getKeyValue(startKey.value);var endValue=this._getKeyValue(endKey.value);if(startKey.interpolation===AnimationKeyInterpolation.STEP){if(endKey.frame>currentFrame){return startValue;}else{return endValue;}}var useTangent=startKey.outTangent!==void 0&&endKey.inTangent!==void 0;var frameDelta=endKey.frame-startKey.frame;var gradient=(currentFrame-startKey.frame)/frameDelta;var easingFunction=this.getEasingFunction();if(easingFunction!==null){gradient=easingFunction.ease(gradient);}switch(this.dataType){case Animation.ANIMATIONTYPE_FLOAT:{var floatValue=useTangent?this.floatInterpolateFunctionWithTangents(startValue,startKey.outTangent*frameDelta,endValue,endKey.inTangent*frameDelta,gradient):this.floatInterpolateFunction(startValue,endValue,gradient);switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return floatValue;case Animation.ANIMATIONLOOPMODE_RELATIVE:return state.offsetValue*state.repeatCount+floatValue;}break;}case Animation.ANIMATIONTYPE_QUATERNION:{var quatValue=useTangent?this.quaternionInterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this.quaternionInterpolateFunction(startValue,endValue,gradient);switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return quatValue;case Animation.ANIMATIONLOOPMODE_RELATIVE:return quatValue.addInPlace(state.offsetValue.scale(state.repeatCount));}return quatValue;}case Animation.ANIMATIONTYPE_VECTOR3:{var vec3Value=useTangent?this.vector3InterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this.vector3InterpolateFunction(startValue,endValue,gradient);switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return vec3Value;case Animation.ANIMATIONLOOPMODE_RELATIVE:return vec3Value.add(state.offsetValue.scale(state.repeatCount));}break;}case Animation.ANIMATIONTYPE_VECTOR2:{var vec2Value=useTangent?this.vector2InterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this.vector2InterpolateFunction(startValue,endValue,gradient);switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return vec2Value;case Animation.ANIMATIONLOOPMODE_RELATIVE:return vec2Value.add(state.offsetValue.scale(state.repeatCount));}break;}case Animation.ANIMATIONTYPE_SIZE:{switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(startValue,endValue,gradient);case Animation.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(startValue,endValue,gradient).add(state.offsetValue.scale(state.repeatCount));}break;}case Animation.ANIMATIONTYPE_COLOR3:{var color3Value=useTangent?this.color3InterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this.color3InterpolateFunction(startValue,endValue,gradient);switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return color3Value;case Animation.ANIMATIONLOOPMODE_RELATIVE:return color3Value.add(state.offsetValue.scale(state.repeatCount));}break;}case Animation.ANIMATIONTYPE_COLOR4:{var color4Value=useTangent?this.color4InterpolateFunctionWithTangents(startValue,startKey.outTangent.scale(frameDelta),endValue,endKey.inTangent.scale(frameDelta),gradient):this.color4InterpolateFunction(startValue,endValue,gradient);switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:return color4Value;case Animation.ANIMATIONLOOPMODE_RELATIVE:return color4Value.add(state.offsetValue.scale(state.repeatCount));}break;}case Animation.ANIMATIONTYPE_MATRIX:{switch(state.loopMode){case Animation.ANIMATIONLOOPMODE_CYCLE:case Animation.ANIMATIONLOOPMODE_CONSTANT:{if(Animation.AllowMatricesInterpolation){return this.matrixInterpolateFunction(startValue,endValue,gradient,state.workValue);}return startValue;}case Animation.ANIMATIONLOOPMODE_RELATIVE:{return startValue;}}break;}}return 0;}},{key:"matrixInterpolateFunction",value:function matrixInterpolateFunction(startValue,endValue,gradient,result){if(Animation.AllowMatrixDecomposeForInterpolation){if(result){Matrix.DecomposeLerpToRef(startValue,endValue,gradient,result);return result;}return Matrix.DecomposeLerp(startValue,endValue,gradient);}if(result){Matrix.LerpToRef(startValue,endValue,gradient,result);return result;}return Matrix.Lerp(startValue,endValue,gradient);}},{key:"clone",value:function clone(){var clone=new Animation(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);clone.enableBlending=this.enableBlending;clone.blendingSpeed=this.blendingSpeed;if(this._keys){clone.setKeys(this._keys);}if(this._ranges){clone._ranges={};for(var name135 in this._ranges){var range=this._ranges[name135];if(!range){continue;}clone._ranges[name135]=range.clone();}}return clone;}},{key:"setKeys",value:function setKeys(values){this._keys=values.slice(0);}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.name=this.name;serializationObject.property=this.targetProperty;serializationObject.framePerSecond=this.framePerSecond;serializationObject.dataType=this.dataType;serializationObject.loopBehavior=this.loopMode;serializationObject.enableBlending=this.enableBlending;serializationObject.blendingSpeed=this.blendingSpeed;var dataType=this.dataType;serializationObject.keys=[];var keys=this.getKeys();for(var index=0;index<keys.length;index++){var animationKey=keys[index];var key={};key.frame=animationKey.frame;switch(dataType){case Animation.ANIMATIONTYPE_FLOAT:key.values=[animationKey.value];if(animationKey.inTangent!==void 0){key.values.push(animationKey.inTangent);}if(animationKey.outTangent!==void 0){if(animationKey.inTangent===void 0){key.values.push(void 0);}key.values.push(animationKey.outTangent);}if(animationKey.interpolation!==void 0){if(animationKey.inTangent===void 0){key.values.push(void 0);}if(animationKey.outTangent===void 0){key.values.push(void 0);}key.values.push(animationKey.interpolation);}break;case Animation.ANIMATIONTYPE_QUATERNION:case Animation.ANIMATIONTYPE_MATRIX:case Animation.ANIMATIONTYPE_VECTOR3:case Animation.ANIMATIONTYPE_COLOR3:case Animation.ANIMATIONTYPE_COLOR4:key.values=animationKey.value.asArray();if(animationKey.inTangent!=void 0){key.values.push(animationKey.inTangent.asArray());}if(animationKey.outTangent!=void 0){if(animationKey.inTangent===void 0){key.values.push(void 0);}key.values.push(animationKey.outTangent.asArray());}if(animationKey.interpolation!==void 0){if(animationKey.inTangent===void 0){key.values.push(void 0);}if(animationKey.outTangent===void 0){key.values.push(void 0);}key.values.push(animationKey.interpolation);}break;}serializationObject.keys.push(key);}serializationObject.ranges=[];for(var name135 in this._ranges){var source=this._ranges[name135];if(!source){continue;}var range={};range.name=name135;range.from=source.from;range.to=source.to;serializationObject.ranges.push(range);}return serializationObject;}}],[{key:"_PrepareAnimation",value:function _PrepareAnimation(name135,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction){var dataType=void 0;if(!isNaN(parseFloat(from))&&isFinite(from)){dataType=Animation.ANIMATIONTYPE_FLOAT;}else if(from instanceof Quaternion){dataType=Animation.ANIMATIONTYPE_QUATERNION;}else if(from instanceof Vector3){dataType=Animation.ANIMATIONTYPE_VECTOR3;}else if(from instanceof Vector2){dataType=Animation.ANIMATIONTYPE_VECTOR2;}else if(from instanceof Color3){dataType=Animation.ANIMATIONTYPE_COLOR3;}else if(from instanceof Color4){dataType=Animation.ANIMATIONTYPE_COLOR4;}else if(from instanceof Size){dataType=Animation.ANIMATIONTYPE_SIZE;}if(dataType==void 0){return null;}var animation=new Animation(name135,targetProperty,framePerSecond,dataType,loopMode);var keys=[{frame:0,value:from},{frame:totalFrame,value:to}];animation.setKeys(keys);if(easingFunction!==void 0){animation.setEasingFunction(easingFunction);}return animation;}},{key:"CreateAnimation",value:function CreateAnimation(property,animationType,framePerSecond,easingFunction){var animation=new Animation(property+"Animation",property,framePerSecond,animationType,Animation.ANIMATIONLOOPMODE_CONSTANT);animation.setEasingFunction(easingFunction);return animation;}},{key:"CreateAndStartAnimation",value:function CreateAndStartAnimation(name135,target,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction,onAnimationEnd,scene2){var animation=Animation._PrepareAnimation(name135,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction);if(!animation){return null;}if(target.getScene){scene2=target.getScene();}if(!scene2){return null;}return scene2.beginDirectAnimation(target,[animation],0,totalFrame,animation.loopMode===1,1,onAnimationEnd);}},{key:"CreateAndStartHierarchyAnimation",value:function CreateAndStartHierarchyAnimation(name135,node,directDescendantsOnly,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction,onAnimationEnd){var animation=Animation._PrepareAnimation(name135,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction);if(!animation){return null;}var scene2=node.getScene();return scene2.beginDirectHierarchyAnimation(node,directDescendantsOnly,[animation],0,totalFrame,animation.loopMode===1,1,onAnimationEnd);}},{key:"CreateMergeAndStartAnimation",value:function CreateMergeAndStartAnimation(name135,node,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction,onAnimationEnd){var animation=Animation._PrepareAnimation(name135,targetProperty,framePerSecond,totalFrame,from,to,loopMode,easingFunction);if(!animation){return null;}node.animations.push(animation);return node.getScene().beginAnimation(node,0,totalFrame,animation.loopMode===1,1,onAnimationEnd);}},{key:"MakeAnimationAdditive",value:function MakeAnimationAdditive(sourceAnimation){var referenceFrame=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var range=arguments.length>2?arguments[2]:undefined;var cloneOriginal=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var clonedName=arguments.length>4?arguments[4]:undefined;var animation=sourceAnimation;if(cloneOriginal){animation=sourceAnimation.clone();animation.name=clonedName||animation.name;}if(!animation._keys.length){return animation;}referenceFrame=referenceFrame>=0?referenceFrame:0;var startIndex=0;var firstKey=animation._keys[0];var endIndex=animation._keys.length-1;var lastKey=animation._keys[endIndex];var valueStore={referenceValue:firstKey.value,referencePosition:TmpVectors.Vector3[0],referenceQuaternion:TmpVectors.Quaternion[0],referenceScaling:TmpVectors.Vector3[1],keyPosition:TmpVectors.Vector3[2],keyQuaternion:TmpVectors.Quaternion[1],keyScaling:TmpVectors.Vector3[3]};var referenceFound=false;var from=firstKey.frame;var to=lastKey.frame;if(range){var rangeValue=animation.getRange(range);if(rangeValue){from=rangeValue.from;to=rangeValue.to;}}var fromKeyFound=firstKey.frame===from;var toKeyFound=lastKey.frame===to;if(animation._keys.length===1){var value=animation._getKeyValue(animation._keys[0]);valueStore.referenceValue=value.clone?value.clone():value;referenceFound=true;}else if(referenceFrame<=firstKey.frame){var _value5=animation._getKeyValue(firstKey.value);valueStore.referenceValue=_value5.clone?_value5.clone():_value5;referenceFound=true;}else if(referenceFrame>=lastKey.frame){var _value6=animation._getKeyValue(lastKey.value);valueStore.referenceValue=_value6.clone?_value6.clone():_value6;referenceFound=true;}var index=0;while(!referenceFound||!fromKeyFound||!toKeyFound&&index<animation._keys.length-1){var currentKey=animation._keys[index];var nextKey=animation._keys[index+1];if(!referenceFound&&referenceFrame>=currentKey.frame&&referenceFrame<=nextKey.frame){var _value7=void 0;if(referenceFrame===currentKey.frame){_value7=animation._getKeyValue(currentKey.value);}else if(referenceFrame===nextKey.frame){_value7=animation._getKeyValue(nextKey.value);}else{var animationState={key:index,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};_value7=animation._interpolate(referenceFrame,animationState);}valueStore.referenceValue=_value7.clone?_value7.clone():_value7;referenceFound=true;}if(!fromKeyFound&&from>=currentKey.frame&&from<=nextKey.frame){if(from===currentKey.frame){startIndex=index;}else if(from===nextKey.frame){startIndex=index+1;}else{var _animationState={key:index,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var _value8=animation._interpolate(from,_animationState);var key={frame:from,value:_value8.clone?_value8.clone():_value8};animation._keys.splice(index+1,0,key);startIndex=index+1;}fromKeyFound=true;}if(!toKeyFound&&to>=currentKey.frame&&to<=nextKey.frame){if(to===currentKey.frame){endIndex=index;}else if(to===nextKey.frame){endIndex=index+1;}else{var _animationState2={key:index,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};var _value9=animation._interpolate(to,_animationState2);var _key13={frame:to,value:_value9.clone?_value9.clone():_value9};animation._keys.splice(index+1,0,_key13);endIndex=index+1;}toKeyFound=true;}index++;}if(animation.dataType===Animation.ANIMATIONTYPE_QUATERNION){valueStore.referenceValue.normalize().conjugateInPlace();}else if(animation.dataType===Animation.ANIMATIONTYPE_MATRIX){valueStore.referenceValue.decompose(valueStore.referenceScaling,valueStore.referenceQuaternion,valueStore.referencePosition);valueStore.referenceQuaternion.normalize().conjugateInPlace();}for(index=startIndex;index<=endIndex;index++){var _key14=animation._keys[index];if(index&&animation.dataType!==Animation.ANIMATIONTYPE_FLOAT&&_key14.value===firstKey.value){continue;}switch(animation.dataType){case Animation.ANIMATIONTYPE_MATRIX:_key14.value.decompose(valueStore.keyScaling,valueStore.keyQuaternion,valueStore.keyPosition);valueStore.keyPosition.subtractInPlace(valueStore.referencePosition);valueStore.keyScaling.divideInPlace(valueStore.referenceScaling);valueStore.referenceQuaternion.multiplyToRef(valueStore.keyQuaternion,valueStore.keyQuaternion);Matrix.ComposeToRef(valueStore.keyScaling,valueStore.keyQuaternion,valueStore.keyPosition,_key14.value);break;case Animation.ANIMATIONTYPE_QUATERNION:valueStore.referenceValue.multiplyToRef(_key14.value,_key14.value);break;case Animation.ANIMATIONTYPE_VECTOR2:case Animation.ANIMATIONTYPE_VECTOR3:case Animation.ANIMATIONTYPE_COLOR3:case Animation.ANIMATIONTYPE_COLOR4:_key14.value.subtractToRef(valueStore.referenceValue,_key14.value);break;case Animation.ANIMATIONTYPE_SIZE:_key14.value.width-=valueStore.referenceValue.width;_key14.value.height-=valueStore.referenceValue.height;break;default:_key14.value-=valueStore.referenceValue;}}return animation;}},{key:"TransitionTo",value:function TransitionTo(property,targetValue,host,scene2,frameRate,transition,duration){var onAnimationEnd=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;if(duration<=0){host[property]=targetValue;if(onAnimationEnd){onAnimationEnd();}return null;}var endFrame=frameRate*(duration/1e3);transition.setKeys([{frame:0,value:host[property].clone?host[property].clone():host[property]},{frame:endFrame,value:targetValue}]);if(!host.animations){host.animations=[];}host.animations.push(transition);var animation=scene2.beginAnimation(host,0,endFrame,false);animation.onAnimationEnd=onAnimationEnd;return animation;}},{key:"_UniversalLerp",value:function _UniversalLerp(left,right,amount){var constructor=left.constructor;if(constructor.Lerp){return constructor.Lerp(left,right,amount);}else if(constructor.Slerp){return constructor.Slerp(left,right,amount);}else if(left.toFixed){return left*(1-amount)+amount*right;}else{return right;}}},{key:"Parse",value:function Parse(parsedAnimation){var animation=new Animation(parsedAnimation.name,parsedAnimation.property,parsedAnimation.framePerSecond,parsedAnimation.dataType,parsedAnimation.loopBehavior);var dataType=parsedAnimation.dataType;var keys=[];var data;var index;if(parsedAnimation.enableBlending){animation.enableBlending=parsedAnimation.enableBlending;}if(parsedAnimation.blendingSpeed){animation.blendingSpeed=parsedAnimation.blendingSpeed;}for(index=0;index<parsedAnimation.keys.length;index++){var key=parsedAnimation.keys[index];var inTangent=void 0;var outTangent=void 0;var interpolation=void 0;switch(dataType){case Animation.ANIMATIONTYPE_FLOAT:data=key.values[0];if(key.values.length>=2){inTangent=key.values[1];}if(key.values.length>=3){outTangent=key.values[2];}if(key.values.length>=4){interpolation=key.values[3];}break;case Animation.ANIMATIONTYPE_QUATERNION:data=Quaternion.FromArray(key.values);if(key.values.length>=8){var _inTangent=Quaternion.FromArray(key.values.slice(4,8));if(!_inTangent.equals(Quaternion.Zero())){inTangent=_inTangent;}}if(key.values.length>=12){var _outTangent=Quaternion.FromArray(key.values.slice(8,12));if(!_outTangent.equals(Quaternion.Zero())){outTangent=_outTangent;}}if(key.values.length>=13){interpolation=key.values[12];}break;case Animation.ANIMATIONTYPE_MATRIX:data=Matrix.FromArray(key.values);if(key.values.length>=17){interpolation=key.values[16];}break;case Animation.ANIMATIONTYPE_COLOR3:data=Color3.FromArray(key.values);if(key.values[3]){inTangent=Color3.FromArray(key.values[3]);}if(key.values[4]){outTangent=Color3.FromArray(key.values[4]);}if(key.values[5]){interpolation=key.values[5];}break;case Animation.ANIMATIONTYPE_COLOR4:data=Color4.FromArray(key.values);if(key.values[4]){inTangent=Color4.FromArray(key.values[4]);}if(key.values[5]){outTangent=Color4.FromArray(key.values[5]);}if(key.values[6]){interpolation=Color4.FromArray(key.values[6]);}break;case Animation.ANIMATIONTYPE_VECTOR3:default:data=Vector3.FromArray(key.values);if(key.values[3]){inTangent=Vector3.FromArray(key.values[3]);}if(key.values[4]){outTangent=Vector3.FromArray(key.values[4]);}if(key.values[5]){interpolation=key.values[5];}break;}var keyData={};keyData.frame=key.frame;keyData.value=data;if(inTangent!=void 0){keyData.inTangent=inTangent;}if(outTangent!=void 0){keyData.outTangent=outTangent;}if(interpolation!=void 0){keyData.interpolation=interpolation;}keys.push(keyData);}animation.setKeys(keys);if(parsedAnimation.ranges){for(index=0;index<parsedAnimation.ranges.length;index++){data=parsedAnimation.ranges[index];animation.createRange(data.name,data.from,data.to);}}return animation;}},{key:"AppendSerializedAnimations",value:function AppendSerializedAnimations(source,destination){SerializationHelper.AppendSerializedAnimations(source,destination);}},{key:"ParseFromFileAsync",value:function ParseFromFileAsync(name135,url){var _this118=this;return new Promise(function(resolve,reject){var request=new WebRequest();request.addEventListener("readystatechange",function(){if(request.readyState==4){if(request.status==200){var serializationObject=JSON.parse(request.responseText);if(serializationObject.animations){serializationObject=serializationObject.animations;}if(serializationObject.length){var output=new Array();var _iterator162=_createForOfIteratorHelper(serializationObject),_step172;try{for(_iterator162.s();!(_step172=_iterator162.n()).done;){var serializedAnimation=_step172.value;output.push(_this118.Parse(serializedAnimation));}}catch(err){_iterator162.e(err);}finally{_iterator162.f();}resolve(output);}else{var _output=_this118.Parse(serializationObject);if(name135){_output.name=name135;}resolve(_output);}}else{reject("Unable to load the animation");}}});request.open("GET",url);request.send();});}},{key:"ParseFromSnippetAsync",value:function ParseFromSnippetAsync(snippetId){var _this119=this;return new Promise(function(resolve,reject){var request=new WebRequest();request.addEventListener("readystatechange",function(){if(request.readyState==4){if(request.status==200){var snippet=JSON.parse(JSON.parse(request.responseText).jsonPayload);if(snippet.animations){var serializationObject=JSON.parse(snippet.animations);var outputs=new Array();var _iterator163=_createForOfIteratorHelper(serializationObject.animations),_step173;try{for(_iterator163.s();!(_step173=_iterator163.n()).done;){var serializedAnimation=_step173.value;var output=_this119.Parse(serializedAnimation);output.snippetId=snippetId;outputs.push(output);}}catch(err){_iterator163.e(err);}finally{_iterator163.f();}resolve(outputs);}else{var _serializationObject=JSON.parse(snippet.animation);var _output2=_this119.Parse(_serializationObject);_output2.snippetId=snippetId;resolve(_output2);}}else{reject("Unable to load the snippet "+snippetId);}}});request.open("GET",_this119.SnippetUrl+"/"+snippetId.replace(/#/g,"/"));request.send();});}}]);return Animation;}();Animation._UniqueIdGenerator=0;Animation.AllowMatricesInterpolation=false;Animation.AllowMatrixDecomposeForInterpolation=true;Animation.SnippetUrl="https://snippet.babylonjs.com";Animation.ANIMATIONTYPE_FLOAT=0;Animation.ANIMATIONTYPE_VECTOR3=1;Animation.ANIMATIONTYPE_QUATERNION=2;Animation.ANIMATIONTYPE_MATRIX=3;Animation.ANIMATIONTYPE_COLOR3=4;Animation.ANIMATIONTYPE_COLOR4=7;Animation.ANIMATIONTYPE_VECTOR2=5;Animation.ANIMATIONTYPE_SIZE=6;Animation.ANIMATIONLOOPMODE_RELATIVE=0;Animation.ANIMATIONLOOPMODE_CYCLE=1;Animation.ANIMATIONLOOPMODE_CONSTANT=2;Animation.CreateFromSnippetAsync=Animation.ParseFromSnippetAsync;RegisterClass("BABYLON.Animation",Animation);Node._AnimationRangeFactory=function(name135,from,to){return new AnimationRange(name135,from,to);};// node_modules/@babylonjs/core/Bones/bone.js
var Bone=/*#__PURE__*/function(_Node4){_inherits(Bone,_Node4);var _super34=_createSuper(Bone);function Bone(name135,skeleton){var _this120;var parentBone=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var localMatrix=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var restPose=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var baseMatrix=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var index=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;_classCallCheck(this,Bone);_this120=_super34.call(this,name135,skeleton.getScene());_this120.name=name135;_this120.children=new Array();_this120.animations=new Array();_this120._index=null;_this120._absoluteTransform=new Matrix();_this120._invertedAbsoluteTransform=new Matrix();_this120._scalingDeterminant=1;_this120._worldTransform=new Matrix();_this120._needToDecompose=true;_this120._needToCompose=false;_this120._linkedTransformNode=null;_this120._waitingTransformNodeId=null;_this120._skeleton=skeleton;_this120._localMatrix=localMatrix?localMatrix.clone():Matrix.Identity();_this120._restPose=restPose?restPose:_this120._localMatrix.clone();_this120._baseMatrix=baseMatrix?baseMatrix:_this120._localMatrix.clone();_this120._index=index;skeleton.bones.push(_assertThisInitialized(_this120));_this120.setParent(parentBone,false);if(baseMatrix||localMatrix){_this120._updateDifferenceMatrix();}return _this120;}_createClass(Bone,[{key:"_matrix",get:function get(){this._compose();return this._localMatrix;},set:function set(value){this._needToCompose=false;if(value.updateFlag===this._localMatrix.updateFlag){return;}this._localMatrix.copyFrom(value);this._markAsDirtyAndDecompose();}},{key:"getClassName",value:function getClassName(){return"Bone";}},{key:"getSkeleton",value:function getSkeleton(){return this._skeleton;}},{key:"parent",get:function get(){return this._parentNode;},set:function set(newParent){this.setParent(newParent);}},{key:"getParent",value:function getParent(){return this.parent;}},{key:"getChildren",value:function getChildren(){return this.children;}},{key:"getIndex",value:function getIndex(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index;}},{key:"setParent",value:function setParent(parent){var updateDifferenceMatrix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(this.parent===parent){return;}if(this.parent){var index=this.parent.children.indexOf(this);if(index!==-1){this.parent.children.splice(index,1);}}this._parentNode=parent;if(this.parent){this.parent.children.push(this);}if(updateDifferenceMatrix){this._updateDifferenceMatrix();}this.markAsDirty();}},{key:"getLocalMatrix",value:function getLocalMatrix(){this._compose();return this._localMatrix;}},{key:"getBaseMatrix",value:function getBaseMatrix(){return this._baseMatrix;}},{key:"getRestPose",value:function getRestPose(){return this._restPose;}},{key:"setRestPose",value:function setRestPose(matrix){this._restPose.copyFrom(matrix);}},{key:"getBindPose",value:function getBindPose(){return this._baseMatrix;}},{key:"setBindPose",value:function setBindPose(matrix){this.updateMatrix(matrix);}},{key:"getWorldMatrix",value:function getWorldMatrix(){return this._worldTransform;}},{key:"returnToRest",value:function returnToRest(){var _a;if(this._linkedTransformNode){var localScaling=TmpVectors.Vector3[0];var localRotation=TmpVectors.Quaternion[0];var localPosition=TmpVectors.Vector3[1];this.getRestPose().decompose(localScaling,localRotation,localPosition);this._linkedTransformNode.position.copyFrom(localPosition);this._linkedTransformNode.rotationQuaternion=(_a=this._linkedTransformNode.rotationQuaternion)!==null&&_a!==void 0?_a:Quaternion.Identity();this._linkedTransformNode.rotationQuaternion.copyFrom(localRotation);this._linkedTransformNode.scaling.copyFrom(localScaling);}else{this._matrix=this._restPose;}}},{key:"getInvertedAbsoluteTransform",value:function getInvertedAbsoluteTransform(){return this._invertedAbsoluteTransform;}},{key:"getAbsoluteTransform",value:function getAbsoluteTransform(){return this._absoluteTransform;}},{key:"linkTransformNode",value:function linkTransformNode(transformNode){if(this._linkedTransformNode){this._skeleton._numBonesWithLinkedTransformNode--;}this._linkedTransformNode=transformNode;if(this._linkedTransformNode){this._skeleton._numBonesWithLinkedTransformNode++;}}},{key:"getTransformNode",value:function getTransformNode(){return this._linkedTransformNode;}},{key:"position",get:function get(){this._decompose();return this._localPosition;},set:function set(newPosition){this._decompose();this._localPosition.copyFrom(newPosition);this._markAsDirtyAndCompose();}},{key:"rotation",get:function get(){return this.getRotation();},set:function set(newRotation){this.setRotation(newRotation);}},{key:"rotationQuaternion",get:function get(){this._decompose();return this._localRotation;},set:function set(newRotation){this.setRotationQuaternion(newRotation);}},{key:"scaling",get:function get(){return this.getScale();},set:function set(newScaling){this.setScale(newScaling);}},{key:"animationPropertiesOverride",get:function get(){return this._skeleton.animationPropertiesOverride;}},{key:"_decompose",value:function _decompose(){if(!this._needToDecompose){return;}this._needToDecompose=false;if(!this._localScaling){this._localScaling=Vector3.Zero();this._localRotation=Quaternion.Zero();this._localPosition=Vector3.Zero();}this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition);}},{key:"_compose",value:function _compose(){if(!this._needToCompose){return;}if(!this._localScaling){this._needToCompose=false;return;}this._needToCompose=false;Matrix.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix);}},{key:"updateMatrix",value:function updateMatrix(matrix){var updateDifferenceMatrix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var updateLocalMatrix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;this._baseMatrix.copyFrom(matrix);if(updateDifferenceMatrix){this._updateDifferenceMatrix();}if(updateLocalMatrix){this._matrix=matrix;}else{this.markAsDirty();}}},{key:"_updateDifferenceMatrix",value:function _updateDifferenceMatrix(rootMatrix){var updateChildren=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!rootMatrix){rootMatrix=this._baseMatrix;}if(this.parent){rootMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);}else{this._absoluteTransform.copyFrom(rootMatrix);}this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform);if(updateChildren){for(var index=0;index<this.children.length;index++){this.children[index]._updateDifferenceMatrix();}}this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1;}},{key:"markAsDirty",value:function markAsDirty(){this._currentRenderId++;this._childUpdateId++;this._skeleton._markAsDirty();return this;}},{key:"_markAsDirtyAndCompose",value:function _markAsDirtyAndCompose(){this.markAsDirty();this._needToCompose=true;}},{key:"_markAsDirtyAndDecompose",value:function _markAsDirtyAndDecompose(){this.markAsDirty();this._needToDecompose=true;}},{key:"translate",value:function translate(vec){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;var tNode=arguments.length>2?arguments[2]:undefined;var lm=this.getLocalMatrix();if(space==Space.LOCAL){lm.addAtIndex(12,vec.x);lm.addAtIndex(13,vec.y);lm.addAtIndex(14,vec.z);}else{var wm=null;if(tNode){wm=tNode.getWorldMatrix();}this._skeleton.computeAbsoluteTransforms();var tmat=Bone._TmpMats[0];var tvec=Bone._TmpVecs[0];if(this.parent){if(tNode&&wm){tmat.copyFrom(this.parent.getAbsoluteTransform());tmat.multiplyToRef(wm,tmat);}else{tmat.copyFrom(this.parent.getAbsoluteTransform());}}else{Matrix.IdentityToRef(tmat);}tmat.setTranslationFromFloats(0,0,0);tmat.invert();Vector3.TransformCoordinatesToRef(vec,tmat,tvec);lm.addAtIndex(12,tvec.x);lm.addAtIndex(13,tvec.y);lm.addAtIndex(14,tvec.z);}this._markAsDirtyAndDecompose();}},{key:"setPosition",value:function setPosition(position){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;var tNode=arguments.length>2?arguments[2]:undefined;var lm=this.getLocalMatrix();if(space==Space.LOCAL){lm.setTranslationFromFloats(position.x,position.y,position.z);}else{var wm=null;if(tNode){wm=tNode.getWorldMatrix();}this._skeleton.computeAbsoluteTransforms();var tmat=Bone._TmpMats[0];var vec=Bone._TmpVecs[0];if(this.parent){if(tNode&&wm){tmat.copyFrom(this.parent.getAbsoluteTransform());tmat.multiplyToRef(wm,tmat);}else{tmat.copyFrom(this.parent.getAbsoluteTransform());}tmat.invert();}else{Matrix.IdentityToRef(tmat);}Vector3.TransformCoordinatesToRef(position,tmat,vec);lm.setTranslationFromFloats(vec.x,vec.y,vec.z);}this._markAsDirtyAndDecompose();}},{key:"setAbsolutePosition",value:function setAbsolutePosition(position,tNode){this.setPosition(position,Space.WORLD,tNode);}},{key:"scale",value:function scale(x,y,z){var scaleChildren=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var locMat=this.getLocalMatrix();var scaleMat=Bone._TmpMats[0];Matrix.ScalingToRef(x,y,z,scaleMat);scaleMat.multiplyToRef(locMat,locMat);scaleMat.invert();var _iterator164=_createForOfIteratorHelper(this.children),_step174;try{for(_iterator164.s();!(_step174=_iterator164.n()).done;){var _child=_step174.value;var cm=_child.getLocalMatrix();cm.multiplyToRef(scaleMat,cm);cm.multiplyAtIndex(12,x);cm.multiplyAtIndex(13,y);cm.multiplyAtIndex(14,z);_child._markAsDirtyAndDecompose();}}catch(err){_iterator164.e(err);}finally{_iterator164.f();}this._markAsDirtyAndDecompose();if(scaleChildren){var _iterator165=_createForOfIteratorHelper(this.children),_step175;try{for(_iterator165.s();!(_step175=_iterator165.n()).done;){var child=_step175.value;child.scale(x,y,z,scaleChildren);}}catch(err){_iterator165.e(err);}finally{_iterator165.f();}}}},{key:"setScale",value:function setScale(scale){this._decompose();this._localScaling.copyFrom(scale);this._markAsDirtyAndCompose();}},{key:"getScale",value:function getScale(){this._decompose();return this._localScaling;}},{key:"getScaleToRef",value:function getScaleToRef(result){this._decompose();result.copyFrom(this._localScaling);}},{key:"setYawPitchRoll",value:function setYawPitchRoll(yaw,pitch,roll){var space=arguments.length>3&&arguments[3]!==undefined?arguments[3]:Space.LOCAL;var tNode=arguments.length>4?arguments[4]:undefined;if(space===Space.LOCAL){var quat=Bone._TmpQuat;Quaternion.RotationYawPitchRollToRef(yaw,pitch,roll,quat);this.setRotationQuaternion(quat,space,tNode);return;}var rotMatInv=Bone._TmpMats[0];if(!this._getNegativeRotationToRef(rotMatInv,tNode)){return;}var rotMat=Bone._TmpMats[1];Matrix.RotationYawPitchRollToRef(yaw,pitch,roll,rotMat);rotMatInv.multiplyToRef(rotMat,rotMat);this._rotateWithMatrix(rotMat,space,tNode);}},{key:"rotate",value:function rotate(axis,amount){var space=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Space.LOCAL;var tNode=arguments.length>3?arguments[3]:undefined;var rmat=Bone._TmpMats[0];rmat.setTranslationFromFloats(0,0,0);Matrix.RotationAxisToRef(axis,amount,rmat);this._rotateWithMatrix(rmat,space,tNode);}},{key:"setAxisAngle",value:function setAxisAngle(axis,angle){var space=arguments.length>2&&arguments[2]!==undefined?arguments[2]:Space.LOCAL;var tNode=arguments.length>3?arguments[3]:undefined;if(space===Space.LOCAL){var quat=Bone._TmpQuat;Quaternion.RotationAxisToRef(axis,angle,quat);this.setRotationQuaternion(quat,space,tNode);return;}var rotMatInv=Bone._TmpMats[0];if(!this._getNegativeRotationToRef(rotMatInv,tNode)){return;}var rotMat=Bone._TmpMats[1];Matrix.RotationAxisToRef(axis,angle,rotMat);rotMatInv.multiplyToRef(rotMat,rotMat);this._rotateWithMatrix(rotMat,space,tNode);}},{key:"setRotation",value:function setRotation(rotation){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;var tNode=arguments.length>2?arguments[2]:undefined;this.setYawPitchRoll(rotation.y,rotation.x,rotation.z,space,tNode);}},{key:"setRotationQuaternion",value:function setRotationQuaternion(quat){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;var tNode=arguments.length>2?arguments[2]:undefined;if(space===Space.LOCAL){this._decompose();this._localRotation.copyFrom(quat);this._markAsDirtyAndCompose();return;}var rotMatInv=Bone._TmpMats[0];if(!this._getNegativeRotationToRef(rotMatInv,tNode)){return;}var rotMat=Bone._TmpMats[1];Matrix.FromQuaternionToRef(quat,rotMat);rotMatInv.multiplyToRef(rotMat,rotMat);this._rotateWithMatrix(rotMat,space,tNode);}},{key:"setRotationMatrix",value:function setRotationMatrix(rotMat){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;var tNode=arguments.length>2?arguments[2]:undefined;if(space===Space.LOCAL){var quat=Bone._TmpQuat;Quaternion.FromRotationMatrixToRef(rotMat,quat);this.setRotationQuaternion(quat,space,tNode);return;}var rotMatInv=Bone._TmpMats[0];if(!this._getNegativeRotationToRef(rotMatInv,tNode)){return;}var rotMat2=Bone._TmpMats[1];rotMat2.copyFrom(rotMat);rotMatInv.multiplyToRef(rotMat,rotMat2);this._rotateWithMatrix(rotMat2,space,tNode);}},{key:"_rotateWithMatrix",value:function _rotateWithMatrix(rmat){var space=arguments.length>1&&arguments[1]!==undefined?arguments[1]:Space.LOCAL;var tNode=arguments.length>2?arguments[2]:undefined;var lmat=this.getLocalMatrix();var lx=lmat.m[12];var ly=lmat.m[13];var lz=lmat.m[14];var parent=this.getParent();var parentScale=Bone._TmpMats[3];var parentScaleInv=Bone._TmpMats[4];if(parent&&space==Space.WORLD){if(tNode){parentScale.copyFrom(tNode.getWorldMatrix());parent.getAbsoluteTransform().multiplyToRef(parentScale,parentScale);}else{parentScale.copyFrom(parent.getAbsoluteTransform());}parentScaleInv.copyFrom(parentScale);parentScaleInv.invert();lmat.multiplyToRef(parentScale,lmat);lmat.multiplyToRef(rmat,lmat);lmat.multiplyToRef(parentScaleInv,lmat);}else{if(space==Space.WORLD&&tNode){parentScale.copyFrom(tNode.getWorldMatrix());parentScaleInv.copyFrom(parentScale);parentScaleInv.invert();lmat.multiplyToRef(parentScale,lmat);lmat.multiplyToRef(rmat,lmat);lmat.multiplyToRef(parentScaleInv,lmat);}else{lmat.multiplyToRef(rmat,lmat);}}lmat.setTranslationFromFloats(lx,ly,lz);this.computeAbsoluteTransforms();this._markAsDirtyAndDecompose();}},{key:"_getNegativeRotationToRef",value:function _getNegativeRotationToRef(rotMatInv,tNode){var scaleMatrix=Bone._TmpMats[2];rotMatInv.copyFrom(this.getAbsoluteTransform());if(tNode){rotMatInv.multiplyToRef(tNode.getWorldMatrix(),rotMatInv);Matrix.ScalingToRef(tNode.scaling.x,tNode.scaling.y,tNode.scaling.z,scaleMatrix);}else{Matrix.IdentityToRef(scaleMatrix);}rotMatInv.invert();if(isNaN(rotMatInv.m[0])){return false;}scaleMatrix.multiplyAtIndex(0,this._scalingDeterminant);rotMatInv.multiplyToRef(scaleMatrix,rotMatInv);return true;}},{key:"getPosition",value:function getPosition(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var pos=Vector3.Zero();this.getPositionToRef(space,tNode,pos);return pos;}},{key:"getPositionToRef",value:function getPositionToRef(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1?arguments[1]:undefined;var result=arguments.length>2?arguments[2]:undefined;if(space==Space.LOCAL){var lm=this.getLocalMatrix();result.x=lm.m[12];result.y=lm.m[13];result.z=lm.m[14];}else{var wm=null;if(tNode){wm=tNode.getWorldMatrix();}this._skeleton.computeAbsoluteTransforms();var tmat=Bone._TmpMats[0];if(tNode&&wm){tmat.copyFrom(this.getAbsoluteTransform());tmat.multiplyToRef(wm,tmat);}else{tmat=this.getAbsoluteTransform();}result.x=tmat.m[12];result.y=tmat.m[13];result.z=tmat.m[14];}}},{key:"getAbsolutePosition",value:function getAbsolutePosition(){var tNode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var pos=Vector3.Zero();this.getPositionToRef(Space.WORLD,tNode,pos);return pos;}},{key:"getAbsolutePositionToRef",value:function getAbsolutePositionToRef(tNode,result){this.getPositionToRef(Space.WORLD,tNode,result);}},{key:"computeAbsoluteTransforms",value:function computeAbsoluteTransforms(){this._compose();if(this.parent){this._localMatrix.multiplyToRef(this.parent._absoluteTransform,this._absoluteTransform);}else{this._absoluteTransform.copyFrom(this._localMatrix);var poseMatrix=this._skeleton.getPoseMatrix();if(poseMatrix){this._absoluteTransform.multiplyToRef(poseMatrix,this._absoluteTransform);}}var children=this.children;var len=children.length;for(var i=0;i<len;i++){children[i].computeAbsoluteTransforms();}}},{key:"getDirection",value:function getDirection(localAxis){var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=Vector3.Zero();this.getDirectionToRef(localAxis,tNode,result);return result;}},{key:"getDirectionToRef",value:function getDirectionToRef(localAxis){var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=arguments.length>2?arguments[2]:undefined;var wm=null;if(tNode){wm=tNode.getWorldMatrix();}this._skeleton.computeAbsoluteTransforms();var mat=Bone._TmpMats[0];mat.copyFrom(this.getAbsoluteTransform());if(tNode&&wm){mat.multiplyToRef(wm,mat);}Vector3.TransformNormalToRef(localAxis,mat,result);result.normalize();}},{key:"getRotation",value:function getRotation(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=Vector3.Zero();this.getRotationToRef(space,tNode,result);return result;}},{key:"getRotationToRef",value:function getRotationToRef(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=arguments.length>2?arguments[2]:undefined;var quat=Bone._TmpQuat;this.getRotationQuaternionToRef(space,tNode,quat);quat.toEulerAnglesToRef(result);}},{key:"getRotationQuaternion",value:function getRotationQuaternion(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=Quaternion.Identity();this.getRotationQuaternionToRef(space,tNode,result);return result;}},{key:"getRotationQuaternionToRef",value:function getRotationQuaternionToRef(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=arguments.length>2?arguments[2]:undefined;if(space==Space.LOCAL){this._decompose();result.copyFrom(this._localRotation);}else{var mat=Bone._TmpMats[0];var amat=this.getAbsoluteTransform();if(tNode){amat.multiplyToRef(tNode.getWorldMatrix(),mat);}else{mat.copyFrom(amat);}mat.multiplyAtIndex(0,this._scalingDeterminant);mat.multiplyAtIndex(1,this._scalingDeterminant);mat.multiplyAtIndex(2,this._scalingDeterminant);mat.decompose(void 0,result,void 0);}}},{key:"getRotationMatrix",value:function getRotationMatrix(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1?arguments[1]:undefined;var result=Matrix.Identity();this.getRotationMatrixToRef(space,tNode,result);return result;}},{key:"getRotationMatrixToRef",value:function getRotationMatrixToRef(){var space=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Space.LOCAL;var tNode=arguments.length>1?arguments[1]:undefined;var result=arguments.length>2?arguments[2]:undefined;if(space==Space.LOCAL){this.getLocalMatrix().getRotationMatrixToRef(result);}else{var mat=Bone._TmpMats[0];var amat=this.getAbsoluteTransform();if(tNode){amat.multiplyToRef(tNode.getWorldMatrix(),mat);}else{mat.copyFrom(amat);}mat.multiplyAtIndex(0,this._scalingDeterminant);mat.multiplyAtIndex(1,this._scalingDeterminant);mat.multiplyAtIndex(2,this._scalingDeterminant);mat.getRotationMatrixToRef(result);}}},{key:"getAbsolutePositionFromLocal",value:function getAbsolutePositionFromLocal(position){var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=Vector3.Zero();this.getAbsolutePositionFromLocalToRef(position,tNode,result);return result;}},{key:"getAbsolutePositionFromLocalToRef",value:function getAbsolutePositionFromLocalToRef(position){var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=arguments.length>2?arguments[2]:undefined;var wm=null;if(tNode){wm=tNode.getWorldMatrix();}this._skeleton.computeAbsoluteTransforms();var tmat=Bone._TmpMats[0];if(tNode&&wm){tmat.copyFrom(this.getAbsoluteTransform());tmat.multiplyToRef(wm,tmat);}else{tmat=this.getAbsoluteTransform();}Vector3.TransformCoordinatesToRef(position,tmat,result);}},{key:"getLocalPositionFromAbsolute",value:function getLocalPositionFromAbsolute(position){var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=Vector3.Zero();this.getLocalPositionFromAbsoluteToRef(position,tNode,result);return result;}},{key:"getLocalPositionFromAbsoluteToRef",value:function getLocalPositionFromAbsoluteToRef(position){var tNode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var result=arguments.length>2?arguments[2]:undefined;var wm=null;if(tNode){wm=tNode.getWorldMatrix();}this._skeleton.computeAbsoluteTransforms();var tmat=Bone._TmpMats[0];tmat.copyFrom(this.getAbsoluteTransform());if(tNode&&wm){tmat.multiplyToRef(wm,tmat);}tmat.invert();Vector3.TransformCoordinatesToRef(position,tmat,result);}},{key:"setCurrentPoseAsRest",value:function setCurrentPoseAsRest(){this.setRestPose(this.getLocalMatrix());}}]);return Bone;}(Node);Bone._TmpVecs=ArrayTools.BuildArray(2,Vector3.Zero);Bone._TmpQuat=Quaternion.Identity();Bone._TmpMats=ArrayTools.BuildArray(5,Matrix.Identity);// node_modules/@babylonjs/core/Materials/Textures/thinTexture.js
var ThinTexture=/*#__PURE__*/function(){function ThinTexture(internalTexture){_classCallCheck(this,ThinTexture);this._wrapU=1;this._wrapV=1;this.wrapR=1;this.anisotropicFilteringLevel=4;this.delayLoadState=0;this._texture=null;this._engine=null;this._cachedSize=Size.Zero();this._cachedBaseSize=Size.Zero();this._initialSamplingMode=2;this._texture=internalTexture;if(this._texture){this._engine=this._texture.getEngine();}}_createClass(ThinTexture,[{key:"wrapU",get:function get(){return this._wrapU;},set:function set(value){this._wrapU=value;}},{key:"wrapV",get:function get(){return this._wrapV;},set:function set(value){this._wrapV=value;}},{key:"coordinatesMode",get:function get(){return 0;}},{key:"isCube",get:function get(){if(!this._texture){return false;}return this._texture.isCube;},set:function set(value){if(!this._texture){return;}this._texture.isCube=value;}},{key:"is3D",get:function get(){if(!this._texture){return false;}return this._texture.is3D;},set:function set(value){if(!this._texture){return;}this._texture.is3D=value;}},{key:"is2DArray",get:function get(){if(!this._texture){return false;}return this._texture.is2DArray;},set:function set(value){if(!this._texture){return;}this._texture.is2DArray=value;}},{key:"getClassName",value:function getClassName(){return"ThinTexture";}},{key:"isReady",value:function isReady(){if(this.delayLoadState===4){this.delayLoad();return false;}if(this._texture){return this._texture.isReady;}return false;}},{key:"delayLoad",value:function delayLoad(){}},{key:"getInternalTexture",value:function getInternalTexture(){return this._texture;}},{key:"getSize",value:function getSize(){if(this._texture){if(this._texture.width){this._cachedSize.width=this._texture.width;this._cachedSize.height=this._texture.height;return this._cachedSize;}if(this._texture._size){this._cachedSize.width=this._texture._size;this._cachedSize.height=this._texture._size;return this._cachedSize;}}return this._cachedSize;}},{key:"getBaseSize",value:function getBaseSize(){if(!this.isReady()||!this._texture){this._cachedBaseSize.width=0;this._cachedBaseSize.height=0;return this._cachedBaseSize;}if(this._texture._size){this._cachedBaseSize.width=this._texture._size;this._cachedBaseSize.height=this._texture._size;return this._cachedBaseSize;}this._cachedBaseSize.width=this._texture.baseWidth;this._cachedBaseSize.height=this._texture.baseHeight;return this._cachedBaseSize;}},{key:"samplingMode",get:function get(){if(!this._texture){return this._initialSamplingMode;}return this._texture.samplingMode;}},{key:"updateSamplingMode",value:function updateSamplingMode(samplingMode){if(this._texture&&this._engine){this._engine.updateTextureSamplingMode(samplingMode,this._texture);}}},{key:"releaseInternalTexture",value:function releaseInternalTexture(){if(this._texture){this._texture.dispose();this._texture=null;}}},{key:"dispose",value:function dispose(){if(this._texture){this.releaseInternalTexture();this._engine=null;}}}]);return ThinTexture;}();// node_modules/@babylonjs/core/Materials/Textures/baseTexture.js
var BaseTexture=/*#__PURE__*/function(_ThinTexture){_inherits(BaseTexture,_ThinTexture);var _super35=_createSuper(BaseTexture);function BaseTexture(sceneOrEngine){var _this121;var internalTexture=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,BaseTexture);_this121=_super35.call(this,null);_this121.metadata=null;_this121.reservedDataStore=null;_this121._hasAlpha=false;_this121._getAlphaFromRGB=false;_this121.level=1;_this121._coordinatesIndex=0;_this121.optimizeUVAllocation=true;_this121._coordinatesMode=0;_this121.wrapR=1;_this121.anisotropicFilteringLevel=BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL;_this121._isCube=false;_this121._gammaSpace=true;_this121.invertZ=false;_this121.lodLevelInAlpha=false;_this121.isRenderTarget=false;_this121._prefiltered=false;_this121._forceSerialize=false;_this121.animations=new Array();_this121.onDisposeObservable=new Observable();_this121._onDisposeObserver=null;_this121._scene=null;_this121._uid=null;_this121._parentContainer=null;_this121._loadingError=false;if(sceneOrEngine){if(BaseTexture._IsScene(sceneOrEngine)){_this121._scene=sceneOrEngine;}else{_this121._engine=sceneOrEngine;}}else{_this121._scene=EngineStore.LastCreatedScene;}if(_this121._scene){_this121.uniqueId=_this121._scene.getUniqueId();_this121._scene.addTexture(_assertThisInitialized(_this121));_this121._engine=_this121._scene.getEngine();}_this121._texture=internalTexture;_this121._uid=null;return _this121;}_createClass(BaseTexture,[{key:"hasAlpha",get:function get(){return this._hasAlpha;},set:function set(value){var _this122=this;if(this._hasAlpha===value){return;}this._hasAlpha=value;if(this._scene){this._scene.markAllMaterialsAsDirty(1,function(mat){return mat.hasTexture(_this122);});}}},{key:"getAlphaFromRGB",get:function get(){return this._getAlphaFromRGB;},set:function set(value){var _this123=this;if(this._getAlphaFromRGB===value){return;}this._getAlphaFromRGB=value;if(this._scene){this._scene.markAllMaterialsAsDirty(1,function(mat){return mat.hasTexture(_this123);});}}},{key:"coordinatesIndex",get:function get(){return this._coordinatesIndex;},set:function set(value){var _this124=this;if(this._coordinatesIndex===value){return;}this._coordinatesIndex=value;if(this._scene){this._scene.markAllMaterialsAsDirty(1,function(mat){return mat.hasTexture(_this124);});}}},{key:"coordinatesMode",get:function get(){return this._coordinatesMode;},set:function set(value){var _this125=this;if(this._coordinatesMode===value){return;}this._coordinatesMode=value;if(this._scene){this._scene.markAllMaterialsAsDirty(1,function(mat){return mat.hasTexture(_this125);});}}},{key:"wrapU",get:function get(){return this._wrapU;},set:function set(value){this._wrapU=value;}},{key:"wrapV",get:function get(){return this._wrapV;},set:function set(value){this._wrapV=value;}},{key:"isCube",get:function get(){if(!this._texture){return this._isCube;}return this._texture.isCube;},set:function set(value){if(!this._texture){this._isCube=value;}else{this._texture.isCube=value;}}},{key:"is3D",get:function get(){if(!this._texture){return false;}return this._texture.is3D;},set:function set(value){if(!this._texture){return;}this._texture.is3D=value;}},{key:"is2DArray",get:function get(){if(!this._texture){return false;}return this._texture.is2DArray;},set:function set(value){if(!this._texture){return;}this._texture.is2DArray=value;}},{key:"gammaSpace",get:function get(){if(!this._texture){return this._gammaSpace;}else{if(this._texture._gammaSpace===null){this._texture._gammaSpace=this._gammaSpace;}}return this._texture._gammaSpace&&!this._texture._useSRGBBuffer;},set:function set(gamma){if(!this._texture){if(this._gammaSpace===gamma){return;}this._gammaSpace=gamma;}else{if(this._texture._gammaSpace===gamma){return;}this._texture._gammaSpace=gamma;}this._markAllSubMeshesAsTexturesDirty();}},{key:"isRGBD",get:function get(){return this._texture!=null&&this._texture._isRGBD;},set:function set(value){if(this._texture){this._texture._isRGBD=value;}}},{key:"noMipmap",get:function get(){return false;}},{key:"lodGenerationOffset",get:function get(){if(this._texture){return this._texture._lodGenerationOffset;}return 0;},set:function set(value){if(this._texture){this._texture._lodGenerationOffset=value;}}},{key:"lodGenerationScale",get:function get(){if(this._texture){return this._texture._lodGenerationScale;}return 0;},set:function set(value){if(this._texture){this._texture._lodGenerationScale=value;}}},{key:"linearSpecularLOD",get:function get(){if(this._texture){return this._texture._linearSpecularLOD;}return false;},set:function set(value){if(this._texture){this._texture._linearSpecularLOD=value;}}},{key:"irradianceTexture",get:function get(){if(this._texture){return this._texture._irradianceTexture;}return null;},set:function set(value){if(this._texture){this._texture._irradianceTexture=value;}}},{key:"uid",get:function get(){if(!this._uid){this._uid=RandomGUID();}return this._uid;}},{key:"toString",value:function toString(){return this.name;}},{key:"getClassName",value:function getClassName(){return"BaseTexture";}},{key:"onDispose",set:function set(callback){if(this._onDisposeObserver){this.onDisposeObservable.remove(this._onDisposeObserver);}this._onDisposeObserver=this.onDisposeObservable.add(callback);}},{key:"isBlocking",get:function get(){return true;}},{key:"loadingError",get:function get(){return this._loadingError;}},{key:"errorObject",get:function get(){return this._errorObject;}},{key:"getScene",value:function getScene(){return this._scene;}},{key:"_getEngine",value:function _getEngine(){return this._engine;}},{key:"checkTransformsAreIdentical",value:function checkTransformsAreIdentical(texture){return texture!==null;}},{key:"getTextureMatrix",value:function getTextureMatrix(){return Matrix.IdentityReadOnly;}},{key:"getReflectionTextureMatrix",value:function getReflectionTextureMatrix(){return Matrix.IdentityReadOnly;}},{key:"isReadyOrNotBlocking",value:function isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError;}},{key:"scale",value:function scale(ratio){}},{key:"canRescale",get:function get(){return false;}},{key:"_getFromCache",value:function _getFromCache(url,noMipmap,sampling,invertY,useSRGBBuffer,isCube){var engine=this._getEngine();if(!engine){return null;}var correctedUseSRGBBuffer=engine._getUseSRGBBuffer(!!useSRGBBuffer,noMipmap);var texturesCache=engine.getLoadedTexturesCache();for(var index=0;index<texturesCache.length;index++){var texturesCacheEntry=texturesCache[index];if(useSRGBBuffer===void 0||correctedUseSRGBBuffer===texturesCacheEntry._useSRGBBuffer){if(invertY===void 0||invertY===texturesCacheEntry.invertY){if(texturesCacheEntry.url===url&&texturesCacheEntry.generateMipMaps===!noMipmap){if(!sampling||sampling===texturesCacheEntry.samplingMode){if(isCube===void 0||isCube===texturesCacheEntry.isCube){texturesCacheEntry.incrementReferences();return texturesCacheEntry;}}}}}}return null;}},{key:"_rebuild",value:function _rebuild(){}},{key:"clone",value:function clone(){return null;}},{key:"textureType",get:function get(){if(!this._texture){return 0;}return this._texture.type!==void 0?this._texture.type:0;}},{key:"textureFormat",get:function get(){if(!this._texture){return 5;}return this._texture.format!==void 0?this._texture.format:5;}},{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){var scene2=this.getScene();if(!scene2){return;}scene2.markAllMaterialsAsDirty(1);}},{key:"readPixels",value:function readPixels(){var faceIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var level=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var buffer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var flushRenderer=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var noDataConversion=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var x=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var y=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var width=arguments.length>7&&arguments[7]!==undefined?arguments[7]:Number.MAX_VALUE;var height=arguments.length>8&&arguments[8]!==undefined?arguments[8]:Number.MAX_VALUE;if(!this._texture){return null;}var engine=this._getEngine();if(!engine){return null;}var size=this.getSize();var maxWidth=size.width;var maxHeight=size.height;if(level!==0){maxWidth=maxWidth/Math.pow(2,level);maxHeight=maxHeight/Math.pow(2,level);maxWidth=Math.round(maxWidth);maxHeight=Math.round(maxHeight);}width=Math.min(maxWidth,width);height=Math.min(maxHeight,height);try{if(this._texture.isCube){return engine._readTexturePixels(this._texture,width,height,faceIndex,level,buffer,flushRenderer,noDataConversion,x,y);}return engine._readTexturePixels(this._texture,width,height,-1,level,buffer,flushRenderer,noDataConversion,x,y);}catch(e){return null;}}},{key:"_readPixelsSync",value:function _readPixelsSync(){var faceIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var level=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var buffer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var flushRenderer=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var noDataConversion=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;if(!this._texture){return null;}var size=this.getSize();var width=size.width;var height=size.height;var engine=this._getEngine();if(!engine){return null;}if(level!=0){width=width/Math.pow(2,level);height=height/Math.pow(2,level);width=Math.round(width);height=Math.round(height);}try{if(this._texture.isCube){return engine._readTexturePixelsSync(this._texture,width,height,faceIndex,level,buffer,flushRenderer,noDataConversion);}return engine._readTexturePixelsSync(this._texture,width,height,-1,level,buffer,flushRenderer,noDataConversion);}catch(e){return null;}}},{key:"_lodTextureHigh",get:function get(){if(this._texture){return this._texture._lodTextureHigh;}return null;}},{key:"_lodTextureMid",get:function get(){if(this._texture){return this._texture._lodTextureMid;}return null;}},{key:"_lodTextureLow",get:function get(){if(this._texture){return this._texture._lodTextureLow;}return null;}},{key:"dispose",value:function dispose(){if(this._scene){if(this._scene.stopAnimation){this._scene.stopAnimation(this);}this._scene.removePendingData(this);var index=this._scene.textures.indexOf(this);if(index>=0){this._scene.textures.splice(index,1);}this._scene.onTextureRemovedObservable.notifyObservers(this);this._scene=null;if(this._parentContainer){var index2=this._parentContainer.textures.indexOf(this);if(index2>-1){this._parentContainer.textures.splice(index2,1);}this._parentContainer=null;}}this.onDisposeObservable.notifyObservers(this);this.onDisposeObservable.clear();this.metadata=null;_get(_getPrototypeOf(BaseTexture.prototype),"dispose",this).call(this);}},{key:"serialize",value:function serialize(){var allowEmptyName=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this.name&&!allowEmptyName){return null;}var serializationObject=SerializationHelper.Serialize(this);SerializationHelper.AppendSerializedAnimations(this,serializationObject);return serializationObject;}}],[{key:"WhenAllReady",value:function WhenAllReady(textures,callback){var numRemaining=textures.length;if(numRemaining===0){callback();return;}for(var i=0;i<textures.length;i++){var texture=textures[i];if(texture.isReady()){if(--numRemaining===0){callback();}}else{var onLoadObservable=texture.onLoadObservable;if(onLoadObservable){onLoadObservable.addOnce(function(){if(--numRemaining===0){callback();}});}else{if(--numRemaining===0){callback();}}}}}},{key:"_IsScene",value:function _IsScene(sceneOrEngine){return sceneOrEngine.getClassName()==="Scene";}}]);return BaseTexture;}(ThinTexture);BaseTexture.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4;__decorate([serialize()],BaseTexture.prototype,"uniqueId",void 0);__decorate([serialize()],BaseTexture.prototype,"name",void 0);__decorate([serialize()],BaseTexture.prototype,"metadata",void 0);__decorate([serialize("hasAlpha")],BaseTexture.prototype,"_hasAlpha",void 0);__decorate([serialize("getAlphaFromRGB")],BaseTexture.prototype,"_getAlphaFromRGB",void 0);__decorate([serialize()],BaseTexture.prototype,"level",void 0);__decorate([serialize("coordinatesIndex")],BaseTexture.prototype,"_coordinatesIndex",void 0);__decorate([serialize()],BaseTexture.prototype,"optimizeUVAllocation",void 0);__decorate([serialize("coordinatesMode")],BaseTexture.prototype,"_coordinatesMode",void 0);__decorate([serialize()],BaseTexture.prototype,"wrapU",null);__decorate([serialize()],BaseTexture.prototype,"wrapV",null);__decorate([serialize()],BaseTexture.prototype,"wrapR",void 0);__decorate([serialize()],BaseTexture.prototype,"anisotropicFilteringLevel",void 0);__decorate([serialize()],BaseTexture.prototype,"isCube",null);__decorate([serialize()],BaseTexture.prototype,"is3D",null);__decorate([serialize()],BaseTexture.prototype,"is2DArray",null);__decorate([serialize()],BaseTexture.prototype,"gammaSpace",null);__decorate([serialize()],BaseTexture.prototype,"invertZ",void 0);__decorate([serialize()],BaseTexture.prototype,"lodLevelInAlpha",void 0);__decorate([serialize()],BaseTexture.prototype,"lodGenerationOffset",null);__decorate([serialize()],BaseTexture.prototype,"lodGenerationScale",null);__decorate([serialize()],BaseTexture.prototype,"linearSpecularLOD",null);__decorate([serializeAsTexture()],BaseTexture.prototype,"irradianceTexture",null);__decorate([serialize()],BaseTexture.prototype,"isRenderTarget",void 0);// node_modules/@babylonjs/core/Misc/copyTools.js
function GenerateBase64StringFromPixelData(pixels,size){var invertY=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var width=size.width;var height=size.height;if(pixels instanceof Float32Array){var len=pixels.byteLength/pixels.BYTES_PER_ELEMENT;var npixels=new Uint8Array(len);while(--len>=0){var val=pixels[len];if(val<0){val=0;}else if(val>1){val=1;}npixels[len]=val*255;}pixels=npixels;}var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var ctx=canvas.getContext("2d");if(!ctx){return null;}var imageData=ctx.createImageData(width,height);var castData=imageData.data;castData.set(pixels);ctx.putImageData(imageData,0,0);if(invertY){var canvas2=document.createElement("canvas");canvas2.width=width;canvas2.height=height;var ctx2=canvas2.getContext("2d");if(!ctx2){return null;}ctx2.translate(0,height);ctx2.scale(1,-1);ctx2.drawImage(canvas,0,0);return canvas2.toDataURL("image/png");}return canvas.toDataURL("image/png");}function GenerateBase64StringFromTexture(texture){var faceIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var level=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var internalTexture=texture.getInternalTexture();if(!internalTexture){return null;}var pixels=texture._readPixelsSync(faceIndex,level);if(!pixels){return null;}return GenerateBase64StringFromPixelData(pixels,texture.getSize(),internalTexture.invertY);}function GenerateBase64StringFromTextureAsync(_x8){return _GenerateBase64StringFromTextureAsync.apply(this,arguments);}// node_modules/@babylonjs/core/Materials/Textures/texture.js
function _GenerateBase64StringFromTextureAsync(){_GenerateBase64StringFromTextureAsync=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee28(texture){var faceIndex,level,internalTexture,pixels,_args29=arguments;return _regeneratorRuntime().wrap(function _callee28$(_context28){while(1)switch(_context28.prev=_context28.next){case 0:faceIndex=_args29.length>1&&_args29[1]!==undefined?_args29[1]:0;level=_args29.length>2&&_args29[2]!==undefined?_args29[2]:0;internalTexture=texture.getInternalTexture();if(internalTexture){_context28.next=5;break;}return _context28.abrupt("return",null);case 5:_context28.next=7;return texture.readPixels(faceIndex,level);case 7:pixels=_context28.sent;if(pixels){_context28.next=10;break;}return _context28.abrupt("return",null);case 10:return _context28.abrupt("return",GenerateBase64StringFromPixelData(pixels,texture.getSize(),internalTexture.invertY));case 11:case"end":return _context28.stop();}},_callee28);}));return _GenerateBase64StringFromTextureAsync.apply(this,arguments);}var Texture=/*#__PURE__*/function(_BaseTexture){_inherits(Texture,_BaseTexture);var _super36=_createSuper(Texture);function Texture(url,sceneOrEngine,noMipmapOrOptions,invertY){var _this126;var samplingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Texture.TRILINEAR_SAMPLINGMODE;var onLoad=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onError=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var buffer=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var deleteBuffer=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var format=arguments.length>9?arguments[9]:undefined;var mimeType=arguments.length>10?arguments[10]:undefined;var loaderOptions=arguments.length>11?arguments[11]:undefined;var creationFlags=arguments.length>12?arguments[12]:undefined;var forcedExtension=arguments.length>13?arguments[13]:undefined;_classCallCheck(this,Texture);var _a,_b,_c,_d,_e,_f,_g,_h,_j;_this126=_super36.call(this,sceneOrEngine);_this126.url=null;_this126.uOffset=0;_this126.vOffset=0;_this126.uScale=1;_this126.vScale=1;_this126.uAng=0;_this126.vAng=0;_this126.wAng=0;_this126.uRotationCenter=0.5;_this126.vRotationCenter=0.5;_this126.wRotationCenter=0.5;_this126.homogeneousRotationInUVTransform=false;_this126.inspectableCustomProperties=null;_this126._noMipmap=false;_this126._invertY=false;_this126._rowGenerationMatrix=null;_this126._cachedTextureMatrix=null;_this126._projectionModeMatrix=null;_this126._t0=null;_this126._t1=null;_this126._t2=null;_this126._cachedUOffset=-1;_this126._cachedVOffset=-1;_this126._cachedUScale=0;_this126._cachedVScale=0;_this126._cachedUAng=-1;_this126._cachedVAng=-1;_this126._cachedWAng=-1;_this126._cachedReflectionProjectionMatrixId=-1;_this126._cachedURotationCenter=-1;_this126._cachedVRotationCenter=-1;_this126._cachedWRotationCenter=-1;_this126._cachedHomogeneousRotationInUVTransform=false;_this126._cachedReflectionTextureMatrix=null;_this126._cachedReflectionUOffset=-1;_this126._cachedReflectionVOffset=-1;_this126._cachedReflectionUScale=0;_this126._cachedReflectionVScale=0;_this126._cachedReflectionCoordinatesMode=-1;_this126._buffer=null;_this126._deleteBuffer=false;_this126._format=null;_this126._delayedOnLoad=null;_this126._delayedOnError=null;_this126.onLoadObservable=new Observable();_this126._isBlocking=true;_this126.name=url||"";_this126.url=url;var noMipmap;var useSRGBBuffer=false;var internalTexture=null;if(_typeof(noMipmapOrOptions)==="object"&&noMipmapOrOptions!==null){noMipmap=(_a=noMipmapOrOptions.noMipmap)!==null&&_a!==void 0?_a:false;invertY=(_b=noMipmapOrOptions.invertY)!==null&&_b!==void 0?_b:CompatibilityOptions.UseOpenGLOrientationForUV?false:true;samplingMode=(_c=noMipmapOrOptions.samplingMode)!==null&&_c!==void 0?_c:Texture.TRILINEAR_SAMPLINGMODE;onLoad=(_d=noMipmapOrOptions.onLoad)!==null&&_d!==void 0?_d:null;onError=(_e=noMipmapOrOptions.onError)!==null&&_e!==void 0?_e:null;buffer=(_f=noMipmapOrOptions.buffer)!==null&&_f!==void 0?_f:null;deleteBuffer=(_g=noMipmapOrOptions.deleteBuffer)!==null&&_g!==void 0?_g:false;format=noMipmapOrOptions.format;mimeType=noMipmapOrOptions.mimeType;loaderOptions=noMipmapOrOptions.loaderOptions;creationFlags=noMipmapOrOptions.creationFlags;useSRGBBuffer=(_h=noMipmapOrOptions.useSRGBBuffer)!==null&&_h!==void 0?_h:false;internalTexture=(_j=noMipmapOrOptions.internalTexture)!==null&&_j!==void 0?_j:null;}else{noMipmap=!!noMipmapOrOptions;}_this126._noMipmap=noMipmap;_this126._invertY=invertY===void 0?CompatibilityOptions.UseOpenGLOrientationForUV?false:true:invertY;_this126._initialSamplingMode=samplingMode;_this126._buffer=buffer;_this126._deleteBuffer=deleteBuffer;_this126._mimeType=mimeType;_this126._loaderOptions=loaderOptions;_this126._creationFlags=creationFlags;_this126._useSRGBBuffer=useSRGBBuffer;_this126._forcedExtension=forcedExtension;if(format){_this126._format=format;}var scene2=_this126.getScene();var engine=_this126._getEngine();if(!engine){return _possibleConstructorReturn(_this126);}engine.onBeforeTextureInitObservable.notifyObservers(_assertThisInitialized(_this126));var load=function load(){if(_this126._texture){if(_this126._texture._invertVScale){_this126.vScale*=-1;_this126.vOffset+=1;}if(_this126._texture._cachedWrapU!==null){_this126.wrapU=_this126._texture._cachedWrapU;_this126._texture._cachedWrapU=null;}if(_this126._texture._cachedWrapV!==null){_this126.wrapV=_this126._texture._cachedWrapV;_this126._texture._cachedWrapV=null;}if(_this126._texture._cachedWrapR!==null){_this126.wrapR=_this126._texture._cachedWrapR;_this126._texture._cachedWrapR=null;}}if(_this126.onLoadObservable.hasObservers()){_this126.onLoadObservable.notifyObservers(_assertThisInitialized(_this126));}if(onLoad){onLoad();}if(!_this126.isBlocking&&scene2){scene2.resetCachedMaterial();}};var errorHandler=function errorHandler(message,exception){_this126._loadingError=true;_this126._errorObject={message:message,exception:exception};if(onError){onError(message,exception);}Texture.OnTextureLoadErrorObservable.notifyObservers(_assertThisInitialized(_this126));};if(!_this126.url&&!internalTexture){_this126._delayedOnLoad=load;_this126._delayedOnError=errorHandler;return _possibleConstructorReturn(_this126);}_this126._texture=internalTexture!==null&&internalTexture!==void 0?internalTexture:_this126._getFromCache(_this126.url,noMipmap,samplingMode,_this126._invertY,useSRGBBuffer);if(!_this126._texture){if(!scene2||!scene2.useDelayedTextureLoading){try{_this126._texture=engine.createTexture(_this126.url,noMipmap,_this126._invertY,scene2,samplingMode,load,errorHandler,_this126._buffer,void 0,_this126._format,_this126._forcedExtension,mimeType,loaderOptions,creationFlags,useSRGBBuffer);}catch(e){errorHandler("error loading",e);throw e;}if(deleteBuffer){_this126._buffer=null;}}else{_this126.delayLoadState=4;_this126._delayedOnLoad=load;_this126._delayedOnError=errorHandler;}}else{if(_this126._texture.isReady){TimingTools.SetImmediate(function(){return load();});}else{var loadObserver=_this126._texture.onLoadedObservable.add(load);_this126._texture.onErrorObservable.add(function(e){var _a2;errorHandler(e.message,e.exception);(_a2=_this126._texture)===null||_a2===void 0?void 0:_a2.onLoadedObservable.remove(loadObserver);});}}return _this126;}_createClass(Texture,[{key:"noMipmap",get:function get(){return this._noMipmap;}},{key:"mimeType",get:function get(){return this._mimeType;}},{key:"isBlocking",get:function get(){return this._isBlocking;},set:function set(value){this._isBlocking=value;}},{key:"invertY",get:function get(){return this._invertY;}},{key:"updateURL",value:function updateURL(url){var buffer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var onLoad=arguments.length>2?arguments[2]:undefined;var forcedExtension=arguments.length>3?arguments[3]:undefined;if(this.url){this.releaseInternalTexture();this.getScene().markAllMaterialsAsDirty(1);}if(!this.name||this.name.startsWith("data:")){this.name=url;}this.url=url;this._buffer=buffer;this._forcedExtension=forcedExtension;this.delayLoadState=4;if(onLoad){this._delayedOnLoad=onLoad;}this.delayLoad();}},{key:"delayLoad",value:function delayLoad(){if(this.delayLoadState!==4){return;}var scene2=this.getScene();if(!scene2){return;}this.delayLoadState=1;this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer);if(!this._texture){this._texture=scene2.getEngine().createTexture(this.url,this._noMipmap,this._invertY,scene2,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer);if(this._deleteBuffer){this._buffer=null;}}else{if(this._delayedOnLoad){if(this._texture.isReady){TimingTools.SetImmediate(this._delayedOnLoad);}else{this._texture.onLoadedObservable.add(this._delayedOnLoad);}}}this._delayedOnLoad=null;this._delayedOnError=null;}},{key:"_prepareRowForTextureGeneration",value:function _prepareRowForTextureGeneration(x,y,z,t){x*=this._cachedUScale;y*=this._cachedVScale;x-=this.uRotationCenter*this._cachedUScale;y-=this.vRotationCenter*this._cachedVScale;z-=this.wRotationCenter;Vector3.TransformCoordinatesFromFloatsToRef(x,y,z,this._rowGenerationMatrix,t);t.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset;t.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset;t.z+=this.wRotationCenter;}},{key:"checkTransformsAreIdentical",value:function checkTransformsAreIdentical(texture){return texture!==null&&this.uOffset===texture.uOffset&&this.vOffset===texture.vOffset&&this.uScale===texture.uScale&&this.vScale===texture.vScale&&this.uAng===texture.uAng&&this.vAng===texture.vAng&&this.wAng===texture.wAng;}},{key:"getTextureMatrix",value:function getTextureMatrix(){var _this127=this;var uBase=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*uBase===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform){return this._cachedTextureMatrix;}this._cachedUOffset=this.uOffset;this._cachedVOffset=this.vOffset;this._cachedUScale=this.uScale*uBase;this._cachedVScale=this.vScale;this._cachedUAng=this.uAng;this._cachedVAng=this.vAng;this._cachedWAng=this.wAng;this._cachedURotationCenter=this.uRotationCenter;this._cachedVRotationCenter=this.vRotationCenter;this._cachedWRotationCenter=this.wRotationCenter;this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform;if(!this._cachedTextureMatrix||!this._rowGenerationMatrix){this._cachedTextureMatrix=Matrix.Zero();this._rowGenerationMatrix=new Matrix();this._t0=Vector3.Zero();this._t1=Vector3.Zero();this._t2=Vector3.Zero();}Matrix.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix);if(this.homogeneousRotationInUVTransform){Matrix.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,TmpVectors.Matrix[0]);Matrix.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,TmpVectors.Matrix[1]);Matrix.ScalingToRef(this._cachedUScale,this._cachedVScale,0,TmpVectors.Matrix[2]);Matrix.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,TmpVectors.Matrix[3]);TmpVectors.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix);this._cachedTextureMatrix.multiplyToRef(TmpVectors.Matrix[1],this._cachedTextureMatrix);this._cachedTextureMatrix.multiplyToRef(TmpVectors.Matrix[2],this._cachedTextureMatrix);this._cachedTextureMatrix.multiplyToRef(TmpVectors.Matrix[3],this._cachedTextureMatrix);this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1);}else{this._prepareRowForTextureGeneration(0,0,0,this._t0);this._prepareRowForTextureGeneration(1,0,0,this._t1);this._prepareRowForTextureGeneration(0,1,0,this._t2);this._t1.subtractInPlace(this._t0);this._t2.subtractInPlace(this._t0);Matrix.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix);}var scene2=this.getScene();if(!scene2){return this._cachedTextureMatrix;}if(this.optimizeUVAllocation){scene2.markAllMaterialsAsDirty(1,function(mat){return mat.hasTexture(_this127);});}return this._cachedTextureMatrix;}},{key:"getReflectionTextureMatrix",value:function getReflectionTextureMatrix(){var _this128=this;var scene2=this.getScene();if(!scene2){return this._cachedReflectionTextureMatrix;}if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode===Texture.PROJECTION_MODE){if(this._cachedReflectionProjectionMatrixId===scene2.getProjectionMatrix().updateFlag){return this._cachedReflectionTextureMatrix;}}else{return this._cachedReflectionTextureMatrix;}}if(!this._cachedReflectionTextureMatrix){this._cachedReflectionTextureMatrix=Matrix.Zero();}if(!this._projectionModeMatrix){this._projectionModeMatrix=Matrix.Zero();}var flagMaterialsAsTextureDirty=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;this._cachedReflectionUOffset=this.uOffset;this._cachedReflectionVOffset=this.vOffset;this._cachedReflectionUScale=this.uScale;this._cachedReflectionVScale=this.vScale;this._cachedReflectionCoordinatesMode=this.coordinatesMode;switch(this.coordinatesMode){case Texture.PLANAR_MODE:{Matrix.IdentityToRef(this._cachedReflectionTextureMatrix);this._cachedReflectionTextureMatrix[0]=this.uScale;this._cachedReflectionTextureMatrix[5]=this.vScale;this._cachedReflectionTextureMatrix[12]=this.uOffset;this._cachedReflectionTextureMatrix[13]=this.vOffset;break;}case Texture.PROJECTION_MODE:{Matrix.FromValuesToRef(0.5,0,0,0,0,-0.5,0,0,0,0,0,0,0.5,0.5,1,1,this._projectionModeMatrix);var projectionMatrix=scene2.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=projectionMatrix.updateFlag;projectionMatrix.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break;}default:Matrix.IdentityToRef(this._cachedReflectionTextureMatrix);break;}if(flagMaterialsAsTextureDirty){scene2.markAllMaterialsAsDirty(1,function(mat){return mat.getActiveTextures().indexOf(_this128)!==-1;});}return this._cachedReflectionTextureMatrix;}},{key:"clone",value:function clone(){var _this129=this;var options={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return SerializationHelper.Clone(function(){return new Texture(_this129._texture?_this129._texture.url:null,_this129.getScene(),options);},this);}},{key:"serialize",value:function serialize(){var _a,_b;var savedName=this.name;if(!Texture.SerializeBuffers){if(this.name.startsWith("data:")){this.name="";}}if(this.name.startsWith("data:")&&this.url===this.name){this.url="";}var serializationObject=_get(_getPrototypeOf(Texture.prototype),"serialize",this).call(this,Texture._SerializeInternalTextureUniqueId);if(!serializationObject){return null;}if(Texture.SerializeBuffers||Texture.ForceSerializeBuffers){if(typeof this._buffer==="string"&&this._buffer.substr(0,5)==="data:"){serializationObject.base64String=this._buffer;serializationObject.name=serializationObject.name.replace("data:","");}else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){serializationObject.base64String="data:image/png;base64,"+EncodeArrayBufferToBase64(this._buffer);}else if(Texture.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize){serializationObject.base64String=!this._engine||this._engine._features.supportSyncTextureRead?GenerateBase64StringFromTexture(this):GenerateBase64StringFromTextureAsync(this);}}serializationObject.invertY=this._invertY;serializationObject.samplingMode=this.samplingMode;serializationObject._creationFlags=this._creationFlags;serializationObject._useSRGBBuffer=this._useSRGBBuffer;if(Texture._SerializeInternalTextureUniqueId){serializationObject.internalTextureUniqueId=(_b=(_a=this._texture)===null||_a===void 0?void 0:_a.uniqueId)!==null&&_b!==void 0?_b:void 0;}this.name=savedName;return serializationObject;}},{key:"getClassName",value:function getClassName(){return"Texture";}},{key:"dispose",value:function dispose(){_get(_getPrototypeOf(Texture.prototype),"dispose",this).call(this);this.onLoadObservable.clear();this._delayedOnLoad=null;this._delayedOnError=null;this._buffer=null;}}],[{key:"Parse",value:function Parse(parsedTexture,scene2,rootUrl){if(parsedTexture.customType){var customTexture=InstantiationTools.Instantiate(parsedTexture.customType);var parsedCustomTexture=customTexture.Parse(parsedTexture,scene2,rootUrl);if(parsedTexture.samplingMode&&parsedCustomTexture.updateSamplingMode&&parsedCustomTexture._samplingMode){if(parsedCustomTexture._samplingMode!==parsedTexture.samplingMode){parsedCustomTexture.updateSamplingMode(parsedTexture.samplingMode);}}return parsedCustomTexture;}if(parsedTexture.isCube&&!parsedTexture.isRenderTarget){return Texture._CubeTextureParser(parsedTexture,scene2,rootUrl);}var hasInternalTextureUniqueId=parsedTexture.internalTextureUniqueId!==void 0;if(!parsedTexture.name&&!parsedTexture.isRenderTarget&&!hasInternalTextureUniqueId){return null;}var internalTexture;if(hasInternalTextureUniqueId){var cache=scene2.getEngine().getLoadedTexturesCache();var _iterator166=_createForOfIteratorHelper(cache),_step176;try{for(_iterator166.s();!(_step176=_iterator166.n()).done;){var texture2=_step176.value;if(texture2.uniqueId===parsedTexture.internalTextureUniqueId){internalTexture=texture2;break;}}}catch(err){_iterator166.e(err);}finally{_iterator166.f();}}var onLoaded=function onLoaded(texture2){var _a;if(texture2&&texture2._texture){texture2._texture._cachedWrapU=null;texture2._texture._cachedWrapV=null;texture2._texture._cachedWrapR=null;}if(parsedTexture.samplingMode){var sampling=parsedTexture.samplingMode;if(texture2&&texture2.samplingMode!==sampling){texture2.updateSamplingMode(sampling);}}if(texture2&&parsedTexture.animations){for(var animationIndex=0;animationIndex<parsedTexture.animations.length;animationIndex++){var parsedAnimation=parsedTexture.animations[animationIndex];var internalClass=GetClass("BABYLON.Animation");if(internalClass){texture2.animations.push(internalClass.Parse(parsedAnimation));}}}if(hasInternalTextureUniqueId&&!internalTexture){(_a=texture2===null||texture2===void 0?void 0:texture2._texture)===null||_a===void 0?void 0:_a._setUniqueId(parsedTexture.internalTextureUniqueId);}};var texture=SerializationHelper.Parse(function(){var _a,_b,_c;var generateMipMaps=true;if(parsedTexture.noMipmap){generateMipMaps=false;}if(parsedTexture.mirrorPlane){var mirrorTexture=Texture._CreateMirror(parsedTexture.name,parsedTexture.renderTargetSize,scene2,generateMipMaps);mirrorTexture._waitingRenderList=parsedTexture.renderList;mirrorTexture.mirrorPlane=Plane.FromArray(parsedTexture.mirrorPlane);onLoaded(mirrorTexture);return mirrorTexture;}else if(parsedTexture.isRenderTarget){var renderTargetTexture=null;if(parsedTexture.isCube){if(scene2.reflectionProbes){for(var index=0;index<scene2.reflectionProbes.length;index++){var probe=scene2.reflectionProbes[index];if(probe.name===parsedTexture.name){return probe.cubeTexture;}}}}else{renderTargetTexture=Texture._CreateRenderTargetTexture(parsedTexture.name,parsedTexture.renderTargetSize,scene2,generateMipMaps,(_a=parsedTexture._creationFlags)!==null&&_a!==void 0?_a:0);renderTargetTexture._waitingRenderList=parsedTexture.renderList;}onLoaded(renderTargetTexture);return renderTargetTexture;}else{var _texture;if(parsedTexture.base64String&&!internalTexture){_texture=Texture.CreateFromBase64String(parsedTexture.base64String,parsedTexture.base64String,scene2,!generateMipMaps,parsedTexture.invertY,parsedTexture.samplingMode,function(){onLoaded(_texture);},(_b=parsedTexture._creationFlags)!==null&&_b!==void 0?_b:0,(_c=parsedTexture._useSRGBBuffer)!==null&&_c!==void 0?_c:false);_texture.name=parsedTexture.name;}else{var url;if(parsedTexture.name&&parsedTexture.name.indexOf("://")>0){url=parsedTexture.name;}else{url=rootUrl+parsedTexture.name;}if(parsedTexture.url&&(parsedTexture.url.startsWith("data:")||Texture.UseSerializedUrlIfAny)){url=parsedTexture.url;}var options={noMipmap:!generateMipMaps,invertY:parsedTexture.invertY,samplingMode:parsedTexture.samplingMode,onLoad:function onLoad(){onLoaded(_texture);},internalTexture:internalTexture};_texture=new Texture(url,scene2,options);}return _texture;}},parsedTexture,scene2);return texture;}},{key:"CreateFromBase64String",value:function CreateFromBase64String(data,name135,scene2,noMipmapOrOptions,invertY){var samplingMode=arguments.length>5&&arguments[5]!==undefined?arguments[5]:Texture.TRILINEAR_SAMPLINGMODE;var onLoad=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var onError=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var format=arguments.length>8&&arguments[8]!==undefined?arguments[8]:5;var creationFlags=arguments.length>9?arguments[9]:undefined;return new Texture("data:"+name135,scene2,noMipmapOrOptions,invertY,samplingMode,onLoad,onError,data,false,format,void 0,void 0,creationFlags);}},{key:"LoadFromDataString",value:function LoadFromDataString(name135,buffer,scene2){var deleteBuffer=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var noMipmapOrOptions=arguments.length>4?arguments[4]:undefined;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Texture.TRILINEAR_SAMPLINGMODE;var onLoad=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var onError=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var format=arguments.length>9&&arguments[9]!==undefined?arguments[9]:5;var creationFlags=arguments.length>10?arguments[10]:undefined;if(name135.substr(0,5)!=="data:"){name135="data:"+name135;}return new Texture(name135,scene2,noMipmapOrOptions,invertY,samplingMode,onLoad,onError,buffer,deleteBuffer,format,void 0,void 0,creationFlags);}}]);return Texture;}(BaseTexture);Texture.SerializeBuffers=true;Texture.ForceSerializeBuffers=false;Texture.OnTextureLoadErrorObservable=new Observable();Texture._SerializeInternalTextureUniqueId=false;Texture._CubeTextureParser=function(jsonTexture,scene2,rootUrl){throw _WarnImport("CubeTexture");};Texture._CreateMirror=function(name135,renderTargetSize,scene2,generateMipMaps){throw _WarnImport("MirrorTexture");};Texture._CreateRenderTargetTexture=function(name135,renderTargetSize,scene2,generateMipMaps,creationFlags){throw _WarnImport("RenderTargetTexture");};Texture.NEAREST_SAMPLINGMODE=1;Texture.NEAREST_NEAREST_MIPLINEAR=8;Texture.BILINEAR_SAMPLINGMODE=2;Texture.LINEAR_LINEAR_MIPNEAREST=11;Texture.TRILINEAR_SAMPLINGMODE=3;Texture.LINEAR_LINEAR_MIPLINEAR=3;Texture.NEAREST_NEAREST_MIPNEAREST=4;Texture.NEAREST_LINEAR_MIPNEAREST=5;Texture.NEAREST_LINEAR_MIPLINEAR=6;Texture.NEAREST_LINEAR=7;Texture.NEAREST_NEAREST=1;Texture.LINEAR_NEAREST_MIPNEAREST=9;Texture.LINEAR_NEAREST_MIPLINEAR=10;Texture.LINEAR_LINEAR=2;Texture.LINEAR_NEAREST=12;Texture.EXPLICIT_MODE=0;Texture.SPHERICAL_MODE=1;Texture.PLANAR_MODE=2;Texture.CUBIC_MODE=3;Texture.PROJECTION_MODE=4;Texture.SKYBOX_MODE=5;Texture.INVCUBIC_MODE=6;Texture.EQUIRECTANGULAR_MODE=7;Texture.FIXED_EQUIRECTANGULAR_MODE=8;Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;Texture.CLAMP_ADDRESSMODE=0;Texture.WRAP_ADDRESSMODE=1;Texture.MIRROR_ADDRESSMODE=2;Texture.UseSerializedUrlIfAny=false;__decorate([serialize()],Texture.prototype,"url",void 0);__decorate([serialize()],Texture.prototype,"uOffset",void 0);__decorate([serialize()],Texture.prototype,"vOffset",void 0);__decorate([serialize()],Texture.prototype,"uScale",void 0);__decorate([serialize()],Texture.prototype,"vScale",void 0);__decorate([serialize()],Texture.prototype,"uAng",void 0);__decorate([serialize()],Texture.prototype,"vAng",void 0);__decorate([serialize()],Texture.prototype,"wAng",void 0);__decorate([serialize()],Texture.prototype,"uRotationCenter",void 0);__decorate([serialize()],Texture.prototype,"vRotationCenter",void 0);__decorate([serialize()],Texture.prototype,"wRotationCenter",void 0);__decorate([serialize()],Texture.prototype,"homogeneousRotationInUVTransform",void 0);__decorate([serialize()],Texture.prototype,"isBlocking",null);RegisterClass("BABYLON.Texture",Texture);SerializationHelper._TextureParser=Texture.Parse;// node_modules/@babylonjs/core/Engines/Extensions/engine.rawTexture.js
ThinEngine.prototype.updateRawTexture=function(texture,data,format,invertY){var compression=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var type=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var useSRGBBuffer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(!texture){return;}var internalSizedFomat=this._getRGBABufferInternalSizedFormat(type,format,useSRGBBuffer);var internalFormat=this._getInternalFormat(format);var textureType=this._getWebGLTextureType(type);this._bindTextureDirectly(this._gl.TEXTURE_2D,texture,true);this._unpackFlipY(invertY===void 0?true:invertY?true:false);if(!this._doNotHandleContextLost){texture._bufferView=data;texture.format=format;texture.type=type;texture.invertY=invertY;texture._compression=compression;}if(texture.width%4!==0){this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1);}if(compression&&data){this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[compression],texture.width,texture.height,0,data);}else{this._gl.texImage2D(this._gl.TEXTURE_2D,0,internalSizedFomat,texture.width,texture.height,0,internalFormat,textureType,data);}if(texture.generateMipMaps){this._gl.generateMipmap(this._gl.TEXTURE_2D);}this._bindTextureDirectly(this._gl.TEXTURE_2D,null);texture.isReady=true;};ThinEngine.prototype.createRawTexture=function(data,width,height,format,generateMipMaps,invertY,samplingMode){var compression=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var type=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var creationFlags=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var useSRGBBuffer=arguments.length>10&&arguments[10]!==undefined?arguments[10]:false;var texture=new InternalTexture(this,InternalTextureSource.Raw);texture.baseWidth=width;texture.baseHeight=height;texture.width=width;texture.height=height;texture.format=format;texture.generateMipMaps=generateMipMaps;texture.samplingMode=samplingMode;texture.invertY=invertY;texture._compression=compression;texture.type=type;texture._useSRGBBuffer=this._getUseSRGBBuffer(useSRGBBuffer,!generateMipMaps);if(!this._doNotHandleContextLost){texture._bufferView=data;}this.updateRawTexture(texture,data,format,invertY,compression,type,texture._useSRGBBuffer);this._bindTextureDirectly(this._gl.TEXTURE_2D,texture,true);var filters2=this._getSamplingParameters(samplingMode,generateMipMaps);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,filters2.mag);this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,filters2.min);if(generateMipMaps){this._gl.generateMipmap(this._gl.TEXTURE_2D);}this._bindTextureDirectly(this._gl.TEXTURE_2D,null);this._internalTexturesCache.push(texture);return texture;};ThinEngine.prototype.createRawCubeTexture=function(data,size,format,type,generateMipMaps,invertY,samplingMode){var compression=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var gl=this._gl;var texture=new InternalTexture(this,InternalTextureSource.CubeRaw);texture.isCube=true;texture.format=format;texture.type=type;if(!this._doNotHandleContextLost){texture._bufferViewArray=data;}var textureType=this._getWebGLTextureType(type);var internalFormat=this._getInternalFormat(format);if(internalFormat===gl.RGB){internalFormat=gl.RGBA;}if(textureType===gl.FLOAT&&!this._caps.textureFloatLinearFiltering){generateMipMaps=false;samplingMode=1;Logger.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.");}else if(textureType===this._gl.HALF_FLOAT_OES&&!this._caps.textureHalfFloatLinearFiltering){generateMipMaps=false;samplingMode=1;Logger.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.");}else if(textureType===gl.FLOAT&&!this._caps.textureFloatRender){generateMipMaps=false;Logger.Warn("Render to float textures is not supported. Mipmap generation forced to false.");}else if(textureType===gl.HALF_FLOAT&&!this._caps.colorBufferFloat){generateMipMaps=false;Logger.Warn("Render to half float textures is not supported. Mipmap generation forced to false.");}var width=size;var height=width;texture.width=width;texture.height=height;texture.invertY=invertY;texture._compression=compression;var isPot=!this.needPOTTextures||Tools.IsExponentOfTwo(texture.width)&&Tools.IsExponentOfTwo(texture.height);if(!isPot){generateMipMaps=false;}if(data){this.updateRawCubeTexture(texture,data,format,type,invertY,compression);}else{var internalSizedFomat=this._getRGBABufferInternalSizedFormat(type);var level=0;this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);for(var faceIndex=0;faceIndex<6;faceIndex++){if(compression){gl.compressedTexImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,level,this.getCaps().s3tc[compression],texture.width,texture.height,0,void 0);}else{gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,level,internalSizedFomat,texture.width,texture.height,0,internalFormat,textureType,null);}}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null);}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,texture,true);if(data&&generateMipMaps){this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);}var filters2=this._getSamplingParameters(samplingMode,generateMipMaps);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,filters2.mag);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,filters2.min);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);texture.generateMipMaps=generateMipMaps;texture.samplingMode=samplingMode;texture.isReady=true;return texture;};ThinEngine.prototype.updateRawCubeTexture=function(texture,data,format,type,invertY){var compression=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var level=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;texture._bufferViewArray=data;texture.format=format;texture.type=type;texture.invertY=invertY;texture._compression=compression;var gl=this._gl;var textureType=this._getWebGLTextureType(type);var internalFormat=this._getInternalFormat(format);var internalSizedFomat=this._getRGBABufferInternalSizedFormat(type);var needConversion=false;if(internalFormat===gl.RGB){internalFormat=gl.RGBA;needConversion=true;}this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);this._unpackFlipY(invertY===void 0?true:invertY?true:false);if(texture.width%4!==0){gl.pixelStorei(gl.UNPACK_ALIGNMENT,1);}for(var faceIndex=0;faceIndex<6;faceIndex++){var faceData=data[faceIndex];if(compression){gl.compressedTexImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,level,this.getCaps().s3tc[compression],texture.width,texture.height,0,faceData);}else{if(needConversion){faceData=_convertRGBtoRGBATextureData(faceData,texture.width,texture.height,type);}gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex,level,internalSizedFomat,texture.width,texture.height,0,internalFormat,textureType,faceData);}}var isPot=!this.needPOTTextures||Tools.IsExponentOfTwo(texture.width)&&Tools.IsExponentOfTwo(texture.height);if(isPot&&texture.generateMipMaps&&level===0){this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null);texture.isReady=true;};ThinEngine.prototype.createRawCubeTextureFromUrl=function(url,scene2,size,format,type,noMipmap,callback,mipmapGenerator){var _this130=this;var onLoad=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var onError=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;var samplingMode=arguments.length>10&&arguments[10]!==undefined?arguments[10]:3;var invertY=arguments.length>11&&arguments[11]!==undefined?arguments[11]:false;var gl=this._gl;var texture=this.createRawCubeTexture(null,size,format,type,!noMipmap,invertY,samplingMode,null);scene2===null||scene2===void 0?void 0:scene2.addPendingData(texture);texture.url=url;this._internalTexturesCache.push(texture);var onerror=function onerror(request,exception){scene2===null||scene2===void 0?void 0:scene2.removePendingData(texture);if(onError&&request){onError(request.status+" "+request.statusText,exception);}};var internalCallback=function internalCallback(data){var width=texture.width;var faceDataArrays=callback(data);if(!faceDataArrays){return;}if(mipmapGenerator){var textureType=_this130._getWebGLTextureType(type);var internalFormat=_this130._getInternalFormat(format);var internalSizedFomat=_this130._getRGBABufferInternalSizedFormat(type);var needConversion=false;if(internalFormat===gl.RGB){internalFormat=gl.RGBA;needConversion=true;}_this130._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);_this130._unpackFlipY(false);var mipData=mipmapGenerator(faceDataArrays);for(var level=0;level<mipData.length;level++){var mipSize=width>>level;for(var faceIndex=0;faceIndex<6;faceIndex++){var mipFaceData=mipData[level][faceIndex];if(needConversion){mipFaceData=_convertRGBtoRGBATextureData(mipFaceData,mipSize,mipSize,type);}gl.texImage2D(faceIndex,level,internalSizedFomat,mipSize,mipSize,0,internalFormat,textureType,mipFaceData);}}_this130._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);}else{_this130.updateRawCubeTexture(texture,faceDataArrays,format,type,invertY);}texture.isReady=true;scene2===null||scene2===void 0?void 0:scene2.removePendingData(texture);texture.onLoadedObservable.notifyObservers(texture);texture.onLoadedObservable.clear();if(onLoad){onLoad();}};this._loadFile(url,function(data){internalCallback(data);},void 0,scene2===null||scene2===void 0?void 0:scene2.offlineProvider,true,onerror);return texture;};function _convertRGBtoRGBATextureData(rgbData,width,height,textureType){var rgbaData;var val1=1;if(textureType===1){rgbaData=new Float32Array(width*height*4);}else if(textureType===2){rgbaData=new Uint16Array(width*height*4);val1=15360;}else if(textureType===7){rgbaData=new Uint32Array(width*height*4);}else{rgbaData=new Uint8Array(width*height*4);}for(var x=0;x<width;x++){for(var y=0;y<height;y++){var index=(y*width+x)*3;var newIndex=(y*width+x)*4;rgbaData[newIndex+0]=rgbData[index+0];rgbaData[newIndex+1]=rgbData[index+1];rgbaData[newIndex+2]=rgbData[index+2];rgbaData[newIndex+3]=val1;}}return rgbaData;}function _makeCreateRawTextureFunction(is3D){return function(data,width,height,depth,format,generateMipMaps,invertY,samplingMode){var compression=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;var textureType=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var target=is3D?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY;var source=is3D?InternalTextureSource.Raw3D:InternalTextureSource.Raw2DArray;var texture=new InternalTexture(this,source);texture.baseWidth=width;texture.baseHeight=height;texture.baseDepth=depth;texture.width=width;texture.height=height;texture.depth=depth;texture.format=format;texture.type=textureType;texture.generateMipMaps=generateMipMaps;texture.samplingMode=samplingMode;if(is3D){texture.is3D=true;}else{texture.is2DArray=true;}if(!this._doNotHandleContextLost){texture._bufferView=data;}if(is3D){this.updateRawTexture3D(texture,data,format,invertY,compression,textureType);}else{this.updateRawTexture2DArray(texture,data,format,invertY,compression,textureType);}this._bindTextureDirectly(target,texture,true);var filters2=this._getSamplingParameters(samplingMode,generateMipMaps);this._gl.texParameteri(target,this._gl.TEXTURE_MAG_FILTER,filters2.mag);this._gl.texParameteri(target,this._gl.TEXTURE_MIN_FILTER,filters2.min);if(generateMipMaps){this._gl.generateMipmap(target);}this._bindTextureDirectly(target,null);this._internalTexturesCache.push(texture);return texture;};}ThinEngine.prototype.createRawTexture2DArray=_makeCreateRawTextureFunction(false);ThinEngine.prototype.createRawTexture3D=_makeCreateRawTextureFunction(true);function _makeUpdateRawTextureFunction(is3D){return function(texture,data,format,invertY){var compression=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var textureType=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var target=is3D?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY;var internalType=this._getWebGLTextureType(textureType);var internalFormat=this._getInternalFormat(format);var internalSizedFomat=this._getRGBABufferInternalSizedFormat(textureType,format);this._bindTextureDirectly(target,texture,true);this._unpackFlipY(invertY===void 0?true:invertY?true:false);if(!this._doNotHandleContextLost){texture._bufferView=data;texture.format=format;texture.invertY=invertY;texture._compression=compression;}if(texture.width%4!==0){this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1);}if(compression&&data){this._gl.compressedTexImage3D(target,0,this.getCaps().s3tc[compression],texture.width,texture.height,texture.depth,0,data);}else{this._gl.texImage3D(target,0,internalSizedFomat,texture.width,texture.height,texture.depth,0,internalFormat,internalType,data);}if(texture.generateMipMaps){this._gl.generateMipmap(target);}this._bindTextureDirectly(target,null);texture.isReady=true;};}ThinEngine.prototype.updateRawTexture2DArray=_makeUpdateRawTextureFunction(false);ThinEngine.prototype.updateRawTexture3D=_makeUpdateRawTextureFunction(true);// node_modules/@babylonjs/core/Materials/Textures/rawTexture.js
var RawTexture=/*#__PURE__*/function(_Texture){_inherits(RawTexture,_Texture);var _super37=_createSuper(RawTexture);function RawTexture(data,width,height,format,sceneOrEngine){var _this131;var generateMipMaps=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var invertY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var samplingMode=arguments.length>7&&arguments[7]!==undefined?arguments[7]:3;var type=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var creationFlags=arguments.length>9?arguments[9]:undefined;var useSRGBBuffer=arguments.length>10?arguments[10]:undefined;_classCallCheck(this,RawTexture);_this131=_super37.call(this,null,sceneOrEngine,!generateMipMaps,invertY,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,creationFlags);_this131.format=format;if(!_this131._engine){return _possibleConstructorReturn(_this131);}if(!_this131._engine._caps.textureFloatLinearFiltering&&type===1){samplingMode=1;}if(!_this131._engine._caps.textureHalfFloatLinearFiltering&&type===2){samplingMode=1;}_this131._texture=_this131._engine.createRawTexture(data,width,height,format,generateMipMaps,invertY,samplingMode,null,type,creationFlags!==null&&creationFlags!==void 0?creationFlags:0,useSRGBBuffer!==null&&useSRGBBuffer!==void 0?useSRGBBuffer:false);_this131.wrapU=Texture.CLAMP_ADDRESSMODE;_this131.wrapV=Texture.CLAMP_ADDRESSMODE;return _this131;}_createClass(RawTexture,[{key:"update",value:function update(data){this._getEngine().updateRawTexture(this._texture,data,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer);}}],[{key:"CreateLuminanceTexture",value:function CreateLuminanceTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:3;return new RawTexture(data,width,height,1,sceneOrEngine,generateMipMaps,invertY,samplingMode);}},{key:"CreateLuminanceAlphaTexture",value:function CreateLuminanceAlphaTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:3;return new RawTexture(data,width,height,2,sceneOrEngine,generateMipMaps,invertY,samplingMode);}},{key:"CreateAlphaTexture",value:function CreateAlphaTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:3;return new RawTexture(data,width,height,0,sceneOrEngine,generateMipMaps,invertY,samplingMode);}},{key:"CreateRGBTexture",value:function CreateRGBTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:3;var type=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var creationFlags=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var useSRGBBuffer=arguments.length>9&&arguments[9]!==undefined?arguments[9]:false;return new RawTexture(data,width,height,4,sceneOrEngine,generateMipMaps,invertY,samplingMode,type,creationFlags,useSRGBBuffer);}},{key:"CreateRGBATexture",value:function CreateRGBATexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:3;var type=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var creationFlags=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var useSRGBBuffer=arguments.length>9&&arguments[9]!==undefined?arguments[9]:false;return new RawTexture(data,width,height,5,sceneOrEngine,generateMipMaps,invertY,samplingMode,type,creationFlags,useSRGBBuffer);}},{key:"CreateRGBAStorageTexture",value:function CreateRGBAStorageTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:3;var type=arguments.length>7&&arguments[7]!==undefined?arguments[7]:0;var useSRGBBuffer=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;return new RawTexture(data,width,height,5,sceneOrEngine,generateMipMaps,invertY,samplingMode,type,1,useSRGBBuffer);}},{key:"CreateRTexture",value:function CreateRTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Texture.TRILINEAR_SAMPLINGMODE;var type=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;return new RawTexture(data,width,height,6,sceneOrEngine,generateMipMaps,invertY,samplingMode,type);}},{key:"CreateRStorageTexture",value:function CreateRStorageTexture(data,width,height,sceneOrEngine){var generateMipMaps=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:Texture.TRILINEAR_SAMPLINGMODE;var type=arguments.length>7&&arguments[7]!==undefined?arguments[7]:1;return new RawTexture(data,width,height,6,sceneOrEngine,generateMipMaps,invertY,samplingMode,type,1);}}]);return RawTexture;}(Texture);// node_modules/@babylonjs/core/Bones/skeleton.js
var Skeleton=/*#__PURE__*/function(){function Skeleton(name135,id,scene2){_classCallCheck(this,Skeleton);this.name=name135;this.id=id;this.bones=new Array();this.needInitialSkinMatrix=false;this._isDirty=true;this._meshesWithPoseMatrix=new Array();this._identity=Matrix.Identity();this._ranges={};this._absoluteTransformIsDirty=true;this._canUseTextureForBones=false;this._uniqueId=0;this._numBonesWithLinkedTransformNode=0;this._hasWaitingData=null;this._parentContainer=null;this.doNotSerialize=false;this._useTextureToStoreBoneMatrices=true;this._animationPropertiesOverride=null;this.onBeforeComputeObservable=new Observable();this.bones=[];this._scene=scene2||EngineStore.LastCreatedScene;this._uniqueId=this._scene.getUniqueId();this._scene.addSkeleton(this);this._isDirty=true;var engineCaps=this._scene.getEngine().getCaps();this._canUseTextureForBones=engineCaps.textureFloat&&engineCaps.maxVertexTextureImageUnits>0;}_createClass(Skeleton,[{key:"useTextureToStoreBoneMatrices",get:function get(){return this._useTextureToStoreBoneMatrices;},set:function set(value){this._useTextureToStoreBoneMatrices=value;this._markAsDirty();}},{key:"animationPropertiesOverride",get:function get(){if(!this._animationPropertiesOverride){return this._scene.animationPropertiesOverride;}return this._animationPropertiesOverride;},set:function set(value){this._animationPropertiesOverride=value;}},{key:"isUsingTextureForMatrices",get:function get(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones;}},{key:"uniqueId",get:function get(){return this._uniqueId;}},{key:"getClassName",value:function getClassName(){return"Skeleton";}},{key:"getChildren",value:function getChildren(){return this.bones.filter(function(b){return!b.getParent();});}},{key:"getTransformMatrices",value:function getTransformMatrices(mesh){if(this.needInitialSkinMatrix){if(!mesh._bonesTransformMatrices){this.prepare();}return mesh._bonesTransformMatrices;}if(!this._transformMatrices){this.prepare();}return this._transformMatrices;}},{key:"getTransformMatrixTexture",value:function getTransformMatrixTexture(mesh){if(this.needInitialSkinMatrix&&mesh._transformMatrixTexture){return mesh._transformMatrixTexture;}return this._transformMatrixTexture;}},{key:"getScene",value:function getScene(){return this._scene;}},{key:"toString",value:function toString(fullDetails){var ret="Name: ".concat(this.name,", nBones: ").concat(this.bones.length);ret+=", nAnimationRanges: ".concat(this._ranges?Object.keys(this._ranges).length:"none");if(fullDetails){ret+=", Ranges: {";var first=true;for(var name135 in this._ranges){if(first){ret+=", ";first=false;}ret+=name135;}ret+="}";}return ret;}},{key:"getBoneIndexByName",value:function getBoneIndexByName(name135){for(var boneIndex=0,cache=this.bones.length;boneIndex<cache;boneIndex++){if(this.bones[boneIndex].name===name135){return boneIndex;}}return-1;}},{key:"createAnimationRange",value:function createAnimationRange(name135,from,to){if(!this._ranges[name135]){this._ranges[name135]=new AnimationRange(name135,from,to);for(var i=0,nBones=this.bones.length;i<nBones;i++){if(this.bones[i].animations[0]){this.bones[i].animations[0].createRange(name135,from,to);}}}}},{key:"deleteAnimationRange",value:function deleteAnimationRange(name135){var deleteFrames=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;for(var i=0,nBones=this.bones.length;i<nBones;i++){if(this.bones[i].animations[0]){this.bones[i].animations[0].deleteRange(name135,deleteFrames);}}this._ranges[name135]=null;}},{key:"getAnimationRange",value:function getAnimationRange(name135){return this._ranges[name135]||null;}},{key:"getAnimationRanges",value:function getAnimationRanges(){var animationRanges=[];var name135;for(name135 in this._ranges){animationRanges.push(this._ranges[name135]);}return animationRanges;}},{key:"copyAnimationRange",value:function copyAnimationRange(source,name135){var rescaleAsRequired=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this._ranges[name135]||!source.getAnimationRange(name135)){return false;}var ret=true;var frameOffset=this._getHighestAnimationFrame()+1;var boneDict={};var sourceBones=source.bones;var nBones;var i;for(i=0,nBones=sourceBones.length;i<nBones;i++){boneDict[sourceBones[i].name]=sourceBones[i];}if(this.bones.length!==sourceBones.length){Logger.Warn("copyAnimationRange: this rig has ".concat(this.bones.length," bones, while source as ").concat(sourceBones.length));ret=false;}var skelDimensionsRatio=rescaleAsRequired&&this.dimensionsAtRest&&source.dimensionsAtRest?this.dimensionsAtRest.divide(source.dimensionsAtRest):null;for(i=0,nBones=this.bones.length;i<nBones;i++){var boneName=this.bones[i].name;var sourceBone=boneDict[boneName];if(sourceBone){ret=ret&&this.bones[i].copyAnimationRange(sourceBone,name135,frameOffset,rescaleAsRequired,skelDimensionsRatio);}else{Logger.Warn("copyAnimationRange: not same rig, missing source bone "+boneName);ret=false;}}var range=source.getAnimationRange(name135);if(range){this._ranges[name135]=new AnimationRange(name135,range.from+frameOffset,range.to+frameOffset);}return ret;}},{key:"returnToRest",value:function returnToRest(){var _iterator167=_createForOfIteratorHelper(this.bones),_step177;try{for(_iterator167.s();!(_step177=_iterator167.n()).done;){var bone=_step177.value;if(bone._index!==-1){bone.returnToRest();}}}catch(err){_iterator167.e(err);}finally{_iterator167.f();}}},{key:"_getHighestAnimationFrame",value:function _getHighestAnimationFrame(){var ret=0;for(var i=0,nBones=this.bones.length;i<nBones;i++){if(this.bones[i].animations[0]){var highest=this.bones[i].animations[0].getHighestFrame();if(ret<highest){ret=highest;}}}return ret;}},{key:"beginAnimation",value:function beginAnimation(name135,loop,speedRatio,onAnimationEnd){var range=this.getAnimationRange(name135);if(!range){return null;}return this._scene.beginAnimation(this,range.from,range.to,loop,speedRatio,onAnimationEnd);}},{key:"_markAsDirty",value:function _markAsDirty(){this._isDirty=true;this._absoluteTransformIsDirty=true;}},{key:"_registerMeshWithPoseMatrix",value:function _registerMeshWithPoseMatrix(mesh){this._meshesWithPoseMatrix.push(mesh);}},{key:"_unregisterMeshWithPoseMatrix",value:function _unregisterMeshWithPoseMatrix(mesh){var index=this._meshesWithPoseMatrix.indexOf(mesh);if(index>-1){this._meshesWithPoseMatrix.splice(index,1);}}},{key:"_computeTransformMatrices",value:function _computeTransformMatrices(targetMatrix,initialSkinMatrix){this.onBeforeComputeObservable.notifyObservers(this);for(var index=0;index<this.bones.length;index++){var bone=this.bones[index];bone._childUpdateId++;var parentBone=bone.getParent();if(parentBone){bone.getLocalMatrix().multiplyToRef(parentBone.getWorldMatrix(),bone.getWorldMatrix());}else{if(initialSkinMatrix){bone.getLocalMatrix().multiplyToRef(initialSkinMatrix,bone.getWorldMatrix());}else{bone.getWorldMatrix().copyFrom(bone.getLocalMatrix());}}if(bone._index!==-1){var mappedIndex=bone._index===null?index:bone._index;bone.getInvertedAbsoluteTransform().multiplyToArray(bone.getWorldMatrix(),targetMatrix,mappedIndex*16);}}this._identity.copyToArray(targetMatrix,this.bones.length*16);}},{key:"prepare",value:function prepare(){if(this._numBonesWithLinkedTransformNode>0){var _iterator168=_createForOfIteratorHelper(this.bones),_step178;try{for(_iterator168.s();!(_step178=_iterator168.n()).done;){var bone=_step178.value;if(bone._linkedTransformNode){var node=bone._linkedTransformNode;bone.position=node.position;if(node.rotationQuaternion){bone.rotationQuaternion=node.rotationQuaternion;}else{bone.rotation=node.rotation;}bone.scaling=node.scaling;}}}catch(err){_iterator168.e(err);}finally{_iterator168.f();}}if(this.needInitialSkinMatrix){var _iterator169=_createForOfIteratorHelper(this._meshesWithPoseMatrix),_step179;try{for(_iterator169.s();!(_step179=_iterator169.n()).done;){var mesh=_step179.value;var poseMatrix=mesh.getPoseMatrix();var needsUpdate=this._isDirty;if(!mesh._bonesTransformMatrices||mesh._bonesTransformMatrices.length!==16*(this.bones.length+1)){mesh._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1));needsUpdate=true;}if(!needsUpdate){continue;}if(this._synchronizedWithMesh!==mesh){this._synchronizedWithMesh=mesh;var _iterator170=_createForOfIteratorHelper(this.bones),_step180;try{for(_iterator170.s();!(_step180=_iterator170.n()).done;){var _bone=_step180.value;if(!_bone.getParent()){var matrix=_bone.getBaseMatrix();matrix.multiplyToRef(poseMatrix,TmpVectors.Matrix[1]);_bone._updateDifferenceMatrix(TmpVectors.Matrix[1]);}}}catch(err){_iterator170.e(err);}finally{_iterator170.f();}if(this.isUsingTextureForMatrices){var textureWidth=(this.bones.length+1)*4;if(!mesh._transformMatrixTexture||mesh._transformMatrixTexture.getSize().width!==textureWidth){if(mesh._transformMatrixTexture){mesh._transformMatrixTexture.dispose();}mesh._transformMatrixTexture=RawTexture.CreateRGBATexture(mesh._bonesTransformMatrices,(this.bones.length+1)*4,1,this._scene,false,false,1,1);}}}this._computeTransformMatrices(mesh._bonesTransformMatrices,poseMatrix);if(this.isUsingTextureForMatrices&&mesh._transformMatrixTexture){mesh._transformMatrixTexture.update(mesh._bonesTransformMatrices);}}}catch(err){_iterator169.e(err);}finally{_iterator169.f();}}else{if(!this._isDirty){return;}if(!this._transformMatrices||this._transformMatrices.length!==16*(this.bones.length+1)){this._transformMatrices=new Float32Array(16*(this.bones.length+1));if(this.isUsingTextureForMatrices){if(this._transformMatrixTexture){this._transformMatrixTexture.dispose();}this._transformMatrixTexture=RawTexture.CreateRGBATexture(this._transformMatrices,(this.bones.length+1)*4,1,this._scene,false,false,1,1);}}this._computeTransformMatrices(this._transformMatrices,null);if(this.isUsingTextureForMatrices&&this._transformMatrixTexture){this._transformMatrixTexture.update(this._transformMatrices);}}this._isDirty=false;}},{key:"getAnimatables",value:function getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var index=0;index<this.bones.length;index++){this._animatables.push(this.bones[index]);}}return this._animatables;}},{key:"clone",value:function clone(name135,id){var result=new Skeleton(name135,id||name135,this._scene);result.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var index=0;index<this.bones.length;index++){var source=this.bones[index];var parentBone=null;var parent=source.getParent();if(parent){var parentIndex=this.bones.indexOf(parent);parentBone=result.bones[parentIndex];}var bone=new Bone(source.name,result,parentBone,source.getBaseMatrix().clone(),source.getRestPose().clone());bone._index=source._index;if(source._linkedTransformNode){bone.linkTransformNode(source._linkedTransformNode);}DeepCopier.DeepCopy(source.animations,bone.animations);}if(this._ranges){result._ranges={};for(var rangeName in this._ranges){var range=this._ranges[rangeName];if(range){result._ranges[rangeName]=range.clone();}}}this._isDirty=true;return result;}},{key:"enableBlending",value:function enableBlending(){var blendingSpeed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0.01;this.bones.forEach(function(bone){bone.animations.forEach(function(animation){animation.enableBlending=true;animation.blendingSpeed=blendingSpeed;});});}},{key:"dispose",value:function dispose(){this._meshesWithPoseMatrix.length=0;this.getScene().stopAnimation(this);this.getScene().removeSkeleton(this);if(this._parentContainer){var index=this._parentContainer.skeletons.indexOf(this);if(index>-1){this._parentContainer.skeletons.splice(index,1);}this._parentContainer=null;}if(this._transformMatrixTexture){this._transformMatrixTexture.dispose();this._transformMatrixTexture=null;}}},{key:"serialize",value:function serialize(){var _a;var serializationObject={};serializationObject.name=this.name;serializationObject.id=this.id;if(this.dimensionsAtRest){serializationObject.dimensionsAtRest=this.dimensionsAtRest.asArray();}serializationObject.bones=[];serializationObject.needInitialSkinMatrix=this.needInitialSkinMatrix;for(var index=0;index<this.bones.length;index++){var bone=this.bones[index];var parent=bone.getParent();var serializedBone={parentBoneIndex:parent?this.bones.indexOf(parent):-1,index:bone.getIndex(),name:bone.name,id:bone.id,matrix:bone.getBaseMatrix().toArray(),rest:bone.getRestPose().toArray(),linkedTransformNodeId:(_a=bone.getTransformNode())===null||_a===void 0?void 0:_a.id};serializationObject.bones.push(serializedBone);if(bone.length){serializedBone.length=bone.length;}if(bone.metadata){serializedBone.metadata=bone.metadata;}if(bone.animations&&bone.animations.length>0){serializedBone.animation=bone.animations[0].serialize();}serializationObject.ranges=[];for(var name135 in this._ranges){var source=this._ranges[name135];if(!source){continue;}var range={};range.name=name135;range.from=source.from;range.to=source.to;serializationObject.ranges.push(range);}}return serializationObject;}},{key:"computeAbsoluteTransforms",value:function computeAbsoluteTransforms(){var forceUpdate=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this._absoluteTransformIsDirty||forceUpdate){this.bones[0].computeAbsoluteTransforms();this._absoluteTransformIsDirty=false;}}},{key:"getPoseMatrix",value:function getPoseMatrix(){var poseMatrix=null;if(this._meshesWithPoseMatrix.length>0){poseMatrix=this._meshesWithPoseMatrix[0].getPoseMatrix();}return poseMatrix;}},{key:"sortBones",value:function sortBones(){var bones=new Array();var visited=new Array(this.bones.length);for(var index=0;index<this.bones.length;index++){this._sortBones(index,bones,visited);}this.bones=bones;}},{key:"_sortBones",value:function _sortBones(index,bones,visited){if(visited[index]){return;}visited[index]=true;var bone=this.bones[index];if(!bone)return;if(bone._index===void 0){bone._index=index;}var parentBone=bone.getParent();if(parentBone){this._sortBones(this.bones.indexOf(parentBone),bones,visited);}bones.push(bone);}},{key:"setCurrentPoseAsRest",value:function setCurrentPoseAsRest(){this.bones.forEach(function(b){b.setCurrentPoseAsRest();});}}],[{key:"MakeAnimationAdditive",value:function MakeAnimationAdditive(skeleton){var referenceFrame=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var range=arguments.length>2?arguments[2]:undefined;var rangeValue=skeleton.getAnimationRange(range);if(!rangeValue){return null;}var sceneAnimatables=skeleton._scene.getAllAnimatablesByTarget(skeleton);var rangeAnimatable=null;for(var index=0;index<sceneAnimatables.length;index++){var sceneAnimatable=sceneAnimatables[index];if(sceneAnimatable.fromFrame===(rangeValue===null||rangeValue===void 0?void 0:rangeValue.from)&&sceneAnimatable.toFrame===(rangeValue===null||rangeValue===void 0?void 0:rangeValue.to)){rangeAnimatable=sceneAnimatable;break;}}var animatables=skeleton.getAnimatables();for(var _index24=0;_index24<animatables.length;_index24++){var animatable=animatables[_index24];var animations=animatable.animations;if(!animations){continue;}for(var animIndex=0;animIndex<animations.length;animIndex++){Animation.MakeAnimationAdditive(animations[animIndex],referenceFrame,range);}}if(rangeAnimatable){rangeAnimatable.isAdditive=true;}return skeleton;}},{key:"Parse",value:function Parse(parsedSkeleton,scene2){var skeleton=new Skeleton(parsedSkeleton.name,parsedSkeleton.id,scene2);if(parsedSkeleton.dimensionsAtRest){skeleton.dimensionsAtRest=Vector3.FromArray(parsedSkeleton.dimensionsAtRest);}skeleton.needInitialSkinMatrix=parsedSkeleton.needInitialSkinMatrix;var index;for(index=0;index<parsedSkeleton.bones.length;index++){var parsedBone=parsedSkeleton.bones[index];var parsedBoneIndex=parsedSkeleton.bones[index].index;var parentBone=null;if(parsedBone.parentBoneIndex>-1){parentBone=skeleton.bones[parsedBone.parentBoneIndex];}var rest=parsedBone.rest?Matrix.FromArray(parsedBone.rest):null;var bone=new Bone(parsedBone.name,skeleton,parentBone,Matrix.FromArray(parsedBone.matrix),rest,null,parsedBoneIndex);if(parsedBone.id!==void 0&&parsedBone.id!==null){bone.id=parsedBone.id;}if(parsedBone.length){bone.length=parsedBone.length;}if(parsedBone.metadata){bone.metadata=parsedBone.metadata;}if(parsedBone.animation){bone.animations.push(Animation.Parse(parsedBone.animation));}if(parsedBone.linkedTransformNodeId!==void 0&&parsedBone.linkedTransformNodeId!==null){skeleton._hasWaitingData=true;bone._waitingTransformNodeId=parsedBone.linkedTransformNodeId;}}if(parsedSkeleton.ranges){for(index=0;index<parsedSkeleton.ranges.length;index++){var data=parsedSkeleton.ranges[index];skeleton.createAnimationRange(data.name,data.from,data.to);}}return skeleton;}}]);return Skeleton;}();// node_modules/@babylonjs/core/Materials/prePassConfiguration.js
var PrePassConfiguration=/*#__PURE__*/function(){function PrePassConfiguration(){_classCallCheck(this,PrePassConfiguration);this.previousWorldMatrices={};this.previousBones={};}_createClass(PrePassConfiguration,[{key:"bindForSubMesh",value:function bindForSubMesh(effect,scene2,mesh,world,isFrozen){if(scene2.prePassRenderer&&scene2.prePassRenderer.enabled&&scene2.prePassRenderer.currentRTisSceneRT){if(scene2.prePassRenderer.getIndex(2)!==-1){if(!this.previousWorldMatrices[mesh.uniqueId]){this.previousWorldMatrices[mesh.uniqueId]=world.clone();}if(!this.previousViewProjection){this.previousViewProjection=scene2.getTransformMatrix().clone();this.currentViewProjection=scene2.getTransformMatrix().clone();}var engine=scene2.getEngine();if(this.currentViewProjection.updateFlag!==scene2.getTransformMatrix().updateFlag){this._lastUpdateFrameId=engine.frameId;this.previousViewProjection.copyFrom(this.currentViewProjection);this.currentViewProjection.copyFrom(scene2.getTransformMatrix());}else if(this._lastUpdateFrameId!==engine.frameId){this._lastUpdateFrameId=engine.frameId;this.previousViewProjection.copyFrom(this.currentViewProjection);}effect.setMatrix("previousWorld",this.previousWorldMatrices[mesh.uniqueId]);effect.setMatrix("previousViewProjection",this.previousViewProjection);this.previousWorldMatrices[mesh.uniqueId]=world.clone();}}}}],[{key:"AddUniforms",value:function AddUniforms(uniforms){uniforms.push("previousWorld","previousViewProjection","mPreviousBones");}},{key:"AddSamplers",value:function AddSamplers(samplers){}}]);return PrePassConfiguration;}();// node_modules/@babylonjs/core/Materials/pushMaterial.js
var PushMaterial=/*#__PURE__*/function(_Material2){_inherits(PushMaterial,_Material2);var _super38=_createSuper(PushMaterial);function PushMaterial(name135,scene2){var _this132;var storeEffectOnSubMeshes=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,PushMaterial);_this132=_super38.call(this,name135,scene2);_this132._normalMatrix=new Matrix();_this132._storeEffectOnSubMeshes=storeEffectOnSubMeshes;return _this132;}_createClass(PushMaterial,[{key:"getEffect",value:function getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:_get(_getPrototypeOf(PushMaterial.prototype),"getEffect",this).call(this);}},{key:"isReady",value:function isReady(mesh,useInstances){if(!mesh){return false;}if(!this._storeEffectOnSubMeshes){return true;}if(!mesh.subMeshes||mesh.subMeshes.length===0){return true;}return this.isReadyForSubMesh(mesh,mesh.subMeshes[0],useInstances);}},{key:"_isReadyForSubMesh",value:function _isReadyForSubMesh(subMesh){var defines=subMesh.materialDefines;if(!this.checkReadyOnEveryCall&&subMesh.effect&&defines){if(defines._renderId===this.getScene().getRenderId()){return true;}}return false;}},{key:"bindOnlyWorldMatrix",value:function bindOnlyWorldMatrix(world){this._activeEffect.setMatrix("world",world);}},{key:"bindOnlyNormalMatrix",value:function bindOnlyNormalMatrix(normalMatrix){this._activeEffect.setMatrix("normalMatrix",normalMatrix);}},{key:"bind",value:function bind(world,mesh){if(!mesh){return;}this.bindForSubMesh(world,mesh,mesh.subMeshes[0]);}},{key:"_afterBind",value:function _afterBind(mesh){var effect=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_get(_getPrototypeOf(PushMaterial.prototype),"_afterBind",this).call(this,mesh,effect);this.getScene()._cachedEffect=effect;if(effect){effect._forceRebindOnNextCall=false;}}},{key:"_mustRebind",value:function _mustRebind(scene2,effect){var visibility=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;return scene2.isCachedMaterialInvalid(this,effect,visibility);}}]);return PushMaterial;}(Material);// node_modules/@babylonjs/core/Materials/materialFlags.js
var MaterialFlags=/*#__PURE__*/function(){function MaterialFlags(){_classCallCheck(this,MaterialFlags);}_createClass(MaterialFlags,null,[{key:"DiffuseTextureEnabled",get:function get(){return this._DiffuseTextureEnabled;},set:function set(value){if(this._DiffuseTextureEnabled===value){return;}this._DiffuseTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"DetailTextureEnabled",get:function get(){return this._DetailTextureEnabled;},set:function set(value){if(this._DetailTextureEnabled===value){return;}this._DetailTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"AmbientTextureEnabled",get:function get(){return this._AmbientTextureEnabled;},set:function set(value){if(this._AmbientTextureEnabled===value){return;}this._AmbientTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"OpacityTextureEnabled",get:function get(){return this._OpacityTextureEnabled;},set:function set(value){if(this._OpacityTextureEnabled===value){return;}this._OpacityTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"ReflectionTextureEnabled",get:function get(){return this._ReflectionTextureEnabled;},set:function set(value){if(this._ReflectionTextureEnabled===value){return;}this._ReflectionTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"EmissiveTextureEnabled",get:function get(){return this._EmissiveTextureEnabled;},set:function set(value){if(this._EmissiveTextureEnabled===value){return;}this._EmissiveTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"SpecularTextureEnabled",get:function get(){return this._SpecularTextureEnabled;},set:function set(value){if(this._SpecularTextureEnabled===value){return;}this._SpecularTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"BumpTextureEnabled",get:function get(){return this._BumpTextureEnabled;},set:function set(value){if(this._BumpTextureEnabled===value){return;}this._BumpTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"LightmapTextureEnabled",get:function get(){return this._LightmapTextureEnabled;},set:function set(value){if(this._LightmapTextureEnabled===value){return;}this._LightmapTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"RefractionTextureEnabled",get:function get(){return this._RefractionTextureEnabled;},set:function set(value){if(this._RefractionTextureEnabled===value){return;}this._RefractionTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"ColorGradingTextureEnabled",get:function get(){return this._ColorGradingTextureEnabled;},set:function set(value){if(this._ColorGradingTextureEnabled===value){return;}this._ColorGradingTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"FresnelEnabled",get:function get(){return this._FresnelEnabled;},set:function set(value){if(this._FresnelEnabled===value){return;}this._FresnelEnabled=value;Engine.MarkAllMaterialsAsDirty(4);}},{key:"ClearCoatTextureEnabled",get:function get(){return this._ClearCoatTextureEnabled;},set:function set(value){if(this._ClearCoatTextureEnabled===value){return;}this._ClearCoatTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"ClearCoatBumpTextureEnabled",get:function get(){return this._ClearCoatBumpTextureEnabled;},set:function set(value){if(this._ClearCoatBumpTextureEnabled===value){return;}this._ClearCoatBumpTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"ClearCoatTintTextureEnabled",get:function get(){return this._ClearCoatTintTextureEnabled;},set:function set(value){if(this._ClearCoatTintTextureEnabled===value){return;}this._ClearCoatTintTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"SheenTextureEnabled",get:function get(){return this._SheenTextureEnabled;},set:function set(value){if(this._SheenTextureEnabled===value){return;}this._SheenTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"AnisotropicTextureEnabled",get:function get(){return this._AnisotropicTextureEnabled;},set:function set(value){if(this._AnisotropicTextureEnabled===value){return;}this._AnisotropicTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"ThicknessTextureEnabled",get:function get(){return this._ThicknessTextureEnabled;},set:function set(value){if(this._ThicknessTextureEnabled===value){return;}this._ThicknessTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"RefractionIntensityTextureEnabled",get:function get(){return this._ThicknessTextureEnabled;},set:function set(value){if(this._RefractionIntensityTextureEnabled===value){return;}this._RefractionIntensityTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"TranslucencyIntensityTextureEnabled",get:function get(){return this._ThicknessTextureEnabled;},set:function set(value){if(this._TranslucencyIntensityTextureEnabled===value){return;}this._TranslucencyIntensityTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}},{key:"IridescenceTextureEnabled",get:function get(){return this._IridescenceTextureEnabled;},set:function set(value){if(this._IridescenceTextureEnabled===value){return;}this._IridescenceTextureEnabled=value;Engine.MarkAllMaterialsAsDirty(1);}}]);return MaterialFlags;}();MaterialFlags._DiffuseTextureEnabled=true;MaterialFlags._DetailTextureEnabled=true;MaterialFlags._AmbientTextureEnabled=true;MaterialFlags._OpacityTextureEnabled=true;MaterialFlags._ReflectionTextureEnabled=true;MaterialFlags._EmissiveTextureEnabled=true;MaterialFlags._SpecularTextureEnabled=true;MaterialFlags._BumpTextureEnabled=true;MaterialFlags._LightmapTextureEnabled=true;MaterialFlags._RefractionTextureEnabled=true;MaterialFlags._ColorGradingTextureEnabled=true;MaterialFlags._FresnelEnabled=true;MaterialFlags._ClearCoatTextureEnabled=true;MaterialFlags._ClearCoatBumpTextureEnabled=true;MaterialFlags._ClearCoatTintTextureEnabled=true;MaterialFlags._SheenTextureEnabled=true;MaterialFlags._AnisotropicTextureEnabled=true;MaterialFlags._ThicknessTextureEnabled=true;MaterialFlags._RefractionIntensityTextureEnabled=true;MaterialFlags._TranslucencyIntensityTextureEnabled=true;MaterialFlags._IridescenceTextureEnabled=true;// node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultFragmentDeclaration.js
var name="defaultFragmentDeclaration";var shader="uniform vec4 vEyePosition;\nuniform vec4 vDiffuseColor;\n#ifdef SPECULARTERM\nuniform vec4 vSpecularColor;\n#endif\nuniform vec3 vEmissiveColor;\nuniform vec3 vAmbientColor;\nuniform float visibility;\n#ifdef DIFFUSE\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY \nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef ALPHATEST\nuniform float alphaCutOff;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFRACTION\nuniform vec4 vRefractionInfos;\n#ifndef REFRACTIONMAP_3D\nuniform mat4 refractionMatrix;\n#endif\n#ifdef REFRACTIONFRESNEL\nuniform vec4 refractionLeftColor;\nuniform vec4 refractionRightColor;\n#endif\n#if defined(USE_LOCAL_REFRACTIONMAP_CUBIC) && defined(REFRACTIONMAP_3D)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\n#endif\n#ifdef DIFFUSEFRESNEL\nuniform vec4 diffuseLeftColor;\nuniform vec4 diffuseRightColor;\n#endif\n#ifdef OPACITYFRESNEL\nuniform vec4 opacityParts;\n#endif\n#ifdef EMISSIVEFRESNEL\nuniform vec4 emissiveLeftColor;\nuniform vec4 emissiveRightColor;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)\nuniform mat4 reflectionMatrix;\n#endif\n#ifndef REFLECTIONMAP_SKYBOX\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#ifdef REFLECTIONFRESNEL\nuniform vec4 reflectionLeftColor;\nuniform vec4 reflectionRightColor;\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n";ShaderStore.IncludesShadersStore[name]=shader;// node_modules/@babylonjs/core/Shaders/ShadersInclude/sceneUboDeclaration.js
var name2="sceneUboDeclaration";var shader2="layout(std140,column_major) uniform;\nuniform Scene {\nmat4 viewProjection;\n#ifdef MULTIVIEW\nmat4 viewProjectionR;\n#endif \nmat4 view;\nmat4 projection;\nvec4 vEyePosition;\n};\n";ShaderStore.IncludesShadersStore[name2]=shader2;// node_modules/@babylonjs/core/Shaders/ShadersInclude/meshUboDeclaration.js
var name3="meshUboDeclaration";var shader3="#ifdef WEBGL2\nuniform mat4 world;\nuniform float visibility;\n#else\nlayout(std140,column_major) uniform;\nuniform Mesh\n{\nmat4 world;\nfloat visibility;\n};\n#endif\n#define WORLD_UBO\n";ShaderStore.IncludesShadersStore[name3]=shader3;// node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultUboDeclaration.js
var name4="defaultUboDeclaration";var shader4="layout(std140,column_major) uniform;\nuniform Material\n{\nvec4 diffuseLeftColor;\nvec4 diffuseRightColor;\nvec4 opacityParts;\nvec4 reflectionLeftColor;\nvec4 reflectionRightColor;\nvec4 refractionLeftColor;\nvec4 refractionRightColor;\nvec4 emissiveLeftColor;\nvec4 emissiveRightColor;\nvec2 vDiffuseInfos;\nvec2 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vReflectionInfos;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec2 vSpecularInfos;\nvec3 vBumpInfos;\nmat4 diffuseMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 reflectionMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 specularMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nfloat pointSize;\nfloat alphaCutOff;\nmat4 refractionMatrix;\nvec4 vRefractionInfos;\nvec3 vRefractionPosition;\nvec3 vRefractionSize;\nvec4 vSpecularColor;\nvec3 vEmissiveColor;\nvec4 vDiffuseColor;\nvec3 vAmbientColor;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";ShaderStore.IncludesShadersStore[name4]=shader4;// node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassDeclaration.js
var name5="prePassDeclaration";var shader5="#ifdef PREPASS\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out highp vec4 glFragData[{X}];highp vec4 gl_FragColor;\n#ifdef PREPASS_DEPTH\nvarying highp vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nvarying highp vec4 vCurrentPosition;varying highp vec4 vPreviousPosition;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name5]=shader5;// node_modules/@babylonjs/core/Shaders/ShadersInclude/oitDeclaration.js
var name6="oitDeclaration";var shader6="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\n#extension GL_EXT_draw_buffers : require\nlayout(location=0) out vec2 depth; \nlayout(location=1) out vec4 frontColor;\nlayout(location=2) out vec4 backColor;\n#define MAX_DEPTH 99999.0\nhighp vec4 gl_FragColor;\nuniform sampler2D oitDepthSampler;\nuniform sampler2D oitFrontColorSampler;\n#endif\n";ShaderStore.IncludesShadersStore[name6]=shader6;// node_modules/@babylonjs/core/Shaders/ShadersInclude/mainUVVaryingDeclaration.js
var name7="mainUVVaryingDeclaration";var shader7="#ifdef MAINUV{X}\nvarying vec2 vMainUV{X};\n#endif\n";ShaderStore.IncludesShadersStore[name7]=shader7;// node_modules/@babylonjs/core/Shaders/ShadersInclude/helperFunctions.js
var name8="helperFunctions";var shader8="const float PI=3.1415926535897932384626433832795;\nconst float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;\nconst float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;\nconst vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);\nconst float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {\nvec3 i0=inMatrix[0];\nvec3 i1=inMatrix[1];\nvec3 i2=inMatrix[2];\nmat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);\nreturn outMatrix;\n}\nmat3 inverseMat3(mat3 inMatrix) {\nfloat a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];\nfloat a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];\nfloat a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];\nfloat b01=a22*a11-a12*a21;\nfloat b11=-a22*a10+a12*a20;\nfloat b21=a21*a10-a11*a20;\nfloat det=a00*b01+a01*b11+a02*b21;\nreturn mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;\n}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{\nvec3 nearZeroSection=0.0773993808*color;\nvec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{\nvec3 nearZeroSection=12.92*color;\nvec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;\nfloat remainingSection=pow(0.947867299*(color+0.055),2.4);\nreturn color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;\nfloat remainingSection=1.055*pow(color,0.41666)-0.055;\nreturn color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{\nreturn value*value;\n}\nvec3 square(vec3 value)\n{\nreturn value*value;\n}\nfloat pow5(float value) {\nfloat sq=value*value;\nreturn sq*sq*value;\n}\nfloat getLuminance(vec3 color)\n{\nreturn clamp(dot(color,LuminanceEncodeApprox),0.,1.);\n}\nfloat getRand(vec2 seed) {\nreturn fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);\n}\nfloat dither(vec2 seed,float varianceAmount) {\nfloat rand=getRand(seed);\nfloat normVariance=varianceAmount/255.0;\nfloat dither=mix(-normVariance,normVariance,rand);\nreturn dither;\n}\nconst float rgbdMaxRange=255.0;\nvec4 toRGBD(vec3 color) {\nfloat maxRGB=maxEps(max(color.r,max(color.g,color.b)));\nfloat D =max(rgbdMaxRange/maxRGB,1.);\nD =clamp(floor(D)/255.0,0.,1.);\nvec3 rgb=color.rgb*D;\nrgb=toGammaSpace(rgb);\nreturn vec4(clamp(rgb,0.,1.),D); \n}\nvec3 fromRGBD(vec4 rgbd) {\nrgbd.rgb=toLinearSpace(rgbd.rgb);\nreturn rgbd.rgb/rgbd.a;\n}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {\nvec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;\nvec3 halfSize=cubeSize*0.5;\nvec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;\nvec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;\nvec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);\nfloat distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);\nvec3 intersectPositionWS=vertexPos+origVec*distance;\nreturn intersectPositionWS-cubePos;\n}\n";ShaderStore.IncludesShadersStore[name8]=shader8;// node_modules/@babylonjs/core/Shaders/ShadersInclude/lightFragmentDeclaration.js
var name9="lightFragmentDeclaration";var shader9="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X};\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name9]=shader9;// node_modules/@babylonjs/core/Shaders/ShadersInclude/lightUboDeclaration.js
var name10="lightUboDeclaration";var shader10="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef PROJECTEDLIGHTTEXTURE{X}\nuniform mat4 textureProjectionMatrix{X};\nuniform sampler2D projectionLightSampler{X};\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float cascadeBlendFactor{X};\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\nuniform highp sampler2DArray depthSampler{X};\nuniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];\nuniform float penumbraDarkness{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DArrayShadow shadowSampler{X};\n#else\nuniform highp sampler2DArray shadowSampler{X};\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nconst vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]\n(\nvec3 ( 1.5,0.0,0.0 ),\nvec3 ( 0.0,1.5,0.0 ),\nvec3 ( 0.0,0.0,5.5 ),\nvec3 ( 1.5,0.0,5.5 ),\nvec3 ( 1.5,1.5,0.0 ),\nvec3 ( 1.0,1.0,1.0 ),\nvec3 ( 0.0,1.0,5.5 ),\nvec3 ( 0.5,3.5,0.75 )\n);\nvec3 shadowDebug{X};\n#endif\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nint index{X}=-1;\n#else\nint index{X}=SHADOWCSMNUM_CASCADES{X}-1;\n#endif\nfloat diff{X}=0.;\n#elif defined(SHADOWCUBE{X})\nuniform samplerCube shadowSampler{X}; \n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\n#if defined(SHADOWPCSS{X})\nuniform highp sampler2DShadow shadowSampler{X};\nuniform highp sampler2D depthSampler{X};\n#elif defined(SHADOWPCF{X})\nuniform highp sampler2DShadow shadowSampler{X};\n#else\nuniform sampler2D shadowSampler{X};\n#endif\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name10]=shader10;// node_modules/@babylonjs/core/Shaders/ShadersInclude/lightsFragmentFunctions.js
var name11="lightsFragmentFunctions";var shader11="struct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef NDOTL\nfloat ndl;\n#endif\n};\nlightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 lightVectorW;\nfloat attenuation=1.0;\nif (lightData.w==0.)\n{\nvec3 direction=lightData.xyz-vPositionW;\nattenuation=max(0.,1.0-length(direction)/range);\nlightVectorW=normalize(direction);\n}\nelse\n{\nlightVectorW=normalize(-lightData.xyz);\n}\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nlightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {\nlightingInfo result;\nvec3 direction=lightData.xyz-vPositionW;\nvec3 lightVectorW=normalize(direction);\nfloat attenuation=max(0.,1.0-length(direction)/range);\nfloat cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));\nif (cosAngle>=lightDirection.w)\n{\ncosAngle=max(0.,pow(cosAngle,lightData.w));\nattenuation*=cosAngle;\nfloat ndl=max(0.,dot(vNormal,lightVectorW));\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=ndl*diffuseColor*attenuation;\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightVectorW);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor*attenuation;\n#endif\nreturn result;\n}\nresult.diffuse=vec3(0.);\n#ifdef SPECULARTERM\nresult.specular=vec3(0.);\n#endif\n#ifdef NDOTL\nresult.ndl=0.;\n#endif\nreturn result;\n}\nlightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {\nlightingInfo result;\nfloat ndl=dot(vNormal,lightData.xyz)*0.5+0.5;\n#ifdef NDOTL\nresult.ndl=ndl;\n#endif\nresult.diffuse=mix(groundColor,diffuseColor,ndl);\n#ifdef SPECULARTERM\nvec3 angleW=normalize(viewDirectionW+lightData.xyz);\nfloat specComp=max(0.,dot(vNormal,angleW));\nspecComp=pow(specComp,max(1.,glossiness));\nresult.specular=specComp*specularColor;\n#endif\nreturn result;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn textureColor;\n}";ShaderStore.IncludesShadersStore[name11]=shader11;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowsFragmentFunctions.js
var name12="shadowsFragmentFunctions";var shader12="#ifdef SHADOWS\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define TEXTUREFUNC(s,c,l) texture2DLodEXT(s,c,l)\n#else\n#define TEXTUREFUNC(s,c,b) texture2D(s,c,b)\n#endif\n#ifndef SHADOWFLOAT\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}\n#endif\nfloat computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)\n{\nfloat mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));\nreturn mix(value,1.0,mask);\n}\n#define inline\nfloat computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadow=textureCube(shadowSampler,directionToLight).x;\n#endif\nreturn depth>shadow ? darkness : 1.0;\n}\n#define inline\nfloat computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\ndepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\nfloat visibility=1.;\nvec3 poissonDisk[4];\npoissonDisk[0]=vec3(-1.0,1.0,-1.0);\npoissonDisk[1]=vec3(1.0,-1.0,-1.0);\npoissonDisk[2]=vec3(-1.0,-1.0,-1.0);\npoissonDisk[3]=vec3(1.0,-1.0,1.0);\n#ifndef SHADOWFLOAT\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;\nif (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;\n#else\nif (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;\nif (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;\n#endif\nreturn min(1.0,visibility+darkness);\n}\n#define inline\nfloat computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness); \nreturn esm;\n}\n#define inline\nfloat computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)\n{\nvec3 directionToLight=vPositionW-lightPosition;\nfloat depth=length(directionToLight);\ndepth=(depth+depthValues.x)/(depthValues.y);\nfloat shadowPixelDepth=clamp(depth,0.,1.0);\ndirectionToLight=normalize(directionToLight);\ndirectionToLight.y=-directionToLight.y;\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));\n#else\nfloat shadowMapSample=textureCube(shadowSampler,directionToLight).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn esm;\n}\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define inline\nfloat computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nvec3 uvLayer=vec3(uv.x,uv.y,layer);\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(texture2D(shadowSampler,uvLayer));\n#else\nfloat shadow=texture2D(shadowSampler,uvLayer).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n#endif\n#define inline\nfloat computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadow=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadow=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nreturn shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;\n}\n}\n#define inline\nfloat computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\nfloat visibility=1.;\nvec2 poissonDisk[4];\npoissonDisk[0]=vec2(-0.94201624,-0.39906216);\npoissonDisk[1]=vec2(0.94558609,-0.76890725);\npoissonDisk[2]=vec2(-0.094184101,-0.92938870);\npoissonDisk[3]=vec2(0.34495938,0.29387760);\n#ifndef SHADOWFLOAT\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\nif (unpack(TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.))<shadowPixelDepth) visibility-=0.25;\n#else\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[0]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[1]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[2]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\nif (TEXTUREFUNC(shadowSampler,uv+poissonDisk[3]*mapSize,0.).x<shadowPixelDepth) visibility-=0.25;\n#endif\nreturn computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0);\n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec2 uv=0.5*clipSpace.xy+vec2(0.5);\nif (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)\n{\nreturn 1.0;\n}\nelse\n{\nfloat shadowPixelDepth=clamp(depthMetric,0.,1.0); \n#ifndef SHADOWFLOAT\nfloat shadowMapSample=unpack(TEXTUREFUNC(shadowSampler,uv,0.));\n#else\nfloat shadowMapSample=TEXTUREFUNC(shadowSampler,uv,0.).x;\n#endif\nfloat esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);\nreturn computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#ifdef IS_NDC_HALF_ZRANGE\n#define ZINCLIP clipSpace.z\n#else\n#define ZINCLIP uvDepth.z\n#endif\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\n#define GREATEST_LESS_THAN_ONE 0.99999994\n#define inline\nfloat computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat shadow=texture2D(shadowSampler,uvDepthLayer);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));\nshadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));\nshadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));\nshadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n#define inline\nfloat computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat shadow=TEXTUREFUNC(shadowSampler,uvDepth,0.);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=3.-2.*st;\nvec2 uvw1=1.+2.*st;\nvec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;\nvec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);\nshadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);\nshadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);\nshadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);\nshadow=shadow/16.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,highp sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nvec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x; \nuv+=0.5; \nvec2 st=fract(uv); \nvec2 base_uv=floor(uv)-0.5; \nbase_uv*=shadowMapSizeAndInverse.y; \nvec2 uvw0=4.-3.*st;\nvec2 uvw1=vec2(7.);\nvec2 uvw2=1.+3.*st;\nvec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;\nvec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;\nfloat shadow=0.;\nshadow+=uvw0.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z),0.);\nshadow+=uvw1.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z),0.);\nshadow+=uvw2.x*uvw0.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z),0.);\nshadow+=uvw0.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z),0.);\nshadow+=uvw1.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z),0.);\nshadow+=uvw2.x*uvw1.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z),0.);\nshadow+=uvw0.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z),0.);\nshadow+=uvw1.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z),0.);\nshadow+=uvw2.x*uvw2.y*TEXTUREFUNC(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z),0.);\nshadow=shadow/144.;\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\nconst vec3 PoissonSamplers32[64]=vec3[64](\nvec3(0.06407013,0.05409927,0.),\nvec3(0.7366577,0.5789394,0.),\nvec3(-0.6270542,-0.5320278,0.),\nvec3(-0.4096107,0.8411095,0.),\nvec3(0.6849564,-0.4990818,0.),\nvec3(-0.874181,-0.04579735,0.),\nvec3(0.9989998,0.0009880066,0.),\nvec3(-0.004920578,-0.9151649,0.),\nvec3(0.1805763,0.9747483,0.),\nvec3(-0.2138451,0.2635818,0.),\nvec3(0.109845,0.3884785,0.),\nvec3(0.06876755,-0.3581074,0.),\nvec3(0.374073,-0.7661266,0.),\nvec3(0.3079132,-0.1216763,0.),\nvec3(-0.3794335,-0.8271583,0.),\nvec3(-0.203878,-0.07715034,0.),\nvec3(0.5912697,0.1469799,0.),\nvec3(-0.88069,0.3031784,0.),\nvec3(0.5040108,0.8283722,0.),\nvec3(-0.5844124,0.5494877,0.),\nvec3(0.6017799,-0.1726654,0.),\nvec3(-0.5554981,0.1559997,0.),\nvec3(-0.3016369,-0.3900928,0.),\nvec3(-0.5550632,-0.1723762,0.),\nvec3(0.925029,0.2995041,0.),\nvec3(-0.2473137,0.5538505,0.),\nvec3(0.9183037,-0.2862392,0.),\nvec3(0.2469421,0.6718712,0.),\nvec3(0.3916397,-0.4328209,0.),\nvec3(-0.03576927,-0.6220032,0.),\nvec3(-0.04661255,0.7995201,0.),\nvec3(0.4402924,0.3640312,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.),\nvec3(0.,0.,0.)\n);\nconst vec3 PoissonSamplers64[64]=vec3[64](\nvec3(-0.613392,0.617481,0.),\nvec3(0.170019,-0.040254,0.),\nvec3(-0.299417,0.791925,0.),\nvec3(0.645680,0.493210,0.),\nvec3(-0.651784,0.717887,0.),\nvec3(0.421003,0.027070,0.),\nvec3(-0.817194,-0.271096,0.),\nvec3(-0.705374,-0.668203,0.),\nvec3(0.977050,-0.108615,0.),\nvec3(0.063326,0.142369,0.),\nvec3(0.203528,0.214331,0.),\nvec3(-0.667531,0.326090,0.),\nvec3(-0.098422,-0.295755,0.),\nvec3(-0.885922,0.215369,0.),\nvec3(0.566637,0.605213,0.),\nvec3(0.039766,-0.396100,0.),\nvec3(0.751946,0.453352,0.),\nvec3(0.078707,-0.715323,0.),\nvec3(-0.075838,-0.529344,0.),\nvec3(0.724479,-0.580798,0.),\nvec3(0.222999,-0.215125,0.),\nvec3(-0.467574,-0.405438,0.),\nvec3(-0.248268,-0.814753,0.),\nvec3(0.354411,-0.887570,0.),\nvec3(0.175817,0.382366,0.),\nvec3(0.487472,-0.063082,0.),\nvec3(-0.084078,0.898312,0.),\nvec3(0.488876,-0.783441,0.),\nvec3(0.470016,0.217933,0.),\nvec3(-0.696890,-0.549791,0.),\nvec3(-0.149693,0.605762,0.),\nvec3(0.034211,0.979980,0.),\nvec3(0.503098,-0.308878,0.),\nvec3(-0.016205,-0.872921,0.),\nvec3(0.385784,-0.393902,0.),\nvec3(-0.146886,-0.859249,0.),\nvec3(0.643361,0.164098,0.),\nvec3(0.634388,-0.049471,0.),\nvec3(-0.688894,0.007843,0.),\nvec3(0.464034,-0.188818,0.),\nvec3(-0.440840,0.137486,0.),\nvec3(0.364483,0.511704,0.),\nvec3(0.034028,0.325968,0.),\nvec3(0.099094,-0.308023,0.),\nvec3(0.693960,-0.366253,0.),\nvec3(0.678884,-0.204688,0.),\nvec3(0.001801,0.780328,0.),\nvec3(0.145177,-0.898984,0.),\nvec3(0.062655,-0.611866,0.),\nvec3(0.315226,-0.604297,0.),\nvec3(-0.780145,0.486251,0.),\nvec3(-0.371868,0.882138,0.),\nvec3(0.200476,0.494430,0.),\nvec3(-0.494552,-0.711051,0.),\nvec3(0.612476,0.705252,0.),\nvec3(-0.578845,-0.768792,0.),\nvec3(-0.772454,-0.090976,0.),\nvec3(0.504440,0.372295,0.),\nvec3(0.155736,0.065157,0.),\nvec3(0.391522,0.849605,0.),\nvec3(-0.620106,-0.328104,0.),\nvec3(0.789239,-0.419965,0.),\nvec3(-0.545396,0.538133,0.),\nvec3(-0.178564,-0.596057,0.)\n);\n#define inline\nfloat computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=clamp(ZINCLIP,0.,GREATEST_LESS_THAN_ONE);\nvec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=texture2D(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);\nvec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec4 offset=vec4(poissonSamplers[i],0.);\noffset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);\nshadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));\nshadow=mix(darkness,1.,shadow);\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n#define inline\nfloat computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)\n{\nif (depthMetric>1.0 || depthMetric<0.0) {\nreturn 1.0;\n}\nelse\n{\nvec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;\nvec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));\nuvDepth.z=ZINCLIP;\nfloat blockerDepth=0.0;\nfloat sumBlockerDepth=0.0;\nfloat numBlocker=0.0;\nfor (int i=0; i<searchTapCount; i ++) {\nblockerDepth=TEXTUREFUNC(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy),0.).r;\nif (blockerDepth<depthMetric) {\nsumBlockerDepth+=blockerDepth;\nnumBlocker++;\n}\n}\nif (numBlocker<1.0) {\nreturn 1.0;\n}\nelse\n{\nfloat avgBlockerDepth=sumBlockerDepth/numBlocker;\nfloat AAOffset=shadowMapSizeInverse*10.;\nfloat penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);\nfloat filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;\nfloat random=getRand(vPositionFromLight.xy);\nfloat rotationAngle=random*3.1415926;\nvec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));\nfloat shadow=0.;\nfor (int i=0; i<pcfTapCount; i++) {\nvec3 offset=poissonSamplers[i];\noffset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);\nshadow+=TEXTUREFUNC(shadowSampler,uvDepth+offset*filterRadius,0.);\n}\nshadow/=float(pcfTapCount);\nshadow=mix(shadow,1.,depthMetric-avgBlockerDepth);\nshadow=mix(darkness,1.,shadow);\nreturn computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);\n}\n}\n}\n#define inline\nfloat computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);\n}\n#define inline\nfloat computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,highp sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)\n{\nreturn computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);\n}\n#define inline\nfloat computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#define inline\nfloat computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)\n{\nreturn computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);\n}\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name12]=shader12;// node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerFragmentDeclaration.js
var name13="samplerFragmentDeclaration";var shader13="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\nuniform sampler2D _SAMPLERNAME_Sampler;\n#endif\n";ShaderStore.IncludesShadersStore[name13]=shader13;// node_modules/@babylonjs/core/Shaders/ShadersInclude/fresnelFunction.js
var name14="fresnelFunction";var shader14="#ifdef FRESNEL\nfloat computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)\n{\nfloat fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);\nreturn clamp(fresnelTerm,0.,1.);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name14]=shader14;// node_modules/@babylonjs/core/Shaders/ShadersInclude/reflectionFunction.js
var name15="reflectionFunction";var shader15="vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0); \n}\nvec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)\n{\nfloat lon=atan(direction.z,direction.x);\nfloat lat=acos(direction.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(1.0-s,t,0); \n}\nvec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);\nvec3 r=normalize(reflect(cameraToVertex,worldNormal));\nr=vec3(reflectionMatrix*vec4(r,0));\nfloat lon=atan(r.z,r.x);\nfloat lat=acos(r.y);\nvec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;\nfloat s=sphereCoords.x*0.5+0.5;\nfloat t=sphereCoords.y;\nreturn vec3(s,t,0);\n}\nvec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(vec3(view*worldPos));\nvec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));\nvec3 r=reflect(viewDir,viewNormal);\nr=vec3(reflectionMatrix*vec4(r,0));\nr.z=r.z-1.0;\nfloat m=2.0*length(r);\nreturn vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);\n}\nvec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=worldPos.xyz-eyePosition;\nvec3 coords=normalize(reflect(viewDir,worldNormal));\nreturn vec3(reflectionMatrix*vec4(coords,1));\n}\nvec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)\n{\nvec3 viewDir=normalize(worldPos.xyz-eyePosition);\nvec3 coords=reflect(viewDir,worldNormal);\ncoords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);\ncoords=vec3(reflectionMatrix*vec4(coords,0));\n#ifdef INVERTCUBICMAP\ncoords.y*=-1.0;\n#endif\nreturn coords;\n}\nvec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*(view*worldPos));\n}\nvec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)\n{\nreturn vec3(reflectionMatrix*vec4(positionW,1.));\n}\n#ifdef REFLECTION\nvec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)\n{\n#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED\nvec3 direction=normalize(vDirectionW);\nreturn computeFixedEquirectangularCoords(worldPos,worldNormal,direction);\n#endif\n#ifdef REFLECTIONMAP_EQUIRECTANGULAR\nreturn computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SPHERICAL\nreturn computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_PLANAR\nreturn computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_CUBIC\n#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC\nreturn computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);\n#else\nreturn computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);\n#endif\n#endif\n#ifdef REFLECTIONMAP_PROJECTION\nreturn computeProjectionCoords(worldPos,view,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nreturn computeSkyBoxCoords(vPositionUVW,reflectionMatrix);\n#endif\n#ifdef REFLECTIONMAP_EXPLICIT\nreturn vec3(0,0,0);\n#endif\n}\n#endif\n";ShaderStore.IncludesShadersStore[name15]=shader15;// node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingDeclaration.js
var name16="imageProcessingDeclaration";var shader16="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;\nuniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;\nuniform vec4 vCameraColorCurveNeutral;\nuniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";ShaderStore.IncludesShadersStore[name16]=shader16;// node_modules/@babylonjs/core/Shaders/ShadersInclude/imageProcessingFunctions.js
var name17="imageProcessingFunctions";var shader17="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{\nfloat sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);\nfloat sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;\nsliceUV.x+=sliceInteger*sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice0Color=texture2D(colorTransform,sliceUV);\nsliceUV.x+=sliceSize;\nsliceUV=saturate(sliceUV);\nvec4 slice1Color=texture2D(colorTransform,sliceUV);\nvec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;\n}\n#endif\n#ifdef TONEMAPPING_ACES\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);\nconst mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);\nvec3 RRTAndODTFit(vec3 v)\n{\nvec3 a=v*(v+0.0245786)-0.000090537;\nvec3 b=v*(0.983729*v+0.4329510)+0.238081;\nreturn a/b;\n}\nvec3 ACESFitted(vec3 color)\n{\ncolor=ACESInputMat*color;\ncolor=RRTAndODTFit(color);\ncolor=ACESOutputMat*color;\ncolor=saturate(color);\nreturn color;\n}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;\nviewportXY=viewportXY*2.0-1.0;\nvec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);\nfloat vignetteTerm=dot(vignetteXY1,vignetteXY1);\nfloat vignette=pow(vignetteTerm,vignetteSettings2.w);\nvec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);\nresult.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#ifdef TONEMAPPING\n#ifdef TONEMAPPING_ACES\nresult.rgb=ACESFitted(result.rgb);\n#else\nconst float tonemappingCalibration=1.590579;\nresult.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\n#endif\nresult.rgb=toGammaSpace(result.rgb);\nresult.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);\nif (contrast<1.0) {\nresult.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);\n} else {\nresult.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);\n}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);\nvec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));\nvec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;\nresult.rgb*=colorCurve.rgb;\nresult.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);\nfloat dither=mix(-ditherIntensity,ditherIntensity,rand);\nresult.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;\n}";ShaderStore.IncludesShadersStore[name17]=shader17;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragmentMainFunctions.js
var name18="bumpFragmentMainFunctions";var shader18="#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nuniform mat4 normalMatrix;\n#if defined(WEBGL2) || defined(WEBGPU)\nmat4 toNormalMatrix(mat4 wMatrix)\n{\nmat4 ret=inverse(wMatrix);\nret=transpose(ret);\nret[0][3]=0.;\nret[1][3]=0.;\nret[2][3]=0.;\nret[3]=vec4(0.,0.,0.,1.);\nreturn ret;\n}\n#else\nmat4 toNormalMatrix(mat4 m)\n{\nfloat\na00=m[0][0],a01=m[0][1],a02=m[0][2],a03=m[0][3],\na10=m[1][0],a11=m[1][1],a12=m[1][2],a13=m[1][3],\na20=m[2][0],a21=m[2][1],a22=m[2][2],a23=m[2][3],\na30=m[3][0],a31=m[3][1],a32=m[3][2],a33=m[3][3],\nb00=a00*a11-a01*a10,\nb01=a00*a12-a02*a10,\nb02=a00*a13-a03*a10,\nb03=a01*a12-a02*a11,\nb04=a01*a13-a03*a11,\nb05=a02*a13-a03*a12,\nb06=a20*a31-a21*a30,\nb07=a20*a32-a22*a30,\nb08=a20*a33-a23*a30,\nb09=a21*a32-a22*a31,\nb10=a21*a33-a23*a31,\nb11=a22*a33-a23*a32,\ndet=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;\nmat4 mi=mat4(\na11*b11-a12*b10+a13*b09,\na02*b10-a01*b11-a03*b09,\na31*b05-a32*b04+a33*b03,\na22*b04-a21*b05-a23*b03,\na12*b08-a10*b11-a13*b07,\na00*b11-a02*b08+a03*b07,\na32*b02-a30*b05-a33*b01,\na20*b05-a22*b02+a23*b01,\na10*b10-a11*b08+a13*b06,\na01*b08-a00*b10-a03*b06,\na30*b04-a31*b02+a33*b00,\na21*b02-a20*b04-a23*b00,\na11*b07-a10*b09-a12*b06,\na00*b09-a01*b07+a02*b06,\na31*b01-a30*b03-a32*b00,\na20*b03-a21*b01+a22*b00)/det;\nreturn mat4(mi[0][0],mi[1][0],mi[2][0],mi[3][0],\nmi[0][1],mi[1][1],mi[2][1],mi[3][1],\nmi[0][2],mi[1][2],mi[2][2],mi[3][2],\nmi[0][3],mi[1][3],mi[2][3],mi[3][3]);\n}\n#endif\n#endif\nvec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)\n{\n#ifdef NORMALXYSCALE\nnormal=normalize(normal*vec3(scale,scale,1.0));\n#endif\nreturn normalize(cotangentFrame*normal);\n}\nvec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)\n{\nreturn perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);\n}\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)\n{\nvec3 dp1=dFdx(p);\nvec3 dp2=dFdy(p);\nvec2 duv1=dFdx(uv);\nvec2 duv2=dFdy(uv);\nvec3 dp2perp=cross(dp2,normal);\nvec3 dp1perp=cross(normal,dp1);\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\nvec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;\ntangent*=tangentSpaceParams.x;\nbitangent*=tangentSpaceParams.y;\nfloat det=max(dot(tangent,tangent),dot(bitangent,bitangent));\nfloat invmax=det==0.0 ? 0.0 : inversesqrt(det);\nreturn mat3(tangent*invmax,bitangent*invmax,normal);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name18]=shader18;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragmentFunctions.js
var name19="bumpFragmentFunctions";var shader19="#if defined(BUMP)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_SAMPLERNAME_,bump)\n#endif\n#if defined(DETAIL)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_SAMPLERNAME_,detail)\n#endif\n#if defined(BUMP) && defined(PARALLAX)\nconst float minSamples=4.;\nconst float maxSamples=15.;\nconst int iMaxSamples=15;\nvec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {\nfloat parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;\nparallaxLimit*=parallaxScale;\nvec2 vOffsetDir=normalize(vViewDirCoT.xy);\nvec2 vMaxOffset=vOffsetDir*parallaxLimit;\nfloat numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));\nfloat stepSize=1.0/numSamples;\nfloat currRayHeight=1.0;\nvec2 vCurrOffset=vec2(0,0);\nvec2 vLastOffset=vec2(0,0);\nfloat lastSampledHeight=1.0;\nfloat currSampledHeight=1.0;\nbool keepWorking=true;\nfor (int i=0; i<iMaxSamples; i++)\n{\ncurrSampledHeight=texture2D(bumpSampler,texCoord+vCurrOffset).w;\nif (!keepWorking)\n{\n}\nelse if (currSampledHeight>currRayHeight)\n{\nfloat delta1=currSampledHeight-currRayHeight;\nfloat delta2=(currRayHeight+stepSize)-lastSampledHeight;\nfloat ratio=delta1/(delta1+delta2);\nvCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;\nkeepWorking=false;\n}\nelse\n{\ncurrRayHeight-=stepSize;\nvLastOffset=vCurrOffset;\nvCurrOffset+=stepSize*vMaxOffset;\nlastSampledHeight=currSampledHeight;\n}\n}\nreturn vCurrOffset;\n}\nvec2 parallaxOffset(vec3 viewDir,float heightScale)\n{\nfloat height=texture2D(bumpSampler,vBumpUV).w;\nvec2 texCoordOffset=heightScale*viewDir.xy*height;\nreturn -texCoordOffset;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name19]=shader19;// node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneFragmentDeclaration.js
var name20="clipPlaneFragmentDeclaration";var shader20="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";ShaderStore.IncludesShadersStore[name20]=shader20;// node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthDeclaration.js
var name21="logDepthDeclaration";var shader21="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;\nvarying float vFragmentDepth;\n#endif\n";ShaderStore.IncludesShadersStore[name21]=shader21;// node_modules/@babylonjs/core/Shaders/ShadersInclude/fogFragmentDeclaration.js
var name22="fogFragmentDeclaration";var shader22="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;\nuniform vec3 vFogColor;\nvarying vec3 vFogDistance;\nfloat CalcFogFactor()\n{\nfloat fogCoeff=1.0;\nfloat fogStart=vFogInfos.y;\nfloat fogEnd=vFogInfos.z;\nfloat fogDensity=vFogInfos.w;\nfloat fogDistance=length(vFogDistance);\nif (FOGMODE_LINEAR==vFogInfos.x)\n{\nfogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);\n}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDensity);\n}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{\nfogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);\n}\nreturn clamp(fogCoeff,0.0,1.0);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name22]=shader22;// node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneFragment.js
var name23="clipPlaneFragment";var shader23="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{\ndiscard;\n}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{\ndiscard;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name23]=shader23;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpFragment.js
var name24="bumpFragment";var shader24="vec2 uvOffset=vec2(0.0,0.0);\n#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)\n#ifdef NORMALXYSCALE\nfloat normalScale=1.0;\n#elif defined(BUMP)\nfloat normalScale=vBumpInfos.y;\n#else\nfloat normalScale=1.0;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#elif defined(BUMP)\nvec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vTangentSpaceParams);\n#else\nvec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;\nmat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#elif defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBN=vTBN;\n#else\nvec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;\nmat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));\n#endif\n#endif\n#ifdef PARALLAX\nmat3 invTBN=transposeMat3(TBN);\n#ifdef PARALLAXOCCLUSION\nuvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);\n#else\nuvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);\n#endif\n#endif\n#ifdef DETAIL\nvec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);\nvec2 detailNormalRG=detailColor.wy*2.0-1.0;\nfloat detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));\nvec3 detailNormal=vec3(detailNormalRG,detailNormalB);\n#endif\n#ifdef BUMP\n#ifdef OBJECTSPACE_NORMALMAP\n#define CUSTOM_FRAGMENT_BUMP_FRAGMENT\nnormalW=normalize(texture2D(bumpSampler,vBumpUV).xyz *2.0-1.0);\nnormalW=normalize(mat3(normalMatrix)*normalW);\n#elif !defined(DETAIL)\nnormalW=perturbNormal(TBN,texture2D(bumpSampler,vBumpUV+uvOffset).xyz,vBumpInfos.y);\n#else\nvec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;\n#if DETAIL_NORMALBLENDMETHOD==0 \ndetailNormal.xy*=vDetailInfos.z;\nvec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));\n#elif DETAIL_NORMALBLENDMETHOD==1 \ndetailNormal.xy*=vDetailInfos.z;\nbumpNormal+=vec3(0.0,0.0,1.0);\ndetailNormal*=vec3(-1.0,-1.0,1.0);\nvec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;\n#endif\nnormalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);\n#endif\n#elif defined(DETAIL)\ndetailNormal.xy*=vDetailInfos.z;\nnormalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);\n#endif\n";ShaderStore.IncludesShadersStore[name24]=shader24;// node_modules/@babylonjs/core/Shaders/ShadersInclude/depthPrePass.js
var name25="depthPrePass";var shader25="#ifdef DEPTHPREPASS\ngl_FragColor=vec4(0.,0.,0.,1.0);\nreturn;\n#endif\n";ShaderStore.IncludesShadersStore[name25]=shader25;// node_modules/@babylonjs/core/Shaders/ShadersInclude/lightFragment.js
var name26="lightFragment";var shader26="#ifdef LIGHT{X}\n#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})\n#else\n#ifdef PBR\n#ifdef SPOTLIGHT{X}\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(POINTLIGHT{X})\npreInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(HEMILIGHT{X})\npreInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#elif defined(DIRLIGHT{X})\npreInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);\n#endif\npreInfo.NdotV=NdotV;\n#ifdef SPOTLIGHT{X}\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\npreInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\npreInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\npreInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);\n#endif\n#elif defined(POINTLIGHT{X})\n#ifdef LIGHT_FALLOFF_GLTF{X}\npreInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);\n#elif defined(LIGHT_FALLOFF_PHYSICAL{X})\npreInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);\n#elif defined(LIGHT_FALLOFF_STANDARD{X})\npreInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);\n#else\npreInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);\n#endif\n#else\npreInfo.attenuation=1.0;\n#endif\n#ifdef HEMILIGHT{X}\npreInfo.roughness=roughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#ifdef IRIDESCENCE\npreInfo.iridescenceIntensity=iridescenceIntensity;\n#endif\n#ifdef HEMILIGHT{X}\ninfo.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);\n#elif defined(SS_TRANSLUCENCY)\ninfo.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);\n#else\ninfo.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef SPECULARTERM\n#ifdef ANISOTROPIC\ninfo.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#else\ninfo.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#endif\n#ifdef SHEEN\n#ifdef SHEEN_LINKWITHALBEDO\npreInfo.roughness=sheenOut.sheenIntensity;\n#else\n#ifdef HEMILIGHT{X}\npreInfo.roughness=sheenOut.sheenRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\n#endif\ninfo.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);\n#endif\n#ifdef CLEARCOAT\n#ifdef HEMILIGHT{X}\npreInfo.roughness=clearcoatOut.clearCoatRoughness;\n#else\npreInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);\n#endif\ninfo.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);\n#ifdef CLEARCOAT_TINT\nabsorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);\ninfo.diffuse*=absorption;\n#ifdef SPECULARTERM\ninfo.specular*=absorption;\n#endif\n#endif\ninfo.diffuse*=info.clearCoat.w;\n#ifdef SPECULARTERM\ninfo.specular*=info.clearCoat.w;\n#endif\n#ifdef SHEEN\ninfo.sheen*=info.clearCoat.w;\n#endif\n#endif\n#else\n#ifdef SPOTLIGHT{X}\ninfo=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#elif defined(HEMILIGHT{X})\ninfo=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);\n#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})\ninfo=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);\n#endif\n#endif\n#ifdef PROJECTEDLIGHTTEXTURE{X}\ninfo.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});\n#endif\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) \n{\n#ifdef SHADOWCSM_RIGHTHANDED{X}\ndiff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;\n#else\ndiff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;\n#endif\nif (diff{X}>=0.) {\nindex{X}=i;\nbreak;\n}\n}\n#ifdef SHADOWCSMUSESHADOWMAXZ{X}\nif (index{X}>=0)\n#endif\n{\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nshadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nshadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];\n#endif\n#ifndef SHADOWCSMNOBLEND{X}\nfloat frustumLength=frustumLengths{X}[index{X}];\nfloat diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};\nif (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)\n{\nindex{X}+=1;\nfloat nextShadow=0.;\n#if defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nnextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#elif defined(SHADOWMEDIUMQUALITY{X})\nnextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#else\nnextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});\n#endif\n#else\nnextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\nshadow=mix(nextShadow,shadow,diffRatio);\n#ifdef SHADOWCSMDEBUG{X}\nshadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);\n#endif\n}\n#endif\n}\n#elif defined(SHADOWCLOSEESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWESM{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);\n#else\nshadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPOISSON{X})\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCF{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#elif defined(SHADOWPCSS{X})\n#if defined(SHADOWLOWQUALITY{X})\nshadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#elif defined(SHADOWMEDIUMQUALITY{X})\nshadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#else\nshadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#else\n#if defined(SHADOWCUBE{X})\nshadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);\n#else\nshadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);\n#endif\n#endif\n#ifdef SHADOWONLY\n#ifndef SHADOWINUSE\n#define SHADOWINUSE\n#endif\nglobalShadow+=shadow;\nshadowLightCount+=1.0;\n#endif\n#else\nshadow=1.;\n#endif\n#ifndef SHADOWONLY\n#ifdef CUSTOMUSERLIGHTING\ndiffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);\n#ifdef SPECULARTERM\nspecularBase+=computeCustomSpecularLighting(info,specularBase,shadow);\n#endif\n#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})\ndiffuseBase+=lightmapColor.rgb*shadow;\n#ifdef SPECULARTERM\n#ifndef LIGHTMAPNOSPECULAR{X}\nspecularBase+=info.specular*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifndef LIGHTMAPNOSPECULAR{X}\nclearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;\n#endif\n#endif\n#ifdef SHEEN\n#ifndef LIGHTMAPNOSPECULAR{X}\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#else\n#ifdef SHADOWCSMDEBUG{X}\ndiffuseBase+=info.diffuse*shadowDebug{X};\n#else \ndiffuseBase+=info.diffuse*shadow;\n#endif\n#ifdef SPECULARTERM\nspecularBase+=info.specular*shadow;\n#endif\n#ifdef CLEARCOAT\nclearCoatBase+=info.clearCoat.rgb*shadow;\n#endif\n#ifdef SHEEN\nsheenBase+=info.sheen.rgb*shadow;\n#endif\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name26]=shader26;// node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthFragment.js
var name27="logDepthFragment";var shader27="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";ShaderStore.IncludesShadersStore[name27]=shader27;// node_modules/@babylonjs/core/Shaders/ShadersInclude/fogFragment.js
var name28="fogFragment";var shader28="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";ShaderStore.IncludesShadersStore[name28]=shader28;// node_modules/@babylonjs/core/Shaders/ShadersInclude/oitFragment.js
var name29="oitFragment";var shader29="#ifdef ORDER_INDEPENDENT_TRANSPARENCY\nfloat fragDepth=gl_FragCoord.z; \n#ifdef ORDER_INDEPENDENT_TRANSPARENCY_16BITS\nuint halfFloat=packHalf2x16(vec2(fragDepth));\nvec2 full=unpackHalf2x16(halfFloat);\nfragDepth=full.x;\n#endif\nivec2 fragCoord=ivec2(gl_FragCoord.xy);\nvec2 lastDepth=texelFetch(oitDepthSampler,fragCoord,0).rg;\nvec4 lastFrontColor=texelFetch(oitFrontColorSampler,fragCoord,0);\ndepth.rg=vec2(-MAX_DEPTH);\nfrontColor=lastFrontColor;\nbackColor=vec4(0.0);\n#ifdef USE_REVERSE_DEPTHBUFFER\nfloat furthestDepth=-lastDepth.x;\nfloat nearestDepth=lastDepth.y;\n#else\nfloat nearestDepth=-lastDepth.x;\nfloat furthestDepth=lastDepth.y;\n#endif\nfloat alphaMultiplier=1.0-lastFrontColor.a;\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth>nearestDepth || fragDepth<furthestDepth) {\n#else\nif (fragDepth<nearestDepth || fragDepth>furthestDepth) {\n#endif\nreturn;\n}\n#ifdef USE_REVERSE_DEPTHBUFFER\nif (fragDepth<nearestDepth && fragDepth>furthestDepth) {\n#else\nif (fragDepth>nearestDepth && fragDepth<furthestDepth) {\n#endif\ndepth.rg=vec2(-fragDepth,fragDepth);\nreturn;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name29]=shader29;// node_modules/@babylonjs/core/Shaders/default.fragment.js
var name30="defaultPixelShader";var shader30="#include<__decl__defaultFragment>\n#if defined(BUMP) || !defined(NORMAL)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\n#include<oitDeclaration>\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#define RECIPROCAL_PI2 0.15915494\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#include<helperFunctions>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<lightsFragmentFunctions>\n#include<shadowsFragmentFunctions>\n#include<samplerFragmentDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_SAMPLERNAME_,diffuse)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#ifdef REFRACTION\n#ifdef REFRACTIONMAP_3D\nuniform samplerCube refractionCubeSampler;\n#else\nuniform sampler2D refraction2DSampler;\n#endif\n#endif\n#if defined(SPECULARTERM)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_SAMPLERNAME_,specular)\n#endif\n#include<fresnelFunction>\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\nuniform samplerCube reflectionCubeSampler;\n#else\nuniform sampler2D reflection2DSampler;\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#include<reflectionFunction>\n#endif\n#include<imageProcessingDeclaration>\n#include<imageProcessingFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\nvec4 baseColor=vec4(1.,1.,1.,1.);\nvec3 diffuseColor=vDiffuseColor.rgb;\nfloat alpha=vDiffuseColor.a;\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));\n#endif\n#include<bumpFragment>\n#ifdef TWOSIDEDLIGHTING\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n#ifdef DIFFUSE\nbaseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);\n#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)\nif (baseColor.a<alphaCutOff)\ndiscard;\n#endif\n#ifdef ALPHAFROMDIFFUSE\nalpha*=baseColor.a;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\nbaseColor.rgb*=vDiffuseInfos.y;\n#endif\n#include<depthPrePass>\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nbaseColor.rgb*=vColor.rgb;\n#endif\n#ifdef DETAIL\nbaseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE\nvec3 baseAmbientColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nbaseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n#ifdef SPECULARTERM\nfloat glossiness=vSpecularColor.a;\nvec3 specularColor=vSpecularColor.rgb;\n#ifdef SPECULAR\nvec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);\nspecularColor=specularMapColor.rgb;\n#ifdef GLOSSINESS\nglossiness=glossiness*specularMapColor.a;\n#endif\n#endif\n#else\nfloat glossiness=0.;\n#endif\nvec3 diffuseBase=vec3(0.,0.,0.);\nlightingInfo info;\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\nfloat shadow=1.;\n#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n#include<lightFragment>[0..maxSimultaneousLights]\nvec4 refractionColor=vec4(0.,0.,0.,1.);\n#ifdef REFRACTION\nvec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));\n#ifdef REFRACTIONMAP_3D\n#ifdef USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,vRefractionSize,vRefractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nif (dot(refractionVector,viewDirectionW)<1.0) {\nrefractionColor=textureCube(refractionCubeSampler,refractionVector);\n}\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\nrefractionColor=texture2D(refraction2DSampler,refractionCoords);\n#endif\n#ifdef RGBDREFRACTION\nrefractionColor.rgb=fromRGBD(refractionColor);\n#endif\n#ifdef IS_REFRACTION_LINEAR\nrefractionColor.rgb=toGammaSpace(refractionColor.rgb);\n#endif\nrefractionColor.rgb*=vRefractionInfos.x;\n#endif\nvec4 reflectionColor=vec4(0.,0.,0.,1.);\n#ifdef REFLECTION\nvec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nvReflectionUVW.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\n#ifdef ROUGHNESS\nfloat bias=vReflectionInfos.y;\n#ifdef SPECULARTERM\n#ifdef SPECULAR\n#ifdef GLOSSINESS\nbias*=(1.0-specularMapColor.a);\n#endif\n#endif\n#endif\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);\n#else\nreflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);\n#endif\n#else\nvec2 coords=vReflectionUVW.xy;\n#ifdef REFLECTIONMAP_PROJECTION\ncoords/=vReflectionUVW.z;\n#endif\ncoords.y=1.0-coords.y;\nreflectionColor=texture2D(reflection2DSampler,coords);\n#endif\n#ifdef RGBDREFLECTION\nreflectionColor.rgb=fromRGBD(reflectionColor);\n#endif\n#ifdef IS_REFLECTION_LINEAR\nreflectionColor.rgb=toGammaSpace(reflectionColor.rgb);\n#endif\nreflectionColor.rgb*=vReflectionInfos.x;\n#ifdef REFLECTIONFRESNEL\nfloat reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);\n#ifdef REFLECTIONFRESNELFROMSPECULAR\n#ifdef SPECULARTERM\nreflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#else\nreflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;\n#endif\n#endif\n#endif\n#ifdef REFRACTIONFRESNEL\nfloat refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);\nrefractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#ifdef OPACITYRGB\nopacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);\nalpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;\n#else\nalpha*=opacityMap.a*vOpacityInfos.y;\n#endif\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#ifdef OPACITYFRESNEL\nfloat opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);\nalpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;\n#endif\n#ifdef ALPHATEST\n#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS\nif (alpha<alphaCutOff)\ndiscard;\n#endif\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\nvec3 emissiveColor=vEmissiveColor;\n#ifdef EMISSIVE\nemissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;\n#endif\n#ifdef EMISSIVEFRESNEL\nfloat emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);\nemissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;\n#endif\n#ifdef DIFFUSEFRESNEL\nfloat diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);\ndiffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\n#ifdef LINKEMISSIVEWITHDIFFUSE\nvec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#else\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;\n#endif\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase*specularColor;\n#ifdef SPECULAROVERALPHA\nalpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#else\nvec3 finalSpecular=vec3(0.0);\n#endif\n#ifdef REFLECTIONOVERALPHA\nalpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);\n#endif\n#ifdef EMISSIVEASILLUMINATION\nvec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);\n#else\nvec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);\n#endif\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\ncolor.rgb*=lightmapColor.rgb;\n#else\ncolor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FOG\ncolor.rgb=max(color.rgb,0.);\n#include<logDepthFragment>\n#include<fogFragment>\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ncolor.rgb=toLinearSpace(color.rgb);\n#else\n#ifdef IMAGEPROCESSING\ncolor.rgb=toLinearSpace(color.rgb);\ncolor=applyImageProcessing(color);\n#endif\n#endif\ncolor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\ncolor.rgb*=color.a;\n#endif\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;\ngl_FragData[0]=color; \n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_IRRADIANCE\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#if defined(SPECULARTERM)\n#if defined(SPECULAR)\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularMapColor))*writeGeometryInfo; \n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(toLinearSpace(specularColor),1.0)*writeGeometryInfo;\n#endif\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,1.0)*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=color;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=color.rgb*color.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-color.a);\n} else {\nbackColor+=color;\n}\n#endif\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";ShaderStore.ShadersStore[name30]=shader30;// node_modules/@babylonjs/core/Shaders/ShadersInclude/defaultVertexDeclaration.js
var name31="defaultVertexDeclaration";var shader31="uniform mat4 viewProjection;\nuniform mat4 view;\n#ifdef DIFFUSE\nuniform mat4 diffuseMatrix;\nuniform vec2 vDiffuseInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec2 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#if defined(SPECULAR) && defined(SPECULARTERM)\nuniform vec2 vSpecularInfos;\nuniform mat4 specularMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef REFLECTION\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";ShaderStore.IncludesShadersStore[name31]=shader31;// node_modules/@babylonjs/core/Shaders/ShadersInclude/uvAttributeDeclaration.js
var name32="uvAttributeDeclaration";var shader32="#ifdef UV{X}\nattribute vec2 uv{X};\n#endif\n";ShaderStore.IncludesShadersStore[name32]=shader32;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bonesDeclaration.js
var name33="bonesDeclaration";var shader33="#if NUM_BONE_INFLUENCERS>0\nattribute vec4 matricesIndices;\nattribute vec4 matricesWeights;\n#if NUM_BONE_INFLUENCERS>4\nattribute vec4 matricesIndicesExtra;\nattribute vec4 matricesWeightsExtra;\n#endif\n#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#ifdef BONETEXTURE\nuniform sampler2D boneSampler;\nuniform float boneTextureWidth;\n#else\nuniform mat4 mBones[BonesPerMesh];\n#ifdef BONES_VELOCITY_ENABLED\nuniform mat4 mPreviousBones[BonesPerMesh];\n#endif\n#endif\n#ifdef BONETEXTURE\n#define inline\nmat4 readMatrixFromRawSampler(sampler2D smp,float index)\n{\nfloat offset=index *4.0;\nfloat dx=1.0/boneTextureWidth;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name33]=shader33;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bakedVertexAnimationDeclaration.js
var name34="bakedVertexAnimationDeclaration";var shader34="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\nuniform float bakedVertexAnimationTime;\nuniform vec2 bakedVertexAnimationTextureSizeInverted;\nuniform vec4 bakedVertexAnimationSettings;\nuniform sampler2D bakedVertexAnimationTexture;\n#ifdef INSTANCES\nattribute vec4 bakedVertexAnimationSettingsInstanced;\n#endif\n#define inline\nmat4 readMatrixFromRawSamplerVAT(sampler2D smp,float index,float frame)\n{\nfloat offset=index*4.0;\nfloat frameUV=(frame+0.5)*bakedVertexAnimationTextureSizeInverted.y;\nfloat dx=bakedVertexAnimationTextureSizeInverted.x;\nvec4 m0=texture2D(smp,vec2(dx*(offset+0.5),frameUV));\nvec4 m1=texture2D(smp,vec2(dx*(offset+1.5),frameUV));\nvec4 m2=texture2D(smp,vec2(dx*(offset+2.5),frameUV));\nvec4 m3=texture2D(smp,vec2(dx*(offset+3.5),frameUV));\nreturn mat4(m0,m1,m2,m3);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name34]=shader34;// node_modules/@babylonjs/core/Shaders/ShadersInclude/instancesDeclaration.js
var name35="instancesDeclaration";var shader35="#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#ifdef INSTANCESCOLOR\nattribute vec4 instanceColor;\n#endif\n#if defined(THIN_INSTANCES) && !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nattribute vec4 previousWorld0;\nattribute vec4 previousWorld1;\nattribute vec4 previousWorld2;\nattribute vec4 previousWorld3;\n#ifdef THIN_INSTANCES\nuniform mat4 previousWorld;\n#endif\n#endif\n#else\n#if !defined(WORLD_UBO)\nuniform mat4 world;\n#endif\n#if defined(VELOCITY) || defined(PREPASS_VELOCITY)\nuniform mat4 previousWorld;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name35]=shader35;// node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassVertexDeclaration.js
var name36="prePassVertexDeclaration";var shader36="#ifdef PREPASS\n#ifdef PREPASS_DEPTH\nvarying vec3 vViewPos;\n#endif\n#ifdef PREPASS_VELOCITY\nuniform mat4 previousViewProjection;\nvarying vec4 vCurrentPosition;\nvarying vec4 vPreviousPosition;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name36]=shader36;// node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerVertexDeclaration.js
var name37="samplerVertexDeclaration";var shader37="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n";ShaderStore.IncludesShadersStore[name37]=shader37;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpVertexDeclaration.js
var name38="bumpVertexDeclaration";var shader38="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL) \nvarying mat3 vTBN;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name38]=shader38;// node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneVertexDeclaration.js
var name39="clipPlaneVertexDeclaration";var shader39="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;\nvarying float fClipDistance6;\n#endif\n";ShaderStore.IncludesShadersStore[name39]=shader39;// node_modules/@babylonjs/core/Shaders/ShadersInclude/fogVertexDeclaration.js
var name40="fogVertexDeclaration";var shader40="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";ShaderStore.IncludesShadersStore[name40]=shader40;// node_modules/@babylonjs/core/Shaders/ShadersInclude/lightVxFragmentDeclaration.js
var name41="lightVxFragmentDeclaration";var shader41="#ifdef LIGHT{X}\nuniform vec4 vLightData{X};\nuniform vec4 vLightDiffuse{X};\n#ifdef SPECULARTERM\nuniform vec4 vLightSpecular{X};\n#else\nvec4 vLightSpecular{X}=vec4(0.);\n#endif\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\nuniform vec4 shadowsInfo{X};\nuniform vec2 depthValues{X};\n#endif\n#ifdef SPOTLIGHT{X}\nuniform vec4 vLightDirection{X};\nuniform vec4 vLightFalloff{X};\n#elif defined(POINTLIGHT{X})\nuniform vec4 vLightFalloff{X};\n#elif defined(HEMILIGHT{X})\nuniform vec3 vLightGround{X};\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name41]=shader41;// node_modules/@babylonjs/core/Shaders/ShadersInclude/lightVxUboDeclaration.js
var name42="lightVxUboDeclaration";var shader42="#ifdef LIGHT{X}\nuniform Light{X}\n{\nvec4 vLightData;\nvec4 vLightDiffuse;\nvec4 vLightSpecular;\n#ifdef SPOTLIGHT{X}\nvec4 vLightDirection;\nvec4 vLightFalloff;\n#elif defined(POINTLIGHT{X})\nvec4 vLightFalloff;\n#elif defined(HEMILIGHT{X})\nvec3 vLightGround;\n#endif\nvec4 shadowsInfo;\nvec2 depthValues;\n} light{X};\n#ifdef SHADOW{X}\n#ifdef SHADOWCSM{X}\nuniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];\nvarying vec4 vPositionFromCamera{X};\n#elif defined(SHADOWCUBE{X})\n#else\nvarying vec4 vPositionFromLight{X};\nvarying float vDepthMetric{X};\nuniform mat4 lightMatrix{X};\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name42]=shader42;// node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexGlobalDeclaration.js
var name43="morphTargetsVertexGlobalDeclaration";var shader43="#ifdef MORPHTARGETS\nuniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];\n#ifdef MORPHTARGETS_TEXTURE \nprecision mediump sampler2DArray; \nuniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];\nuniform vec3 morphTargetTextureInfo;\nuniform sampler2DArray morphTargets;\nvec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)\n{ \nfloat y=floor(vertexIndex/morphTargetTextureInfo.y);\nfloat x=vertexIndex-y*morphTargetTextureInfo.y;\nvec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);\nreturn texture(morphTargets,textureUV).xyz;\n}\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name43]=shader43;// node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexDeclaration.js
var name44="morphTargetsVertexDeclaration";var shader44="#ifdef MORPHTARGETS\n#ifndef MORPHTARGETS_TEXTURE\nattribute vec3 position{X};\n#ifdef MORPHTARGETS_NORMAL\nattribute vec3 normal{X};\n#endif\n#ifdef MORPHTARGETS_TANGENT\nattribute vec3 tangent{X};\n#endif\n#ifdef MORPHTARGETS_UV\nattribute vec2 uv_{X};\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name44]=shader44;// node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertexGlobal.js
var name45="morphTargetsVertexGlobal";var shader45="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE\nfloat vertexID;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name45]=shader45;// node_modules/@babylonjs/core/Shaders/ShadersInclude/morphTargetsVertex.js
var name46="morphTargetsVertex";var shader46="#ifdef MORPHTARGETS\n#ifdef MORPHTARGETS_TEXTURE \nvertexID=float(gl_VertexID)*morphTargetTextureInfo.x;\npositionUpdated+=(readVector3FromRawSampler({X},vertexID)-position)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(readVector3FromRawSampler({X},vertexID) -normal)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(readVector3FromRawSampler({X},vertexID).xy-uv)*morphTargetInfluences[{X}];\nvertexID+=1.0;\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(readVector3FromRawSampler({X},vertexID) -tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#else\npositionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];\n#ifdef MORPHTARGETS_NORMAL\nnormalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_TANGENT\ntangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];\n#endif\n#ifdef MORPHTARGETS_UV\nuvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name46]=shader46;// node_modules/@babylonjs/core/Shaders/ShadersInclude/instancesVertex.js
var name47="instancesVertex";var shader47="#ifdef INSTANCES\nmat4 finalWorld=mat4(world0,world1,world2,world3);\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=mat4(previousWorld0,previousWorld1,previousWorld2,previousWorld3);\n#endif\n#ifdef THIN_INSTANCES\nfinalWorld=world*finalWorld;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nfinalPreviousWorld=previousWorld*finalPreviousWorld;\n#endif\n#endif\n#else\nmat4 finalWorld=world;\n#if defined(PREPASS_VELOCITY) || defined(VELOCITY)\nmat4 finalPreviousWorld=previousWorld;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name47]=shader47;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bonesVertex.js
var name48="bonesVertex";var shader48="#ifndef BAKED_VERTEX_ANIMATION_TEXTURE\n#if NUM_BONE_INFLUENCERS>0\nmat4 influence;\n#ifdef BONETEXTURE\ninfluence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];\n#endif\n#else\ninfluence=mBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\ninfluence+=mBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\ninfluence+=mBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\ninfluence+=mBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\ninfluence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\ninfluence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\ninfluence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\ninfluence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\n#endif\nfinalWorld=finalWorld*influence;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name48]=shader48;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bakedVertexAnimation.js
var name49="bakedVertexAnimation";var shader49="#ifdef BAKED_VERTEX_ANIMATION_TEXTURE\n{\n#ifdef INSTANCES\n#define BVASNAME bakedVertexAnimationSettingsInstanced\n#else\n#define BVASNAME bakedVertexAnimationSettings\n#endif\nfloat VATStartFrame=BVASNAME.x;\nfloat VATEndFrame=BVASNAME.y;\nfloat VATOffsetFrame=BVASNAME.z;\nfloat VATSpeed=BVASNAME.w;\nfloat totalFrames=VATEndFrame-VATStartFrame+1.0;\nfloat time=bakedVertexAnimationTime*VATSpeed/totalFrames;\nfloat frameCorrection=time<1.0 ? 0.0 : 1.0;\nfloat numOfFrames=totalFrames-frameCorrection;\nfloat VATFrameNum=fract(time)*numOfFrames;\nVATFrameNum=mod(VATFrameNum+VATOffsetFrame,numOfFrames);\nVATFrameNum=floor(VATFrameNum);\nVATFrameNum+=VATStartFrame+frameCorrection;\nmat4 VATInfluence;\nVATInfluence=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[0],VATFrameNum)*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[1],VATFrameNum)*matricesWeights[1];\n#endif\n#if NUM_BONE_INFLUENCERS>2\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[2],VATFrameNum)*matricesWeights[2];\n#endif\n#if NUM_BONE_INFLUENCERS>3\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndices[3],VATFrameNum)*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[0],VATFrameNum)*matricesWeightsExtra[0];\n#endif\n#if NUM_BONE_INFLUENCERS>5\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[1],VATFrameNum)*matricesWeightsExtra[1];\n#endif\n#if NUM_BONE_INFLUENCERS>6\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[2],VATFrameNum)*matricesWeightsExtra[2];\n#endif\n#if NUM_BONE_INFLUENCERS>7\nVATInfluence+=readMatrixFromRawSamplerVAT(bakedVertexAnimationTexture,matricesIndicesExtra[3],VATFrameNum)*matricesWeightsExtra[3];\n#endif\nfinalWorld=finalWorld*VATInfluence;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name49]=shader49;// node_modules/@babylonjs/core/Shaders/ShadersInclude/prePassVertex.js
var name50="prePassVertex";var shader50="#ifdef PREPASS_DEPTH\nvViewPos=(view*worldPos).rgb;\n#endif\n#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*worldPos;\n#if NUM_BONE_INFLUENCERS>0\nmat4 previousInfluence;\npreviousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];\n#if NUM_BONE_INFLUENCERS>1\npreviousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];\n#endif \n#if NUM_BONE_INFLUENCERS>2\npreviousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];\n#endif \n#if NUM_BONE_INFLUENCERS>3\npreviousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];\n#endif\n#if NUM_BONE_INFLUENCERS>4\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];\n#endif \n#if NUM_BONE_INFLUENCERS>5\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];\n#endif \n#if NUM_BONE_INFLUENCERS>6\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];\n#endif \n#if NUM_BONE_INFLUENCERS>7\npreviousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];\n#endif\nvPreviousPosition=previousViewProjection*finalPreviousWorld*previousInfluence*vec4(positionUpdated,1.0);\n#else\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name50]=shader50;// node_modules/@babylonjs/core/Shaders/ShadersInclude/uvVariableDeclaration.js
var name51="uvVariableDeclaration";var shader51="#if !defined(UV{X}) && defined(MAINUV{X})\nvec2 uv{X}=vec2(0.,0.);\n#endif\n#ifdef MAINUV{X}\nvMainUV{X}=uv{X};\n#endif\n";ShaderStore.IncludesShadersStore[name51]=shader51;// node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerVertexImplementation.js
var name52="samplerVertexImplementation";var shader52="#if defined(_DEFINENAME_) && _DEFINENAME_DIRECTUV==0\nif (v_INFONAME_==0.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uvUpdated,1.0,0.0));\n}\n#ifdef UV2\nelse if (v_INFONAME_==1.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv2,1.0,0.0));\n}\n#endif\n#ifdef UV3\nelse if (v_INFONAME_==2.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv3,1.0,0.0));\n}\n#endif\n#ifdef UV4\nelse if (v_INFONAME_==3.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv4,1.0,0.0));\n}\n#endif\n#ifdef UV5\nelse if (v_INFONAME_==4.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv5,1.0,0.0));\n}\n#endif\n#ifdef UV6\nelse if (v_INFONAME_==5.)\n{\nv_VARYINGNAME_UV=vec2(_MATRIXNAME_Matrix*vec4(uv6,1.0,0.0));\n}\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name52]=shader52;// node_modules/@babylonjs/core/Shaders/ShadersInclude/bumpVertex.js
var name53="bumpVertex";var shader53="#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#if defined(TANGENT) && defined(NORMAL)\nvec3 tbnNormal=normalize(normalUpdated);\nvec3 tbnTangent=normalize(tangentUpdated.xyz);\nvec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;\nvTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name53]=shader53;// node_modules/@babylonjs/core/Shaders/ShadersInclude/clipPlaneVertex.js
var name54="clipPlaneVertex";var shader54="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";ShaderStore.IncludesShadersStore[name54]=shader54;// node_modules/@babylonjs/core/Shaders/ShadersInclude/fogVertex.js
var name55="fogVertex";var shader55="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";ShaderStore.IncludesShadersStore[name55]=shader55;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowsVertex.js
var name56="shadowsVertex";var shader56="#ifdef SHADOWS\n#if defined(SHADOWCSM{X})\nvPositionFromCamera{X}=view*worldPos;\nfor (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {\nvPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}[i]=(-vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}[i]=(vPositionFromLight{X}[i].z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n}\n#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})\nvPositionFromLight{X}=lightMatrix{X}*worldPos;\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric{X}=(-vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#else\nvDepthMetric{X}=(vPositionFromLight{X}.z+light{X}.depthValues.x)/light{X}.depthValues.y;\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name56]=shader56;// node_modules/@babylonjs/core/Shaders/ShadersInclude/vertexColorMixing.js
var name57="vertexColorMixing";var shader57="#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvColor=vec4(1.0);\n#ifdef VERTEXCOLOR\n#ifdef VERTEXALPHA\nvColor*=color;\n#else\nvColor.rgb*=color.rgb;\n#endif\n#endif\n#ifdef INSTANCESCOLOR\nvColor*=instanceColor;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name57]=shader57;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pointCloudVertex.js
var name58="pointCloudVertex";var shader58="#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n";ShaderStore.IncludesShadersStore[name58]=shader58;// node_modules/@babylonjs/core/Shaders/ShadersInclude/logDepthVertex.js
var name59="logDepthVertex";var shader59="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;\ngl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";ShaderStore.IncludesShadersStore[name59]=shader59;// node_modules/@babylonjs/core/Shaders/default.vertex.js
var name60="defaultVertexShader";var shader60="#include<__decl__defaultVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<mainUVVaryingDeclaration>[1..7]\n#include<samplerVertexDeclaration>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#if defined(SPECULARTERM)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular)\n#endif\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\nvarying vec3 vPositionW;\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,DIFFUSE,_VARYINGNAME_,Diffuse,_MATRIXNAME_,diffuse,_INFONAME_,DiffuseInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#if defined(SPECULARTERM)\n#include<samplerVertexImplementation>(_DEFINENAME_,SPECULAR,_VARYINGNAME_,Specular,_MATRIXNAME_,specular,_INFONAME_,SpecularInfos.x)\n#endif\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#include<pointCloudVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}\n";ShaderStore.ShadersStore[name60]=shader60;// node_modules/@babylonjs/core/Materials/effectFallbacks.js
var EffectFallbacks=/*#__PURE__*/function(){function EffectFallbacks(){_classCallCheck(this,EffectFallbacks);this._defines={};this._currentRank=32;this._maxRank=-1;this._mesh=null;}_createClass(EffectFallbacks,[{key:"unBindMesh",value:function unBindMesh(){this._mesh=null;}},{key:"addFallback",value:function addFallback(rank,define){if(!this._defines[rank]){if(rank<this._currentRank){this._currentRank=rank;}if(rank>this._maxRank){this._maxRank=rank;}this._defines[rank]=new Array();}this._defines[rank].push(define);}},{key:"addCPUSkinningFallback",value:function addCPUSkinningFallback(rank,mesh){this._mesh=mesh;if(rank<this._currentRank){this._currentRank=rank;}if(rank>this._maxRank){this._maxRank=rank;}}},{key:"hasMoreFallbacks",get:function get(){return this._currentRank<=this._maxRank;}},{key:"reduce",value:function reduce(currentDefines,effect){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=false;currentDefines=currentDefines.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0");effect._bonesComputationForcedToCPU=true;var scene2=this._mesh.getScene();for(var index=0;index<scene2.meshes.length;index++){var otherMesh=scene2.meshes[index];if(!otherMesh.material){if(!this._mesh.material&&otherMesh.computeBonesUsingShaders&&otherMesh.numBoneInfluencers>0){otherMesh.computeBonesUsingShaders=false;}continue;}if(!otherMesh.computeBonesUsingShaders||otherMesh.numBoneInfluencers===0){continue;}if(otherMesh.material.getEffect()===effect){otherMesh.computeBonesUsingShaders=false;}else if(otherMesh.subMeshes){var _iterator171=_createForOfIteratorHelper(otherMesh.subMeshes),_step181;try{for(_iterator171.s();!(_step181=_iterator171.n()).done;){var subMesh=_step181.value;var subMeshEffect=subMesh.effect;if(subMeshEffect===effect){otherMesh.computeBonesUsingShaders=false;break;}}}catch(err){_iterator171.e(err);}finally{_iterator171.f();}}}}else{var currentFallbacks=this._defines[this._currentRank];if(currentFallbacks){for(var _index25=0;_index25<currentFallbacks.length;_index25++){currentDefines=currentDefines.replace("#define "+currentFallbacks[_index25],"");}}this._currentRank++;}return currentDefines;}}]);return EffectFallbacks;}();// node_modules/@babylonjs/core/Materials/materialPluginManager.js
var rxOption=new RegExp("^([gimus]+)!");var MaterialPluginManager=/*#__PURE__*/function(){function MaterialPluginManager(material){_classCallCheck(this,MaterialPluginManager);this._plugins=[];this._activePlugins=[];this._activePluginsForExtraEvents=[];this._material=material;this._scene=material.getScene();this._engine=this._scene.getEngine();}_createClass(MaterialPluginManager,[{key:"_addPlugin",value:function _addPlugin(plugin){for(var i=0;i<this._plugins.length;++i){if(this._plugins[i].name===plugin.name){throw"Plugin \"".concat(plugin.name,"\" already added to the material \"").concat(this._material.name,"\"!");}}if(this._material._uniformBufferLayoutBuilt){throw"The plugin \"".concat(plugin.name,"\" can't be added to the material \"").concat(this._material.name,"\" because this material has already been used for rendering! Please add plugins to materials before any rendering with this material occurs.");}var pluginClassName=plugin.getClassName();if(!MaterialPluginManager._MaterialPluginClassToMainDefine[pluginClassName]){MaterialPluginManager._MaterialPluginClassToMainDefine[pluginClassName]="MATERIALPLUGIN_"+ ++MaterialPluginManager._MaterialPluginCounter;}this._material._callbackPluginEventGeneric=this._handlePluginEvent.bind(this);this._plugins.push(plugin);this._plugins.sort(function(a,b){return a.priority-b.priority;});this._codeInjectionPoints={};var defineNamesFromPlugins={};defineNamesFromPlugins[MaterialPluginManager._MaterialPluginClassToMainDefine[pluginClassName]]={type:"boolean","default":true};var _iterator172=_createForOfIteratorHelper(this._plugins),_step182;try{for(_iterator172.s();!(_step182=_iterator172.n()).done;){var plugin2=_step182.value;plugin2.collectDefines(defineNamesFromPlugins);this._collectPointNames("vertex",plugin2.getCustomCode("vertex"));this._collectPointNames("fragment",plugin2.getCustomCode("fragment"));}}catch(err){_iterator172.e(err);}finally{_iterator172.f();}this._defineNamesFromPlugins=defineNamesFromPlugins;}},{key:"_activatePlugin",value:function _activatePlugin(plugin){if(this._activePlugins.indexOf(plugin)===-1){this._activePlugins.push(plugin);this._activePlugins.sort(function(a,b){return a.priority-b.priority;});this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this);this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this);this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this);this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this);if(plugin.registerForExtraEvents){this._activePluginsForExtraEvents.push(plugin);this._activePluginsForExtraEvents.sort(function(a,b){return a.priority-b.priority;});this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this);this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this);this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this);}}}},{key:"getPlugin",value:function getPlugin(name135){for(var i=0;i<this._plugins.length;++i){if(this._plugins[i].name===name135){return this._plugins[i];}}return null;}},{key:"_handlePluginEventIsReadyForSubMesh",value:function _handlePluginEventIsReadyForSubMesh(eventData){var isReady=true;var _iterator173=_createForOfIteratorHelper(this._activePlugins),_step183;try{for(_iterator173.s();!(_step183=_iterator173.n()).done;){var plugin=_step183.value;isReady=isReady&&plugin.isReadyForSubMesh(eventData.defines,this._scene,this._engine,eventData.subMesh);}}catch(err){_iterator173.e(err);}finally{_iterator173.f();}eventData.isReadyForSubMesh=isReady;}},{key:"_handlePluginEventPrepareDefinesBeforeAttributes",value:function _handlePluginEventPrepareDefinesBeforeAttributes(eventData){var _iterator174=_createForOfIteratorHelper(this._activePlugins),_step184;try{for(_iterator174.s();!(_step184=_iterator174.n()).done;){var plugin=_step184.value;plugin.prepareDefinesBeforeAttributes(eventData.defines,this._scene,eventData.mesh);}}catch(err){_iterator174.e(err);}finally{_iterator174.f();}}},{key:"_handlePluginEventPrepareDefines",value:function _handlePluginEventPrepareDefines(eventData){var _iterator175=_createForOfIteratorHelper(this._activePlugins),_step185;try{for(_iterator175.s();!(_step185=_iterator175.n()).done;){var plugin=_step185.value;plugin.prepareDefines(eventData.defines,this._scene,eventData.mesh);}}catch(err){_iterator175.e(err);}finally{_iterator175.f();}}},{key:"_handlePluginEventHardBindForSubMesh",value:function _handlePluginEventHardBindForSubMesh(eventData){var _iterator176=_createForOfIteratorHelper(this._activePluginsForExtraEvents),_step186;try{for(_iterator176.s();!(_step186=_iterator176.n()).done;){var plugin=_step186.value;plugin.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,eventData.subMesh);}}catch(err){_iterator176.e(err);}finally{_iterator176.f();}}},{key:"_handlePluginEventBindForSubMesh",value:function _handlePluginEventBindForSubMesh(eventData){var _iterator177=_createForOfIteratorHelper(this._activePlugins),_step187;try{for(_iterator177.s();!(_step187=_iterator177.n()).done;){var plugin=_step187.value;plugin.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,eventData.subMesh);}}catch(err){_iterator177.e(err);}finally{_iterator177.f();}}},{key:"_handlePluginEventHasRenderTargetTextures",value:function _handlePluginEventHasRenderTargetTextures(eventData){var hasRenderTargetTextures=false;var _iterator178=_createForOfIteratorHelper(this._activePluginsForExtraEvents),_step188;try{for(_iterator178.s();!(_step188=_iterator178.n()).done;){var plugin=_step188.value;hasRenderTargetTextures=plugin.hasRenderTargetTextures();if(hasRenderTargetTextures){break;}}}catch(err){_iterator178.e(err);}finally{_iterator178.f();}eventData.hasRenderTargetTextures=hasRenderTargetTextures;}},{key:"_handlePluginEventFillRenderTargetTextures",value:function _handlePluginEventFillRenderTargetTextures(eventData){var _iterator179=_createForOfIteratorHelper(this._activePluginsForExtraEvents),_step189;try{for(_iterator179.s();!(_step189=_iterator179.n()).done;){var plugin=_step189.value;plugin.fillRenderTargetTextures(eventData.renderTargets);}}catch(err){_iterator179.e(err);}finally{_iterator179.f();}}},{key:"_handlePluginEvent",value:function _handlePluginEvent(id,info){switch(id){case MaterialPluginEvent.GetActiveTextures:{var eventData=info;var _iterator180=_createForOfIteratorHelper(this._activePlugins),_step190;try{for(_iterator180.s();!(_step190=_iterator180.n()).done;){var plugin=_step190.value;plugin.getActiveTextures(eventData.activeTextures);}}catch(err){_iterator180.e(err);}finally{_iterator180.f();}break;}case MaterialPluginEvent.GetAnimatables:{var _eventData=info;var _iterator181=_createForOfIteratorHelper(this._activePlugins),_step191;try{for(_iterator181.s();!(_step191=_iterator181.n()).done;){var _plugin=_step191.value;_plugin.getAnimatables(_eventData.animatables);}}catch(err){_iterator181.e(err);}finally{_iterator181.f();}break;}case MaterialPluginEvent.HasTexture:{var _eventData2=info;var hasTexture=false;var _iterator182=_createForOfIteratorHelper(this._activePlugins),_step192;try{for(_iterator182.s();!(_step192=_iterator182.n()).done;){var _plugin2=_step192.value;hasTexture=_plugin2.hasTexture(_eventData2.texture);if(hasTexture){break;}}}catch(err){_iterator182.e(err);}finally{_iterator182.f();}_eventData2.hasTexture=hasTexture;break;}case MaterialPluginEvent.Disposed:{var _eventData3=info;var _iterator183=_createForOfIteratorHelper(this._plugins),_step193;try{for(_iterator183.s();!(_step193=_iterator183.n()).done;){var _plugin3=_step193.value;_plugin3.dispose(_eventData3.forceDisposeTextures);}}catch(err){_iterator183.e(err);}finally{_iterator183.f();}break;}case MaterialPluginEvent.GetDefineNames:{var _eventData4=info;_eventData4.defineNames=this._defineNamesFromPlugins;break;}case MaterialPluginEvent.PrepareEffect:{var _eventData5=info;var _iterator184=_createForOfIteratorHelper(this._activePlugins),_step194;try{for(_iterator184.s();!(_step194=_iterator184.n()).done;){var _plugin4=_step194.value;_eventData5.fallbackRank=_plugin4.addFallbacks(_eventData5.defines,_eventData5.fallbacks,_eventData5.fallbackRank);_plugin4.getAttributes(_eventData5.attributes,this._scene,_eventData5.mesh);}}catch(err){_iterator184.e(err);}finally{_iterator184.f();}if(this._uniformList.length>0){var _eventData5$uniforms;(_eventData5$uniforms=_eventData5.uniforms).push.apply(_eventData5$uniforms,_toConsumableArray(this._uniformList));}if(this._samplerList.length>0){var _eventData5$samplers;(_eventData5$samplers=_eventData5.samplers).push.apply(_eventData5$samplers,_toConsumableArray(this._samplerList));}if(this._uboList.length>0){var _eventData5$uniformBu;(_eventData5$uniformBu=_eventData5.uniformBuffersNames).push.apply(_eventData5$uniformBu,_toConsumableArray(this._uboList));}_eventData5.customCode=this._injectCustomCode(_eventData5.customCode);break;}case MaterialPluginEvent.PrepareUniformBuffer:{var _eventData6=info;this._uboDeclaration="";this._vertexDeclaration="";this._fragmentDeclaration="";this._uniformList=[];this._samplerList=[];this._uboList=[];var _iterator185=_createForOfIteratorHelper(this._plugins),_step195;try{for(_iterator185.s();!(_step195=_iterator185.n()).done;){var _plugin5=_step195.value;var uniforms=_plugin5.getUniforms();if(uniforms){if(uniforms.ubo){var _iterator186=_createForOfIteratorHelper(uniforms.ubo),_step196;try{for(_iterator186.s();!(_step196=_iterator186.n()).done;){var uniform=_step196.value;_eventData6.ubo.addUniform(uniform.name,uniform.size);this._uboDeclaration+="".concat(uniform.type," ").concat(uniform.name,";\r\n");this._uniformList.push(uniform.name);}}catch(err){_iterator186.e(err);}finally{_iterator186.f();}}if(uniforms.vertex){this._vertexDeclaration+=uniforms.vertex+"\r\n";}if(uniforms.fragment){this._fragmentDeclaration+=uniforms.fragment+"\r\n";}}_plugin5.getSamplers(this._samplerList);_plugin5.getUniformBuffersNames(this._uboList);}}catch(err){_iterator185.e(err);}finally{_iterator185.f();}break;}}}},{key:"_collectPointNames",value:function _collectPointNames(shaderType,customCode){if(!customCode){return;}for(var pointName in customCode){if(!this._codeInjectionPoints[shaderType]){this._codeInjectionPoints[shaderType]={};}this._codeInjectionPoints[shaderType][pointName]=true;}}},{key:"_injectCustomCode",value:function _injectCustomCode(existingCallback){var _this133=this;return function(shaderType,code){var _a;if(existingCallback){code=existingCallback(shaderType,code);}if(_this133._uboDeclaration){code=code.replace("#define ADDITIONAL_UBO_DECLARATION",_this133._uboDeclaration);}if(_this133._vertexDeclaration){code=code.replace("#define ADDITIONAL_VERTEX_DECLARATION",_this133._vertexDeclaration);}if(_this133._fragmentDeclaration){code=code.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",_this133._fragmentDeclaration);}var points=(_a=_this133._codeInjectionPoints)===null||_a===void 0?void 0:_a[shaderType];if(!points){return code;}for(var pointName in points){var injectedCode="";var _iterator187=_createForOfIteratorHelper(_this133._activePlugins),_step197;try{for(_iterator187.s();!(_step197=_iterator187.n()).done;){var plugin=_step197.value;var customCode=plugin.getCustomCode(shaderType);if(customCode===null||customCode===void 0?void 0:customCode[pointName]){injectedCode+=customCode[pointName]+"\r\n";}}}catch(err){_iterator187.e(err);}finally{_iterator187.f();}if(injectedCode.length>0){if(pointName.charAt(0)==="!"){pointName=pointName.substring(1);var regexFlags="g";if(pointName.charAt(0)==="!"){regexFlags="";pointName=pointName.substring(1);}else{var matchOption=rxOption.exec(pointName);if(matchOption&&matchOption.length>=2){regexFlags=matchOption[1];pointName=pointName.substring(regexFlags.length+1);}}if(regexFlags.indexOf("g")<0){regexFlags+="g";}var sourceCode=code;var rx=new RegExp(pointName,regexFlags);var match=rx.exec(sourceCode);while(match!==null){var newCode=injectedCode;for(var i=0;i<match.length;++i){newCode=newCode.replace("$"+i,match[i]);}code=code.replace(match[0],newCode);match=rx.exec(sourceCode);}}else{var fullPointName="#define "+pointName;code=code.replace(fullPointName,"\r\n"+injectedCode+"\r\n"+fullPointName);}}}return code;};}}]);return MaterialPluginManager;}();MaterialPluginManager._MaterialPluginClassToMainDefine={};MaterialPluginManager._MaterialPluginCounter=0;// node_modules/@babylonjs/core/Materials/materialPluginBase.js
var MaterialPluginBase=/*#__PURE__*/function(){function MaterialPluginBase(material,name135,priority,defines){var addToPluginList=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var enable=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;_classCallCheck(this,MaterialPluginBase);this.priority=500;this.registerForExtraEvents=false;this._material=material;this.name=name135;this.priority=priority;if(!material.pluginManager){material.pluginManager=new MaterialPluginManager(material);}this._pluginDefineNames=defines;this._pluginManager=material.pluginManager;if(addToPluginList){this._pluginManager._addPlugin(this);}if(enable){this._enable(true);}this.markAllDefinesAsDirty=material._dirtyCallbacks[63];}_createClass(MaterialPluginBase,[{key:"_enable",value:function _enable(enable){if(enable){this._pluginManager._activatePlugin(this);}}},{key:"getClassName",value:function getClassName(){return"MaterialPluginBase";}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2,engine,subMesh){return true;}},{key:"hardBindForSubMesh",value:function hardBindForSubMesh(uniformBuffer,scene2,engine,subMesh){}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2,engine,subMesh){}},{key:"dispose",value:function dispose(forceDisposeTextures){}},{key:"getCustomCode",value:function getCustomCode(shaderType){return null;}},{key:"collectDefines",value:function collectDefines(defines){if(!this._pluginDefineNames){return;}for(var _i23=0,_Object$keys2=Object.keys(this._pluginDefineNames);_i23<_Object$keys2.length;_i23++){var key=_Object$keys2[_i23];if(key[0]==="_"){continue;}var type=_typeof(this._pluginDefineNames[key]);defines[key]={type:type==="number"?"number":type==="string"?"string":type==="boolean"?"boolean":"object","default":this._pluginDefineNames[key]};}}},{key:"prepareDefinesBeforeAttributes",value:function prepareDefinesBeforeAttributes(defines,scene2,mesh){}},{key:"prepareDefines",value:function prepareDefines(defines,scene2,mesh){}},{key:"hasTexture",value:function hasTexture(texture){return false;}},{key:"hasRenderTargetTextures",value:function hasRenderTargetTextures(){return false;}},{key:"fillRenderTargetTextures",value:function fillRenderTargetTextures(renderTargets){}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){}},{key:"getAnimatables",value:function getAnimatables(animatables){}},{key:"addFallbacks",value:function addFallbacks(defines,fallbacks,currentRank){return currentRank;}},{key:"getSamplers",value:function getSamplers(samplers){}},{key:"getAttributes",value:function getAttributes(attributes,scene2,mesh){}},{key:"getUniformBuffersNames",value:function getUniformBuffersNames(ubos){}},{key:"getUniforms",value:function getUniforms(){return{};}},{key:"copyTo",value:function copyTo(plugin){SerializationHelper.Clone(function(){return plugin;},this);}},{key:"serialize",value:function serialize(){return SerializationHelper.Serialize(this);}},{key:"parse",value:function parse(source,scene2,rootUrl){var _this134=this;SerializationHelper.Parse(function(){return _this134;},source,scene2,rootUrl);}}]);return MaterialPluginBase;}();__decorate([serialize()],MaterialPluginBase.prototype,"name",void 0);__decorate([serialize()],MaterialPluginBase.prototype,"priority",void 0);__decorate([serialize()],MaterialPluginBase.prototype,"registerForExtraEvents",void 0);// node_modules/@babylonjs/core/Materials/material.detailMapConfiguration.js
var MaterialDetailMapDefines=/*#__PURE__*/function(_MaterialDefines){_inherits(MaterialDetailMapDefines,_MaterialDefines);var _super39=_createSuper(MaterialDetailMapDefines);function MaterialDetailMapDefines(){var _this135;_classCallCheck(this,MaterialDetailMapDefines);_this135=_super39.apply(this,arguments);_this135.DETAIL=false;_this135.DETAILDIRECTUV=0;_this135.DETAIL_NORMALBLENDMETHOD=0;return _this135;}return _createClass(MaterialDetailMapDefines);}(MaterialDefines);var DetailMapConfiguration=/*#__PURE__*/function(_MaterialPluginBase){_inherits(DetailMapConfiguration,_MaterialPluginBase);var _super40=_createSuper(DetailMapConfiguration);function DetailMapConfiguration(material){var _this136;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,DetailMapConfiguration);_this136=_super40.call(this,material,"DetailMap",140,new MaterialDetailMapDefines(),addToPluginList);_this136._texture=null;_this136.diffuseBlendLevel=1;_this136.roughnessBlendLevel=1;_this136.bumpLevel=1;_this136._normalBlendMethod=Material.MATERIAL_NORMALBLENDMETHOD_WHITEOUT;_this136._isEnabled=false;_this136.isEnabled=false;_this136._internalMarkAllSubMeshesAsTexturesDirty=material._dirtyCallbacks[1];return _this136;}_createClass(DetailMapConfiguration,[{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled);this._internalMarkAllSubMeshesAsTexturesDirty();}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2,engine){if(!this._isEnabled){return true;}if(defines._areTexturesDirty&&scene2.texturesEnabled){if(engine.getCaps().standardDerivatives&&this._texture&&MaterialFlags.DetailTextureEnabled){if(!this._texture.isReady()){return false;}}}return true;}},{key:"prepareDefines",value:function prepareDefines(defines,scene2){if(this._isEnabled){defines.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var engine=scene2.getEngine();if(defines._areTexturesDirty){if(engine.getCaps().standardDerivatives&&this._texture&&MaterialFlags.DetailTextureEnabled&&this._isEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._texture,defines,"DETAIL");defines.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;}else{defines.DETAIL=false;}}}else{defines.DETAIL=false;}}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2){if(!this._isEnabled){return;}var isFrozen=this._material.isFrozen;if(!uniformBuffer.useUbo||!isFrozen||!uniformBuffer.isSync){if(this._texture&&MaterialFlags.DetailTextureEnabled){uniformBuffer.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel);MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"detail");}}if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.DetailTextureEnabled){uniformBuffer.setTexture("detailSampler",this._texture);}}}},{key:"hasTexture",value:function hasTexture(texture){if(this._texture===texture){return true;}return false;}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){if(this._texture){activeTextures.push(this._texture);}}},{key:"getAnimatables",value:function getAnimatables(animatables){if(this._texture&&this._texture.animations&&this._texture.animations.length>0){animatables.push(this._texture);}}},{key:"dispose",value:function dispose(forceDisposeTextures){var _a;if(forceDisposeTextures){(_a=this._texture)===null||_a===void 0?void 0:_a.dispose();}}},{key:"getClassName",value:function getClassName(){return"DetailMapConfiguration";}},{key:"getSamplers",value:function getSamplers(samplers){samplers.push("detailSampler");}},{key:"getUniforms",value:function getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]};}}]);return DetailMapConfiguration;}(MaterialPluginBase);__decorate([serializeAsTexture("detailTexture"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"texture",void 0);__decorate([serialize()],DetailMapConfiguration.prototype,"diffuseBlendLevel",void 0);__decorate([serialize()],DetailMapConfiguration.prototype,"roughnessBlendLevel",void 0);__decorate([serialize()],DetailMapConfiguration.prototype,"bumpLevel",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"normalBlendMethod",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],DetailMapConfiguration.prototype,"isEnabled",void 0);// node_modules/@babylonjs/core/Materials/standardMaterial.js
var onCreatedEffectParameters={effect:null,subMesh:null};var StandardMaterialDefines=/*#__PURE__*/function(_MaterialDefines2){_inherits(StandardMaterialDefines,_MaterialDefines2);var _super41=_createSuper(StandardMaterialDefines);function StandardMaterialDefines(externalProperties){var _this137;_classCallCheck(this,StandardMaterialDefines);_this137=_super41.call(this,externalProperties);_this137.MAINUV1=false;_this137.MAINUV2=false;_this137.MAINUV3=false;_this137.MAINUV4=false;_this137.MAINUV5=false;_this137.MAINUV6=false;_this137.DIFFUSE=false;_this137.DIFFUSEDIRECTUV=0;_this137.BAKED_VERTEX_ANIMATION_TEXTURE=false;_this137.AMBIENT=false;_this137.AMBIENTDIRECTUV=0;_this137.OPACITY=false;_this137.OPACITYDIRECTUV=0;_this137.OPACITYRGB=false;_this137.REFLECTION=false;_this137.EMISSIVE=false;_this137.EMISSIVEDIRECTUV=0;_this137.SPECULAR=false;_this137.SPECULARDIRECTUV=0;_this137.BUMP=false;_this137.BUMPDIRECTUV=0;_this137.PARALLAX=false;_this137.PARALLAXOCCLUSION=false;_this137.SPECULAROVERALPHA=false;_this137.CLIPPLANE=false;_this137.CLIPPLANE2=false;_this137.CLIPPLANE3=false;_this137.CLIPPLANE4=false;_this137.CLIPPLANE5=false;_this137.CLIPPLANE6=false;_this137.ALPHATEST=false;_this137.DEPTHPREPASS=false;_this137.ALPHAFROMDIFFUSE=false;_this137.POINTSIZE=false;_this137.FOG=false;_this137.SPECULARTERM=false;_this137.DIFFUSEFRESNEL=false;_this137.OPACITYFRESNEL=false;_this137.REFLECTIONFRESNEL=false;_this137.REFRACTIONFRESNEL=false;_this137.EMISSIVEFRESNEL=false;_this137.FRESNEL=false;_this137.NORMAL=false;_this137.TANGENT=false;_this137.UV1=false;_this137.UV2=false;_this137.UV3=false;_this137.UV4=false;_this137.UV5=false;_this137.UV6=false;_this137.VERTEXCOLOR=false;_this137.VERTEXALPHA=false;_this137.NUM_BONE_INFLUENCERS=0;_this137.BonesPerMesh=0;_this137.BONETEXTURE=false;_this137.BONES_VELOCITY_ENABLED=false;_this137.INSTANCES=false;_this137.THIN_INSTANCES=false;_this137.INSTANCESCOLOR=false;_this137.GLOSSINESS=false;_this137.ROUGHNESS=false;_this137.EMISSIVEASILLUMINATION=false;_this137.LINKEMISSIVEWITHDIFFUSE=false;_this137.REFLECTIONFRESNELFROMSPECULAR=false;_this137.LIGHTMAP=false;_this137.LIGHTMAPDIRECTUV=0;_this137.OBJECTSPACE_NORMALMAP=false;_this137.USELIGHTMAPASSHADOWMAP=false;_this137.REFLECTIONMAP_3D=false;_this137.REFLECTIONMAP_SPHERICAL=false;_this137.REFLECTIONMAP_PLANAR=false;_this137.REFLECTIONMAP_CUBIC=false;_this137.USE_LOCAL_REFLECTIONMAP_CUBIC=false;_this137.USE_LOCAL_REFRACTIONMAP_CUBIC=false;_this137.REFLECTIONMAP_PROJECTION=false;_this137.REFLECTIONMAP_SKYBOX=false;_this137.REFLECTIONMAP_EXPLICIT=false;_this137.REFLECTIONMAP_EQUIRECTANGULAR=false;_this137.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=false;_this137.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=false;_this137.REFLECTIONMAP_OPPOSITEZ=false;_this137.INVERTCUBICMAP=false;_this137.LOGARITHMICDEPTH=false;_this137.REFRACTION=false;_this137.REFRACTIONMAP_3D=false;_this137.REFLECTIONOVERALPHA=false;_this137.TWOSIDEDLIGHTING=false;_this137.SHADOWFLOAT=false;_this137.MORPHTARGETS=false;_this137.MORPHTARGETS_NORMAL=false;_this137.MORPHTARGETS_TANGENT=false;_this137.MORPHTARGETS_UV=false;_this137.NUM_MORPH_INFLUENCERS=0;_this137.MORPHTARGETS_TEXTURE=false;_this137.NONUNIFORMSCALING=false;_this137.PREMULTIPLYALPHA=false;_this137.ALPHATEST_AFTERALLALPHACOMPUTATIONS=false;_this137.ALPHABLEND=true;_this137.PREPASS=false;_this137.PREPASS_IRRADIANCE=false;_this137.PREPASS_IRRADIANCE_INDEX=-1;_this137.PREPASS_ALBEDO_SQRT=false;_this137.PREPASS_ALBEDO_SQRT_INDEX=-1;_this137.PREPASS_DEPTH=false;_this137.PREPASS_DEPTH_INDEX=-1;_this137.PREPASS_NORMAL=false;_this137.PREPASS_NORMAL_INDEX=-1;_this137.PREPASS_POSITION=false;_this137.PREPASS_POSITION_INDEX=-1;_this137.PREPASS_VELOCITY=false;_this137.PREPASS_VELOCITY_INDEX=-1;_this137.PREPASS_REFLECTIVITY=false;_this137.PREPASS_REFLECTIVITY_INDEX=-1;_this137.SCENE_MRT_COUNT=0;_this137.RGBDLIGHTMAP=false;_this137.RGBDREFLECTION=false;_this137.RGBDREFRACTION=false;_this137.IMAGEPROCESSING=false;_this137.VIGNETTE=false;_this137.VIGNETTEBLENDMODEMULTIPLY=false;_this137.VIGNETTEBLENDMODEOPAQUE=false;_this137.TONEMAPPING=false;_this137.TONEMAPPING_ACES=false;_this137.CONTRAST=false;_this137.COLORCURVES=false;_this137.COLORGRADING=false;_this137.COLORGRADING3D=false;_this137.SAMPLER3DGREENDEPTH=false;_this137.SAMPLER3DBGRMAP=false;_this137.DITHER=false;_this137.IMAGEPROCESSINGPOSTPROCESS=false;_this137.SKIPFINALCOLORCLAMP=false;_this137.MULTIVIEW=false;_this137.ORDER_INDEPENDENT_TRANSPARENCY=false;_this137.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=false;_this137.CAMERA_ORTHOGRAPHIC=false;_this137.CAMERA_PERSPECTIVE=false;_this137.IS_REFLECTION_LINEAR=false;_this137.IS_REFRACTION_LINEAR=false;_this137.EXPOSURE=false;_this137.rebuild();return _this137;}_createClass(StandardMaterialDefines,[{key:"setReflectionMode",value:function setReflectionMode(modeToEnable){var modes=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(var _i24=0,_modes=modes;_i24<_modes.length;_i24++){var mode=_modes[_i24];this[mode]=mode===modeToEnable;}}}]);return StandardMaterialDefines;}(MaterialDefines);var StandardMaterial=/*#__PURE__*/function(_PushMaterial){_inherits(StandardMaterial,_PushMaterial);var _super42=_createSuper(StandardMaterial);function StandardMaterial(name135,scene2){var _this138;_classCallCheck(this,StandardMaterial);_this138=_super42.call(this,name135,scene2);_this138._diffuseTexture=null;_this138._ambientTexture=null;_this138._opacityTexture=null;_this138._reflectionTexture=null;_this138._emissiveTexture=null;_this138._specularTexture=null;_this138._bumpTexture=null;_this138._lightmapTexture=null;_this138._refractionTexture=null;_this138.ambientColor=new Color3(0,0,0);_this138.diffuseColor=new Color3(1,1,1);_this138.specularColor=new Color3(1,1,1);_this138.emissiveColor=new Color3(0,0,0);_this138.specularPower=64;_this138._useAlphaFromDiffuseTexture=false;_this138._useEmissiveAsIllumination=false;_this138._linkEmissiveWithDiffuse=false;_this138._useSpecularOverAlpha=false;_this138._useReflectionOverAlpha=false;_this138._disableLighting=false;_this138._useObjectSpaceNormalMap=false;_this138._useParallax=false;_this138._useParallaxOcclusion=false;_this138.parallaxScaleBias=0.05;_this138._roughness=0;_this138.indexOfRefraction=0.98;_this138.invertRefractionY=true;_this138.alphaCutOff=0.4;_this138._useLightmapAsShadowmap=false;_this138._useReflectionFresnelFromSpecular=false;_this138._useGlossinessFromSpecularMapAlpha=false;_this138._maxSimultaneousLights=4;_this138._invertNormalMapX=false;_this138._invertNormalMapY=false;_this138._twoSidedLighting=false;_this138._renderTargets=new SmartArray(16);_this138._worldViewProjectionMatrix=Matrix.Zero();_this138._globalAmbientColor=new Color3(0,0,0);_this138._cacheHasRenderTargetTextures=false;_this138.detailMap=new DetailMapConfiguration(_assertThisInitialized(_this138));_this138._attachImageProcessingConfiguration(null);_this138.prePassConfiguration=new PrePassConfiguration();_this138.getRenderTargetTextures=function(){_this138._renderTargets.reset();if(StandardMaterial.ReflectionTextureEnabled&&_this138._reflectionTexture&&_this138._reflectionTexture.isRenderTarget){_this138._renderTargets.push(_this138._reflectionTexture);}if(StandardMaterial.RefractionTextureEnabled&&_this138._refractionTexture&&_this138._refractionTexture.isRenderTarget){_this138._renderTargets.push(_this138._refractionTexture);}_this138._eventInfo.renderTargets=_this138._renderTargets;_this138._callbackPluginEventFillRenderTargetTextures(_this138._eventInfo);return _this138._renderTargets;};return _this138;}_createClass(StandardMaterial,[{key:"imageProcessingConfiguration",get:function get(){return this._imageProcessingConfiguration;},set:function set(value){this._attachImageProcessingConfiguration(value);this._markAllSubMeshesAsTexturesDirty();}},{key:"_attachImageProcessingConfiguration",value:function _attachImageProcessingConfiguration(configuration){var _this139=this;if(configuration===this._imageProcessingConfiguration){return;}if(this._imageProcessingConfiguration&&this._imageProcessingObserver){this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);}if(!configuration){this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration;}else{this._imageProcessingConfiguration=configuration;}if(this._imageProcessingConfiguration){this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){_this139._markAllSubMeshesAsImageProcessingDirty();});}}},{key:"isPrePassCapable",get:function get(){return!this.disableDepthWrite;}},{key:"cameraColorCurvesEnabled",get:function get(){return this.imageProcessingConfiguration.colorCurvesEnabled;},set:function set(value){this.imageProcessingConfiguration.colorCurvesEnabled=value;}},{key:"cameraColorGradingEnabled",get:function get(){return this.imageProcessingConfiguration.colorGradingEnabled;},set:function set(value){this.imageProcessingConfiguration.colorGradingEnabled=value;}},{key:"cameraToneMappingEnabled",get:function get(){return this._imageProcessingConfiguration.toneMappingEnabled;},set:function set(value){this._imageProcessingConfiguration.toneMappingEnabled=value;}},{key:"cameraExposure",get:function get(){return this._imageProcessingConfiguration.exposure;},set:function set(value){this._imageProcessingConfiguration.exposure=value;}},{key:"cameraContrast",get:function get(){return this._imageProcessingConfiguration.contrast;},set:function set(value){this._imageProcessingConfiguration.contrast=value;}},{key:"cameraColorGradingTexture",get:function get(){return this._imageProcessingConfiguration.colorGradingTexture;},set:function set(value){this._imageProcessingConfiguration.colorGradingTexture=value;}},{key:"cameraColorCurves",get:function get(){return this._imageProcessingConfiguration.colorCurves;},set:function set(value){this._imageProcessingConfiguration.colorCurves=value;}},{key:"canRenderToMRT",get:function get(){return true;}},{key:"hasRenderTargetTextures",get:function get(){if(StandardMaterial.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget){return true;}if(StandardMaterial.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget){return true;}return this._cacheHasRenderTargetTextures;}},{key:"getClassName",value:function getClassName(){return"StandardMaterial";}},{key:"useLogarithmicDepth",get:function get(){return this._useLogarithmicDepth;},set:function set(value){this._useLogarithmicDepth=value&&this.getScene().getEngine().getCaps().fragmentDepthSupported;this._markAllSubMeshesAsMiscDirty();}},{key:"needAlphaBlending",value:function needAlphaBlending(){if(this._disableAlphaBlending){return false;}return this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled;}},{key:"needAlphaTesting",value:function needAlphaTesting(){if(this._forceAlphaTest){return true;}return this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===Material.MATERIAL_ALPHATEST);}},{key:"_shouldUseAlphaFromDiffuseTexture",value:function _shouldUseAlphaFromDiffuseTexture(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==Material.MATERIAL_OPAQUE;}},{key:"_hasAlphaChannel",value:function _hasAlphaChannel(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null;}},{key:"getAlphaTestTexture",value:function getAlphaTestTexture(){return this._diffuseTexture;}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(mesh,subMesh){var useInstances=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._uniformBufferLayoutBuilt){this.buildUniformLayout();}if(subMesh.effect&&this.isFrozen){if(subMesh.effect._wasPreviouslyReady&&subMesh.effect._wasPreviouslyUsingInstances===useInstances){return true;}}if(!subMesh.materialDefines){this._callbackPluginEventGeneric(MaterialPluginEvent.GetDefineNames,this._eventInfo);subMesh.materialDefines=new StandardMaterialDefines(this._eventInfo.defineNames);}var scene2=this.getScene();var defines=subMesh.materialDefines;if(this._isReadyForSubMesh(subMesh)){return true;}var engine=scene2.getEngine();defines._needNormals=MaterialHelper.PrepareDefinesForLights(scene2,mesh,defines,true,this._maxSimultaneousLights,this._disableLighting);MaterialHelper.PrepareDefinesForMultiview(scene2,defines);var oit=this.needAlphaBlendingForMesh(mesh)&&this.getScene().useOrderIndependentTransparency;MaterialHelper.PrepareDefinesForPrePass(scene2,defines,this.canRenderToMRT&&!oit);MaterialHelper.PrepareDefinesForOIT(scene2,defines,oit);if(defines._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=false;this._callbackPluginEventHasRenderTargetTextures(this._eventInfo);this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures;defines._needUVs=false;for(var i=1;i<=6;++i){defines["MAINUV"+i]=false;}if(scene2.texturesEnabled){defines.DIFFUSEDIRECTUV=0;defines.BUMPDIRECTUV=0;defines.AMBIENTDIRECTUV=0;defines.OPACITYDIRECTUV=0;defines.EMISSIVEDIRECTUV=0;defines.SPECULARDIRECTUV=0;defines.LIGHTMAPDIRECTUV=0;if(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._diffuseTexture,defines,"DIFFUSE");}}else{defines.DIFFUSE=false;}if(this._ambientTexture&&StandardMaterial.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,defines,"AMBIENT");}}else{defines.AMBIENT=false;}if(this._opacityTexture&&StandardMaterial.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,defines,"OPACITY");defines.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;}}else{defines.OPACITY=false;}if(this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking()){return false;}else{defines._needNormals=true;defines.REFLECTION=true;defines.ROUGHNESS=this._roughness>0;defines.REFLECTIONOVERALPHA=this._useReflectionOverAlpha;defines.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===Texture.INVCUBIC_MODE;defines.REFLECTIONMAP_3D=this._reflectionTexture.isCube;defines.REFLECTIONMAP_OPPOSITEZ=defines.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ;defines.RGBDREFLECTION=this._reflectionTexture.isRGBD;switch(this._reflectionTexture.coordinatesMode){case Texture.EXPLICIT_MODE:defines.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case Texture.PLANAR_MODE:defines.setReflectionMode("REFLECTIONMAP_PLANAR");break;case Texture.PROJECTION_MODE:defines.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case Texture.SKYBOX_MODE:defines.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case Texture.SPHERICAL_MODE:defines.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case Texture.EQUIRECTANGULAR_MODE:defines.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case Texture.FIXED_EQUIRECTANGULAR_MODE:defines.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:defines.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case Texture.CUBIC_MODE:case Texture.INVCUBIC_MODE:default:defines.setReflectionMode("REFLECTIONMAP_CUBIC");break;}defines.USE_LOCAL_REFLECTIONMAP_CUBIC=this._reflectionTexture.boundingBoxSize?true:false;}}else{defines.REFLECTION=false;defines.REFLECTIONMAP_OPPOSITEZ=false;}if(this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,defines,"EMISSIVE");}}else{defines.EMISSIVE=false;}if(this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,defines,"LIGHTMAP");defines.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap;defines.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;}}else{defines.LIGHTMAP=false;}if(this._specularTexture&&StandardMaterial.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._specularTexture,defines,"SPECULAR");defines.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;}}else{defines.SPECULAR=false;}if(scene2.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&StandardMaterial.BumpTextureEnabled){if(!this._bumpTexture.isReady()){return false;}else{MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,defines,"BUMP");defines.PARALLAX=this._useParallax;defines.PARALLAXOCCLUSION=this._useParallaxOcclusion;}defines.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap;}else{defines.BUMP=false;defines.PARALLAX=false;defines.PARALLAXOCCLUSION=false;}if(this._refractionTexture&&StandardMaterial.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking()){return false;}else{defines._needUVs=true;defines.REFRACTION=true;defines.REFRACTIONMAP_3D=this._refractionTexture.isCube;defines.RGBDREFRACTION=this._refractionTexture.isRGBD;defines.USE_LOCAL_REFRACTIONMAP_CUBIC=this._refractionTexture.boundingBoxSize?true:false;}}else{defines.REFRACTION=false;}defines.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting;}else{defines.DIFFUSE=false;defines.AMBIENT=false;defines.OPACITY=false;defines.REFLECTION=false;defines.EMISSIVE=false;defines.LIGHTMAP=false;defines.BUMP=false;defines.REFRACTION=false;}defines.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture();defines.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination;defines.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse;defines.SPECULAROVERALPHA=this._useSpecularOverAlpha;defines.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8;defines.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null;defines.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(mesh);}this._eventInfo.isReadyForSubMesh=true;this._eventInfo.defines=defines;this._callbackPluginEventIsReadyForSubMesh(this._eventInfo);if(!this._eventInfo.isReadyForSubMesh){return false;}if(defines._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady()){return false;}this._imageProcessingConfiguration.prepareDefines(defines);defines.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace;defines.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace;}if(defines._areFresnelDirty){if(StandardMaterial.FresnelEnabled){if(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters){defines.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled;defines.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled;defines.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled;defines.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular;defines.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled;defines.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled;defines._needNormals=true;defines.FRESNEL=true;}}else{defines.FRESNEL=false;}}MaterialHelper.PrepareDefinesForMisc(mesh,scene2,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(mesh)||this._forceAlphaTest,defines);MaterialHelper.PrepareDefinesForFrameBoundValues(scene2,engine,this,defines,useInstances,null,subMesh.getRenderingMesh().hasThinInstances);this._eventInfo.defines=defines;this._eventInfo.mesh=mesh;this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo);MaterialHelper.PrepareDefinesForAttributes(mesh,defines,true,true,true);this._callbackPluginEventPrepareDefines(this._eventInfo);var forceWasNotReadyPreviously=false;if(defines.isDirty){var lightDisposed=defines._areLightsDisposed;defines.markAsProcessed();var fallbacks=new EffectFallbacks();if(defines.REFLECTION){fallbacks.addFallback(0,"REFLECTION");}if(defines.SPECULAR){fallbacks.addFallback(0,"SPECULAR");}if(defines.BUMP){fallbacks.addFallback(0,"BUMP");}if(defines.PARALLAX){fallbacks.addFallback(1,"PARALLAX");}if(defines.PARALLAXOCCLUSION){fallbacks.addFallback(0,"PARALLAXOCCLUSION");}if(defines.SPECULAROVERALPHA){fallbacks.addFallback(0,"SPECULAROVERALPHA");}if(defines.FOG){fallbacks.addFallback(1,"FOG");}if(defines.POINTSIZE){fallbacks.addFallback(0,"POINTSIZE");}if(defines.LOGARITHMICDEPTH){fallbacks.addFallback(0,"LOGARITHMICDEPTH");}MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this._maxSimultaneousLights);if(defines.SPECULARTERM){fallbacks.addFallback(0,"SPECULARTERM");}if(defines.DIFFUSEFRESNEL){fallbacks.addFallback(1,"DIFFUSEFRESNEL");}if(defines.OPACITYFRESNEL){fallbacks.addFallback(2,"OPACITYFRESNEL");}if(defines.REFLECTIONFRESNEL){fallbacks.addFallback(3,"REFLECTIONFRESNEL");}if(defines.EMISSIVEFRESNEL){fallbacks.addFallback(4,"EMISSIVEFRESNEL");}if(defines.FRESNEL){fallbacks.addFallback(4,"FRESNEL");}if(defines.MULTIVIEW){fallbacks.addFallback(0,"MULTIVIEW");}var attribs=[VertexBuffer.PositionKind];if(defines.NORMAL){attribs.push(VertexBuffer.NormalKind);}if(defines.TANGENT){attribs.push(VertexBuffer.TangentKind);}for(var _i25=1;_i25<=6;++_i25){if(defines["UV"+_i25]){attribs.push("uv".concat(_i25===1?"":_i25));}}if(defines.VERTEXCOLOR){attribs.push(VertexBuffer.ColorKind);}MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks);MaterialHelper.PrepareAttributesForInstances(attribs,defines);MaterialHelper.PrepareAttributesForMorphTargets(attribs,mesh,defines);MaterialHelper.PrepareAttributesForBakedVertexAnimation(attribs,mesh,defines);var shaderName="default";var uniforms=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"];var samplers=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"];var uniformBuffers=["Material","Scene","Mesh"];this._eventInfo.fallbacks=fallbacks;this._eventInfo.fallbackRank=0;this._eventInfo.defines=defines;this._eventInfo.uniforms=uniforms;this._eventInfo.attributes=attribs;this._eventInfo.samplers=samplers;this._eventInfo.uniformBuffersNames=uniformBuffers;this._eventInfo.customCode=void 0;this._eventInfo.mesh=mesh;this._callbackPluginEventGeneric(MaterialPluginEvent.PrepareEffect,this._eventInfo);PrePassConfiguration.AddUniforms(uniforms);PrePassConfiguration.AddSamplers(samplers);if(ImageProcessingConfiguration){ImageProcessingConfiguration.PrepareUniforms(uniforms,defines);ImageProcessingConfiguration.PrepareSamplers(samplers,defines);}MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this._maxSimultaneousLights});addClipPlaneUniforms(uniforms);var csnrOptions={};if(this.customShaderNameResolve){shaderName=this.customShaderNameResolve(shaderName,uniforms,uniformBuffers,samplers,defines,attribs,csnrOptions);}var join=defines.toString();var previousEffect=subMesh.effect;var effect=scene2.getEngine().createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:defines.NUM_MORPH_INFLUENCERS},processFinalCode:csnrOptions.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:defines.PREPASS},engine);this._eventInfo.customCode=void 0;if(effect){if(this._onEffectCreatedObservable){onCreatedEffectParameters.effect=effect;onCreatedEffectParameters.subMesh=subMesh;this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters);}if(this.allowShaderHotSwapping&&previousEffect&&!effect.isReady()){effect=previousEffect;defines.markAsUnprocessed();forceWasNotReadyPreviously=this.isFrozen;if(lightDisposed){defines._areLightsDisposed=true;return false;}}else{scene2.resetCachedMaterial();subMesh.setEffect(effect,defines,this._materialContext);}}}if(!subMesh.effect||!subMesh.effect.isReady()){return false;}defines._renderId=scene2.getRenderId();subMesh.effect._wasPreviouslyReady=forceWasNotReadyPreviously?false:true;subMesh.effect._wasPreviouslyUsingInstances=useInstances;if(scene2.performancePriority!==ScenePerformancePriority.BackwardCompatible){this.checkReadyOnlyOnce=true;}return true;}},{key:"buildUniformLayout",value:function buildUniformLayout(){var ubo=this._uniformBuffer;ubo.addUniform("diffuseLeftColor",4);ubo.addUniform("diffuseRightColor",4);ubo.addUniform("opacityParts",4);ubo.addUniform("reflectionLeftColor",4);ubo.addUniform("reflectionRightColor",4);ubo.addUniform("refractionLeftColor",4);ubo.addUniform("refractionRightColor",4);ubo.addUniform("emissiveLeftColor",4);ubo.addUniform("emissiveRightColor",4);ubo.addUniform("vDiffuseInfos",2);ubo.addUniform("vAmbientInfos",2);ubo.addUniform("vOpacityInfos",2);ubo.addUniform("vReflectionInfos",2);ubo.addUniform("vReflectionPosition",3);ubo.addUniform("vReflectionSize",3);ubo.addUniform("vEmissiveInfos",2);ubo.addUniform("vLightmapInfos",2);ubo.addUniform("vSpecularInfos",2);ubo.addUniform("vBumpInfos",3);ubo.addUniform("diffuseMatrix",16);ubo.addUniform("ambientMatrix",16);ubo.addUniform("opacityMatrix",16);ubo.addUniform("reflectionMatrix",16);ubo.addUniform("emissiveMatrix",16);ubo.addUniform("lightmapMatrix",16);ubo.addUniform("specularMatrix",16);ubo.addUniform("bumpMatrix",16);ubo.addUniform("vTangentSpaceParams",2);ubo.addUniform("pointSize",1);ubo.addUniform("alphaCutOff",1);ubo.addUniform("refractionMatrix",16);ubo.addUniform("vRefractionInfos",4);ubo.addUniform("vRefractionPosition",3);ubo.addUniform("vRefractionSize",3);ubo.addUniform("vSpecularColor",4);ubo.addUniform("vEmissiveColor",3);ubo.addUniform("vDiffuseColor",4);ubo.addUniform("vAmbientColor",3);_get(_getPrototypeOf(StandardMaterial.prototype),"buildUniformLayout",this).call(this);}},{key:"bindForSubMesh",value:function bindForSubMesh(world,mesh,subMesh){var _a;var scene2=this.getScene();var defines=subMesh.materialDefines;if(!defines){return;}var effect=subMesh.effect;if(!effect){return;}this._activeEffect=effect;mesh.getMeshUniformBuffer().bindToEffect(effect,"Mesh");mesh.transferToEffect(world);this._uniformBuffer.bindToEffect(effect,"Material");this.prePassConfiguration.bindForSubMesh(this._activeEffect,scene2,mesh,world,this.isFrozen);this._eventInfo.subMesh=subMesh;this._callbackPluginEventHardBindForSubMesh(this._eventInfo);if(defines.OBJECTSPACE_NORMALMAP){world.toNormalMatrix(this._normalMatrix);this.bindOnlyNormalMatrix(this._normalMatrix);}var mustRebind=effect._forceRebindOnNextCall||this._mustRebind(scene2,effect,mesh.visibility);MaterialHelper.BindBonesParameters(mesh,effect);var ubo=this._uniformBuffer;if(mustRebind){this.bindViewProjection(effect);if(!ubo.useUbo||!this.isFrozen||!ubo.isSync||effect._forceRebindOnNextCall){if(StandardMaterial.FresnelEnabled&&defines.FRESNEL){if(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled){ubo.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power);ubo.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias);}if(this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled){ubo.updateColor4("opacityParts",new Color3(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power);}if(this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled){ubo.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power);ubo.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias);}if(this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled){ubo.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power);ubo.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias);}if(this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled){ubo.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power);ubo.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias);}}if(scene2.texturesEnabled){if(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled){ubo.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level);MaterialHelper.BindTextureMatrix(this._diffuseTexture,ubo,"diffuse");}if(this._ambientTexture&&StandardMaterial.AmbientTextureEnabled){ubo.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level);MaterialHelper.BindTextureMatrix(this._ambientTexture,ubo,"ambient");}if(this._opacityTexture&&StandardMaterial.OpacityTextureEnabled){ubo.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level);MaterialHelper.BindTextureMatrix(this._opacityTexture,ubo,"opacity");}if(this._hasAlphaChannel()){ubo.updateFloat("alphaCutOff",this.alphaCutOff);}if(this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled){ubo.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness);ubo.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix());if(this._reflectionTexture.boundingBoxSize){var cubeTexture=this._reflectionTexture;ubo.updateVector3("vReflectionPosition",cubeTexture.boundingBoxPosition);ubo.updateVector3("vReflectionSize",cubeTexture.boundingBoxSize);}}if(this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled){ubo.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level);MaterialHelper.BindTextureMatrix(this._emissiveTexture,ubo,"emissive");}if(this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled){ubo.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level);MaterialHelper.BindTextureMatrix(this._lightmapTexture,ubo,"lightmap");}if(this._specularTexture&&StandardMaterial.SpecularTextureEnabled){ubo.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level);MaterialHelper.BindTextureMatrix(this._specularTexture,ubo,"specular");}if(this._bumpTexture&&scene2.getEngine().getCaps().standardDerivatives&&StandardMaterial.BumpTextureEnabled){ubo.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias);MaterialHelper.BindTextureMatrix(this._bumpTexture,ubo,"bump");if(scene2._mirroredCameraPosition){ubo.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1);}else{ubo.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1);}}if(this._refractionTexture&&StandardMaterial.RefractionTextureEnabled){var depth=1;if(!this._refractionTexture.isCube){ubo.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix());if(this._refractionTexture.depth){depth=this._refractionTexture.depth;}}ubo.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,depth,this.invertRefractionY?-1:1);if(this._refractionTexture.boundingBoxSize){var _cubeTexture=this._refractionTexture;ubo.updateVector3("vRefractionPosition",_cubeTexture.boundingBoxPosition);ubo.updateVector3("vRefractionSize",_cubeTexture.boundingBoxSize);}}}if(this.pointsCloud){ubo.updateFloat("pointSize",this.pointSize);}if(defines.SPECULARTERM){ubo.updateColor4("vSpecularColor",this.specularColor,this.specularPower);}ubo.updateColor3("vEmissiveColor",StandardMaterial.EmissiveTextureEnabled?this.emissiveColor:Color3.BlackReadOnly);ubo.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha);scene2.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor);ubo.updateColor3("vAmbientColor",this._globalAmbientColor);}if(scene2.texturesEnabled){if(this._diffuseTexture&&StandardMaterial.DiffuseTextureEnabled){effect.setTexture("diffuseSampler",this._diffuseTexture);}if(this._ambientTexture&&StandardMaterial.AmbientTextureEnabled){effect.setTexture("ambientSampler",this._ambientTexture);}if(this._opacityTexture&&StandardMaterial.OpacityTextureEnabled){effect.setTexture("opacitySampler",this._opacityTexture);}if(this._reflectionTexture&&StandardMaterial.ReflectionTextureEnabled){if(this._reflectionTexture.isCube){effect.setTexture("reflectionCubeSampler",this._reflectionTexture);}else{effect.setTexture("reflection2DSampler",this._reflectionTexture);}}if(this._emissiveTexture&&StandardMaterial.EmissiveTextureEnabled){effect.setTexture("emissiveSampler",this._emissiveTexture);}if(this._lightmapTexture&&StandardMaterial.LightmapTextureEnabled){effect.setTexture("lightmapSampler",this._lightmapTexture);}if(this._specularTexture&&StandardMaterial.SpecularTextureEnabled){effect.setTexture("specularSampler",this._specularTexture);}if(this._bumpTexture&&scene2.getEngine().getCaps().standardDerivatives&&StandardMaterial.BumpTextureEnabled){effect.setTexture("bumpSampler",this._bumpTexture);}if(this._refractionTexture&&StandardMaterial.RefractionTextureEnabled){if(this._refractionTexture.isCube){effect.setTexture("refractionCubeSampler",this._refractionTexture);}else{effect.setTexture("refraction2DSampler",this._refractionTexture);}}}if(this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(mesh)){this.getScene().depthPeelingRenderer.bind(effect);}this._eventInfo.subMesh=subMesh;this._callbackPluginEventBindForSubMesh(this._eventInfo);bindClipPlane(effect,this,scene2);this.bindEyePosition(effect);}else if(scene2.getEngine()._features.needToAlwaysBindUniformBuffers){this._needToBindSceneUbo=true;}if(mustRebind||!this.isFrozen){if(scene2.lightsEnabled&&!this._disableLighting){MaterialHelper.BindLights(scene2,mesh,effect,defines,this._maxSimultaneousLights);}if(scene2.fogEnabled&&mesh.applyFog&&scene2.fogMode!==Scene.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||mesh.receiveShadows||defines.PREPASS){this.bindView(effect);}MaterialHelper.BindFogParameters(scene2,mesh,effect);if(defines.NUM_MORPH_INFLUENCERS){MaterialHelper.BindMorphTargetParameters(mesh,effect);}if(defines.BAKED_VERTEX_ANIMATION_TEXTURE){(_a=mesh.bakedVertexAnimationManager)===null||_a===void 0?void 0:_a.bind(effect,defines.INSTANCES);}if(this.useLogarithmicDepth){MaterialHelper.BindLogDepth(defines,effect,scene2);}if(this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess){this._imageProcessingConfiguration.bind(this._activeEffect);}}this._afterBind(mesh,this._activeEffect);ubo.update();}},{key:"getAnimatables",value:function getAnimatables(){var results=_get(_getPrototypeOf(StandardMaterial.prototype),"getAnimatables",this).call(this);if(this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0){results.push(this._diffuseTexture);}if(this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0){results.push(this._ambientTexture);}if(this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0){results.push(this._opacityTexture);}if(this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0){results.push(this._reflectionTexture);}if(this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0){results.push(this._emissiveTexture);}if(this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0){results.push(this._specularTexture);}if(this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0){results.push(this._bumpTexture);}if(this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0){results.push(this._lightmapTexture);}if(this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0){results.push(this._refractionTexture);}return results;}},{key:"getActiveTextures",value:function getActiveTextures(){var activeTextures=_get(_getPrototypeOf(StandardMaterial.prototype),"getActiveTextures",this).call(this);if(this._diffuseTexture){activeTextures.push(this._diffuseTexture);}if(this._ambientTexture){activeTextures.push(this._ambientTexture);}if(this._opacityTexture){activeTextures.push(this._opacityTexture);}if(this._reflectionTexture){activeTextures.push(this._reflectionTexture);}if(this._emissiveTexture){activeTextures.push(this._emissiveTexture);}if(this._specularTexture){activeTextures.push(this._specularTexture);}if(this._bumpTexture){activeTextures.push(this._bumpTexture);}if(this._lightmapTexture){activeTextures.push(this._lightmapTexture);}if(this._refractionTexture){activeTextures.push(this._refractionTexture);}return activeTextures;}},{key:"hasTexture",value:function hasTexture(texture){if(_get(_getPrototypeOf(StandardMaterial.prototype),"hasTexture",this).call(this,texture)){return true;}if(this._diffuseTexture===texture){return true;}if(this._ambientTexture===texture){return true;}if(this._opacityTexture===texture){return true;}if(this._reflectionTexture===texture){return true;}if(this._emissiveTexture===texture){return true;}if(this._specularTexture===texture){return true;}if(this._bumpTexture===texture){return true;}if(this._lightmapTexture===texture){return true;}if(this._refractionTexture===texture){return true;}return false;}},{key:"dispose",value:function dispose(forceDisposeEffect,forceDisposeTextures){var _a,_b,_c,_d,_e,_f,_g,_h,_j;if(forceDisposeTextures){(_a=this._diffuseTexture)===null||_a===void 0?void 0:_a.dispose();(_b=this._ambientTexture)===null||_b===void 0?void 0:_b.dispose();(_c=this._opacityTexture)===null||_c===void 0?void 0:_c.dispose();(_d=this._reflectionTexture)===null||_d===void 0?void 0:_d.dispose();(_e=this._emissiveTexture)===null||_e===void 0?void 0:_e.dispose();(_f=this._specularTexture)===null||_f===void 0?void 0:_f.dispose();(_g=this._bumpTexture)===null||_g===void 0?void 0:_g.dispose();(_h=this._lightmapTexture)===null||_h===void 0?void 0:_h.dispose();(_j=this._refractionTexture)===null||_j===void 0?void 0:_j.dispose();}if(this._imageProcessingConfiguration&&this._imageProcessingObserver){this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);}_get(_getPrototypeOf(StandardMaterial.prototype),"dispose",this).call(this,forceDisposeEffect,forceDisposeTextures);}},{key:"clone",value:function clone(name135){var _this140=this;var result=SerializationHelper.Clone(function(){return new StandardMaterial(name135,_this140.getScene());},this);result.name=name135;result.id=name135;this.stencil.copyTo(result.stencil);return result;}}],[{key:"Parse",value:function Parse(source,scene2,rootUrl){var material=SerializationHelper.Parse(function(){return new StandardMaterial(source.name,scene2);},source,scene2,rootUrl);if(source.stencil){material.stencil.parse(source.stencil,scene2,rootUrl);}return material;}},{key:"DiffuseTextureEnabled",get:function get(){return MaterialFlags.DiffuseTextureEnabled;},set:function set(value){MaterialFlags.DiffuseTextureEnabled=value;}},{key:"DetailTextureEnabled",get:function get(){return MaterialFlags.DetailTextureEnabled;},set:function set(value){MaterialFlags.DetailTextureEnabled=value;}},{key:"AmbientTextureEnabled",get:function get(){return MaterialFlags.AmbientTextureEnabled;},set:function set(value){MaterialFlags.AmbientTextureEnabled=value;}},{key:"OpacityTextureEnabled",get:function get(){return MaterialFlags.OpacityTextureEnabled;},set:function set(value){MaterialFlags.OpacityTextureEnabled=value;}},{key:"ReflectionTextureEnabled",get:function get(){return MaterialFlags.ReflectionTextureEnabled;},set:function set(value){MaterialFlags.ReflectionTextureEnabled=value;}},{key:"EmissiveTextureEnabled",get:function get(){return MaterialFlags.EmissiveTextureEnabled;},set:function set(value){MaterialFlags.EmissiveTextureEnabled=value;}},{key:"SpecularTextureEnabled",get:function get(){return MaterialFlags.SpecularTextureEnabled;},set:function set(value){MaterialFlags.SpecularTextureEnabled=value;}},{key:"BumpTextureEnabled",get:function get(){return MaterialFlags.BumpTextureEnabled;},set:function set(value){MaterialFlags.BumpTextureEnabled=value;}},{key:"LightmapTextureEnabled",get:function get(){return MaterialFlags.LightmapTextureEnabled;},set:function set(value){MaterialFlags.LightmapTextureEnabled=value;}},{key:"RefractionTextureEnabled",get:function get(){return MaterialFlags.RefractionTextureEnabled;},set:function set(value){MaterialFlags.RefractionTextureEnabled=value;}},{key:"ColorGradingTextureEnabled",get:function get(){return MaterialFlags.ColorGradingTextureEnabled;},set:function set(value){MaterialFlags.ColorGradingTextureEnabled=value;}},{key:"FresnelEnabled",get:function get(){return MaterialFlags.FresnelEnabled;},set:function set(value){MaterialFlags.FresnelEnabled=value;}}]);return StandardMaterial;}(PushMaterial);__decorate([serializeAsTexture("diffuseTexture")],StandardMaterial.prototype,"_diffuseTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"diffuseTexture",void 0);__decorate([serializeAsTexture("ambientTexture")],StandardMaterial.prototype,"_ambientTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"ambientTexture",void 0);__decorate([serializeAsTexture("opacityTexture")],StandardMaterial.prototype,"_opacityTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"opacityTexture",void 0);__decorate([serializeAsTexture("reflectionTexture")],StandardMaterial.prototype,"_reflectionTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"reflectionTexture",void 0);__decorate([serializeAsTexture("emissiveTexture")],StandardMaterial.prototype,"_emissiveTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"emissiveTexture",void 0);__decorate([serializeAsTexture("specularTexture")],StandardMaterial.prototype,"_specularTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"specularTexture",void 0);__decorate([serializeAsTexture("bumpTexture")],StandardMaterial.prototype,"_bumpTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"bumpTexture",void 0);__decorate([serializeAsTexture("lightmapTexture")],StandardMaterial.prototype,"_lightmapTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"lightmapTexture",void 0);__decorate([serializeAsTexture("refractionTexture")],StandardMaterial.prototype,"_refractionTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"refractionTexture",void 0);__decorate([serializeAsColor3("ambient")],StandardMaterial.prototype,"ambientColor",void 0);__decorate([serializeAsColor3("diffuse")],StandardMaterial.prototype,"diffuseColor",void 0);__decorate([serializeAsColor3("specular")],StandardMaterial.prototype,"specularColor",void 0);__decorate([serializeAsColor3("emissive")],StandardMaterial.prototype,"emissiveColor",void 0);__decorate([serialize()],StandardMaterial.prototype,"specularPower",void 0);__decorate([serialize("useAlphaFromDiffuseTexture")],StandardMaterial.prototype,"_useAlphaFromDiffuseTexture",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],StandardMaterial.prototype,"useAlphaFromDiffuseTexture",void 0);__decorate([serialize("useEmissiveAsIllumination")],StandardMaterial.prototype,"_useEmissiveAsIllumination",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useEmissiveAsIllumination",void 0);__decorate([serialize("linkEmissiveWithDiffuse")],StandardMaterial.prototype,"_linkEmissiveWithDiffuse",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"linkEmissiveWithDiffuse",void 0);__decorate([serialize("useSpecularOverAlpha")],StandardMaterial.prototype,"_useSpecularOverAlpha",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useSpecularOverAlpha",void 0);__decorate([serialize("useReflectionOverAlpha")],StandardMaterial.prototype,"_useReflectionOverAlpha",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useReflectionOverAlpha",void 0);__decorate([serialize("disableLighting")],StandardMaterial.prototype,"_disableLighting",void 0);__decorate([expandToProperty("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"disableLighting",void 0);__decorate([serialize("useObjectSpaceNormalMap")],StandardMaterial.prototype,"_useObjectSpaceNormalMap",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useObjectSpaceNormalMap",void 0);__decorate([serialize("useParallax")],StandardMaterial.prototype,"_useParallax",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallax",void 0);__decorate([serialize("useParallaxOcclusion")],StandardMaterial.prototype,"_useParallaxOcclusion",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useParallaxOcclusion",void 0);__decorate([serialize()],StandardMaterial.prototype,"parallaxScaleBias",void 0);__decorate([serialize("roughness")],StandardMaterial.prototype,"_roughness",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"roughness",void 0);__decorate([serialize()],StandardMaterial.prototype,"indexOfRefraction",void 0);__decorate([serialize()],StandardMaterial.prototype,"invertRefractionY",void 0);__decorate([serialize()],StandardMaterial.prototype,"alphaCutOff",void 0);__decorate([serialize("useLightmapAsShadowmap")],StandardMaterial.prototype,"_useLightmapAsShadowmap",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useLightmapAsShadowmap",void 0);__decorate([serializeAsFresnelParameters("diffuseFresnelParameters")],StandardMaterial.prototype,"_diffuseFresnelParameters",void 0);__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"diffuseFresnelParameters",void 0);__decorate([serializeAsFresnelParameters("opacityFresnelParameters")],StandardMaterial.prototype,"_opacityFresnelParameters",void 0);__decorate([expandToProperty("_markAllSubMeshesAsFresnelAndMiscDirty")],StandardMaterial.prototype,"opacityFresnelParameters",void 0);__decorate([serializeAsFresnelParameters("reflectionFresnelParameters")],StandardMaterial.prototype,"_reflectionFresnelParameters",void 0);__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"reflectionFresnelParameters",void 0);__decorate([serializeAsFresnelParameters("refractionFresnelParameters")],StandardMaterial.prototype,"_refractionFresnelParameters",void 0);__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"refractionFresnelParameters",void 0);__decorate([serializeAsFresnelParameters("emissiveFresnelParameters")],StandardMaterial.prototype,"_emissiveFresnelParameters",void 0);__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"emissiveFresnelParameters",void 0);__decorate([serialize("useReflectionFresnelFromSpecular")],StandardMaterial.prototype,"_useReflectionFresnelFromSpecular",void 0);__decorate([expandToProperty("_markAllSubMeshesAsFresnelDirty")],StandardMaterial.prototype,"useReflectionFresnelFromSpecular",void 0);__decorate([serialize("useGlossinessFromSpecularMapAlpha")],StandardMaterial.prototype,"_useGlossinessFromSpecularMapAlpha",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"useGlossinessFromSpecularMapAlpha",void 0);__decorate([serialize("maxSimultaneousLights")],StandardMaterial.prototype,"_maxSimultaneousLights",void 0);__decorate([expandToProperty("_markAllSubMeshesAsLightsDirty")],StandardMaterial.prototype,"maxSimultaneousLights",void 0);__decorate([serialize("invertNormalMapX")],StandardMaterial.prototype,"_invertNormalMapX",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapX",void 0);__decorate([serialize("invertNormalMapY")],StandardMaterial.prototype,"_invertNormalMapY",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"invertNormalMapY",void 0);__decorate([serialize("twoSidedLighting")],StandardMaterial.prototype,"_twoSidedLighting",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],StandardMaterial.prototype,"twoSidedLighting",void 0);__decorate([serialize()],StandardMaterial.prototype,"useLogarithmicDepth",null);RegisterClass("BABYLON.StandardMaterial",StandardMaterial);Scene.DefaultMaterialFactory=function(scene2){return new StandardMaterial("default material",scene2);};// node_modules/@babylonjs/core/Materials/shaderMaterial.js
var onCreatedEffectParameters2={effect:null,subMesh:null};var ShaderMaterial=/*#__PURE__*/function(_PushMaterial2){_inherits(ShaderMaterial,_PushMaterial2);var _super43=_createSuper(ShaderMaterial);function ShaderMaterial(name135,scene2,shaderPath){var _this141;var options=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var storeEffectOnSubMeshes=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;_classCallCheck(this,ShaderMaterial);_this141=_super43.call(this,name135,scene2,storeEffectOnSubMeshes);_this141._textures={};_this141._textureArrays={};_this141._externalTextures={};_this141._floats={};_this141._ints={};_this141._uints={};_this141._floatsArrays={};_this141._colors3={};_this141._colors3Arrays={};_this141._colors4={};_this141._colors4Arrays={};_this141._vectors2={};_this141._vectors3={};_this141._vectors4={};_this141._quaternions={};_this141._quaternionsArrays={};_this141._matrices={};_this141._matrixArrays={};_this141._matrices3x3={};_this141._matrices2x2={};_this141._vectors2Arrays={};_this141._vectors3Arrays={};_this141._vectors4Arrays={};_this141._uniformBuffers={};_this141._textureSamplers={};_this141._storageBuffers={};_this141._cachedWorldViewMatrix=new Matrix();_this141._cachedWorldViewProjectionMatrix=new Matrix();_this141._multiview=false;_this141._shaderPath=shaderPath;_this141._options=_objectSpread({needAlphaBlending:false,needAlphaTesting:false,attributes:["position","normal","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:false},options);return _this141;}_createClass(ShaderMaterial,[{key:"shaderPath",get:function get(){return this._shaderPath;},set:function set(shaderPath){this._shaderPath=shaderPath;}},{key:"options",get:function get(){return this._options;}},{key:"getClassName",value:function getClassName(){return"ShaderMaterial";}},{key:"needAlphaBlending",value:function needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending;}},{key:"needAlphaTesting",value:function needAlphaTesting(){return this._options.needAlphaTesting;}},{key:"_checkUniform",value:function _checkUniform(uniformName){if(this._options.uniforms.indexOf(uniformName)===-1){this._options.uniforms.push(uniformName);}}},{key:"setTexture",value:function setTexture(name135,texture){if(this._options.samplers.indexOf(name135)===-1){this._options.samplers.push(name135);}this._textures[name135]=texture;return this;}},{key:"setTextureArray",value:function setTextureArray(name135,textures){if(this._options.samplers.indexOf(name135)===-1){this._options.samplers.push(name135);}this._checkUniform(name135);this._textureArrays[name135]=textures;return this;}},{key:"setExternalTexture",value:function setExternalTexture(name135,texture){if(this._options.externalTextures.indexOf(name135)===-1){this._options.externalTextures.push(name135);}this._externalTextures[name135]=texture;return this;}},{key:"setFloat",value:function setFloat(name135,value){this._checkUniform(name135);this._floats[name135]=value;return this;}},{key:"setInt",value:function setInt(name135,value){this._checkUniform(name135);this._ints[name135]=value;return this;}},{key:"setUInt",value:function setUInt(name135,value){this._checkUniform(name135);this._uints[name135]=value;return this;}},{key:"setFloats",value:function setFloats(name135,value){this._checkUniform(name135);this._floatsArrays[name135]=value;return this;}},{key:"setColor3",value:function setColor3(name135,value){this._checkUniform(name135);this._colors3[name135]=value;return this;}},{key:"setColor3Array",value:function setColor3Array(name135,value){this._checkUniform(name135);this._colors3Arrays[name135]=value.reduce(function(arr,color){color.toArray(arr,arr.length);return arr;},[]);return this;}},{key:"setColor4",value:function setColor4(name135,value){this._checkUniform(name135);this._colors4[name135]=value;return this;}},{key:"setColor4Array",value:function setColor4Array(name135,value){this._checkUniform(name135);this._colors4Arrays[name135]=value.reduce(function(arr,color){color.toArray(arr,arr.length);return arr;},[]);return this;}},{key:"setVector2",value:function setVector2(name135,value){this._checkUniform(name135);this._vectors2[name135]=value;return this;}},{key:"setVector3",value:function setVector3(name135,value){this._checkUniform(name135);this._vectors3[name135]=value;return this;}},{key:"setVector4",value:function setVector4(name135,value){this._checkUniform(name135);this._vectors4[name135]=value;return this;}},{key:"setQuaternion",value:function setQuaternion(name135,value){this._checkUniform(name135);this._quaternions[name135]=value;return this;}},{key:"setQuaternionArray",value:function setQuaternionArray(name135,value){this._checkUniform(name135);this._quaternionsArrays[name135]=value.reduce(function(arr,quaternion){quaternion.toArray(arr,arr.length);return arr;},[]);return this;}},{key:"setMatrix",value:function setMatrix(name135,value){this._checkUniform(name135);this._matrices[name135]=value;return this;}},{key:"setMatrices",value:function setMatrices(name135,value){this._checkUniform(name135);var float32Array=new Float32Array(value.length*16);for(var index=0;index<value.length;index++){var matrix=value[index];matrix.copyToArray(float32Array,index*16);}this._matrixArrays[name135]=float32Array;return this;}},{key:"setMatrix3x3",value:function setMatrix3x3(name135,value){this._checkUniform(name135);this._matrices3x3[name135]=value;return this;}},{key:"setMatrix2x2",value:function setMatrix2x2(name135,value){this._checkUniform(name135);this._matrices2x2[name135]=value;return this;}},{key:"setArray2",value:function setArray2(name135,value){this._checkUniform(name135);this._vectors2Arrays[name135]=value;return this;}},{key:"setArray3",value:function setArray3(name135,value){this._checkUniform(name135);this._vectors3Arrays[name135]=value;return this;}},{key:"setArray4",value:function setArray4(name135,value){this._checkUniform(name135);this._vectors4Arrays[name135]=value;return this;}},{key:"setUniformBuffer",value:function setUniformBuffer(name135,buffer){if(this._options.uniformBuffers.indexOf(name135)===-1){this._options.uniformBuffers.push(name135);}this._uniformBuffers[name135]=buffer;return this;}},{key:"setTextureSampler",value:function setTextureSampler(name135,sampler){if(this._options.samplerObjects.indexOf(name135)===-1){this._options.samplerObjects.push(name135);}this._textureSamplers[name135]=sampler;return this;}},{key:"setStorageBuffer",value:function setStorageBuffer(name135,buffer){if(this._options.storageBuffers.indexOf(name135)===-1){this._options.storageBuffers.push(name135);}this._storageBuffers[name135]=buffer;return this;}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(mesh,subMesh,useInstances){return this.isReady(mesh,useInstances,subMesh);}},{key:"isReady",value:function isReady(mesh,useInstances,subMesh){var _a,_b,_c,_d;var storeEffectOnSubMeshes=subMesh&&this._storeEffectOnSubMeshes;if(this.isFrozen){if(storeEffectOnSubMeshes){if(subMesh.effect&&subMesh.effect._wasPreviouslyReady){return true;}}else{var effect2=this._drawWrapper.effect;if(effect2&&effect2._wasPreviouslyReady&&effect2._wasPreviouslyUsingInstances===useInstances){return true;}}}var scene2=this.getScene();var engine=scene2.getEngine();var defines=[];var attribs=[];var fallbacks=new EffectFallbacks();var shaderName=this._shaderPath,uniforms=this._options.uniforms,uniformBuffers=this._options.uniformBuffers,samplers=this._options.samplers;if(engine.getCaps().multiview&&scene2.activeCamera&&scene2.activeCamera.outputRenderTarget&&scene2.activeCamera.outputRenderTarget.getViewCount()>1){this._multiview=true;defines.push("#define MULTIVIEW");if(this._options.uniforms.indexOf("viewProjection")!==-1&&this._options.uniforms.indexOf("viewProjectionR")===-1){this._options.uniforms.push("viewProjectionR");}}for(var index=0;index<this._options.defines.length;index++){var defineToAdd=this._options.defines[index].indexOf("#define")===0?this._options.defines[index]:"#define ".concat(this._options.defines[index]);defines.push(defineToAdd);}for(var _index26=0;_index26<this._options.attributes.length;_index26++){attribs.push(this._options.attributes[_index26]);}if(mesh&&mesh.isVerticesDataPresent(VertexBuffer.ColorKind)){attribs.push(VertexBuffer.ColorKind);defines.push("#define VERTEXCOLOR");}if(useInstances){defines.push("#define INSTANCES");MaterialHelper.PushAttributesForInstances(attribs);if(mesh===null||mesh===void 0?void 0:mesh.hasThinInstances){defines.push("#define THIN_INSTANCES");if(mesh&&mesh.isVerticesDataPresent(VertexBuffer.ColorInstanceKind)){attribs.push(VertexBuffer.ColorInstanceKind);defines.push("#define INSTANCESCOLOR");}}}if(mesh&&mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton){attribs.push(VertexBuffer.MatricesIndicesKind);attribs.push(VertexBuffer.MatricesWeightsKind);if(mesh.numBoneInfluencers>4){attribs.push(VertexBuffer.MatricesIndicesExtraKind);attribs.push(VertexBuffer.MatricesWeightsExtraKind);}var skeleton=mesh.skeleton;defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers);fallbacks.addCPUSkinningFallback(0,mesh);if(skeleton.isUsingTextureForMatrices){defines.push("#define BONETEXTURE");if(this._options.uniforms.indexOf("boneTextureWidth")===-1){this._options.uniforms.push("boneTextureWidth");}if(this._options.samplers.indexOf("boneSampler")===-1){this._options.samplers.push("boneSampler");}}else{defines.push("#define BonesPerMesh "+(skeleton.bones.length+1));if(this._options.uniforms.indexOf("mBones")===-1){this._options.uniforms.push("mBones");}}}else{defines.push("#define NUM_BONE_INFLUENCERS 0");}var numInfluencers=0;var manager=mesh?mesh.morphTargetManager:null;if(manager){var uv=manager.supportsUVs&&defines.indexOf("#define UV1")!==-1;var tangent=manager.supportsTangents&&defines.indexOf("#define TANGENT")!==-1;var normal=manager.supportsNormals&&defines.indexOf("#define NORMAL")!==-1;numInfluencers=manager.numInfluencers;if(uv){defines.push("#define MORPHTARGETS_UV");}if(tangent){defines.push("#define MORPHTARGETS_TANGENT");}if(normal){defines.push("#define MORPHTARGETS_NORMAL");}if(numInfluencers>0){defines.push("#define MORPHTARGETS");}if(manager.isUsingTextureForTargets){defines.push("#define MORPHTARGETS_TEXTURE");if(this._options.uniforms.indexOf("morphTargetTextureIndices")===-1){this._options.uniforms.push("morphTargetTextureIndices");}if(this._options.samplers.indexOf("morphTargets")===-1){this._options.samplers.push("morphTargets");}}defines.push("#define NUM_MORPH_INFLUENCERS "+numInfluencers);for(var _index27=0;_index27<numInfluencers;_index27++){attribs.push(VertexBuffer.PositionKind+_index27);if(normal){attribs.push(VertexBuffer.NormalKind+_index27);}if(tangent){attribs.push(VertexBuffer.TangentKind+_index27);}if(uv){attribs.push(VertexBuffer.UVKind+"_"+_index27);}}if(numInfluencers>0){uniforms=uniforms.slice();uniforms.push("morphTargetInfluences");uniforms.push("morphTargetTextureInfo");uniforms.push("morphTargetTextureIndices");}}else{defines.push("#define NUM_MORPH_INFLUENCERS 0");}if(mesh){var bvaManager=mesh.bakedVertexAnimationManager;if(bvaManager&&bvaManager.isEnabled){defines.push("#define BAKED_VERTEX_ANIMATION_TEXTURE");if(this._options.uniforms.indexOf("bakedVertexAnimationSettings")===-1){this._options.uniforms.push("bakedVertexAnimationSettings");}if(this._options.uniforms.indexOf("bakedVertexAnimationTextureSizeInverted")===-1){this._options.uniforms.push("bakedVertexAnimationTextureSizeInverted");}if(this._options.uniforms.indexOf("bakedVertexAnimationTime")===-1){this._options.uniforms.push("bakedVertexAnimationTime");}if(this._options.samplers.indexOf("bakedVertexAnimationTexture")===-1){this._options.samplers.push("bakedVertexAnimationTexture");}}MaterialHelper.PrepareAttributesForBakedVertexAnimation(attribs,mesh,defines);}for(var name135 in this._textures){if(!this._textures[name135].isReady()){return false;}}if(mesh&&this._shouldTurnAlphaTestOn(mesh)){defines.push("#define ALPHATEST");}if(this._options.useClipPlane!==false){addClipPlaneUniforms(uniforms);prepareDefinesForClipPlanes(this,scene2,defines);}if(this.customShaderNameResolve){uniforms=uniforms.slice();uniformBuffers=uniformBuffers.slice();samplers=samplers.slice();shaderName=this.customShaderNameResolve(shaderName,uniforms,uniformBuffers,samplers,defines,attribs);}var drawWrapper=storeEffectOnSubMeshes?subMesh._getDrawWrapper():this._drawWrapper;var previousEffect=(_a=drawWrapper===null||drawWrapper===void 0?void 0:drawWrapper.effect)!==null&&_a!==void 0?_a:null;var previousDefines=(_b=drawWrapper===null||drawWrapper===void 0?void 0:drawWrapper.defines)!==null&&_b!==void 0?_b:null;var join=defines.join("\n");var effect=previousEffect;if(previousDefines!==join){effect=engine.createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:numInfluencers},shaderLanguage:this._options.shaderLanguage},engine);if(storeEffectOnSubMeshes){subMesh.setEffect(effect,join,this._materialContext);}else if(drawWrapper){drawWrapper.setEffect(effect,join);}if(this._onEffectCreatedObservable){onCreatedEffectParameters2.effect=effect;onCreatedEffectParameters2.subMesh=(_c=subMesh!==null&&subMesh!==void 0?subMesh:mesh===null||mesh===void 0?void 0:mesh.subMeshes[0])!==null&&_c!==void 0?_c:null;this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters2);}}effect._wasPreviouslyUsingInstances=!!useInstances;if((_d=!(effect===null||effect===void 0?void 0:effect.isReady()))!==null&&_d!==void 0?_d:true){return false;}if(previousEffect!==effect){scene2.resetCachedMaterial();}effect._wasPreviouslyReady=true;return true;}},{key:"bindOnlyWorldMatrix",value:function bindOnlyWorldMatrix(world,effectOverride){var scene2=this.getScene();var effect=effectOverride!==null&&effectOverride!==void 0?effectOverride:this.getEffect();if(!effect){return;}if(this._options.uniforms.indexOf("world")!==-1){effect.setMatrix("world",world);}if(this._options.uniforms.indexOf("worldView")!==-1){world.multiplyToRef(scene2.getViewMatrix(),this._cachedWorldViewMatrix);effect.setMatrix("worldView",this._cachedWorldViewMatrix);}if(this._options.uniforms.indexOf("worldViewProjection")!==-1){world.multiplyToRef(scene2.getTransformMatrix(),this._cachedWorldViewProjectionMatrix);effect.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix);}}},{key:"bindForSubMesh",value:function bindForSubMesh(world,mesh,subMesh){var _a;this.bind(world,mesh,(_a=subMesh._drawWrapperOverride)===null||_a===void 0?void 0:_a.effect,subMesh);}},{key:"bind",value:function bind(world,mesh,effectOverride,subMesh){var _a;var storeEffectOnSubMeshes=subMesh&&this._storeEffectOnSubMeshes;var effect=effectOverride!==null&&effectOverride!==void 0?effectOverride:storeEffectOnSubMeshes?subMesh.effect:this.getEffect();if(!effect){return;}this._activeEffect=effect;this.bindOnlyWorldMatrix(world,effectOverride);var uniformBuffers=this._options.uniformBuffers;var useSceneUBO=false;if(effect&&uniformBuffers&&uniformBuffers.length>0&&this.getScene().getEngine().supportsUniformBuffers){for(var i=0;i<uniformBuffers.length;++i){var bufferName=uniformBuffers[i];switch(bufferName){case"Mesh":if(mesh){mesh.getMeshUniformBuffer().bindToEffect(effect,"Mesh");mesh.transferToEffect(world);}break;case"Scene":MaterialHelper.BindSceneUniformBuffer(effect,this.getScene().getSceneUniformBuffer());this.getScene().finalizeSceneUbo();useSceneUBO=true;break;}}}var mustRebind=mesh&&storeEffectOnSubMeshes?this._mustRebind(this.getScene(),effect,mesh.visibility):this.getScene().getCachedMaterial()!==this;if(effect&&mustRebind){if(!useSceneUBO&&this._options.uniforms.indexOf("view")!==-1){effect.setMatrix("view",this.getScene().getViewMatrix());}if(!useSceneUBO&&this._options.uniforms.indexOf("projection")!==-1){effect.setMatrix("projection",this.getScene().getProjectionMatrix());}if(!useSceneUBO&&this._options.uniforms.indexOf("viewProjection")!==-1){effect.setMatrix("viewProjection",this.getScene().getTransformMatrix());if(this._multiview){effect.setMatrix("viewProjectionR",this.getScene()._transformMatrixR);}}if(this.getScene().activeCamera&&this._options.uniforms.indexOf("cameraPosition")!==-1){effect.setVector3("cameraPosition",this.getScene().activeCamera.globalPosition);}MaterialHelper.BindBonesParameters(mesh,effect);bindClipPlane(effect,this,this.getScene());var name135;for(name135 in this._textures){effect.setTexture(name135,this._textures[name135]);}for(name135 in this._textureArrays){effect.setTextureArray(name135,this._textureArrays[name135]);}for(name135 in this._externalTextures){effect.setExternalTexture(name135,this._externalTextures[name135]);}for(name135 in this._ints){effect.setInt(name135,this._ints[name135]);}for(name135 in this._uints){effect.setUInt(name135,this._uints[name135]);}for(name135 in this._floats){effect.setFloat(name135,this._floats[name135]);}for(name135 in this._floatsArrays){effect.setArray(name135,this._floatsArrays[name135]);}for(name135 in this._colors3){effect.setColor3(name135,this._colors3[name135]);}for(name135 in this._colors3Arrays){effect.setArray3(name135,this._colors3Arrays[name135]);}for(name135 in this._colors4){var color=this._colors4[name135];effect.setFloat4(name135,color.r,color.g,color.b,color.a);}for(name135 in this._colors4Arrays){effect.setArray4(name135,this._colors4Arrays[name135]);}for(name135 in this._vectors2){effect.setVector2(name135,this._vectors2[name135]);}for(name135 in this._vectors3){effect.setVector3(name135,this._vectors3[name135]);}for(name135 in this._vectors4){effect.setVector4(name135,this._vectors4[name135]);}for(name135 in this._quaternions){effect.setQuaternion(name135,this._quaternions[name135]);}for(name135 in this._matrices){effect.setMatrix(name135,this._matrices[name135]);}for(name135 in this._matrixArrays){effect.setMatrices(name135,this._matrixArrays[name135]);}for(name135 in this._matrices3x3){effect.setMatrix3x3(name135,this._matrices3x3[name135]);}for(name135 in this._matrices2x2){effect.setMatrix2x2(name135,this._matrices2x2[name135]);}for(name135 in this._vectors2Arrays){effect.setArray2(name135,this._vectors2Arrays[name135]);}for(name135 in this._vectors3Arrays){effect.setArray3(name135,this._vectors3Arrays[name135]);}for(name135 in this._vectors4Arrays){effect.setArray4(name135,this._vectors4Arrays[name135]);}for(name135 in this._quaternionsArrays){effect.setArray4(name135,this._quaternionsArrays[name135]);}for(name135 in this._uniformBuffers){var buffer=this._uniformBuffers[name135].getBuffer();if(buffer){effect.bindUniformBuffer(buffer,name135);}}for(name135 in this._textureSamplers){effect.setTextureSampler(name135,this._textureSamplers[name135]);}for(name135 in this._storageBuffers){effect.setStorageBuffer(name135,this._storageBuffers[name135]);}}if(effect&&mesh&&(mustRebind||!this.isFrozen)){var manager=mesh.morphTargetManager;if(manager&&manager.numInfluencers>0){MaterialHelper.BindMorphTargetParameters(mesh,effect);}var bvaManager=mesh.bakedVertexAnimationManager;if(bvaManager&&bvaManager.isEnabled){(_a=mesh.bakedVertexAnimationManager)===null||_a===void 0?void 0:_a.bind(effect,!!effect._wasPreviouslyUsingInstances);}}this._afterBind(mesh,effect);}},{key:"getActiveTextures",value:function getActiveTextures(){var activeTextures=_get(_getPrototypeOf(ShaderMaterial.prototype),"getActiveTextures",this).call(this);for(var name135 in this._textures){activeTextures.push(this._textures[name135]);}for(var _name2 in this._textureArrays){var array=this._textureArrays[_name2];for(var index=0;index<array.length;index++){activeTextures.push(array[index]);}}return activeTextures;}},{key:"hasTexture",value:function hasTexture(texture){if(_get(_getPrototypeOf(ShaderMaterial.prototype),"hasTexture",this).call(this,texture)){return true;}for(var name135 in this._textures){if(this._textures[name135]===texture){return true;}}for(var _name3 in this._textureArrays){var array=this._textureArrays[_name3];for(var index=0;index<array.length;index++){if(array[index]===texture){return true;}}}return false;}},{key:"clone",value:function clone(name135){var _this142=this;var result=SerializationHelper.Clone(function(){return new ShaderMaterial(name135,_this142.getScene(),_this142._shaderPath,_this142._options,_this142._storeEffectOnSubMeshes);},this);result.name=name135;result.id=name135;if(_typeof(result._shaderPath)==="object"){result._shaderPath=_objectSpread({},result._shaderPath);}this._options=_objectSpread({},this._options);Object.keys(this._options).forEach(function(propName){var propValue=_this142._options[propName];if(Array.isArray(propValue)){_this142._options[propName]=propValue.slice(0);}});this.stencil.copyTo(result.stencil);for(var key in this._textures){result.setTexture(key,this._textures[key]);}for(var _key15 in this._textureArrays){result.setTextureArray(_key15,this._textureArrays[_key15]);}for(var _key16 in this._externalTextures){result.setExternalTexture(_key16,this._externalTextures[_key16]);}for(var _key17 in this._ints){result.setInt(_key17,this._ints[_key17]);}for(var _key18 in this._uints){result.setUInt(_key18,this._uints[_key18]);}for(var _key19 in this._floats){result.setFloat(_key19,this._floats[_key19]);}for(var _key20 in this._floatsArrays){result.setFloats(_key20,this._floatsArrays[_key20]);}for(var _key21 in this._colors3){result.setColor3(_key21,this._colors3[_key21]);}for(var _key22 in this._colors3Arrays){result._colors3Arrays[_key22]=this._colors3Arrays[_key22];}for(var _key23 in this._colors4){result.setColor4(_key23,this._colors4[_key23]);}for(var _key24 in this._colors4Arrays){result._colors4Arrays[_key24]=this._colors4Arrays[_key24];}for(var _key25 in this._vectors2){result.setVector2(_key25,this._vectors2[_key25]);}for(var _key26 in this._vectors3){result.setVector3(_key26,this._vectors3[_key26]);}for(var _key27 in this._vectors4){result.setVector4(_key27,this._vectors4[_key27]);}for(var _key28 in this._quaternions){result.setQuaternion(_key28,this._quaternions[_key28]);}for(var _key29 in this._quaternionsArrays){result._quaternionsArrays[_key29]=this._quaternionsArrays[_key29];}for(var _key30 in this._matrices){result.setMatrix(_key30,this._matrices[_key30]);}for(var _key31 in this._matrixArrays){result._matrixArrays[_key31]=this._matrixArrays[_key31].slice();}for(var _key32 in this._matrices3x3){result.setMatrix3x3(_key32,this._matrices3x3[_key32]);}for(var _key33 in this._matrices2x2){result.setMatrix2x2(_key33,this._matrices2x2[_key33]);}for(var _key34 in this._vectors2Arrays){result.setArray2(_key34,this._vectors2Arrays[_key34]);}for(var _key35 in this._vectors3Arrays){result.setArray3(_key35,this._vectors3Arrays[_key35]);}for(var _key36 in this._vectors4Arrays){result.setArray4(_key36,this._vectors4Arrays[_key36]);}for(var _key37 in this._uniformBuffers){result.setUniformBuffer(_key37,this._uniformBuffers[_key37]);}for(var _key38 in this._textureSamplers){result.setTextureSampler(_key38,this._textureSamplers[_key38]);}for(var _key39 in this._storageBuffers){result.setStorageBuffer(_key39,this._storageBuffers[_key39]);}return result;}},{key:"dispose",value:function dispose(forceDisposeEffect,forceDisposeTextures,notBoundToMesh){if(forceDisposeTextures){var name135;for(name135 in this._textures){this._textures[name135].dispose();}for(name135 in this._textureArrays){var array=this._textureArrays[name135];for(var index=0;index<array.length;index++){array[index].dispose();}}}this._textures={};_get(_getPrototypeOf(ShaderMaterial.prototype),"dispose",this).call(this,forceDisposeEffect,forceDisposeTextures,notBoundToMesh);}},{key:"serialize",value:function serialize(){var serializationObject=SerializationHelper.Serialize(this);serializationObject.customType="BABYLON.ShaderMaterial";serializationObject.uniqueId=this.uniqueId;serializationObject.options=this._options;serializationObject.shaderPath=this._shaderPath;serializationObject.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes;var name135;serializationObject.stencil=this.stencil.serialize();serializationObject.textures={};for(name135 in this._textures){serializationObject.textures[name135]=this._textures[name135].serialize();}serializationObject.textureArrays={};for(name135 in this._textureArrays){serializationObject.textureArrays[name135]=[];var array=this._textureArrays[name135];for(var index=0;index<array.length;index++){serializationObject.textureArrays[name135].push(array[index].serialize());}}serializationObject.ints={};for(name135 in this._ints){serializationObject.ints[name135]=this._ints[name135];}serializationObject.uints={};for(name135 in this._uints){serializationObject.uints[name135]=this._uints[name135];}serializationObject.floats={};for(name135 in this._floats){serializationObject.floats[name135]=this._floats[name135];}serializationObject.FloatArrays={};for(name135 in this._floatsArrays){serializationObject.FloatArrays[name135]=this._floatsArrays[name135];}serializationObject.colors3={};for(name135 in this._colors3){serializationObject.colors3[name135]=this._colors3[name135].asArray();}serializationObject.colors3Arrays={};for(name135 in this._colors3Arrays){serializationObject.colors3Arrays[name135]=this._colors3Arrays[name135];}serializationObject.colors4={};for(name135 in this._colors4){serializationObject.colors4[name135]=this._colors4[name135].asArray();}serializationObject.colors4Arrays={};for(name135 in this._colors4Arrays){serializationObject.colors4Arrays[name135]=this._colors4Arrays[name135];}serializationObject.vectors2={};for(name135 in this._vectors2){serializationObject.vectors2[name135]=this._vectors2[name135].asArray();}serializationObject.vectors3={};for(name135 in this._vectors3){serializationObject.vectors3[name135]=this._vectors3[name135].asArray();}serializationObject.vectors4={};for(name135 in this._vectors4){serializationObject.vectors4[name135]=this._vectors4[name135].asArray();}serializationObject.quaternions={};for(name135 in this._quaternions){serializationObject.quaternions[name135]=this._quaternions[name135].asArray();}serializationObject.matrices={};for(name135 in this._matrices){serializationObject.matrices[name135]=this._matrices[name135].asArray();}serializationObject.matrixArray={};for(name135 in this._matrixArrays){serializationObject.matrixArray[name135]=this._matrixArrays[name135];}serializationObject.matrices3x3={};for(name135 in this._matrices3x3){serializationObject.matrices3x3[name135]=this._matrices3x3[name135];}serializationObject.matrices2x2={};for(name135 in this._matrices2x2){serializationObject.matrices2x2[name135]=this._matrices2x2[name135];}serializationObject.vectors2Arrays={};for(name135 in this._vectors2Arrays){serializationObject.vectors2Arrays[name135]=this._vectors2Arrays[name135];}serializationObject.vectors3Arrays={};for(name135 in this._vectors3Arrays){serializationObject.vectors3Arrays[name135]=this._vectors3Arrays[name135];}serializationObject.vectors4Arrays={};for(name135 in this._vectors4Arrays){serializationObject.vectors4Arrays[name135]=this._vectors4Arrays[name135];}serializationObject.quaternionsArrays={};for(name135 in this._quaternionsArrays){serializationObject.quaternionsArrays[name135]=this._quaternionsArrays[name135];}return serializationObject;}}],[{key:"Parse",value:function Parse(source,scene2,rootUrl){var material=SerializationHelper.Parse(function(){return new ShaderMaterial(source.name,scene2,source.shaderPath,source.options,source.storeEffectOnSubMeshes);},source,scene2,rootUrl);var name135;if(source.stencil){material.stencil.parse(source.stencil,scene2,rootUrl);}for(name135 in source.textures){material.setTexture(name135,Texture.Parse(source.textures[name135],scene2,rootUrl));}for(name135 in source.textureArrays){var array=source.textureArrays[name135];var textureArray=new Array();for(var index=0;index<array.length;index++){textureArray.push(Texture.Parse(array[index],scene2,rootUrl));}material.setTextureArray(name135,textureArray);}for(name135 in source.ints){material.setInt(name135,source.ints[name135]);}for(name135 in source.uints){material.setUInt(name135,source.uints[name135]);}for(name135 in source.floats){material.setFloat(name135,source.floats[name135]);}for(name135 in source.floatsArrays){material.setFloats(name135,source.floatsArrays[name135]);}for(name135 in source.colors3){material.setColor3(name135,Color3.FromArray(source.colors3[name135]));}for(name135 in source.colors3Arrays){var colors=source.colors3Arrays[name135].reduce(function(arr,num,i){if(i%3===0){arr.push([num]);}else{arr[arr.length-1].push(num);}return arr;},[]).map(function(color){return Color3.FromArray(color);});material.setColor3Array(name135,colors);}for(name135 in source.colors4){material.setColor4(name135,Color4.FromArray(source.colors4[name135]));}for(name135 in source.colors4Arrays){var _colors=source.colors4Arrays[name135].reduce(function(arr,num,i){if(i%4===0){arr.push([num]);}else{arr[arr.length-1].push(num);}return arr;},[]).map(function(color){return Color4.FromArray(color);});material.setColor4Array(name135,_colors);}for(name135 in source.vectors2){material.setVector2(name135,Vector2.FromArray(source.vectors2[name135]));}for(name135 in source.vectors3){material.setVector3(name135,Vector3.FromArray(source.vectors3[name135]));}for(name135 in source.vectors4){material.setVector4(name135,Vector4.FromArray(source.vectors4[name135]));}for(name135 in source.quaternions){material.setQuaternion(name135,Quaternion.FromArray(source.quaternions[name135]));}for(name135 in source.matrices){material.setMatrix(name135,Matrix.FromArray(source.matrices[name135]));}for(name135 in source.matrixArray){material._matrixArrays[name135]=new Float32Array(source.matrixArray[name135]);}for(name135 in source.matrices3x3){material.setMatrix3x3(name135,source.matrices3x3[name135]);}for(name135 in source.matrices2x2){material.setMatrix2x2(name135,source.matrices2x2[name135]);}for(name135 in source.vectors2Arrays){material.setArray2(name135,source.vectors2Arrays[name135]);}for(name135 in source.vectors3Arrays){material.setArray3(name135,source.vectors3Arrays[name135]);}for(name135 in source.vectors4Arrays){material.setArray4(name135,source.vectors4Arrays[name135]);}for(name135 in source.quaternionsArrays){material.setArray4(name135,source.quaternionsArrays[name135]);}return material;}},{key:"ParseFromFileAsync",value:function ParseFromFileAsync(name135,url,scene2){var _this143=this;var rootUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";return new Promise(function(resolve,reject){var request=new WebRequest();request.addEventListener("readystatechange",function(){if(request.readyState==4){if(request.status==200){var serializationObject=JSON.parse(request.responseText);var output=_this143.Parse(serializationObject,scene2||EngineStore.LastCreatedScene,rootUrl);if(name135){output.name=name135;}resolve(output);}else{reject("Unable to load the ShaderMaterial");}}});request.open("GET",url);request.send();});}},{key:"ParseFromSnippetAsync",value:function ParseFromSnippetAsync(snippetId,scene2){var _this144=this;var rootUrl=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";return new Promise(function(resolve,reject){var request=new WebRequest();request.addEventListener("readystatechange",function(){if(request.readyState==4){if(request.status==200){var snippet=JSON.parse(JSON.parse(request.responseText).jsonPayload);var serializationObject=JSON.parse(snippet.shaderMaterial);var output=_this144.Parse(serializationObject,scene2||EngineStore.LastCreatedScene,rootUrl);output.snippetId=snippetId;resolve(output);}else{reject("Unable to load the snippet "+snippetId);}}});request.open("GET",_this144.SnippetUrl+"/"+snippetId.replace(/#/g,"/"));request.send();});}}]);return ShaderMaterial;}(PushMaterial);ShaderMaterial.SnippetUrl="https://snippet.babylonjs.com";ShaderMaterial.CreateFromSnippetAsync=ShaderMaterial.ParseFromSnippetAsync;RegisterClass("BABYLON.ShaderMaterial",ShaderMaterial);// node_modules/@babylonjs/core/Lights/hemisphericLight.js
Node.AddNodeConstructor("Light_Type_3",function(name135,scene2){return function(){return new HemisphericLight(name135,Vector3.Zero(),scene2);};});var HemisphericLight=/*#__PURE__*/function(_Light){_inherits(HemisphericLight,_Light);var _super44=_createSuper(HemisphericLight);function HemisphericLight(name135,direction,scene2){var _this145;_classCallCheck(this,HemisphericLight);_this145=_super44.call(this,name135,scene2);_this145.groundColor=new Color3(0,0,0);_this145.direction=direction||Vector3.Up();return _this145;}_createClass(HemisphericLight,[{key:"_buildUniformLayout",value:function _buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4);this._uniformBuffer.addUniform("vLightDiffuse",4);this._uniformBuffer.addUniform("vLightSpecular",4);this._uniformBuffer.addUniform("vLightGround",3);this._uniformBuffer.addUniform("shadowsInfo",3);this._uniformBuffer.addUniform("depthValues",2);this._uniformBuffer.create();}},{key:"getClassName",value:function getClassName(){return"HemisphericLight";}},{key:"setDirectionToTarget",value:function setDirectionToTarget(target){this.direction=Vector3.Normalize(target.subtract(Vector3.Zero()));return this.direction;}},{key:"getShadowGenerator",value:function getShadowGenerator(){return null;}},{key:"transferToEffect",value:function transferToEffect(_effect,lightIndex){var normalizeDirection=Vector3.Normalize(this.direction);this._uniformBuffer.updateFloat4("vLightData",normalizeDirection.x,normalizeDirection.y,normalizeDirection.z,0,lightIndex);this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),lightIndex);return this;}},{key:"transferToNodeMaterialEffect",value:function transferToNodeMaterialEffect(effect,lightDataUniformName){var normalizeDirection=Vector3.Normalize(this.direction);effect.setFloat3(lightDataUniformName,normalizeDirection.x,normalizeDirection.y,normalizeDirection.z);return this;}},{key:"computeWorldMatrix",value:function computeWorldMatrix(){if(!this._worldMatrix){this._worldMatrix=Matrix.Identity();}return this._worldMatrix;}},{key:"getTypeID",value:function getTypeID(){return Light.LIGHTTYPEID_HEMISPHERICLIGHT;}},{key:"prepareLightSpecificDefines",value:function prepareLightSpecificDefines(defines,lightIndex){defines["HEMILIGHT"+lightIndex]=true;}}]);return HemisphericLight;}(Light);__decorate([serializeAsColor3()],HemisphericLight.prototype,"groundColor",void 0);__decorate([serializeAsVector3()],HemisphericLight.prototype,"direction",void 0);// node_modules/@babylonjs/core/Lights/shadowLight.js
var ShadowLight=/*#__PURE__*/function(_Light2){_inherits(ShadowLight,_Light2);var _super45=_createSuper(ShadowLight);function ShadowLight(){var _this146;_classCallCheck(this,ShadowLight);_this146=_super45.apply(this,arguments);_this146._needProjectionMatrixCompute=true;return _this146;}_createClass(ShadowLight,[{key:"_setPosition",value:function _setPosition(value){this._position=value;}},{key:"position",get:function get(){return this._position;},set:function set(value){this._setPosition(value);}},{key:"_setDirection",value:function _setDirection(value){this._direction=value;}},{key:"direction",get:function get(){return this._direction;},set:function set(value){this._setDirection(value);}},{key:"shadowMinZ",get:function get(){return this._shadowMinZ;},set:function set(value){this._shadowMinZ=value;this.forceProjectionMatrixCompute();}},{key:"shadowMaxZ",get:function get(){return this._shadowMaxZ;},set:function set(value){this._shadowMaxZ=value;this.forceProjectionMatrixCompute();}},{key:"computeTransformedInformation",value:function computeTransformedInformation(){if(this.parent&&this.parent.getWorldMatrix){if(!this.transformedPosition){this.transformedPosition=Vector3.Zero();}Vector3.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition);if(this.direction){if(!this.transformedDirection){this.transformedDirection=Vector3.Zero();}Vector3.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection);}return true;}return false;}},{key:"getDepthScale",value:function getDepthScale(){return 50;}},{key:"getShadowDirection",value:function getShadowDirection(faceIndex){return this.transformedDirection?this.transformedDirection:this.direction;}},{key:"getAbsolutePosition",value:function getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position;}},{key:"setDirectionToTarget",value:function setDirectionToTarget(target){this.direction=Vector3.Normalize(target.subtract(this.position));return this.direction;}},{key:"getRotation",value:function getRotation(){this.direction.normalize();var xaxis=Vector3.Cross(this.direction,Axis.Y);var yaxis=Vector3.Cross(xaxis,this.direction);return Vector3.RotationFromAxis(xaxis,yaxis,this.direction);}},{key:"needCube",value:function needCube(){return false;}},{key:"needProjectionMatrixCompute",value:function needProjectionMatrixCompute(){return this._needProjectionMatrixCompute;}},{key:"forceProjectionMatrixCompute",value:function forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=true;}},{key:"_initCache",value:function _initCache(){_get(_getPrototypeOf(ShadowLight.prototype),"_initCache",this).call(this);this._cache.position=Vector3.Zero();}},{key:"_isSynchronized",value:function _isSynchronized(){if(!this._cache.position.equals(this.position)){return false;}return true;}},{key:"computeWorldMatrix",value:function computeWorldMatrix(force){if(!force&&this.isSynchronized()){this._currentRenderId=this.getScene().getRenderId();return this._worldMatrix;}this._updateCache();this._cache.position.copyFrom(this.position);if(!this._worldMatrix){this._worldMatrix=Matrix.Identity();}Matrix.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix);if(this.parent&&this.parent.getWorldMatrix){this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent();}this._worldMatrixDeterminantIsDirty=true;return this._worldMatrix;}},{key:"getDepthMinZ",value:function getDepthMinZ(activeCamera){return this.shadowMinZ!==void 0?this.shadowMinZ:activeCamera.minZ;}},{key:"getDepthMaxZ",value:function getDepthMaxZ(activeCamera){return this.shadowMaxZ!==void 0?this.shadowMaxZ:activeCamera.maxZ;}},{key:"setShadowProjectionMatrix",value:function setShadowProjectionMatrix(matrix,viewMatrix,renderList){if(this.customProjectionMatrixBuilder){this.customProjectionMatrixBuilder(viewMatrix,renderList,matrix);}else{this._setDefaultShadowProjectionMatrix(matrix,viewMatrix,renderList);}return this;}},{key:"_syncParentEnabledState",value:function _syncParentEnabledState(){_get(_getPrototypeOf(ShadowLight.prototype),"_syncParentEnabledState",this).call(this);if(!this.parent||!this.parent.getWorldMatrix){this.transformedPosition=null;this.transformedDirection=null;}}}]);return ShadowLight;}(Light);__decorate([serializeAsVector3()],ShadowLight.prototype,"position",null);__decorate([serializeAsVector3()],ShadowLight.prototype,"direction",null);__decorate([serialize()],ShadowLight.prototype,"shadowMinZ",null);__decorate([serialize()],ShadowLight.prototype,"shadowMaxZ",null);// node_modules/@babylonjs/core/Lights/directionalLight.js
Node.AddNodeConstructor("Light_Type_1",function(name135,scene2){return function(){return new DirectionalLight(name135,Vector3.Zero(),scene2);};});var DirectionalLight=/*#__PURE__*/function(_ShadowLight){_inherits(DirectionalLight,_ShadowLight);var _super46=_createSuper(DirectionalLight);function DirectionalLight(name135,direction,scene2){var _this147;_classCallCheck(this,DirectionalLight);_this147=_super46.call(this,name135,scene2);_this147._shadowFrustumSize=0;_this147._shadowOrthoScale=0.1;_this147.autoUpdateExtends=true;_this147.autoCalcShadowZBounds=false;_this147._orthoLeft=Number.MAX_VALUE;_this147._orthoRight=Number.MIN_VALUE;_this147._orthoTop=Number.MIN_VALUE;_this147._orthoBottom=Number.MAX_VALUE;_this147.position=direction.scale(-1);_this147.direction=direction;return _this147;}_createClass(DirectionalLight,[{key:"shadowFrustumSize",get:function get(){return this._shadowFrustumSize;},set:function set(value){this._shadowFrustumSize=value;this.forceProjectionMatrixCompute();}},{key:"shadowOrthoScale",get:function get(){return this._shadowOrthoScale;},set:function set(value){this._shadowOrthoScale=value;this.forceProjectionMatrixCompute();}},{key:"orthoLeft",get:function get(){return this._orthoLeft;},set:function set(left){this._orthoLeft=left;}},{key:"orthoRight",get:function get(){return this._orthoRight;},set:function set(right){this._orthoRight=right;}},{key:"orthoTop",get:function get(){return this._orthoTop;},set:function set(top){this._orthoTop=top;}},{key:"orthoBottom",get:function get(){return this._orthoBottom;},set:function set(bottom){this._orthoBottom=bottom;}},{key:"getClassName",value:function getClassName(){return"DirectionalLight";}},{key:"getTypeID",value:function getTypeID(){return Light.LIGHTTYPEID_DIRECTIONALLIGHT;}},{key:"_setDefaultShadowProjectionMatrix",value:function _setDefaultShadowProjectionMatrix(matrix,viewMatrix,renderList){if(this.shadowFrustumSize>0){this._setDefaultFixedFrustumShadowProjectionMatrix(matrix);}else{this._setDefaultAutoExtendShadowProjectionMatrix(matrix,viewMatrix,renderList);}}},{key:"_setDefaultFixedFrustumShadowProjectionMatrix",value:function _setDefaultFixedFrustumShadowProjectionMatrix(matrix){var activeCamera=this.getScene().activeCamera;if(!activeCamera){return;}Matrix.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,this.shadowMinZ!==void 0?this.shadowMinZ:activeCamera.minZ,this.shadowMaxZ!==void 0?this.shadowMaxZ:activeCamera.maxZ,matrix,this.getScene().getEngine().isNDCHalfZRange);}},{key:"_setDefaultAutoExtendShadowProjectionMatrix",value:function _setDefaultAutoExtendShadowProjectionMatrix(matrix,viewMatrix,renderList){var activeCamera=this.getScene().activeCamera;if(!activeCamera){return;}if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){var tempVector3=Vector3.Zero();this._orthoLeft=Number.MAX_VALUE;this._orthoRight=Number.MIN_VALUE;this._orthoTop=Number.MIN_VALUE;this._orthoBottom=Number.MAX_VALUE;var shadowMinZ=Number.MAX_VALUE;var shadowMaxZ=Number.MIN_VALUE;for(var meshIndex=0;meshIndex<renderList.length;meshIndex++){var mesh=renderList[meshIndex];if(!mesh){continue;}var boundingInfo=mesh.getBoundingInfo();var boundingBox=boundingInfo.boundingBox;for(var index=0;index<boundingBox.vectorsWorld.length;index++){Vector3.TransformCoordinatesToRef(boundingBox.vectorsWorld[index],viewMatrix,tempVector3);if(tempVector3.x<this._orthoLeft){this._orthoLeft=tempVector3.x;}if(tempVector3.y<this._orthoBottom){this._orthoBottom=tempVector3.y;}if(tempVector3.x>this._orthoRight){this._orthoRight=tempVector3.x;}if(tempVector3.y>this._orthoTop){this._orthoTop=tempVector3.y;}if(this.autoCalcShadowZBounds){if(tempVector3.z<shadowMinZ){shadowMinZ=tempVector3.z;}if(tempVector3.z>shadowMaxZ){shadowMaxZ=tempVector3.z;}}}}if(this.autoCalcShadowZBounds){this._shadowMinZ=shadowMinZ;this._shadowMaxZ=shadowMaxZ;}}var xOffset=this._orthoRight-this._orthoLeft;var yOffset=this._orthoTop-this._orthoBottom;var minZ=this.shadowMinZ!==void 0?this.shadowMinZ:activeCamera.minZ;var maxZ=this.shadowMaxZ!==void 0?this.shadowMaxZ:activeCamera.maxZ;var useReverseDepthBuffer=this.getScene().getEngine().useReverseDepthBuffer;Matrix.OrthoOffCenterLHToRef(this._orthoLeft-xOffset*this.shadowOrthoScale,this._orthoRight+xOffset*this.shadowOrthoScale,this._orthoBottom-yOffset*this.shadowOrthoScale,this._orthoTop+yOffset*this.shadowOrthoScale,useReverseDepthBuffer?maxZ:minZ,useReverseDepthBuffer?minZ:maxZ,matrix,this.getScene().getEngine().isNDCHalfZRange);}},{key:"_buildUniformLayout",value:function _buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4);this._uniformBuffer.addUniform("vLightDiffuse",4);this._uniformBuffer.addUniform("vLightSpecular",4);this._uniformBuffer.addUniform("shadowsInfo",3);this._uniformBuffer.addUniform("depthValues",2);this._uniformBuffer.create();}},{key:"transferToEffect",value:function transferToEffect(effect,lightIndex){if(this.computeTransformedInformation()){this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,lightIndex);return this;}this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,lightIndex);return this;}},{key:"transferToNodeMaterialEffect",value:function transferToNodeMaterialEffect(effect,lightDataUniformName){if(this.computeTransformedInformation()){effect.setFloat3(lightDataUniformName,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z);return this;}effect.setFloat3(lightDataUniformName,this.direction.x,this.direction.y,this.direction.z);return this;}},{key:"getDepthMinZ",value:function getDepthMinZ(activeCamera){var engine=this._scene.getEngine();return!engine.useReverseDepthBuffer&&engine.isNDCHalfZRange?0:1;}},{key:"getDepthMaxZ",value:function getDepthMaxZ(activeCamera){var engine=this._scene.getEngine();return engine.useReverseDepthBuffer&&engine.isNDCHalfZRange?0:1;}},{key:"prepareLightSpecificDefines",value:function prepareLightSpecificDefines(defines,lightIndex){defines["DIRLIGHT"+lightIndex]=true;}}]);return DirectionalLight;}(ShadowLight);__decorate([serialize()],DirectionalLight.prototype,"shadowFrustumSize",null);__decorate([serialize()],DirectionalLight.prototype,"shadowOrthoScale",null);__decorate([serialize()],DirectionalLight.prototype,"autoUpdateExtends",void 0);__decorate([serialize()],DirectionalLight.prototype,"autoCalcShadowZBounds",void 0);__decorate([serialize("orthoLeft")],DirectionalLight.prototype,"_orthoLeft",void 0);__decorate([serialize("orthoRight")],DirectionalLight.prototype,"_orthoRight",void 0);__decorate([serialize("orthoTop")],DirectionalLight.prototype,"_orthoTop",void 0);__decorate([serialize("orthoBottom")],DirectionalLight.prototype,"_orthoBottom",void 0);// node_modules/@babylonjs/core/Lights/pointLight.js
Node.AddNodeConstructor("Light_Type_0",function(name135,scene2){return function(){return new PointLight(name135,Vector3.Zero(),scene2);};});var PointLight=/*#__PURE__*/function(_ShadowLight2){_inherits(PointLight,_ShadowLight2);var _super47=_createSuper(PointLight);function PointLight(name135,position,scene2){var _this148;_classCallCheck(this,PointLight);_this148=_super47.call(this,name135,scene2);_this148._shadowAngle=Math.PI/2;_this148.position=position;return _this148;}_createClass(PointLight,[{key:"shadowAngle",get:function get(){return this._shadowAngle;},set:function set(value){this._shadowAngle=value;this.forceProjectionMatrixCompute();}},{key:"direction",get:function get(){return this._direction;},set:function set(value){var previousNeedCube=this.needCube();this._direction=value;if(this.needCube()!==previousNeedCube&&this._shadowGenerators){var iterator=this._shadowGenerators.values();for(var key=iterator.next();key.done!==true;key=iterator.next()){var shadowGenerator=key.value;shadowGenerator.recreateShadowMap();}}}},{key:"getClassName",value:function getClassName(){return"PointLight";}},{key:"getTypeID",value:function getTypeID(){return Light.LIGHTTYPEID_POINTLIGHT;}},{key:"needCube",value:function needCube(){return!this.direction;}},{key:"getShadowDirection",value:function getShadowDirection(faceIndex){if(this.direction){return _get(_getPrototypeOf(PointLight.prototype),"getShadowDirection",this).call(this,faceIndex);}else{switch(faceIndex){case 0:return new Vector3(1,0,0);case 1:return new Vector3(-1,0,0);case 2:return new Vector3(0,-1,0);case 3:return new Vector3(0,1,0);case 4:return new Vector3(0,0,1);case 5:return new Vector3(0,0,-1);}}return Vector3.Zero();}},{key:"_setDefaultShadowProjectionMatrix",value:function _setDefaultShadowProjectionMatrix(matrix,viewMatrix,renderList){var activeCamera=this.getScene().activeCamera;if(!activeCamera){return;}var minZ=this.shadowMinZ!==void 0?this.shadowMinZ:activeCamera.minZ;var maxZ=this.shadowMaxZ!==void 0?this.shadowMaxZ:activeCamera.maxZ;var useReverseDepthBuffer=this.getScene().getEngine().useReverseDepthBuffer;Matrix.PerspectiveFovLHToRef(this.shadowAngle,1,useReverseDepthBuffer?maxZ:minZ,useReverseDepthBuffer?minZ:maxZ,matrix,true,this._scene.getEngine().isNDCHalfZRange,void 0,useReverseDepthBuffer);}},{key:"_buildUniformLayout",value:function _buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4);this._uniformBuffer.addUniform("vLightDiffuse",4);this._uniformBuffer.addUniform("vLightSpecular",4);this._uniformBuffer.addUniform("vLightFalloff",4);this._uniformBuffer.addUniform("shadowsInfo",3);this._uniformBuffer.addUniform("depthValues",2);this._uniformBuffer.create();}},{key:"transferToEffect",value:function transferToEffect(effect,lightIndex){if(this.computeTransformedInformation()){this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,lightIndex);}else{this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,lightIndex);}this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,lightIndex);return this;}},{key:"transferToNodeMaterialEffect",value:function transferToNodeMaterialEffect(effect,lightDataUniformName){if(this.computeTransformedInformation()){effect.setFloat3(lightDataUniformName,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z);}else{effect.setFloat3(lightDataUniformName,this.position.x,this.position.y,this.position.z);}return this;}},{key:"prepareLightSpecificDefines",value:function prepareLightSpecificDefines(defines,lightIndex){defines["POINTLIGHT"+lightIndex]=true;}}]);return PointLight;}(ShadowLight);__decorate([serialize()],PointLight.prototype,"shadowAngle",null);// node_modules/@babylonjs/core/Lights/spotLight.js
Node.AddNodeConstructor("Light_Type_2",function(name135,scene2){return function(){return new SpotLight(name135,Vector3.Zero(),Vector3.Zero(),0,0,scene2);};});var SpotLight=/*#__PURE__*/function(_ShadowLight3){_inherits(SpotLight,_ShadowLight3);var _super48=_createSuper(SpotLight);function SpotLight(name135,position,direction,angle,exponent,scene2){var _this149;_classCallCheck(this,SpotLight);_this149=_super48.call(this,name135,scene2);_this149._innerAngle=0;_this149._projectionTextureMatrix=Matrix.Zero();_this149._projectionTextureLightNear=1e-6;_this149._projectionTextureLightFar=1e3;_this149._projectionTextureUpDirection=Vector3.Up();_this149._projectionTextureViewLightDirty=true;_this149._projectionTextureProjectionLightDirty=true;_this149._projectionTextureDirty=true;_this149._projectionTextureViewTargetVector=Vector3.Zero();_this149._projectionTextureViewLightMatrix=Matrix.Zero();_this149._projectionTextureProjectionLightMatrix=Matrix.Zero();_this149._projectionTextureScalingMatrix=Matrix.FromValues(0.5,0,0,0,0,0.5,0,0,0,0,0.5,0,0.5,0.5,0.5,1);_this149.position=position;_this149.direction=direction;_this149.angle=angle;_this149.exponent=exponent;return _this149;}_createClass(SpotLight,[{key:"angle",get:function get(){return this._angle;},set:function set(value){this._angle=value;this._cosHalfAngle=Math.cos(value*0.5);this._projectionTextureProjectionLightDirty=true;this.forceProjectionMatrixCompute();this._computeAngleValues();}},{key:"innerAngle",get:function get(){return this._innerAngle;},set:function set(value){this._innerAngle=value;this._computeAngleValues();}},{key:"shadowAngleScale",get:function get(){return this._shadowAngleScale;},set:function set(value){this._shadowAngleScale=value;this.forceProjectionMatrixCompute();}},{key:"projectionTextureMatrix",get:function get(){return this._projectionTextureMatrix;}},{key:"projectionTextureLightNear",get:function get(){return this._projectionTextureLightNear;},set:function set(value){this._projectionTextureLightNear=value;this._projectionTextureProjectionLightDirty=true;}},{key:"projectionTextureLightFar",get:function get(){return this._projectionTextureLightFar;},set:function set(value){this._projectionTextureLightFar=value;this._projectionTextureProjectionLightDirty=true;}},{key:"projectionTextureUpDirection",get:function get(){return this._projectionTextureUpDirection;},set:function set(value){this._projectionTextureUpDirection=value;this._projectionTextureProjectionLightDirty=true;}},{key:"projectionTexture",get:function get(){return this._projectionTexture;},set:function set(value){var _this150=this;if(this._projectionTexture===value){return;}this._projectionTexture=value;this._projectionTextureDirty=true;if(this._projectionTexture&&!this._projectionTexture.isReady()){if(SpotLight._IsProceduralTexture(this._projectionTexture)){this._projectionTexture.getEffect().executeWhenCompiled(function(){_this150._markMeshesAsLightDirty();});}else if(SpotLight._IsTexture(this._projectionTexture)){this._projectionTexture.onLoadObservable.addOnce(function(){_this150._markMeshesAsLightDirty();});}}}},{key:"projectionTextureProjectionLightMatrix",get:function get(){return this._projectionTextureProjectionLightMatrix;},set:function set(projection){this._projectionTextureProjectionLightMatrix=projection;this._projectionTextureProjectionLightDirty=false;this._projectionTextureDirty=true;}},{key:"getClassName",value:function getClassName(){return"SpotLight";}},{key:"getTypeID",value:function getTypeID(){return Light.LIGHTTYPEID_SPOTLIGHT;}},{key:"_setDirection",value:function _setDirection(value){_get(_getPrototypeOf(SpotLight.prototype),"_setDirection",this).call(this,value);this._projectionTextureViewLightDirty=true;}},{key:"_setPosition",value:function _setPosition(value){_get(_getPrototypeOf(SpotLight.prototype),"_setPosition",this).call(this,value);this._projectionTextureViewLightDirty=true;}},{key:"_setDefaultShadowProjectionMatrix",value:function _setDefaultShadowProjectionMatrix(matrix,viewMatrix,renderList){var activeCamera=this.getScene().activeCamera;if(!activeCamera){return;}this._shadowAngleScale=this._shadowAngleScale||1;var angle=this._shadowAngleScale*this._angle;var minZ=this.shadowMinZ!==void 0?this.shadowMinZ:activeCamera.minZ;var maxZ=this.shadowMaxZ!==void 0?this.shadowMaxZ:activeCamera.maxZ;var useReverseDepthBuffer=this.getScene().getEngine().useReverseDepthBuffer;Matrix.PerspectiveFovLHToRef(angle,1,useReverseDepthBuffer?maxZ:minZ,useReverseDepthBuffer?minZ:maxZ,matrix,true,this._scene.getEngine().isNDCHalfZRange,void 0,useReverseDepthBuffer);}},{key:"_computeProjectionTextureViewLightMatrix",value:function _computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=false;this._projectionTextureDirty=true;this.position.addToRef(this.direction,this._projectionTextureViewTargetVector);Matrix.LookAtLHToRef(this.position,this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix);}},{key:"_computeProjectionTextureProjectionLightMatrix",value:function _computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=false;this._projectionTextureDirty=true;var lightFar=this.projectionTextureLightFar;var lightNear=this.projectionTextureLightNear;var P=lightFar/(lightFar-lightNear);var Q=-P*lightNear;var S=1/Math.tan(this._angle/2);var A=1;Matrix.FromValuesToRef(S/A,0,0,0,0,S,0,0,0,0,P,1,0,0,Q,0,this._projectionTextureProjectionLightMatrix);}},{key:"_computeProjectionTextureMatrix",value:function _computeProjectionTextureMatrix(){this._projectionTextureDirty=false;this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix);if(this._projectionTexture instanceof Texture){var u=this._projectionTexture.uScale/2;var v=this._projectionTexture.vScale/2;Matrix.FromValuesToRef(u,0,0,0,0,v,0,0,0,0,0.5,0,0.5,0.5,0.5,1,this._projectionTextureScalingMatrix);}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix);}},{key:"_buildUniformLayout",value:function _buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4);this._uniformBuffer.addUniform("vLightDiffuse",4);this._uniformBuffer.addUniform("vLightSpecular",4);this._uniformBuffer.addUniform("vLightDirection",3);this._uniformBuffer.addUniform("vLightFalloff",4);this._uniformBuffer.addUniform("shadowsInfo",3);this._uniformBuffer.addUniform("depthValues",2);this._uniformBuffer.create();}},{key:"_computeAngleValues",value:function _computeAngleValues(){this._lightAngleScale=1/Math.max(1e-3,Math.cos(this._innerAngle*0.5)-this._cosHalfAngle);this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale;}},{key:"transferTexturesToEffect",value:function transferTexturesToEffect(effect,lightIndex){if(this.projectionTexture&&this.projectionTexture.isReady()){if(this._projectionTextureViewLightDirty){this._computeProjectionTextureViewLightMatrix();}if(this._projectionTextureProjectionLightDirty){this._computeProjectionTextureProjectionLightMatrix();}if(this._projectionTextureDirty){this._computeProjectionTextureMatrix();}effect.setMatrix("textureProjectionMatrix"+lightIndex,this._projectionTextureMatrix);effect.setTexture("projectionLightSampler"+lightIndex,this.projectionTexture);}return this;}},{key:"transferToEffect",value:function transferToEffect(effect,lightIndex){var normalizeDirection;if(this.computeTransformedInformation()){this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,lightIndex);normalizeDirection=Vector3.Normalize(this.transformedDirection);}else{this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,lightIndex);normalizeDirection=Vector3.Normalize(this.direction);}this._uniformBuffer.updateFloat4("vLightDirection",normalizeDirection.x,normalizeDirection.y,normalizeDirection.z,this._cosHalfAngle,lightIndex);this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,lightIndex);return this;}},{key:"transferToNodeMaterialEffect",value:function transferToNodeMaterialEffect(effect,lightDataUniformName){var normalizeDirection;if(this.computeTransformedInformation()){normalizeDirection=Vector3.Normalize(this.transformedDirection);}else{normalizeDirection=Vector3.Normalize(this.direction);}if(this.getScene().useRightHandedSystem){effect.setFloat3(lightDataUniformName,-normalizeDirection.x,-normalizeDirection.y,-normalizeDirection.z);}else{effect.setFloat3(lightDataUniformName,normalizeDirection.x,normalizeDirection.y,normalizeDirection.z);}return this;}},{key:"dispose",value:function dispose(){_get(_getPrototypeOf(SpotLight.prototype),"dispose",this).call(this);if(this._projectionTexture){this._projectionTexture.dispose();}}},{key:"getDepthMinZ",value:function getDepthMinZ(activeCamera){var engine=this._scene.getEngine();var minZ=this.shadowMinZ!==void 0?this.shadowMinZ:activeCamera.minZ;return engine.useReverseDepthBuffer&&engine.isNDCHalfZRange?minZ:this._scene.getEngine().isNDCHalfZRange?0:minZ;}},{key:"getDepthMaxZ",value:function getDepthMaxZ(activeCamera){var engine=this._scene.getEngine();var maxZ=this.shadowMaxZ!==void 0?this.shadowMaxZ:activeCamera.maxZ;return engine.useReverseDepthBuffer&&engine.isNDCHalfZRange?0:maxZ;}},{key:"prepareLightSpecificDefines",value:function prepareLightSpecificDefines(defines,lightIndex){defines["SPOTLIGHT"+lightIndex]=true;defines["PROJECTEDLIGHTTEXTURE"+lightIndex]=this.projectionTexture&&this.projectionTexture.isReady()?true:false;}}],[{key:"_IsProceduralTexture",value:function _IsProceduralTexture(texture){return texture.onGeneratedObservable!==void 0;}},{key:"_IsTexture",value:function _IsTexture(texture){return texture.onLoadObservable!==void 0;}}]);return SpotLight;}(ShadowLight);__decorate([serialize()],SpotLight.prototype,"angle",null);__decorate([serialize()],SpotLight.prototype,"innerAngle",null);__decorate([serialize()],SpotLight.prototype,"shadowAngleScale",null);__decorate([serialize()],SpotLight.prototype,"exponent",void 0);__decorate([serialize()],SpotLight.prototype,"projectionTextureLightNear",null);__decorate([serialize()],SpotLight.prototype,"projectionTextureLightFar",null);__decorate([serialize()],SpotLight.prototype,"projectionTextureUpDirection",null);__decorate([serializeAsTexture("projectedLightTexture")],SpotLight.prototype,"_projectionTexture",void 0);// node_modules/@babylonjs/loaders/glTF/1.0/glTFLoaderUtils.js
var GLTFUtils=/*#__PURE__*/function(){function GLTFUtils(){_classCallCheck(this,GLTFUtils);}_createClass(GLTFUtils,null,[{key:"SetMatrix",value:function SetMatrix(scene2,source,parameter,uniformName,shaderMaterial){var mat=null;if(parameter.semantic==="MODEL"){mat=source.getWorldMatrix();}else if(parameter.semantic==="PROJECTION"){mat=scene2.getProjectionMatrix();}else if(parameter.semantic==="VIEW"){mat=scene2.getViewMatrix();}else if(parameter.semantic==="MODELVIEWINVERSETRANSPOSE"){mat=Matrix.Transpose(source.getWorldMatrix().multiply(scene2.getViewMatrix()).invert());}else if(parameter.semantic==="MODELVIEW"){mat=source.getWorldMatrix().multiply(scene2.getViewMatrix());}else if(parameter.semantic==="MODELVIEWPROJECTION"){mat=source.getWorldMatrix().multiply(scene2.getTransformMatrix());}else if(parameter.semantic==="MODELINVERSE"){mat=source.getWorldMatrix().invert();}else if(parameter.semantic==="VIEWINVERSE"){mat=scene2.getViewMatrix().invert();}else if(parameter.semantic==="PROJECTIONINVERSE"){mat=scene2.getProjectionMatrix().invert();}else if(parameter.semantic==="MODELVIEWINVERSE"){mat=source.getWorldMatrix().multiply(scene2.getViewMatrix()).invert();}else if(parameter.semantic==="MODELVIEWPROJECTIONINVERSE"){mat=source.getWorldMatrix().multiply(scene2.getTransformMatrix()).invert();}else if(parameter.semantic==="MODELINVERSETRANSPOSE"){mat=Matrix.Transpose(source.getWorldMatrix().invert());}if(mat){switch(parameter.type){case EParameterType.FLOAT_MAT2:shaderMaterial.setMatrix2x2(uniformName,Matrix.GetAsMatrix2x2(mat));break;case EParameterType.FLOAT_MAT3:shaderMaterial.setMatrix3x3(uniformName,Matrix.GetAsMatrix3x3(mat));break;case EParameterType.FLOAT_MAT4:shaderMaterial.setMatrix(uniformName,mat);break;default:break;}}}},{key:"SetUniform",value:function SetUniform(shaderMaterial,uniform,value,type){switch(type){case EParameterType.FLOAT:shaderMaterial.setFloat(uniform,value);return true;case EParameterType.FLOAT_VEC2:shaderMaterial.setVector2(uniform,Vector2.FromArray(value));return true;case EParameterType.FLOAT_VEC3:shaderMaterial.setVector3(uniform,Vector3.FromArray(value));return true;case EParameterType.FLOAT_VEC4:shaderMaterial.setVector4(uniform,Vector4.FromArray(value));return true;default:return false;}}},{key:"GetWrapMode",value:function GetWrapMode(mode){switch(mode){case ETextureWrapMode.CLAMP_TO_EDGE:return Texture.CLAMP_ADDRESSMODE;case ETextureWrapMode.MIRRORED_REPEAT:return Texture.MIRROR_ADDRESSMODE;case ETextureWrapMode.REPEAT:return Texture.WRAP_ADDRESSMODE;default:return Texture.WRAP_ADDRESSMODE;}}},{key:"GetByteStrideFromType",value:function GetByteStrideFromType(accessor){var type=accessor.type;switch(type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1;}}},{key:"GetTextureFilterMode",value:function GetTextureFilterMode(mode){switch(mode){case ETextureFilterType.LINEAR:case ETextureFilterType.LINEAR_MIPMAP_NEAREST:case ETextureFilterType.LINEAR_MIPMAP_LINEAR:return Texture.TRILINEAR_SAMPLINGMODE;case ETextureFilterType.NEAREST:case ETextureFilterType.NEAREST_MIPMAP_NEAREST:return Texture.NEAREST_SAMPLINGMODE;default:return Texture.BILINEAR_SAMPLINGMODE;}}},{key:"GetBufferFromBufferView",value:function GetBufferFromBufferView(gltfRuntime,bufferView,byteOffset,byteLength,componentType){byteOffset=bufferView.byteOffset+byteOffset;var loadedBufferView=gltfRuntime.loadedBufferViews[bufferView.buffer];if(byteOffset+byteLength>loadedBufferView.byteLength){throw new Error("Buffer access is out of range");}var buffer=loadedBufferView.buffer;byteOffset+=loadedBufferView.byteOffset;switch(componentType){case EComponentType.BYTE:return new Int8Array(buffer,byteOffset,byteLength);case EComponentType.UNSIGNED_BYTE:return new Uint8Array(buffer,byteOffset,byteLength);case EComponentType.SHORT:return new Int16Array(buffer,byteOffset,byteLength);case EComponentType.UNSIGNED_SHORT:return new Uint16Array(buffer,byteOffset,byteLength);default:return new Float32Array(buffer,byteOffset,byteLength);}}},{key:"GetBufferFromAccessor",value:function GetBufferFromAccessor(gltfRuntime,accessor){var bufferView=gltfRuntime.bufferViews[accessor.bufferView];var byteLength=accessor.count*GLTFUtils.GetByteStrideFromType(accessor);return GLTFUtils.GetBufferFromBufferView(gltfRuntime,bufferView,accessor.byteOffset,byteLength,accessor.componentType);}},{key:"DecodeBufferToText",value:function DecodeBufferToText(view){var result="";var length=view.byteLength;for(var i=0;i<length;++i){result+=String.fromCharCode(view[i]);}return result;}},{key:"GetDefaultMaterial",value:function GetDefaultMaterial(scene2){if(!GLTFUtils._DefaultMaterial){Effect.ShadersStore["GLTFDefaultMaterialVertexShader"]=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join("\n");Effect.ShadersStore["GLTFDefaultMaterialPixelShader"]=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join("\n");var shaderPath={vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"};var options={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array(),needAlphaBlending:false};GLTFUtils._DefaultMaterial=new ShaderMaterial("GLTFDefaultMaterial",scene2,shaderPath,options);GLTFUtils._DefaultMaterial.setColor4("u_emission",new Color4(0.5,0.5,0.5,1));}return GLTFUtils._DefaultMaterial;}}]);return GLTFUtils;}();GLTFUtils._DefaultMaterial=null;// node_modules/@babylonjs/core/Engines/constants.js
var Constants=/*#__PURE__*/_createClass(function Constants(){_classCallCheck(this,Constants);});Constants.ALPHA_DISABLE=0;Constants.ALPHA_ADD=1;Constants.ALPHA_COMBINE=2;Constants.ALPHA_SUBTRACT=3;Constants.ALPHA_MULTIPLY=4;Constants.ALPHA_MAXIMIZED=5;Constants.ALPHA_ONEONE=6;Constants.ALPHA_PREMULTIPLIED=7;Constants.ALPHA_PREMULTIPLIED_PORTERDUFF=8;Constants.ALPHA_INTERPOLATE=9;Constants.ALPHA_SCREENMODE=10;Constants.ALPHA_ONEONE_ONEONE=11;Constants.ALPHA_ALPHATOCOLOR=12;Constants.ALPHA_REVERSEONEMINUS=13;Constants.ALPHA_SRC_DSTONEMINUSSRCALPHA=14;Constants.ALPHA_ONEONE_ONEZERO=15;Constants.ALPHA_EXCLUSION=16;Constants.ALPHA_LAYER_ACCUMULATE=17;Constants.ALPHA_EQUATION_ADD=0;Constants.ALPHA_EQUATION_SUBSTRACT=1;Constants.ALPHA_EQUATION_REVERSE_SUBTRACT=2;Constants.ALPHA_EQUATION_MAX=3;Constants.ALPHA_EQUATION_MIN=4;Constants.ALPHA_EQUATION_DARKEN=5;Constants.DELAYLOADSTATE_NONE=0;Constants.DELAYLOADSTATE_LOADED=1;Constants.DELAYLOADSTATE_LOADING=2;Constants.DELAYLOADSTATE_NOTLOADED=4;Constants.NEVER=512;Constants.ALWAYS=519;Constants.LESS=513;Constants.EQUAL=514;Constants.LEQUAL=515;Constants.GREATER=516;Constants.GEQUAL=518;Constants.NOTEQUAL=517;Constants.KEEP=7680;Constants.ZERO=0;Constants.REPLACE=7681;Constants.INCR=7682;Constants.DECR=7683;Constants.INVERT=5386;Constants.INCR_WRAP=34055;Constants.DECR_WRAP=34056;Constants.TEXTURE_CLAMP_ADDRESSMODE=0;Constants.TEXTURE_WRAP_ADDRESSMODE=1;Constants.TEXTURE_MIRROR_ADDRESSMODE=2;Constants.TEXTURE_CREATIONFLAG_STORAGE=1;Constants.TEXTUREFORMAT_ALPHA=0;Constants.TEXTUREFORMAT_LUMINANCE=1;Constants.TEXTUREFORMAT_LUMINANCE_ALPHA=2;Constants.TEXTUREFORMAT_RGB=4;Constants.TEXTUREFORMAT_RGBA=5;Constants.TEXTUREFORMAT_RED=6;Constants.TEXTUREFORMAT_R=6;Constants.TEXTUREFORMAT_RG=7;Constants.TEXTUREFORMAT_RED_INTEGER=8;Constants.TEXTUREFORMAT_R_INTEGER=8;Constants.TEXTUREFORMAT_RG_INTEGER=9;Constants.TEXTUREFORMAT_RGB_INTEGER=10;Constants.TEXTUREFORMAT_RGBA_INTEGER=11;Constants.TEXTUREFORMAT_BGRA=12;Constants.TEXTUREFORMAT_DEPTH24_STENCIL8=13;Constants.TEXTUREFORMAT_DEPTH32_FLOAT=14;Constants.TEXTUREFORMAT_DEPTH16=15;Constants.TEXTUREFORMAT_DEPTH24=16;Constants.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17;Constants.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18;Constants.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492;Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493;Constants.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495;Constants.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494;Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779;Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919;Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778;Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918;Constants.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777;Constants.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776;Constants.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917;Constants.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916;Constants.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808;Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840;Constants.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196;Constants.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492;Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493;Constants.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494;Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495;Constants.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496;Constants.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497;Constants.TEXTURETYPE_UNSIGNED_BYTE=0;Constants.TEXTURETYPE_UNSIGNED_INT=0;Constants.TEXTURETYPE_FLOAT=1;Constants.TEXTURETYPE_HALF_FLOAT=2;Constants.TEXTURETYPE_BYTE=3;Constants.TEXTURETYPE_SHORT=4;Constants.TEXTURETYPE_UNSIGNED_SHORT=5;Constants.TEXTURETYPE_INT=6;Constants.TEXTURETYPE_UNSIGNED_INTEGER=7;Constants.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8;Constants.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9;Constants.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10;Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11;Constants.TEXTURETYPE_UNSIGNED_INT_24_8=12;Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13;Constants.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14;Constants.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15;Constants.TEXTURETYPE_UNDEFINED=16;Constants.TEXTURE_NEAREST_SAMPLINGMODE=1;Constants.TEXTURE_NEAREST_NEAREST=1;Constants.TEXTURE_BILINEAR_SAMPLINGMODE=2;Constants.TEXTURE_LINEAR_LINEAR=2;Constants.TEXTURE_TRILINEAR_SAMPLINGMODE=3;Constants.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3;Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4;Constants.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5;Constants.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6;Constants.TEXTURE_NEAREST_LINEAR=7;Constants.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8;Constants.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9;Constants.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10;Constants.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11;Constants.TEXTURE_LINEAR_NEAREST=12;Constants.TEXTURE_EXPLICIT_MODE=0;Constants.TEXTURE_SPHERICAL_MODE=1;Constants.TEXTURE_PLANAR_MODE=2;Constants.TEXTURE_CUBIC_MODE=3;Constants.TEXTURE_PROJECTION_MODE=4;Constants.TEXTURE_SKYBOX_MODE=5;Constants.TEXTURE_INVCUBIC_MODE=6;Constants.TEXTURE_EQUIRECTANGULAR_MODE=7;Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8;Constants.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9;Constants.TEXTURE_FILTERING_QUALITY_OFFLINE=4096;Constants.TEXTURE_FILTERING_QUALITY_HIGH=64;Constants.TEXTURE_FILTERING_QUALITY_MEDIUM=16;Constants.TEXTURE_FILTERING_QUALITY_LOW=8;Constants.SCALEMODE_FLOOR=1;Constants.SCALEMODE_NEAREST=2;Constants.SCALEMODE_CEILING=3;Constants.MATERIAL_TextureDirtyFlag=1;Constants.MATERIAL_LightDirtyFlag=2;Constants.MATERIAL_FresnelDirtyFlag=4;Constants.MATERIAL_AttributesDirtyFlag=8;Constants.MATERIAL_MiscDirtyFlag=16;Constants.MATERIAL_PrePassDirtyFlag=32;Constants.MATERIAL_AllDirtyFlag=63;Constants.MATERIAL_TriangleFillMode=0;Constants.MATERIAL_WireFrameFillMode=1;Constants.MATERIAL_PointFillMode=2;Constants.MATERIAL_PointListDrawMode=3;Constants.MATERIAL_LineListDrawMode=4;Constants.MATERIAL_LineLoopDrawMode=5;Constants.MATERIAL_LineStripDrawMode=6;Constants.MATERIAL_TriangleStripDrawMode=7;Constants.MATERIAL_TriangleFanDrawMode=8;Constants.MATERIAL_ClockWiseSideOrientation=0;Constants.MATERIAL_CounterClockWiseSideOrientation=1;Constants.ACTION_NothingTrigger=0;Constants.ACTION_OnPickTrigger=1;Constants.ACTION_OnLeftPickTrigger=2;Constants.ACTION_OnRightPickTrigger=3;Constants.ACTION_OnCenterPickTrigger=4;Constants.ACTION_OnPickDownTrigger=5;Constants.ACTION_OnDoublePickTrigger=6;Constants.ACTION_OnPickUpTrigger=7;Constants.ACTION_OnPickOutTrigger=16;Constants.ACTION_OnLongPressTrigger=8;Constants.ACTION_OnPointerOverTrigger=9;Constants.ACTION_OnPointerOutTrigger=10;Constants.ACTION_OnEveryFrameTrigger=11;Constants.ACTION_OnIntersectionEnterTrigger=12;Constants.ACTION_OnIntersectionExitTrigger=13;Constants.ACTION_OnKeyDownTrigger=14;Constants.ACTION_OnKeyUpTrigger=15;Constants.PARTICLES_BILLBOARDMODE_Y=2;Constants.PARTICLES_BILLBOARDMODE_ALL=7;Constants.PARTICLES_BILLBOARDMODE_STRETCHED=8;Constants.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9;Constants.MESHES_CULLINGSTRATEGY_STANDARD=0;Constants.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1;Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2;Constants.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3;Constants.SCENELOADER_NO_LOGGING=0;Constants.SCENELOADER_MINIMAL_LOGGING=1;Constants.SCENELOADER_SUMMARY_LOGGING=2;Constants.SCENELOADER_DETAILED_LOGGING=3;Constants.PREPASS_IRRADIANCE_TEXTURE_TYPE=0;Constants.PREPASS_POSITION_TEXTURE_TYPE=1;Constants.PREPASS_VELOCITY_TEXTURE_TYPE=2;Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3;Constants.PREPASS_COLOR_TEXTURE_TYPE=4;Constants.PREPASS_DEPTH_TEXTURE_TYPE=5;Constants.PREPASS_NORMAL_TEXTURE_TYPE=6;Constants.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7;Constants.BUFFER_CREATIONFLAG_READ=1;Constants.BUFFER_CREATIONFLAG_WRITE=2;Constants.BUFFER_CREATIONFLAG_READWRITE=3;Constants.BUFFER_CREATIONFLAG_UNIFORM=4;Constants.BUFFER_CREATIONFLAG_VERTEX=8;Constants.BUFFER_CREATIONFLAG_INDEX=16;Constants.BUFFER_CREATIONFLAG_STORAGE=32;Constants.RENDERPASS_MAIN=0;Constants.INPUT_ALT_KEY=18;Constants.INPUT_CTRL_KEY=17;Constants.INPUT_META_KEY1=91;Constants.INPUT_META_KEY2=92;Constants.INPUT_META_KEY3=93;Constants.INPUT_SHIFT_KEY=16;Constants.SNAPSHOTRENDERING_STANDARD=0;Constants.SNAPSHOTRENDERING_FAST=1;Constants.PERSPECTIVE_CAMERA=0;Constants.ORTHOGRAPHIC_CAMERA=1;Constants.FOVMODE_VERTICAL_FIXED=0;Constants.FOVMODE_HORIZONTAL_FIXED=1;Constants.RIG_MODE_NONE=0;Constants.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10;Constants.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11;Constants.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12;Constants.RIG_MODE_STEREOSCOPIC_OVERUNDER=13;Constants.RIG_MODE_STEREOSCOPIC_INTERLACED=14;Constants.RIG_MODE_VR=20;Constants.RIG_MODE_WEBVR=21;Constants.RIG_MODE_CUSTOM=22;Constants.MAX_SUPPORTED_UV_SETS=6;Constants.GL_ALPHA_EQUATION_ADD=32774;Constants.GL_ALPHA_EQUATION_MIN=32775;Constants.GL_ALPHA_EQUATION_MAX=32776;Constants.GL_ALPHA_EQUATION_SUBTRACT=32778;Constants.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779;Constants.GL_ALPHA_FUNCTION_SRC=768;Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769;Constants.GL_ALPHA_FUNCTION_SRC_ALPHA=770;Constants.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771;Constants.GL_ALPHA_FUNCTION_DST_ALPHA=772;Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773;Constants.GL_ALPHA_FUNCTION_DST_COLOR=774;Constants.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775;Constants.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776;Constants.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769;Constants.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770;Constants.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771;Constants.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772;Constants.SnippetUrl="https://snippet.babylonjs.com";// node_modules/@babylonjs/loaders/glTF/1.0/glTFLoader.js
var ETokenType;(function(ETokenType2){ETokenType2[ETokenType2["IDENTIFIER"]=1]="IDENTIFIER";ETokenType2[ETokenType2["UNKNOWN"]=2]="UNKNOWN";ETokenType2[ETokenType2["END_OF_INPUT"]=3]="END_OF_INPUT";})(ETokenType||(ETokenType={}));var Tokenizer=/*#__PURE__*/function(){function Tokenizer(toParse){_classCallCheck(this,Tokenizer);this._pos=0;this.currentToken=ETokenType.UNKNOWN;this.currentIdentifier="";this.currentString="";this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/;this._toParse=toParse;this._maxPos=toParse.length;}_createClass(Tokenizer,[{key:"getNextToken",value:function getNextToken(){if(this.isEnd()){return ETokenType.END_OF_INPUT;}this.currentString=this.read();this.currentToken=ETokenType.UNKNOWN;if(this.currentString==="_"||this.isLetterOrDigitPattern.test(this.currentString)){this.currentToken=ETokenType.IDENTIFIER;this.currentIdentifier=this.currentString;while(!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||this.currentString==="_")){this.currentIdentifier+=this.currentString;this.forward();}}return this.currentToken;}},{key:"peek",value:function peek(){return this._toParse[this._pos];}},{key:"read",value:function read(){return this._toParse[this._pos++];}},{key:"forward",value:function forward(){this._pos++;}},{key:"isEnd",value:function isEnd(){return this._pos>=this._maxPos;}}]);return Tokenizer;}();var glTFTransforms=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"];var babylonTransforms=["world","view","projection","worldView","worldViewProjection","mBones"];var glTFAnimationPaths=["translation","rotation","scale"];var babylonAnimationPaths=["position","rotationQuaternion","scaling"];var parseBuffers=function parseBuffers(parsedBuffers,gltfRuntime){for(var buf in parsedBuffers){var parsedBuffer=parsedBuffers[buf];gltfRuntime.buffers[buf]=parsedBuffer;gltfRuntime.buffersCount++;}};var parseShaders=function parseShaders(parsedShaders,gltfRuntime){for(var sha in parsedShaders){var parsedShader=parsedShaders[sha];gltfRuntime.shaders[sha]=parsedShader;gltfRuntime.shaderscount++;}};var parseObject=function parseObject(parsedObjects,runtimeProperty,gltfRuntime){for(var object in parsedObjects){var parsedObject=parsedObjects[object];gltfRuntime[runtimeProperty][object]=parsedObject;}};var normalizeUVs=function normalizeUVs(buffer){if(!buffer){return;}for(var i=0;i<buffer.length/2;i++){buffer[i*2+1]=1-buffer[i*2+1];}};var getAttribute=function getAttribute(attributeParameter){if(attributeParameter.semantic==="NORMAL"){return"normal";}else if(attributeParameter.semantic==="POSITION"){return"position";}else if(attributeParameter.semantic==="JOINT"){return"matricesIndices";}else if(attributeParameter.semantic==="WEIGHT"){return"matricesWeights";}else if(attributeParameter.semantic==="COLOR"){return"color";}else if(attributeParameter.semantic&&attributeParameter.semantic.indexOf("TEXCOORD_")!==-1){var channel=Number(attributeParameter.semantic.split("_")[1]);return"uv"+(channel===0?"":channel+1);}return null;};var loadAnimations=function loadAnimations(gltfRuntime){for(var anim in gltfRuntime.animations){var animation=gltfRuntime.animations[anim];if(!animation.channels||!animation.samplers){continue;}var lastAnimation=null;for(var i=0;i<animation.channels.length;i++){var channel=animation.channels[i];var sampler=animation.samplers[channel.sampler];if(!sampler){continue;}var inputData=null;var outputData=null;if(animation.parameters){inputData=animation.parameters[sampler.input];outputData=animation.parameters[sampler.output];}else{inputData=sampler.input;outputData=sampler.output;}var bufferInput=GLTFUtils.GetBufferFromAccessor(gltfRuntime,gltfRuntime.accessors[inputData]);var bufferOutput=GLTFUtils.GetBufferFromAccessor(gltfRuntime,gltfRuntime.accessors[outputData]);var targetId=channel.target.id;var targetNode=gltfRuntime.scene.getNodeById(targetId);if(targetNode===null){targetNode=gltfRuntime.scene.getNodeByName(targetId);}if(targetNode===null){Tools.Warn("Creating animation named "+anim+". But cannot find node named "+targetId+" to attach to");continue;}var isBone=targetNode instanceof Bone;var targetPath=channel.target.path;var targetPathIndex=glTFAnimationPaths.indexOf(targetPath);if(targetPathIndex!==-1){targetPath=babylonAnimationPaths[targetPathIndex];}var animationType=Animation.ANIMATIONTYPE_MATRIX;if(!isBone){if(targetPath==="rotationQuaternion"){animationType=Animation.ANIMATIONTYPE_QUATERNION;targetNode.rotationQuaternion=new Quaternion();}else{animationType=Animation.ANIMATIONTYPE_VECTOR3;}}var babylonAnimation=null;var keys=[];var arrayOffset=0;var modifyKey=false;if(isBone&&lastAnimation&&lastAnimation.getKeys().length===bufferInput.length){babylonAnimation=lastAnimation;modifyKey=true;}if(!modifyKey){gltfRuntime.scene._blockEntityCollection=!!gltfRuntime.assetContainer;babylonAnimation=new Animation(anim,isBone?"_matrix":targetPath,1,animationType,Animation.ANIMATIONLOOPMODE_CYCLE);gltfRuntime.scene._blockEntityCollection=false;}for(var j=0;j<bufferInput.length;j++){var value=null;if(targetPath==="rotationQuaternion"){value=Quaternion.FromArray([bufferOutput[arrayOffset],bufferOutput[arrayOffset+1],bufferOutput[arrayOffset+2],bufferOutput[arrayOffset+3]]);arrayOffset+=4;}else{value=Vector3.FromArray([bufferOutput[arrayOffset],bufferOutput[arrayOffset+1],bufferOutput[arrayOffset+2]]);arrayOffset+=3;}if(isBone){var bone=targetNode;var translation=Vector3.Zero();var rotationQuaternion=new Quaternion();var scaling=Vector3.Zero();var mat=bone.getBaseMatrix();if(modifyKey&&lastAnimation){mat=lastAnimation.getKeys()[j].value;}mat.decompose(scaling,rotationQuaternion,translation);if(targetPath==="position"){translation=value;}else if(targetPath==="rotationQuaternion"){rotationQuaternion=value;}else{scaling=value;}value=Matrix.Compose(scaling,rotationQuaternion,translation);}if(!modifyKey){keys.push({frame:bufferInput[j],value:value});}else if(lastAnimation){lastAnimation.getKeys()[j].value=value;}}if(!modifyKey&&babylonAnimation){babylonAnimation.setKeys(keys);targetNode.animations.push(babylonAnimation);}lastAnimation=babylonAnimation;gltfRuntime.scene.stopAnimation(targetNode);gltfRuntime.scene.beginAnimation(targetNode,0,bufferInput[bufferInput.length-1],true,1);}}};var configureBoneTransformation=function configureBoneTransformation(node){var mat=null;if(node.translation||node.rotation||node.scale){var scale=Vector3.FromArray(node.scale||[1,1,1]);var rotation=Quaternion.FromArray(node.rotation||[0,0,0,1]);var position=Vector3.FromArray(node.translation||[0,0,0]);mat=Matrix.Compose(scale,rotation,position);}else{mat=Matrix.FromArray(node.matrix);}return mat;};var getParentBone=function getParentBone(gltfRuntime,skins,jointName,newSkeleton){for(var i=0;i<newSkeleton.bones.length;i++){if(newSkeleton.bones[i].name===jointName){return newSkeleton.bones[i];}}var nodes=gltfRuntime.nodes;for(var nde in nodes){var node=nodes[nde];if(!node.jointName){continue;}var children=node.children;for(var _i26=0;_i26<children.length;_i26++){var child=gltfRuntime.nodes[children[_i26]];if(!child.jointName){continue;}if(child.jointName===jointName){var mat=configureBoneTransformation(node);var bone=new Bone(node.name||"",newSkeleton,getParentBone(gltfRuntime,skins,node.jointName,newSkeleton),mat);bone.id=nde;return bone;}}}return null;};var getNodeToRoot=function getNodeToRoot(nodesToRoot,id){for(var i=0;i<nodesToRoot.length;i++){var nodeToRoot=nodesToRoot[i];for(var j=0;j<nodeToRoot.node.children.length;j++){var child=nodeToRoot.node.children[j];if(child===id){return nodeToRoot.bone;}}}return null;};var getJointNode=function getJointNode(gltfRuntime,jointName){var nodes=gltfRuntime.nodes;var node=nodes[jointName];if(node){return{node:node,id:jointName};}for(var nde in nodes){node=nodes[nde];if(node.jointName===jointName){return{node:node,id:nde};}}return null;};var nodeIsInJoints=function nodeIsInJoints(skins,id){for(var i=0;i<skins.jointNames.length;i++){if(skins.jointNames[i]===id){return true;}}return false;};var getNodesToRoot=function getNodesToRoot(gltfRuntime,newSkeleton,skins,nodesToRoot){for(var nde in gltfRuntime.nodes){var node=gltfRuntime.nodes[nde];var id=nde;if(!node.jointName||nodeIsInJoints(skins,node.jointName)){continue;}var mat=configureBoneTransformation(node);var bone=new Bone(node.name||"",newSkeleton,null,mat);bone.id=id;nodesToRoot.push({bone:bone,node:node,id:id});}for(var i=0;i<nodesToRoot.length;i++){var nodeToRoot=nodesToRoot[i];var children=nodeToRoot.node.children;for(var j=0;j<children.length;j++){var child=null;for(var k=0;k<nodesToRoot.length;k++){if(nodesToRoot[k].id===children[j]){child=nodesToRoot[k];break;}}if(child){child.bone._parent=nodeToRoot.bone;nodeToRoot.bone.children.push(child.bone);}}}};var importSkeleton=function importSkeleton(gltfRuntime,skins,mesh,newSkeleton){if(!newSkeleton){newSkeleton=new Skeleton(skins.name||"","",gltfRuntime.scene);}if(!skins.babylonSkeleton){return newSkeleton;}var nodesToRoot=[];var nodesToRootToAdd=[];getNodesToRoot(gltfRuntime,newSkeleton,skins,nodesToRoot);newSkeleton.bones=[];for(var i=0;i<skins.jointNames.length;i++){var jointNode=getJointNode(gltfRuntime,skins.jointNames[i]);if(!jointNode){continue;}var node=jointNode.node;if(!node){Tools.Warn("Joint named "+skins.jointNames[i]+" does not exist");continue;}var id=jointNode.id;var existingBone=gltfRuntime.scene.getBoneById(id);if(existingBone){newSkeleton.bones.push(existingBone);continue;}var foundBone=false;var parentBone=null;for(var j=0;j<i;j++){var jointNode2=getJointNode(gltfRuntime,skins.jointNames[j]);if(!jointNode2){continue;}var joint=jointNode2.node;if(!joint){Tools.Warn("Joint named "+skins.jointNames[j]+" does not exist when looking for parent");continue;}var children=joint.children;if(!children){continue;}foundBone=false;for(var k=0;k<children.length;k++){if(children[k]===id){parentBone=getParentBone(gltfRuntime,skins,skins.jointNames[j],newSkeleton);foundBone=true;break;}}if(foundBone){break;}}var mat=configureBoneTransformation(node);if(!parentBone&&nodesToRoot.length>0){parentBone=getNodeToRoot(nodesToRoot,id);if(parentBone){if(nodesToRootToAdd.indexOf(parentBone)===-1){nodesToRootToAdd.push(parentBone);}}}var bone=new Bone(node.jointName||"",newSkeleton,parentBone,mat);bone.id=id;}var bones=newSkeleton.bones;newSkeleton.bones=[];for(var _i27=0;_i27<skins.jointNames.length;_i27++){var _jointNode=getJointNode(gltfRuntime,skins.jointNames[_i27]);if(!_jointNode){continue;}for(var _j8=0;_j8<bones.length;_j8++){if(bones[_j8].id===_jointNode.id){newSkeleton.bones.push(bones[_j8]);break;}}}newSkeleton.prepare();for(var _i28=0;_i28<nodesToRootToAdd.length;_i28++){newSkeleton.bones.push(nodesToRootToAdd[_i28]);}return newSkeleton;};var importMesh=function importMesh(gltfRuntime,node,meshes,id,newMesh){if(!newMesh){gltfRuntime.scene._blockEntityCollection=!!gltfRuntime.assetContainer;newMesh=new Mesh(node.name||"",gltfRuntime.scene);newMesh._parentContainer=gltfRuntime.assetContainer;gltfRuntime.scene._blockEntityCollection=false;newMesh.id=id;}if(!node.babylonNode){return newMesh;}var subMaterials=[];var vertexData=null;var verticesStarts=new Array();var verticesCounts=new Array();var indexStarts=new Array();var indexCounts=new Array();for(var meshIndex=0;meshIndex<meshes.length;meshIndex++){var meshId=meshes[meshIndex];var mesh=gltfRuntime.meshes[meshId];if(!mesh){continue;}for(var i=0;i<mesh.primitives.length;i++){var tempVertexData=new VertexData();var primitive=mesh.primitives[i];if(primitive.mode!==4){}var attributes=primitive.attributes;var accessor=null;var buffer=null;for(var semantic in attributes){accessor=gltfRuntime.accessors[attributes[semantic]];buffer=GLTFUtils.GetBufferFromAccessor(gltfRuntime,accessor);if(semantic==="NORMAL"){tempVertexData.normals=new Float32Array(buffer.length);tempVertexData.normals.set(buffer);}else if(semantic==="POSITION"){if(GLTFFileLoader.HomogeneousCoordinates){tempVertexData.positions=new Float32Array(buffer.length-buffer.length/4);for(var j=0;j<buffer.length;j+=4){tempVertexData.positions[j]=buffer[j];tempVertexData.positions[j+1]=buffer[j+1];tempVertexData.positions[j+2]=buffer[j+2];}}else{tempVertexData.positions=new Float32Array(buffer.length);tempVertexData.positions.set(buffer);}verticesCounts.push(tempVertexData.positions.length);}else if(semantic.indexOf("TEXCOORD_")!==-1){var channel=Number(semantic.split("_")[1]);var uvKind=VertexBuffer.UVKind+(channel===0?"":channel+1);var uvs=new Float32Array(buffer.length);uvs.set(buffer);normalizeUVs(uvs);tempVertexData.set(uvs,uvKind);}else if(semantic==="JOINT"){tempVertexData.matricesIndices=new Float32Array(buffer.length);tempVertexData.matricesIndices.set(buffer);}else if(semantic==="WEIGHT"){tempVertexData.matricesWeights=new Float32Array(buffer.length);tempVertexData.matricesWeights.set(buffer);}else if(semantic==="COLOR"){tempVertexData.colors=new Float32Array(buffer.length);tempVertexData.colors.set(buffer);}}accessor=gltfRuntime.accessors[primitive.indices];if(accessor){buffer=GLTFUtils.GetBufferFromAccessor(gltfRuntime,accessor);tempVertexData.indices=new Int32Array(buffer.length);tempVertexData.indices.set(buffer);indexCounts.push(tempVertexData.indices.length);}else{var indices=[];for(var _j9=0;_j9<tempVertexData.positions.length/3;_j9++){indices.push(_j9);}tempVertexData.indices=new Int32Array(indices);indexCounts.push(tempVertexData.indices.length);}if(!vertexData){vertexData=tempVertexData;}else{vertexData.merge(tempVertexData);}var material2=gltfRuntime.scene.getMaterialById(primitive.material);subMaterials.push(material2===null?GLTFUtils.GetDefaultMaterial(gltfRuntime.scene):material2);verticesStarts.push(verticesStarts.length===0?0:verticesStarts[verticesStarts.length-1]+verticesCounts[verticesCounts.length-2]);indexStarts.push(indexStarts.length===0?0:indexStarts[indexStarts.length-1]+indexCounts[indexCounts.length-2]);}}var material;gltfRuntime.scene._blockEntityCollection=!!gltfRuntime.assetContainer;if(subMaterials.length>1){material=new MultiMaterial("multimat"+id,gltfRuntime.scene);material.subMaterials=subMaterials;}else{material=new StandardMaterial("multimat"+id,gltfRuntime.scene);}if(subMaterials.length===1){material=subMaterials[0];}material._parentContainer=gltfRuntime.assetContainer;if(!newMesh.material){newMesh.material=material;}new Geometry(id,gltfRuntime.scene,vertexData,false,newMesh);newMesh.computeWorldMatrix(true);gltfRuntime.scene._blockEntityCollection=false;newMesh.subMeshes=[];var index=0;for(var _meshIndex=0;_meshIndex<meshes.length;_meshIndex++){var _meshId=meshes[_meshIndex];var _mesh4=gltfRuntime.meshes[_meshId];if(!_mesh4){continue;}for(var _i29=0;_i29<_mesh4.primitives.length;_i29++){if(_mesh4.primitives[_i29].mode!==4){}SubMesh.AddToMesh(index,verticesStarts[index],verticesCounts[index],indexStarts[index],indexCounts[index],newMesh,newMesh,true);index++;}}return newMesh;};var configureNode=function configureNode(newNode,position,rotation,scaling){if(newNode.position){newNode.position=position;}if(newNode.rotationQuaternion||newNode.rotation){newNode.rotationQuaternion=rotation;}if(newNode.scaling){newNode.scaling=scaling;}};var configureNodeFromMatrix=function configureNodeFromMatrix(newNode,node){if(node.matrix){var position=new Vector3(0,0,0);var rotation=new Quaternion();var scaling=new Vector3(0,0,0);var mat=Matrix.FromArray(node.matrix);mat.decompose(scaling,rotation,position);configureNode(newNode,position,rotation,scaling);}else if(node.translation&&node.rotation&&node.scale){configureNode(newNode,Vector3.FromArray(node.translation),Quaternion.FromArray(node.rotation),Vector3.FromArray(node.scale));}newNode.computeWorldMatrix(true);};var importNode=function importNode(gltfRuntime,node,id){var lastNode=null;if(gltfRuntime.importOnlyMeshes&&(node.skin||node.meshes)){if(gltfRuntime.importMeshesNames&&gltfRuntime.importMeshesNames.length>0&&gltfRuntime.importMeshesNames.indexOf(node.name||"")===-1){return null;}}if(node.skin){if(node.meshes){var skin=gltfRuntime.skins[node.skin];var newMesh=importMesh(gltfRuntime,node,node.meshes,id,node.babylonNode);newMesh.skeleton=gltfRuntime.scene.getLastSkeletonById(node.skin);if(newMesh.skeleton===null){newMesh.skeleton=importSkeleton(gltfRuntime,skin,newMesh,skin.babylonSkeleton);if(!skin.babylonSkeleton){skin.babylonSkeleton=newMesh.skeleton;}}lastNode=newMesh;}}else if(node.meshes){var _newMesh=importMesh(gltfRuntime,node,node.mesh?[node.mesh]:node.meshes,id,node.babylonNode);lastNode=_newMesh;}else if(node.light&&!node.babylonNode&&!gltfRuntime.importOnlyMeshes){var light=gltfRuntime.lights[node.light];if(light){if(light.type==="ambient"){var ambienLight=light[light.type];var hemiLight=new HemisphericLight(node.light,Vector3.Zero(),gltfRuntime.scene);hemiLight.name=node.name||"";if(ambienLight.color){hemiLight.diffuse=Color3.FromArray(ambienLight.color);}lastNode=hemiLight;}else if(light.type==="directional"){var directionalLight=light[light.type];var dirLight=new DirectionalLight(node.light,Vector3.Zero(),gltfRuntime.scene);dirLight.name=node.name||"";if(directionalLight.color){dirLight.diffuse=Color3.FromArray(directionalLight.color);}lastNode=dirLight;}else if(light.type==="point"){var pointLight=light[light.type];var ptLight=new PointLight(node.light,Vector3.Zero(),gltfRuntime.scene);ptLight.name=node.name||"";if(pointLight.color){ptLight.diffuse=Color3.FromArray(pointLight.color);}lastNode=ptLight;}else if(light.type==="spot"){var spotLight=light[light.type];var spLight=new SpotLight(node.light,Vector3.Zero(),Vector3.Zero(),0,0,gltfRuntime.scene);spLight.name=node.name||"";if(spotLight.color){spLight.diffuse=Color3.FromArray(spotLight.color);}if(spotLight.fallOfAngle){spLight.angle=spotLight.fallOfAngle;}if(spotLight.fallOffExponent){spLight.exponent=spotLight.fallOffExponent;}lastNode=spLight;}}}else if(node.camera&&!node.babylonNode&&!gltfRuntime.importOnlyMeshes){var camera=gltfRuntime.cameras[node.camera];if(camera){gltfRuntime.scene._blockEntityCollection=!!gltfRuntime.assetContainer;if(camera.type==="orthographic"){var orthoCamera=new FreeCamera(node.camera,Vector3.Zero(),gltfRuntime.scene,false);orthoCamera.name=node.name||"";orthoCamera.mode=Camera.ORTHOGRAPHIC_CAMERA;orthoCamera.attachControl();lastNode=orthoCamera;orthoCamera._parentContainer=gltfRuntime.assetContainer;}else if(camera.type==="perspective"){var perspectiveCamera=camera[camera.type];var persCamera=new FreeCamera(node.camera,Vector3.Zero(),gltfRuntime.scene,false);persCamera.name=node.name||"";persCamera.attachControl();if(!perspectiveCamera.aspectRatio){perspectiveCamera.aspectRatio=gltfRuntime.scene.getEngine().getRenderWidth()/gltfRuntime.scene.getEngine().getRenderHeight();}if(perspectiveCamera.znear&&perspectiveCamera.zfar){persCamera.maxZ=perspectiveCamera.zfar;persCamera.minZ=perspectiveCamera.znear;}lastNode=persCamera;persCamera._parentContainer=gltfRuntime.assetContainer;}gltfRuntime.scene._blockEntityCollection=false;}}if(!node.jointName){if(node.babylonNode){return node.babylonNode;}else if(lastNode===null){gltfRuntime.scene._blockEntityCollection=!!gltfRuntime.assetContainer;var dummy=new Mesh(node.name||"",gltfRuntime.scene);dummy._parentContainer=gltfRuntime.assetContainer;gltfRuntime.scene._blockEntityCollection=false;node.babylonNode=dummy;lastNode=dummy;}}if(lastNode!==null){if(node.matrix&&lastNode instanceof Mesh){configureNodeFromMatrix(lastNode,node);}else{var translation=node.translation||[0,0,0];var rotation=node.rotation||[0,0,0,1];var scale=node.scale||[1,1,1];configureNode(lastNode,Vector3.FromArray(translation),Quaternion.FromArray(rotation),Vector3.FromArray(scale));}lastNode.updateCache(true);node.babylonNode=lastNode;}return lastNode;};var traverseNodes=function traverseNodes(gltfRuntime,id,parent){var meshIncluded=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var node=gltfRuntime.nodes[id];var newNode=null;if(gltfRuntime.importOnlyMeshes&&!meshIncluded&&gltfRuntime.importMeshesNames){if(gltfRuntime.importMeshesNames.indexOf(node.name||"")!==-1||gltfRuntime.importMeshesNames.length===0){meshIncluded=true;}else{meshIncluded=false;}}else{meshIncluded=true;}if(!node.jointName&&meshIncluded){newNode=importNode(gltfRuntime,node,id);if(newNode!==null){newNode.id=id;newNode.parent=parent;}}if(node.children){for(var i=0;i<node.children.length;i++){traverseNodes(gltfRuntime,node.children[i],newNode,meshIncluded);}}};var postLoad=function postLoad(gltfRuntime){var currentScene=gltfRuntime.currentScene;if(currentScene){for(var i=0;i<currentScene.nodes.length;i++){traverseNodes(gltfRuntime,currentScene.nodes[i],null);}}else{for(var thing in gltfRuntime.scenes){currentScene=gltfRuntime.scenes[thing];for(var _i30=0;_i30<currentScene.nodes.length;_i30++){traverseNodes(gltfRuntime,currentScene.nodes[_i30],null);}}}loadAnimations(gltfRuntime);for(var _i31=0;_i31<gltfRuntime.scene.skeletons.length;_i31++){var skeleton=gltfRuntime.scene.skeletons[_i31];gltfRuntime.scene.beginAnimation(skeleton,0,Number.MAX_VALUE,true,1);}};var onBindShaderMaterial=function onBindShaderMaterial(mesh,gltfRuntime,unTreatedUniforms,shaderMaterial,technique,material,onSuccess){var materialValues=material.values||technique.parameters;for(var unif in unTreatedUniforms){var uniform=unTreatedUniforms[unif];var type=uniform.type;if(type===EParameterType.FLOAT_MAT2||type===EParameterType.FLOAT_MAT3||type===EParameterType.FLOAT_MAT4){if(uniform.semantic&&!uniform.source&&!uniform.node){GLTFUtils.SetMatrix(gltfRuntime.scene,mesh,uniform,unif,shaderMaterial.getEffect());}else if(uniform.semantic&&(uniform.source||uniform.node)){var source=gltfRuntime.scene.getNodeByName(uniform.source||uniform.node||"");if(source===null){source=gltfRuntime.scene.getNodeById(uniform.source||uniform.node||"");}if(source===null){continue;}GLTFUtils.SetMatrix(gltfRuntime.scene,source,uniform,unif,shaderMaterial.getEffect());}}else{var value=materialValues[technique.uniforms[unif]];if(!value){continue;}if(type===EParameterType.SAMPLER_2D){var texture=gltfRuntime.textures[material.values?value:uniform.value].babylonTexture;if(texture===null||texture===void 0){continue;}shaderMaterial.getEffect().setTexture(unif,texture);}else{GLTFUtils.SetUniform(shaderMaterial.getEffect(),unif,value,type);}}}onSuccess(shaderMaterial);};var prepareShaderMaterialUniforms=function prepareShaderMaterialUniforms(gltfRuntime,shaderMaterial,technique,material,unTreatedUniforms){var materialValues=material.values||technique.parameters;var techniqueUniforms=technique.uniforms;var _loop7=function _loop7(){var uniform=unTreatedUniforms[unif];var type=uniform.type;var value=materialValues[techniqueUniforms[unif]];if(value===void 0){value=uniform.value;}if(!value){return 1;// continue
}var onLoadTexture=function onLoadTexture(uniformName){return function(texture){if(uniform.value&&uniformName){shaderMaterial.setTexture(uniformName,texture);delete unTreatedUniforms[uniformName];}};};if(type===EParameterType.SAMPLER_2D){GLTFLoaderExtension.LoadTextureAsync(gltfRuntime,material.values?value:uniform.value,onLoadTexture(unif),function(){return onLoadTexture(null);});}else{if(uniform.value&&GLTFUtils.SetUniform(shaderMaterial,unif,material.values?value:uniform.value,type)){delete unTreatedUniforms[unif];}}};for(var unif in unTreatedUniforms){if(_loop7())continue;}};var onShaderCompileError=function onShaderCompileError(program,shaderMaterial,onError){return function(effect,error){shaderMaterial.dispose(true);onError("Cannot compile program named "+program.name+". Error: "+error+". Default material will be applied");};};var onShaderCompileSuccess=function onShaderCompileSuccess(gltfRuntime,shaderMaterial,technique,material,unTreatedUniforms,onSuccess){return function(_){prepareShaderMaterialUniforms(gltfRuntime,shaderMaterial,technique,material,unTreatedUniforms);shaderMaterial.onBind=function(mesh){onBindShaderMaterial(mesh,gltfRuntime,unTreatedUniforms,shaderMaterial,technique,material,onSuccess);};};};var parseShaderUniforms=function parseShaderUniforms(tokenizer,technique,unTreatedUniforms){for(var unif in technique.uniforms){var uniform=technique.uniforms[unif];var uniformParameter=technique.parameters[uniform];if(tokenizer.currentIdentifier===unif){if(uniformParameter.semantic&&!uniformParameter.source&&!uniformParameter.node){var transformIndex=glTFTransforms.indexOf(uniformParameter.semantic);if(transformIndex!==-1){delete unTreatedUniforms[unif];return babylonTransforms[transformIndex];}}}}return tokenizer.currentIdentifier;};var importMaterials=function importMaterials(gltfRuntime){for(var mat in gltfRuntime.materials){GLTFLoaderExtension.LoadMaterialAsync(gltfRuntime,mat,function(){},function(){});}};var GLTFLoaderBase=/*#__PURE__*/function(){function GLTFLoaderBase(){_classCallCheck(this,GLTFLoaderBase);}_createClass(GLTFLoaderBase,null,[{key:"CreateRuntime",value:function CreateRuntime(parsedData,scene2,rootUrl){var gltfRuntime={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:scene2,rootUrl:rootUrl,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:false,dummyNodes:[],assetContainer:null};if(parsedData.extensions){parseObject(parsedData.extensions,"extensions",gltfRuntime);}if(parsedData.extensionsUsed){parseObject(parsedData.extensionsUsed,"extensionsUsed",gltfRuntime);}if(parsedData.buffers){parseBuffers(parsedData.buffers,gltfRuntime);}if(parsedData.bufferViews){parseObject(parsedData.bufferViews,"bufferViews",gltfRuntime);}if(parsedData.accessors){parseObject(parsedData.accessors,"accessors",gltfRuntime);}if(parsedData.meshes){parseObject(parsedData.meshes,"meshes",gltfRuntime);}if(parsedData.lights){parseObject(parsedData.lights,"lights",gltfRuntime);}if(parsedData.cameras){parseObject(parsedData.cameras,"cameras",gltfRuntime);}if(parsedData.nodes){parseObject(parsedData.nodes,"nodes",gltfRuntime);}if(parsedData.images){parseObject(parsedData.images,"images",gltfRuntime);}if(parsedData.textures){parseObject(parsedData.textures,"textures",gltfRuntime);}if(parsedData.shaders){parseShaders(parsedData.shaders,gltfRuntime);}if(parsedData.programs){parseObject(parsedData.programs,"programs",gltfRuntime);}if(parsedData.samplers){parseObject(parsedData.samplers,"samplers",gltfRuntime);}if(parsedData.techniques){parseObject(parsedData.techniques,"techniques",gltfRuntime);}if(parsedData.materials){parseObject(parsedData.materials,"materials",gltfRuntime);}if(parsedData.animations){parseObject(parsedData.animations,"animations",gltfRuntime);}if(parsedData.skins){parseObject(parsedData.skins,"skins",gltfRuntime);}if(parsedData.scenes){gltfRuntime.scenes=parsedData.scenes;}if(parsedData.scene&&parsedData.scenes){gltfRuntime.currentScene=parsedData.scenes[parsedData.scene];}return gltfRuntime;}},{key:"LoadBufferAsync",value:function LoadBufferAsync(gltfRuntime,id,onSuccess,onError,onProgress){var buffer=gltfRuntime.buffers[id];if(Tools.IsBase64(buffer.uri)){setTimeout(function(){return onSuccess(new Uint8Array(Tools.DecodeBase64(buffer.uri)));});}else{Tools.LoadFile(gltfRuntime.rootUrl+buffer.uri,function(data){return onSuccess(new Uint8Array(data));},onProgress,void 0,true,function(request){if(request){onError(request.status+" "+request.statusText);}});}}},{key:"LoadTextureBufferAsync",value:function LoadTextureBufferAsync(gltfRuntime,id,onSuccess,onError){var texture=gltfRuntime.textures[id];if(!texture||!texture.source){onError("");return;}if(texture.babylonTexture){onSuccess(null);return;}var source=gltfRuntime.images[texture.source];if(Tools.IsBase64(source.uri)){setTimeout(function(){return onSuccess(new Uint8Array(Tools.DecodeBase64(source.uri)));});}else{Tools.LoadFile(gltfRuntime.rootUrl+source.uri,function(data){return onSuccess(new Uint8Array(data));},void 0,void 0,true,function(request){if(request){onError(request.status+" "+request.statusText);}});}}},{key:"CreateTextureAsync",value:function CreateTextureAsync(gltfRuntime,id,buffer,onSuccess){var texture=gltfRuntime.textures[id];if(texture.babylonTexture){onSuccess(texture.babylonTexture);return;}var sampler=gltfRuntime.samplers[texture.sampler];var createMipMaps=sampler.minFilter===ETextureFilterType.NEAREST_MIPMAP_NEAREST||sampler.minFilter===ETextureFilterType.NEAREST_MIPMAP_LINEAR||sampler.minFilter===ETextureFilterType.LINEAR_MIPMAP_NEAREST||sampler.minFilter===ETextureFilterType.LINEAR_MIPMAP_LINEAR;var samplingMode=Texture.BILINEAR_SAMPLINGMODE;var blob=buffer==null?new Blob():new Blob([buffer]);var blobURL=URL.createObjectURL(blob);var revokeBlobURL=function revokeBlobURL(){return URL.revokeObjectURL(blobURL);};var newTexture=new Texture(blobURL,gltfRuntime.scene,!createMipMaps,true,samplingMode,revokeBlobURL,revokeBlobURL);if(sampler.wrapS!==void 0){newTexture.wrapU=GLTFUtils.GetWrapMode(sampler.wrapS);}if(sampler.wrapT!==void 0){newTexture.wrapV=GLTFUtils.GetWrapMode(sampler.wrapT);}newTexture.name=id;texture.babylonTexture=newTexture;onSuccess(newTexture);}},{key:"LoadShaderStringAsync",value:function LoadShaderStringAsync(gltfRuntime,id,onSuccess,onError){var shader135=gltfRuntime.shaders[id];if(Tools.IsBase64(shader135.uri)){var shaderString=atob(shader135.uri.split(",")[1]);if(onSuccess){onSuccess(shaderString);}}else{Tools.LoadFile(gltfRuntime.rootUrl+shader135.uri,onSuccess,void 0,void 0,false,function(request){if(request&&onError){onError(request.status+" "+request.statusText);}});}}},{key:"LoadMaterialAsync",value:function LoadMaterialAsync(gltfRuntime,id,onSuccess,onError){var material=gltfRuntime.materials[id];if(!material.technique){if(onError){onError("No technique found.");}return;}var technique=gltfRuntime.techniques[material.technique];if(!technique){gltfRuntime.scene._blockEntityCollection=!!gltfRuntime.assetContainer;var defaultMaterial=new StandardMaterial(id,gltfRuntime.scene);defaultMaterial._parentContainer=gltfRuntime.assetContainer;gltfRuntime.scene._blockEntityCollection=false;defaultMaterial.diffuseColor=new Color3(0.5,0.5,0.5);defaultMaterial.sideOrientation=Material.CounterClockWiseSideOrientation;onSuccess(defaultMaterial);return;}var program=gltfRuntime.programs[technique.program];var states=technique.states;var vertexShader=Effect.ShadersStore[program.vertexShader+"VertexShader"];var pixelShader=Effect.ShadersStore[program.fragmentShader+"PixelShader"];var newVertexShader="";var newPixelShader="";var vertexTokenizer=new Tokenizer(vertexShader);var pixelTokenizer=new Tokenizer(pixelShader);var unTreatedUniforms={};var uniforms=[];var attributes=[];var samplers=[];for(var unif in technique.uniforms){var uniform=technique.uniforms[unif];var uniformParameter=technique.parameters[uniform];unTreatedUniforms[unif]=uniformParameter;if(uniformParameter.semantic&&!uniformParameter.node&&!uniformParameter.source){var transformIndex=glTFTransforms.indexOf(uniformParameter.semantic);if(transformIndex!==-1){uniforms.push(babylonTransforms[transformIndex]);delete unTreatedUniforms[unif];}else{uniforms.push(unif);}}else if(uniformParameter.type===EParameterType.SAMPLER_2D){samplers.push(unif);}else{uniforms.push(unif);}}for(var attr in technique.attributes){var attribute=technique.attributes[attr];var attributeParameter=technique.parameters[attribute];if(attributeParameter.semantic){var name135=getAttribute(attributeParameter);if(name135){attributes.push(name135);}}}while(!vertexTokenizer.isEnd()&&vertexTokenizer.getNextToken()){var tokenType=vertexTokenizer.currentToken;if(tokenType!==ETokenType.IDENTIFIER){newVertexShader+=vertexTokenizer.currentString;continue;}var foundAttribute=false;for(var _attr in technique.attributes){var _attribute=technique.attributes[_attr];var _attributeParameter=technique.parameters[_attribute];if(vertexTokenizer.currentIdentifier===_attr&&_attributeParameter.semantic){newVertexShader+=getAttribute(_attributeParameter);foundAttribute=true;break;}}if(foundAttribute){continue;}newVertexShader+=parseShaderUniforms(vertexTokenizer,technique,unTreatedUniforms);}while(!pixelTokenizer.isEnd()&&pixelTokenizer.getNextToken()){var _tokenType=pixelTokenizer.currentToken;if(_tokenType!==ETokenType.IDENTIFIER){newPixelShader+=pixelTokenizer.currentString;continue;}newPixelShader+=parseShaderUniforms(pixelTokenizer,technique,unTreatedUniforms);}var shaderPath={vertex:program.vertexShader+id,fragment:program.fragmentShader+id};var options={attributes:attributes,uniforms:uniforms,samplers:samplers,needAlphaBlending:states&&states.enable&&states.enable.indexOf(3042)!==-1};Effect.ShadersStore[program.vertexShader+id+"VertexShader"]=newVertexShader;Effect.ShadersStore[program.fragmentShader+id+"PixelShader"]=newPixelShader;var shaderMaterial=new ShaderMaterial(id,gltfRuntime.scene,shaderPath,options);shaderMaterial.onError=onShaderCompileError(program,shaderMaterial,onError);shaderMaterial.onCompiled=onShaderCompileSuccess(gltfRuntime,shaderMaterial,technique,material,unTreatedUniforms,onSuccess);shaderMaterial.sideOrientation=Material.CounterClockWiseSideOrientation;if(states&&states.functions){var functions=states.functions;if(functions.cullFace&&functions.cullFace[0]!==ECullingType.BACK){shaderMaterial.backFaceCulling=false;}var blendFunc=functions.blendFuncSeparate;if(blendFunc){if(blendFunc[0]===EBlendingFunction.SRC_ALPHA&&blendFunc[1]===EBlendingFunction.ONE_MINUS_SRC_ALPHA&&blendFunc[2]===EBlendingFunction.ONE&&blendFunc[3]===EBlendingFunction.ONE){shaderMaterial.alphaMode=Constants.ALPHA_COMBINE;}else if(blendFunc[0]===EBlendingFunction.ONE&&blendFunc[1]===EBlendingFunction.ONE&&blendFunc[2]===EBlendingFunction.ZERO&&blendFunc[3]===EBlendingFunction.ONE){shaderMaterial.alphaMode=Constants.ALPHA_ONEONE;}else if(blendFunc[0]===EBlendingFunction.SRC_ALPHA&&blendFunc[1]===EBlendingFunction.ONE&&blendFunc[2]===EBlendingFunction.ZERO&&blendFunc[3]===EBlendingFunction.ONE){shaderMaterial.alphaMode=Constants.ALPHA_ADD;}else if(blendFunc[0]===EBlendingFunction.ZERO&&blendFunc[1]===EBlendingFunction.ONE_MINUS_SRC_COLOR&&blendFunc[2]===EBlendingFunction.ONE&&blendFunc[3]===EBlendingFunction.ONE){shaderMaterial.alphaMode=Constants.ALPHA_SUBTRACT;}else if(blendFunc[0]===EBlendingFunction.DST_COLOR&&blendFunc[1]===EBlendingFunction.ZERO&&blendFunc[2]===EBlendingFunction.ONE&&blendFunc[3]===EBlendingFunction.ONE){shaderMaterial.alphaMode=Constants.ALPHA_MULTIPLY;}else if(blendFunc[0]===EBlendingFunction.SRC_ALPHA&&blendFunc[1]===EBlendingFunction.ONE_MINUS_SRC_COLOR&&blendFunc[2]===EBlendingFunction.ONE&&blendFunc[3]===EBlendingFunction.ONE){shaderMaterial.alphaMode=Constants.ALPHA_MAXIMIZED;}}}}}]);return GLTFLoaderBase;}();var GLTFLoader=/*#__PURE__*/function(){function GLTFLoader(){_classCallCheck(this,GLTFLoader);}_createClass(GLTFLoader,[{key:"dispose",value:function dispose(){}},{key:"_importMeshAsync",value:function _importMeshAsync(meshesNames,scene2,data,rootUrl,assetContainer,onSuccess,onProgress,onError){var _this151=this;scene2.useRightHandedSystem=true;GLTFLoaderExtension.LoadRuntimeAsync(scene2,data,rootUrl,function(gltfRuntime){gltfRuntime.assetContainer=assetContainer;gltfRuntime.importOnlyMeshes=true;if(meshesNames===""){gltfRuntime.importMeshesNames=[];}else if(typeof meshesNames==="string"){gltfRuntime.importMeshesNames=[meshesNames];}else if(meshesNames&&!(meshesNames instanceof Array)){gltfRuntime.importMeshesNames=[meshesNames];}else{gltfRuntime.importMeshesNames=[];Tools.Warn("Argument meshesNames must be of type string or string[]");}_this151._createNodes(gltfRuntime);var meshes=new Array();var skeletons=new Array();for(var nde in gltfRuntime.nodes){var node=gltfRuntime.nodes[nde];if(node.babylonNode instanceof AbstractMesh){meshes.push(node.babylonNode);}}for(var skl in gltfRuntime.skins){var skin=gltfRuntime.skins[skl];if(skin.babylonSkeleton instanceof Skeleton){skeletons.push(skin.babylonSkeleton);}}_this151._loadBuffersAsync(gltfRuntime,function(){_this151._loadShadersAsync(gltfRuntime,function(){importMaterials(gltfRuntime);postLoad(gltfRuntime);if(!GLTFFileLoader.IncrementalLoading&&onSuccess){onSuccess(meshes,skeletons);}});});if(GLTFFileLoader.IncrementalLoading&&onSuccess){onSuccess(meshes,skeletons);}},onError);return true;}},{key:"importMeshAsync",value:function importMeshAsync(meshesNames,scene2,assetContainer,data,rootUrl,onProgress){var _this152=this;return new Promise(function(resolve,reject){_this152._importMeshAsync(meshesNames,scene2,data,rootUrl,assetContainer,function(meshes,skeletons){resolve({meshes:meshes,particleSystems:[],skeletons:skeletons,animationGroups:[],lights:[],transformNodes:[],geometries:[]});},onProgress,function(message){reject(new Error(message));});});}},{key:"_loadAsync",value:function _loadAsync(scene2,data,rootUrl,onSuccess,onProgress,onError){var _this153=this;scene2.useRightHandedSystem=true;GLTFLoaderExtension.LoadRuntimeAsync(scene2,data,rootUrl,function(gltfRuntime){GLTFLoaderExtension.LoadRuntimeExtensionsAsync(gltfRuntime,function(){_this153._createNodes(gltfRuntime);_this153._loadBuffersAsync(gltfRuntime,function(){_this153._loadShadersAsync(gltfRuntime,function(){importMaterials(gltfRuntime);postLoad(gltfRuntime);if(!GLTFFileLoader.IncrementalLoading){onSuccess();}});});if(GLTFFileLoader.IncrementalLoading){onSuccess();}},onError);},onError);}},{key:"loadAsync",value:function loadAsync(scene2,data,rootUrl,onProgress){var _this154=this;return new Promise(function(resolve,reject){_this154._loadAsync(scene2,data,rootUrl,function(){resolve();},onProgress,function(message){reject(new Error(message));});});}},{key:"_loadShadersAsync",value:function _loadShadersAsync(gltfRuntime,onload){var hasShaders=false;var processShader=function processShader(sha,shader135){GLTFLoaderExtension.LoadShaderStringAsync(gltfRuntime,sha,function(shaderString){if(shaderString instanceof ArrayBuffer){return;}gltfRuntime.loadedShaderCount++;if(shaderString){Effect.ShadersStore[sha+(shader135.type===EShaderType.VERTEX?"VertexShader":"PixelShader")]=shaderString;}if(gltfRuntime.loadedShaderCount===gltfRuntime.shaderscount){onload();}},function(){Tools.Error("Error when loading shader program named "+sha+" located at "+shader135.uri);});};for(var sha in gltfRuntime.shaders){hasShaders=true;var shader135=gltfRuntime.shaders[sha];if(shader135){processShader.bind(this,sha,shader135)();}else{Tools.Error("No shader named: "+sha);}}if(!hasShaders){onload();}}},{key:"_loadBuffersAsync",value:function _loadBuffersAsync(gltfRuntime,onLoad){var hasBuffers=false;var processBuffer=function processBuffer(buf,buffer){GLTFLoaderExtension.LoadBufferAsync(gltfRuntime,buf,function(bufferView){gltfRuntime.loadedBufferCount++;if(bufferView){if(bufferView.byteLength!=gltfRuntime.buffers[buf].byteLength){Tools.Error("Buffer named "+buf+" is length "+bufferView.byteLength+". Expected: "+buffer.byteLength);}gltfRuntime.loadedBufferViews[buf]=bufferView;}if(gltfRuntime.loadedBufferCount===gltfRuntime.buffersCount){onLoad();}},function(){Tools.Error("Error when loading buffer named "+buf+" located at "+buffer.uri);});};for(var buf in gltfRuntime.buffers){hasBuffers=true;var buffer=gltfRuntime.buffers[buf];if(buffer){processBuffer.bind(this,buf,buffer)();}else{Tools.Error("No buffer named: "+buf);}}if(!hasBuffers){onLoad();}}},{key:"_createNodes",value:function _createNodes(gltfRuntime){var currentScene=gltfRuntime.currentScene;if(currentScene){for(var i=0;i<currentScene.nodes.length;i++){traverseNodes(gltfRuntime,currentScene.nodes[i],null);}}else{for(var thing in gltfRuntime.scenes){currentScene=gltfRuntime.scenes[thing];for(var _i32=0;_i32<currentScene.nodes.length;_i32++){traverseNodes(gltfRuntime,currentScene.nodes[_i32],null);}}}}}],[{key:"RegisterExtension",value:function RegisterExtension(extension){if(GLTFLoader.Extensions[extension.name]){Tools.Error('Tool with the same name "'+extension.name+'" already exists');return;}GLTFLoader.Extensions[extension.name]=extension;}}]);return GLTFLoader;}();GLTFLoader.Extensions={};var GLTFLoaderExtension=/*#__PURE__*/function(){function GLTFLoaderExtension(name135){_classCallCheck(this,GLTFLoaderExtension);this._name=name135;}_createClass(GLTFLoaderExtension,[{key:"name",get:function get(){return this._name;}},{key:"loadRuntimeAsync",value:function loadRuntimeAsync(scene2,data,rootUrl,onSuccess,onError){return false;}},{key:"loadRuntimeExtensionsAsync",value:function loadRuntimeExtensionsAsync(gltfRuntime,onSuccess,onError){return false;}},{key:"loadBufferAsync",value:function loadBufferAsync(gltfRuntime,id,onSuccess,onError,onProgress){return false;}},{key:"loadTextureBufferAsync",value:function loadTextureBufferAsync(gltfRuntime,id,onSuccess,onError){return false;}},{key:"createTextureAsync",value:function createTextureAsync(gltfRuntime,id,buffer,onSuccess,onError){return false;}},{key:"loadShaderStringAsync",value:function loadShaderStringAsync(gltfRuntime,id,onSuccess,onError){return false;}},{key:"loadMaterialAsync",value:function loadMaterialAsync(gltfRuntime,id,onSuccess,onError){return false;}}],[{key:"LoadRuntimeAsync",value:function LoadRuntimeAsync(scene2,data,rootUrl,onSuccess,onError){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.loadRuntimeAsync(scene2,data,rootUrl,onSuccess,onError);},function(){setTimeout(function(){if(!onSuccess){return;}onSuccess(GLTFLoaderBase.CreateRuntime(data.json,scene2,rootUrl));});});}},{key:"LoadRuntimeExtensionsAsync",value:function LoadRuntimeExtensionsAsync(gltfRuntime,onSuccess,onError){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.loadRuntimeExtensionsAsync(gltfRuntime,onSuccess,onError);},function(){setTimeout(function(){onSuccess();});});}},{key:"LoadBufferAsync",value:function LoadBufferAsync(gltfRuntime,id,onSuccess,onError,onProgress){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.loadBufferAsync(gltfRuntime,id,onSuccess,onError,onProgress);},function(){GLTFLoaderBase.LoadBufferAsync(gltfRuntime,id,onSuccess,onError,onProgress);});}},{key:"LoadTextureAsync",value:function LoadTextureAsync(gltfRuntime,id,onSuccess,onError){GLTFLoaderExtension._LoadTextureBufferAsync(gltfRuntime,id,function(buffer){if(buffer){GLTFLoaderExtension._CreateTextureAsync(gltfRuntime,id,buffer,onSuccess,onError);}},onError);}},{key:"LoadShaderStringAsync",value:function LoadShaderStringAsync(gltfRuntime,id,onSuccess,onError){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.loadShaderStringAsync(gltfRuntime,id,onSuccess,onError);},function(){GLTFLoaderBase.LoadShaderStringAsync(gltfRuntime,id,onSuccess,onError);});}},{key:"LoadMaterialAsync",value:function LoadMaterialAsync(gltfRuntime,id,onSuccess,onError){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.loadMaterialAsync(gltfRuntime,id,onSuccess,onError);},function(){GLTFLoaderBase.LoadMaterialAsync(gltfRuntime,id,onSuccess,onError);});}},{key:"_LoadTextureBufferAsync",value:function _LoadTextureBufferAsync(gltfRuntime,id,onSuccess,onError){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.loadTextureBufferAsync(gltfRuntime,id,onSuccess,onError);},function(){GLTFLoaderBase.LoadTextureBufferAsync(gltfRuntime,id,onSuccess,onError);});}},{key:"_CreateTextureAsync",value:function _CreateTextureAsync(gltfRuntime,id,buffer,onSuccess,onError){GLTFLoaderExtension._ApplyExtensions(function(loaderExtension){return loaderExtension.createTextureAsync(gltfRuntime,id,buffer,onSuccess,onError);},function(){GLTFLoaderBase.CreateTextureAsync(gltfRuntime,id,buffer,onSuccess);});}},{key:"_ApplyExtensions",value:function _ApplyExtensions(func,defaultFunc){for(var extensionName in GLTFLoader.Extensions){var loaderExtension=GLTFLoader.Extensions[extensionName];if(func(loaderExtension)){return;}}defaultFunc();}}]);return GLTFLoaderExtension;}();GLTFFileLoader._CreateGLTF1Loader=function(){return new GLTFLoader();};// node_modules/@babylonjs/loaders/glTF/1.0/glTFBinaryExtension.js
var BinaryExtensionBufferName="binary_glTF";var GLTFBinaryExtension=/*#__PURE__*/function(_GLTFLoaderExtension){_inherits(GLTFBinaryExtension,_GLTFLoaderExtension);var _super49=_createSuper(GLTFBinaryExtension);function GLTFBinaryExtension(){_classCallCheck(this,GLTFBinaryExtension);return _super49.call(this,"KHR_binary_glTF");}_createClass(GLTFBinaryExtension,[{key:"loadRuntimeAsync",value:function loadRuntimeAsync(scene2,data,rootUrl,onSuccess){var extensionsUsed=data.json.extensionsUsed;if(!extensionsUsed||extensionsUsed.indexOf(this.name)===-1||!data.bin){return false;}this._bin=data.bin;onSuccess(GLTFLoaderBase.CreateRuntime(data.json,scene2,rootUrl));return true;}},{key:"loadBufferAsync",value:function loadBufferAsync(gltfRuntime,id,onSuccess,onError){if(gltfRuntime.extensionsUsed.indexOf(this.name)===-1){return false;}if(id!==BinaryExtensionBufferName){return false;}this._bin.readAsync(0,this._bin.byteLength).then(onSuccess,function(error){return onError(error.message);});return true;}},{key:"loadTextureBufferAsync",value:function loadTextureBufferAsync(gltfRuntime,id,onSuccess){var texture=gltfRuntime.textures[id];var source=gltfRuntime.images[texture.source];if(!source.extensions||!(this.name in source.extensions)){return false;}var sourceExt=source.extensions[this.name];var bufferView=gltfRuntime.bufferViews[sourceExt.bufferView];var buffer=GLTFUtils.GetBufferFromBufferView(gltfRuntime,bufferView,0,bufferView.byteLength,EComponentType.UNSIGNED_BYTE);onSuccess(buffer);return true;}},{key:"loadShaderStringAsync",value:function loadShaderStringAsync(gltfRuntime,id,onSuccess){var shader135=gltfRuntime.shaders[id];if(!shader135.extensions||!(this.name in shader135.extensions)){return false;}var binaryExtensionShader=shader135.extensions[this.name];var bufferView=gltfRuntime.bufferViews[binaryExtensionShader.bufferView];var shaderBytes=GLTFUtils.GetBufferFromBufferView(gltfRuntime,bufferView,0,bufferView.byteLength,EComponentType.UNSIGNED_BYTE);setTimeout(function(){var shaderString=GLTFUtils.DecodeBufferToText(shaderBytes);onSuccess(shaderString);});return true;}}]);return GLTFBinaryExtension;}(GLTFLoaderExtension);GLTFLoader.RegisterExtension(new GLTFBinaryExtension());// node_modules/@babylonjs/loaders/glTF/1.0/glTFMaterialsCommonExtension.js
var GLTFMaterialsCommonExtension=/*#__PURE__*/function(_GLTFLoaderExtension2){_inherits(GLTFMaterialsCommonExtension,_GLTFLoaderExtension2);var _super50=_createSuper(GLTFMaterialsCommonExtension);function GLTFMaterialsCommonExtension(){_classCallCheck(this,GLTFMaterialsCommonExtension);return _super50.call(this,"KHR_materials_common");}_createClass(GLTFMaterialsCommonExtension,[{key:"loadRuntimeExtensionsAsync",value:function loadRuntimeExtensionsAsync(gltfRuntime){if(!gltfRuntime.extensions){return false;}var extension=gltfRuntime.extensions[this.name];if(!extension){return false;}var lights=extension.lights;if(lights){for(var thing in lights){var light=lights[thing];switch(light.type){case"ambient":{var ambientLight=new HemisphericLight(light.name,new Vector3(0,1,0),gltfRuntime.scene);var ambient=light.ambient;if(ambient){ambientLight.diffuse=Color3.FromArray(ambient.color||[1,1,1]);}break;}case"point":{var pointLight=new PointLight(light.name,new Vector3(10,10,10),gltfRuntime.scene);var point=light.point;if(point){pointLight.diffuse=Color3.FromArray(point.color||[1,1,1]);}break;}case"directional":{var dirLight=new DirectionalLight(light.name,new Vector3(0,-1,0),gltfRuntime.scene);var directional=light.directional;if(directional){dirLight.diffuse=Color3.FromArray(directional.color||[1,1,1]);}break;}case"spot":{var spot=light.spot;if(spot){var spotLight=new SpotLight(light.name,new Vector3(0,10,0),new Vector3(0,-1,0),spot.fallOffAngle||Math.PI,spot.fallOffExponent||0,gltfRuntime.scene);spotLight.diffuse=Color3.FromArray(spot.color||[1,1,1]);}break;}default:Tools.Warn('GLTF Material Common extension: light type "'+light.type+"\u201D not supported");break;}}}return false;}},{key:"loadMaterialAsync",value:function loadMaterialAsync(gltfRuntime,id,onSuccess,onError){var material=gltfRuntime.materials[id];if(!material||!material.extensions){return false;}var extension=material.extensions[this.name];if(!extension){return false;}var standardMaterial=new StandardMaterial(id,gltfRuntime.scene);standardMaterial.sideOrientation=Material.CounterClockWiseSideOrientation;if(extension.technique==="CONSTANT"){standardMaterial.disableLighting=true;}standardMaterial.backFaceCulling=extension.doubleSided===void 0?false:!extension.doubleSided;standardMaterial.alpha=extension.values.transparency===void 0?1:extension.values.transparency;standardMaterial.specularPower=extension.values.shininess===void 0?0:extension.values.shininess;if(typeof extension.values.ambient==="string"){this._loadTexture(gltfRuntime,extension.values.ambient,standardMaterial,"ambientTexture",onError);}else{standardMaterial.ambientColor=Color3.FromArray(extension.values.ambient||[0,0,0]);}if(typeof extension.values.diffuse==="string"){this._loadTexture(gltfRuntime,extension.values.diffuse,standardMaterial,"diffuseTexture",onError);}else{standardMaterial.diffuseColor=Color3.FromArray(extension.values.diffuse||[0,0,0]);}if(typeof extension.values.emission==="string"){this._loadTexture(gltfRuntime,extension.values.emission,standardMaterial,"emissiveTexture",onError);}else{standardMaterial.emissiveColor=Color3.FromArray(extension.values.emission||[0,0,0]);}if(typeof extension.values.specular==="string"){this._loadTexture(gltfRuntime,extension.values.specular,standardMaterial,"specularTexture",onError);}else{standardMaterial.specularColor=Color3.FromArray(extension.values.specular||[0,0,0]);}return true;}},{key:"_loadTexture",value:function _loadTexture(gltfRuntime,id,material,propertyPath,onError){GLTFLoaderBase.LoadTextureBufferAsync(gltfRuntime,id,function(buffer){GLTFLoaderBase.CreateTextureAsync(gltfRuntime,id,buffer,function(texture){return material[propertyPath]=texture;});},onError);}}]);return GLTFMaterialsCommonExtension;}(GLTFLoaderExtension);GLTFLoader.RegisterExtension(new GLTFMaterialsCommonExtension());// node_modules/@babylonjs/core/Misc/deferred.js
var Deferred=/*#__PURE__*/function(){function Deferred(){var _this155=this;_classCallCheck(this,Deferred);this.promise=new Promise(function(resolve,reject){_this155._resolve=resolve;_this155._reject=reject;});}_createClass(Deferred,[{key:"resolve",get:function get(){return this._resolve;}},{key:"reject",get:function get(){return this._reject;}}]);return Deferred;}();// node_modules/@babylonjs/core/Animations/animationGroup.js
var TargetedAnimation=/*#__PURE__*/function(){function TargetedAnimation(){_classCallCheck(this,TargetedAnimation);}_createClass(TargetedAnimation,[{key:"getClassName",value:function getClassName(){return"TargetedAnimation";}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.animation=this.animation.serialize();serializationObject.targetId=this.target.id;return serializationObject;}}]);return TargetedAnimation;}();var AnimationGroup=/*#__PURE__*/function(){function AnimationGroup(name135){var scene2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;_classCallCheck(this,AnimationGroup);this.name=name135;this._targetedAnimations=new Array();this._animatables=new Array();this._from=Number.MAX_VALUE;this._to=-Number.MAX_VALUE;this._speedRatio=1;this._loopAnimation=false;this._isAdditive=false;this._parentContainer=null;this.onAnimationEndObservable=new Observable();this.onAnimationLoopObservable=new Observable();this.onAnimationGroupLoopObservable=new Observable();this.onAnimationGroupEndObservable=new Observable();this.onAnimationGroupPauseObservable=new Observable();this.onAnimationGroupPlayObservable=new Observable();this.metadata=null;this._animationLoopFlags=[];this._scene=scene2||EngineStore.LastCreatedScene;this.uniqueId=this._scene.getUniqueId();this._scene.addAnimationGroup(this);}_createClass(AnimationGroup,[{key:"from",get:function get(){return this._from;}},{key:"to",get:function get(){return this._to;}},{key:"isStarted",get:function get(){return this._isStarted;}},{key:"isPlaying",get:function get(){return this._isStarted&&!this._isPaused;}},{key:"speedRatio",get:function get(){return this._speedRatio;},set:function set(value){if(this._speedRatio===value){return;}this._speedRatio=value;for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.speedRatio=this._speedRatio;}}},{key:"loopAnimation",get:function get(){return this._loopAnimation;},set:function set(value){if(this._loopAnimation===value){return;}this._loopAnimation=value;for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.loopAnimation=this._loopAnimation;}}},{key:"isAdditive",get:function get(){return this._isAdditive;},set:function set(value){if(this._isAdditive===value){return;}this._isAdditive=value;for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.isAdditive=this._isAdditive;}}},{key:"targetedAnimations",get:function get(){return this._targetedAnimations;}},{key:"animatables",get:function get(){return this._animatables;}},{key:"children",get:function get(){return this._targetedAnimations;}},{key:"addTargetedAnimation",value:function addTargetedAnimation(animation,target){var targetedAnimation=new TargetedAnimation();targetedAnimation.animation=animation;targetedAnimation.target=target;var keys=animation.getKeys();if(this._from>keys[0].frame){this._from=keys[0].frame;}if(this._to<keys[keys.length-1].frame){this._to=keys[keys.length-1].frame;}this._targetedAnimations.push(targetedAnimation);return targetedAnimation;}},{key:"normalize",value:function normalize(){var beginFrame=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var endFrame=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(beginFrame==null){beginFrame=this._from;}if(endFrame==null){endFrame=this._to;}for(var index=0;index<this._targetedAnimations.length;index++){var targetedAnimation=this._targetedAnimations[index];var keys=targetedAnimation.animation.getKeys();var startKey=keys[0];var endKey=keys[keys.length-1];if(startKey.frame>beginFrame){var newKey={frame:beginFrame,value:startKey.value,inTangent:startKey.inTangent,outTangent:startKey.outTangent,interpolation:startKey.interpolation};keys.splice(0,0,newKey);}if(endKey.frame<endFrame){var _newKey={frame:endFrame,value:endKey.value,inTangent:endKey.inTangent,outTangent:endKey.outTangent,interpolation:endKey.interpolation};keys.push(_newKey);}}this._from=beginFrame;this._to=endFrame;return this;}},{key:"_processLoop",value:function _processLoop(animatable,targetedAnimation,index){var _this156=this;animatable.onAnimationLoop=function(){_this156.onAnimationLoopObservable.notifyObservers(targetedAnimation);if(_this156._animationLoopFlags[index]){return;}_this156._animationLoopFlags[index]=true;_this156._animationLoopCount++;if(_this156._animationLoopCount===_this156._targetedAnimations.length){_this156.onAnimationGroupLoopObservable.notifyObservers(_this156);_this156._animationLoopCount=0;_this156._animationLoopFlags.length=0;}};}},{key:"start",value:function start(){var _this157=this;var loop=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var speedRatio=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var from=arguments.length>2?arguments[2]:undefined;var to=arguments.length>3?arguments[3]:undefined;var isAdditive=arguments.length>4?arguments[4]:undefined;if(this._isStarted||this._targetedAnimations.length===0){return this;}this._loopAnimation=loop;this._animationLoopCount=0;this._animationLoopFlags.length=0;var _loop8=function _loop8(){var targetedAnimation=_this157._targetedAnimations[index];var animatable=_this157._scene.beginDirectAnimation(targetedAnimation.target,[targetedAnimation.animation],from!==void 0?from:_this157._from,to!==void 0?to:_this157._to,loop,speedRatio,void 0,void 0,isAdditive!==void 0?isAdditive:_this157._isAdditive);animatable.onAnimationEnd=function(){_this157.onAnimationEndObservable.notifyObservers(targetedAnimation);_this157._checkAnimationGroupEnded(animatable);};_this157._processLoop(animatable,targetedAnimation,index);_this157._animatables.push(animatable);};for(var index=0;index<this._targetedAnimations.length;index++){_loop8();}this._speedRatio=speedRatio;this._isStarted=true;this._isPaused=false;this.onAnimationGroupPlayObservable.notifyObservers(this);return this;}},{key:"pause",value:function pause(){if(!this._isStarted){return this;}this._isPaused=true;for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.pause();}this.onAnimationGroupPauseObservable.notifyObservers(this);return this;}},{key:"play",value:function play(loop){if(this.isStarted&&this._animatables.length===this._targetedAnimations.length){if(loop!==void 0){this.loopAnimation=loop;}this.restart();}else{this.stop();this.start(loop,this._speedRatio);}this._isPaused=false;return this;}},{key:"reset",value:function reset(){if(!this._isStarted){this.play();this.goToFrame(0);this.stop();return this;}for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.reset();}return this;}},{key:"restart",value:function restart(){if(!this._isStarted){return this;}for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.restart();}this.onAnimationGroupPlayObservable.notifyObservers(this);return this;}},{key:"stop",value:function stop(){if(!this._isStarted){return this;}var list=this._animatables.slice();for(var index=0;index<list.length;index++){list[index].stop();}this._isStarted=false;return this;}},{key:"setWeightForAllAnimatables",value:function setWeightForAllAnimatables(weight){for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.weight=weight;}return this;}},{key:"syncAllAnimationsWith",value:function syncAllAnimationsWith(root){for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.syncWith(root);}return this;}},{key:"goToFrame",value:function goToFrame(frame){if(!this._isStarted){return this;}for(var index=0;index<this._animatables.length;index++){var animatable=this._animatables[index];animatable.goToFrame(frame);}return this;}},{key:"dispose",value:function dispose(){this._targetedAnimations.length=0;this._animatables.length=0;var index=this._scene.animationGroups.indexOf(this);if(index>-1){this._scene.animationGroups.splice(index,1);}if(this._parentContainer){var index2=this._parentContainer.animationGroups.indexOf(this);if(index2>-1){this._parentContainer.animationGroups.splice(index2,1);}this._parentContainer=null;}this.onAnimationEndObservable.clear();this.onAnimationGroupEndObservable.clear();this.onAnimationGroupPauseObservable.clear();this.onAnimationGroupPlayObservable.clear();this.onAnimationLoopObservable.clear();this.onAnimationGroupLoopObservable.clear();}},{key:"_checkAnimationGroupEnded",value:function _checkAnimationGroupEnded(animatable){var idx=this._animatables.indexOf(animatable);if(idx>-1){this._animatables.splice(idx,1);}if(this._animatables.length===0){this._isStarted=false;this.onAnimationGroupEndObservable.notifyObservers(this);}}},{key:"clone",value:function clone(newName,targetConverter){var cloneAnimations=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var newGroup=new AnimationGroup(newName||this.name,this._scene);var _iterator188=_createForOfIteratorHelper(this._targetedAnimations),_step198;try{for(_iterator188.s();!(_step198=_iterator188.n()).done;){var targetAnimation=_step198.value;newGroup.addTargetedAnimation(cloneAnimations?targetAnimation.animation.clone():targetAnimation.animation,targetConverter?targetConverter(targetAnimation.target):targetAnimation.target);}}catch(err){_iterator188.e(err);}finally{_iterator188.f();}return newGroup;}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.name=this.name;serializationObject.from=this.from;serializationObject.to=this.to;serializationObject.targetedAnimations=[];for(var targetedAnimationIndex=0;targetedAnimationIndex<this.targetedAnimations.length;targetedAnimationIndex++){var targetedAnimation=this.targetedAnimations[targetedAnimationIndex];serializationObject.targetedAnimations[targetedAnimationIndex]=targetedAnimation.serialize();}if(Tags&&Tags.HasTags(this)){serializationObject.tags=Tags.GetTags(this);}if(this.metadata){serializationObject.metadata=this.metadata;}return serializationObject;}},{key:"getClassName",value:function getClassName(){return"AnimationGroup";}},{key:"toString",value:function toString(fullDetails){var ret="Name: "+this.name;ret+=", type: "+this.getClassName();if(fullDetails){ret+=", from: "+this._from;ret+=", to: "+this._to;ret+=", isStarted: "+this._isStarted;ret+=", speedRatio: "+this._speedRatio;ret+=", targetedAnimations length: "+this._targetedAnimations.length;ret+=", animatables length: "+this._animatables;}return ret;}}],[{key:"Parse",value:function Parse(parsedAnimationGroup,scene2){var animationGroup=new AnimationGroup(parsedAnimationGroup.name,scene2);for(var i=0;i<parsedAnimationGroup.targetedAnimations.length;i++){var targetedAnimation=parsedAnimationGroup.targetedAnimations[i];var animation=Animation.Parse(targetedAnimation.animation);var id=targetedAnimation.targetId;if(targetedAnimation.animation.property==="influence"){var morphTarget=scene2.getMorphTargetById(id);if(morphTarget){animationGroup.addTargetedAnimation(animation,morphTarget);}}else{var targetNode=scene2.getNodeById(id);if(targetNode!=null){animationGroup.addTargetedAnimation(animation,targetNode);}}}if(parsedAnimationGroup.from!==null&&parsedAnimationGroup.to!==null){animationGroup.normalize(parsedAnimationGroup.from,parsedAnimationGroup.to);}if(Tags){Tags.AddTagsTo(animationGroup,parsedAnimationGroup.tags);}if(parsedAnimationGroup.metadata!==void 0){animationGroup.metadata=parsedAnimationGroup.metadata;}return animationGroup;}},{key:"MakeAnimationAdditive",value:function MakeAnimationAdditive(sourceAnimationGroup){var referenceFrame=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var range=arguments.length>2?arguments[2]:undefined;var cloneOriginal=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var clonedName=arguments.length>4?arguments[4]:undefined;var animationGroup=sourceAnimationGroup;if(cloneOriginal){animationGroup=sourceAnimationGroup.clone(clonedName||animationGroup.name);}var targetedAnimations=animationGroup.targetedAnimations;for(var index=0;index<targetedAnimations.length;index++){var targetedAnimation=targetedAnimations[index];Animation.MakeAnimationAdditive(targetedAnimation.animation,referenceFrame,range);}animationGroup.isAdditive=true;return animationGroup;}}]);return AnimationGroup;}();// node_modules/@babylonjs/core/Shaders/postprocess.vertex.js
var name61="postprocessVertexShader";var shader61="attribute vec2 position;\nuniform vec2 scale;\nvarying vec2 vUV;\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";ShaderStore.ShadersStore[name61]=shader61;// node_modules/@babylonjs/core/Engines/renderTargetWrapper.js
var RenderTargetWrapper=/*#__PURE__*/function(){function RenderTargetWrapper(isMulti,isCube,size,engine){_classCallCheck(this,RenderTargetWrapper);this._textures=null;this._samples=1;this._attachments=null;this._generateStencilBuffer=false;this._generateDepthBuffer=false;this._depthStencilTextureWithStencil=false;this._isMulti=isMulti;this._isCube=isCube;this._size=size;this._engine=engine;this._depthStencilTexture=null;}_createClass(RenderTargetWrapper,[{key:"depthStencilTexture",get:function get(){return this._depthStencilTexture;}},{key:"depthStencilTextureWithStencil",get:function get(){return this._depthStencilTextureWithStencil;}},{key:"isCube",get:function get(){return this._isCube;}},{key:"isMulti",get:function get(){return this._isMulti;}},{key:"is2DArray",get:function get(){return this.layers>0;}},{key:"size",get:function get(){return this.width;}},{key:"width",get:function get(){return this._size.width||this._size;}},{key:"height",get:function get(){return this._size.height||this._size;}},{key:"layers",get:function get(){return this._size.layers||0;}},{key:"texture",get:function get(){var _a,_b;return(_b=(_a=this._textures)===null||_a===void 0?void 0:_a[0])!==null&&_b!==void 0?_b:null;}},{key:"textures",get:function get(){return this._textures;}},{key:"samples",get:function get(){return this._samples;}},{key:"setSamples",value:function setSamples(value){var initializeBuffers=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(this.samples===value&&!force){return value;}var result=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,value,initializeBuffers):this._engine.updateRenderTargetTextureSampleCount(this,value);this._samples=value;return result;}},{key:"setTextures",value:function setTextures(textures){if(Array.isArray(textures)){this._textures=textures;}else if(textures){this._textures=[textures];}else{this._textures=null;}}},{key:"setTexture",value:function setTexture(texture){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var disposePrevious=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(!this._textures){this._textures=[];}if(this._textures[index]&&disposePrevious){this._textures[index].dispose();}this._textures[index]=texture;}},{key:"createDepthStencilTexture",value:function createDepthStencilTexture(){var comparisonFunction=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var bilinearFiltering=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var generateStencil=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var samples=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var format=arguments.length>4&&arguments[4]!==undefined?arguments[4]:14;var _a;(_a=this._depthStencilTexture)===null||_a===void 0?void 0:_a.dispose();this._depthStencilTextureWithStencil=generateStencil;this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:bilinearFiltering,comparisonFunction:comparisonFunction,generateStencil:generateStencil,isCube:this._isCube,samples:samples,depthTextureFormat:format},this);return this._depthStencilTexture;}},{key:"_shareDepth",value:function _shareDepth(renderTarget){if(this._depthStencilTexture){if(renderTarget._depthStencilTexture){renderTarget._depthStencilTexture.dispose();}renderTarget._depthStencilTexture=this._depthStencilTexture;this._depthStencilTexture.incrementReferences();}}},{key:"_swapAndDie",value:function _swapAndDie(target){if(this.texture){this.texture._swapAndDie(target);}this._textures=null;this.dispose(true);}},{key:"_cloneRenderTargetWrapper",value:function _cloneRenderTargetWrapper(){var _a,_b,_c,_d,_e,_f;var rtw=null;if(this._isMulti){var textureArray=this.textures;if(textureArray&&textureArray.length>0){var generateDepthTexture=false;var textureCount=textureArray.length;var lastTextureSource=textureArray[textureArray.length-1]._source;if(lastTextureSource===InternalTextureSource.Depth||lastTextureSource===InternalTextureSource.DepthStencil){generateDepthTexture=true;textureCount--;}var samplingModes=[];var types=[];for(var i=0;i<textureCount;++i){var texture=textureArray[i];samplingModes.push(texture.samplingMode);types.push(texture.type);}var optionsMRT={samplingModes:samplingModes,generateMipMaps:textureArray[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:generateDepthTexture,types:types,textureCount:textureCount};var size={width:this.width,height:this.height};rtw=this._engine.createMultipleRenderTarget(size,optionsMRT);}}else{var options={};options.generateDepthBuffer=this._generateDepthBuffer;options.generateMipMaps=(_b=(_a=this.texture)===null||_a===void 0?void 0:_a.generateMipMaps)!==null&&_b!==void 0?_b:false;options.generateStencilBuffer=this._generateStencilBuffer;options.samplingMode=(_c=this.texture)===null||_c===void 0?void 0:_c.samplingMode;options.type=(_d=this.texture)===null||_d===void 0?void 0:_d.type;options.format=(_e=this.texture)===null||_e===void 0?void 0:_e.format;if(this.isCube){rtw=this._engine.createRenderTargetCubeTexture(this.width,options);}else{var _size={width:this.width,height:this.height,layers:this.is2DArray?(_f=this.texture)===null||_f===void 0?void 0:_f.depth:void 0};rtw=this._engine.createRenderTargetTexture(_size,options);}rtw.texture.isReady=true;}return rtw;}},{key:"_swapRenderTargetWrapper",value:function _swapRenderTargetWrapper(target){if(this._textures&&target._textures){for(var i=0;i<this._textures.length;++i){this._textures[i]._swapAndDie(target._textures[i],false);target._textures[i].isReady=true;}}if(this._depthStencilTexture&&target._depthStencilTexture){this._depthStencilTexture._swapAndDie(target._depthStencilTexture);target._depthStencilTexture.isReady=true;}this._textures=null;this._depthStencilTexture=null;}},{key:"_rebuild",value:function _rebuild(){var rtw=this._cloneRenderTargetWrapper();if(!rtw){return;}if(this._depthStencilTexture){var samplingMode=this._depthStencilTexture.samplingMode;var bilinear=samplingMode===2||samplingMode===3||samplingMode===11;rtw.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,bilinear,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples);}if(this.samples>1){rtw.setSamples(this.samples);}rtw._swapRenderTargetWrapper(this);rtw.dispose();}},{key:"releaseTextures",value:function releaseTextures(){var _a,_b;if(this._textures){for(var i=0;(_b=i<((_a=this._textures)===null||_a===void 0?void 0:_a.length))!==null&&_b!==void 0?_b:0;++i){this._textures[i].dispose();}}this._textures=null;}},{key:"dispose",value:function dispose(){var disposeOnlyFramebuffers=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var _a;if(!disposeOnlyFramebuffers){(_a=this._depthStencilTexture)===null||_a===void 0?void 0:_a.dispose();this._depthStencilTexture=null;this.releaseTextures();}this._engine._releaseRenderTargetWrapper(this);}}]);return RenderTargetWrapper;}();// node_modules/@babylonjs/core/Engines/WebGL/webGLRenderTargetWrapper.js
var WebGLRenderTargetWrapper=/*#__PURE__*/function(_RenderTargetWrapper){_inherits(WebGLRenderTargetWrapper,_RenderTargetWrapper);var _super51=_createSuper(WebGLRenderTargetWrapper);function WebGLRenderTargetWrapper(isMulti,isCube,size,engine,context){var _this158;_classCallCheck(this,WebGLRenderTargetWrapper);_this158=_super51.call(this,isMulti,isCube,size,engine);_this158._framebuffer=null;_this158._depthStencilBuffer=null;_this158._MSAAFramebuffer=null;_this158._colorTextureArray=null;_this158._depthStencilTextureArray=null;_this158._context=context;return _this158;}_createClass(WebGLRenderTargetWrapper,[{key:"_cloneRenderTargetWrapper",value:function _cloneRenderTargetWrapper(){var rtw=null;if(this._colorTextureArray&&this._depthStencilTextureArray){rtw=this._engine.createMultiviewRenderTargetTexture(this.width,this.height);rtw.texture.isReady=true;}else{rtw=_get(_getPrototypeOf(WebGLRenderTargetWrapper.prototype),"_cloneRenderTargetWrapper",this).call(this);}return rtw;}},{key:"_swapRenderTargetWrapper",value:function _swapRenderTargetWrapper(target){_get(_getPrototypeOf(WebGLRenderTargetWrapper.prototype),"_swapRenderTargetWrapper",this).call(this,target);target._framebuffer=this._framebuffer;target._depthStencilBuffer=this._depthStencilBuffer;target._MSAAFramebuffer=this._MSAAFramebuffer;target._colorTextureArray=this._colorTextureArray;target._depthStencilTextureArray=this._depthStencilTextureArray;this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null;}},{key:"_shareDepth",value:function _shareDepth(renderTarget){_get(_getPrototypeOf(WebGLRenderTargetWrapper.prototype),"_shareDepth",this).call(this,renderTarget);var gl=this._context;var depthbuffer=this._depthStencilBuffer;var framebuffer=renderTarget._MSAAFramebuffer||renderTarget._framebuffer;if(renderTarget._depthStencilBuffer){gl.deleteRenderbuffer(renderTarget._depthStencilBuffer);}renderTarget._depthStencilBuffer=this._depthStencilBuffer;this._engine._bindUnboundFramebuffer(framebuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,depthbuffer);this._engine._bindUnboundFramebuffer(null);}},{key:"_bindTextureRenderTarget",value:function _bindTextureRenderTarget(texture){var attachmentIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var faceIndex=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;var lodLevel=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;if(!texture._hardwareTexture){return;}var gl=this._context;var framebuffer=this._framebuffer;var currentFB=this._engine._currentFramebuffer;this._engine._bindUnboundFramebuffer(framebuffer);var attachment=gl[this._engine.webGLVersion>1?"COLOR_ATTACHMENT"+attachmentIndex:"COLOR_ATTACHMENT"+attachmentIndex+"_WEBGL"];var target=faceIndex!==-1?gl.TEXTURE_CUBE_MAP_POSITIVE_X+faceIndex:gl.TEXTURE_2D;gl.framebufferTexture2D(gl.FRAMEBUFFER,attachment,target,texture._hardwareTexture.underlyingResource,lodLevel);this._engine._bindUnboundFramebuffer(currentFB);}},{key:"setTexture",value:function setTexture(texture){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var disposePrevious=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_get(_getPrototypeOf(WebGLRenderTargetWrapper.prototype),"setTexture",this).call(this,texture,index,disposePrevious);this._bindTextureRenderTarget(texture,index);}},{key:"dispose",value:function dispose(){var disposeOnlyFramebuffers=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var gl=this._context;if(!disposeOnlyFramebuffers){if(this._colorTextureArray){this._context.deleteTexture(this._colorTextureArray);this._colorTextureArray=null;}if(this._depthStencilTextureArray){this._context.deleteTexture(this._depthStencilTextureArray);this._depthStencilTextureArray=null;}}if(this._framebuffer){gl.deleteFramebuffer(this._framebuffer);this._framebuffer=null;}if(this._depthStencilBuffer){gl.deleteRenderbuffer(this._depthStencilBuffer);this._depthStencilBuffer=null;}if(this._MSAAFramebuffer){gl.deleteFramebuffer(this._MSAAFramebuffer);this._MSAAFramebuffer=null;}_get(_getPrototypeOf(WebGLRenderTargetWrapper.prototype),"dispose",this).call(this,disposeOnlyFramebuffers);}}]);return WebGLRenderTargetWrapper;}(RenderTargetWrapper);// node_modules/@babylonjs/core/Engines/Extensions/engine.renderTarget.js
ThinEngine.prototype._createHardwareRenderTargetWrapper=function(isMulti,isCube,size){var rtWrapper=new WebGLRenderTargetWrapper(isMulti,isCube,size,this,this._gl);this._renderTargetWrapperCache.push(rtWrapper);return rtWrapper;};ThinEngine.prototype.createRenderTargetTexture=function(size,options){var _a,_b;var rtWrapper=this._createHardwareRenderTargetWrapper(false,false,size);var generateDepthBuffer=true;var generateStencilBuffer=false;var noColorAttachment=false;var colorAttachment=void 0;var samples=1;if(options!==void 0&&_typeof(options)==="object"){generateDepthBuffer=(_a=options.generateDepthBuffer)!==null&&_a!==void 0?_a:true;generateStencilBuffer=!!options.generateStencilBuffer;noColorAttachment=!!options.noColorAttachment;colorAttachment=options.colorAttachment;samples=(_b=options.samples)!==null&&_b!==void 0?_b:1;}var texture=colorAttachment||(noColorAttachment?null:this._createInternalTexture(size,options,true,InternalTextureSource.RenderTarget));var width=size.width||size;var height=size.height||size;var currentFrameBuffer=this._currentFramebuffer;var gl=this._gl;var framebuffer=gl.createFramebuffer();this._bindUnboundFramebuffer(framebuffer);rtWrapper._depthStencilBuffer=this._setupFramebufferDepthAttachments(generateStencilBuffer,generateDepthBuffer,width,height);if(texture&&!texture.is2DArray){gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,texture._hardwareTexture.underlyingResource,0);}this._bindUnboundFramebuffer(currentFrameBuffer);rtWrapper._framebuffer=framebuffer;rtWrapper._generateDepthBuffer=generateDepthBuffer;rtWrapper._generateStencilBuffer=generateStencilBuffer;rtWrapper.setTextures(texture);this.updateRenderTargetTextureSampleCount(rtWrapper,samples);return rtWrapper;};ThinEngine.prototype.createDepthStencilTexture=function(size,options,rtWrapper){if(options.isCube){var width=size.width||size;return this._createDepthStencilCubeTexture(width,options,rtWrapper);}else{return this._createDepthStencilTexture(size,options,rtWrapper);}};ThinEngine.prototype._createDepthStencilTexture=function(size,options,rtWrapper){var gl=this._gl;var layers=size.layers||0;var target=layers!==0?gl.TEXTURE_2D_ARRAY:gl.TEXTURE_2D;var internalTexture=new InternalTexture(this,InternalTextureSource.DepthStencil);if(!this._caps.depthTextureExtension){Logger.Error("Depth texture is not supported by your browser or hardware.");return internalTexture;}var internalOptions=_objectSpread({bilinearFiltering:false,comparisonFunction:0,generateStencil:false},options);this._bindTextureDirectly(target,internalTexture,true);this._setupDepthStencilTexture(internalTexture,size,internalOptions.generateStencil,internalOptions.comparisonFunction===0?false:internalOptions.bilinearFiltering,internalOptions.comparisonFunction,internalOptions.samples);if(internalOptions.depthTextureFormat!==void 0){if(internalOptions.depthTextureFormat!==15&&internalOptions.depthTextureFormat!==16&&internalOptions.depthTextureFormat!==17&&internalOptions.depthTextureFormat!==13&&internalOptions.depthTextureFormat!==14&&internalOptions.depthTextureFormat!==18){Logger.Error("Depth texture format is not supported.");return internalTexture;}internalTexture.format=internalOptions.depthTextureFormat;}else{internalTexture.format=internalOptions.generateStencil?13:16;}var hasStencil=internalTexture.format===17||internalTexture.format===13||internalTexture.format===18;rtWrapper._depthStencilTexture=internalTexture;rtWrapper._depthStencilTextureWithStencil=hasStencil;var type=gl.UNSIGNED_INT;if(internalTexture.format===15){type=gl.UNSIGNED_SHORT;}else if(internalTexture.format===17||internalTexture.format===13){type=gl.UNSIGNED_INT_24_8;}else if(internalTexture.format===14){type=gl.FLOAT;}else if(internalTexture.format===18){type=gl.FLOAT_32_UNSIGNED_INT_24_8_REV;}var format=hasStencil?gl.DEPTH_STENCIL:gl.DEPTH_COMPONENT;var internalFormat=format;if(this.webGLVersion>1){if(internalTexture.format===15){internalFormat=gl.DEPTH_COMPONENT16;}else if(internalTexture.format===16){internalFormat=gl.DEPTH_COMPONENT24;}else if(internalTexture.format===17||internalTexture.format===13){internalFormat=gl.DEPTH24_STENCIL8;}else if(internalTexture.format===14){internalFormat=gl.DEPTH_COMPONENT32F;}else if(internalTexture.format===18){internalFormat=gl.DEPTH32F_STENCIL8;}}if(internalTexture.is2DArray){gl.texImage3D(target,0,internalFormat,internalTexture.width,internalTexture.height,layers,0,format,type,null);}else{gl.texImage2D(target,0,internalFormat,internalTexture.width,internalTexture.height,0,format,type,null);}this._bindTextureDirectly(target,null);this._internalTexturesCache.push(internalTexture);var glRtWrapper=rtWrapper;if(glRtWrapper._depthStencilBuffer){var currentFrameBuffer=this._currentFramebuffer;this._bindUnboundFramebuffer(glRtWrapper._framebuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,null);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,null);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.STENCIL_ATTACHMENT,gl.RENDERBUFFER,null);this._bindUnboundFramebuffer(currentFrameBuffer);gl.deleteRenderbuffer(glRtWrapper._depthStencilBuffer);glRtWrapper._depthStencilBuffer=null;}return internalTexture;};ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(rtWrapper,samples){if(this.webGLVersion<2||!rtWrapper||!rtWrapper.texture){return 1;}if(rtWrapper.samples===samples){return samples;}var gl=this._gl;samples=Math.min(samples,this.getCaps().maxMSAASamples);if(rtWrapper._depthStencilBuffer){gl.deleteRenderbuffer(rtWrapper._depthStencilBuffer);rtWrapper._depthStencilBuffer=null;}if(rtWrapper._MSAAFramebuffer){gl.deleteFramebuffer(rtWrapper._MSAAFramebuffer);rtWrapper._MSAAFramebuffer=null;}var hardwareTexture=rtWrapper.texture._hardwareTexture;if(hardwareTexture._MSAARenderBuffer){gl.deleteRenderbuffer(hardwareTexture._MSAARenderBuffer);hardwareTexture._MSAARenderBuffer=null;}if(samples>1&&typeof gl.renderbufferStorageMultisample==="function"){var framebuffer=gl.createFramebuffer();if(!framebuffer){throw new Error("Unable to create multi sampled framebuffer");}rtWrapper._MSAAFramebuffer=framebuffer;this._bindUnboundFramebuffer(rtWrapper._MSAAFramebuffer);var colorRenderbuffer=this._createRenderBuffer(rtWrapper.texture.width,rtWrapper.texture.height,samples,-1,this._getRGBAMultiSampleBufferFormat(rtWrapper.texture.type),gl.COLOR_ATTACHMENT0,false);if(!colorRenderbuffer){throw new Error("Unable to create multi sampled framebuffer");}hardwareTexture._MSAARenderBuffer=colorRenderbuffer;}else{this._bindUnboundFramebuffer(rtWrapper._framebuffer);}rtWrapper.texture.samples=samples;rtWrapper._samples=samples;rtWrapper._depthStencilBuffer=this._setupFramebufferDepthAttachments(rtWrapper._generateStencilBuffer,rtWrapper._generateDepthBuffer,rtWrapper.texture.width,rtWrapper.texture.height,samples);this._bindUnboundFramebuffer(null);return samples;};// node_modules/@babylonjs/core/PostProcesses/postProcess.js
var PostProcess=/*#__PURE__*/function(){function PostProcess(name135,fragmentUrl,parameters,samplers,options,camera){var samplingMode=arguments.length>6&&arguments[6]!==undefined?arguments[6]:1;var engine=arguments.length>7?arguments[7]:undefined;var reusable=arguments.length>8?arguments[8]:undefined;var defines=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;var textureType=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var vertexUrl=arguments.length>11&&arguments[11]!==undefined?arguments[11]:"postprocess";var indexParameters=arguments.length>12?arguments[12]:undefined;var blockCompilation=arguments.length>13&&arguments[13]!==undefined?arguments[13]:false;var textureFormat=arguments.length>14&&arguments[14]!==undefined?arguments[14]:5;var shaderLanguage=arguments.length>15&&arguments[15]!==undefined?arguments[15]:ShaderLanguage.GLSL;_classCallCheck(this,PostProcess);this._parentContainer=null;this.width=-1;this.height=-1;this.nodeMaterialSource=null;this._outputTexture=null;this.autoClear=true;this.alphaMode=0;this.animations=new Array();this.enablePixelPerfectMode=false;this.forceFullscreenViewport=true;this.scaleMode=1;this.alwaysForcePOT=false;this._samples=1;this.adaptScaleToCurrentViewport=false;this._reusable=false;this._renderId=0;this.externalTextureSamplerBinding=false;this._textures=new SmartArray(2);this._textureCache=[];this._currentRenderTextureInd=0;this._scaleRatio=new Vector2(1,1);this._texelSize=Vector2.Zero();this.onActivateObservable=new Observable();this.onSizeChangedObservable=new Observable();this.onApplyObservable=new Observable();this.onBeforeRenderObservable=new Observable();this.onAfterRenderObservable=new Observable();this.name=name135;if(camera!=null){this._camera=camera;this._scene=camera.getScene();camera.attachPostProcess(this);this._engine=this._scene.getEngine();this._scene.postProcesses.push(this);this.uniqueId=this._scene.getUniqueId();}else if(engine){this._engine=engine;this._engine.postProcesses.push(this);}this._options=options;this.renderTargetSamplingMode=samplingMode?samplingMode:1;this._reusable=reusable||false;this._textureType=textureType;this._textureFormat=textureFormat;this._shaderLanguage=shaderLanguage;this._samplers=samplers||[];this._samplers.push("textureSampler");this._fragmentUrl=fragmentUrl;this._vertexUrl=vertexUrl;this._parameters=parameters||[];this._parameters.push("scale");this._indexParameters=indexParameters;this._drawWrapper=new DrawWrapper(this._engine);if(!blockCompilation){this.updateEffect(defines);}}_createClass(PostProcess,[{key:"samples",get:function get(){return this._samples;},set:function set(n){var _this159=this;this._samples=Math.min(n,this._engine.getCaps().maxMSAASamples);this._textures.forEach(function(texture){texture.setSamples(_this159._samples);});}},{key:"getEffectName",value:function getEffectName(){return this._fragmentUrl;}},{key:"onActivate",set:function set(callback){if(this._onActivateObserver){this.onActivateObservable.remove(this._onActivateObserver);}if(callback){this._onActivateObserver=this.onActivateObservable.add(callback);}}},{key:"onSizeChanged",set:function set(callback){if(this._onSizeChangedObserver){this.onSizeChangedObservable.remove(this._onSizeChangedObserver);}this._onSizeChangedObserver=this.onSizeChangedObservable.add(callback);}},{key:"onApply",set:function set(callback){if(this._onApplyObserver){this.onApplyObservable.remove(this._onApplyObserver);}this._onApplyObserver=this.onApplyObservable.add(callback);}},{key:"onBeforeRender",set:function set(callback){if(this._onBeforeRenderObserver){this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);}this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback);}},{key:"onAfterRender",set:function set(callback){if(this._onAfterRenderObserver){this.onAfterRenderObservable.remove(this._onAfterRenderObserver);}this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback);}},{key:"inputTexture",get:function get(){return this._textures.data[this._currentRenderTextureInd];},set:function set(value){this._forcedOutputTexture=value;}},{key:"restoreDefaultInputTexture",value:function restoreDefaultInputTexture(){if(this._forcedOutputTexture){this._forcedOutputTexture=null;this.markTextureDirty();}}},{key:"getCamera",value:function getCamera(){return this._camera;}},{key:"texelSize",get:function get(){if(this._shareOutputWithPostProcess){return this._shareOutputWithPostProcess.texelSize;}if(this._forcedOutputTexture){this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height);}return this._texelSize;}},{key:"getClassName",value:function getClassName(){return"PostProcess";}},{key:"getEngine",value:function getEngine(){return this._engine;}},{key:"getEffect",value:function getEffect(){return this._drawWrapper.effect;}},{key:"shareOutputWith",value:function shareOutputWith(postProcess){this._disposeTextures();this._shareOutputWithPostProcess=postProcess;return this;}},{key:"useOwnOutput",value:function useOwnOutput(){if(this._textures.length==0){this._textures=new SmartArray(2);}this._shareOutputWithPostProcess=null;}},{key:"updateEffect",value:function updateEffect(){var _this160=this;var defines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var uniforms=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var samplers=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var indexParameters=arguments.length>3?arguments[3]:undefined;var onCompiled=arguments.length>4?arguments[4]:undefined;var onError=arguments.length>5?arguments[5]:undefined;var vertexUrl=arguments.length>6?arguments[6]:undefined;var fragmentUrl=arguments.length>7?arguments[7]:undefined;var _a,_b;var customShaderCodeProcessing=PostProcess._GetShaderCodeProcessing(this.name);if(customShaderCodeProcessing===null||customShaderCodeProcessing===void 0?void 0:customShaderCodeProcessing.defineCustomBindings){var newUniforms=(_a=uniforms===null||uniforms===void 0?void 0:uniforms.slice())!==null&&_a!==void 0?_a:[];newUniforms.push.apply(newUniforms,_toConsumableArray(this._parameters));var newSamplers=(_b=samplers===null||samplers===void 0?void 0:samplers.slice())!==null&&_b!==void 0?_b:[];newSamplers.push.apply(newSamplers,_toConsumableArray(this._samplers));defines=customShaderCodeProcessing.defineCustomBindings(this.name,defines,newUniforms,newSamplers);uniforms=newUniforms;samplers=newSamplers;}this._postProcessDefines=defines;this._drawWrapper.effect=this._engine.createEffect({vertex:vertexUrl!==null&&vertexUrl!==void 0?vertexUrl:this._vertexUrl,fragment:fragmentUrl!==null&&fragmentUrl!==void 0?fragmentUrl:this._fragmentUrl},{attributes:["position"],uniformsNames:uniforms||this._parameters,uniformBuffersNames:[],samplers:samplers||this._samplers,defines:defines!==null?defines:"",fallbacks:null,onCompiled:onCompiled!==null&&onCompiled!==void 0?onCompiled:null,onError:onError!==null&&onError!==void 0?onError:null,indexParameters:indexParameters||this._indexParameters,processCodeAfterIncludes:(customShaderCodeProcessing===null||customShaderCodeProcessing===void 0?void 0:customShaderCodeProcessing.processCodeAfterIncludes)?function(shaderType,code){return customShaderCodeProcessing.processCodeAfterIncludes(_this160.name,shaderType,code);}:null,processFinalCode:(customShaderCodeProcessing===null||customShaderCodeProcessing===void 0?void 0:customShaderCodeProcessing.processFinalCode)?function(shaderType,code){return customShaderCodeProcessing.processFinalCode(_this160.name,shaderType,code);}:null,shaderLanguage:this._shaderLanguage},this._engine);}},{key:"isReusable",value:function isReusable(){return this._reusable;}},{key:"markTextureDirty",value:function markTextureDirty(){this.width=-1;}},{key:"_createRenderTargetTexture",value:function _createRenderTargetTexture(textureSize,textureOptions){var channel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;for(var i=0;i<this._textureCache.length;i++){if(this._textureCache[i].texture.width===textureSize.width&&this._textureCache[i].texture.height===textureSize.height&&this._textureCache[i].postProcessChannel===channel&&this._textureCache[i].texture._generateDepthBuffer===textureOptions.generateDepthBuffer&&this._textureCache[i].texture.samples===textureOptions.samples){return this._textureCache[i].texture;}}var tex=this._engine.createRenderTargetTexture(textureSize,textureOptions);this._textureCache.push({texture:tex,postProcessChannel:channel,lastUsedRenderId:-1});return tex;}},{key:"_flushTextureCache",value:function _flushTextureCache(){var currentRenderId=this._renderId;for(var i=this._textureCache.length-1;i>=0;i--){if(currentRenderId-this._textureCache[i].lastUsedRenderId>100){var currentlyUsed=false;for(var j=0;j<this._textures.length;j++){if(this._textures.data[j]===this._textureCache[i].texture){currentlyUsed=true;break;}}if(!currentlyUsed){this._textureCache[i].texture.dispose();this._textureCache.splice(i,1);}}}}},{key:"_resize",value:function _resize(width,height,camera,needMipMaps,forceDepthStencil){if(this._textures.length>0){this._textures.reset();}this.width=width;this.height=height;var firstPP=null;for(var i=0;i<camera._postProcesses.length;i++){if(camera._postProcesses[i]!==null){firstPP=camera._postProcesses[i];break;}}var textureSize={width:this.width,height:this.height};var textureOptions={generateMipMaps:needMipMaps,generateDepthBuffer:forceDepthStencil||firstPP===this,generateStencilBuffer:(forceDepthStencil||firstPP===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples};this._textures.push(this._createRenderTargetTexture(textureSize,textureOptions,0));if(this._reusable){this._textures.push(this._createRenderTargetTexture(textureSize,textureOptions,1));}this._texelSize.copyFromFloats(1/this.width,1/this.height);this.onSizeChangedObservable.notifyObservers(this);}},{key:"activate",value:function activate(camera){var _this161=this;var sourceTexture=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var forceDepthStencil=arguments.length>2?arguments[2]:undefined;var _a,_b;camera=camera||this._camera;var scene2=camera.getScene();var engine=scene2.getEngine();var maxSize=engine.getCaps().maxTextureSize;var requiredWidth=(sourceTexture?sourceTexture.width:this._engine.getRenderWidth(true))*this._options|0;var requiredHeight=(sourceTexture?sourceTexture.height:this._engine.getRenderHeight(true))*this._options|0;var webVRCamera=camera.parent;if(webVRCamera&&(webVRCamera.leftCamera==camera||webVRCamera.rightCamera==camera)){requiredWidth/=2;}var desiredWidth=this._options.width||requiredWidth;var desiredHeight=this._options.height||requiredHeight;var needMipMaps=this.renderTargetSamplingMode!==7&&this.renderTargetSamplingMode!==1&&this.renderTargetSamplingMode!==2;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var currentViewport=engine.currentViewport;if(currentViewport){desiredWidth*=currentViewport.width;desiredHeight*=currentViewport.height;}}if(needMipMaps||this.alwaysForcePOT){if(!this._options.width){desiredWidth=engine.needPOTTextures?Engine.GetExponentOfTwo(desiredWidth,maxSize,this.scaleMode):desiredWidth;}if(!this._options.height){desiredHeight=engine.needPOTTextures?Engine.GetExponentOfTwo(desiredHeight,maxSize,this.scaleMode):desiredHeight;}}if(this.width!==desiredWidth||this.height!==desiredHeight){this._resize(desiredWidth,desiredHeight,camera,needMipMaps,forceDepthStencil);}this._textures.forEach(function(texture){if(texture.samples!==_this161.samples){_this161._engine.updateRenderTargetTextureSampleCount(texture,_this161.samples);}});this._flushTextureCache();this._renderId++;}var target;if(this._shareOutputWithPostProcess){target=this._shareOutputWithPostProcess.inputTexture;}else if(this._forcedOutputTexture){target=this._forcedOutputTexture;this.width=this._forcedOutputTexture.width;this.height=this._forcedOutputTexture.height;}else{target=this.inputTexture;var cache;for(var i=0;i<this._textureCache.length;i++){if(this._textureCache[i].texture===target){cache=this._textureCache[i];break;}}if(cache){cache.lastUsedRenderId=this._renderId;}}if(this.enablePixelPerfectMode){this._scaleRatio.copyFromFloats(requiredWidth/desiredWidth,requiredHeight/desiredHeight);this._engine.bindFramebuffer(target,0,requiredWidth,requiredHeight,this.forceFullscreenViewport);}else{this._scaleRatio.copyFromFloats(1,1);this._engine.bindFramebuffer(target,0,void 0,void 0,this.forceFullscreenViewport);}(_b=(_a=this._engine)._debugInsertMarker)===null||_b===void 0?void 0:_b.call(_a,"post process ".concat(this.name," input"));this.onActivateObservable.notifyObservers(camera);if(this.autoClear&&this.alphaMode===0){this._engine.clear(this.clearColor?this.clearColor:scene2.clearColor,scene2._allowPostProcessClearColor,true,true);}if(this._reusable){this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2;}return target;}},{key:"isSupported",get:function get(){return this._drawWrapper.effect.isSupported;}},{key:"aspectRatio",get:function get(){if(this._shareOutputWithPostProcess){return this._shareOutputWithPostProcess.aspectRatio;}if(this._forcedOutputTexture){return this._forcedOutputTexture.width/this._forcedOutputTexture.height;}return this.width/this.height;}},{key:"isReady",value:function isReady(){var _a,_b;return(_b=(_a=this._drawWrapper.effect)===null||_a===void 0?void 0:_a.isReady())!==null&&_b!==void 0?_b:false;}},{key:"apply",value:function apply(){var _a,_b,_c;if(!((_a=this._drawWrapper.effect)===null||_a===void 0?void 0:_a.isReady())){return null;}this._engine.enableEffect(this._drawWrapper);this._engine.setState(false);this._engine.setDepthBuffer(false);this._engine.setDepthWrite(false);this._engine.setAlphaMode(this.alphaMode);if(this.alphaConstants){this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);}var source;if(this._shareOutputWithPostProcess){source=this._shareOutputWithPostProcess.inputTexture;}else if(this._forcedOutputTexture){source=this._forcedOutputTexture;}else{source=this.inputTexture;}if(!this.externalTextureSamplerBinding){this._drawWrapper.effect._bindTexture("textureSampler",source===null||source===void 0?void 0:source.texture);}this._drawWrapper.effect.setVector2("scale",this._scaleRatio);this.onApplyObservable.notifyObservers(this._drawWrapper.effect);(_c=(_b=PostProcess._GetShaderCodeProcessing(this.name))===null||_b===void 0?void 0:_b.bindCustomBindings)===null||_c===void 0?void 0:_c.call(_b,this.name,this._drawWrapper.effect);return this._drawWrapper.effect;}},{key:"_disposeTextures",value:function _disposeTextures(){if(this._shareOutputWithPostProcess||this._forcedOutputTexture){this._disposeTextureCache();return;}this._disposeTextureCache();this._textures.dispose();}},{key:"_disposeTextureCache",value:function _disposeTextureCache(){for(var i=this._textureCache.length-1;i>=0;i--){this._textureCache[i].texture.dispose();}this._textureCache.length=0;}},{key:"setPrePassRenderer",value:function setPrePassRenderer(prePassRenderer){if(this._prePassEffectConfiguration){this._prePassEffectConfiguration=prePassRenderer.addEffectConfiguration(this._prePassEffectConfiguration);this._prePassEffectConfiguration.enabled=true;return true;}return false;}},{key:"dispose",value:function dispose(camera){camera=camera||this._camera;this._disposeTextures();var index;if(this._scene){index=this._scene.postProcesses.indexOf(this);if(index!==-1){this._scene.postProcesses.splice(index,1);}}if(this._parentContainer){var index2=this._parentContainer.postProcesses.indexOf(this);if(index2>-1){this._parentContainer.postProcesses.splice(index2,1);}this._parentContainer=null;}index=this._engine.postProcesses.indexOf(this);if(index!==-1){this._engine.postProcesses.splice(index,1);}if(!camera){return;}camera.detachPostProcess(this);index=camera._postProcesses.indexOf(this);if(index===0&&camera._postProcesses.length>0){var firstPostProcess=this._camera._getFirstPostProcess();if(firstPostProcess){firstPostProcess.markTextureDirty();}}this.onActivateObservable.clear();this.onAfterRenderObservable.clear();this.onApplyObservable.clear();this.onBeforeRenderObservable.clear();this.onSizeChangedObservable.clear();}},{key:"serialize",value:function serialize(){var serializationObject=SerializationHelper.Serialize(this);var camera=this.getCamera()||this._scene&&this._scene.activeCamera;serializationObject.customType="BABYLON."+this.getClassName();serializationObject.cameraId=camera?camera.id:null;serializationObject.reusable=this._reusable;serializationObject.textureType=this._textureType;serializationObject.fragmentUrl=this._fragmentUrl;serializationObject.parameters=this._parameters;serializationObject.samplers=this._samplers;serializationObject.options=this._options;serializationObject.defines=this._postProcessDefines;serializationObject.textureFormat=this._textureFormat;serializationObject.vertexUrl=this._vertexUrl;serializationObject.indexParameters=this._indexParameters;return serializationObject;}},{key:"clone",value:function clone(){var serializationObject=this.serialize();serializationObject._engine=this._engine;serializationObject.cameraId=null;var result=PostProcess.Parse(serializationObject,this._scene,"");if(!result){return null;}result.onActivateObservable=this.onActivateObservable.clone();result.onSizeChangedObservable=this.onSizeChangedObservable.clone();result.onApplyObservable=this.onApplyObservable.clone();result.onBeforeRenderObservable=this.onBeforeRenderObservable.clone();result.onAfterRenderObservable=this.onAfterRenderObservable.clone();result._prePassEffectConfiguration=this._prePassEffectConfiguration;return result;}}],[{key:"RegisterShaderCodeProcessing",value:function RegisterShaderCodeProcessing(postProcessName,customShaderCodeProcessing){if(!customShaderCodeProcessing){delete PostProcess._CustomShaderCodeProcessing[postProcessName!==null&&postProcessName!==void 0?postProcessName:""];return;}PostProcess._CustomShaderCodeProcessing[postProcessName!==null&&postProcessName!==void 0?postProcessName:""]=customShaderCodeProcessing;}},{key:"_GetShaderCodeProcessing",value:function _GetShaderCodeProcessing(postProcessName){var _a;return(_a=PostProcess._CustomShaderCodeProcessing[postProcessName])!==null&&_a!==void 0?_a:PostProcess._CustomShaderCodeProcessing[""];}},{key:"Parse",value:function Parse(parsedPostProcess,scene2,rootUrl){var postProcessType=GetClass(parsedPostProcess.customType);if(!postProcessType||!postProcessType._Parse){return null;}var camera=scene2?scene2.getCameraById(parsedPostProcess.cameraId):null;return postProcessType._Parse(parsedPostProcess,camera,scene2,rootUrl);}},{key:"_Parse",value:function _Parse(parsedPostProcess,targetCamera,scene2,rootUrl){return SerializationHelper.Parse(function(){return new PostProcess(parsedPostProcess.name,parsedPostProcess.fragmentUrl,parsedPostProcess.parameters,parsedPostProcess.samplers,parsedPostProcess.options,targetCamera,parsedPostProcess.renderTargetSamplingMode,parsedPostProcess._engine,parsedPostProcess.reusable,parsedPostProcess.defines,parsedPostProcess.textureType,parsedPostProcess.vertexUrl,parsedPostProcess.indexParameters,false,parsedPostProcess.textureFormat);},parsedPostProcess,scene2,rootUrl);}}]);return PostProcess;}();PostProcess._CustomShaderCodeProcessing={};__decorate([serialize()],PostProcess.prototype,"uniqueId",void 0);__decorate([serialize()],PostProcess.prototype,"name",void 0);__decorate([serialize()],PostProcess.prototype,"width",void 0);__decorate([serialize()],PostProcess.prototype,"height",void 0);__decorate([serialize()],PostProcess.prototype,"renderTargetSamplingMode",void 0);__decorate([serializeAsColor4()],PostProcess.prototype,"clearColor",void 0);__decorate([serialize()],PostProcess.prototype,"autoClear",void 0);__decorate([serialize()],PostProcess.prototype,"alphaMode",void 0);__decorate([serialize()],PostProcess.prototype,"alphaConstants",void 0);__decorate([serialize()],PostProcess.prototype,"enablePixelPerfectMode",void 0);__decorate([serialize()],PostProcess.prototype,"forceFullscreenViewport",void 0);__decorate([serialize()],PostProcess.prototype,"scaleMode",void 0);__decorate([serialize()],PostProcess.prototype,"alwaysForcePOT",void 0);__decorate([serialize("samples")],PostProcess.prototype,"_samples",void 0);__decorate([serialize()],PostProcess.prototype,"adaptScaleToCurrentViewport",void 0);RegisterClass("BABYLON.PostProcess",PostProcess);// node_modules/@babylonjs/core/Shaders/rgbdDecode.fragment.js
var name62="rgbdDecodePixelShader";var shader62="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=vec4(fromRGBD(texture2D(textureSampler,vUV)),1.0);\n}";ShaderStore.ShadersStore[name62]=shader62;// node_modules/@babylonjs/core/Engines/Extensions/engine.renderTargetCube.js
ThinEngine.prototype.createRenderTargetCubeTexture=function(size,options){var rtWrapper=this._createHardwareRenderTargetWrapper(false,true,size);var fullOptions=_objectSpread({generateMipMaps:true,generateDepthBuffer:true,generateStencilBuffer:false,type:0,samplingMode:3,format:5},options);fullOptions.generateStencilBuffer=fullOptions.generateDepthBuffer&&fullOptions.generateStencilBuffer;if(fullOptions.type===1&&!this._caps.textureFloatLinearFiltering){fullOptions.samplingMode=1;}else if(fullOptions.type===2&&!this._caps.textureHalfFloatLinearFiltering){fullOptions.samplingMode=1;}var gl=this._gl;var texture=new InternalTexture(this,InternalTextureSource.RenderTarget);this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);var filters2=this._getSamplingParameters(fullOptions.samplingMode,fullOptions.generateMipMaps);if(fullOptions.type===1&&!this._caps.textureFloat){fullOptions.type=0;Logger.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type");}gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,filters2.mag);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,filters2.min);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);for(var face=0;face<6;face++){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+face,0,this._getRGBABufferInternalSizedFormat(fullOptions.type,fullOptions.format),size,size,0,this._getInternalFormat(fullOptions.format),this._getWebGLTextureType(fullOptions.type),null);}var framebuffer=gl.createFramebuffer();this._bindUnboundFramebuffer(framebuffer);rtWrapper._depthStencilBuffer=this._setupFramebufferDepthAttachments(fullOptions.generateStencilBuffer,fullOptions.generateDepthBuffer,size,size);if(fullOptions.generateMipMaps){gl.generateMipmap(gl.TEXTURE_CUBE_MAP);}this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);this._bindUnboundFramebuffer(null);rtWrapper._framebuffer=framebuffer;rtWrapper._generateDepthBuffer=fullOptions.generateDepthBuffer;rtWrapper._generateStencilBuffer=fullOptions.generateStencilBuffer;texture.width=size;texture.height=size;texture.isReady=true;texture.isCube=true;texture.samples=1;texture.generateMipMaps=fullOptions.generateMipMaps;texture.samplingMode=fullOptions.samplingMode;texture.type=fullOptions.type;texture.format=fullOptions.format;this._internalTexturesCache.push(texture);rtWrapper.setTextures(texture);return rtWrapper;};// node_modules/@babylonjs/core/Materials/effectRenderer.js
var defaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};var EffectRenderer=/*#__PURE__*/function(){function EffectRenderer(engine){var _this162=this;var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:defaultOptions;_classCallCheck(this,EffectRenderer);var _a,_b;this._fullscreenViewport=new Viewport(0,0,1,1);var positions=(_a=options.positions)!==null&&_a!==void 0?_a:defaultOptions.positions;var indices=(_b=options.indices)!==null&&_b!==void 0?_b:defaultOptions.indices;this.engine=engine;this._vertexBuffers=_defineProperty({},VertexBuffer.PositionKind,new VertexBuffer(engine,positions,VertexBuffer.PositionKind,false,false,2));this._indexBuffer=engine.createIndexBuffer(indices);this._onContextRestoredObserver=engine.onContextRestoredObservable.add(function(){_this162._indexBuffer=engine.createIndexBuffer(indices);for(var key in _this162._vertexBuffers){var vertexBuffer=_this162._vertexBuffers[key];vertexBuffer._rebuild();}});}_createClass(EffectRenderer,[{key:"setViewport",value:function setViewport(){var viewport=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this._fullscreenViewport;this.engine.setViewport(viewport);}},{key:"bindBuffers",value:function bindBuffers(effect){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,effect);}},{key:"applyEffectWrapper",value:function applyEffectWrapper(effectWrapper){this.engine.setState(true);this.engine.depthCullingState.depthTest=false;this.engine.stencilState.stencilTest=false;this.engine.enableEffect(effectWrapper._drawWrapper);this.bindBuffers(effectWrapper.effect);effectWrapper.onApplyObservable.notifyObservers({});}},{key:"restoreStates",value:function restoreStates(){this.engine.depthCullingState.depthTest=true;this.engine.stencilState.stencilTest=true;}},{key:"draw",value:function draw(){this.engine.drawElementsType(0,0,6);}},{key:"_isRenderTargetTexture",value:function _isRenderTargetTexture(texture){return texture.renderTarget!==void 0;}},{key:"render",value:function render(effectWrapper){var outputTexture=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;if(!effectWrapper.effect.isReady()){return;}this.setViewport();var out=outputTexture===null?null:this._isRenderTargetTexture(outputTexture)?outputTexture.renderTarget:outputTexture;if(out){this.engine.bindFramebuffer(out);}this.applyEffectWrapper(effectWrapper);this.draw();if(out){this.engine.unBindFramebuffer(out);}this.restoreStates();}},{key:"dispose",value:function dispose(){var vertexBuffer=this._vertexBuffers[VertexBuffer.PositionKind];if(vertexBuffer){vertexBuffer.dispose();delete this._vertexBuffers[VertexBuffer.PositionKind];}if(this._indexBuffer){this.engine._releaseBuffer(this._indexBuffer);}if(this._onContextRestoredObserver){this.engine.onContextRestoredObservable.remove(this._onContextRestoredObserver);this._onContextRestoredObserver=null;}}}]);return EffectRenderer;}();var EffectWrapper=/*#__PURE__*/function(){function EffectWrapper(creationOptions){var _this163=this;_classCallCheck(this,EffectWrapper);this.onApplyObservable=new Observable();var effectCreationOptions;var uniformNames=creationOptions.uniformNames||[];if(creationOptions.vertexShader){effectCreationOptions={fragmentSource:creationOptions.fragmentShader,vertexSource:creationOptions.vertexShader,spectorName:creationOptions.name||"effectWrapper"};}else{uniformNames.push("scale");effectCreationOptions={fragmentSource:creationOptions.fragmentShader,vertex:"postprocess",spectorName:creationOptions.name||"effectWrapper"};this.onApplyObservable.add(function(){_this163.effect.setFloat2("scale",1,1);});}var defines=creationOptions.defines?creationOptions.defines.join("\n"):"";this._drawWrapper=new DrawWrapper(creationOptions.engine);if(creationOptions.useShaderStore){effectCreationOptions.fragment=effectCreationOptions.fragmentSource;if(!effectCreationOptions.vertex){effectCreationOptions.vertex=effectCreationOptions.vertexSource;}delete effectCreationOptions.fragmentSource;delete effectCreationOptions.vertexSource;this.effect=creationOptions.engine.createEffect(effectCreationOptions,creationOptions.attributeNames||["position"],uniformNames,creationOptions.samplerNames,defines,void 0,creationOptions.onCompiled,void 0,void 0,creationOptions.shaderLanguage);}else{this.effect=new Effect(effectCreationOptions,creationOptions.attributeNames||["position"],uniformNames,creationOptions.samplerNames,creationOptions.engine,defines,void 0,creationOptions.onCompiled,void 0,void 0,void 0,creationOptions.shaderLanguage);this._onContextRestoredObserver=creationOptions.engine.onContextRestoredObservable.add(function(){_this163.effect._pipelineContext=null;_this163.effect._wasPreviouslyReady=false;_this163.effect._prepareEffect();});}}_createClass(EffectWrapper,[{key:"effect",get:function get(){return this._drawWrapper.effect;},set:function set(effect){this._drawWrapper.effect=effect;}},{key:"dispose",value:function dispose(){if(this._onContextRestoredObserver){this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver);this._onContextRestoredObserver=null;}this.effect.dispose();}}]);return EffectWrapper;}();// node_modules/@babylonjs/core/Shaders/pass.fragment.js
var name63="passPixelShader";var shader63="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=texture2D(textureSampler,vUV);\n}";ShaderStore.ShadersStore[name63]=shader63;var passPixelShader={name:name63,shader:shader63};// node_modules/@babylonjs/core/Misc/dumpTools.js
var DumpTools=/*#__PURE__*/function(){function DumpTools(){_classCallCheck(this,DumpTools);}_createClass(DumpTools,null,[{key:"_CreateDumpRenderer",value:function _CreateDumpRenderer(){if(!DumpTools._DumpToolsEngine){var canvas=document.createElement("canvas");var engine=new ThinEngine(canvas,false,{preserveDrawingBuffer:true,depth:false,stencil:false,alpha:true,premultipliedAlpha:false,antialias:false,failIfMajorPerformanceCaveat:false});engine.getCaps().parallelShaderCompile=void 0;var renderer=new EffectRenderer(engine);var wrapper=new EffectWrapper({engine:engine,name:passPixelShader.name,fragmentShader:passPixelShader.shader,samplerNames:["textureSampler"]});DumpTools._DumpToolsEngine={canvas:canvas,engine:engine,renderer:renderer,wrapper:wrapper};}return DumpTools._DumpToolsEngine;}},{key:"DumpFramebuffer",value:function(){var _DumpFramebuffer2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6(width,height,engine,successCallback){var mimeType,fileName,bufferView,data,_args7=arguments;return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:mimeType=_args7.length>4&&_args7[4]!==undefined?_args7[4]:"image/png";fileName=_args7.length>5?_args7[5]:undefined;_context6.next=4;return engine.readPixels(0,0,width,height);case 4:bufferView=_context6.sent;data=new Uint8Array(bufferView.buffer);DumpTools.DumpData(width,height,data,successCallback,mimeType,fileName,true);case 7:case"end":return _context6.stop();}},_callee6);}));function DumpFramebuffer(_x9,_x10,_x11,_x12){return _DumpFramebuffer2.apply(this,arguments);}return DumpFramebuffer;}()},{key:"DumpDataAsync",value:function DumpDataAsync(width,height,data){var mimeType=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"image/png";var fileName=arguments.length>4?arguments[4]:undefined;var invertY=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var toArrayBuffer=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var quality=arguments.length>7?arguments[7]:undefined;return new Promise(function(resolve){DumpTools.DumpData(width,height,data,function(result){return resolve(result);},mimeType,fileName,invertY,toArrayBuffer,quality);});}},{key:"DumpData",value:function DumpData(width,height,data,successCallback){var mimeType=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"image/png";var fileName=arguments.length>5?arguments[5]:undefined;var invertY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var toArrayBuffer=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var quality=arguments.length>8?arguments[8]:undefined;var renderer=DumpTools._CreateDumpRenderer();renderer.engine.setSize(width,height,true);if(data instanceof Float32Array){var data2=new Uint8Array(data.length);var n=data.length;while(n--){var v=data[n];data2[n]=v<0?0:v>1?1:Math.round(v*255);}data=data2;}var texture=renderer.engine.createRawTexture(data,width,height,5,false,!invertY,1);renderer.renderer.setViewport();renderer.renderer.applyEffectWrapper(renderer.wrapper);renderer.wrapper.effect._bindTexture("textureSampler",texture);renderer.renderer.draw();if(toArrayBuffer){Tools.ToBlob(renderer.canvas,function(blob){var fileReader=new FileReader();fileReader.onload=function(event){var arrayBuffer=event.target.result;if(successCallback){successCallback(arrayBuffer);}};fileReader.readAsArrayBuffer(blob);},mimeType,quality);}else{Tools.EncodeScreenshotCanvasData(renderer.canvas,successCallback,mimeType,fileName,quality);}texture.dispose();}},{key:"Dispose",value:function Dispose(){if(DumpTools._DumpToolsEngine){DumpTools._DumpToolsEngine.wrapper.dispose();DumpTools._DumpToolsEngine.renderer.dispose();DumpTools._DumpToolsEngine.engine.dispose();}DumpTools._DumpToolsEngine=null;}}]);return DumpTools;}();var initSideEffects2=function initSideEffects2(){Tools.DumpData=DumpTools.DumpData;Tools.DumpDataAsync=DumpTools.DumpDataAsync;Tools.DumpFramebuffer=DumpTools.DumpFramebuffer;};initSideEffects2();// node_modules/@babylonjs/core/Materials/Textures/renderTargetTexture.js
var RenderTargetTexture=/*#__PURE__*/function(_Texture2){_inherits(RenderTargetTexture,_Texture2);var _super52=_createSuper(RenderTargetTexture);function RenderTargetTexture(name135,size,scene2){var _this164;var generateMipMaps=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var doNotChangeAspectRatio=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var type=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var isCube=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var samplingMode=arguments.length>7&&arguments[7]!==undefined?arguments[7]:Texture.TRILINEAR_SAMPLINGMODE;var generateDepthBuffer=arguments.length>8&&arguments[8]!==undefined?arguments[8]:true;var generateStencilBuffer=arguments.length>9&&arguments[9]!==undefined?arguments[9]:false;var isMulti=arguments.length>10&&arguments[10]!==undefined?arguments[10]:false;var format=arguments.length>11&&arguments[11]!==undefined?arguments[11]:5;var delayAllocation=arguments.length>12&&arguments[12]!==undefined?arguments[12]:false;var samples=arguments.length>13?arguments[13]:undefined;var creationFlags=arguments.length>14?arguments[14]:undefined;var noColorAttachment=arguments.length>15&&arguments[15]!==undefined?arguments[15]:false;var useSRGBBuffer=arguments.length>16&&arguments[16]!==undefined?arguments[16]:false;_classCallCheck(this,RenderTargetTexture);var _a,_b,_c,_d,_e,_f;var colorAttachment=void 0;if(_typeof(generateMipMaps)==="object"){var options=generateMipMaps;generateMipMaps=!!options.generateMipMaps;doNotChangeAspectRatio=(_a=options.doNotChangeAspectRatio)!==null&&_a!==void 0?_a:true;type=(_b=options.type)!==null&&_b!==void 0?_b:0;isCube=!!options.isCube;samplingMode=(_c=options.samplingMode)!==null&&_c!==void 0?_c:Texture.TRILINEAR_SAMPLINGMODE;generateDepthBuffer=(_d=options.generateDepthBuffer)!==null&&_d!==void 0?_d:true;generateStencilBuffer=!!options.generateStencilBuffer;isMulti=!!options.isMulti;format=(_e=options.format)!==null&&_e!==void 0?_e:5;delayAllocation=!!options.delayAllocation;samples=options.samples;creationFlags=options.creationFlags;noColorAttachment=!!options.noColorAttachment;useSRGBBuffer=!!options.useSRGBBuffer;colorAttachment=options.colorAttachment;}_this164=_super52.call(this,null,scene2,!generateMipMaps,void 0,samplingMode,void 0,void 0,void 0,void 0,format);_this164._unObserveRenderList=null;_this164._renderListHasChanged=function(_functionName,previousLength){var _a2;var newLength=_this164._renderList?_this164._renderList.length:0;if(previousLength===0&&newLength>0||newLength===0){(_a2=_this164.getScene())===null||_a2===void 0?void 0:_a2.meshes.forEach(function(mesh){mesh._markSubMeshesAsLightDirty();});}};_this164.renderParticles=true;_this164.renderSprites=false;_this164.forceLayerMaskCheck=false;_this164.ignoreCameraViewport=false;_this164.onBeforeBindObservable=new Observable();_this164.onAfterUnbindObservable=new Observable();_this164.onBeforeRenderObservable=new Observable();_this164.onAfterRenderObservable=new Observable();_this164.onClearObservable=new Observable();_this164.onResizeObservable=new Observable();_this164._cleared=false;_this164.skipInitialClear=false;_this164._currentRefreshId=-1;_this164._refreshRate=1;_this164._samples=1;_this164._canRescale=true;_this164._renderTarget=null;_this164.boundingBoxPosition=Vector3.Zero();scene2=_this164.getScene();if(!scene2){return _possibleConstructorReturn(_this164);}var engine=_this164.getScene().getEngine();_this164._coordinatesMode=Texture.PROJECTION_MODE;_this164.renderList=new Array();_this164.name=name135;_this164.isRenderTarget=true;_this164._initialSizeParameter=size;_this164._renderPassIds=[];_this164._isCubeData=isCube;_this164._processSizeParameter(size);_this164.renderPassId=_this164._renderPassIds[0];_this164._resizeObserver=engine.onResizeObservable.add(function(){});_this164._generateMipMaps=generateMipMaps?true:false;_this164._doNotChangeAspectRatio=doNotChangeAspectRatio;_this164._renderingManager=new RenderingManager(scene2);_this164._renderingManager._useSceneAutoClearSetup=true;if(isMulti){return _possibleConstructorReturn(_this164);}_this164._renderTargetOptions={generateMipMaps:generateMipMaps,type:type,format:(_f=_this164._format)!==null&&_f!==void 0?_f:void 0,samplingMode:_this164.samplingMode,generateDepthBuffer:generateDepthBuffer,generateStencilBuffer:generateStencilBuffer,samples:samples,creationFlags:creationFlags,noColorAttachment:noColorAttachment,useSRGBBuffer:useSRGBBuffer,colorAttachment:colorAttachment};if(_this164.samplingMode===Texture.NEAREST_SAMPLINGMODE){_this164.wrapU=Texture.CLAMP_ADDRESSMODE;_this164.wrapV=Texture.CLAMP_ADDRESSMODE;}if(!delayAllocation){if(isCube){_this164._renderTarget=scene2.getEngine().createRenderTargetCubeTexture(_this164.getRenderSize(),_this164._renderTargetOptions);_this164.coordinatesMode=Texture.INVCUBIC_MODE;_this164._textureMatrix=Matrix.Identity();}else{_this164._renderTarget=scene2.getEngine().createRenderTargetTexture(_this164._size,_this164._renderTargetOptions);}_this164._texture=_this164._renderTarget.texture;if(samples!==void 0){_this164.samples=samples;}}return _this164;}_createClass(RenderTargetTexture,[{key:"renderList",get:function get(){return this._renderList;},set:function set(value){if(this._unObserveRenderList){this._unObserveRenderList();this._unObserveRenderList=null;}if(value){this._unObserveRenderList=_ObserveArray(value,this._renderListHasChanged);}this._renderList=value;}},{key:"postProcesses",get:function get(){return this._postProcesses;}},{key:"_prePassEnabled",get:function get(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled;}},{key:"onAfterUnbind",set:function set(callback){if(this._onAfterUnbindObserver){this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver);}this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(callback);}},{key:"onBeforeRender",set:function set(callback){if(this._onBeforeRenderObserver){this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver);}this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(callback);}},{key:"onAfterRender",set:function set(callback){if(this._onAfterRenderObserver){this.onAfterRenderObservable.remove(this._onAfterRenderObserver);}this._onAfterRenderObserver=this.onAfterRenderObservable.add(callback);}},{key:"onClear",set:function set(callback){if(this._onClearObserver){this.onClearObservable.remove(this._onClearObserver);}this._onClearObserver=this.onClearObservable.add(callback);}},{key:"renderPassIds",get:function get(){return this._renderPassIds;}},{key:"currentRefreshId",get:function get(){return this._currentRefreshId;}},{key:"setMaterialForRendering",value:function setMaterialForRendering(mesh,material){var meshes;if(!Array.isArray(mesh)){meshes=[mesh];}else{meshes=mesh;}for(var j=0;j<meshes.length;++j){for(var i=0;i<this._renderPassIds.length;++i){meshes[j].setMaterialForRenderPass(this._renderPassIds[i],material!==void 0?Array.isArray(material)?material[i]:material:void 0);}}}},{key:"renderTargetOptions",get:function get(){return this._renderTargetOptions;}},{key:"renderTarget",get:function get(){return this._renderTarget;}},{key:"_onRatioRescale",value:function _onRatioRescale(){if(this._sizeRatio){this.resize(this._initialSizeParameter);}}},{key:"boundingBoxSize",get:function get(){return this._boundingBoxSize;},set:function set(value){if(this._boundingBoxSize&&this._boundingBoxSize.equals(value)){return;}this._boundingBoxSize=value;var scene2=this.getScene();if(scene2){scene2.markAllMaterialsAsDirty(1);}}},{key:"depthStencilTexture",get:function get(){var _a,_b;return(_b=(_a=this._renderTarget)===null||_a===void 0?void 0:_a._depthStencilTexture)!==null&&_b!==void 0?_b:null;}},{key:"createDepthStencilTexture",value:function createDepthStencilTexture(){var comparisonFunction=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var bilinearFiltering=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var generateStencil=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var samples=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var format=arguments.length>4&&arguments[4]!==undefined?arguments[4]:14;var _a;(_a=this._renderTarget)===null||_a===void 0?void 0:_a.createDepthStencilTexture(comparisonFunction,bilinearFiltering,generateStencil,samples,format);}},{key:"_releaseRenderPassId",value:function _releaseRenderPassId(){if(this._scene){var engine=this._scene.getEngine();for(var i=0;i<this._renderPassIds.length;++i){engine.releaseRenderPassId(this._renderPassIds[i]);}}this._renderPassIds=[];}},{key:"_createRenderPassId",value:function _createRenderPassId(){this._releaseRenderPassId();var engine=this._scene.getEngine();var numPasses=this._isCubeData?6:this.getRenderLayers()||1;for(var i=0;i<numPasses;++i){this._renderPassIds[i]=engine.createRenderPassId("RenderTargetTexture - ".concat(this.name,"#").concat(i));}}},{key:"_processSizeParameter",value:function _processSizeParameter(size){if(size.ratio){this._sizeRatio=size.ratio;var engine=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(engine.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(engine.getRenderHeight(),this._sizeRatio)};}else{this._size=size;}this._createRenderPassId();}},{key:"samples",get:function get(){var _a,_b;return(_b=(_a=this._renderTarget)===null||_a===void 0?void 0:_a.samples)!==null&&_b!==void 0?_b:this._samples;},set:function set(value){if(this._renderTarget){this._samples=this._renderTarget.setSamples(value);}}},{key:"resetRefreshCounter",value:function resetRefreshCounter(){this._currentRefreshId=-1;}},{key:"refreshRate",get:function get(){return this._refreshRate;},set:function set(value){this._refreshRate=value;this.resetRefreshCounter();}},{key:"addPostProcess",value:function addPostProcess(postProcess){if(!this._postProcessManager){var scene2=this.getScene();if(!scene2){return;}this._postProcessManager=new PostProcessManager(scene2);this._postProcesses=new Array();}this._postProcesses.push(postProcess);this._postProcesses[0].autoClear=false;}},{key:"clearPostProcesses",value:function clearPostProcesses(){var dispose=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!this._postProcesses){return;}if(dispose){var _iterator189=_createForOfIteratorHelper(this._postProcesses),_step199;try{for(_iterator189.s();!(_step199=_iterator189.n()).done;){var postProcess=_step199.value;postProcess.dispose();}}catch(err){_iterator189.e(err);}finally{_iterator189.f();}}this._postProcesses=[];}},{key:"removePostProcess",value:function removePostProcess(postProcess){if(!this._postProcesses){return;}var index=this._postProcesses.indexOf(postProcess);if(index===-1){return;}this._postProcesses.splice(index,1);if(this._postProcesses.length>0){this._postProcesses[0].autoClear=false;}}},{key:"_shouldRender",value:function _shouldRender(){if(this._currentRefreshId===-1){this._currentRefreshId=1;return true;}if(this.refreshRate===this._currentRefreshId){this._currentRefreshId=1;return true;}this._currentRefreshId++;return false;}},{key:"getRenderSize",value:function getRenderSize(){return this.getRenderWidth();}},{key:"getRenderWidth",value:function getRenderWidth(){if(this._size.width){return this._size.width;}return this._size;}},{key:"getRenderHeight",value:function getRenderHeight(){if(this._size.width){return this._size.height;}return this._size;}},{key:"getRenderLayers",value:function getRenderLayers(){var layers=this._size.layers;if(layers){return layers;}return 0;}},{key:"disableRescaling",value:function disableRescaling(){this._canRescale=false;}},{key:"canRescale",get:function get(){return this._canRescale;}},{key:"scale",value:function scale(ratio){var newSize=Math.max(1,this.getRenderSize()*ratio);this.resize(newSize);}},{key:"getReflectionTextureMatrix",value:function getReflectionTextureMatrix(){if(this.isCube){return this._textureMatrix;}return _get(_getPrototypeOf(RenderTargetTexture.prototype),"getReflectionTextureMatrix",this).call(this);}},{key:"resize",value:function resize(size){var _a;var wasCube=this.isCube;(_a=this._renderTarget)===null||_a===void 0?void 0:_a.dispose();this._renderTarget=null;var scene2=this.getScene();if(!scene2){return;}this._processSizeParameter(size);if(wasCube){this._renderTarget=scene2.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions);}else{this._renderTarget=scene2.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions);}this._texture=this._renderTarget.texture;if(this._renderTargetOptions.samples!==void 0){this.samples=this._renderTargetOptions.samples;}if(this.onResizeObservable.hasObservers()){this.onResizeObservable.notifyObservers(this);}}},{key:"render",value:function render(){var useCameraPostProcess=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var dumpForDebug=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._render(useCameraPostProcess,dumpForDebug);}},{key:"isReadyForRendering",value:function isReadyForRendering(){return this._render(false,false,true);}},{key:"_render",value:function _render(){var useCameraPostProcess=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var dumpForDebug=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var checkReadiness=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var _a;var scene2=this.getScene();if(!scene2){return checkReadiness;}var engine=scene2.getEngine();if(this.useCameraPostProcesses!==void 0){useCameraPostProcess=this.useCameraPostProcesses;}if(this._waitingRenderList){this.renderList=[];for(var index=0;index<this._waitingRenderList.length;index++){var id=this._waitingRenderList[index];var mesh=scene2.getMeshById(id);if(mesh){this.renderList.push(mesh);}}this._waitingRenderList=void 0;}if(this.renderListPredicate){if(this.renderList){this.renderList.length=0;}else{this.renderList=[];}var scene3=this.getScene();if(!scene3){return checkReadiness;}var sceneMeshes=scene3.meshes;for(var _index28=0;_index28<sceneMeshes.length;_index28++){var _mesh5=sceneMeshes[_index28];if(this.renderListPredicate(_mesh5)){this.renderList.push(_mesh5);}}}var currentRenderPassId=engine.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);var camera=(_a=this.activeCamera)!==null&&_a!==void 0?_a:scene2.activeCamera;var sceneCamera=scene2.activeCamera;if(camera){if(camera!==scene2.activeCamera){scene2.setTransformMatrix(camera.getViewMatrix(),camera.getProjectionMatrix(true));scene2.activeCamera=camera;}engine.setViewport(camera.viewport,this.getRenderWidth(),this.getRenderHeight());}this._defaultRenderListPrepared=false;var returnValue=checkReadiness;if(!checkReadiness){if(this.is2DArray){for(var layer=0;layer<this.getRenderLayers();layer++){this._renderToTarget(0,useCameraPostProcess,dumpForDebug,layer,camera);scene2.incrementRenderId();scene2.resetCachedMaterial();}}else if(this.isCube){for(var face=0;face<6;face++){this._renderToTarget(face,useCameraPostProcess,dumpForDebug,void 0,camera);scene2.incrementRenderId();scene2.resetCachedMaterial();}}else{this._renderToTarget(0,useCameraPostProcess,dumpForDebug,void 0,camera);}}else{if(!scene2.getViewMatrix()){scene2.updateTransformMatrix();}var numLayers=this.is2DArray?this.getRenderLayers():this.isCube?6:1;for(var _layer=0;_layer<numLayers&&returnValue;_layer++){var currentRenderList=null;var defaultRenderList=this.renderList?this.renderList:scene2.getActiveMeshes().data;var defaultRenderListLength=this.renderList?this.renderList.length:scene2.getActiveMeshes().length;engine.currentRenderPassId=this._renderPassIds[_layer];this.onBeforeRenderObservable.notifyObservers(_layer);if(this.getCustomRenderList){currentRenderList=this.getCustomRenderList(_layer,defaultRenderList,defaultRenderListLength);}if(!currentRenderList){currentRenderList=defaultRenderList;}if(!this._doNotChangeAspectRatio){scene2.updateTransformMatrix(true);}for(var i=0;i<currentRenderList.length&&returnValue;++i){var _mesh6=currentRenderList[i];if(!_mesh6.isEnabled()||_mesh6.isBlocked||!_mesh6.isVisible||!_mesh6.subMeshes){continue;}if(this.customIsReadyFunction){if(!this.customIsReadyFunction(_mesh6,this.refreshRate,checkReadiness)){returnValue=false;continue;}}else if(!_mesh6.isReady(true)){returnValue=false;continue;}}this.onAfterRenderObservable.notifyObservers(_layer);if(this.is2DArray||this.isCube){scene2.incrementRenderId();scene2.resetCachedMaterial();}}}this.onAfterUnbindObservable.notifyObservers(this);engine.currentRenderPassId=currentRenderPassId;if(sceneCamera){scene2.activeCamera=sceneCamera;if(scene2.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==scene2.activeCamera){scene2.setTransformMatrix(scene2.activeCamera.getViewMatrix(),scene2.activeCamera.getProjectionMatrix(true));}engine.setViewport(scene2.activeCamera.viewport);}scene2.resetCachedMaterial();return returnValue;}},{key:"_bestReflectionRenderTargetDimension",value:function _bestReflectionRenderTargetDimension(renderDimension,scale){var minimum=128;var x=renderDimension*scale;var curved=Engine.NearestPOT(x+minimum*minimum/(minimum+x));return Math.min(Engine.FloorPOT(renderDimension),curved);}},{key:"_prepareRenderingManager",value:function _prepareRenderingManager(currentRenderList,currentRenderListLength,camera,checkLayerMask){var scene2=this.getScene();if(!scene2){return;}this._renderingManager.reset();var sceneRenderId=scene2.getRenderId();for(var meshIndex=0;meshIndex<currentRenderListLength;meshIndex++){var mesh=currentRenderList[meshIndex];if(mesh&&!mesh.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(mesh,this.refreshRate,false)){this.resetRefreshCounter();continue;}}else if(!mesh.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue;}if(!mesh._internalAbstractMeshDataInfo._currentLODIsUpToDate&&scene2.activeCamera){mesh._internalAbstractMeshDataInfo._currentLOD=scene2.customLODSelector?scene2.customLODSelector(mesh,this.activeCamera||scene2.activeCamera):mesh.getLOD(this.activeCamera||scene2.activeCamera);mesh._internalAbstractMeshDataInfo._currentLODIsUpToDate=true;}if(!mesh._internalAbstractMeshDataInfo._currentLOD){continue;}var meshToRender=mesh._internalAbstractMeshDataInfo._currentLOD;meshToRender._preActivateForIntermediateRendering(sceneRenderId);var isMasked=void 0;if(checkLayerMask&&camera){isMasked=(mesh.layerMask&camera.layerMask)===0;}else{isMasked=false;}if(mesh.isEnabled()&&mesh.isVisible&&mesh.subMeshes&&!isMasked){if(meshToRender!==mesh){meshToRender._activate(sceneRenderId,true);}if(mesh._activate(sceneRenderId,true)&&mesh.subMeshes.length){if(!mesh.isAnInstance){meshToRender._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=false;}else{if(mesh._internalAbstractMeshDataInfo._actAsRegularMesh){meshToRender=mesh;}}meshToRender._internalAbstractMeshDataInfo._isActiveIntermediate=true;for(var subIndex=0;subIndex<meshToRender.subMeshes.length;subIndex++){var subMesh=meshToRender.subMeshes[subIndex];this._renderingManager.dispatch(subMesh,meshToRender);}}}}}for(var particleIndex=0;particleIndex<scene2.particleSystems.length;particleIndex++){var particleSystem=scene2.particleSystems[particleIndex];var emitter=particleSystem.emitter;if(!particleSystem.isStarted()||!emitter||!emitter.position||!emitter.isEnabled()){continue;}if(currentRenderList.indexOf(emitter)>=0){this._renderingManager.dispatchParticles(particleSystem);}}}},{key:"_bindFrameBuffer",value:function _bindFrameBuffer(){var faceIndex=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var layer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var scene2=this.getScene();if(!scene2){return;}var engine=scene2.getEngine();if(this._renderTarget){engine.bindFramebuffer(this._renderTarget,this.isCube?faceIndex:void 0,void 0,void 0,this.ignoreCameraViewport,0,layer);}}},{key:"_unbindFrameBuffer",value:function _unbindFrameBuffer(engine,faceIndex){var _this165=this;if(!this._renderTarget){return;}engine.unBindFramebuffer(this._renderTarget,this.isCube,function(){_this165.onAfterRenderObservable.notifyObservers(faceIndex);});}},{key:"_prepareFrame",value:function _prepareFrame(scene2,faceIndex,layer,useCameraPostProcess){if(this._postProcessManager){if(!this._prePassEnabled){this._postProcessManager._prepareFrame(this._texture,this._postProcesses);}}else if(!useCameraPostProcess||!scene2.postProcessManager._prepareFrame(this._texture)){this._bindFrameBuffer(faceIndex,layer);}}},{key:"_renderToTarget",value:function _renderToTarget(faceIndex,useCameraPostProcess,dumpForDebug){var layer=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var camera=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var _a,_b,_c,_d,_e,_f;var scene2=this.getScene();if(!scene2){return;}var engine=scene2.getEngine();(_a=engine._debugPushGroup)===null||_a===void 0?void 0:_a.call(engine,"render to face #".concat(faceIndex," layer #").concat(layer),1);this._prepareFrame(scene2,faceIndex,layer,useCameraPostProcess);if(this.is2DArray){engine.currentRenderPassId=this._renderPassIds[layer];this.onBeforeRenderObservable.notifyObservers(layer);}else{engine.currentRenderPassId=this._renderPassIds[faceIndex];this.onBeforeRenderObservable.notifyObservers(faceIndex);}var fastPath=engine.snapshotRendering&&engine.snapshotRenderingMode===1;if(!fastPath){var currentRenderList=null;var defaultRenderList=this.renderList?this.renderList:scene2.getActiveMeshes().data;var defaultRenderListLength=this.renderList?this.renderList.length:scene2.getActiveMeshes().length;if(this.getCustomRenderList){currentRenderList=this.getCustomRenderList(this.is2DArray?layer:faceIndex,defaultRenderList,defaultRenderListLength);}if(!currentRenderList){if(!this._defaultRenderListPrepared){this._prepareRenderingManager(defaultRenderList,defaultRenderListLength,camera,!this.renderList||this.forceLayerMaskCheck);this._defaultRenderListPrepared=true;}currentRenderList=defaultRenderList;}else{this._prepareRenderingManager(currentRenderList,currentRenderList.length,camera,this.forceLayerMaskCheck);}var _iterator190=_createForOfIteratorHelper(scene2._beforeRenderTargetClearStage),_step200;try{for(_iterator190.s();!(_step200=_iterator190.n()).done;){var step=_step200.value;step.action(this,faceIndex,layer);}}catch(err){_iterator190.e(err);}finally{_iterator190.f();}if(this.onClearObservable.hasObservers()){this.onClearObservable.notifyObservers(engine);}else{if(!this.skipInitialClear){engine.clear(this.clearColor||scene2.clearColor,true,true,true);}}if(!this._doNotChangeAspectRatio){scene2.updateTransformMatrix(true);}var _iterator191=_createForOfIteratorHelper(scene2._beforeRenderTargetDrawStage),_step201;try{for(_iterator191.s();!(_step201=_iterator191.n()).done;){var _step204=_step201.value;_step204.action(this,faceIndex,layer);}}catch(err){_iterator191.e(err);}finally{_iterator191.f();}this._renderingManager.render(this.customRenderFunction,currentRenderList,this.renderParticles,this.renderSprites);var _iterator192=_createForOfIteratorHelper(scene2._afterRenderTargetDrawStage),_step202;try{for(_iterator192.s();!(_step202=_iterator192.n()).done;){var _step205=_step202.value;_step205.action(this,faceIndex,layer);}}catch(err){_iterator192.e(err);}finally{_iterator192.f();}var saveGenerateMipMaps=(_c=(_b=this._texture)===null||_b===void 0?void 0:_b.generateMipMaps)!==null&&_c!==void 0?_c:false;if(this._texture){this._texture.generateMipMaps=false;}if(this._postProcessManager){this._postProcessManager._finalizeFrame(false,(_d=this._renderTarget)!==null&&_d!==void 0?_d:void 0,faceIndex,this._postProcesses,this.ignoreCameraViewport);}else if(useCameraPostProcess){scene2.postProcessManager._finalizeFrame(false,(_e=this._renderTarget)!==null&&_e!==void 0?_e:void 0,faceIndex);}var _iterator193=_createForOfIteratorHelper(scene2._afterRenderTargetPostProcessStage),_step203;try{for(_iterator193.s();!(_step203=_iterator193.n()).done;){var _step206=_step203.value;_step206.action(this,faceIndex,layer);}}catch(err){_iterator193.e(err);}finally{_iterator193.f();}if(this._texture){this._texture.generateMipMaps=saveGenerateMipMaps;}if(!this._doNotChangeAspectRatio){scene2.updateTransformMatrix(true);}if(dumpForDebug){DumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),engine);}}else{if(this.onClearObservable.hasObservers()){this.onClearObservable.notifyObservers(engine);}else{if(!this.skipInitialClear){engine.clear(this.clearColor||scene2.clearColor,true,true,true);}}}this._unbindFrameBuffer(engine,faceIndex);if(this._texture&&this.isCube&&faceIndex===5){engine.generateMipMapsForCubemap(this._texture);}(_f=engine._debugPopGroup)===null||_f===void 0?void 0:_f.call(engine,1);}},{key:"setRenderingOrder",value:function setRenderingOrder(renderingGroupId){var opaqueSortCompareFn=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var alphaTestSortCompareFn=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var transparentSortCompareFn=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;this._renderingManager.setRenderingOrder(renderingGroupId,opaqueSortCompareFn,alphaTestSortCompareFn,transparentSortCompareFn);}},{key:"setRenderingAutoClearDepthStencil",value:function setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil){this._renderingManager.setRenderingAutoClearDepthStencil(renderingGroupId,autoClearDepthStencil);this._renderingManager._useSceneAutoClearSetup=false;}},{key:"clone",value:function clone(){var textureSize=this.getSize();var newTexture=new RenderTargetTexture(this.name,textureSize,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);newTexture.hasAlpha=this.hasAlpha;newTexture.level=this.level;newTexture.coordinatesMode=this.coordinatesMode;if(this.renderList){newTexture.renderList=this.renderList.slice(0);}return newTexture;}},{key:"serialize",value:function serialize(){if(!this.name){return null;}var serializationObject=_get(_getPrototypeOf(RenderTargetTexture.prototype),"serialize",this).call(this);serializationObject.renderTargetSize=this.getRenderSize();serializationObject.renderList=[];if(this.renderList){for(var index=0;index<this.renderList.length;index++){serializationObject.renderList.push(this.renderList[index].id);}}return serializationObject;}},{key:"disposeFramebufferObjects",value:function disposeFramebufferObjects(){var _a;(_a=this._renderTarget)===null||_a===void 0?void 0:_a.dispose(true);}},{key:"releaseInternalTexture",value:function releaseInternalTexture(){var _a;(_a=this._renderTarget)===null||_a===void 0?void 0:_a.releaseTextures();this._texture=null;}},{key:"dispose",value:function dispose(){var _a;this.onResizeObservable.clear();this.onClearObservable.clear();this.onAfterRenderObservable.clear();this.onAfterUnbindObservable.clear();this.onBeforeBindObservable.clear();this.onBeforeRenderObservable.clear();if(this._postProcessManager){this._postProcessManager.dispose();this._postProcessManager=null;}if(this._prePassRenderTarget){this._prePassRenderTarget.dispose();}this._releaseRenderPassId();this.clearPostProcesses(true);if(this._resizeObserver){this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver);this._resizeObserver=null;}this.renderList=null;var scene2=this.getScene();if(!scene2){return;}var index=scene2.customRenderTargets.indexOf(this);if(index>=0){scene2.customRenderTargets.splice(index,1);}var _iterator194=_createForOfIteratorHelper(scene2.cameras),_step207;try{for(_iterator194.s();!(_step207=_iterator194.n()).done;){var camera=_step207.value;index=camera.customRenderTargets.indexOf(this);if(index>=0){camera.customRenderTargets.splice(index,1);}}}catch(err){_iterator194.e(err);}finally{_iterator194.f();}(_a=this._renderTarget)===null||_a===void 0?void 0:_a.dispose();this._renderTarget=null;this._texture=null;_get(_getPrototypeOf(RenderTargetTexture.prototype),"dispose",this).call(this);}},{key:"_rebuild",value:function _rebuild(){if(this.refreshRate===RenderTargetTexture.REFRESHRATE_RENDER_ONCE){this.refreshRate=RenderTargetTexture.REFRESHRATE_RENDER_ONCE;}if(this._postProcessManager){this._postProcessManager._rebuild();}}},{key:"freeRenderingGroups",value:function freeRenderingGroups(){if(this._renderingManager){this._renderingManager.freeRenderingGroups();}}},{key:"getViewCount",value:function getViewCount(){return 1;}}]);return RenderTargetTexture;}(Texture);RenderTargetTexture.REFRESHRATE_RENDER_ONCE=0;RenderTargetTexture.REFRESHRATE_RENDER_ONEVERYFRAME=1;RenderTargetTexture.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2;Texture._CreateRenderTargetTexture=function(name135,renderTargetSize,scene2,generateMipMaps,creationFlags){return new RenderTargetTexture(name135,renderTargetSize,scene2,generateMipMaps);};// node_modules/@babylonjs/core/Shaders/passCube.fragment.js
var name64="passCubePixelShader";var shader64="varying vec2 vUV;\nuniform samplerCube textureSampler;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\nvec2 uv=vUV*2.0-1.0;\n#ifdef POSITIVEX\ngl_FragColor=textureCube(textureSampler,vec3(1.001,uv.y,uv.x));\n#endif\n#ifdef NEGATIVEX\ngl_FragColor=textureCube(textureSampler,vec3(-1.001,uv.y,uv.x));\n#endif\n#ifdef POSITIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,1.001,uv.x));\n#endif\n#ifdef NEGATIVEY\ngl_FragColor=textureCube(textureSampler,vec3(uv.y,-1.001,uv.x));\n#endif\n#ifdef POSITIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,1.001));\n#endif\n#ifdef NEGATIVEZ\ngl_FragColor=textureCube(textureSampler,vec3(uv,-1.001));\n#endif\n}";ShaderStore.ShadersStore[name64]=shader64;// node_modules/@babylonjs/core/PostProcesses/passPostProcess.js
var PassPostProcess=/*#__PURE__*/function(_PostProcess){_inherits(PassPostProcess,_PostProcess);var _super53=_createSuper(PassPostProcess);function PassPostProcess(name135,options){var camera=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var samplingMode=arguments.length>3?arguments[3]:undefined;var engine=arguments.length>4?arguments[4]:undefined;var reusable=arguments.length>5?arguments[5]:undefined;var textureType=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;var blockCompilation=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;_classCallCheck(this,PassPostProcess);return _super53.call(this,name135,"pass",null,null,options,camera,samplingMode,engine,reusable,void 0,textureType,void 0,null,blockCompilation);}_createClass(PassPostProcess,[{key:"getClassName",value:function getClassName(){return"PassPostProcess";}}],[{key:"_Parse",value:function _Parse(parsedPostProcess,targetCamera,scene2,rootUrl){return SerializationHelper.Parse(function(){return new PassPostProcess(parsedPostProcess.name,parsedPostProcess.options,targetCamera,parsedPostProcess.renderTargetSamplingMode,parsedPostProcess._engine,parsedPostProcess.reusable);},parsedPostProcess,scene2,rootUrl);}}]);return PassPostProcess;}(PostProcess);RegisterClass("BABYLON.PassPostProcess",PassPostProcess);Engine._RescalePostProcessFactory=function(engine){return new PassPostProcess("rescale",1,null,2,engine,false,0);};// node_modules/@babylonjs/core/Misc/textureTools.js
function ApplyPostProcess(postProcessName,internalTexture,scene2,type,samplingMode,format){var engine=internalTexture.getEngine();internalTexture.isReady=false;samplingMode=samplingMode!==null&&samplingMode!==void 0?samplingMode:internalTexture.samplingMode;type=type!==null&&type!==void 0?type:internalTexture.type;format=format!==null&&format!==void 0?format:internalTexture.format;if(type===-1){type=0;}return new Promise(function(resolve){var postProcess=new PostProcess("postprocess",postProcessName,null,null,1,null,samplingMode,engine,false,void 0,type,void 0,null,false,format);postProcess.externalTextureSamplerBinding=true;var encodedTexture=engine.createRenderTargetTexture({width:internalTexture.width,height:internalTexture.height},{generateDepthBuffer:false,generateMipMaps:false,generateStencilBuffer:false,samplingMode:samplingMode,type:type,format:format});postProcess.getEffect().executeWhenCompiled(function(){postProcess.onApply=function(effect){effect._bindTexture("textureSampler",internalTexture);effect.setFloat2("scale",1,1);};scene2.postProcessManager.directRender([postProcess],encodedTexture,true);engine.restoreDefaultFramebuffer();engine._releaseTexture(internalTexture);if(postProcess){postProcess.dispose();}encodedTexture._swapAndDie(internalTexture);internalTexture.type=type;internalTexture.format=5;internalTexture.isReady=true;resolve(internalTexture);});});}// node_modules/@babylonjs/core/Misc/rgbdTextureTools.js
var RGBDTextureTools=/*#__PURE__*/function(){function RGBDTextureTools(){_classCallCheck(this,RGBDTextureTools);}_createClass(RGBDTextureTools,null,[{key:"ExpandRGBDTexture",value:function ExpandRGBDTexture(texture){var internalTexture=texture._texture;if(!internalTexture||!texture.isRGBD){return;}var engine=internalTexture.getEngine();var caps=engine.getCaps();var isReady=internalTexture.isReady;var expandTexture=false;if(caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering){expandTexture=true;internalTexture.type=2;}else if(caps.textureFloatRender&&caps.textureFloatLinearFiltering){expandTexture=true;internalTexture.type=1;}if(expandTexture){internalTexture.isReady=false;internalTexture._isRGBD=false;internalTexture.invertY=false;}var expandRGBDTexture=function expandRGBDTexture(){if(expandTexture){var rgbdPostProcess=new PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,3,engine,false,void 0,internalTexture.type,void 0,null,false);rgbdPostProcess.externalTextureSamplerBinding=true;var expandedTexture=engine.createRenderTargetTexture(internalTexture.width,{generateDepthBuffer:false,generateMipMaps:false,generateStencilBuffer:false,samplingMode:internalTexture.samplingMode,type:internalTexture.type,format:5});rgbdPostProcess.getEffect().executeWhenCompiled(function(){rgbdPostProcess.onApply=function(effect){effect._bindTexture("textureSampler",internalTexture);effect.setFloat2("scale",1,1);};texture.getScene().postProcessManager.directRender([rgbdPostProcess],expandedTexture,true);engine.restoreDefaultFramebuffer();engine._releaseTexture(internalTexture);if(rgbdPostProcess){rgbdPostProcess.dispose();}expandedTexture._swapAndDie(internalTexture);internalTexture.isReady=true;});}};if(isReady){expandRGBDTexture();}else{texture.onLoadObservable.addOnce(expandRGBDTexture);}}},{key:"EncodeTextureToRGBD",value:function EncodeTextureToRGBD(internalTexture,scene2){var outputTextureType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return ApplyPostProcess("rgbdEncode",internalTexture,scene2,outputTextureType,1,5);}}]);return RGBDTextureTools;}();// node_modules/@babylonjs/core/Misc/brdfTextureTools.js
var _environmentBRDFBase64Texture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==";var _instanceNumber=0;var GetEnvironmentBRDFTexture=function GetEnvironmentBRDFTexture(scene2){if(!scene2.environmentBRDFTexture){var useDelayedTextureLoading=scene2.useDelayedTextureLoading;scene2.useDelayedTextureLoading=false;var previousState=scene2._blockEntityCollection;scene2._blockEntityCollection=false;var texture=Texture.CreateFromBase64String(_environmentBRDFBase64Texture,"EnvironmentBRDFTexture"+_instanceNumber++,scene2,true,false,Texture.BILINEAR_SAMPLINGMODE);scene2._blockEntityCollection=previousState;var texturesCache=scene2.getEngine().getLoadedTexturesCache();var index=texturesCache.indexOf(texture.getInternalTexture());if(index!==-1){texturesCache.splice(index,1);}texture.isRGBD=true;texture.wrapU=Texture.CLAMP_ADDRESSMODE;texture.wrapV=Texture.CLAMP_ADDRESSMODE;scene2.environmentBRDFTexture=texture;scene2.useDelayedTextureLoading=useDelayedTextureLoading;RGBDTextureTools.ExpandRGBDTexture(texture);var observer=scene2.getEngine().onContextRestoredObservable.add(function(){texture.isRGBD=true;var checkReady=function checkReady(){if(texture.isReady()){RGBDTextureTools.ExpandRGBDTexture(texture);}else{Tools.SetImmediate(checkReady);}};checkReady();});scene2.onDisposeObservable.add(function(){scene2.getEngine().onContextRestoredObservable.remove(observer);});}return scene2.environmentBRDFTexture;};// node_modules/@babylonjs/core/Materials/PBR/pbrBRDFConfiguration.js
var MaterialBRDFDefines=/*#__PURE__*/function(_MaterialDefines3){_inherits(MaterialBRDFDefines,_MaterialDefines3);var _super54=_createSuper(MaterialBRDFDefines);function MaterialBRDFDefines(){var _this166;_classCallCheck(this,MaterialBRDFDefines);_this166=_super54.apply(this,arguments);_this166.BRDF_V_HEIGHT_CORRELATED=false;_this166.MS_BRDF_ENERGY_CONSERVATION=false;_this166.SPHERICAL_HARMONICS=false;_this166.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=false;return _this166;}return _createClass(MaterialBRDFDefines);}(MaterialDefines);var PBRBRDFConfiguration=/*#__PURE__*/function(_MaterialPluginBase2){_inherits(PBRBRDFConfiguration,_MaterialPluginBase2);var _super55=_createSuper(PBRBRDFConfiguration);function PBRBRDFConfiguration(material){var _this167;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,PBRBRDFConfiguration);_this167=_super55.call(this,material,"PBRBRDF",90,new MaterialBRDFDefines(),addToPluginList);_this167._useEnergyConservation=PBRBRDFConfiguration.DEFAULT_USE_ENERGY_CONSERVATION;_this167.useEnergyConservation=PBRBRDFConfiguration.DEFAULT_USE_ENERGY_CONSERVATION;_this167._useSmithVisibilityHeightCorrelated=PBRBRDFConfiguration.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED;_this167.useSmithVisibilityHeightCorrelated=PBRBRDFConfiguration.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED;_this167._useSphericalHarmonics=PBRBRDFConfiguration.DEFAULT_USE_SPHERICAL_HARMONICS;_this167.useSphericalHarmonics=PBRBRDFConfiguration.DEFAULT_USE_SPHERICAL_HARMONICS;_this167._useSpecularGlossinessInputEnergyConservation=PBRBRDFConfiguration.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION;_this167.useSpecularGlossinessInputEnergyConservation=PBRBRDFConfiguration.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION;_this167._internalMarkAllSubMeshesAsMiscDirty=material._dirtyCallbacks[16];_this167._enable(true);return _this167;}_createClass(PBRBRDFConfiguration,[{key:"_markAllSubMeshesAsMiscDirty",value:function _markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty();}},{key:"prepareDefines",value:function prepareDefines(defines){defines.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated;defines.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated;defines.SPHERICAL_HARMONICS=this._useSphericalHarmonics;defines.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation;}},{key:"getClassName",value:function getClassName(){return"PBRBRDFConfiguration";}}]);return PBRBRDFConfiguration;}(MaterialPluginBase);PBRBRDFConfiguration.DEFAULT_USE_ENERGY_CONSERVATION=true;PBRBRDFConfiguration.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=true;PBRBRDFConfiguration.DEFAULT_USE_SPHERICAL_HARMONICS=true;PBRBRDFConfiguration.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=true;__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useEnergyConservation",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useSmithVisibilityHeightCorrelated",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useSphericalHarmonics",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBRDFConfiguration.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);// node_modules/@babylonjs/core/Maths/math.path.js
var Orientation;(function(Orientation2){Orientation2[Orientation2["CW"]=0]="CW";Orientation2[Orientation2["CCW"]=1]="CCW";})(Orientation||(Orientation={}));// node_modules/@babylonjs/core/Maths/sphericalPolynomial.js
var SH3ylmBasisConstants=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))];var SH3ylmBasisTrigonometricTerms=[function(){return 1;},function(direction){return direction.y;},function(direction){return direction.z;},function(direction){return direction.x;},function(direction){return direction.x*direction.y;},function(direction){return direction.y*direction.z;},function(direction){return 3*direction.z*direction.z-1;},function(direction){return direction.x*direction.z;},function(direction){return direction.x*direction.x-direction.y*direction.y;}];var applySH3=function applySH3(lm,direction){return SH3ylmBasisConstants[lm]*SH3ylmBasisTrigonometricTerms[lm](direction);};var SHCosKernelConvolution=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];var SphericalHarmonics=/*#__PURE__*/function(){function SphericalHarmonics(){_classCallCheck(this,SphericalHarmonics);this.preScaled=false;this.l00=Vector3.Zero();this.l1_1=Vector3.Zero();this.l10=Vector3.Zero();this.l11=Vector3.Zero();this.l2_2=Vector3.Zero();this.l2_1=Vector3.Zero();this.l20=Vector3.Zero();this.l21=Vector3.Zero();this.l22=Vector3.Zero();}_createClass(SphericalHarmonics,[{key:"addLight",value:function addLight(direction,color,deltaSolidAngle){TmpVectors.Vector3[0].set(color.r,color.g,color.b);var colorVector=TmpVectors.Vector3[0];var c=TmpVectors.Vector3[1];colorVector.scaleToRef(deltaSolidAngle,c);c.scaleToRef(applySH3(0,direction),TmpVectors.Vector3[2]);this.l00.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(1,direction),TmpVectors.Vector3[2]);this.l1_1.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(2,direction),TmpVectors.Vector3[2]);this.l10.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(3,direction),TmpVectors.Vector3[2]);this.l11.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(4,direction),TmpVectors.Vector3[2]);this.l2_2.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(5,direction),TmpVectors.Vector3[2]);this.l2_1.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(6,direction),TmpVectors.Vector3[2]);this.l20.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(7,direction),TmpVectors.Vector3[2]);this.l21.addInPlace(TmpVectors.Vector3[2]);c.scaleToRef(applySH3(8,direction),TmpVectors.Vector3[2]);this.l22.addInPlace(TmpVectors.Vector3[2]);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this.l00.scaleInPlace(scale);this.l1_1.scaleInPlace(scale);this.l10.scaleInPlace(scale);this.l11.scaleInPlace(scale);this.l2_2.scaleInPlace(scale);this.l2_1.scaleInPlace(scale);this.l20.scaleInPlace(scale);this.l21.scaleInPlace(scale);this.l22.scaleInPlace(scale);}},{key:"convertIncidentRadianceToIrradiance",value:function convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(SHCosKernelConvolution[0]);this.l1_1.scaleInPlace(SHCosKernelConvolution[1]);this.l10.scaleInPlace(SHCosKernelConvolution[2]);this.l11.scaleInPlace(SHCosKernelConvolution[3]);this.l2_2.scaleInPlace(SHCosKernelConvolution[4]);this.l2_1.scaleInPlace(SHCosKernelConvolution[5]);this.l20.scaleInPlace(SHCosKernelConvolution[6]);this.l21.scaleInPlace(SHCosKernelConvolution[7]);this.l22.scaleInPlace(SHCosKernelConvolution[8]);}},{key:"convertIrradianceToLambertianRadiance",value:function convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI);}},{key:"preScaleForRendering",value:function preScaleForRendering(){this.preScaled=true;this.l00.scaleInPlace(SH3ylmBasisConstants[0]);this.l1_1.scaleInPlace(SH3ylmBasisConstants[1]);this.l10.scaleInPlace(SH3ylmBasisConstants[2]);this.l11.scaleInPlace(SH3ylmBasisConstants[3]);this.l2_2.scaleInPlace(SH3ylmBasisConstants[4]);this.l2_1.scaleInPlace(SH3ylmBasisConstants[5]);this.l20.scaleInPlace(SH3ylmBasisConstants[6]);this.l21.scaleInPlace(SH3ylmBasisConstants[7]);this.l22.scaleInPlace(SH3ylmBasisConstants[8]);}},{key:"updateFromArray",value:function updateFromArray(data){Vector3.FromArrayToRef(data[0],0,this.l00);Vector3.FromArrayToRef(data[1],0,this.l1_1);Vector3.FromArrayToRef(data[2],0,this.l10);Vector3.FromArrayToRef(data[3],0,this.l11);Vector3.FromArrayToRef(data[4],0,this.l2_2);Vector3.FromArrayToRef(data[5],0,this.l2_1);Vector3.FromArrayToRef(data[6],0,this.l20);Vector3.FromArrayToRef(data[7],0,this.l21);Vector3.FromArrayToRef(data[8],0,this.l22);return this;}},{key:"updateFromFloatsArray",value:function updateFromFloatsArray(data){Vector3.FromFloatsToRef(data[0],data[1],data[2],this.l00);Vector3.FromFloatsToRef(data[3],data[4],data[5],this.l1_1);Vector3.FromFloatsToRef(data[6],data[7],data[8],this.l10);Vector3.FromFloatsToRef(data[9],data[10],data[11],this.l11);Vector3.FromFloatsToRef(data[12],data[13],data[14],this.l2_2);Vector3.FromFloatsToRef(data[15],data[16],data[17],this.l2_1);Vector3.FromFloatsToRef(data[18],data[19],data[20],this.l20);Vector3.FromFloatsToRef(data[21],data[22],data[23],this.l21);Vector3.FromFloatsToRef(data[24],data[25],data[26],this.l22);return this;}}],[{key:"FromArray",value:function FromArray(data){var sh=new SphericalHarmonics();return sh.updateFromArray(data);}},{key:"FromPolynomial",value:function FromPolynomial(polynomial){var result=new SphericalHarmonics();result.l00=polynomial.xx.scale(0.376127).add(polynomial.yy.scale(0.376127)).add(polynomial.zz.scale(0.376126));result.l1_1=polynomial.y.scale(0.977204);result.l10=polynomial.z.scale(0.977204);result.l11=polynomial.x.scale(0.977204);result.l2_2=polynomial.xy.scale(1.16538);result.l2_1=polynomial.yz.scale(1.16538);result.l20=polynomial.zz.scale(1.34567).subtract(polynomial.xx.scale(0.672834)).subtract(polynomial.yy.scale(0.672834));result.l21=polynomial.zx.scale(1.16538);result.l22=polynomial.xx.scale(1.16538).subtract(polynomial.yy.scale(1.16538));result.l1_1.scaleInPlace(-1);result.l11.scaleInPlace(-1);result.l2_1.scaleInPlace(-1);result.l21.scaleInPlace(-1);result.scaleInPlace(Math.PI);return result;}}]);return SphericalHarmonics;}();var SphericalPolynomial=/*#__PURE__*/function(){function SphericalPolynomial(){_classCallCheck(this,SphericalPolynomial);this.x=Vector3.Zero();this.y=Vector3.Zero();this.z=Vector3.Zero();this.xx=Vector3.Zero();this.yy=Vector3.Zero();this.zz=Vector3.Zero();this.xy=Vector3.Zero();this.yz=Vector3.Zero();this.zx=Vector3.Zero();}_createClass(SphericalPolynomial,[{key:"preScaledHarmonics",get:function get(){if(!this._harmonics){this._harmonics=SphericalHarmonics.FromPolynomial(this);}if(!this._harmonics.preScaled){this._harmonics.preScaleForRendering();}return this._harmonics;}},{key:"addAmbient",value:function addAmbient(color){TmpVectors.Vector3[0].copyFromFloats(color.r,color.g,color.b);var colorVector=TmpVectors.Vector3[0];this.xx.addInPlace(colorVector);this.yy.addInPlace(colorVector);this.zz.addInPlace(colorVector);}},{key:"scaleInPlace",value:function scaleInPlace(scale){this.x.scaleInPlace(scale);this.y.scaleInPlace(scale);this.z.scaleInPlace(scale);this.xx.scaleInPlace(scale);this.yy.scaleInPlace(scale);this.zz.scaleInPlace(scale);this.yz.scaleInPlace(scale);this.zx.scaleInPlace(scale);this.xy.scaleInPlace(scale);}},{key:"updateFromHarmonics",value:function updateFromHarmonics(harmonics){this._harmonics=harmonics;this.x.copyFrom(harmonics.l11);this.x.scaleInPlace(1.02333).scaleInPlace(-1);this.y.copyFrom(harmonics.l1_1);this.y.scaleInPlace(1.02333).scaleInPlace(-1);this.z.copyFrom(harmonics.l10);this.z.scaleInPlace(1.02333);this.xx.copyFrom(harmonics.l00);TmpVectors.Vector3[0].copyFrom(harmonics.l20).scaleInPlace(0.247708);TmpVectors.Vector3[1].copyFrom(harmonics.l22).scaleInPlace(0.429043);this.xx.scaleInPlace(0.886277).subtractInPlace(TmpVectors.Vector3[0]).addInPlace(TmpVectors.Vector3[1]);this.yy.copyFrom(harmonics.l00);this.yy.scaleInPlace(0.886277).subtractInPlace(TmpVectors.Vector3[0]).subtractInPlace(TmpVectors.Vector3[1]);this.zz.copyFrom(harmonics.l00);TmpVectors.Vector3[0].copyFrom(harmonics.l20).scaleInPlace(0.495417);this.zz.scaleInPlace(0.886277).addInPlace(TmpVectors.Vector3[0]);this.yz.copyFrom(harmonics.l2_1);this.yz.scaleInPlace(0.858086).scaleInPlace(-1);this.zx.copyFrom(harmonics.l21);this.zx.scaleInPlace(0.858086).scaleInPlace(-1);this.xy.copyFrom(harmonics.l2_2);this.xy.scaleInPlace(0.858086);this.scaleInPlace(1/Math.PI);return this;}}],[{key:"FromHarmonics",value:function FromHarmonics(harmonics){var result=new SphericalPolynomial();return result.updateFromHarmonics(harmonics);}},{key:"FromArray",value:function FromArray(data){var sp=new SphericalPolynomial();Vector3.FromArrayToRef(data[0],0,sp.x);Vector3.FromArrayToRef(data[1],0,sp.y);Vector3.FromArrayToRef(data[2],0,sp.z);Vector3.FromArrayToRef(data[3],0,sp.xx);Vector3.FromArrayToRef(data[4],0,sp.yy);Vector3.FromArrayToRef(data[5],0,sp.zz);Vector3.FromArrayToRef(data[6],0,sp.yz);Vector3.FromArrayToRef(data[7],0,sp.zx);Vector3.FromArrayToRef(data[8],0,sp.xy);return sp;}}]);return SphericalPolynomial;}();// node_modules/@babylonjs/core/Misc/HighDynamicRange/cubemapToSphericalPolynomial.js
var FileFaceOrientation=/*#__PURE__*/_createClass(function FileFaceOrientation(name135,worldAxisForNormal,worldAxisForFileX,worldAxisForFileY){_classCallCheck(this,FileFaceOrientation);this.name=name135;this.worldAxisForNormal=worldAxisForNormal;this.worldAxisForFileX=worldAxisForFileX;this.worldAxisForFileY=worldAxisForFileY;});var CubeMapToSphericalPolynomialTools=/*#__PURE__*/function(){function CubeMapToSphericalPolynomialTools(){_classCallCheck(this,CubeMapToSphericalPolynomialTools);}_createClass(CubeMapToSphericalPolynomialTools,null,[{key:"ConvertCubeMapTextureToSphericalPolynomial",value:function ConvertCubeMapTextureToSphericalPolynomial(texture){var _this168=this;var _a;if(!texture.isCube){return null;}(_a=texture.getScene())===null||_a===void 0?void 0:_a.getEngine().flushFramebuffer();var size=texture.getSize().width;var rightPromise=texture.readPixels(0,void 0,void 0,false);var leftPromise=texture.readPixels(1,void 0,void 0,false);var upPromise;var downPromise;if(texture.isRenderTarget){upPromise=texture.readPixels(3,void 0,void 0,false);downPromise=texture.readPixels(2,void 0,void 0,false);}else{upPromise=texture.readPixels(2,void 0,void 0,false);downPromise=texture.readPixels(3,void 0,void 0,false);}var frontPromise=texture.readPixels(4,void 0,void 0,false);var backPromise=texture.readPixels(5,void 0,void 0,false);var gammaSpace=texture.gammaSpace;var format=5;var type=0;if(texture.textureType==1||texture.textureType==2){type=1;}return new Promise(function(resolve){Promise.all([leftPromise,rightPromise,upPromise,downPromise,frontPromise,backPromise]).then(function(_ref14){var _ref15=_slicedToArray(_ref14,6),left=_ref15[0],right=_ref15[1],up=_ref15[2],down=_ref15[3],front=_ref15[4],back=_ref15[5];var cubeInfo={size:size,right:right,left:left,up:up,down:down,front:front,back:back,format:format,type:type,gammaSpace:gammaSpace};resolve(_this168.ConvertCubeMapToSphericalPolynomial(cubeInfo));});});}},{key:"_AreaElement",value:function _AreaElement(x,y){return Math.atan2(x*y,Math.sqrt(x*x+y*y+1));}},{key:"ConvertCubeMapToSphericalPolynomial",value:function ConvertCubeMapToSphericalPolynomial(cubeInfo){var sphericalHarmonics=new SphericalHarmonics();var totalSolidAngle=0;var du=2/cubeInfo.size;var dv=du;var halfTexel=0.5*du;var minUV=halfTexel-1;for(var faceIndex=0;faceIndex<6;faceIndex++){var fileFace=this._FileFaces[faceIndex];var dataArray=cubeInfo[fileFace.name];var v=minUV;var stride=cubeInfo.format===5?4:3;for(var y=0;y<cubeInfo.size;y++){var u=minUV;for(var x=0;x<cubeInfo.size;x++){var worldDirection=fileFace.worldAxisForFileX.scale(u).add(fileFace.worldAxisForFileY.scale(v)).add(fileFace.worldAxisForNormal);worldDirection.normalize();var deltaSolidAngle=this._AreaElement(u-halfTexel,v-halfTexel)-this._AreaElement(u-halfTexel,v+halfTexel)-this._AreaElement(u+halfTexel,v-halfTexel)+this._AreaElement(u+halfTexel,v+halfTexel);var r=dataArray[y*cubeInfo.size*stride+x*stride+0];var g=dataArray[y*cubeInfo.size*stride+x*stride+1];var b=dataArray[y*cubeInfo.size*stride+x*stride+2];if(isNaN(r)){r=0;}if(isNaN(g)){g=0;}if(isNaN(b)){b=0;}if(cubeInfo.type===0){r/=255;g/=255;b/=255;}if(cubeInfo.gammaSpace){r=Math.pow(Scalar.Clamp(r),ToLinearSpace);g=Math.pow(Scalar.Clamp(g),ToLinearSpace);b=Math.pow(Scalar.Clamp(b),ToLinearSpace);}var max=4096;r=Scalar.Clamp(r,0,max);g=Scalar.Clamp(g,0,max);b=Scalar.Clamp(b,0,max);var color=new Color3(r,g,b);sphericalHarmonics.addLight(worldDirection,color,deltaSolidAngle);totalSolidAngle+=deltaSolidAngle;u+=du;}v+=dv;}}var sphereSolidAngle=4*Math.PI;var facesProcessed=6;var expectedSolidAngle=sphereSolidAngle*facesProcessed/6;var correctionFactor=expectedSolidAngle/totalSolidAngle;sphericalHarmonics.scaleInPlace(correctionFactor);sphericalHarmonics.convertIncidentRadianceToIrradiance();sphericalHarmonics.convertIrradianceToLambertianRadiance();return SphericalPolynomial.FromHarmonics(sphericalHarmonics);}}]);return CubeMapToSphericalPolynomialTools;}();CubeMapToSphericalPolynomialTools._FileFaces=[new FileFaceOrientation("right",new Vector3(1,0,0),new Vector3(0,0,-1),new Vector3(0,-1,0)),new FileFaceOrientation("left",new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,-1,0)),new FileFaceOrientation("up",new Vector3(0,1,0),new Vector3(1,0,0),new Vector3(0,0,1)),new FileFaceOrientation("down",new Vector3(0,-1,0),new Vector3(1,0,0),new Vector3(0,0,-1)),new FileFaceOrientation("front",new Vector3(0,0,1),new Vector3(1,0,0),new Vector3(0,-1,0)),new FileFaceOrientation("back",new Vector3(0,0,-1),new Vector3(-1,0,0),new Vector3(0,-1,0))];// node_modules/@babylonjs/core/Materials/Textures/baseTexture.polynomial.js
BaseTexture.prototype.forceSphericalPolynomialsRecompute=function(){if(this._texture){this._texture._sphericalPolynomial=null;this._texture._sphericalPolynomialPromise=null;this._texture._sphericalPolynomialComputed=false;}};Object.defineProperty(BaseTexture.prototype,"sphericalPolynomial",{get:function get(){var _this169=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed){return this._texture._sphericalPolynomial;}if(this._texture.isReady){if(!this._texture._sphericalPolynomialPromise){this._texture._sphericalPolynomialPromise=CubeMapToSphericalPolynomialTools.ConvertCubeMapTextureToSphericalPolynomial(this);if(this._texture._sphericalPolynomialPromise===null){this._texture._sphericalPolynomialComputed=true;}else{this._texture._sphericalPolynomialPromise.then(function(sphericalPolynomial){_this169._texture._sphericalPolynomial=sphericalPolynomial;_this169._texture._sphericalPolynomialComputed=true;});}}return null;}}return null;},set:function set(value){if(this._texture){this._texture._sphericalPolynomial=value;}},enumerable:true,configurable:true});// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentDeclaration.js
var name65="pbrFragmentDeclaration";var shader65="uniform vec4 vEyePosition;\nuniform vec3 vReflectionColor;\nuniform vec4 vAlbedoColor;\nuniform vec4 vLightingIntensity;\nuniform vec4 vReflectivityColor;\nuniform vec4 vMetallicReflectanceFactors;\nuniform vec3 vEmissiveColor;\nuniform float visibility;\nuniform vec3 vAmbientColor;\n#ifdef ALBEDO\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform vec2 vTangentSpaceParams;\n#endif\n#ifdef OPACITY\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\n#endif\n#ifdef REFLECTIVITY\nuniform vec3 vReflectivityInfos;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\n#endif\n#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(SS_REFRACTION) || defined(PREPASS)\nuniform mat4 view;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\n#ifdef REALTIME_FILTERING\nuniform vec2 vReflectionFilteringInfo;\n#endif\nuniform mat4 reflectionMatrix;\nuniform vec3 vReflectionMicrosurfaceInfos;\n#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)\nuniform vec3 vReflectionPosition;\nuniform vec3 vReflectionSize; \n#endif\n#endif\n#if defined(SS_REFRACTION) && defined(SS_USE_LOCAL_REFRACTIONMAP_CUBIC)\nuniform vec3 vRefractionPosition;\nuniform vec3 vRefractionSize; \n#endif\n#ifdef CLEARCOAT\nuniform vec2 vClearCoatParams;\nuniform vec4 vClearCoatRefractionParams;\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform vec2 vClearCoatTangentSpaceParams;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT\nuniform vec4 vClearCoatTintParams;\nuniform float clearCoatColorAtDistance;\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#endif\n#ifdef IRIDESCENCE\nuniform vec4 vIridescenceParams;\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\nuniform vec3 vAnisotropy;\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\nuniform vec4 vSheenColor;\n#ifdef SHEEN_ROUGHNESS\nuniform float vSheenRoughness;\n#endif\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionMicrosurfaceInfos;\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#ifdef REALTIME_FILTERING\nuniform vec2 vRefractionFilteringInfo;\n#endif\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\nuniform vec2 vThicknessParam;\nuniform vec3 vDiffusionDistance;\nuniform vec4 vTintColor;\nuniform vec3 vSubSurfaceIntensity;\n#endif\n#ifdef PREPASS\n#ifdef SS_SCATTERING\nuniform float scatteringDiffusionProfile;\n#endif\n#endif\n#if DEBUGMODE>0\nuniform vec2 vDebugMode;\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#define ADDITIONAL_FRAGMENT_DECLARATION\n";ShaderStore.IncludesShadersStore[name65]=shader65;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrUboDeclaration.js
var name66="pbrUboDeclaration";var shader66="layout(std140,column_major) uniform;\nuniform Material {\nvec2 vAlbedoInfos;\nvec4 vAmbientInfos;\nvec2 vOpacityInfos;\nvec2 vEmissiveInfos;\nvec2 vLightmapInfos;\nvec3 vReflectivityInfos;\nvec2 vMicroSurfaceSamplerInfos;\nvec2 vReflectionInfos;\nvec2 vReflectionFilteringInfo;\nvec3 vReflectionPosition;\nvec3 vReflectionSize;\nvec3 vBumpInfos;\nmat4 albedoMatrix;\nmat4 ambientMatrix;\nmat4 opacityMatrix;\nmat4 emissiveMatrix;\nmat4 lightmapMatrix;\nmat4 reflectivityMatrix;\nmat4 microSurfaceSamplerMatrix;\nmat4 bumpMatrix;\nvec2 vTangentSpaceParams;\nmat4 reflectionMatrix;\nvec3 vReflectionColor;\nvec4 vAlbedoColor;\nvec4 vLightingIntensity;\nvec3 vReflectionMicrosurfaceInfos;\nfloat pointSize;\nvec4 vReflectivityColor;\nvec3 vEmissiveColor;\nvec3 vAmbientColor;\nvec2 vDebugMode;\nvec4 vMetallicReflectanceFactors;\nvec2 vMetallicReflectanceInfos;\nmat4 metallicReflectanceMatrix;\nvec2 vReflectanceInfos;\nmat4 reflectanceMatrix;\nvec3 vSphericalL00;\nvec3 vSphericalL1_1;\nvec3 vSphericalL10;\nvec3 vSphericalL11;\nvec3 vSphericalL2_2;\nvec3 vSphericalL2_1;\nvec3 vSphericalL20;\nvec3 vSphericalL21;\nvec3 vSphericalL22;\nvec3 vSphericalX;\nvec3 vSphericalY;\nvec3 vSphericalZ;\nvec3 vSphericalXX_ZZ;\nvec3 vSphericalYY_ZZ;\nvec3 vSphericalZZ;\nvec3 vSphericalXY;\nvec3 vSphericalYZ;\nvec3 vSphericalZX;\n#define ADDITIONAL_UBO_DECLARATION\n};\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";ShaderStore.IncludesShadersStore[name66]=shader66;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentExtraDeclaration.js
var name67="pbrFragmentExtraDeclaration";var shader67="varying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n";ShaderStore.IncludesShadersStore[name67]=shader67;// node_modules/@babylonjs/core/Shaders/ShadersInclude/samplerFragmentAlternateDeclaration.js
var name68="samplerFragmentAlternateDeclaration";var shader68="#ifdef _DEFINENAME_\n#if _DEFINENAME_DIRECTUV==1\n#define v_VARYINGNAME_UV vMainUV1\n#elif _DEFINENAME_DIRECTUV==2\n#define v_VARYINGNAME_UV vMainUV2\n#elif _DEFINENAME_DIRECTUV==3\n#define v_VARYINGNAME_UV vMainUV3\n#elif _DEFINENAME_DIRECTUV==4\n#define v_VARYINGNAME_UV vMainUV4\n#elif _DEFINENAME_DIRECTUV==5\n#define v_VARYINGNAME_UV vMainUV5\n#elif _DEFINENAME_DIRECTUV==6\n#define v_VARYINGNAME_UV vMainUV6\n#else\nvarying vec2 v_VARYINGNAME_UV;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name68]=shader68;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrFragmentSamplersDeclaration.js
var name69="pbrFragmentSamplersDeclaration";var shader69="#include<samplerFragmentDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_SAMPLERNAME_,albedo)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_SAMPLERNAME_,ambient)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_SAMPLERNAME_,opacity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_SAMPLERNAME_,emissive)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_SAMPLERNAME_,lightmap)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_SAMPLERNAME_,reflectivity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_SAMPLERNAME_,microSurface)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_SAMPLERNAME_,metallicReflectance)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_SAMPLERNAME_,reflectance)\n#ifdef CLEARCOAT\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_SAMPLERNAME_,clearCoat)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D clearCoatRoughnessSampler;\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_SAMPLERNAME_,clearCoatBump)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_SAMPLERNAME_,clearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_SAMPLERNAME_,iridescence)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_SAMPLERNAME_,iridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_SAMPLERNAME_,sheen)\n#include<samplerFragmentAlternateDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL)\nuniform sampler2D sheenRoughnessSampler;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#include<samplerFragmentDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_SAMPLERNAME_,anisotropy)\n#endif\n#ifdef REFLECTION\n#ifdef REFLECTIONMAP_3D\n#define sampleReflection(s,c) textureCube(s,c)\nuniform samplerCube reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube reflectionSamplerLow;\nuniform samplerCube reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform samplerCube irradianceSampler;\n#endif\n#else\n#define sampleReflection(s,c) texture2D(s,c)\nuniform sampler2D reflectionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleReflectionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D reflectionSamplerLow;\nuniform sampler2D reflectionSamplerHigh;\n#endif\n#ifdef USEIRRADIANCEMAP\nuniform sampler2D irradianceSampler;\n#endif\n#endif\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#else\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#endif\n#endif\n#ifdef ENVIRONMENTBRDF\nuniform sampler2D environmentBrdfSampler;\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\n#ifdef SS_REFRACTIONMAP_3D\n#define sampleRefraction(s,c) textureCube(s,c)\nuniform samplerCube refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) textureCubeLodEXT(s,c,l)\n#else\nuniform samplerCube refractionSamplerLow;\nuniform samplerCube refractionSamplerHigh;\n#endif\n#else\n#define sampleRefraction(s,c) texture2D(s,c)\nuniform sampler2D refractionSampler;\n#ifdef LODBASEDMICROSFURACE\n#define sampleRefractionLod(s,c,l) texture2DLodEXT(s,c,l)\n#else\nuniform sampler2D refractionSamplerLow;\nuniform sampler2D refractionSamplerHigh;\n#endif\n#endif\n#endif\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_SAMPLERNAME_,thickness)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_SAMPLERNAME_,refractionIntensity)\n#include<samplerFragmentDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_SAMPLERNAME_,translucencyIntensity)\n#endif\n";ShaderStore.IncludesShadersStore[name69]=shader69;// node_modules/@babylonjs/core/Shaders/ShadersInclude/subSurfaceScatteringFunctions.js
var name70="subSurfaceScatteringFunctions";var shader70="bool testLightingForSSS(float diffusionProfile)\n{\nreturn diffusionProfile<1.;\n}";ShaderStore.IncludesShadersStore[name70]=shader70;// node_modules/@babylonjs/core/Shaders/ShadersInclude/importanceSampling.js
var name71="importanceSampling";var shader71="vec3 hemisphereCosSample(vec2 u) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=1.-u.y;\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDggx(vec2 u,float a) {\nfloat phi=2.*PI*u.x;\nfloat cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));\nfloat cosTheta=sqrt(cosTheta2);\nfloat sinTheta=sqrt(1.-cosTheta2);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}\nvec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) { \nfloat phi=2.*PI*u.x;\nfloat sinTheta=pow(u.y,a/(2.*a+1.));\nfloat cosTheta=sqrt(1.-sinTheta*sinTheta);\nreturn vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);\n}";ShaderStore.IncludesShadersStore[name71]=shader71;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrHelperFunctions.js
var name72="pbrHelperFunctions";var shader72="#define RECIPROCAL_PI2 0.15915494\n#define RECIPROCAL_PI 0.31830988618\n#define MINIMUMVARIANCE 0.0005\nfloat convertRoughnessToAverageSlope(float roughness)\n{\nreturn square(roughness)+MINIMUMVARIANCE;\n}\nfloat fresnelGrazingReflectance(float reflectance0) {\nfloat reflectance90=saturate(reflectance0*25.0);\nreturn reflectance90;\n}\nvec2 getAARoughnessFactors(vec3 normalVector) {\n#ifdef SPECULARAA\nvec3 nDfdx=dFdx(normalVector.xyz);\nvec3 nDfdy=dFdy(normalVector.xyz);\nfloat slopeSquare=max(dot(nDfdx,nDfdx),dot(nDfdy,nDfdy));\nfloat geometricRoughnessFactor=pow(saturate(slopeSquare),0.333);\nfloat geometricAlphaGFactor=sqrt(slopeSquare);\ngeometricAlphaGFactor*=0.75;\nreturn vec2(geometricRoughnessFactor,geometricAlphaGFactor);\n#else\nreturn vec2(0.);\n#endif\n}\n#ifdef ANISOTROPIC\nvec2 getAnisotropicRoughness(float alphaG,float anisotropy) {\nfloat alphaT=max(alphaG*(1.0+anisotropy),MINIMUMVARIANCE);\nfloat alphaB=max(alphaG*(1.0-anisotropy),MINIMUMVARIANCE);\nreturn vec2(alphaT,alphaB);\n}\nvec3 getAnisotropicBentNormals(const vec3 T,const vec3 B,const vec3 N,const vec3 V,float anisotropy) {\nvec3 anisotropicFrameDirection=anisotropy>=0.0 ? B : T;\nvec3 anisotropicFrameTangent=cross(normalize(anisotropicFrameDirection),V);\nvec3 anisotropicFrameNormal=cross(anisotropicFrameTangent,anisotropicFrameDirection);\nvec3 anisotropicNormal=normalize(mix(N,anisotropicFrameNormal,abs(anisotropy)));\nreturn anisotropicNormal;\n}\n#endif\n#if defined(CLEARCOAT) || defined(SS_REFRACTION)\nvec3 cocaLambert(vec3 alpha,float distance) {\nreturn exp(-alpha*distance);\n}\nvec3 cocaLambert(float NdotVRefract,float NdotLRefract,vec3 alpha,float thickness) {\nreturn cocaLambert(alpha,(thickness*((NdotLRefract+NdotVRefract)/(NdotLRefract*NdotVRefract))));\n}\nvec3 computeColorAtDistanceInMedia(vec3 color,float distance) {\nreturn -log(color)/distance;\n}\nvec3 computeClearCoatAbsorption(float NdotVRefract,float NdotLRefract,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 clearCoatAbsorption=mix(vec3(1.0),\ncocaLambert(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness),\nclearCoatIntensity);\nreturn clearCoatAbsorption;\n}\n#endif\n#ifdef MICROSURFACEAUTOMATIC\nfloat computeDefaultMicroSurface(float microSurface,vec3 reflectivityColor)\n{\nconst float kReflectivityNoAlphaWorkflow_SmoothnessMax=0.95;\nfloat reflectivityLuminance=getLuminance(reflectivityColor);\nfloat reflectivityLuma=sqrt(reflectivityLuminance);\nmicroSurface=reflectivityLuma*kReflectivityNoAlphaWorkflow_SmoothnessMax;\nreturn microSurface;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name72]=shader72;// node_modules/@babylonjs/core/Shaders/ShadersInclude/harmonicsFunctions.js
var name73="harmonicsFunctions";var shader73="#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nreturn vSphericalL00\n+ vSphericalL1_1*(normal.y)\n+ vSphericalL10*(normal.z)\n+ vSphericalL11*(normal.x)\n+ vSphericalL2_2*(normal.y*normal.x)\n+ vSphericalL2_1*(normal.y*normal.z)\n+ vSphericalL20*((3.0*normal.z*normal.z)-1.0)\n+ vSphericalL21*(normal.z*normal.x)\n+ vSphericalL22*(normal.x*normal.x-(normal.y*normal.y));\n}\n#else\nvec3 computeEnvironmentIrradiance(vec3 normal) {\nfloat Nx=normal.x;\nfloat Ny=normal.y;\nfloat Nz=normal.z;\nvec3 C1=vSphericalZZ.rgb;\nvec3 Cx=vSphericalX.rgb;\nvec3 Cy=vSphericalY.rgb;\nvec3 Cz=vSphericalZ.rgb;\nvec3 Cxx_zz=vSphericalXX_ZZ.rgb;\nvec3 Cyy_zz=vSphericalYY_ZZ.rgb;\nvec3 Cxy=vSphericalXY.rgb;\nvec3 Cyz=vSphericalYZ.rgb;\nvec3 Czx=vSphericalZX.rgb;\nvec3 a1=Cyy_zz*Ny+Cy;\nvec3 a2=Cyz*Nz+a1;\nvec3 b1=Czx*Nz+Cx;\nvec3 b2=Cxy*Ny+b1;\nvec3 b3=Cxx_zz*Nx+b2;\nvec3 t1=Cz *Nz+C1;\nvec3 t2=a2 *Ny+t1;\nvec3 t3=b3 *Nx+t2;\nreturn t3;\n}\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name73]=shader73;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingSetupFunctions.js
var name74="pbrDirectLightingSetupFunctions";var shader74="struct preLightingInfo\n{\nvec3 lightOffset;\nfloat lightDistanceSquared;\nfloat lightDistance;\nfloat attenuation;\nvec3 L;\nvec3 H;\nfloat NdotV;\nfloat NdotLUnclamped;\nfloat NdotL;\nfloat VdotH;\nfloat roughness;\n#ifdef IRIDESCENCE\nfloat iridescenceIntensity;\n#endif\n};\npreLightingInfo computePointAndSpotPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightOffset=lightData.xyz-vPositionW;\nresult.lightDistanceSquared=dot(result.lightOffset,result.lightOffset);\nresult.lightDistance=sqrt(result.lightDistanceSquared);\nresult.L=normalize(result.lightOffset);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeDirectionalPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.lightDistance=length(-lightData.xyz);\nresult.L=normalize(-lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\nresult.NdotLUnclamped=dot(N,result.L);\nresult.NdotL=saturateEps(result.NdotLUnclamped);\nreturn result;\n}\npreLightingInfo computeHemisphericPreLightingInfo(vec4 lightData,vec3 V,vec3 N) {\npreLightingInfo result;\nresult.NdotL=dot(N,lightData.xyz)*0.5+0.5;\nresult.NdotL=saturateEps(result.NdotL);\nresult.NdotLUnclamped=result.NdotL;\n#ifdef SPECULARTERM\nresult.L=normalize(lightData.xyz);\nresult.H=normalize(V+result.L);\nresult.VdotH=saturate(dot(V,result.H));\n#endif\nreturn result;\n}";ShaderStore.IncludesShadersStore[name74]=shader74;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingFalloffFunctions.js
var name75="pbrDirectLightingFalloffFunctions";var shader75="float computeDistanceLightFalloff_Standard(vec3 lightOffset,float range)\n{\nreturn max(0.,1.0-length(lightOffset)/range);\n}\nfloat computeDistanceLightFalloff_Physical(float lightDistanceSquared)\n{\nreturn 1.0/maxEps(lightDistanceSquared);\n}\nfloat computeDistanceLightFalloff_GLTF(float lightDistanceSquared,float inverseSquaredRange)\n{\nfloat lightDistanceFalloff=1.0/maxEps(lightDistanceSquared);\nfloat factor=lightDistanceSquared*inverseSquaredRange;\nfloat attenuation=saturate(1.0-factor*factor);\nattenuation*=attenuation;\nlightDistanceFalloff*=attenuation;\nreturn lightDistanceFalloff;\n}\nfloat computeDistanceLightFalloff(vec3 lightOffset,float lightDistanceSquared,float range,float inverseSquaredRange)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDistanceLightFalloff_Physical(lightDistanceSquared);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDistanceLightFalloff_GLTF(lightDistanceSquared,inverseSquaredRange);\n#else\nreturn computeDistanceLightFalloff_Standard(lightOffset,range);\n#endif\n}\nfloat computeDirectionalLightFalloff_Standard(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent)\n{\nfloat falloff=0.0;\nfloat cosAngle=maxEps(dot(-lightDirection,directionToLightCenterW));\nif (cosAngle>=cosHalfAngle)\n{\nfalloff=max(0.,pow(cosAngle,exponent));\n}\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_Physical(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle)\n{\nconst float kMinusLog2ConeAngleIntensityRatio=6.64385618977; \nfloat concentrationKappa=kMinusLog2ConeAngleIntensityRatio/(1.0-cosHalfAngle);\nvec4 lightDirectionSpreadSG=vec4(-lightDirection*concentrationKappa,-concentrationKappa);\nfloat falloff=exp2(dot(vec4(directionToLightCenterW,1.0),lightDirectionSpreadSG));\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff_GLTF(vec3 lightDirection,vec3 directionToLightCenterW,float lightAngleScale,float lightAngleOffset)\n{\nfloat cd=dot(-lightDirection,directionToLightCenterW);\nfloat falloff=saturate(cd*lightAngleScale+lightAngleOffset);\nfalloff*=falloff;\nreturn falloff;\n}\nfloat computeDirectionalLightFalloff(vec3 lightDirection,vec3 directionToLightCenterW,float cosHalfAngle,float exponent,float lightAngleScale,float lightAngleOffset)\n{\n#ifdef USEPHYSICALLIGHTFALLOFF\nreturn computeDirectionalLightFalloff_Physical(lightDirection,directionToLightCenterW,cosHalfAngle);\n#elif defined(USEGLTFLIGHTFALLOFF)\nreturn computeDirectionalLightFalloff_GLTF(lightDirection,directionToLightCenterW,lightAngleScale,lightAngleOffset);\n#else\nreturn computeDirectionalLightFalloff_Standard(lightDirection,directionToLightCenterW,cosHalfAngle,exponent);\n#endif\n}";ShaderStore.IncludesShadersStore[name75]=shader75;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBRDFFunctions.js
var name76="pbrBRDFFunctions";var shader76="#define FRESNEL_MAXIMUM_ON_ROUGH 0.25\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\nreturn 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);\n}\n#endif\n#ifdef ENVIRONMENTBRDF\nvec3 getBRDFLookup(float NdotV,float perceptualRoughness) {\nvec2 UV=vec2(NdotV,perceptualRoughness);\nvec4 brdfLookup=texture2D(environmentBrdfSampler,UV);\n#ifdef ENVIRONMENTBRDF_RGBD\nbrdfLookup.rgb=fromRGBD(brdfLookup.rgba);\n#endif\nreturn brdfLookup.rgb;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;\n#endif\nreturn reflectance;\n}\nvec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {\n#ifdef BRDF_V_HEIGHT_CORRELATED\nvec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);\n#else\nvec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;\n#endif\nreturn reflectance;\n}\n#endif\n/* NOT USED\n#if defined(SHEEN) && defined(SHEEN_SOFTER)\nfloat getBRDFLookupCharlieSheen(float NdotV,float perceptualRoughness)\n{\nfloat c=1.0-NdotV;\nfloat c3=c*c*c;\nreturn 0.65584461*c3+1.0/(4.16526551+exp(-7.97291361*perceptualRoughness+6.33516894));\n}\n#endif\n*/\n#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)\nvec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)\n{\nfloat weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);\nreturn reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));\n}\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\n/**\n* The sheen BRDF not containing F can be easily stored in the blue channel of the BRDF texture.\n* The blue channel contains DCharlie*VAshikhmin*NdotL as a lokkup table\n*/\nvec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {\nvec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;\nreturn sheenEnvironmentReflectance;\n}\n#endif\nvec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\nfloat fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)\n{\nreturn reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);\n}\n#ifdef CLEARCOAT\nvec3 getR0RemappedForClearCoat(vec3 f0) {\n#ifdef CLEARCOAT_DEFAULTIOR\n#ifdef MOBILE\nreturn saturate(f0*(f0*0.526868+0.529324)-0.0482256);\n#else\nreturn saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);\n#endif\n#else\nvec3 s=sqrt(f0);\nvec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);\nreturn square(t);\n#endif\n}\n#endif\n#ifdef IRIDESCENCE\nconst mat3 XYZ_TO_REC709=mat3(\n3.2404542,-0.9692660, 0.0556434,\n-1.5371385, 1.8760108,-0.2040259,\n-0.4985314, 0.0415560, 1.0572252\n);\nvec3 getIORTfromAirToSurfaceR0(vec3 f0) {\nvec3 sqrtF0=sqrt(f0);\nreturn (1.+sqrtF0)/(1.-sqrtF0);\n}\nvec3 getR0fromIORs(vec3 iorT,float iorI) {\nreturn square((iorT-vec3(iorI))/(iorT+vec3(iorI)));\n}\nfloat getR0fromIORs(float iorT,float iorI) {\nreturn square((iorT-iorI)/(iorT+iorI));\n}\nvec3 evalSensitivity(float opd,vec3 shift) {\nfloat phase=2.0*PI*opd*1.0e-9;\nconst vec3 val=vec3(5.4856e-13,4.4201e-13,5.2481e-13);\nconst vec3 pos=vec3(1.6810e+06,1.7953e+06,2.2084e+06);\nconst vec3 var=vec3(4.3278e+09,9.3046e+09,6.6121e+09);\nvec3 xyz=val*sqrt(2.0*PI*var)*cos(pos*phase+shift)*exp(-square(phase)*var);\nxyz.x+=9.7470e-14*sqrt(2.0*PI*4.5282e+09)*cos(2.2399e+06*phase+shift[0])*exp(-4.5282e+09*square(phase));\nxyz/=1.0685e-7;\nvec3 srgb=XYZ_TO_REC709*xyz;\nreturn srgb;\n}\nvec3 evalIridescence(float outsideIOR,float eta2,float cosTheta1,float thinFilmThickness,vec3 baseF0) {\nvec3 I=vec3(1.0);\nfloat iridescenceIOR=mix(outsideIOR,eta2,smoothstep(0.0,0.03,thinFilmThickness));\nfloat sinTheta2Sq=square(outsideIOR/iridescenceIOR)*(1.0-square(cosTheta1));\nfloat cosTheta2Sq=1.0-sinTheta2Sq;\nif (cosTheta2Sq<0.0) {\nreturn I;\n}\nfloat cosTheta2=sqrt(cosTheta2Sq);\nfloat R0=getR0fromIORs(iridescenceIOR,outsideIOR);\nfloat R12=fresnelSchlickGGX(cosTheta1,R0,1.);\nfloat R21=R12;\nfloat T121=1.0-R12;\nfloat phi12=0.0;\nif (iridescenceIOR<outsideIOR) phi12=PI;\nfloat phi21=PI-phi12;\nvec3 baseIOR=getIORTfromAirToSurfaceR0(clamp(baseF0,0.0,0.9999)); \nvec3 R1=getR0fromIORs(baseIOR,iridescenceIOR);\nvec3 R23=fresnelSchlickGGX(cosTheta2,R1,vec3(1.));\nvec3 phi23=vec3(0.0);\nif (baseIOR[0]<iridescenceIOR) phi23[0]=PI;\nif (baseIOR[1]<iridescenceIOR) phi23[1]=PI;\nif (baseIOR[2]<iridescenceIOR) phi23[2]=PI;\nfloat opd=2.0*iridescenceIOR*thinFilmThickness*cosTheta2;\nvec3 phi=vec3(phi21)+phi23;\nvec3 R123=clamp(R12*R23,1e-5,0.9999);\nvec3 r123=sqrt(R123);\nvec3 Rs=square(T121)*R23/(vec3(1.0)-R123);\nvec3 C0=R12+Rs;\nI=C0;\nvec3 Cm=Rs-T121;\nfor (int m=1; m<=2; ++m)\n{\nCm*=r123;\nvec3 Sm=2.0*evalSensitivity(float(m)*opd,float(m)*phi);\nI+=Cm*Sm;\n}\nreturn max(I,vec3(0.0));\n}\n#endif\nfloat normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)\n{\nfloat a2=square(alphaG);\nfloat d=NdotH*NdotH*(a2-1.0)+1.0;\nreturn a2/(PI*d*d);\n}\n#ifdef SHEEN\nfloat normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)\n{\nfloat invR=1./alphaG;\nfloat cos2h=NdotH*NdotH;\nfloat sin2h=1.-cos2h;\nreturn (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);\n}\n#endif\n#ifdef ANISOTROPIC\nfloat normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {\nfloat a2=alphaTB.x*alphaTB.y;\nvec3 v=vec3(alphaTB.y*TdotH,alphaTB.x *BdotH,a2*NdotH);\nfloat v2=dot(v,v);\nfloat w2=a2/v2;\nreturn a2*w2*w2*RECIPROCAL_PI;\n}\n#endif\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {\n#ifdef MOBILE\nfloat GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);\nfloat GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);\nreturn 0.5/(GGXV+GGXL);\n#else\nfloat a2=alphaG*alphaG;\nfloat GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);\nfloat GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);\nreturn 0.5/(GGXV+GGXL);\n#endif\n}\n#else\nfloat smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)\n{\n#ifdef MOBILE\nreturn 1.0/(dot+alphaG+(1.0-alphaG)*dot ));\n#else\nfloat alphaSquared=alphaG*alphaG;\nreturn 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));\n#endif\n}\nfloat smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)\n{\nfloat visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);\nreturn visibility;\n}\n#endif\n#ifdef ANISOTROPIC\nfloat smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {\nfloat lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));\nfloat lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));\nfloat v=0.5/(lambdaV+lambdaL);\nreturn v;\n}\n#endif\n#ifdef CLEARCOAT\nfloat visibility_Kelemen(float VdotH) {\nreturn 0.25/(VdotH*VdotH); \n}\n#endif\n#ifdef SHEEN\nfloat visibility_Ashikhmin(float NdotL,float NdotV)\n{\nreturn 1./(4.*(NdotL+NdotV-NdotL*NdotV));\n}\n/* NOT USED\n#ifdef SHEEN_SOFTER\nfloat l(float x,float alphaG)\n{\nfloat oneMinusAlphaSq=(1.0-alphaG)*(1.0-alphaG);\nfloat a=mix(21.5473,25.3245,oneMinusAlphaSq);\nfloat b=mix(3.82987,3.32435,oneMinusAlphaSq);\nfloat c=mix(0.19823,0.16801,oneMinusAlphaSq);\nfloat d=mix(-1.97760,-1.27393,oneMinusAlphaSq);\nfloat e=mix(-4.32054,-4.85967,oneMinusAlphaSq);\nreturn a/(1.0+b*pow(x,c))+d*x+e;\n}\nfloat lambdaSheen(float cosTheta,float alphaG)\n{\nreturn abs(cosTheta)<0.5 ? exp(l(cosTheta,alphaG)) : exp(2.0*l(0.5,alphaG)-l(1.0-cosTheta,alphaG));\n}\nfloat visibility_CharlieSheen(float NdotL,float NdotV,float alphaG)\n{\nfloat G=1.0/(1.0+lambdaSheen(NdotV,alphaG)+lambdaSheen(NdotL,alphaG));\nreturn G/(4.0*NdotV*NdotL);\n}\n#endif\n*/\n#endif\nfloat diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {\nfloat diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));\nfloat diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));\nfloat diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;\nfloat fresnel =\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *\n(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);\nreturn fresnel/PI;\n}\n#ifdef SS_TRANSLUCENCY\nvec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {\nvec3 S=1./maxEps(diffusionDistance);\nvec3 temp=exp((-0.333333333*thickness)*S);\nreturn tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);\n}\nfloat computeWrappedDiffuseNdotL(float NdotL,float w) {\nfloat t=1.0+w;\nfloat invt2=1.0/square(t);\nreturn saturate((NdotL+w)*invt2);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name76]=shader76;// node_modules/@babylonjs/core/Shaders/ShadersInclude/hdrFilteringFunctions.js
var name77="hdrFilteringFunctions";var shader77="#ifdef NUM_SAMPLES\n#if NUM_SAMPLES>0\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfloat radicalInverse_VdC(uint bits) \n{\nbits=(bits<<16u) | (bits>>16u);\nbits=((bits & 0x55555555u)<<1u) | ((bits & 0xAAAAAAAAu)>>1u);\nbits=((bits & 0x33333333u)<<2u) | ((bits & 0xCCCCCCCCu)>>2u);\nbits=((bits & 0x0F0F0F0Fu)<<4u) | ((bits & 0xF0F0F0F0u)>>4u);\nbits=((bits & 0x00FF00FFu)<<8u) | ((bits & 0xFF00FF00u)>>8u);\nreturn float(bits)*2.3283064365386963e-10; \n}\nvec2 hammersley(uint i,uint N)\n{\nreturn vec2(float(i)/float(N),radicalInverse_VdC(i));\n}\n#else\nfloat vanDerCorpus(int n,int base)\n{\nfloat invBase=1.0/float(base);\nfloat denom =1.0;\nfloat result =0.0;\nfor(int i=0; i<32; ++i)\n{\nif(n>0)\n{\ndenom =mod(float(n),2.0);\nresult+=denom*invBase;\ninvBase=invBase/2.0;\nn =int(float(n)/2.0);\n}\n}\nreturn result;\n}\nvec2 hammersley(int i,int N)\n{\nreturn vec2(float(i)/float(N),vanDerCorpus(i,2));\n}\n#endif\nfloat log4(float x) {\nreturn log2(x)/2.;\n}\nconst float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);\nconst float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;\nconst float K=4.;\n#define inline\nvec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nvec3 result=vec3(0.0);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 Ls=hemisphereCosSample(Xi);\nLs=normalize(Ls);\nvec3 Ns=vec3(0.,0.,1.);\nfloat NoL=dot(Ns,Ls);\nif (NoL>0.) {\nfloat pdf_inversed=PI/NoL;\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(l,0.0,maxLevel);\nvec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c;\n}\n}\nresult=result*NUM_SAMPLES_FLOAT_INVERSED;\nreturn result;\n}\n#define inline\nvec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)\n{\nvec3 n=normalize(inputN);\nif (alphaG==0.) {\nvec3 c=textureCube(inputTexture,n).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nreturn c;\n} else {\nvec3 result=vec3(0.);\nvec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);\ntangent=normalize(cross(tangent,n));\nvec3 bitangent=cross(n,tangent);\nmat3 tbn=mat3(tangent,bitangent,n);\nfloat maxLevel=filteringInfo.y;\nfloat dim0=filteringInfo.x;\nfloat omegaP=(4.*PI)/(6.*dim0*dim0);\nfloat weight=0.;\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nfor(uint i=0u; i<NUM_SAMPLES; ++i)\n#else\nfor(int i=0; i<NUM_SAMPLES; ++i)\n#endif\n{\nvec2 Xi=hammersley(i,NUM_SAMPLES);\nvec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);\nfloat NoV=1.;\nfloat NoH=H.z;\nfloat NoH2=H.z*H.z;\nfloat NoL=2.*NoH2-1.;\nvec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);\nL=normalize(L);\nif (NoL>0.) {\nfloat pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);\nfloat omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;\nfloat l=log4(omegaS)-log4(omegaP)+log4(K);\nfloat mipLevel=clamp(float(l),0.0,maxLevel);\nweight+=NoL;\nvec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;\n#ifdef GAMMA_INPUT\nc=toLinearSpace(c);\n#endif\nresult+=c*NoL;\n}\n}\nresult=result/weight;\nreturn result;\n}\n}\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name77]=shader77;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDirectLightingFunctions.js
var name78="pbrDirectLightingFunctions";var shader78="#define CLEARCOATREFLECTANCE90 1.0\nstruct lightingInfo\n{\nvec3 diffuse;\n#ifdef SPECULARTERM\nvec3 specular;\n#endif\n#ifdef CLEARCOAT\nvec4 clearCoat;\n#endif\n#ifdef SHEEN\nvec3 sheen;\n#endif\n};\nfloat adjustRoughnessFromLightProperties(float roughness,float lightRadius,float lightDistance) {\n#if defined(USEPHYSICALLIGHTFALLOFF) || defined(USEGLTFLIGHTFALLOFF)\nfloat lightRoughness=lightRadius/lightDistance;\nfloat totalRoughness=saturate(lightRoughness+roughness);\nreturn totalRoughness;\n#else\nreturn roughness;\n#endif\n}\nvec3 computeHemisphericDiffuseLighting(preLightingInfo info,vec3 lightColor,vec3 groundColor) {\nreturn mix(groundColor,lightColor,info.NdotL);\n}\nvec3 computeDiffuseLighting(preLightingInfo info,vec3 lightColor) {\nfloat diffuseTerm=diffuseBRDF_Burley(info.NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*info.attenuation*info.NdotL*lightColor;\n}\n#define inline\nvec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){\nvec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);\nstrq/=strq.w;\nvec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;\nreturn toLinearSpace(textureColor);\n}\n#ifdef SS_TRANSLUCENCY\nvec3 computeDiffuseAndTransmittedLighting(preLightingInfo info,vec3 lightColor,vec3 transmittance) {\nfloat NdotL=absEps(info.NdotLUnclamped);\nfloat wrapNdotL=computeWrappedDiffuseNdotL(NdotL,0.02);\nfloat trAdapt=step(0.,info.NdotLUnclamped);\nvec3 transmittanceNdotL=mix(transmittance*wrapNdotL,vec3(wrapNdotL),trAdapt);\nfloat diffuseTerm=diffuseBRDF_Burley(NdotL,info.NdotV,info.VdotH,info.roughness);\nreturn diffuseTerm*transmittanceNdotL*info.attenuation*lightColor;\n}\n#endif\n#ifdef SPECULARTERM\nvec3 computeSpecularLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NdotH,alphaG);\n#ifdef BRDF_V_HEIGHT_CORRELATED\nfloat smithVisibility=smithVisibility_GGXCorrelated(info.NdotL,info.NdotV,alphaG);\n#else\nfloat smithVisibility=smithVisibility_TrowbridgeReitzGGXFast(info.NdotL,info.NdotV,alphaG);\n#endif\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef ANISOTROPIC\nvec3 computeAnisotropicSpecularLighting(preLightingInfo info,vec3 V,vec3 N,vec3 T,vec3 B,float anisotropy,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat TdotH=dot(T,info.H);\nfloat BdotH=dot(B,info.H);\nfloat TdotV=dot(T,V);\nfloat BdotV=dot(B,V);\nfloat TdotL=dot(T,info.L);\nfloat BdotL=dot(B,info.L);\nfloat alphaG=convertRoughnessToAverageSlope(info.roughness);\nvec2 alphaTB=getAnisotropicRoughness(alphaG,anisotropy);\nalphaTB=max(alphaTB,square(geometricRoughnessFactor));\nvec3 fresnel=fresnelSchlickGGX(info.VdotH,reflectance0,reflectance90);\n#ifdef IRIDESCENCE\nfresnel=mix(fresnel,reflectance0,info.iridescenceIntensity);\n#endif\nfloat distribution=normalDistributionFunction_BurleyGGX_Anisotropic(NdotH,TdotH,BdotH,alphaTB);\nfloat smithVisibility=smithVisibility_GGXCorrelated_Anisotropic(info.NdotL,info.NdotV,TdotV,BdotV,TdotL,BdotL,alphaTB);\nvec3 specTerm=fresnel*distribution*smithVisibility;\nreturn specTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n#ifdef CLEARCOAT\nvec4 computeClearCoatLighting(preLightingInfo info,vec3 Ncc,float geometricRoughnessFactor,float clearCoatIntensity,vec3 lightColor) {\nfloat NccdotL=saturateEps(dot(Ncc,info.L));\nfloat NccdotH=saturateEps(dot(Ncc,info.H));\nfloat clearCoatRoughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\nfloat fresnel=fresnelSchlickGGX(info.VdotH,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnel*=clearCoatIntensity;\nfloat distribution=normalDistributionFunction_TrowbridgeReitzGGX(NccdotH,alphaG);\nfloat kelemenVisibility=visibility_Kelemen(info.VdotH);\nfloat clearCoatTerm=fresnel*distribution*kelemenVisibility;\nreturn vec4(\nclearCoatTerm*info.attenuation*NccdotL*lightColor,\n1.0-fresnel\n);\n}\nvec3 computeClearCoatLightingAbsorption(float NdotVRefract,vec3 L,vec3 Ncc,vec3 clearCoatColor,float clearCoatThickness,float clearCoatIntensity) {\nvec3 LRefract=-refract(L,Ncc,vClearCoatRefractionParams.y);\nfloat NdotLRefract=saturateEps(dot(Ncc,LRefract));\nvec3 absorption=computeClearCoatAbsorption(NdotVRefract,NdotLRefract,clearCoatColor,clearCoatThickness,clearCoatIntensity);\nreturn absorption;\n}\n#endif\n#ifdef SHEEN\nvec3 computeSheenLighting(preLightingInfo info,vec3 N,vec3 reflectance0,vec3 reflectance90,float geometricRoughnessFactor,vec3 lightColor) {\nfloat NdotH=saturateEps(dot(N,info.H));\nfloat roughness=max(info.roughness,geometricRoughnessFactor);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nfloat fresnel=1.;\nfloat distribution=normalDistributionFunction_CharlieSheen(NdotH,alphaG);\n/*#ifdef SHEEN_SOFTER\nfloat visibility=visibility_CharlieSheen(info.NdotL,info.NdotV,alphaG);\n#else */\nfloat visibility=visibility_Ashikhmin(info.NdotL,info.NdotV);\n/* #endif */\nfloat sheenTerm=fresnel*distribution*visibility;\nreturn sheenTerm*info.attenuation*info.NdotL*lightColor;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name78]=shader78;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrIBLFunctions.js
var name79="pbrIBLFunctions";var shader79="#if defined(REFLECTION) || defined(SS_REFRACTION)\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float microsurfaceAverageSlope) {\nfloat microsurfaceAverageSlopeTexels=cubeMapDimensionPixels*microsurfaceAverageSlope;\nfloat lod=log2(microsurfaceAverageSlopeTexels);\nreturn lod;\n}\nfloat getLinearLodFromRoughness(float cubeMapDimensionPixels,float roughness) {\nfloat lod=log2(cubeMapDimensionPixels)*roughness;\nreturn lod;\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(RADIANCEOCCLUSION)\nfloat environmentRadianceOcclusion(float ambientOcclusion,float NdotVUnclamped) {\nfloat temp=NdotVUnclamped+ambientOcclusion;\nreturn saturate(square(temp)-1.0+ambientOcclusion);\n}\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(HORIZONOCCLUSION)\nfloat environmentHorizonOcclusion(vec3 view,vec3 normal,vec3 geometricNormal) {\nvec3 reflection=reflect(view,normal);\nfloat temp=saturate(1.0+1.1*dot(reflection,geometricNormal));\nreturn square(temp);\n}\n#endif\n#if defined(LODINREFLECTIONALPHA) || defined(SS_LODINREFRACTIONALPHA)\n#define UNPACK_LOD(x) (1.0-x)*255.0\nfloat getLodFromAlphaG(float cubeMapDimensionPixels,float alphaG,float NdotV) {\nfloat microsurfaceAverageSlope=alphaG;\nmicrosurfaceAverageSlope*=sqrt(abs(NdotV));\nreturn getLodFromAlphaG(cubeMapDimensionPixels,microsurfaceAverageSlope);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name79]=shader79;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAlbedoOpacity.js
var name80="pbrBlockAlbedoOpacity";var shader80="struct albedoOpacityOutParams\n{\nvec3 surfaceAlbedo;\nfloat alpha;\n};\n#define pbr_inline\nvoid albedoOpacityBlock(\nin vec4 vAlbedoColor,\n#ifdef ALBEDO\nin vec4 albedoTexture,\nin vec2 albedoInfos,\n#endif\n#ifdef OPACITY\nin vec4 opacityMap,\nin vec2 vOpacityInfos,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout albedoOpacityOutParams outParams\n)\n{\nvec3 surfaceAlbedo=vAlbedoColor.rgb;\nfloat alpha=vAlbedoColor.a;\n#ifdef ALBEDO\n#if defined(ALPHAFROMALBEDO) || defined(ALPHATEST)\nalpha*=albedoTexture.a;\n#endif\n#ifdef GAMMAALBEDO\nsurfaceAlbedo*=toLinearSpace(albedoTexture.rgb);\n#else\nsurfaceAlbedo*=albedoTexture.rgb;\n#endif\nsurfaceAlbedo*=albedoInfos.y;\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nsurfaceAlbedo*=vColor.rgb;\n#endif\n#ifdef DETAIL\nfloat detailAlbedo=2.0*mix(0.5,detailColor.r,vDetailInfos.y);\nsurfaceAlbedo.rgb=surfaceAlbedo.rgb*detailAlbedo*detailAlbedo; \n#endif\n#define CUSTOM_FRAGMENT_UPDATE_ALBEDO\n#ifdef OPACITY\n#ifdef OPACITYRGB\nalpha=getLuminance(opacityMap.rgb);\n#else\nalpha*=opacityMap.a;\n#endif\nalpha*=vOpacityInfos.y;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if !defined(SS_LINKREFRACTIONTOTRANSPARENCY) && !defined(ALPHAFRESNEL)\n#ifdef ALPHATEST\nif (alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\nalpha=1.0;\n#endif\n#endif\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo;\noutParams.alpha=alpha;\n}\n";ShaderStore.IncludesShadersStore[name80]=shader80;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectivity.js
var name81="pbrBlockReflectivity";var shader81="struct reflectivityOutParams\n{\nfloat microSurface;\nfloat roughness;\nvec3 surfaceReflectivityColor;\n#ifdef METALLICWORKFLOW\nvec3 surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nvec3 ambientOcclusionColor;\n#endif\n#if DEBUGMODE>0\nvec4 surfaceMetallicColorMap;\nvec4 surfaceReflectivityColorMap;\nvec2 metallicRoughness;\nvec3 metallicF0;\n#endif\n};\n#define pbr_inline\nvoid reflectivityBlock(\nin vec4 vReflectivityColor,\n#ifdef METALLICWORKFLOW\nin vec3 surfaceAlbedo,\nin vec4 metallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nin vec3 reflectivityInfos,\nin vec4 surfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\nin vec3 ambientOcclusionColorIn,\n#endif\n#ifdef MICROSURFACEMAP\nin vec4 microSurfaceTexel,\n#endif\n#ifdef DETAIL\nin vec4 detailColor,\nin vec4 vDetailInfos,\n#endif\nout reflectivityOutParams outParams\n)\n{\nfloat microSurface=vReflectivityColor.a;\nvec3 surfaceReflectivityColor=vReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec2 metallicRoughness=surfaceReflectivityColor.rg;\n#ifdef REFLECTIVITY\n#if DEBUGMODE>0\noutParams.surfaceMetallicColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef AOSTOREINMETALMAPRED\nvec3 aoStoreInMetalMap=vec3(surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r,surfaceMetallicOrReflectivityColorMap.r);\noutParams.ambientOcclusionColor=mix(ambientOcclusionColorIn,aoStoreInMetalMap,reflectivityInfos.z);\n#endif\n#ifdef METALLNESSSTOREINMETALMAPBLUE\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.b;\n#else\nmetallicRoughness.r*=surfaceMetallicOrReflectivityColorMap.r;\n#endif\n#ifdef ROUGHNESSSTOREINMETALMAPALPHA\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.a;\n#else\n#ifdef ROUGHNESSSTOREINMETALMAPGREEN\nmetallicRoughness.g*=surfaceMetallicOrReflectivityColorMap.g;\n#endif\n#endif\n#endif\n#ifdef DETAIL\nfloat detailRoughness=mix(0.5,detailColor.b,vDetailInfos.w);\nfloat loLerp=mix(0.,metallicRoughness.g,detailRoughness*2.);\nfloat hiLerp=mix(metallicRoughness.g,1.,(detailRoughness-0.5)*2.);\nmetallicRoughness.g=mix(loLerp,hiLerp,step(detailRoughness,0.5));\n#endif\n#ifdef MICROSURFACEMAP\nmetallicRoughness.g*=microSurfaceTexel.r;\n#endif\n#if DEBUGMODE>0\noutParams.metallicRoughness=metallicRoughness;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_METALLICROUGHNESS\nmicroSurface=1.0-metallicRoughness.g;\nvec3 baseColor=surfaceAlbedo;\n#ifdef FROSTBITE_REFLECTANCE\noutParams.surfaceAlbedo=baseColor.rgb*(1.0-metallicRoughness.r);\nsurfaceReflectivityColor=mix(0.16*reflectance*reflectance,baseColor,metallicRoughness.r);\n#else\nvec3 metallicF0=metallicReflectanceFactors.rgb;\n#if DEBUGMODE>0\noutParams.metallicF0=metallicF0;\n#endif\noutParams.surfaceAlbedo=mix(baseColor.rgb*(1.0-metallicF0),vec3(0.,0.,0.),metallicRoughness.r);\nsurfaceReflectivityColor=mix(metallicF0,baseColor,metallicRoughness.r);\n#endif\n#else\n#ifdef REFLECTIVITY\nsurfaceReflectivityColor*=surfaceMetallicOrReflectivityColorMap.rgb;\n#if DEBUGMODE>0\noutParams.surfaceReflectivityColorMap=surfaceMetallicOrReflectivityColorMap;\n#endif\n#ifdef MICROSURFACEFROMREFLECTIVITYMAP\nmicroSurface*=surfaceMetallicOrReflectivityColorMap.a;\nmicroSurface*=reflectivityInfos.z;\n#else\n#ifdef MICROSURFACEAUTOMATIC\nmicroSurface*=computeDefaultMicroSurface(microSurface,surfaceReflectivityColor);\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurface*=microSurfaceTexel.r;\n#endif\n#define CUSTOM_FRAGMENT_UPDATE_MICROSURFACE\n#endif\n#endif\n#endif\nmicroSurface=saturate(microSurface);\nfloat roughness=1.-microSurface;\noutParams.microSurface=microSurface;\noutParams.roughness=roughness;\noutParams.surfaceReflectivityColor=surfaceReflectivityColor;\n}\n";ShaderStore.IncludesShadersStore[name81]=shader81;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAmbientOcclusion.js
var name82="pbrBlockAmbientOcclusion";var shader82="struct ambientOcclusionOutParams\n{\nvec3 ambientOcclusionColor;\n#if DEBUGMODE>0\nvec3 ambientOcclusionColorMap;\n#endif\n};\n#define pbr_inline\nvoid ambientOcclusionBlock(\n#ifdef AMBIENT\nin vec3 ambientOcclusionColorMap_,\nin vec4 vAmbientInfos,\n#endif\nout ambientOcclusionOutParams outParams\n)\n{\nvec3 ambientOcclusionColor=vec3(1.,1.,1.);\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=ambientOcclusionColorMap_*vAmbientInfos.y;\n#ifdef AMBIENTINGRAYSCALE\nambientOcclusionColorMap=vec3(ambientOcclusionColorMap.r,ambientOcclusionColorMap.r,ambientOcclusionColorMap.r);\n#endif\nambientOcclusionColor=mix(ambientOcclusionColor,ambientOcclusionColorMap,vAmbientInfos.z);\n#if DEBUGMODE>0\noutParams.ambientOcclusionColorMap=ambientOcclusionColorMap;\n#endif\n#endif\noutParams.ambientOcclusionColor=ambientOcclusionColor;\n}\n";ShaderStore.IncludesShadersStore[name82]=shader82;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAlphaFresnel.js
var name83="pbrBlockAlphaFresnel";var shader83="#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nstruct alphaFresnelOutParams\n{\nfloat alpha;\n};\n#define pbr_inline\nvoid alphaFresnelBlock(\nin vec3 normalW,\nin vec3 viewDirectionW,\nin float alpha,\nin float microSurface,\nout alphaFresnelOutParams outParams\n)\n{\nfloat opacityPerceptual=alpha;\n#ifdef LINEARALPHAFRESNEL\nfloat opacity0=opacityPerceptual;\n#else\nfloat opacity0=opacityPerceptual*opacityPerceptual;\n#endif\nfloat opacity90=fresnelGrazingReflectance(opacity0);\nvec3 normalForward=faceforward(normalW,-viewDirectionW,normalW);\noutParams.alpha=getReflectanceFromAnalyticalBRDFLookup_Jones(saturate(dot(viewDirectionW,normalForward)),vec3(opacity0),vec3(opacity90),sqrt(microSurface)).x;\n#ifdef ALPHATEST\nif (outParams.alpha<ALPHATESTVALUE)\ndiscard;\n#ifndef ALPHABLEND\noutParams.alpha=1.0;\n#endif\n#endif\n}\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name83]=shader83;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockAnisotropic.js
var name84="pbrBlockAnisotropic";var shader84="#ifdef ANISOTROPIC\nstruct anisotropicOutParams\n{\nfloat anisotropy;\nvec3 anisotropicTangent;\nvec3 anisotropicBitangent;\nvec3 anisotropicNormal;\n#if DEBUGMODE>0\nvec3 anisotropyMapData;\n#endif\n};\n#define pbr_inline\nvoid anisotropicBlock(\nin vec3 vAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nin vec3 anisotropyMapData,\n#endif\nin mat3 TBN,\nin vec3 normalW,\nin vec3 viewDirectionW,\nout anisotropicOutParams outParams\n)\n{\nfloat anisotropy=vAnisotropy.b;\nvec3 anisotropyDirection=vec3(vAnisotropy.xy,0.);\n#ifdef ANISOTROPIC_TEXTURE\nanisotropy*=anisotropyMapData.b;\nanisotropyDirection.rg*=anisotropyMapData.rg*2.0-1.0;\n#if DEBUGMODE>0\noutParams.anisotropyMapData=anisotropyMapData;\n#endif\n#endif\nmat3 anisoTBN=mat3(normalize(TBN[0]),normalize(TBN[1]),normalize(TBN[2]));\nvec3 anisotropicTangent=normalize(anisoTBN*anisotropyDirection);\nvec3 anisotropicBitangent=normalize(cross(anisoTBN[2],anisotropicTangent));\noutParams.anisotropy=anisotropy;\noutParams.anisotropicTangent=anisotropicTangent;\noutParams.anisotropicBitangent=anisotropicBitangent;\noutParams.anisotropicNormal=getAnisotropicBentNormals(anisotropicTangent,anisotropicBitangent,normalW,viewDirectionW,anisotropy);\n}\n#endif\n";ShaderStore.IncludesShadersStore[name84]=shader84;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflection.js
var name85="pbrBlockReflection";var shader85="#ifdef REFLECTION\nstruct reflectionOutParams\n{\nvec4 environmentRadiance;\nvec3 environmentIrradiance;\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords;\n#else\nvec2 reflectionCoords;\n#endif\n#ifdef SS_TRANSLUCENCY\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nvec3 irradianceVector;\n#endif\n#endif\n#endif\n};\n#define pbr_inline\nvoid createReflectionCoords(\nin vec3 vPositionW,\nin vec3 normalW,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REFLECTIONMAP_3D\nout vec3 reflectionCoords\n#else\nout vec2 reflectionCoords\n#endif\n)\n{\n#ifdef ANISOTROPIC\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),anisotropicOut.anisotropicNormal);\n#else\nvec3 reflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),normalW);\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionCoords=reflectionVector;\n#else\nreflectionCoords=reflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nreflectionCoords/=reflectionVector.z;\n#endif\nreflectionCoords.y=1.0-reflectionCoords.y;\n#endif\n}\n#define pbr_inline\n#define inline\nvoid sampleReflectionTexture(\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nconst vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nconst vec2 reflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout vec4 environmentRadiance\n)\n{\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG,NdotVUnclamped);\n#elif defined(LINEARSPECULARREFLECTION)\nfloat reflectionLOD=getLinearLodFromRoughness(vReflectionMicrosurfaceInfos.x,roughness);\n#else\nfloat reflectionLOD=getLodFromAlphaG(vReflectionMicrosurfaceInfos.x,alphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nreflectionLOD=reflectionLOD*vReflectionMicrosurfaceInfos.y+vReflectionMicrosurfaceInfos.z;\n#ifdef LODINREFLECTIONALPHA\nfloat automaticReflectionLOD=UNPACK_LOD(sampleReflection(reflectionSampler,reflectionCoords).a);\nfloat requestedReflectionLOD=max(automaticReflectionLOD,reflectionLOD);\n#else\nfloat requestedReflectionLOD=reflectionLOD;\n#endif\n#ifdef REALTIME_FILTERING\nenvironmentRadiance=vec4(radiance(alphaG,reflectionSampler,reflectionCoords,vReflectionFilteringInfo),1.0);\n#else\nenvironmentRadiance=sampleReflectionLod(reflectionSampler,reflectionCoords,reflectionLOD);\n#endif\n#else\nfloat lodReflectionNormalized=saturate(reflectionLOD/log2(vReflectionMicrosurfaceInfos.x));\nfloat lodReflectionNormalizedDoubled=lodReflectionNormalized*2.0;\nvec4 environmentMid=sampleReflection(reflectionSampler,reflectionCoords);\nif (lodReflectionNormalizedDoubled<1.0){\nenvironmentRadiance=mix(\nsampleReflection(reflectionSamplerHigh,reflectionCoords),\nenvironmentMid,\nlodReflectionNormalizedDoubled\n);\n} else {\nenvironmentRadiance=mix(\nenvironmentMid,\nsampleReflection(reflectionSamplerLow,reflectionCoords),\nlodReflectionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef RGBDREFLECTION\nenvironmentRadiance.rgb=fromRGBD(environmentRadiance);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentRadiance.rgb=toLinearSpace(environmentRadiance.rgb);\n#endif\nenvironmentRadiance.rgb*=vReflectionInfos.x;\nenvironmentRadiance.rgb*=vReflectionColor.rgb;\n}\n#define pbr_inline\n#define inline\nvoid reflectionBlock(\nin vec3 vPositionW,\nin vec3 normalW,\nin float alphaG,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nin float NdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nin float roughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nin vec3 vEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin mat4 reflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\nout reflectionOutParams outParams\n)\n{\nvec4 environmentRadiance=vec4(0.,0.,0.,0.);\n#ifdef REFLECTIONMAP_3D\nvec3 reflectionCoords=vec3(0.);\n#else\nvec2 reflectionCoords=vec2(0.);\n#endif\ncreateReflectionCoords(\nvPositionW,\nnormalW,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\nreflectionCoords\n);\nsampleReflectionTexture(\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\n#ifdef REFLECTIONMAP_3D\nreflectionSampler,\nreflectionCoords,\n#else\nreflectionSampler,\nreflectionCoords,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentRadiance\n);\nvec3 environmentIrradiance=vec3(0.,0.,0.);\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nenvironmentIrradiance=vEnvironmentIrradiance;\n#else\n#ifdef ANISOTROPIC\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(anisotropicOut.anisotropicNormal,0)).xyz;\n#else\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#endif\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#if defined(REALTIME_FILTERING)\nenvironmentIrradiance=irradiance(reflectionSampler,irradianceVector,vReflectionFilteringInfo);\n#else\nenvironmentIrradiance=computeEnvironmentIrradiance(irradianceVector);\n#endif\n#ifdef SS_TRANSLUCENCY\noutParams.irradianceVector=irradianceVector;\n#endif\n#endif\n#elif defined(USEIRRADIANCEMAP)\nvec4 environmentIrradiance4=sampleReflection(irradianceSampler,reflectionCoords);\nenvironmentIrradiance=environmentIrradiance4.rgb;\n#ifdef RGBDREFLECTION\nenvironmentIrradiance.rgb=fromRGBD(environmentIrradiance4);\n#endif\n#ifdef GAMMAREFLECTION\nenvironmentIrradiance.rgb=toLinearSpace(environmentIrradiance.rgb);\n#endif\n#endif\nenvironmentIrradiance*=vReflectionColor.rgb;\noutParams.environmentRadiance=environmentRadiance;\noutParams.environmentIrradiance=environmentIrradiance;\noutParams.reflectionCoords=reflectionCoords;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name85]=shader85;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockSheen.js
var name86="pbrBlockSheen";var shader86="#ifdef SHEEN\nstruct sheenOutParams\n{\nfloat sheenIntensity;\nvec3 sheenColor;\nfloat sheenRoughness;\n#ifdef SHEEN_LINKWITHALBEDO\nvec3 surfaceAlbedo;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfloat sheenAlbedoScaling;\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nvec3 finalSheenRadianceScaled;\n#endif\n#if DEBUGMODE>0\nvec4 sheenMapData;\nvec3 sheenEnvironmentReflectance;\n#endif\n};\n#define pbr_inline\n#define inline\nvoid sheenBlock(\nin vec4 vSheenColor,\n#ifdef SHEEN_ROUGHNESS\nin float vSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 sheenMapRoughnessData,\n#endif\n#endif\nin float roughness,\n#ifdef SHEEN_TEXTURE\nin vec4 sheenMapData,\nin float sheenMapLevel,\n#endif\nin float reflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nin vec3 baseColor,\nin vec3 surfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nin float NdotV,\nin vec3 environmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nin vec2 AARoughnessFactors,\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\nin vec3 reflectionCoords,\n#else\nin sampler2D reflectionSampler,\nin vec2 reflectionCoords,\n#endif\nin float NdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nin float seo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nin float eho,\n#endif\n#endif\nout sheenOutParams outParams\n)\n{\nfloat sheenIntensity=vSheenColor.a;\n#ifdef SHEEN_TEXTURE\n#if DEBUGMODE>0\noutParams.sheenMapData=sheenMapData;\n#endif\n#endif\n#ifdef SHEEN_LINKWITHALBEDO\nfloat sheenFactor=pow5(1.0-sheenIntensity);\nvec3 sheenColor=baseColor.rgb*(1.0-sheenFactor);\nfloat sheenRoughness=sheenIntensity;\noutParams.surfaceAlbedo=surfaceAlbedo*sheenFactor;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#else\nvec3 sheenColor=vSheenColor.rgb;\n#ifdef SHEEN_TEXTURE\n#ifdef SHEEN_GAMMATEXTURE\nsheenColor.rgb*=toLinearSpace(sheenMapData.rgb);\n#else\nsheenColor.rgb*=sheenMapData.rgb;\n#endif\nsheenColor.rgb*=sheenMapLevel;\n#endif\n#ifdef SHEEN_ROUGHNESS\nfloat sheenRoughness=vSheenRoughness;\n#ifdef SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE\n#if defined(SHEEN_TEXTURE)\nsheenRoughness*=sheenMapData.a;\n#endif\n#elif defined(SHEEN_TEXTURE_ROUGHNESS)\n#ifdef SHEEN_TEXTURE_ROUGHNESS_IDENTICAL\nsheenRoughness*=sheenMapData.a;\n#else\nsheenRoughness*=sheenMapRoughnessData.a;\n#endif\n#endif\n#else\nfloat sheenRoughness=roughness;\n#ifdef SHEEN_TEXTURE\nsheenIntensity*=sheenMapData.a;\n#endif\n#endif\n#if !defined(SHEEN_ALBEDOSCALING)\nsheenIntensity*=(1.-reflectance);\n#endif\nsheenColor*=sheenIntensity;\n#endif\n#ifdef ENVIRONMENTBRDF\n/*#ifdef SHEEN_SOFTER\nvec3 environmentSheenBrdf=vec3(0.,0.,getBRDFLookupCharlieSheen(NdotV,sheenRoughness));\n#else*/\n#ifdef SHEEN_ROUGHNESS\nvec3 environmentSheenBrdf=getBRDFLookup(NdotV,sheenRoughness);\n#else\nvec3 environmentSheenBrdf=environmentBrdf;\n#endif\n/*#endif*/\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nfloat sheenAlphaG=convertRoughnessToAverageSlope(sheenRoughness);\n#ifdef SPECULARAA\nsheenAlphaG+=AARoughnessFactors.y;\n#endif\nvec4 environmentSheenRadiance=vec4(0.,0.,0.,0.);\nsampleReflectionTexture(\nsheenAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nsheenRoughness,\n#endif\nreflectionSampler,\nreflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentSheenRadiance\n);\nvec3 sheenEnvironmentReflectance=getSheenReflectanceFromBRDFLookup(sheenColor,environmentSheenBrdf);\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nsheenEnvironmentReflectance*=seo;\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\nsheenEnvironmentReflectance*=eho;\n#endif\n#if DEBUGMODE>0\noutParams.sheenEnvironmentReflectance=sheenEnvironmentReflectance;\n#endif\noutParams.finalSheenRadianceScaled=\nenvironmentSheenRadiance.rgb *\nsheenEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\noutParams.sheenAlbedoScaling=1.0-sheenIntensity*max(max(sheenColor.r,sheenColor.g),sheenColor.b)*environmentSheenBrdf.b;\n#endif\noutParams.sheenIntensity=sheenIntensity;\noutParams.sheenColor=sheenColor;\noutParams.sheenRoughness=sheenRoughness;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name86]=shader86;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockClearcoat.js
var name87="pbrBlockClearcoat";var shader87="struct clearcoatOutParams\n{\nvec3 specularEnvironmentR0;\nfloat conservationFactor;\nvec3 clearCoatNormalW;\nvec2 clearCoatAARoughnessFactors;\nfloat clearCoatIntensity;\nfloat clearCoatRoughness;\n#ifdef REFLECTION\nvec3 finalClearCoatRadianceScaled;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 absorption;\nfloat clearCoatNdotVRefract;\nvec3 clearCoatColor;\nfloat clearCoatThickness;\n#endif\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nvec3 energyConservationFactorClearCoat;\n#endif\n#if DEBUGMODE>0\nmat3 TBNClearCoat;\nvec2 clearCoatMapData;\nvec4 clearCoatTintMapData;\nvec4 environmentClearCoatRadiance;\nfloat clearCoatNdotV;\nvec3 clearCoatEnvironmentReflectance;\n#endif\n};\n#ifdef CLEARCOAT\n#define pbr_inline\n#define inline\nvoid clearcoatBlock(\nin vec3 vPositionW,\nin vec3 geometricNormalW,\nin vec3 viewDirectionW,\nin vec2 vClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nin vec4 clearCoatMapRoughnessData,\n#endif\nin vec3 specularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nin vec4 vClearCoatTintParams,\nin float clearCoatColorAtDistance,\nin vec4 vClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nin vec4 clearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nin vec2 vClearCoatBumpInfos,\nin vec4 clearCoatBumpMapData,\nin vec2 vClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nin mat3 vTBN,\n#else\nin vec2 vClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nin mat4 normalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nin vec3 faceNormal,\n#endif\n#ifdef REFLECTION\nin vec3 vReflectionMicrosurfaceInfos,\nin vec2 vReflectionInfos,\nin vec3 vReflectionColor,\nin vec4 vLightingIntensity,\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSampler,\n#else\nin sampler2D reflectionSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\n#ifdef REFLECTIONMAP_3D\nin samplerCube reflectionSamplerLow,\nin samplerCube reflectionSamplerHigh,\n#else\nin sampler2D reflectionSamplerLow,\nin sampler2D reflectionSamplerHigh,\n#endif\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nin float ambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\nin float frontFacingMultiplier,\n#endif\nout clearcoatOutParams outParams\n)\n{\nfloat clearCoatIntensity=vClearCoatParams.x;\nfloat clearCoatRoughness=vClearCoatParams.y;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#ifdef CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE\nclearCoatRoughness*=clearCoatMapData.y;\n#endif\n#if DEBUGMODE>0\noutParams.clearCoatMapData=clearCoatMapData;\n#endif\n#endif\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL\nclearCoatRoughness*=clearCoatMapData.y;\n#else\nclearCoatRoughness*=clearCoatMapRoughnessData.y;\n#endif\n#endif\noutParams.clearCoatIntensity=clearCoatIntensity;\noutParams.clearCoatRoughness=clearCoatRoughness;\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatColor=vClearCoatTintParams.rgb;\nfloat clearCoatThickness=vClearCoatTintParams.a;\n#ifdef CLEARCOAT_TINT_TEXTURE\n#ifdef CLEARCOAT_TINT_GAMMATEXTURE\nclearCoatColor*=toLinearSpace(clearCoatTintMapData.rgb);\n#else\nclearCoatColor*=clearCoatTintMapData.rgb;\n#endif\nclearCoatThickness*=clearCoatTintMapData.a;\n#if DEBUGMODE>0\noutParams.clearCoatTintMapData=clearCoatTintMapData;\n#endif\n#endif\noutParams.clearCoatColor=computeColorAtDistanceInMedia(clearCoatColor,clearCoatColorAtDistance);\noutParams.clearCoatThickness=clearCoatThickness;\n#endif\n#ifdef CLEARCOAT_REMAP_F0\nvec3 specularEnvironmentR0Updated=getR0RemappedForClearCoat(specularEnvironmentR0);\n#else\nvec3 specularEnvironmentR0Updated=specularEnvironmentR0;\n#endif\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,specularEnvironmentR0Updated,clearCoatIntensity);\nvec3 clearCoatNormalW=geometricNormalW;\n#ifdef CLEARCOAT_BUMP\n#ifdef NORMALXYSCALE\nfloat clearCoatNormalScale=1.0;\n#else\nfloat clearCoatNormalScale=vClearCoatBumpInfos.y;\n#endif\n#if defined(TANGENT) && defined(NORMAL)\nmat3 TBNClearCoat=vTBN;\n#else\nvec2 TBNClearCoatUV=vClearCoatBumpUV*frontFacingMultiplier;\nmat3 TBNClearCoat=cotangent_frame(clearCoatNormalW*clearCoatNormalScale,vPositionW,TBNClearCoatUV,vClearCoatTangentSpaceParams);\n#endif\n#if DEBUGMODE>0\noutParams.TBNClearCoat=TBNClearCoat;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nclearCoatNormalW=normalize(clearCoatBumpMapData.xyz *2.0-1.0);\nclearCoatNormalW=normalize(mat3(normalMatrix)*clearCoatNormalW);\n#else\nclearCoatNormalW=perturbNormal(TBNClearCoat,clearCoatBumpMapData.xyz,vClearCoatBumpInfos.y);\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nclearCoatNormalW*=sign(dot(clearCoatNormalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nclearCoatNormalW=clearCoatNormalW*frontFacingMultiplier;\n#endif\noutParams.clearCoatNormalW=clearCoatNormalW;\noutParams.clearCoatAARoughnessFactors=getAARoughnessFactors(clearCoatNormalW.xyz);\nfloat clearCoatNdotVUnclamped=dot(clearCoatNormalW,viewDirectionW);\nfloat clearCoatNdotV=absEps(clearCoatNdotVUnclamped);\n#if DEBUGMODE>0\noutParams.clearCoatNdotV=clearCoatNdotV;\n#endif\n#ifdef CLEARCOAT_TINT\nvec3 clearCoatVRefract=refract(-viewDirectionW,clearCoatNormalW,vClearCoatRefractionParams.y);\noutParams.clearCoatNdotVRefract=absEps(dot(clearCoatNormalW,clearCoatVRefract));\n#endif\n#if defined(ENVIRONMENTBRDF) && (!defined(REFLECTIONMAP_SKYBOX) || defined(MS_BRDF_ENERGY_CONSERVATION))\nvec3 environmentClearCoatBrdf=getBRDFLookup(clearCoatNdotV,clearCoatRoughness);\n#endif\n#if defined(REFLECTION)\nfloat clearCoatAlphaG=convertRoughnessToAverageSlope(clearCoatRoughness);\n#ifdef SPECULARAA\nclearCoatAlphaG+=outParams.clearCoatAARoughnessFactors.y;\n#endif\nvec4 environmentClearCoatRadiance=vec4(0.,0.,0.,0.);\nvec3 clearCoatReflectionVector=computeReflectionCoords(vec4(vPositionW,1.0),clearCoatNormalW);\n#ifdef REFLECTIONMAP_OPPOSITEZ\nclearCoatReflectionVector.z*=-1.0;\n#endif\n#ifdef REFLECTIONMAP_3D\nvec3 clearCoatReflectionCoords=clearCoatReflectionVector;\n#else\nvec2 clearCoatReflectionCoords=clearCoatReflectionVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nclearCoatReflectionCoords/=clearCoatReflectionVector.z;\n#endif\nclearCoatReflectionCoords.y=1.0-clearCoatReflectionCoords.y;\n#endif\nsampleReflectionTexture(\nclearCoatAlphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nclearCoatNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nclearCoatRoughness,\n#endif\nreflectionSampler,\nclearCoatReflectionCoords,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nenvironmentClearCoatRadiance\n);\n#if DEBUGMODE>0\noutParams.environmentClearCoatRadiance=environmentClearCoatRadiance;\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromBRDFLookup(vec3(vClearCoatRefractionParams.x),environmentClearCoatBrdf);\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat clearCoatEho=environmentHorizonOcclusion(-viewDirectionW,clearCoatNormalW,geometricNormalW);\nclearCoatEnvironmentReflectance*=clearCoatEho;\n#endif\n#endif\n#endif\n#else\nvec3 clearCoatEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(clearCoatNdotV,vec3(1.),vec3(1.),sqrt(1.-clearCoatRoughness));\n#endif\nclearCoatEnvironmentReflectance*=clearCoatIntensity;\n#if DEBUGMODE>0\noutParams.clearCoatEnvironmentReflectance=clearCoatEnvironmentReflectance;\n#endif\noutParams.finalClearCoatRadianceScaled=\nenvironmentClearCoatRadiance.rgb *\nclearCoatEnvironmentReflectance *\nvLightingIntensity.z;\n#endif\n#if defined(CLEARCOAT_TINT)\noutParams.absorption=computeClearCoatAbsorption(outParams.clearCoatNdotVRefract,outParams.clearCoatNdotVRefract,outParams.clearCoatColor,clearCoatThickness,clearCoatIntensity);\n#endif\nfloat fresnelIBLClearCoat=fresnelSchlickGGX(clearCoatNdotV,vClearCoatRefractionParams.x,CLEARCOATREFLECTANCE90);\nfresnelIBLClearCoat*=clearCoatIntensity;\noutParams.conservationFactor=(1.-fresnelIBLClearCoat);\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\noutParams.energyConservationFactorClearCoat=getEnergyConservationFactor(outParams.specularEnvironmentR0,environmentClearCoatBrdf);\n#endif\n}\n#endif\n";ShaderStore.IncludesShadersStore[name87]=shader87;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockIridescence.js
var name88="pbrBlockIridescence";var shader88="struct iridescenceOutParams\n{\nfloat iridescenceIntensity;\nfloat iridescenceIOR;\nfloat iridescenceThickness;\nvec3 specularEnvironmentR0;\n};\n#ifdef IRIDESCENCE\n#define pbr_inline\n#define inline\nvoid iridescenceBlock(\nin vec4 vIridescenceParams,\nin float viewAngle,\nin vec3 specularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\nin vec2 iridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nin vec2 iridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nin float NdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nin vec2 clearCoatMapData,\n#endif\n#endif\nout iridescenceOutParams outParams\n)\n{\nfloat iridescenceIntensity=vIridescenceParams.x;\nfloat iridescenceIOR=vIridescenceParams.y;\nfloat iridescenceThicknessMin=vIridescenceParams.z;\nfloat iridescenceThicknessMax=vIridescenceParams.w;\nfloat iridescenceThicknessWeight=1.;\n#ifdef IRIDESCENCE_TEXTURE\niridescenceIntensity*=iridescenceMapData.x;\n#ifdef IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE\niridescenceThicknessWeight=iridescenceMapData.g;\n#endif\n#endif\n#if defined(IRIDESCENCE_THICKNESS_TEXTURE)\niridescenceThicknessWeight=iridescenceThicknessMapData.g;\n#endif\nfloat iridescenceThickness=mix(iridescenceThicknessMin,iridescenceThicknessMax,iridescenceThicknessWeight);\nfloat topIor=1.; \n#ifdef CLEARCOAT\nfloat clearCoatIntensity=vClearCoatParams.x;\n#ifdef CLEARCOAT_TEXTURE\nclearCoatIntensity*=clearCoatMapData.x;\n#endif\ntopIor=mix(1.0,vClearCoatRefractionParams.w-1.,clearCoatIntensity);\nviewAngle=sqrt(1.0+square(1.0/topIor)*(square(NdotVUnclamped)-1.0));\n#endif\nvec3 iridescenceFresnel=evalIridescence(topIor,iridescenceIOR,viewAngle,iridescenceThickness,specularEnvironmentR0);\noutParams.specularEnvironmentR0=mix(specularEnvironmentR0,iridescenceFresnel,iridescenceIntensity);\noutParams.iridescenceIntensity=iridescenceIntensity;\noutParams.iridescenceThickness=iridescenceThickness;\noutParams.iridescenceIOR=iridescenceIOR;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name88]=shader88;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockSubSurface.js
var name89="pbrBlockSubSurface";var shader89="struct subSurfaceOutParams\n{\nvec3 specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nvec3 finalRefraction;\nvec3 surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nfloat alpha;\n#endif\n#ifdef REFLECTION\nfloat refractionFactorForIrradiance;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvec3 transmittance;\nfloat translucencyIntensity;\n#ifdef REFLECTION\nvec3 refractionIrradiance;\n#endif\n#endif\n#if DEBUGMODE>0\nvec4 thicknessMap;\nvec4 environmentRefraction;\nvec3 refractionTransmittance;\n#endif\n};\n#ifdef SUBSURFACE\n#define pbr_inline\n#define inline\nvoid subSurfaceBlock(\nin vec3 vSubSurfaceIntensity,\nin vec2 vThicknessParam,\nin vec4 vTintColor,\nin vec3 normalW,\nin vec3 specularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nin vec4 thicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nin vec4 refractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nin vec4 translucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nin mat4 reflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nin vec3 irradianceVector_,\n#endif\n#if defined(REALTIME_FILTERING)\nin samplerCube reflectionSampler,\nin vec2 vReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\n#ifdef REFLECTIONMAP_3D\nin samplerCube irradianceSampler,\n#else\nin sampler2D irradianceSampler,\n#endif\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nin vec3 surfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nin vec3 vPositionW,\nin vec3 viewDirectionW,\nin mat4 view,\nin vec4 vRefractionInfos,\nin mat4 refractionMatrix,\nin vec4 vRefractionMicrosurfaceInfos,\nin vec4 vLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nin float alpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nin float NdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nin float roughness,\n#endif\nin float alphaG,\n#ifdef SS_REFRACTIONMAP_3D\nin samplerCube refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin samplerCube refractionSamplerLow,\nin samplerCube refractionSamplerHigh,\n#endif\n#else\nin sampler2D refractionSampler,\n#ifndef LODBASEDMICROSFURACE\nin sampler2D refractionSamplerLow,\nin sampler2D refractionSamplerHigh,\n#endif\n#endif\n#ifdef ANISOTROPIC\nin anisotropicOutParams anisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nin vec2 vRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nin vec3 refractionPosition,\nin vec3 refractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nin vec3 vDiffusionDistance,\n#endif\nout subSurfaceOutParams outParams\n)\n{\noutParams.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#ifdef SS_REFRACTION\nfloat refractionIntensity=vSubSurfaceIntensity.x;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nrefractionIntensity*=(1.0-alpha);\noutParams.alpha=1.0;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nfloat translucencyIntensity=vSubSurfaceIntensity.y;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\n#if defined(SS_USE_GLTF_TEXTURES)\nfloat thickness=thicknessMap.g*vThicknessParam.y+vThicknessParam.x;\n#else\nfloat thickness=thicknessMap.r*vThicknessParam.y+vThicknessParam.x;\n#endif\n#if DEBUGMODE>0\noutParams.thicknessMap=thicknessMap;\n#endif\n#ifdef SS_MASK_FROM_THICKNESS_TEXTURE\n#if defined(SS_REFRACTION) && defined(SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE)\n#if defined(SS_USE_GLTF_TEXTURES)\nrefractionIntensity*=thicknessMap.r;\n#else\nrefractionIntensity*=thicknessMap.g;\n#endif\n#endif\n#if defined(SS_TRANSLUCENCY) && defined(SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE)\ntranslucencyIntensity*=thicknessMap.b;\n#endif\n#endif\n#else\nfloat thickness=vThicknessParam.y;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\n#ifdef SS_USE_GLTF_TEXTURES\nrefractionIntensity*=refractionIntensityMap.r;\n#else\nrefractionIntensity*=refractionIntensityMap.g;\n#endif\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensity*=translucencyIntensityMap.b;\n#endif\n#ifdef SS_TRANSLUCENCY\nthickness=maxEps(thickness);\nvec3 transmittance=transmittanceBRDF_Burley(vTintColor.rgb,vDiffusionDistance,thickness);\ntransmittance*=translucencyIntensity;\noutParams.transmittance=transmittance;\noutParams.translucencyIntensity=translucencyIntensity;\n#endif\n#ifdef SS_REFRACTION\nvec4 environmentRefraction=vec4(0.,0.,0.,0.);\n#ifdef ANISOTROPIC\nvec3 refractionVector=refract(-viewDirectionW,anisotropicOut.anisotropicNormal,vRefractionInfos.y);\n#else\nvec3 refractionVector=refract(-viewDirectionW,normalW,vRefractionInfos.y);\n#endif\n#ifdef SS_REFRACTIONMAP_OPPOSITEZ\nrefractionVector.z*=-1.0;\n#endif\n#ifdef SS_REFRACTIONMAP_3D\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nrefractionVector=parallaxCorrectNormal(vPositionW,refractionVector,refractionSize,refractionPosition);\n#endif\nrefractionVector.y=refractionVector.y*vRefractionInfos.w;\nvec3 refractionCoords=refractionVector;\nrefractionCoords=vec3(refractionMatrix*vec4(refractionCoords,0));\n#else\n#ifdef SS_USE_THICKNESS_AS_DEPTH\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*thickness,1.0)));\n#else\nvec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));\n#endif\nvec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;\nrefractionCoords.y=1.0-refractionCoords.y;\n#endif\n#ifdef SS_HAS_THICKNESS\nfloat ior=vRefractionInfos.y;\n#else\nfloat ior=vRefractionMicrosurfaceInfos.w;\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG,NdotVUnclamped);\n#elif defined(SS_LINEARSPECULARREFRACTION)\nfloat refractionRoughness=alphaG;\nrefractionRoughness=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLinearLodFromRoughness(vRefractionMicrosurfaceInfos.x,refractionRoughness);\n#else\nfloat refractionAlphaG=alphaG;\nrefractionAlphaG=mix(alphaG,0.0,clamp(ior*3.0-2.0,0.0,1.0));\nfloat refractionLOD=getLodFromAlphaG(vRefractionMicrosurfaceInfos.x,refractionAlphaG);\n#endif\n#ifdef LODBASEDMICROSFURACE\nrefractionLOD=refractionLOD*vRefractionMicrosurfaceInfos.y+vRefractionMicrosurfaceInfos.z;\n#ifdef SS_LODINREFRACTIONALPHA\nfloat automaticRefractionLOD=UNPACK_LOD(sampleRefraction(refractionSampler,refractionCoords).a);\nfloat requestedRefractionLOD=max(automaticRefractionLOD,refractionLOD);\n#else\nfloat requestedRefractionLOD=refractionLOD;\n#endif\n#if defined(REALTIME_FILTERING) && defined(SS_REFRACTIONMAP_3D)\nenvironmentRefraction=vec4(radiance(alphaG,refractionSampler,refractionCoords,vRefractionFilteringInfo),1.0);\n#else\nenvironmentRefraction=sampleRefractionLod(refractionSampler,refractionCoords,requestedRefractionLOD);\n#endif\n#else\nfloat lodRefractionNormalized=saturate(refractionLOD/log2(vRefractionMicrosurfaceInfos.x));\nfloat lodRefractionNormalizedDoubled=lodRefractionNormalized*2.0;\nvec4 environmentRefractionMid=sampleRefraction(refractionSampler,refractionCoords);\nif (lodRefractionNormalizedDoubled<1.0){\nenvironmentRefraction=mix(\nsampleRefraction(refractionSamplerHigh,refractionCoords),\nenvironmentRefractionMid,\nlodRefractionNormalizedDoubled\n);\n} else {\nenvironmentRefraction=mix(\nenvironmentRefractionMid,\nsampleRefraction(refractionSamplerLow,refractionCoords),\nlodRefractionNormalizedDoubled-1.0\n);\n}\n#endif\n#ifdef SS_RGBDREFRACTION\nenvironmentRefraction.rgb=fromRGBD(environmentRefraction);\n#endif\n#ifdef SS_GAMMAREFRACTION\nenvironmentRefraction.rgb=toLinearSpace(environmentRefraction.rgb);\n#endif\nenvironmentRefraction.rgb*=vRefractionInfos.x;\n#endif\n#ifdef SS_REFRACTION\nvec3 refractionTransmittance=vec3(refractionIntensity);\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,thickness);\n#elif defined(SS_LINKREFRACTIONTOTRANSPARENCY)\nfloat maxChannel=max(max(surfaceAlbedo.r,surfaceAlbedo.g),surfaceAlbedo.b);\nvec3 volumeAlbedo=saturate(maxChannel*surfaceAlbedo);\nenvironmentRefraction.rgb*=volumeAlbedo;\n#else\nvec3 volumeAlbedo=computeColorAtDistanceInMedia(vTintColor.rgb,vTintColor.w);\nrefractionTransmittance*=cocaLambert(volumeAlbedo,vThicknessParam.y);\n#endif\n#ifdef SS_ALBEDOFORREFRACTIONTINT\nenvironmentRefraction.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.surfaceAlbedo=surfaceAlbedo*(1.-refractionIntensity);\n#ifdef REFLECTION\noutParams.refractionFactorForIrradiance=(1.-refractionIntensity);\n#endif\n#ifdef UNUSED_MULTIPLEBOUNCES\nvec3 bounceSpecularEnvironmentReflectance=(2.0*specularEnvironmentReflectance)/(1.0+specularEnvironmentReflectance);\noutParams.specularEnvironmentReflectance=mix(bounceSpecularEnvironmentReflectance,specularEnvironmentReflectance,refractionIntensity);\n#endif\nrefractionTransmittance*=1.0-outParams.specularEnvironmentReflectance;\n#if DEBUGMODE>0\noutParams.refractionTransmittance=refractionTransmittance;\n#endif\noutParams.finalRefraction=environmentRefraction.rgb*refractionTransmittance*vLightingIntensity.z;\n#if DEBUGMODE>0\noutParams.environmentRefraction=environmentRefraction;\n#endif\n#endif\n#if defined(REFLECTION) && defined(SS_TRANSLUCENCY)\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX) || !defined(USESPHERICALFROMREFLECTIONMAP)\nvec3 irradianceVector=vec3(reflectionMatrix*vec4(normalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nirradianceVector.z*=-1.0;\n#endif\n#ifdef INVERTCUBICMAP\nirradianceVector.y*=-1.0;\n#endif\n#else\nvec3 irradianceVector=irradianceVector_;\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP)\n#if defined(REALTIME_FILTERING)\nvec3 refractionIrradiance=irradiance(reflectionSampler,-irradianceVector,vReflectionFilteringInfo);\n#else\nvec3 refractionIrradiance=computeEnvironmentIrradiance(-irradianceVector);\n#endif\n#elif defined(USEIRRADIANCEMAP)\n#ifdef REFLECTIONMAP_3D\nvec3 irradianceCoords=irradianceVector;\n#else\nvec2 irradianceCoords=irradianceVector.xy;\n#ifdef REFLECTIONMAP_PROJECTION\nirradianceCoords/=irradianceVector.z;\n#endif\nirradianceCoords.y=1.0-irradianceCoords.y;\n#endif\nvec4 refractionIrradiance=sampleReflection(irradianceSampler,-irradianceCoords);\n#ifdef RGBDREFLECTION\nrefractionIrradiance.rgb=fromRGBD(refractionIrradiance);\n#endif\n#ifdef GAMMAREFLECTION\nrefractionIrradiance.rgb=toLinearSpace(refractionIrradiance.rgb);\n#endif\n#else\nvec4 refractionIrradiance=vec4(0.);\n#endif\nrefractionIrradiance.rgb*=transmittance;\n#ifdef SS_ALBEDOFORTRANSLUCENCYTINT\nrefractionIrradiance.rgb*=surfaceAlbedo.rgb;\n#endif\noutParams.refractionIrradiance=refractionIrradiance.rgb;\n#endif\n}\n#endif\n";ShaderStore.IncludesShadersStore[name89]=shader89;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockNormalGeometric.js
var name90="pbrBlockNormalGeometric";var shader90="vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);\n#ifdef NORMAL\nvec3 normalW=normalize(vNormalW);\n#else\nvec3 normalW=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#endif\nvec3 geometricNormalW=normalW;\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\ngeometricNormalW=gl_FrontFacing ? geometricNormalW : -geometricNormalW;\n#endif\n";ShaderStore.IncludesShadersStore[name90]=shader90;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockNormalFinal.js
var name91="pbrBlockNormalFinal";var shader91="#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nvec3 faceNormal=normalize(cross(dFdx(vPositionW),dFdy(vPositionW)))*vEyePosition.w;\n#if defined(TWOSIDEDLIGHTING)\nfaceNormal=gl_FrontFacing ? faceNormal : -faceNormal;\n#endif\nnormalW*=sign(dot(normalW,faceNormal));\n#endif\n#if defined(TWOSIDEDLIGHTING) && defined(NORMAL)\nnormalW=gl_FrontFacing ? normalW : -normalW;\n#endif\n";ShaderStore.IncludesShadersStore[name91]=shader91;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockLightmapInit.js
var name92="pbrBlockLightmapInit";var shader92="#ifdef LIGHTMAP\nvec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);\n#ifdef RGBDLIGHTMAP\nlightmapColor.rgb=fromRGBD(lightmapColor);\n#endif\n#ifdef GAMMALIGHTMAP\nlightmapColor.rgb=toLinearSpace(lightmapColor.rgb);\n#endif\nlightmapColor.rgb*=vLightmapInfos.y;\n#endif\n";ShaderStore.IncludesShadersStore[name92]=shader92;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockGeometryInfo.js
var name93="pbrBlockGeometryInfo";var shader93="float NdotVUnclamped=dot(normalW,viewDirectionW);\nfloat NdotV=absEps(NdotVUnclamped);\nfloat alphaG=convertRoughnessToAverageSlope(roughness);\nvec2 AARoughnessFactors=getAARoughnessFactors(normalW.xyz);\n#ifdef SPECULARAA\nalphaG+=AARoughnessFactors.y;\n#endif\n#if defined(ENVIRONMENTBRDF)\nvec3 environmentBrdf=getBRDFLookup(NdotV,roughness);\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\n#ifdef AMBIENTINGRAYSCALE\nfloat ambientMonochrome=aoOut.ambientOcclusionColor.r;\n#else\nfloat ambientMonochrome=getLuminance(aoOut.ambientOcclusionColor);\n#endif\nfloat seo=environmentRadianceOcclusion(ambientMonochrome,NdotVUnclamped);\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nfloat eho=environmentHorizonOcclusion(-viewDirectionW,normalW,geometricNormalW);\n#endif\n#endif\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name93]=shader93;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectance0.js
var name94="pbrBlockReflectance0";var shader94="float reflectance=max(max(reflectivityOut.surfaceReflectivityColor.r,reflectivityOut.surfaceReflectivityColor.g),reflectivityOut.surfaceReflectivityColor.b);\nvec3 specularEnvironmentR0=reflectivityOut.surfaceReflectivityColor.rgb;\n#ifdef METALLICWORKFLOW\nvec3 specularEnvironmentR90=vec3(metallicReflectanceFactors.a);\n#else \nvec3 specularEnvironmentR90=vec3(1.0,1.0,1.0);\n#endif\n#ifdef ALPHAFRESNEL\nfloat reflectance90=fresnelGrazingReflectance(reflectance);\nspecularEnvironmentR90=specularEnvironmentR90*reflectance90;\n#endif\n";ShaderStore.IncludesShadersStore[name94]=shader94;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockReflectance.js
var name95="pbrBlockReflectance";var shader95="#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\nvec3 specularEnvironmentReflectance=getReflectanceFromBRDFLookup(clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,environmentBrdf);\n#ifdef RADIANCEOCCLUSION\nspecularEnvironmentReflectance*=seo;\n#endif\n#ifdef HORIZONOCCLUSION\n#ifdef BUMP\n#ifdef REFLECTIONMAP_3D\nspecularEnvironmentReflectance*=eho;\n#endif\n#endif\n#endif\n#else\nvec3 specularEnvironmentReflectance=getReflectanceFromAnalyticalBRDFLookup_Jones(NdotV,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,sqrt(microSurface));\n#endif\n#ifdef CLEARCOAT\nspecularEnvironmentReflectance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nspecularEnvironmentReflectance*=clearcoatOut.absorption;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name95]=shader95;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockDirectLighting.js
var name96="pbrBlockDirectLighting";var shader96="vec3 diffuseBase=vec3(0.,0.,0.);\n#ifdef SPECULARTERM\nvec3 specularBase=vec3(0.,0.,0.);\n#endif\n#ifdef CLEARCOAT\nvec3 clearCoatBase=vec3(0.,0.,0.);\n#endif\n#ifdef SHEEN\nvec3 sheenBase=vec3(0.,0.,0.);\n#endif\npreLightingInfo preInfo;\nlightingInfo info;\nfloat shadow=1.; \n#if defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\nvec3 absorption=vec3(0.);\n#endif\n";ShaderStore.IncludesShadersStore[name96]=shader96;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalLitComponents.js
var name97="pbrBlockFinalLitComponents";var shader97="#if defined(ENVIRONMENTBRDF)\n#ifdef MS_BRDF_ENERGY_CONSERVATION\nvec3 energyConservationFactor=getEnergyConservationFactor(clearcoatOut.specularEnvironmentR0,environmentBrdf);\n#endif\n#endif\n#ifndef METALLICWORKFLOW\n#ifdef SPECULAR_GLOSSINESS_ENERGY_CONSERVATION\nsurfaceAlbedo.rgb=(1.-reflectance)*surfaceAlbedo.rgb;\n#endif\n#endif\n#if defined(SHEEN) && defined(SHEEN_ALBEDOSCALING) && defined(ENVIRONMENTBRDF)\nsurfaceAlbedo.rgb=sheenOut.sheenAlbedoScaling*surfaceAlbedo.rgb;\n#endif\n#ifdef REFLECTION\nvec3 finalIrradiance=reflectionOut.environmentIrradiance;\n#if defined(CLEARCOAT)\nfinalIrradiance*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nfinalIrradiance*=clearcoatOut.absorption;\n#endif\n#endif\n#if defined(SS_REFRACTION)\nfinalIrradiance*=subSurfaceOut.refractionFactorForIrradiance;\n#endif\n#if defined(SS_TRANSLUCENCY)\nfinalIrradiance*=(1.0-subSurfaceOut.translucencyIntensity);\nfinalIrradiance+=subSurfaceOut.refractionIrradiance;\n#endif\nfinalIrradiance*=surfaceAlbedo.rgb;\nfinalIrradiance*=vLightingIntensity.z;\nfinalIrradiance*=aoOut.ambientOcclusionColor;\n#endif\n#ifdef SPECULARTERM\nvec3 finalSpecular=specularBase;\nfinalSpecular=max(finalSpecular,0.0);\nvec3 finalSpecularScaled=finalSpecular*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalSpecularScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalSpecularScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef REFLECTION\nvec3 finalRadiance=reflectionOut.environmentRadiance.rgb;\nfinalRadiance*=subSurfaceOut.specularEnvironmentReflectance;\nvec3 finalRadianceScaled=finalRadiance*vLightingIntensity.z;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalRadianceScaled*=energyConservationFactor;\n#endif\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF) && defined(SHEEN_ALBEDOSCALING)\nfinalRadianceScaled*=sheenOut.sheenAlbedoScaling;\n#endif\n#endif\n#ifdef SHEEN\nvec3 finalSheen=sheenBase*sheenOut.sheenColor;\nfinalSheen=max(finalSheen,0.0);\nvec3 finalSheenScaled=finalSheen*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(CLEARCOAT) && defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.conservationFactor;\n#if defined(CLEARCOAT_TINT)\nsheenOut.finalSheenRadianceScaled*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef CLEARCOAT\nvec3 finalClearCoat=clearCoatBase;\nfinalClearCoat=max(finalClearCoat,0.0);\nvec3 finalClearCoatScaled=finalClearCoat*vLightingIntensity.x*vLightingIntensity.w;\n#if defined(ENVIRONMENTBRDF) && defined(MS_BRDF_ENERGY_CONSERVATION)\nfinalClearCoatScaled*=clearcoatOut.energyConservationFactorClearCoat;\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction*=clearcoatOut.conservationFactor;\n#ifdef CLEARCOAT_TINT\nsubSurfaceOut.finalRefraction*=clearcoatOut.absorption;\n#endif\n#endif\n#endif\n#ifdef ALPHABLEND\nfloat luminanceOverAlpha=0.0;\n#if defined(REFLECTION) && defined(RADIANCEOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalRadianceScaled);\n#if defined(CLEARCOAT)\nluminanceOverAlpha+=getLuminance(clearcoatOut.finalClearCoatRadianceScaled);\n#endif\n#endif\n#if defined(SPECULARTERM) && defined(SPECULAROVERALPHA)\nluminanceOverAlpha+=getLuminance(finalSpecularScaled);\n#endif\n#if defined(CLEARCOAT) && defined(CLEARCOATOVERALPHA)\nluminanceOverAlpha+=getLuminance(finalClearCoatScaled);\n#endif\n#if defined(RADIANCEOVERALPHA) || defined(SPECULAROVERALPHA) || defined(CLEARCOATOVERALPHA)\nalpha=saturate(alpha+luminanceOverAlpha*luminanceOverAlpha);\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name97]=shader97;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalUnlitComponents.js
var name98="pbrBlockFinalUnlitComponents";var shader98="vec3 finalDiffuse=diffuseBase;\nfinalDiffuse*=surfaceAlbedo.rgb;\nfinalDiffuse=max(finalDiffuse,0.0);\nfinalDiffuse*=vLightingIntensity.x;\nvec3 finalAmbient=vAmbientColor;\nfinalAmbient*=surfaceAlbedo.rgb;\nvec3 finalEmissive=vEmissiveColor;\n#ifdef EMISSIVE\nvec3 emissiveColorTex=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb;\n#ifdef GAMMAEMISSIVE\nfinalEmissive*=toLinearSpace(emissiveColorTex.rgb);\n#else\nfinalEmissive*=emissiveColorTex.rgb;\n#endif\nfinalEmissive*= vEmissiveInfos.y;\n#endif\nfinalEmissive*=vLightingIntensity.y;\n#ifdef AMBIENT\nvec3 ambientOcclusionForDirectDiffuse=mix(vec3(1.),aoOut.ambientOcclusionColor,vAmbientInfos.w);\n#else\nvec3 ambientOcclusionForDirectDiffuse=aoOut.ambientOcclusionColor;\n#endif\nfinalAmbient*=aoOut.ambientOcclusionColor;\nfinalDiffuse*=ambientOcclusionForDirectDiffuse;\n";ShaderStore.IncludesShadersStore[name98]=shader98;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockFinalColorComposition.js
var name99="pbrBlockFinalColorComposition";var shader99="vec4 finalColor=vec4(\n#ifndef UNLIT\n#ifdef REFLECTION\nfinalIrradiance +\n#endif\n#ifdef SPECULARTERM\nfinalSpecularScaled +\n#endif\n#ifdef SHEEN\nfinalSheenScaled +\n#endif\n#ifdef CLEARCOAT\nfinalClearCoatScaled +\n#endif\n#ifdef REFLECTION\nfinalRadianceScaled +\n#if defined(SHEEN) && defined(ENVIRONMENTBRDF)\nsheenOut.finalSheenRadianceScaled +\n#endif\n#ifdef CLEARCOAT\nclearcoatOut.finalClearCoatRadianceScaled +\n#endif\n#endif\n#ifdef SS_REFRACTION\nsubSurfaceOut.finalRefraction +\n#endif\n#endif\nfinalAmbient +\nfinalDiffuse,\nalpha);\n#ifdef LIGHTMAP\n#ifndef LIGHTMAPEXCLUDED\n#ifdef USELIGHTMAPASSHADOWMAP\nfinalColor.rgb*=lightmapColor.rgb;\n#else\nfinalColor.rgb+=lightmapColor.rgb;\n#endif\n#endif\n#endif\nfinalColor.rgb+=finalEmissive;\n#define CUSTOM_FRAGMENT_BEFORE_FOG\nfinalColor=max(finalColor,0.0);\n";ShaderStore.IncludesShadersStore[name99]=shader99;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrBlockImageProcessing.js
var name100="pbrBlockImageProcessing";var shader100="#if defined(IMAGEPROCESSINGPOSTPROCESS) || defined(SS_SCATTERING)\n#if !defined(SKIPFINALCOLORCLAMP)\nfinalColor.rgb=clamp(finalColor.rgb,0.,30.0);\n#endif\n#else\nfinalColor=applyImageProcessing(finalColor);\n#endif\nfinalColor.a*=visibility;\n#ifdef PREMULTIPLYALPHA\nfinalColor.rgb*=finalColor.a;\n#endif\n";ShaderStore.IncludesShadersStore[name100]=shader100;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrDebug.js
var name101="pbrDebug";var shader101="#if DEBUGMODE>0\nif (vClipSpacePosition.x/vClipSpacePosition.w>=vDebugMode.x) {\n#if DEBUGMODE==1\ngl_FragColor.rgb=vPositionW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==2 && defined(NORMAL)\ngl_FragColor.rgb=vNormalW.rgb;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==3 && defined(BUMP) || DEBUGMODE==3 && defined(PARALLAX) || DEBUGMODE==3 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==4 && defined(BUMP) || DEBUGMODE==4 && defined(PARALLAX) || DEBUGMODE==4 && defined(ANISOTROPIC)\ngl_FragColor.rgb=TBN[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==5\ngl_FragColor.rgb=normalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==6 && defined(MAINUV1)\ngl_FragColor.rgb=vec3(vMainUV1,0.0);\n#elif DEBUGMODE==7 && defined(MAINUV2)\ngl_FragColor.rgb=vec3(vMainUV2,0.0);\n#elif DEBUGMODE==8 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[0];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==9 && defined(CLEARCOAT) && defined(CLEARCOAT_BUMP)\ngl_FragColor.rgb=clearcoatOut.TBNClearCoat[1];\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==10 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearcoatOut.clearCoatNormalW;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==11 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicNormal;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==12 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicTangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==13 && defined(ANISOTROPIC)\ngl_FragColor.rgb=anisotropicOut.anisotropicBitangent;\n#define DEBUGMODE_NORMALIZE\n#elif DEBUGMODE==20 && defined(ALBEDO)\ngl_FragColor.rgb=albedoTexture.rgb;\n#elif DEBUGMODE==21 && defined(AMBIENT)\ngl_FragColor.rgb=aoOut.ambientOcclusionColorMap.rgb;\n#elif DEBUGMODE==22 && defined(OPACITY)\ngl_FragColor.rgb=opacityMap.rgb;\n#elif DEBUGMODE==23 && defined(EMISSIVE)\ngl_FragColor.rgb=emissiveColorTex.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==24 && defined(LIGHTMAP)\ngl_FragColor.rgb=lightmapColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==25 && defined(REFLECTIVITY) && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceMetallicColorMap.rgb;\n#elif DEBUGMODE==26 && defined(REFLECTIVITY) && !defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.surfaceReflectivityColorMap.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==27 && defined(CLEARCOAT) && defined(CLEARCOAT_TEXTURE)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatMapData.rg,0.0);\n#elif DEBUGMODE==28 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\ngl_FragColor.rgb=clearcoatOut.clearCoatTintMapData.rgb;\n#elif DEBUGMODE==29 && defined(SHEEN) && defined(SHEEN_TEXTURE)\ngl_FragColor.rgb=sheenOut.sheenMapData.rgb;\n#elif DEBUGMODE==30 && defined(ANISOTROPIC) && defined(ANISOTROPIC_TEXTURE)\ngl_FragColor.rgb=anisotropicOut.anisotropyMapData.rgb;\n#elif DEBUGMODE==31 && defined(SUBSURFACE) && defined(SS_THICKNESSANDMASK_TEXTURE)\ngl_FragColor.rgb=subSurfaceOut.thicknessMap.rgb;\n#elif DEBUGMODE==40 && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.environmentRefraction.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==41 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==42 && defined(CLEARCOAT) && defined(REFLECTION)\ngl_FragColor.rgb=clearcoatOut.environmentClearCoatRadiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==50\ngl_FragColor.rgb=diffuseBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==51 && defined(SPECULARTERM)\ngl_FragColor.rgb=specularBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==52 && defined(CLEARCOAT)\ngl_FragColor.rgb=clearCoatBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==53 && defined(SHEEN)\ngl_FragColor.rgb=sheenBase.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==54 && defined(REFLECTION)\ngl_FragColor.rgb=reflectionOut.environmentIrradiance.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==60\ngl_FragColor.rgb=surfaceAlbedo.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==61\ngl_FragColor.rgb=clearcoatOut.specularEnvironmentR0;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==62 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=vec3(reflectivityOut.metallicRoughness.r);\n#elif DEBUGMODE==71 && defined(METALLICWORKFLOW)\ngl_FragColor.rgb=reflectivityOut.metallicF0;\n#elif DEBUGMODE==63\ngl_FragColor.rgb=vec3(roughness);\n#elif DEBUGMODE==64\ngl_FragColor.rgb=vec3(alphaG);\n#elif DEBUGMODE==65\ngl_FragColor.rgb=vec3(NdotV);\n#elif DEBUGMODE==66 && defined(CLEARCOAT) && defined(CLEARCOAT_TINT)\ngl_FragColor.rgb=clearcoatOut.clearCoatColor.rgb;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==67 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatRoughness);\n#elif DEBUGMODE==68 && defined(CLEARCOAT)\ngl_FragColor.rgb=vec3(clearcoatOut.clearCoatNdotV);\n#elif DEBUGMODE==69 && defined(SUBSURFACE) && defined(SS_TRANSLUCENCY)\ngl_FragColor.rgb=subSurfaceOut.transmittance;\n#elif DEBUGMODE==70 && defined(SUBSURFACE) && defined(SS_REFRACTION)\ngl_FragColor.rgb=subSurfaceOut.refractionTransmittance;\n#elif DEBUGMODE==80 && defined(RADIANCEOCCLUSION)\ngl_FragColor.rgb=vec3(seo);\n#elif DEBUGMODE==81 && defined(HORIZONOCCLUSION)\ngl_FragColor.rgb=vec3(eho);\n#elif DEBUGMODE==82 && defined(MS_BRDF_ENERGY_CONSERVATION)\ngl_FragColor.rgb=vec3(energyConservationFactor);\n#elif DEBUGMODE==83 && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=specularEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==84 && defined(CLEARCOAT) && defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\ngl_FragColor.rgb=clearcoatOut.clearCoatEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==85 && defined(SHEEN) && defined(REFLECTION)\ngl_FragColor.rgb=sheenOut.sheenEnvironmentReflectance;\n#define DEBUGMODE_GAMMA\n#elif DEBUGMODE==86 && defined(ALPHABLEND)\ngl_FragColor.rgb=vec3(luminanceOverAlpha);\n#elif DEBUGMODE==87\ngl_FragColor.rgb=vec3(alpha);\n#endif\ngl_FragColor.rgb*=vDebugMode.y;\n#ifdef DEBUGMODE_NORMALIZE\ngl_FragColor.rgb=normalize(gl_FragColor.rgb)*0.5+0.5;\n#endif\n#ifdef DEBUGMODE_GAMMA\ngl_FragColor.rgb=toGammaSpace(gl_FragColor.rgb);\n#endif\ngl_FragColor.a=1.0;\n#ifdef PREPASS\ngl_FragData[0]=toLinearSpace(gl_FragColor); \ngl_FragData[1]=vec4(0.,0.,0.,0.); \n#endif\nreturn;\n}\n#endif\n";ShaderStore.IncludesShadersStore[name101]=shader101;// node_modules/@babylonjs/core/Shaders/pbr.fragment.js
var name102="pbrPixelShader";var shader102="#if defined(BUMP) || !defined(NORMAL) || defined(FORCENORMALFORWARD) || defined(SPECULARAA) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#ifdef LODBASEDMICROSFURACE\n#extension GL_EXT_shader_texture_lod : enable\n#endif\n#define CUSTOM_FRAGMENT_BEGIN\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<prePassDeclaration>[SCENE_MRT_COUNT]\nprecision highp float;\n#include<oitDeclaration>\n#ifndef FROMLINEARSPACE\n#define FROMLINEARSPACE\n#endif\n#include<__decl__pbrFragment>\n#include<pbrFragmentExtraDeclaration>\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\n#include<pbrFragmentSamplersDeclaration>\n#include<imageProcessingDeclaration>\n#include<clipPlaneFragmentDeclaration>\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\n#include<helperFunctions>\n#include<subSurfaceScatteringFunctions>\n#include<importanceSampling>\n#include<pbrHelperFunctions>\n#include<imageProcessingFunctions>\n#include<shadowsFragmentFunctions>\n#include<harmonicsFunctions>\n#include<pbrDirectLightingSetupFunctions>\n#include<pbrDirectLightingFalloffFunctions>\n#include<pbrBRDFFunctions>\n#include<hdrFilteringFunctions>\n#include<pbrDirectLightingFunctions>\n#include<pbrIBLFunctions>\n#include<bumpFragmentMainFunctions>\n#include<bumpFragmentFunctions>\n#ifdef REFLECTION\n#include<reflectionFunction>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\n#include<pbrBlockAlbedoOpacity>\n#include<pbrBlockReflectivity>\n#include<pbrBlockAmbientOcclusion>\n#include<pbrBlockAlphaFresnel>\n#include<pbrBlockAnisotropic>\n#include<pbrBlockReflection>\n#include<pbrBlockSheen>\n#include<pbrBlockClearcoat>\n#include<pbrBlockIridescence>\n#include<pbrBlockSubSurface>\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n#include<pbrBlockNormalGeometric>\n#include<bumpFragment>\n#include<pbrBlockNormalFinal>\nalbedoOpacityOutParams albedoOpacityOut;\n#ifdef ALBEDO\nvec4 albedoTexture=texture2D(albedoSampler,vAlbedoUV+uvOffset);\n#endif\n#ifdef OPACITY\nvec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);\n#endif\nalbedoOpacityBlock(\nvAlbedoColor,\n#ifdef ALBEDO\nalbedoTexture,\nvAlbedoInfos,\n#endif\n#ifdef OPACITY\nopacityMap,\nvOpacityInfos,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nalbedoOpacityOut\n);\nvec3 surfaceAlbedo=albedoOpacityOut.surfaceAlbedo;\nfloat alpha=albedoOpacityOut.alpha;\n#define CUSTOM_FRAGMENT_UPDATE_ALPHA\n#include<depthPrePass>\n#define CUSTOM_FRAGMENT_BEFORE_LIGHTS\nambientOcclusionOutParams aoOut;\n#ifdef AMBIENT\nvec3 ambientOcclusionColorMap=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb;\n#endif\nambientOcclusionBlock(\n#ifdef AMBIENT\nambientOcclusionColorMap,\nvAmbientInfos,\n#endif\naoOut\n);\n#include<pbrBlockLightmapInit>\n#ifdef UNLIT\nvec3 diffuseBase=vec3(1.,1.,1.);\n#else\nvec3 baseColor=surfaceAlbedo;\nreflectivityOutParams reflectivityOut;\n#if defined(REFLECTIVITY)\nvec4 surfaceMetallicOrReflectivityColorMap=texture2D(reflectivitySampler,vReflectivityUV+uvOffset);\nvec4 baseReflectivity=surfaceMetallicOrReflectivityColorMap;\n#ifndef METALLICWORKFLOW\n#ifdef REFLECTIVITY_GAMMA\nsurfaceMetallicOrReflectivityColorMap=toLinearSpace(surfaceMetallicOrReflectivityColorMap);\n#endif\nsurfaceMetallicOrReflectivityColorMap.rgb*=vReflectivityInfos.y;\n#endif\n#endif\n#if defined(MICROSURFACEMAP)\nvec4 microSurfaceTexel=texture2D(microSurfaceSampler,vMicroSurfaceSamplerUV+uvOffset)*vMicroSurfaceSamplerInfos.y;\n#endif\n#ifdef METALLICWORKFLOW\nvec4 metallicReflectanceFactors=vMetallicReflectanceFactors;\n#ifdef REFLECTANCE\nvec4 reflectanceFactorsMap=texture2D(reflectanceSampler,vReflectanceUV+uvOffset);\n#ifdef REFLECTANCE_GAMMA\nreflectanceFactorsMap=toLinearSpace(reflectanceFactorsMap);\n#endif\nmetallicReflectanceFactors.rgb*=reflectanceFactorsMap.rgb;\n#endif\n#ifdef METALLIC_REFLECTANCE\nvec4 metallicReflectanceFactorsMap=texture2D(metallicReflectanceSampler,vMetallicReflectanceUV+uvOffset);\n#ifdef METALLIC_REFLECTANCE_GAMMA\nmetallicReflectanceFactorsMap=toLinearSpace(metallicReflectanceFactorsMap);\n#endif\n#ifndef METALLIC_REFLECTANCE_USE_ALPHA_ONLY\nmetallicReflectanceFactors.rgb*=metallicReflectanceFactorsMap.rgb;\n#endif\nmetallicReflectanceFactors*=metallicReflectanceFactorsMap.a;\n#endif\n#endif\nreflectivityBlock(\nvReflectivityColor,\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo,\nmetallicReflectanceFactors,\n#endif\n#ifdef REFLECTIVITY\nvReflectivityInfos,\nsurfaceMetallicOrReflectivityColorMap,\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor,\n#endif\n#ifdef MICROSURFACEMAP\nmicroSurfaceTexel,\n#endif\n#ifdef DETAIL\ndetailColor,\nvDetailInfos,\n#endif\nreflectivityOut\n);\nfloat microSurface=reflectivityOut.microSurface;\nfloat roughness=reflectivityOut.roughness;\n#ifdef METALLICWORKFLOW\nsurfaceAlbedo=reflectivityOut.surfaceAlbedo;\n#endif\n#if defined(METALLICWORKFLOW) && defined(REFLECTIVITY) && defined(AOSTOREINMETALMAPRED)\naoOut.ambientOcclusionColor=reflectivityOut.ambientOcclusionColor;\n#endif\n#ifdef ALPHAFRESNEL\n#if defined(ALPHATEST) || defined(ALPHABLEND)\nalphaFresnelOutParams alphaFresnelOut;\nalphaFresnelBlock(\nnormalW,\nviewDirectionW,\nalpha,\nmicroSurface,\nalphaFresnelOut\n);\nalpha=alphaFresnelOut.alpha;\n#endif\n#endif\n#include<pbrBlockGeometryInfo>\n#ifdef ANISOTROPIC\nanisotropicOutParams anisotropicOut;\n#ifdef ANISOTROPIC_TEXTURE\nvec3 anisotropyMapData=texture2D(anisotropySampler,vAnisotropyUV+uvOffset).rgb*vAnisotropyInfos.y;\n#endif\nanisotropicBlock(\nvAnisotropy,\n#ifdef ANISOTROPIC_TEXTURE\nanisotropyMapData,\n#endif\nTBN,\nnormalW,\nviewDirectionW,\nanisotropicOut\n);\n#endif\n#ifdef REFLECTION\nreflectionOutParams reflectionOut;\n#ifndef USE_CUSTOM_REFLECTION\nreflectionBlock(\nvPositionW,\nnormalW,\nalphaG,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#if defined(LODINREFLECTIONALPHA) && !defined(REFLECTIONMAP_SKYBOX)\nNdotVUnclamped,\n#endif\n#ifdef LINEARSPECULARREFLECTION\nroughness,\n#endif\nreflectionSampler,\n#if defined(NORMAL) && defined(USESPHERICALINVERTEX)\nvEnvironmentIrradiance,\n#endif\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionMatrix,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\nreflectionOut\n);\n#else\n#define CUSTOM_REFLECTION\n#endif\n#endif\n#include<pbrBlockReflectance0>\n#ifdef SHEEN\nsheenOutParams sheenOut;\n#ifdef SHEEN_TEXTURE\nvec4 sheenMapData=texture2D(sheenSampler,vSheenUV+uvOffset);\n#endif\n#if defined(SHEEN_ROUGHNESS) && defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 sheenMapRoughnessData=texture2D(sheenRoughnessSampler,vSheenRoughnessUV+uvOffset)*vSheenInfos.w;\n#endif\nsheenBlock(\nvSheenColor,\n#ifdef SHEEN_ROUGHNESS\nvSheenRoughness,\n#if defined(SHEEN_TEXTURE_ROUGHNESS) && !defined(SHEEN_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE)\nsheenMapRoughnessData,\n#endif\n#endif\nroughness,\n#ifdef SHEEN_TEXTURE\nsheenMapData,\nvSheenInfos.y,\n#endif\nreflectance,\n#ifdef SHEEN_LINKWITHALBEDO\nbaseColor,\nsurfaceAlbedo,\n#endif\n#ifdef ENVIRONMENTBRDF\nNdotV,\nenvironmentBrdf,\n#endif\n#if defined(REFLECTION) && defined(ENVIRONMENTBRDF)\nAARoughnessFactors,\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\nreflectionOut.reflectionCoords,\nNdotVUnclamped,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(RADIANCEOCCLUSION)\nseo,\n#endif\n#if !defined(REFLECTIONMAP_SKYBOX) && defined(HORIZONOCCLUSION) && defined(BUMP) && defined(REFLECTIONMAP_3D)\neho,\n#endif\n#endif\nsheenOut\n);\n#ifdef SHEEN_LINKWITHALBEDO\nsurfaceAlbedo=sheenOut.surfaceAlbedo;\n#endif\n#endif\n#ifdef CLEARCOAT\n#ifdef CLEARCOAT_TEXTURE\nvec2 clearCoatMapData=texture2D(clearCoatSampler,vClearCoatUV+uvOffset).rg*vClearCoatInfos.y;\n#endif\n#endif\n#ifdef IRIDESCENCE\niridescenceOutParams iridescenceOut;\n#ifdef IRIDESCENCE_TEXTURE\nvec2 iridescenceMapData=texture2D(iridescenceSampler,vIridescenceUV+uvOffset).rg*vIridescenceInfos.y;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nvec2 iridescenceThicknessMapData=texture2D(iridescenceThicknessSampler,vIridescenceThicknessUV+uvOffset).rg*vIridescenceInfos.w;\n#endif\niridescenceBlock(\nvIridescenceParams,\nNdotV,\nspecularEnvironmentR0,\n#ifdef IRIDESCENCE_TEXTURE\niridescenceMapData,\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\niridescenceThicknessMapData,\n#endif\n#ifdef CLEARCOAT\nNdotVUnclamped,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#endif\niridescenceOut\n);\nfloat iridescenceIntensity=iridescenceOut.iridescenceIntensity;\nspecularEnvironmentR0=iridescenceOut.specularEnvironmentR0;\n#endif\nclearcoatOutParams clearcoatOut;\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nvec4 clearCoatMapRoughnessData=texture2D(clearCoatRoughnessSampler,vClearCoatRoughnessUV+uvOffset)*vClearCoatInfos.w;\n#endif\n#if defined(CLEARCOAT_TINT) && defined(CLEARCOAT_TINT_TEXTURE)\nvec4 clearCoatTintMapData=texture2D(clearCoatTintSampler,vClearCoatTintUV+uvOffset);\n#endif\n#ifdef CLEARCOAT_BUMP\nvec4 clearCoatBumpMapData=texture2D(clearCoatBumpSampler,vClearCoatBumpUV+uvOffset);\n#endif\nclearcoatBlock(\nvPositionW,\ngeometricNormalW,\nviewDirectionW,\nvClearCoatParams,\n#if defined(CLEARCOAT_TEXTURE_ROUGHNESS) && !defined(CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL) && !defined(CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE)\nclearCoatMapRoughnessData,\n#endif\nspecularEnvironmentR0,\n#ifdef CLEARCOAT_TEXTURE\nclearCoatMapData,\n#endif\n#ifdef CLEARCOAT_TINT\nvClearCoatTintParams,\nclearCoatColorAtDistance,\nvClearCoatRefractionParams,\n#ifdef CLEARCOAT_TINT_TEXTURE\nclearCoatTintMapData,\n#endif\n#endif\n#ifdef CLEARCOAT_BUMP\nvClearCoatBumpInfos,\nclearCoatBumpMapData,\nvClearCoatBumpUV,\n#if defined(TANGENT) && defined(NORMAL)\nvTBN,\n#else\nvClearCoatTangentSpaceParams,\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\nnormalMatrix,\n#endif\n#endif\n#if defined(FORCENORMALFORWARD) && defined(NORMAL)\nfaceNormal,\n#endif\n#ifdef REFLECTION\nvReflectionMicrosurfaceInfos,\nvReflectionInfos,\nvReflectionColor,\nvLightingIntensity,\nreflectionSampler,\n#ifndef LODBASEDMICROSFURACE\nreflectionSamplerLow,\nreflectionSamplerHigh,\n#endif\n#ifdef REALTIME_FILTERING\nvReflectionFilteringInfo,\n#endif\n#endif\n#if defined(ENVIRONMENTBRDF) && !defined(REFLECTIONMAP_SKYBOX)\n#ifdef RADIANCEOCCLUSION\nambientMonochrome,\n#endif\n#endif\n#if defined(CLEARCOAT_BUMP) || defined(TWOSIDEDLIGHTING)\n(gl_FrontFacing ? 1. : -1.),\n#endif\nclearcoatOut\n);\n#else\nclearcoatOut.specularEnvironmentR0=specularEnvironmentR0;\n#endif\n#include<pbrBlockReflectance>\nsubSurfaceOutParams subSurfaceOut;\n#ifdef SUBSURFACE\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nvec4 thicknessMap=texture2D(thicknessSampler,vThicknessUV+uvOffset);\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nvec4 refractionIntensityMap=texture2D(refractionIntensitySampler,vRefractionIntensityUV+uvOffset);\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nvec4 translucencyIntensityMap=texture2D(translucencyIntensitySampler,vTranslucencyIntensityUV+uvOffset);\n#endif\nsubSurfaceBlock(\nvSubSurfaceIntensity,\nvThicknessParam,\nvTintColor,\nnormalW,\nspecularEnvironmentReflectance,\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nthicknessMap,\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nrefractionIntensityMap,\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\ntranslucencyIntensityMap,\n#endif\n#ifdef REFLECTION\n#ifdef SS_TRANSLUCENCY\nreflectionMatrix,\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#if !defined(NORMAL) || !defined(USESPHERICALINVERTEX)\nreflectionOut.irradianceVector,\n#endif\n#if defined(REALTIME_FILTERING)\nreflectionSampler,\nvReflectionFilteringInfo,\n#endif\n#endif\n#ifdef USEIRRADIANCEMAP\nirradianceSampler,\n#endif\n#endif\n#endif\n#if defined(SS_REFRACTION) || defined(SS_TRANSLUCENCY)\nsurfaceAlbedo,\n#endif\n#ifdef SS_REFRACTION\nvPositionW,\nviewDirectionW,\nview,\nvRefractionInfos,\nrefractionMatrix,\nvRefractionMicrosurfaceInfos,\nvLightingIntensity,\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha,\n#endif\n#ifdef SS_LODINREFRACTIONALPHA\nNdotVUnclamped,\n#endif\n#ifdef SS_LINEARSPECULARREFRACTION\nroughness,\n#endif\nalphaG,\nrefractionSampler,\n#ifndef LODBASEDMICROSFURACE\nrefractionSamplerLow,\nrefractionSamplerHigh,\n#endif\n#ifdef ANISOTROPIC\nanisotropicOut,\n#endif\n#ifdef REALTIME_FILTERING\nvRefractionFilteringInfo,\n#endif\n#ifdef SS_USE_LOCAL_REFRACTIONMAP_CUBIC\nvRefractionPosition,\nvRefractionSize,\n#endif\n#endif\n#ifdef SS_TRANSLUCENCY\nvDiffusionDistance,\n#endif\nsubSurfaceOut\n);\n#ifdef SS_REFRACTION\nsurfaceAlbedo=subSurfaceOut.surfaceAlbedo;\n#ifdef SS_LINKREFRACTIONTOTRANSPARENCY\nalpha=subSurfaceOut.alpha;\n#endif\n#endif\n#else\nsubSurfaceOut.specularEnvironmentReflectance=specularEnvironmentReflectance;\n#endif\n#include<pbrBlockDirectLighting>\n#include<lightFragment>[0..maxSimultaneousLights]\n#include<pbrBlockFinalLitComponents>\n#endif \n#include<pbrBlockFinalUnlitComponents>\n#define CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\n#include<pbrBlockFinalColorComposition>\n#include<logDepthFragment>\n#include<fogFragment>(color,finalColor)\n#include<pbrBlockImageProcessing>\n#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\n#ifdef PREPASS\nfloat writeGeometryInfo=finalColor.a>0.4 ? 1.0 : 0.0;\n#ifdef PREPASS_POSITION\ngl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);\n#endif\n#ifdef PREPASS_VELOCITY\nvec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;\nvec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;\nvec2 velocity=abs(a-b);\nvelocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;\ngl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);\n#endif\n#ifdef PREPASS_ALBEDO_SQRT\nvec3 sqAlbedo=sqrt(surfaceAlbedo); \n#endif\n#ifdef PREPASS_IRRADIANCE\nvec3 irradiance=finalDiffuse;\n#ifndef UNLIT\n#ifdef REFLECTION\nirradiance+=finalIrradiance;\n#endif\n#endif\n#ifdef SS_SCATTERING\ngl_FragData[0]=vec4(finalColor.rgb-irradiance,finalColor.a); \nirradiance/=sqAlbedo;\n#else\ngl_FragData[0]=finalColor; \nfloat scatteringDiffusionProfile=255.;\n#endif\ngl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(clamp(irradiance,vec3(0.),vec3(1.)),writeGeometryInfo*scatteringDiffusionProfile/255.); \n#else\ngl_FragData[0]=vec4(finalColor.rgb,finalColor.a);\n#endif\n#ifdef PREPASS_DEPTH\ngl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo); \n#endif\n#ifdef PREPASS_NORMAL\ngl_FragData[PREPASS_NORMAL_INDEX]=vec4(normalize((view*vec4(normalW,0.0)).rgb),writeGeometryInfo); \n#endif\n#ifdef PREPASS_ALBEDO_SQRT\ngl_FragData[PREPASS_ALBEDO_SQRT_INDEX]=vec4(sqAlbedo,writeGeometryInfo); \n#endif\n#ifdef PREPASS_REFLECTIVITY\n#ifndef UNLIT\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularEnvironmentR0,microSurface)*writeGeometryInfo;\n#else\ngl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4( 0.0,0.0,0.0,1.0 )*writeGeometryInfo;\n#endif\n#endif\n#endif\n#if !defined(PREPASS) || defined(WEBGL2)\ngl_FragColor=finalColor;\n#endif\n#include<oitFragment>\n#if ORDER_INDEPENDENT_TRANSPARENCY\nif (fragDepth==nearestDepth) {\nfrontColor.rgb+=finalColor.rgb*finalColor.a*alphaMultiplier;\nfrontColor.a=1.0-alphaMultiplier*(1.0-finalColor.a);\n} else {\nbackColor+=finalColor;\n}\n#endif\n#include<pbrDebug>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";ShaderStore.ShadersStore[name102]=shader102;// node_modules/@babylonjs/core/Shaders/ShadersInclude/pbrVertexDeclaration.js
var name103="pbrVertexDeclaration";var shader103="uniform mat4 view;\nuniform mat4 viewProjection;\n#ifdef ALBEDO\nuniform mat4 albedoMatrix;\nuniform vec2 vAlbedoInfos;\n#endif\n#ifdef AMBIENT\nuniform mat4 ambientMatrix;\nuniform vec4 vAmbientInfos;\n#endif\n#ifdef OPACITY\nuniform mat4 opacityMatrix;\nuniform vec2 vOpacityInfos;\n#endif\n#ifdef EMISSIVE\nuniform vec2 vEmissiveInfos;\nuniform mat4 emissiveMatrix;\n#endif\n#ifdef LIGHTMAP\nuniform vec2 vLightmapInfos;\nuniform mat4 lightmapMatrix;\n#endif\n#ifdef REFLECTIVITY \nuniform vec3 vReflectivityInfos;\nuniform mat4 reflectivityMatrix;\n#endif\n#ifdef METALLIC_REFLECTANCE\nuniform vec2 vMetallicReflectanceInfos;\nuniform mat4 metallicReflectanceMatrix;\n#endif\n#ifdef REFLECTANCE\nuniform vec2 vReflectanceInfos;\nuniform mat4 reflectanceMatrix;\n#endif\n#ifdef MICROSURFACEMAP\nuniform vec2 vMicroSurfaceSamplerInfos;\nuniform mat4 microSurfaceSamplerMatrix;\n#endif\n#ifdef BUMP\nuniform vec3 vBumpInfos;\nuniform mat4 bumpMatrix;\n#endif\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\n#ifdef REFLECTION\nuniform vec2 vReflectionInfos;\nuniform mat4 reflectionMatrix;\n#endif\n#ifdef CLEARCOAT\n#if defined(CLEARCOAT_TEXTURE) || defined(CLEARCOAT_TEXTURE_ROUGHNESS)\nuniform vec4 vClearCoatInfos;\n#endif\n#ifdef CLEARCOAT_TEXTURE\nuniform mat4 clearCoatMatrix;\n#endif\n#ifdef CLEARCOAT_TEXTURE_ROUGHNESS\nuniform mat4 clearCoatRoughnessMatrix;\n#endif\n#ifdef CLEARCOAT_BUMP\nuniform vec2 vClearCoatBumpInfos;\nuniform mat4 clearCoatBumpMatrix;\n#endif\n#ifdef CLEARCOAT_TINT_TEXTURE\nuniform vec2 vClearCoatTintInfos;\nuniform mat4 clearCoatTintMatrix;\n#endif\n#endif\n#ifdef IRIDESCENCE\n#if defined(IRIDESCENCE_TEXTURE) || defined(IRIDESCENCE_THICKNESS_TEXTURE)\nuniform vec4 vIridescenceInfos;\n#endif\n#ifdef IRIDESCENCE_TEXTURE\nuniform mat4 iridescenceMatrix;\n#endif\n#ifdef IRIDESCENCE_THICKNESS_TEXTURE\nuniform mat4 iridescenceThicknessMatrix;\n#endif\n#endif\n#ifdef ANISOTROPIC\n#ifdef ANISOTROPIC_TEXTURE\nuniform vec2 vAnisotropyInfos;\nuniform mat4 anisotropyMatrix;\n#endif\n#endif\n#ifdef SHEEN\n#if defined(SHEEN_TEXTURE) || defined(SHEEN_TEXTURE_ROUGHNESS)\nuniform vec4 vSheenInfos;\n#endif\n#ifdef SHEEN_TEXTURE\nuniform mat4 sheenMatrix;\n#endif\n#ifdef SHEEN_TEXTURE_ROUGHNESS\nuniform mat4 sheenRoughnessMatrix;\n#endif\n#endif\n#ifdef SUBSURFACE\n#ifdef SS_REFRACTION\nuniform vec4 vRefractionInfos;\nuniform mat4 refractionMatrix;\n#endif\n#ifdef SS_THICKNESSANDMASK_TEXTURE\nuniform vec2 vThicknessInfos;\nuniform mat4 thicknessMatrix;\n#endif\n#ifdef SS_REFRACTIONINTENSITY_TEXTURE\nuniform vec2 vRefractionIntensityInfos;\nuniform mat4 refractionIntensityMatrix;\n#endif\n#ifdef SS_TRANSLUCENCYINTENSITY_TEXTURE\nuniform vec2 vTranslucencyIntensityInfos;\nuniform mat4 translucencyIntensityMatrix;\n#endif\n#endif\n#ifdef NORMAL\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\n#ifdef USESPHERICALFROMREFLECTIONMAP\n#ifdef SPHERICAL_HARMONICS\nuniform vec3 vSphericalL00;\nuniform vec3 vSphericalL1_1;\nuniform vec3 vSphericalL10;\nuniform vec3 vSphericalL11;\nuniform vec3 vSphericalL2_2;\nuniform vec3 vSphericalL2_1;\nuniform vec3 vSphericalL20;\nuniform vec3 vSphericalL21;\nuniform vec3 vSphericalL22;\n#else\nuniform vec3 vSphericalX;\nuniform vec3 vSphericalY;\nuniform vec3 vSphericalZ;\nuniform vec3 vSphericalXX_ZZ;\nuniform vec3 vSphericalYY_ZZ;\nuniform vec3 vSphericalZZ;\nuniform vec3 vSphericalXY;\nuniform vec3 vSphericalYZ;\nuniform vec3 vSphericalZX;\n#endif\n#endif\n#endif\n#endif\n#ifdef DETAIL\nuniform vec4 vDetailInfos;\nuniform mat4 detailMatrix;\n#endif\n#define ADDITIONAL_VERTEX_DECLARATION\n";ShaderStore.IncludesShadersStore[name103]=shader103;// node_modules/@babylonjs/core/Shaders/pbr.vertex.js
var name104="pbrVertexShader";var shader104="precision highp float;\n#include<__decl__pbrVertex>\n#define CUSTOM_VERTEX_BEGIN\nattribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#ifdef TANGENT\nattribute vec4 tangent;\n#endif\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#include<uvAttributeDeclaration>[2..7]\n#include<mainUVVaryingDeclaration>[1..7]\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\n#include<helperFunctions>\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<instancesDeclaration>\n#include<prePassVertexDeclaration>\n#include<samplerVertexDeclaration>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo)\n#include<samplerVertexDeclaration>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail)\n#include<samplerVertexDeclaration>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient)\n#include<samplerVertexDeclaration>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive)\n#include<samplerVertexDeclaration>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler)\n#include<samplerVertexDeclaration>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance)\n#include<samplerVertexDeclaration>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump)\n#ifdef CLEARCOAT\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump)\n#include<samplerVertexDeclaration>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence)\n#include<samplerVertexDeclaration>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness)\n#endif\n#ifdef SHEEN\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexDeclaration>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity)\n#include<samplerVertexDeclaration>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity)\n#endif\nvarying vec3 vPositionW;\n#if DEBUGMODE>0\nvarying vec4 vClipSpacePosition;\n#endif\n#ifdef NORMAL\nvarying vec3 vNormalW;\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvarying vec3 vEnvironmentIrradiance;\n#include<harmonicsFunctions>\n#endif\n#endif\n#if defined(VERTEXCOLOR) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nvarying vec4 vColor;\n#endif\n#include<bumpVertexDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<__decl__lightVxFragment>[0..maxSimultaneousLights]\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvarying vec3 vPositionUVW;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvarying vec3 vDirectionW;\n#endif\n#include<logDepthDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec3 positionUpdated=position;\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#ifdef TANGENT\nvec4 tangentUpdated=tangent;\n#endif\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#ifdef REFLECTIONMAP_SKYBOX\nvPositionUVW=positionUpdated;\n#endif\n#define CUSTOM_VERTEX_UPDATE_POSITION\n#define CUSTOM_VERTEX_UPDATE_NORMAL\n#include<instancesVertex>\n#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)\nvCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);\nvPreviousPosition=previousViewProjection*finalPreviousWorld*vec4(positionUpdated,1.0);\n#endif\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\nvPositionW=vec3(worldPos);\n#include<prePassVertex>\n#ifdef NORMAL\nmat3 normalWorld=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));\nvNormalW=normalize(normalWorld*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormalWorld=transposeMat3(inverseMat3(normalWorld));\n#endif\nvNormalW=normalize(normalWorld*normalUpdated);\n#endif\n#if defined(USESPHERICALFROMREFLECTIONMAP) && defined(USESPHERICALINVERTEX)\nvec3 reflectionVector=vec3(reflectionMatrix*vec4(vNormalW,0)).xyz;\n#ifdef REFLECTIONMAP_OPPOSITEZ\nreflectionVector.z*=-1.0;\n#endif\nvEnvironmentIrradiance=computeEnvironmentIrradiance(reflectionVector);\n#endif\n#endif\n#define CUSTOM_VERTEX_UPDATE_WORLDPOS\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#if DEBUGMODE>0\nvClipSpacePosition=gl_Position;\n#endif\n#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)\nvDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));\n#endif\n#ifndef UV1\nvec2 uvUpdated=vec2(0.,0.);\n#endif\n#ifdef MAINUV1\nvMainUV1=uvUpdated;\n#endif\n#include<uvVariableDeclaration>[2..7]\n#include<samplerVertexImplementation>(_DEFINENAME_,ALBEDO,_VARYINGNAME_,Albedo,_MATRIXNAME_,albedo,_INFONAME_,AlbedoInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,DETAIL,_VARYINGNAME_,Detail,_MATRIXNAME_,detail,_INFONAME_,DetailInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,AMBIENT,_VARYINGNAME_,Ambient,_MATRIXNAME_,ambient,_INFONAME_,AmbientInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,OPACITY,_VARYINGNAME_,Opacity,_MATRIXNAME_,opacity,_INFONAME_,OpacityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,EMISSIVE,_VARYINGNAME_,Emissive,_MATRIXNAME_,emissive,_INFONAME_,EmissiveInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,LIGHTMAP,_VARYINGNAME_,Lightmap,_MATRIXNAME_,lightmap,_INFONAME_,LightmapInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTIVITY,_VARYINGNAME_,Reflectivity,_MATRIXNAME_,reflectivity,_INFONAME_,ReflectivityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,MICROSURFACEMAP,_VARYINGNAME_,MicroSurfaceSampler,_MATRIXNAME_,microSurfaceSampler,_INFONAME_,MicroSurfaceSamplerInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,METALLIC_REFLECTANCE,_VARYINGNAME_,MetallicReflectance,_MATRIXNAME_,metallicReflectance,_INFONAME_,MetallicReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,REFLECTANCE,_VARYINGNAME_,Reflectance,_MATRIXNAME_,reflectance,_INFONAME_,ReflectanceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,BUMP,_VARYINGNAME_,Bump,_MATRIXNAME_,bump,_INFONAME_,BumpInfos.x)\n#ifdef CLEARCOAT\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE,_VARYINGNAME_,ClearCoat,_MATRIXNAME_,clearCoat,_INFONAME_,ClearCoatInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TEXTURE_ROUGHNESS,_VARYINGNAME_,ClearCoatRoughness,_MATRIXNAME_,clearCoatRoughness,_INFONAME_,ClearCoatInfos.z)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_BUMP,_VARYINGNAME_,ClearCoatBump,_MATRIXNAME_,clearCoatBump,_INFONAME_,ClearCoatBumpInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,CLEARCOAT_TINT_TEXTURE,_VARYINGNAME_,ClearCoatTint,_MATRIXNAME_,clearCoatTint,_INFONAME_,ClearCoatTintInfos.x)\n#endif\n#ifdef IRIDESCENCE\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_TEXTURE,_VARYINGNAME_,Iridescence,_MATRIXNAME_,iridescence,_INFONAME_,IridescenceInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,IRIDESCENCE_THICKNESS_TEXTURE,_VARYINGNAME_,IridescenceThickness,_MATRIXNAME_,iridescenceThickness,_INFONAME_,IridescenceInfos.z)\n#endif\n#ifdef SHEEN\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE,_VARYINGNAME_,Sheen,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SHEEN_TEXTURE_ROUGHNESS,_VARYINGNAME_,SheenRoughness,_MATRIXNAME_,sheen,_INFONAME_,SheenInfos.z)\n#endif\n#ifdef ANISOTROPIC\n#include<samplerVertexImplementation>(_DEFINENAME_,ANISOTROPIC_TEXTURE,_VARYINGNAME_,Anisotropy,_MATRIXNAME_,anisotropy,_INFONAME_,AnisotropyInfos.x)\n#endif\n#ifdef SUBSURFACE\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_THICKNESSANDMASK_TEXTURE,_VARYINGNAME_,Thickness,_MATRIXNAME_,thickness,_INFONAME_,ThicknessInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_REFRACTIONINTENSITY_TEXTURE,_VARYINGNAME_,RefractionIntensity,_MATRIXNAME_,refractionIntensity,_INFONAME_,RefractionIntensityInfos.x)\n#include<samplerVertexImplementation>(_DEFINENAME_,SS_TRANSLUCENCYINTENSITY_TEXTURE,_VARYINGNAME_,TranslucencyIntensity,_MATRIXNAME_,translucencyIntensity,_INFONAME_,TranslucencyIntensityInfos.x)\n#endif\n#include<bumpVertex>\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<shadowsVertex>[0..maxSimultaneousLights]\n#include<vertexColorMixing>\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";ShaderStore.ShadersStore[name104]=shader104;// node_modules/@babylonjs/core/Materials/PBR/pbrClearCoatConfiguration.js
var MaterialClearCoatDefines=/*#__PURE__*/function(_MaterialDefines4){_inherits(MaterialClearCoatDefines,_MaterialDefines4);var _super56=_createSuper(MaterialClearCoatDefines);function MaterialClearCoatDefines(){var _this170;_classCallCheck(this,MaterialClearCoatDefines);_this170=_super56.apply(this,arguments);_this170.CLEARCOAT=false;_this170.CLEARCOAT_DEFAULTIOR=false;_this170.CLEARCOAT_TEXTURE=false;_this170.CLEARCOAT_TEXTURE_ROUGHNESS=false;_this170.CLEARCOAT_TEXTUREDIRECTUV=0;_this170.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0;_this170.CLEARCOAT_BUMP=false;_this170.CLEARCOAT_BUMPDIRECTUV=0;_this170.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=false;_this170.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=false;_this170.CLEARCOAT_REMAP_F0=false;_this170.CLEARCOAT_TINT=false;_this170.CLEARCOAT_TINT_TEXTURE=false;_this170.CLEARCOAT_TINT_TEXTUREDIRECTUV=0;_this170.CLEARCOAT_TINT_GAMMATEXTURE=false;return _this170;}return _createClass(MaterialClearCoatDefines);}(MaterialDefines);var PBRClearCoatConfiguration=/*#__PURE__*/function(_MaterialPluginBase3){_inherits(PBRClearCoatConfiguration,_MaterialPluginBase3);var _super57=_createSuper(PBRClearCoatConfiguration);function PBRClearCoatConfiguration(material){var _this171;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,PBRClearCoatConfiguration);_this171=_super57.call(this,material,"PBRClearCoat",100,new MaterialClearCoatDefines(),addToPluginList);_this171._isEnabled=false;_this171.isEnabled=false;_this171.intensity=1;_this171.roughness=0;_this171._indexOfRefraction=PBRClearCoatConfiguration._DefaultIndexOfRefraction;_this171.indexOfRefraction=PBRClearCoatConfiguration._DefaultIndexOfRefraction;_this171._texture=null;_this171.texture=null;_this171._useRoughnessFromMainTexture=true;_this171.useRoughnessFromMainTexture=true;_this171._textureRoughness=null;_this171.textureRoughness=null;_this171._remapF0OnInterfaceChange=true;_this171.remapF0OnInterfaceChange=true;_this171._bumpTexture=null;_this171.bumpTexture=null;_this171._isTintEnabled=false;_this171.isTintEnabled=false;_this171.tintColor=Color3.White();_this171.tintColorAtDistance=1;_this171.tintThickness=1;_this171._tintTexture=null;_this171.tintTexture=null;_this171._internalMarkAllSubMeshesAsTexturesDirty=material._dirtyCallbacks[1];return _this171;}_createClass(PBRClearCoatConfiguration,[{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled);this._internalMarkAllSubMeshesAsTexturesDirty();}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2,engine){if(!this._isEnabled){return true;}var disableBumpMap=this._material._disableBumpMap;if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.ClearCoatTextureEnabled){if(!this._texture.isReadyOrNotBlocking()){return false;}}if(this._textureRoughness&&MaterialFlags.ClearCoatTextureEnabled){if(!this._textureRoughness.isReadyOrNotBlocking()){return false;}}if(engine.getCaps().standardDerivatives&&this._bumpTexture&&MaterialFlags.ClearCoatBumpTextureEnabled&&!disableBumpMap){if(!this._bumpTexture.isReady()){return false;}}if(this._isTintEnabled&&this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled){if(!this._tintTexture.isReadyOrNotBlocking()){return false;}}}}return true;}},{key:"prepareDefinesBeforeAttributes",value:function prepareDefinesBeforeAttributes(defines,scene2){var _a;if(this._isEnabled){defines.CLEARCOAT=true;defines.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture;defines.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((_a=this._textureRoughness)===null||_a===void 0?void 0:_a._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness);defines.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange;if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.ClearCoatTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._texture,defines,"CLEARCOAT_TEXTURE");}else{defines.CLEARCOAT_TEXTURE=false;}if(this._textureRoughness&&MaterialFlags.ClearCoatTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._textureRoughness,defines,"CLEARCOAT_TEXTURE_ROUGHNESS");}else{defines.CLEARCOAT_TEXTURE_ROUGHNESS=false;}if(this._bumpTexture&&MaterialFlags.ClearCoatBumpTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,defines,"CLEARCOAT_BUMP");}else{defines.CLEARCOAT_BUMP=false;}defines.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===PBRClearCoatConfiguration._DefaultIndexOfRefraction;if(this._isTintEnabled){defines.CLEARCOAT_TINT=true;if(this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._tintTexture,defines,"CLEARCOAT_TINT_TEXTURE");defines.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace;}else{defines.CLEARCOAT_TINT_TEXTURE=false;}}else{defines.CLEARCOAT_TINT=false;defines.CLEARCOAT_TINT_TEXTURE=false;}}}}else{defines.CLEARCOAT=false;defines.CLEARCOAT_TEXTURE=false;defines.CLEARCOAT_TEXTURE_ROUGHNESS=false;defines.CLEARCOAT_BUMP=false;defines.CLEARCOAT_TINT=false;defines.CLEARCOAT_TINT_TEXTURE=false;defines.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=false;defines.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL=false;defines.CLEARCOAT_DEFAULTIOR=false;defines.CLEARCOAT_TEXTUREDIRECTUV=0;defines.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0;defines.CLEARCOAT_BUMPDIRECTUV=0;defines.CLEARCOAT_REMAP_F0=false;defines.CLEARCOAT_TINT_TEXTUREDIRECTUV=0;defines.CLEARCOAT_TINT_GAMMATEXTURE=false;}}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2,engine,subMesh){var _a,_b,_c,_d,_e,_f,_g,_h;if(!this._isEnabled){return;}var defines=subMesh.materialDefines;var isFrozen=this._material.isFrozen;var disableBumpMap=this._material._disableBumpMap;var invertNormalMapX=this._material._invertNormalMapX;var invertNormalMapY=this._material._invertNormalMapY;var identicalTextures=defines.CLEARCOAT_TEXTURE_ROUGHNESS_IDENTICAL;if(!uniformBuffer.useUbo||!isFrozen||!uniformBuffer.isSync){if(identicalTextures&&MaterialFlags.ClearCoatTextureEnabled){uniformBuffer.updateFloat4("vClearCoatInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1);MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"clearCoat");}else if((this._texture||this._textureRoughness)&&MaterialFlags.ClearCoatTextureEnabled){uniformBuffer.updateFloat4("vClearCoatInfos",(_b=(_a=this._texture)===null||_a===void 0?void 0:_a.coordinatesIndex)!==null&&_b!==void 0?_b:0,(_d=(_c=this._texture)===null||_c===void 0?void 0:_c.level)!==null&&_d!==void 0?_d:0,(_f=(_e=this._textureRoughness)===null||_e===void 0?void 0:_e.coordinatesIndex)!==null&&_f!==void 0?_f:0,(_h=(_g=this._textureRoughness)===null||_g===void 0?void 0:_g.level)!==null&&_h!==void 0?_h:0);if(this._texture){MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"clearCoat");}if(this._textureRoughness&&!identicalTextures&&!defines.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE){MaterialHelper.BindTextureMatrix(this._textureRoughness,uniformBuffer,"clearCoatRoughness");}}if(this._bumpTexture&&engine.getCaps().standardDerivatives&&MaterialFlags.ClearCoatTextureEnabled&&!disableBumpMap){uniformBuffer.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level);MaterialHelper.BindTextureMatrix(this._bumpTexture,uniformBuffer,"clearCoatBump");if(scene2._mirroredCameraPosition){uniformBuffer.updateFloat2("vClearCoatTangentSpaceParams",invertNormalMapX?1:-1,invertNormalMapY?1:-1);}else{uniformBuffer.updateFloat2("vClearCoatTangentSpaceParams",invertNormalMapX?-1:1,invertNormalMapY?-1:1);}}if(this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled){uniformBuffer.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level);MaterialHelper.BindTextureMatrix(this._tintTexture,uniformBuffer,"clearCoatTint");}uniformBuffer.updateFloat2("vClearCoatParams",this.intensity,this.roughness);var a=1-this._indexOfRefraction;var b=1+this._indexOfRefraction;var f0=Math.pow(-a/b,2);var eta=1/this._indexOfRefraction;uniformBuffer.updateFloat4("vClearCoatRefractionParams",f0,eta,a,b);if(this._isTintEnabled){uniformBuffer.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness));uniformBuffer.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance));}}if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.ClearCoatTextureEnabled){uniformBuffer.setTexture("clearCoatSampler",this._texture);}if(this._textureRoughness&&!identicalTextures&&!defines.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&MaterialFlags.ClearCoatTextureEnabled){uniformBuffer.setTexture("clearCoatRoughnessSampler",this._textureRoughness);}if(this._bumpTexture&&engine.getCaps().standardDerivatives&&MaterialFlags.ClearCoatBumpTextureEnabled&&!disableBumpMap){uniformBuffer.setTexture("clearCoatBumpSampler",this._bumpTexture);}if(this._isTintEnabled&&this._tintTexture&&MaterialFlags.ClearCoatTintTextureEnabled){uniformBuffer.setTexture("clearCoatTintSampler",this._tintTexture);}}}},{key:"hasTexture",value:function hasTexture(texture){if(this._texture===texture){return true;}if(this._textureRoughness===texture){return true;}if(this._bumpTexture===texture){return true;}if(this._tintTexture===texture){return true;}return false;}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){if(this._texture){activeTextures.push(this._texture);}if(this._textureRoughness){activeTextures.push(this._textureRoughness);}if(this._bumpTexture){activeTextures.push(this._bumpTexture);}if(this._tintTexture){activeTextures.push(this._tintTexture);}}},{key:"getAnimatables",value:function getAnimatables(animatables){if(this._texture&&this._texture.animations&&this._texture.animations.length>0){animatables.push(this._texture);}if(this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0){animatables.push(this._textureRoughness);}if(this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0){animatables.push(this._bumpTexture);}if(this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0){animatables.push(this._tintTexture);}}},{key:"dispose",value:function dispose(forceDisposeTextures){var _a,_b,_c,_d;if(forceDisposeTextures){(_a=this._texture)===null||_a===void 0?void 0:_a.dispose();(_b=this._textureRoughness)===null||_b===void 0?void 0:_b.dispose();(_c=this._bumpTexture)===null||_c===void 0?void 0:_c.dispose();(_d=this._tintTexture)===null||_d===void 0?void 0:_d.dispose();}}},{key:"getClassName",value:function getClassName(){return"PBRClearCoatConfiguration";}},{key:"addFallbacks",value:function addFallbacks(defines,fallbacks,currentRank){if(defines.CLEARCOAT_BUMP){fallbacks.addFallback(currentRank++,"CLEARCOAT_BUMP");}if(defines.CLEARCOAT_TINT){fallbacks.addFallback(currentRank++,"CLEARCOAT_TINT");}if(defines.CLEARCOAT){fallbacks.addFallback(currentRank++,"CLEARCOAT");}return currentRank;}},{key:"getSamplers",value:function getSamplers(samplers){samplers.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler");}},{key:"getUniforms",value:function getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]};}}]);return PBRClearCoatConfiguration;}(MaterialPluginBase);PBRClearCoatConfiguration._DefaultIndexOfRefraction=1.5;__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"isEnabled",void 0);__decorate([serialize()],PBRClearCoatConfiguration.prototype,"intensity",void 0);__decorate([serialize()],PBRClearCoatConfiguration.prototype,"roughness",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"indexOfRefraction",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"texture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"useRoughnessFromMainTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"textureRoughness",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"remapF0OnInterfaceChange",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"bumpTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"isTintEnabled",void 0);__decorate([serializeAsColor3()],PBRClearCoatConfiguration.prototype,"tintColor",void 0);__decorate([serialize()],PBRClearCoatConfiguration.prototype,"tintColorAtDistance",void 0);__decorate([serialize()],PBRClearCoatConfiguration.prototype,"tintThickness",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRClearCoatConfiguration.prototype,"tintTexture",void 0);// node_modules/@babylonjs/core/Materials/PBR/pbrIridescenceConfiguration.js
var MaterialIridescenceDefines=/*#__PURE__*/function(_MaterialDefines5){_inherits(MaterialIridescenceDefines,_MaterialDefines5);var _super58=_createSuper(MaterialIridescenceDefines);function MaterialIridescenceDefines(){var _this172;_classCallCheck(this,MaterialIridescenceDefines);_this172=_super58.apply(this,arguments);_this172.IRIDESCENCE=false;_this172.IRIDESCENCE_TEXTURE=false;_this172.IRIDESCENCE_TEXTUREDIRECTUV=0;_this172.IRIDESCENCE_THICKNESS_TEXTURE=false;_this172.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0;_this172.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=false;return _this172;}return _createClass(MaterialIridescenceDefines);}(MaterialDefines);var PBRIridescenceConfiguration=/*#__PURE__*/function(_MaterialPluginBase4){_inherits(PBRIridescenceConfiguration,_MaterialPluginBase4);var _super59=_createSuper(PBRIridescenceConfiguration);function PBRIridescenceConfiguration(material){var _this173;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,PBRIridescenceConfiguration);_this173=_super59.call(this,material,"PBRIridescence",110,new MaterialIridescenceDefines(),addToPluginList);_this173._isEnabled=false;_this173.isEnabled=false;_this173.intensity=1;_this173.minimumThickness=PBRIridescenceConfiguration._DefaultMinimumThickness;_this173.maximumThickness=PBRIridescenceConfiguration._DefaultMaximumThickness;_this173.indexOfRefraction=PBRIridescenceConfiguration._DefaultIndexOfRefraction;_this173._texture=null;_this173.texture=null;_this173._thicknessTexture=null;_this173.thicknessTexture=null;_this173._internalMarkAllSubMeshesAsTexturesDirty=material._dirtyCallbacks[1];return _this173;}_createClass(PBRIridescenceConfiguration,[{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled);this._internalMarkAllSubMeshesAsTexturesDirty();}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2){if(!this._isEnabled){return true;}if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.IridescenceTextureEnabled){if(!this._texture.isReadyOrNotBlocking()){return false;}}if(this._thicknessTexture&&MaterialFlags.IridescenceTextureEnabled){if(!this._thicknessTexture.isReadyOrNotBlocking()){return false;}}}}return true;}},{key:"prepareDefinesBeforeAttributes",value:function prepareDefinesBeforeAttributes(defines,scene2){var _a;if(this._isEnabled){defines.IRIDESCENCE=true;defines.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=this._texture!==null&&this._texture._texture===((_a=this._thicknessTexture)===null||_a===void 0?void 0:_a._texture)&&this._texture.checkTransformsAreIdentical(this._thicknessTexture);if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.IridescenceTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._texture,defines,"IRIDESCENCE_TEXTURE");}else{defines.IRIDESCENCE_TEXTURE=false;}if(!defines.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&this._thicknessTexture&&MaterialFlags.IridescenceTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._thicknessTexture,defines,"IRIDESCENCE_THICKNESS_TEXTURE");}else{defines.IRIDESCENCE_THICKNESS_TEXTURE=false;}}}}else{defines.IRIDESCENCE=false;defines.IRIDESCENCE_TEXTURE=false;defines.IRIDESCENCE_THICKNESS_TEXTURE=false;defines.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE=false;defines.IRIDESCENCE_TEXTUREDIRECTUV=0;defines.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0;}}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2,engine,subMesh){var _a,_b,_c,_d,_e,_f,_g,_h;if(!this._isEnabled){return;}var defines=subMesh.materialDefines;var isFrozen=this._material.isFrozen;var identicalTextures=defines.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE;if(!uniformBuffer.useUbo||!isFrozen||!uniformBuffer.isSync){if(identicalTextures&&MaterialFlags.IridescenceTextureEnabled){uniformBuffer.updateFloat4("vIridescenceInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1);MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"iridescence");}else if((this._texture||this._thicknessTexture)&&MaterialFlags.IridescenceTextureEnabled){uniformBuffer.updateFloat4("vIridescenceInfos",(_b=(_a=this._texture)===null||_a===void 0?void 0:_a.coordinatesIndex)!==null&&_b!==void 0?_b:0,(_d=(_c=this._texture)===null||_c===void 0?void 0:_c.level)!==null&&_d!==void 0?_d:0,(_f=(_e=this._thicknessTexture)===null||_e===void 0?void 0:_e.coordinatesIndex)!==null&&_f!==void 0?_f:0,(_h=(_g=this._thicknessTexture)===null||_g===void 0?void 0:_g.level)!==null&&_h!==void 0?_h:0);if(this._texture){MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"iridescence");}if(this._thicknessTexture&&!identicalTextures&&!defines.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE){MaterialHelper.BindTextureMatrix(this._thicknessTexture,uniformBuffer,"iridescenceThickness");}}uniformBuffer.updateFloat4("vIridescenceParams",this.intensity,this.indexOfRefraction,this.minimumThickness,this.maximumThickness);}if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.IridescenceTextureEnabled){uniformBuffer.setTexture("iridescenceSampler",this._texture);}if(this._thicknessTexture&&!identicalTextures&&!defines.IRIDESCENCE_USE_THICKNESS_FROM_MAINTEXTURE&&MaterialFlags.IridescenceTextureEnabled){uniformBuffer.setTexture("iridescenceThicknessSampler",this._thicknessTexture);}}}},{key:"hasTexture",value:function hasTexture(texture){if(this._texture===texture){return true;}if(this._thicknessTexture===texture){return true;}return false;}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){if(this._texture){activeTextures.push(this._texture);}if(this._thicknessTexture){activeTextures.push(this._thicknessTexture);}}},{key:"getAnimatables",value:function getAnimatables(animatables){if(this._texture&&this._texture.animations&&this._texture.animations.length>0){animatables.push(this._texture);}if(this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0){animatables.push(this._thicknessTexture);}}},{key:"dispose",value:function dispose(forceDisposeTextures){var _a,_b;if(forceDisposeTextures){(_a=this._texture)===null||_a===void 0?void 0:_a.dispose();(_b=this._thicknessTexture)===null||_b===void 0?void 0:_b.dispose();}}},{key:"getClassName",value:function getClassName(){return"PBRIridescenceConfiguration";}},{key:"addFallbacks",value:function addFallbacks(defines,fallbacks,currentRank){if(defines.IRIDESCENCE){fallbacks.addFallback(currentRank++,"IRIDESCENCE");}return currentRank;}},{key:"getSamplers",value:function getSamplers(samplers){samplers.push("iridescenceSampler","iridescenceThicknessSampler");}},{key:"getUniforms",value:function getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]};}}]);return PBRIridescenceConfiguration;}(MaterialPluginBase);PBRIridescenceConfiguration._DefaultMinimumThickness=100;PBRIridescenceConfiguration._DefaultMaximumThickness=400;PBRIridescenceConfiguration._DefaultIndexOfRefraction=1.3;__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRIridescenceConfiguration.prototype,"isEnabled",void 0);__decorate([serialize()],PBRIridescenceConfiguration.prototype,"intensity",void 0);__decorate([serialize()],PBRIridescenceConfiguration.prototype,"minimumThickness",void 0);__decorate([serialize()],PBRIridescenceConfiguration.prototype,"maximumThickness",void 0);__decorate([serialize()],PBRIridescenceConfiguration.prototype,"indexOfRefraction",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRIridescenceConfiguration.prototype,"texture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRIridescenceConfiguration.prototype,"thicknessTexture",void 0);// node_modules/@babylonjs/core/Materials/PBR/pbrAnisotropicConfiguration.js
var MaterialAnisotropicDefines=/*#__PURE__*/function(_MaterialDefines6){_inherits(MaterialAnisotropicDefines,_MaterialDefines6);var _super60=_createSuper(MaterialAnisotropicDefines);function MaterialAnisotropicDefines(){var _this174;_classCallCheck(this,MaterialAnisotropicDefines);_this174=_super60.apply(this,arguments);_this174.ANISOTROPIC=false;_this174.ANISOTROPIC_TEXTURE=false;_this174.ANISOTROPIC_TEXTUREDIRECTUV=0;_this174.MAINUV1=false;return _this174;}return _createClass(MaterialAnisotropicDefines);}(MaterialDefines);var PBRAnisotropicConfiguration=/*#__PURE__*/function(_MaterialPluginBase5){_inherits(PBRAnisotropicConfiguration,_MaterialPluginBase5);var _super61=_createSuper(PBRAnisotropicConfiguration);function PBRAnisotropicConfiguration(material){var _this175;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,PBRAnisotropicConfiguration);_this175=_super61.call(this,material,"PBRAnisotropic",110,new MaterialAnisotropicDefines(),addToPluginList);_this175._isEnabled=false;_this175.isEnabled=false;_this175.intensity=1;_this175.direction=new Vector2(1,0);_this175._texture=null;_this175.texture=null;_this175._internalMarkAllSubMeshesAsTexturesDirty=material._dirtyCallbacks[1];return _this175;}_createClass(PBRAnisotropicConfiguration,[{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled);this._internalMarkAllSubMeshesAsTexturesDirty();}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2){if(!this._isEnabled){return true;}if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.AnisotropicTextureEnabled){if(!this._texture.isReadyOrNotBlocking()){return false;}}}}return true;}},{key:"prepareDefinesBeforeAttributes",value:function prepareDefinesBeforeAttributes(defines,scene2,mesh){if(this._isEnabled){defines.ANISOTROPIC=this._isEnabled;if(this._isEnabled&&!mesh.isVerticesDataPresent(VertexBuffer.TangentKind)){defines._needUVs=true;defines.MAINUV1=true;}if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.AnisotropicTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._texture,defines,"ANISOTROPIC_TEXTURE");}else{defines.ANISOTROPIC_TEXTURE=false;}}}}else{defines.ANISOTROPIC=false;defines.ANISOTROPIC_TEXTURE=false;defines.ANISOTROPIC_TEXTUREDIRECTUV=0;defines.MAINUV1=false;}}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2){if(!this._isEnabled){return;}var isFrozen=this._material.isFrozen;if(!uniformBuffer.useUbo||!isFrozen||!uniformBuffer.isSync){if(this._texture&&MaterialFlags.AnisotropicTextureEnabled){uniformBuffer.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level);MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"anisotropy");}uniformBuffer.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.intensity);}if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.AnisotropicTextureEnabled){uniformBuffer.setTexture("anisotropySampler",this._texture);}}}},{key:"hasTexture",value:function hasTexture(texture){if(this._texture===texture){return true;}return false;}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){if(this._texture){activeTextures.push(this._texture);}}},{key:"getAnimatables",value:function getAnimatables(animatables){if(this._texture&&this._texture.animations&&this._texture.animations.length>0){animatables.push(this._texture);}}},{key:"dispose",value:function dispose(forceDisposeTextures){if(forceDisposeTextures){if(this._texture){this._texture.dispose();}}}},{key:"getClassName",value:function getClassName(){return"PBRAnisotropicConfiguration";}},{key:"addFallbacks",value:function addFallbacks(defines,fallbacks,currentRank){if(defines.ANISOTROPIC){fallbacks.addFallback(currentRank++,"ANISOTROPIC");}return currentRank;}},{key:"getSamplers",value:function getSamplers(samplers){samplers.push("anisotropySampler");}},{key:"getUniforms",value:function getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]};}}]);return PBRAnisotropicConfiguration;}(MaterialPluginBase);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRAnisotropicConfiguration.prototype,"isEnabled",void 0);__decorate([serialize()],PBRAnisotropicConfiguration.prototype,"intensity",void 0);__decorate([serializeAsVector2()],PBRAnisotropicConfiguration.prototype,"direction",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRAnisotropicConfiguration.prototype,"texture",void 0);// node_modules/@babylonjs/core/Materials/PBR/pbrSheenConfiguration.js
var MaterialSheenDefines=/*#__PURE__*/function(_MaterialDefines7){_inherits(MaterialSheenDefines,_MaterialDefines7);var _super62=_createSuper(MaterialSheenDefines);function MaterialSheenDefines(){var _this176;_classCallCheck(this,MaterialSheenDefines);_this176=_super62.apply(this,arguments);_this176.SHEEN=false;_this176.SHEEN_TEXTURE=false;_this176.SHEEN_GAMMATEXTURE=false;_this176.SHEEN_TEXTURE_ROUGHNESS=false;_this176.SHEEN_TEXTUREDIRECTUV=0;_this176.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0;_this176.SHEEN_LINKWITHALBEDO=false;_this176.SHEEN_ROUGHNESS=false;_this176.SHEEN_ALBEDOSCALING=false;_this176.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=false;_this176.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=false;return _this176;}return _createClass(MaterialSheenDefines);}(MaterialDefines);var PBRSheenConfiguration=/*#__PURE__*/function(_MaterialPluginBase6){_inherits(PBRSheenConfiguration,_MaterialPluginBase6);var _super63=_createSuper(PBRSheenConfiguration);function PBRSheenConfiguration(material){var _this177;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,PBRSheenConfiguration);_this177=_super63.call(this,material,"Sheen",120,new MaterialSheenDefines(),addToPluginList);_this177._isEnabled=false;_this177.isEnabled=false;_this177._linkSheenWithAlbedo=false;_this177.linkSheenWithAlbedo=false;_this177.intensity=1;_this177.color=Color3.White();_this177._texture=null;_this177.texture=null;_this177._useRoughnessFromMainTexture=true;_this177.useRoughnessFromMainTexture=true;_this177._roughness=null;_this177.roughness=null;_this177._textureRoughness=null;_this177.textureRoughness=null;_this177._albedoScaling=false;_this177.albedoScaling=false;_this177._internalMarkAllSubMeshesAsTexturesDirty=material._dirtyCallbacks[1];return _this177;}_createClass(PBRSheenConfiguration,[{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled);this._internalMarkAllSubMeshesAsTexturesDirty();}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2){if(!this._isEnabled){return true;}if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.SheenTextureEnabled){if(!this._texture.isReadyOrNotBlocking()){return false;}}if(this._textureRoughness&&MaterialFlags.SheenTextureEnabled){if(!this._textureRoughness.isReadyOrNotBlocking()){return false;}}}}return true;}},{key:"prepareDefinesBeforeAttributes",value:function prepareDefinesBeforeAttributes(defines,scene2){var _a;if(this._isEnabled){defines.SHEEN=true;defines.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo;defines.SHEEN_ROUGHNESS=this._roughness!==null;defines.SHEEN_ALBEDOSCALING=this._albedoScaling;defines.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture;defines.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=this._texture!==null&&this._texture._texture===((_a=this._textureRoughness)===null||_a===void 0?void 0:_a._texture)&&this._texture.checkTransformsAreIdentical(this._textureRoughness);if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.SheenTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._texture,defines,"SHEEN_TEXTURE");defines.SHEEN_GAMMATEXTURE=this._texture.gammaSpace;}else{defines.SHEEN_TEXTURE=false;}if(this._textureRoughness&&MaterialFlags.SheenTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._textureRoughness,defines,"SHEEN_TEXTURE_ROUGHNESS");}else{defines.SHEEN_TEXTURE_ROUGHNESS=false;}}}}else{defines.SHEEN=false;defines.SHEEN_TEXTURE=false;defines.SHEEN_TEXTURE_ROUGHNESS=false;defines.SHEEN_LINKWITHALBEDO=false;defines.SHEEN_ROUGHNESS=false;defines.SHEEN_ALBEDOSCALING=false;defines.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=false;defines.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL=false;defines.SHEEN_GAMMATEXTURE=false;defines.SHEEN_TEXTUREDIRECTUV=0;defines.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0;}}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2,engine,subMesh){var _a,_b,_c,_d,_e,_f,_g,_h;if(!this._isEnabled){return;}var defines=subMesh.materialDefines;var isFrozen=this._material.isFrozen;var identicalTextures=defines.SHEEN_TEXTURE_ROUGHNESS_IDENTICAL;if(!uniformBuffer.useUbo||!isFrozen||!uniformBuffer.isSync){if(identicalTextures&&MaterialFlags.SheenTextureEnabled){uniformBuffer.updateFloat4("vSheenInfos",this._texture.coordinatesIndex,this._texture.level,-1,-1);MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"sheen");}else if((this._texture||this._textureRoughness)&&MaterialFlags.SheenTextureEnabled){uniformBuffer.updateFloat4("vSheenInfos",(_b=(_a=this._texture)===null||_a===void 0?void 0:_a.coordinatesIndex)!==null&&_b!==void 0?_b:0,(_d=(_c=this._texture)===null||_c===void 0?void 0:_c.level)!==null&&_d!==void 0?_d:0,(_f=(_e=this._textureRoughness)===null||_e===void 0?void 0:_e.coordinatesIndex)!==null&&_f!==void 0?_f:0,(_h=(_g=this._textureRoughness)===null||_g===void 0?void 0:_g.level)!==null&&_h!==void 0?_h:0);if(this._texture){MaterialHelper.BindTextureMatrix(this._texture,uniformBuffer,"sheen");}if(this._textureRoughness&&!identicalTextures&&!defines.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE){MaterialHelper.BindTextureMatrix(this._textureRoughness,uniformBuffer,"sheenRoughness");}}uniformBuffer.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.intensity);if(this._roughness!==null){uniformBuffer.updateFloat("vSheenRoughness",this._roughness);}}if(scene2.texturesEnabled){if(this._texture&&MaterialFlags.SheenTextureEnabled){uniformBuffer.setTexture("sheenSampler",this._texture);}if(this._textureRoughness&&!identicalTextures&&!defines.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&MaterialFlags.SheenTextureEnabled){uniformBuffer.setTexture("sheenRoughnessSampler",this._textureRoughness);}}}},{key:"hasTexture",value:function hasTexture(texture){if(this._texture===texture){return true;}if(this._textureRoughness===texture){return true;}return false;}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){if(this._texture){activeTextures.push(this._texture);}if(this._textureRoughness){activeTextures.push(this._textureRoughness);}}},{key:"getAnimatables",value:function getAnimatables(animatables){if(this._texture&&this._texture.animations&&this._texture.animations.length>0){animatables.push(this._texture);}if(this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0){animatables.push(this._textureRoughness);}}},{key:"dispose",value:function dispose(forceDisposeTextures){var _a,_b;if(forceDisposeTextures){(_a=this._texture)===null||_a===void 0?void 0:_a.dispose();(_b=this._textureRoughness)===null||_b===void 0?void 0:_b.dispose();}}},{key:"getClassName",value:function getClassName(){return"PBRSheenConfiguration";}},{key:"addFallbacks",value:function addFallbacks(defines,fallbacks,currentRank){if(defines.SHEEN){fallbacks.addFallback(currentRank++,"SHEEN");}return currentRank;}},{key:"getSamplers",value:function getSamplers(samplers){samplers.push("sheenSampler","sheenRoughnessSampler");}},{key:"getUniforms",value:function getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]};}}]);return PBRSheenConfiguration;}(MaterialPluginBase);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"isEnabled",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"linkSheenWithAlbedo",void 0);__decorate([serialize()],PBRSheenConfiguration.prototype,"intensity",void 0);__decorate([serializeAsColor3()],PBRSheenConfiguration.prototype,"color",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"texture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"useRoughnessFromMainTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"roughness",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"textureRoughness",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSheenConfiguration.prototype,"albedoScaling",void 0);// node_modules/@babylonjs/core/Materials/PBR/pbrSubSurfaceConfiguration.js
var MaterialSubSurfaceDefines=/*#__PURE__*/function(_MaterialDefines8){_inherits(MaterialSubSurfaceDefines,_MaterialDefines8);var _super64=_createSuper(MaterialSubSurfaceDefines);function MaterialSubSurfaceDefines(){var _this178;_classCallCheck(this,MaterialSubSurfaceDefines);_this178=_super64.apply(this,arguments);_this178.SUBSURFACE=false;_this178.SS_REFRACTION=false;_this178.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=false;_this178.SS_TRANSLUCENCY=false;_this178.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=false;_this178.SS_SCATTERING=false;_this178.SS_THICKNESSANDMASK_TEXTURE=false;_this178.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0;_this178.SS_HAS_THICKNESS=false;_this178.SS_REFRACTIONINTENSITY_TEXTURE=false;_this178.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0;_this178.SS_TRANSLUCENCYINTENSITY_TEXTURE=false;_this178.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0;_this178.SS_REFRACTIONMAP_3D=false;_this178.SS_REFRACTIONMAP_OPPOSITEZ=false;_this178.SS_LODINREFRACTIONALPHA=false;_this178.SS_GAMMAREFRACTION=false;_this178.SS_RGBDREFRACTION=false;_this178.SS_LINEARSPECULARREFRACTION=false;_this178.SS_LINKREFRACTIONTOTRANSPARENCY=false;_this178.SS_ALBEDOFORREFRACTIONTINT=false;_this178.SS_ALBEDOFORTRANSLUCENCYTINT=false;_this178.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=false;_this178.SS_USE_THICKNESS_AS_DEPTH=false;_this178.SS_MASK_FROM_THICKNESS_TEXTURE=false;_this178.SS_USE_GLTF_TEXTURES=false;return _this178;}return _createClass(MaterialSubSurfaceDefines);}(MaterialDefines);var PBRSubSurfaceConfiguration=/*#__PURE__*/function(_MaterialPluginBase7){_inherits(PBRSubSurfaceConfiguration,_MaterialPluginBase7);var _super65=_createSuper(PBRSubSurfaceConfiguration);function PBRSubSurfaceConfiguration(material){var _this179;var addToPluginList=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,PBRSubSurfaceConfiguration);_this179=_super65.call(this,material,"PBRSubSurface",130,new MaterialSubSurfaceDefines(),addToPluginList);_this179._isRefractionEnabled=false;_this179.isRefractionEnabled=false;_this179._isTranslucencyEnabled=false;_this179.isTranslucencyEnabled=false;_this179._isScatteringEnabled=false;_this179.isScatteringEnabled=false;_this179._scatteringDiffusionProfileIndex=0;_this179.refractionIntensity=1;_this179.translucencyIntensity=1;_this179.useAlbedoToTintRefraction=false;_this179.useAlbedoToTintTranslucency=false;_this179._thicknessTexture=null;_this179.thicknessTexture=null;_this179._refractionTexture=null;_this179.refractionTexture=null;_this179._indexOfRefraction=1.5;_this179.indexOfRefraction=1.5;_this179._volumeIndexOfRefraction=-1;_this179._invertRefractionY=false;_this179.invertRefractionY=false;_this179._linkRefractionWithTransparency=false;_this179.linkRefractionWithTransparency=false;_this179.minimumThickness=0;_this179.maximumThickness=1;_this179.useThicknessAsDepth=false;_this179.tintColor=Color3.White();_this179.tintColorAtDistance=1;_this179.diffusionDistance=Color3.White();_this179._useMaskFromThicknessTexture=false;_this179.useMaskFromThicknessTexture=false;_this179._refractionIntensityTexture=null;_this179.refractionIntensityTexture=null;_this179._translucencyIntensityTexture=null;_this179.translucencyIntensityTexture=null;_this179._useGltfStyleTextures=false;_this179.useGltfStyleTextures=false;_this179._scene=material.getScene();_this179.registerForExtraEvents=true;_this179._internalMarkAllSubMeshesAsTexturesDirty=material._dirtyCallbacks[1];_this179._internalMarkScenePrePassDirty=material._dirtyCallbacks[32];return _this179;}_createClass(PBRSubSurfaceConfiguration,[{key:"scatteringDiffusionProfile",get:function get(){if(!this._scene.subSurfaceConfiguration){return null;}return this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex];},set:function set(c){if(!this._scene.enableSubSurfaceForPrePass()){return;}if(c){this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(c);}}},{key:"volumeIndexOfRefraction",get:function get(){if(this._volumeIndexOfRefraction>=1){return this._volumeIndexOfRefraction;}return this._indexOfRefraction;},set:function set(value){if(value>=1){this._volumeIndexOfRefraction=value;}else{this._volumeIndexOfRefraction=-1;}}},{key:"_markAllSubMeshesAsTexturesDirty",value:function _markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled);this._internalMarkAllSubMeshesAsTexturesDirty();}},{key:"_markScenePrePassDirty",value:function _markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty();this._internalMarkScenePrePassDirty();}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(defines,scene2){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled){return true;}if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled){if(!this._thicknessTexture.isReadyOrNotBlocking()){return false;}}var refractionTexture=this._getRefractionTexture(scene2);if(refractionTexture&&MaterialFlags.RefractionTextureEnabled){if(!refractionTexture.isReadyOrNotBlocking()){return false;}}}}return true;}},{key:"prepareDefinesBeforeAttributes",value:function prepareDefinesBeforeAttributes(defines,scene2){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled){defines.SUBSURFACE=false;defines.SS_TRANSLUCENCY=false;defines.SS_SCATTERING=false;defines.SS_REFRACTION=false;defines.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=false;defines.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=false;defines.SS_THICKNESSANDMASK_TEXTURE=false;defines.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0;defines.SS_HAS_THICKNESS=false;defines.SS_REFRACTIONINTENSITY_TEXTURE=false;defines.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0;defines.SS_TRANSLUCENCYINTENSITY_TEXTURE=false;defines.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0;defines.SS_REFRACTIONMAP_3D=false;defines.SS_REFRACTIONMAP_OPPOSITEZ=false;defines.SS_LODINREFRACTIONALPHA=false;defines.SS_GAMMAREFRACTION=false;defines.SS_RGBDREFRACTION=false;defines.SS_LINEARSPECULARREFRACTION=false;defines.SS_LINKREFRACTIONTOTRANSPARENCY=false;defines.SS_ALBEDOFORREFRACTIONTINT=false;defines.SS_ALBEDOFORTRANSLUCENCYTINT=false;defines.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=false;defines.SS_USE_THICKNESS_AS_DEPTH=false;defines.SS_MASK_FROM_THICKNESS_TEXTURE=false;defines.SS_USE_GLTF_TEXTURES=false;return;}if(defines._areTexturesDirty){defines.SUBSURFACE=true;defines.SS_TRANSLUCENCY=this._isTranslucencyEnabled;defines.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=false;defines.SS_SCATTERING=this._isScatteringEnabled;defines.SS_THICKNESSANDMASK_TEXTURE=false;defines.SS_REFRACTIONINTENSITY_TEXTURE=false;defines.SS_TRANSLUCENCYINTENSITY_TEXTURE=false;defines.SS_HAS_THICKNESS=false;defines.SS_MASK_FROM_THICKNESS_TEXTURE=false;defines.SS_USE_GLTF_TEXTURES=false;defines.SS_REFRACTION=false;defines.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=false;defines.SS_REFRACTIONMAP_3D=false;defines.SS_GAMMAREFRACTION=false;defines.SS_RGBDREFRACTION=false;defines.SS_LINEARSPECULARREFRACTION=false;defines.SS_REFRACTIONMAP_OPPOSITEZ=false;defines.SS_LODINREFRACTIONALPHA=false;defines.SS_LINKREFRACTIONTOTRANSPARENCY=false;defines.SS_ALBEDOFORREFRACTIONTINT=false;defines.SS_ALBEDOFORTRANSLUCENCYTINT=false;defines.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=false;defines.SS_USE_THICKNESS_AS_DEPTH=false;var refractionIntensityTextureIsThicknessTexture=!!this._thicknessTexture&&!!this._refractionIntensityTexture&&this._refractionIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._refractionIntensityTexture._texture===this._thicknessTexture._texture;var translucencyIntensityTextureIsThicknessTexture=!!this._thicknessTexture&&!!this._translucencyIntensityTexture&&this._translucencyIntensityTexture.checkTransformsAreIdentical(this._thicknessTexture)&&this._translucencyIntensityTexture._texture===this._thicknessTexture._texture;var useOnlyThicknessTexture=(refractionIntensityTextureIsThicknessTexture||!this._refractionIntensityTexture)&&(translucencyIntensityTextureIsThicknessTexture||!this._translucencyIntensityTexture);if(defines._areTexturesDirty){if(scene2.texturesEnabled){if(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._thicknessTexture,defines,"SS_THICKNESSANDMASK_TEXTURE");}if(this._refractionIntensityTexture&&MaterialFlags.RefractionIntensityTextureEnabled&&!useOnlyThicknessTexture){MaterialHelper.PrepareDefinesForMergedUV(this._refractionIntensityTexture,defines,"SS_REFRACTIONINTENSITY_TEXTURE");}if(this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&!useOnlyThicknessTexture){MaterialHelper.PrepareDefinesForMergedUV(this._translucencyIntensityTexture,defines,"SS_TRANSLUCENCYINTENSITY_TEXTURE");}}}defines.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0;defines.SS_MASK_FROM_THICKNESS_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture||!!this._translucencyIntensityTexture)&&useOnlyThicknessTexture;defines.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures;defines.SS_REFRACTION_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._refractionIntensityTexture)&&useOnlyThicknessTexture;defines.SS_TRANSLUCENCY_USE_INTENSITY_FROM_TEXTURE=(this._useMaskFromThicknessTexture||!!this._translucencyIntensityTexture)&&useOnlyThicknessTexture;if(this._isRefractionEnabled){if(scene2.texturesEnabled){var refractionTexture=this._getRefractionTexture(scene2);if(refractionTexture&&MaterialFlags.RefractionTextureEnabled){defines.SS_REFRACTION=true;defines.SS_REFRACTIONMAP_3D=refractionTexture.isCube;defines.SS_GAMMAREFRACTION=refractionTexture.gammaSpace;defines.SS_RGBDREFRACTION=refractionTexture.isRGBD;defines.SS_LINEARSPECULARREFRACTION=refractionTexture.linearSpecularLOD;defines.SS_REFRACTIONMAP_OPPOSITEZ=refractionTexture.invertZ;defines.SS_LODINREFRACTIONALPHA=refractionTexture.lodLevelInAlpha;defines.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency;defines.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction;defines.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=refractionTexture.isCube&&refractionTexture.boundingBoxSize;defines.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth;}}}if(this._isTranslucencyEnabled){defines.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency;}}}},{key:"hardBindForSubMesh",value:function hardBindForSubMesh(uniformBuffer,scene2,engine,subMesh){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled){return;}subMesh.getRenderingMesh().getWorldMatrix().decompose(TmpVectors.Vector3[0]);var thicknessScale=Math.max(Math.abs(TmpVectors.Vector3[0].x),Math.abs(TmpVectors.Vector3[0].y),Math.abs(TmpVectors.Vector3[0].z));uniformBuffer.updateFloat2("vThicknessParam",this.minimumThickness*thicknessScale,(this.maximumThickness-this.minimumThickness)*thicknessScale);}},{key:"bindForSubMesh",value:function bindForSubMesh(uniformBuffer,scene2,engine,subMesh){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled){return;}var defines=subMesh.materialDefines;var isFrozen=this._material.isFrozen;var realTimeFiltering=this._material.realTimeFiltering;var lodBasedMicrosurface=defines.LODBASEDMICROSFURACE;var refractionTexture=this._getRefractionTexture(scene2);if(!uniformBuffer.useUbo||!isFrozen||!uniformBuffer.isSync){if(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled){uniformBuffer.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level);MaterialHelper.BindTextureMatrix(this._thicknessTexture,uniformBuffer,"thickness");}if(this._refractionIntensityTexture&&MaterialFlags.RefractionIntensityTextureEnabled&&defines.SS_REFRACTIONINTENSITY_TEXTURE){uniformBuffer.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level);MaterialHelper.BindTextureMatrix(this._refractionIntensityTexture,uniformBuffer,"refractionIntensity");}if(this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&defines.SS_TRANSLUCENCYINTENSITY_TEXTURE){uniformBuffer.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level);MaterialHelper.BindTextureMatrix(this._translucencyIntensityTexture,uniformBuffer,"translucencyIntensity");}if(refractionTexture&&MaterialFlags.RefractionTextureEnabled){uniformBuffer.updateMatrix("refractionMatrix",refractionTexture.getReflectionTextureMatrix());var depth=1;if(!refractionTexture.isCube){if(refractionTexture.depth){depth=refractionTexture.depth;}}var width=refractionTexture.getSize().width;var refractionIor=this.volumeIndexOfRefraction;uniformBuffer.updateFloat4("vRefractionInfos",refractionTexture.level,1/refractionIor,depth,this._invertRefractionY?-1:1);uniformBuffer.updateFloat4("vRefractionMicrosurfaceInfos",width,refractionTexture.lodGenerationScale,refractionTexture.lodGenerationOffset,1/this.indexOfRefraction);if(realTimeFiltering){uniformBuffer.updateFloat2("vRefractionFilteringInfo",width,Scalar.Log2(width));}if(refractionTexture.boundingBoxSize){var cubeTexture=refractionTexture;uniformBuffer.updateVector3("vRefractionPosition",cubeTexture.boundingBoxPosition);uniformBuffer.updateVector3("vRefractionSize",cubeTexture.boundingBoxSize);}}if(this._isScatteringEnabled){uniformBuffer.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex);}uniformBuffer.updateColor3("vDiffusionDistance",this.diffusionDistance);uniformBuffer.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance));uniformBuffer.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0);}if(scene2.texturesEnabled){if(this._thicknessTexture&&MaterialFlags.ThicknessTextureEnabled){uniformBuffer.setTexture("thicknessSampler",this._thicknessTexture);}if(this._refractionIntensityTexture&&MaterialFlags.RefractionIntensityTextureEnabled&&defines.SS_REFRACTIONINTENSITY_TEXTURE){uniformBuffer.setTexture("refractionIntensitySampler",this._refractionIntensityTexture);}if(this._translucencyIntensityTexture&&MaterialFlags.TranslucencyIntensityTextureEnabled&&defines.SS_TRANSLUCENCYINTENSITY_TEXTURE){uniformBuffer.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture);}if(refractionTexture&&MaterialFlags.RefractionTextureEnabled){if(lodBasedMicrosurface){uniformBuffer.setTexture("refractionSampler",refractionTexture);}else{uniformBuffer.setTexture("refractionSampler",refractionTexture._lodTextureMid||refractionTexture);uniformBuffer.setTexture("refractionSamplerLow",refractionTexture._lodTextureLow||refractionTexture);uniformBuffer.setTexture("refractionSamplerHigh",refractionTexture._lodTextureHigh||refractionTexture);}}}}},{key:"_getRefractionTexture",value:function _getRefractionTexture(scene2){if(this._refractionTexture){return this._refractionTexture;}if(this._isRefractionEnabled){return scene2.environmentTexture;}return null;}},{key:"disableAlphaBlending",get:function get(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency;}},{key:"fillRenderTargetTextures",value:function fillRenderTargetTextures(renderTargets){if(MaterialFlags.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget){renderTargets.push(this._refractionTexture);}}},{key:"hasTexture",value:function hasTexture(texture){if(this._thicknessTexture===texture){return true;}if(this._refractionTexture===texture){return true;}return false;}},{key:"hasRenderTargetTextures",value:function hasRenderTargetTextures(){if(MaterialFlags.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget){return true;}return false;}},{key:"getActiveTextures",value:function getActiveTextures(activeTextures){if(this._thicknessTexture){activeTextures.push(this._thicknessTexture);}if(this._refractionTexture){activeTextures.push(this._refractionTexture);}}},{key:"getAnimatables",value:function getAnimatables(animatables){if(this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0){animatables.push(this._thicknessTexture);}if(this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0){animatables.push(this._refractionTexture);}}},{key:"dispose",value:function dispose(forceDisposeTextures){if(forceDisposeTextures){if(this._thicknessTexture){this._thicknessTexture.dispose();}if(this._refractionTexture){this._refractionTexture.dispose();}}}},{key:"getClassName",value:function getClassName(){return"PBRSubSurfaceConfiguration";}},{key:"addFallbacks",value:function addFallbacks(defines,fallbacks,currentRank){if(defines.SS_SCATTERING){fallbacks.addFallback(currentRank++,"SS_SCATTERING");}if(defines.SS_TRANSLUCENCY){fallbacks.addFallback(currentRank++,"SS_TRANSLUCENCY");}return currentRank;}},{key:"getSamplers",value:function getSamplers(samplers){samplers.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh");}},{key:"getUniforms",value:function getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"}]};}}]);return PBRSubSurfaceConfiguration;}(MaterialPluginBase);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"isRefractionEnabled",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"isTranslucencyEnabled",void 0);__decorate([serialize(),expandToProperty("_markScenePrePassDirty")],PBRSubSurfaceConfiguration.prototype,"isScatteringEnabled",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"_scatteringDiffusionProfileIndex",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"refractionIntensity",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"translucencyIntensity",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"useAlbedoToTintRefraction",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"useAlbedoToTintTranslucency",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"thicknessTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"refractionTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"indexOfRefraction",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"_volumeIndexOfRefraction",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"volumeIndexOfRefraction",null);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"invertRefractionY",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"linkRefractionWithTransparency",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"minimumThickness",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"maximumThickness",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"useThicknessAsDepth",void 0);__decorate([serializeAsColor3()],PBRSubSurfaceConfiguration.prototype,"tintColor",void 0);__decorate([serialize()],PBRSubSurfaceConfiguration.prototype,"tintColorAtDistance",void 0);__decorate([serializeAsColor3()],PBRSubSurfaceConfiguration.prototype,"diffusionDistance",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"useMaskFromThicknessTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"refractionIntensityTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"translucencyIntensityTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRSubSurfaceConfiguration.prototype,"useGltfStyleTextures",void 0);// node_modules/@babylonjs/core/Materials/PBR/pbrBaseMaterial.js
var onCreatedEffectParameters3={effect:null,subMesh:null};var PBRMaterialDefines=/*#__PURE__*/function(_MaterialDefines9){_inherits(PBRMaterialDefines,_MaterialDefines9);var _super66=_createSuper(PBRMaterialDefines);function PBRMaterialDefines(externalProperties){var _this180;_classCallCheck(this,PBRMaterialDefines);_this180=_super66.call(this,externalProperties);_this180.PBR=true;_this180.NUM_SAMPLES="0";_this180.REALTIME_FILTERING=false;_this180.MAINUV1=false;_this180.MAINUV2=false;_this180.MAINUV3=false;_this180.MAINUV4=false;_this180.MAINUV5=false;_this180.MAINUV6=false;_this180.UV1=false;_this180.UV2=false;_this180.UV3=false;_this180.UV4=false;_this180.UV5=false;_this180.UV6=false;_this180.ALBEDO=false;_this180.GAMMAALBEDO=false;_this180.ALBEDODIRECTUV=0;_this180.VERTEXCOLOR=false;_this180.BAKED_VERTEX_ANIMATION_TEXTURE=false;_this180.AMBIENT=false;_this180.AMBIENTDIRECTUV=0;_this180.AMBIENTINGRAYSCALE=false;_this180.OPACITY=false;_this180.VERTEXALPHA=false;_this180.OPACITYDIRECTUV=0;_this180.OPACITYRGB=false;_this180.ALPHATEST=false;_this180.DEPTHPREPASS=false;_this180.ALPHABLEND=false;_this180.ALPHAFROMALBEDO=false;_this180.ALPHATESTVALUE="0.5";_this180.SPECULAROVERALPHA=false;_this180.RADIANCEOVERALPHA=false;_this180.ALPHAFRESNEL=false;_this180.LINEARALPHAFRESNEL=false;_this180.PREMULTIPLYALPHA=false;_this180.EMISSIVE=false;_this180.EMISSIVEDIRECTUV=0;_this180.GAMMAEMISSIVE=false;_this180.REFLECTIVITY=false;_this180.REFLECTIVITY_GAMMA=false;_this180.REFLECTIVITYDIRECTUV=0;_this180.SPECULARTERM=false;_this180.MICROSURFACEFROMREFLECTIVITYMAP=false;_this180.MICROSURFACEAUTOMATIC=false;_this180.LODBASEDMICROSFURACE=false;_this180.MICROSURFACEMAP=false;_this180.MICROSURFACEMAPDIRECTUV=0;_this180.METALLICWORKFLOW=false;_this180.ROUGHNESSSTOREINMETALMAPALPHA=false;_this180.ROUGHNESSSTOREINMETALMAPGREEN=false;_this180.METALLNESSSTOREINMETALMAPBLUE=false;_this180.AOSTOREINMETALMAPRED=false;_this180.METALLIC_REFLECTANCE=false;_this180.METALLIC_REFLECTANCE_GAMMA=false;_this180.METALLIC_REFLECTANCEDIRECTUV=0;_this180.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=false;_this180.REFLECTANCE=false;_this180.REFLECTANCE_GAMMA=false;_this180.REFLECTANCEDIRECTUV=0;_this180.ENVIRONMENTBRDF=false;_this180.ENVIRONMENTBRDF_RGBD=false;_this180.NORMAL=false;_this180.TANGENT=false;_this180.BUMP=false;_this180.BUMPDIRECTUV=0;_this180.OBJECTSPACE_NORMALMAP=false;_this180.PARALLAX=false;_this180.PARALLAXOCCLUSION=false;_this180.NORMALXYSCALE=true;_this180.LIGHTMAP=false;_this180.LIGHTMAPDIRECTUV=0;_this180.USELIGHTMAPASSHADOWMAP=false;_this180.GAMMALIGHTMAP=false;_this180.RGBDLIGHTMAP=false;_this180.REFLECTION=false;_this180.REFLECTIONMAP_3D=false;_this180.REFLECTIONMAP_SPHERICAL=false;_this180.REFLECTIONMAP_PLANAR=false;_this180.REFLECTIONMAP_CUBIC=false;_this180.USE_LOCAL_REFLECTIONMAP_CUBIC=false;_this180.REFLECTIONMAP_PROJECTION=false;_this180.REFLECTIONMAP_SKYBOX=false;_this180.REFLECTIONMAP_EXPLICIT=false;_this180.REFLECTIONMAP_EQUIRECTANGULAR=false;_this180.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=false;_this180.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=false;_this180.INVERTCUBICMAP=false;_this180.USESPHERICALFROMREFLECTIONMAP=false;_this180.USEIRRADIANCEMAP=false;_this180.USESPHERICALINVERTEX=false;_this180.REFLECTIONMAP_OPPOSITEZ=false;_this180.LODINREFLECTIONALPHA=false;_this180.GAMMAREFLECTION=false;_this180.RGBDREFLECTION=false;_this180.LINEARSPECULARREFLECTION=false;_this180.RADIANCEOCCLUSION=false;_this180.HORIZONOCCLUSION=false;_this180.INSTANCES=false;_this180.THIN_INSTANCES=false;_this180.INSTANCESCOLOR=false;_this180.PREPASS=false;_this180.PREPASS_IRRADIANCE=false;_this180.PREPASS_IRRADIANCE_INDEX=-1;_this180.PREPASS_ALBEDO_SQRT=false;_this180.PREPASS_ALBEDO_SQRT_INDEX=-1;_this180.PREPASS_DEPTH=false;_this180.PREPASS_DEPTH_INDEX=-1;_this180.PREPASS_NORMAL=false;_this180.PREPASS_NORMAL_INDEX=-1;_this180.PREPASS_POSITION=false;_this180.PREPASS_POSITION_INDEX=-1;_this180.PREPASS_VELOCITY=false;_this180.PREPASS_VELOCITY_INDEX=-1;_this180.PREPASS_REFLECTIVITY=false;_this180.PREPASS_REFLECTIVITY_INDEX=-1;_this180.SCENE_MRT_COUNT=0;_this180.NUM_BONE_INFLUENCERS=0;_this180.BonesPerMesh=0;_this180.BONETEXTURE=false;_this180.BONES_VELOCITY_ENABLED=false;_this180.NONUNIFORMSCALING=false;_this180.MORPHTARGETS=false;_this180.MORPHTARGETS_NORMAL=false;_this180.MORPHTARGETS_TANGENT=false;_this180.MORPHTARGETS_UV=false;_this180.NUM_MORPH_INFLUENCERS=0;_this180.MORPHTARGETS_TEXTURE=false;_this180.IMAGEPROCESSING=false;_this180.VIGNETTE=false;_this180.VIGNETTEBLENDMODEMULTIPLY=false;_this180.VIGNETTEBLENDMODEOPAQUE=false;_this180.TONEMAPPING=false;_this180.TONEMAPPING_ACES=false;_this180.CONTRAST=false;_this180.COLORCURVES=false;_this180.COLORGRADING=false;_this180.COLORGRADING3D=false;_this180.SAMPLER3DGREENDEPTH=false;_this180.SAMPLER3DBGRMAP=false;_this180.DITHER=false;_this180.IMAGEPROCESSINGPOSTPROCESS=false;_this180.SKIPFINALCOLORCLAMP=false;_this180.EXPOSURE=false;_this180.MULTIVIEW=false;_this180.ORDER_INDEPENDENT_TRANSPARENCY=false;_this180.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=false;_this180.USEPHYSICALLIGHTFALLOFF=false;_this180.USEGLTFLIGHTFALLOFF=false;_this180.TWOSIDEDLIGHTING=false;_this180.SHADOWFLOAT=false;_this180.CLIPPLANE=false;_this180.CLIPPLANE2=false;_this180.CLIPPLANE3=false;_this180.CLIPPLANE4=false;_this180.CLIPPLANE5=false;_this180.CLIPPLANE6=false;_this180.POINTSIZE=false;_this180.FOG=false;_this180.LOGARITHMICDEPTH=false;_this180.CAMERA_ORTHOGRAPHIC=false;_this180.CAMERA_PERSPECTIVE=false;_this180.FORCENORMALFORWARD=false;_this180.SPECULARAA=false;_this180.UNLIT=false;_this180.DEBUGMODE=0;_this180.rebuild();return _this180;}_createClass(PBRMaterialDefines,[{key:"reset",value:function reset(){_get(_getPrototypeOf(PBRMaterialDefines.prototype),"reset",this).call(this);this.ALPHATESTVALUE="0.5";this.PBR=true;this.NORMALXYSCALE=true;}}]);return PBRMaterialDefines;}(MaterialDefines);var PBRBaseMaterial=/*#__PURE__*/function(_PushMaterial3){_inherits(PBRBaseMaterial,_PushMaterial3);var _super67=_createSuper(PBRBaseMaterial);function PBRBaseMaterial(name135,scene2){var _this181;_classCallCheck(this,PBRBaseMaterial);_this181=_super67.call(this,name135,scene2);_this181._directIntensity=1;_this181._emissiveIntensity=1;_this181._environmentIntensity=1;_this181._specularIntensity=1;_this181._lightingInfos=new Vector4(_this181._directIntensity,_this181._emissiveIntensity,_this181._environmentIntensity,_this181._specularIntensity);_this181._disableBumpMap=false;_this181._albedoTexture=null;_this181._ambientTexture=null;_this181._ambientTextureStrength=1;_this181._ambientTextureImpactOnAnalyticalLights=PBRBaseMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS;_this181._opacityTexture=null;_this181._reflectionTexture=null;_this181._emissiveTexture=null;_this181._reflectivityTexture=null;_this181._metallicTexture=null;_this181._metallic=null;_this181._roughness=null;_this181._metallicF0Factor=1;_this181._metallicReflectanceColor=Color3.White();_this181._useOnlyMetallicFromMetallicReflectanceTexture=false;_this181._metallicReflectanceTexture=null;_this181._reflectanceTexture=null;_this181._microSurfaceTexture=null;_this181._bumpTexture=null;_this181._lightmapTexture=null;_this181._ambientColor=new Color3(0,0,0);_this181._albedoColor=new Color3(1,1,1);_this181._reflectivityColor=new Color3(1,1,1);_this181._reflectionColor=new Color3(1,1,1);_this181._emissiveColor=new Color3(0,0,0);_this181._microSurface=0.9;_this181._useLightmapAsShadowmap=false;_this181._useHorizonOcclusion=true;_this181._useRadianceOcclusion=true;_this181._useAlphaFromAlbedoTexture=false;_this181._useSpecularOverAlpha=true;_this181._useMicroSurfaceFromReflectivityMapAlpha=false;_this181._useRoughnessFromMetallicTextureAlpha=true;_this181._useRoughnessFromMetallicTextureGreen=false;_this181._useMetallnessFromMetallicTextureBlue=false;_this181._useAmbientOcclusionFromMetallicTextureRed=false;_this181._useAmbientInGrayScale=false;_this181._useAutoMicroSurfaceFromReflectivityMap=false;_this181._lightFalloff=PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL;_this181._useRadianceOverAlpha=true;_this181._useObjectSpaceNormalMap=false;_this181._useParallax=false;_this181._useParallaxOcclusion=false;_this181._parallaxScaleBias=0.05;_this181._disableLighting=false;_this181._maxSimultaneousLights=4;_this181._invertNormalMapX=false;_this181._invertNormalMapY=false;_this181._twoSidedLighting=false;_this181._alphaCutOff=0.4;_this181._forceAlphaTest=false;_this181._useAlphaFresnel=false;_this181._useLinearAlphaFresnel=false;_this181._environmentBRDFTexture=null;_this181._forceIrradianceInFragment=false;_this181._realTimeFiltering=false;_this181._realTimeFilteringQuality=8;_this181._forceNormalForward=false;_this181._enableSpecularAntiAliasing=false;_this181._imageProcessingObserver=null;_this181._renderTargets=new SmartArray(16);_this181._globalAmbientColor=new Color3(0,0,0);_this181._useLogarithmicDepth=false;_this181._unlit=false;_this181._debugMode=0;_this181.debugMode=0;_this181._debugLimit=-1;_this181._debugFactor=1;_this181._cacheHasRenderTargetTextures=false;_this181.brdf=new PBRBRDFConfiguration(_assertThisInitialized(_this181));_this181.clearCoat=new PBRClearCoatConfiguration(_assertThisInitialized(_this181));_this181.iridescence=new PBRIridescenceConfiguration(_assertThisInitialized(_this181));_this181.anisotropy=new PBRAnisotropicConfiguration(_assertThisInitialized(_this181));_this181.sheen=new PBRSheenConfiguration(_assertThisInitialized(_this181));_this181.subSurface=new PBRSubSurfaceConfiguration(_assertThisInitialized(_this181));_this181.detailMap=new DetailMapConfiguration(_assertThisInitialized(_this181));_this181._attachImageProcessingConfiguration(null);_this181.getRenderTargetTextures=function(){_this181._renderTargets.reset();if(MaterialFlags.ReflectionTextureEnabled&&_this181._reflectionTexture&&_this181._reflectionTexture.isRenderTarget){_this181._renderTargets.push(_this181._reflectionTexture);}_this181._eventInfo.renderTargets=_this181._renderTargets;_this181._callbackPluginEventFillRenderTargetTextures(_this181._eventInfo);return _this181._renderTargets;};_this181._environmentBRDFTexture=GetEnvironmentBRDFTexture(_this181.getScene());_this181.prePassConfiguration=new PrePassConfiguration();return _this181;}_createClass(PBRBaseMaterial,[{key:"realTimeFiltering",get:function get(){return this._realTimeFiltering;},set:function set(b){this._realTimeFiltering=b;this.markAsDirty(1);}},{key:"realTimeFilteringQuality",get:function get(){return this._realTimeFilteringQuality;},set:function set(n){this._realTimeFilteringQuality=n;this.markAsDirty(1);}},{key:"canRenderToMRT",get:function get(){return true;}},{key:"_attachImageProcessingConfiguration",value:function _attachImageProcessingConfiguration(configuration){var _this182=this;if(configuration===this._imageProcessingConfiguration){return;}if(this._imageProcessingConfiguration&&this._imageProcessingObserver){this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);}if(!configuration){this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration;}else{this._imageProcessingConfiguration=configuration;}if(this._imageProcessingConfiguration){this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){_this182._markAllSubMeshesAsImageProcessingDirty();});}}},{key:"hasRenderTargetTextures",get:function get(){if(MaterialFlags.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget){return true;}return this._cacheHasRenderTargetTextures;}},{key:"isPrePassCapable",get:function get(){return!this.disableDepthWrite;}},{key:"getClassName",value:function getClassName(){return"PBRBaseMaterial";}},{key:"useLogarithmicDepth",get:function get(){return this._useLogarithmicDepth;},set:function set(value){this._useLogarithmicDepth=value&&this.getScene().getEngine().getCaps().fragmentDepthSupported;}},{key:"_disableAlphaBlending",get:function get(){var _a;return this._transparencyMode===PBRBaseMaterial.PBRMATERIAL_OPAQUE||this._transparencyMode===PBRBaseMaterial.PBRMATERIAL_ALPHATEST||((_a=this.subSurface)===null||_a===void 0?void 0:_a.disableAlphaBlending);}},{key:"needAlphaBlending",value:function needAlphaBlending(){if(this._disableAlphaBlending){return false;}return this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromAlbedoTexture();}},{key:"needAlphaTesting",value:function needAlphaTesting(){var _a;if(this._forceAlphaTest){return true;}if((_a=this.subSurface)===null||_a===void 0?void 0:_a.disableAlphaBlending){return false;}return this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===PBRBaseMaterial.PBRMATERIAL_ALPHATEST);}},{key:"_shouldUseAlphaFromAlbedoTexture",value:function _shouldUseAlphaFromAlbedoTexture(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==PBRBaseMaterial.PBRMATERIAL_OPAQUE;}},{key:"_hasAlphaChannel",value:function _hasAlphaChannel(){return this._albedoTexture!=null&&this._albedoTexture.hasAlpha||this._opacityTexture!=null;}},{key:"getAlphaTestTexture",value:function getAlphaTestTexture(){return this._albedoTexture;}},{key:"isReadyForSubMesh",value:function isReadyForSubMesh(mesh,subMesh,useInstances){if(!this._uniformBufferLayoutBuilt){this.buildUniformLayout();}if(subMesh.effect&&this.isFrozen){if(subMesh.effect._wasPreviouslyReady&&subMesh.effect._wasPreviouslyUsingInstances===useInstances){return true;}}if(!subMesh.materialDefines){this._callbackPluginEventGeneric(MaterialPluginEvent.GetDefineNames,this._eventInfo);subMesh.materialDefines=new PBRMaterialDefines(this._eventInfo.defineNames);}var defines=subMesh.materialDefines;if(this._isReadyForSubMesh(subMesh)){return true;}var scene2=this.getScene();var engine=scene2.getEngine();if(defines._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=false;this._callbackPluginEventHasRenderTargetTextures(this._eventInfo);this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures;if(scene2.texturesEnabled){if(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled){if(!this._albedoTexture.isReadyOrNotBlocking()){return false;}}if(this._ambientTexture&&MaterialFlags.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking()){return false;}}if(this._opacityTexture&&MaterialFlags.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking()){return false;}}var reflectionTexture=this._getReflectionTexture();if(reflectionTexture&&MaterialFlags.ReflectionTextureEnabled){if(!reflectionTexture.isReadyOrNotBlocking()){return false;}if(reflectionTexture.irradianceTexture&&!reflectionTexture.irradianceTexture.isReadyOrNotBlocking()){return false;}}if(this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking()){return false;}}if(this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking()){return false;}}if(MaterialFlags.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking()){return false;}}else if(this._reflectivityTexture){if(!this._reflectivityTexture.isReadyOrNotBlocking()){return false;}}if(this._metallicReflectanceTexture){if(!this._metallicReflectanceTexture.isReadyOrNotBlocking()){return false;}}if(this._reflectanceTexture){if(!this._reflectanceTexture.isReadyOrNotBlocking()){return false;}}if(this._microSurfaceTexture){if(!this._microSurfaceTexture.isReadyOrNotBlocking()){return false;}}}if(engine.getCaps().standardDerivatives&&this._bumpTexture&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap){if(!this._bumpTexture.isReady()){return false;}}if(this._environmentBRDFTexture&&MaterialFlags.ReflectionTextureEnabled){if(!this._environmentBRDFTexture.isReady()){return false;}}}}this._eventInfo.isReadyForSubMesh=true;this._eventInfo.defines=defines;this._callbackPluginEventIsReadyForSubMesh(this._eventInfo);if(!this._eventInfo.isReadyForSubMesh){return false;}if(defines._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady()){return false;}}if(!engine.getCaps().standardDerivatives&&!mesh.isVerticesDataPresent(VertexBuffer.NormalKind)){mesh.createNormals(true);Logger.Warn("PBRMaterial: Normals have been created for the mesh: "+mesh.name);}var previousEffect=subMesh.effect;var lightDisposed=defines._areLightsDisposed;var effect=this._prepareEffect(mesh,defines,this.onCompiled,this.onError,useInstances,null,subMesh.getRenderingMesh().hasThinInstances);var forceWasNotReadyPreviously=false;if(effect){if(this._onEffectCreatedObservable){onCreatedEffectParameters3.effect=effect;onCreatedEffectParameters3.subMesh=subMesh;this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters3);}if(this.allowShaderHotSwapping&&previousEffect&&!effect.isReady()){effect=previousEffect;defines.markAsUnprocessed();forceWasNotReadyPreviously=this.isFrozen;if(lightDisposed){defines._areLightsDisposed=true;return false;}}else{scene2.resetCachedMaterial();subMesh.setEffect(effect,defines,this._materialContext);}}if(!subMesh.effect||!subMesh.effect.isReady()){return false;}defines._renderId=scene2.getRenderId();subMesh.effect._wasPreviouslyReady=forceWasNotReadyPreviously?false:true;subMesh.effect._wasPreviouslyUsingInstances=!!useInstances;if(scene2.performancePriority!==ScenePerformancePriority.BackwardCompatible){this.checkReadyOnlyOnce=true;}return true;}},{key:"isMetallicWorkflow",value:function isMetallicWorkflow(){if(this._metallic!=null||this._roughness!=null||this._metallicTexture){return true;}return false;}},{key:"_prepareEffect",value:function _prepareEffect(mesh,defines){var onCompiled=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var onError=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var useInstances=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var useClipPlane=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var useThinInstances=arguments.length>6?arguments[6]:undefined;this._prepareDefines(mesh,defines,useInstances,useClipPlane,useThinInstances);if(!defines.isDirty){return null;}defines.markAsProcessed();var scene2=this.getScene();var engine=scene2.getEngine();var fallbacks=new EffectFallbacks();var fallbackRank=0;if(defines.USESPHERICALINVERTEX){fallbacks.addFallback(fallbackRank++,"USESPHERICALINVERTEX");}if(defines.FOG){fallbacks.addFallback(fallbackRank,"FOG");}if(defines.SPECULARAA){fallbacks.addFallback(fallbackRank,"SPECULARAA");}if(defines.POINTSIZE){fallbacks.addFallback(fallbackRank,"POINTSIZE");}if(defines.LOGARITHMICDEPTH){fallbacks.addFallback(fallbackRank,"LOGARITHMICDEPTH");}if(defines.PARALLAX){fallbacks.addFallback(fallbackRank,"PARALLAX");}if(defines.PARALLAXOCCLUSION){fallbacks.addFallback(fallbackRank++,"PARALLAXOCCLUSION");}if(defines.ENVIRONMENTBRDF){fallbacks.addFallback(fallbackRank++,"ENVIRONMENTBRDF");}if(defines.TANGENT){fallbacks.addFallback(fallbackRank++,"TANGENT");}if(defines.BUMP){fallbacks.addFallback(fallbackRank++,"BUMP");}fallbackRank=MaterialHelper.HandleFallbacksForShadows(defines,fallbacks,this._maxSimultaneousLights,fallbackRank++);if(defines.SPECULARTERM){fallbacks.addFallback(fallbackRank++,"SPECULARTERM");}if(defines.USESPHERICALFROMREFLECTIONMAP){fallbacks.addFallback(fallbackRank++,"USESPHERICALFROMREFLECTIONMAP");}if(defines.USEIRRADIANCEMAP){fallbacks.addFallback(fallbackRank++,"USEIRRADIANCEMAP");}if(defines.LIGHTMAP){fallbacks.addFallback(fallbackRank++,"LIGHTMAP");}if(defines.NORMAL){fallbacks.addFallback(fallbackRank++,"NORMAL");}if(defines.AMBIENT){fallbacks.addFallback(fallbackRank++,"AMBIENT");}if(defines.EMISSIVE){fallbacks.addFallback(fallbackRank++,"EMISSIVE");}if(defines.VERTEXCOLOR){fallbacks.addFallback(fallbackRank++,"VERTEXCOLOR");}if(defines.MORPHTARGETS){fallbacks.addFallback(fallbackRank++,"MORPHTARGETS");}if(defines.MULTIVIEW){fallbacks.addFallback(0,"MULTIVIEW");}var attribs=[VertexBuffer.PositionKind];if(defines.NORMAL){attribs.push(VertexBuffer.NormalKind);}if(defines.TANGENT){attribs.push(VertexBuffer.TangentKind);}for(var i=1;i<=6;++i){if(defines["UV"+i]){attribs.push("uv".concat(i===1?"":i));}}if(defines.VERTEXCOLOR){attribs.push(VertexBuffer.ColorKind);}if(defines.INSTANCESCOLOR){attribs.push(VertexBuffer.ColorInstanceKind);}MaterialHelper.PrepareAttributesForBones(attribs,mesh,defines,fallbacks);MaterialHelper.PrepareAttributesForInstances(attribs,defines);MaterialHelper.PrepareAttributesForMorphTargets(attribs,mesh,defines);MaterialHelper.PrepareAttributesForBakedVertexAnimation(attribs,mesh,defines);var shaderName="pbr";var uniforms=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"];var samplers=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"];var uniformBuffers=["Material","Scene","Mesh"];this._eventInfo.fallbacks=fallbacks;this._eventInfo.fallbackRank=fallbackRank;this._eventInfo.defines=defines;this._eventInfo.uniforms=uniforms;this._eventInfo.attributes=attribs;this._eventInfo.samplers=samplers;this._eventInfo.uniformBuffersNames=uniformBuffers;this._eventInfo.customCode=void 0;this._eventInfo.mesh=mesh;this._callbackPluginEventGeneric(MaterialPluginEvent.PrepareEffect,this._eventInfo);PrePassConfiguration.AddUniforms(uniforms);PrePassConfiguration.AddSamplers(samplers);addClipPlaneUniforms(uniforms);if(ImageProcessingConfiguration){ImageProcessingConfiguration.PrepareUniforms(uniforms,defines);ImageProcessingConfiguration.PrepareSamplers(samplers,defines);}MaterialHelper.PrepareUniformsAndSamplersList({uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:defines,maxSimultaneousLights:this._maxSimultaneousLights});var csnrOptions={};if(this.customShaderNameResolve){shaderName=this.customShaderNameResolve(shaderName,uniforms,uniformBuffers,samplers,defines,attribs,csnrOptions);}var join=defines.toString();var effect=engine.createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:onCompiled,onError:onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:defines.NUM_MORPH_INFLUENCERS},processFinalCode:csnrOptions.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:defines.PREPASS},engine);this._eventInfo.customCode=void 0;return effect;}},{key:"_prepareDefines",value:function _prepareDefines(mesh,defines){var useInstances=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var useClipPlane=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var useThinInstances=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var _a;var scene2=this.getScene();var engine=scene2.getEngine();MaterialHelper.PrepareDefinesForLights(scene2,mesh,defines,true,this._maxSimultaneousLights,this._disableLighting);defines._needNormals=true;MaterialHelper.PrepareDefinesForMultiview(scene2,defines);var oit=this.needAlphaBlendingForMesh(mesh)&&this.getScene().useOrderIndependentTransparency;MaterialHelper.PrepareDefinesForPrePass(scene2,defines,this.canRenderToMRT&&!oit);MaterialHelper.PrepareDefinesForOIT(scene2,defines,oit);defines.METALLICWORKFLOW=this.isMetallicWorkflow();if(defines._areTexturesDirty){defines._needUVs=false;if(scene2.texturesEnabled){defines.ALBEDODIRECTUV=0;defines.AMBIENTDIRECTUV=0;defines.OPACITYDIRECTUV=0;defines.EMISSIVEDIRECTUV=0;defines.REFLECTIVITYDIRECTUV=0;defines.MICROSURFACEMAPDIRECTUV=0;defines.METALLIC_REFLECTANCEDIRECTUV=0;defines.REFLECTANCEDIRECTUV=0;defines.BUMPDIRECTUV=0;defines.LIGHTMAPDIRECTUV=0;if(engine.getCaps().textureLOD){defines.LODBASEDMICROSFURACE=true;}if(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._albedoTexture,defines,"ALBEDO");defines.GAMMAALBEDO=this._albedoTexture.gammaSpace;}else{defines.ALBEDO=false;}if(this._ambientTexture&&MaterialFlags.AmbientTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._ambientTexture,defines,"AMBIENT");defines.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale;}else{defines.AMBIENT=false;}if(this._opacityTexture&&MaterialFlags.OpacityTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._opacityTexture,defines,"OPACITY");defines.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;}else{defines.OPACITY=false;}var reflectionTexture=this._getReflectionTexture();if(reflectionTexture&&MaterialFlags.ReflectionTextureEnabled){defines.REFLECTION=true;defines.GAMMAREFLECTION=reflectionTexture.gammaSpace;defines.RGBDREFLECTION=reflectionTexture.isRGBD;defines.LODINREFLECTIONALPHA=reflectionTexture.lodLevelInAlpha;defines.LINEARSPECULARREFLECTION=reflectionTexture.linearSpecularLOD;if(this.realTimeFiltering&&this.realTimeFilteringQuality>0){defines.NUM_SAMPLES=""+this.realTimeFilteringQuality;if(engine._features.needTypeSuffixInShaderConstants){defines.NUM_SAMPLES=defines.NUM_SAMPLES+"u";}defines.REALTIME_FILTERING=true;}else{defines.REALTIME_FILTERING=false;}defines.INVERTCUBICMAP=reflectionTexture.coordinatesMode===Texture.INVCUBIC_MODE;defines.REFLECTIONMAP_3D=reflectionTexture.isCube;defines.REFLECTIONMAP_OPPOSITEZ=defines.REFLECTIONMAP_3D&&this.getScene().useRightHandedSystem?!reflectionTexture.invertZ:reflectionTexture.invertZ;defines.REFLECTIONMAP_CUBIC=false;defines.REFLECTIONMAP_EXPLICIT=false;defines.REFLECTIONMAP_PLANAR=false;defines.REFLECTIONMAP_PROJECTION=false;defines.REFLECTIONMAP_SKYBOX=false;defines.REFLECTIONMAP_SPHERICAL=false;defines.REFLECTIONMAP_EQUIRECTANGULAR=false;defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=false;defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=false;switch(reflectionTexture.coordinatesMode){case Texture.EXPLICIT_MODE:defines.REFLECTIONMAP_EXPLICIT=true;break;case Texture.PLANAR_MODE:defines.REFLECTIONMAP_PLANAR=true;break;case Texture.PROJECTION_MODE:defines.REFLECTIONMAP_PROJECTION=true;break;case Texture.SKYBOX_MODE:defines.REFLECTIONMAP_SKYBOX=true;break;case Texture.SPHERICAL_MODE:defines.REFLECTIONMAP_SPHERICAL=true;break;case Texture.EQUIRECTANGULAR_MODE:defines.REFLECTIONMAP_EQUIRECTANGULAR=true;break;case Texture.FIXED_EQUIRECTANGULAR_MODE:defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=true;break;case Texture.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=true;break;case Texture.CUBIC_MODE:case Texture.INVCUBIC_MODE:default:defines.REFLECTIONMAP_CUBIC=true;defines.USE_LOCAL_REFLECTIONMAP_CUBIC=reflectionTexture.boundingBoxSize?true:false;break;}if(reflectionTexture.coordinatesMode!==Texture.SKYBOX_MODE){if(reflectionTexture.irradianceTexture){defines.USEIRRADIANCEMAP=true;defines.USESPHERICALFROMREFLECTIONMAP=false;}else if(reflectionTexture.isCube){defines.USESPHERICALFROMREFLECTIONMAP=true;defines.USEIRRADIANCEMAP=false;if(this._forceIrradianceInFragment||this.realTimeFiltering||engine.getCaps().maxVaryingVectors<=8){defines.USESPHERICALINVERTEX=false;}else{defines.USESPHERICALINVERTEX=true;}}}}else{defines.REFLECTION=false;defines.REFLECTIONMAP_3D=false;defines.REFLECTIONMAP_SPHERICAL=false;defines.REFLECTIONMAP_PLANAR=false;defines.REFLECTIONMAP_CUBIC=false;defines.USE_LOCAL_REFLECTIONMAP_CUBIC=false;defines.REFLECTIONMAP_PROJECTION=false;defines.REFLECTIONMAP_SKYBOX=false;defines.REFLECTIONMAP_EXPLICIT=false;defines.REFLECTIONMAP_EQUIRECTANGULAR=false;defines.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=false;defines.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=false;defines.INVERTCUBICMAP=false;defines.USESPHERICALFROMREFLECTIONMAP=false;defines.USEIRRADIANCEMAP=false;defines.USESPHERICALINVERTEX=false;defines.REFLECTIONMAP_OPPOSITEZ=false;defines.LODINREFLECTIONALPHA=false;defines.GAMMAREFLECTION=false;defines.RGBDREFLECTION=false;defines.LINEARSPECULARREFLECTION=false;}if(this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._lightmapTexture,defines,"LIGHTMAP");defines.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap;defines.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace;defines.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;}else{defines.LIGHTMAP=false;}if(this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled){MaterialHelper.PrepareDefinesForMergedUV(this._emissiveTexture,defines,"EMISSIVE");defines.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace;}else{defines.EMISSIVE=false;}if(MaterialFlags.SpecularTextureEnabled){if(this._metallicTexture){MaterialHelper.PrepareDefinesForMergedUV(this._metallicTexture,defines,"REFLECTIVITY");defines.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha;defines.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen;defines.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue;defines.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed;defines.REFLECTIVITY_GAMMA=false;}else if(this._reflectivityTexture){MaterialHelper.PrepareDefinesForMergedUV(this._reflectivityTexture,defines,"REFLECTIVITY");defines.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha;defines.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap;defines.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace;}else{defines.REFLECTIVITY=false;}if(this._metallicReflectanceTexture||this._reflectanceTexture){var identicalTextures=this._metallicReflectanceTexture!==null&&this._metallicReflectanceTexture._texture===((_a=this._reflectanceTexture)===null||_a===void 0?void 0:_a._texture)&&this._metallicReflectanceTexture.checkTransformsAreIdentical(this._reflectanceTexture);defines.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture&&!identicalTextures;if(this._metallicReflectanceTexture){MaterialHelper.PrepareDefinesForMergedUV(this._metallicReflectanceTexture,defines,"METALLIC_REFLECTANCE");defines.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace;}else{defines.METALLIC_REFLECTANCE=false;}if(this._reflectanceTexture&&!identicalTextures&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)){MaterialHelper.PrepareDefinesForMergedUV(this._reflectanceTexture,defines,"REFLECTANCE");defines.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace;}else{defines.REFLECTANCE=false;}}else{defines.METALLIC_REFLECTANCE=false;defines.REFLECTANCE=false;}if(this._microSurfaceTexture){MaterialHelper.PrepareDefinesForMergedUV(this._microSurfaceTexture,defines,"MICROSURFACEMAP");}else{defines.MICROSURFACEMAP=false;}}else{defines.REFLECTIVITY=false;defines.MICROSURFACEMAP=false;}if(engine.getCaps().standardDerivatives&&this._bumpTexture&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap){MaterialHelper.PrepareDefinesForMergedUV(this._bumpTexture,defines,"BUMP");if(this._useParallax&&this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled){defines.PARALLAX=true;defines.PARALLAXOCCLUSION=!!this._useParallaxOcclusion;}else{defines.PARALLAX=false;}defines.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap;}else{defines.BUMP=false;defines.PARALLAX=false;defines.PARALLAXOCCLUSION=false;defines.OBJECTSPACE_NORMALMAP=false;}if(this._environmentBRDFTexture&&MaterialFlags.ReflectionTextureEnabled){defines.ENVIRONMENTBRDF=true;defines.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD;}else{defines.ENVIRONMENTBRDF=false;defines.ENVIRONMENTBRDF_RGBD=false;}if(this._shouldUseAlphaFromAlbedoTexture()){defines.ALPHAFROMALBEDO=true;}else{defines.ALPHAFROMALBEDO=false;}}defines.SPECULAROVERALPHA=this._useSpecularOverAlpha;if(this._lightFalloff===PBRBaseMaterial.LIGHTFALLOFF_STANDARD){defines.USEPHYSICALLIGHTFALLOFF=false;defines.USEGLTFLIGHTFALLOFF=false;}else if(this._lightFalloff===PBRBaseMaterial.LIGHTFALLOFF_GLTF){defines.USEPHYSICALLIGHTFALLOFF=false;defines.USEGLTFLIGHTFALLOFF=true;}else{defines.USEPHYSICALLIGHTFALLOFF=true;defines.USEGLTFLIGHTFALLOFF=false;}defines.RADIANCEOVERALPHA=this._useRadianceOverAlpha;if(!this.backFaceCulling&&this._twoSidedLighting){defines.TWOSIDEDLIGHTING=true;}else{defines.TWOSIDEDLIGHTING=false;}defines.SPECULARAA=engine.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing;}if(defines._areTexturesDirty||defines._areMiscDirty){defines.ALPHATESTVALUE="".concat(this._alphaCutOff).concat(this._alphaCutOff%1===0?".":"");defines.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8;defines.ALPHABLEND=this.needAlphaBlendingForMesh(mesh);defines.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel;defines.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel;}if(defines._areImageProcessingDirty&&this._imageProcessingConfiguration){this._imageProcessingConfiguration.prepareDefines(defines);}defines.FORCENORMALFORWARD=this._forceNormalForward;defines.RADIANCEOCCLUSION=this._useRadianceOcclusion;defines.HORIZONOCCLUSION=this._useHorizonOcclusion;if(defines._areMiscDirty){MaterialHelper.PrepareDefinesForMisc(mesh,scene2,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(mesh)||this._forceAlphaTest,defines);defines.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!mesh.isVerticesDataPresent(VertexBuffer.NormalKind);defines.DEBUGMODE=this._debugMode;}MaterialHelper.PrepareDefinesForFrameBoundValues(scene2,engine,this,defines,useInstances?true:false,useClipPlane,useThinInstances);this._eventInfo.defines=defines;this._eventInfo.mesh=mesh;this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo);MaterialHelper.PrepareDefinesForAttributes(mesh,defines,true,true,true,this._transparencyMode!==PBRBaseMaterial.PBRMATERIAL_OPAQUE);this._callbackPluginEventPrepareDefines(this._eventInfo);}},{key:"forceCompilation",value:function forceCompilation(mesh,onCompiled,options){var _this183=this;var localOptions=_objectSpread({clipPlane:false,useInstances:false},options);if(!this._uniformBufferLayoutBuilt){this.buildUniformLayout();}this._callbackPluginEventGeneric(MaterialPluginEvent.GetDefineNames,this._eventInfo);var defines=new PBRMaterialDefines(this._eventInfo.defineNames);var effect=this._prepareEffect(mesh,defines,void 0,void 0,localOptions.useInstances,localOptions.clipPlane,mesh.hasThinInstances);if(this._onEffectCreatedObservable){onCreatedEffectParameters3.effect=effect;onCreatedEffectParameters3.subMesh=null;this._onEffectCreatedObservable.notifyObservers(onCreatedEffectParameters3);}if(effect.isReady()){if(onCompiled){onCompiled(this);}}else{effect.onCompileObservable.add(function(){if(onCompiled){onCompiled(_this183);}});}}},{key:"buildUniformLayout",value:function buildUniformLayout(){var ubo=this._uniformBuffer;ubo.addUniform("vAlbedoInfos",2);ubo.addUniform("vAmbientInfos",4);ubo.addUniform("vOpacityInfos",2);ubo.addUniform("vEmissiveInfos",2);ubo.addUniform("vLightmapInfos",2);ubo.addUniform("vReflectivityInfos",3);ubo.addUniform("vMicroSurfaceSamplerInfos",2);ubo.addUniform("vReflectionInfos",2);ubo.addUniform("vReflectionFilteringInfo",2);ubo.addUniform("vReflectionPosition",3);ubo.addUniform("vReflectionSize",3);ubo.addUniform("vBumpInfos",3);ubo.addUniform("albedoMatrix",16);ubo.addUniform("ambientMatrix",16);ubo.addUniform("opacityMatrix",16);ubo.addUniform("emissiveMatrix",16);ubo.addUniform("lightmapMatrix",16);ubo.addUniform("reflectivityMatrix",16);ubo.addUniform("microSurfaceSamplerMatrix",16);ubo.addUniform("bumpMatrix",16);ubo.addUniform("vTangentSpaceParams",2);ubo.addUniform("reflectionMatrix",16);ubo.addUniform("vReflectionColor",3);ubo.addUniform("vAlbedoColor",4);ubo.addUniform("vLightingIntensity",4);ubo.addUniform("vReflectionMicrosurfaceInfos",3);ubo.addUniform("pointSize",1);ubo.addUniform("vReflectivityColor",4);ubo.addUniform("vEmissiveColor",3);ubo.addUniform("vAmbientColor",3);ubo.addUniform("vDebugMode",2);ubo.addUniform("vMetallicReflectanceFactors",4);ubo.addUniform("vMetallicReflectanceInfos",2);ubo.addUniform("metallicReflectanceMatrix",16);ubo.addUniform("vReflectanceInfos",2);ubo.addUniform("reflectanceMatrix",16);ubo.addUniform("vSphericalL00",3);ubo.addUniform("vSphericalL1_1",3);ubo.addUniform("vSphericalL10",3);ubo.addUniform("vSphericalL11",3);ubo.addUniform("vSphericalL2_2",3);ubo.addUniform("vSphericalL2_1",3);ubo.addUniform("vSphericalL20",3);ubo.addUniform("vSphericalL21",3);ubo.addUniform("vSphericalL22",3);ubo.addUniform("vSphericalX",3);ubo.addUniform("vSphericalY",3);ubo.addUniform("vSphericalZ",3);ubo.addUniform("vSphericalXX_ZZ",3);ubo.addUniform("vSphericalYY_ZZ",3);ubo.addUniform("vSphericalZZ",3);ubo.addUniform("vSphericalXY",3);ubo.addUniform("vSphericalYZ",3);ubo.addUniform("vSphericalZX",3);_get(_getPrototypeOf(PBRBaseMaterial.prototype),"buildUniformLayout",this).call(this);}},{key:"bindForSubMesh",value:function bindForSubMesh(world,mesh,subMesh){var _a,_b,_c,_d;var scene2=this.getScene();var defines=subMesh.materialDefines;if(!defines){return;}var effect=subMesh.effect;if(!effect){return;}this._activeEffect=effect;mesh.getMeshUniformBuffer().bindToEffect(effect,"Mesh");mesh.transferToEffect(world);var engine=scene2.getEngine();this._uniformBuffer.bindToEffect(effect,"Material");this.prePassConfiguration.bindForSubMesh(this._activeEffect,scene2,mesh,world,this.isFrozen);this._eventInfo.subMesh=subMesh;this._callbackPluginEventHardBindForSubMesh(this._eventInfo);if(defines.OBJECTSPACE_NORMALMAP){world.toNormalMatrix(this._normalMatrix);this.bindOnlyNormalMatrix(this._normalMatrix);}var mustRebind=effect._forceRebindOnNextCall||this._mustRebind(scene2,effect,mesh.visibility);MaterialHelper.BindBonesParameters(mesh,this._activeEffect,this.prePassConfiguration);var reflectionTexture=null;var ubo=this._uniformBuffer;if(mustRebind){this.bindViewProjection(effect);reflectionTexture=this._getReflectionTexture();if(!ubo.useUbo||!this.isFrozen||!ubo.isSync||effect._forceRebindOnNextCall){if(scene2.texturesEnabled){if(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled){ubo.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level);MaterialHelper.BindTextureMatrix(this._albedoTexture,ubo,"albedo");}if(this._ambientTexture&&MaterialFlags.AmbientTextureEnabled){ubo.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights);MaterialHelper.BindTextureMatrix(this._ambientTexture,ubo,"ambient");}if(this._opacityTexture&&MaterialFlags.OpacityTextureEnabled){ubo.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level);MaterialHelper.BindTextureMatrix(this._opacityTexture,ubo,"opacity");}if(reflectionTexture&&MaterialFlags.ReflectionTextureEnabled){ubo.updateMatrix("reflectionMatrix",reflectionTexture.getReflectionTextureMatrix());ubo.updateFloat2("vReflectionInfos",reflectionTexture.level,0);if(reflectionTexture.boundingBoxSize){var cubeTexture=reflectionTexture;ubo.updateVector3("vReflectionPosition",cubeTexture.boundingBoxPosition);ubo.updateVector3("vReflectionSize",cubeTexture.boundingBoxSize);}if(this.realTimeFiltering){var width=reflectionTexture.getSize().width;ubo.updateFloat2("vReflectionFilteringInfo",width,Scalar.Log2(width));}if(!defines.USEIRRADIANCEMAP){var polynomials=reflectionTexture.sphericalPolynomial;if(defines.USESPHERICALFROMREFLECTIONMAP&&polynomials){if(defines.SPHERICAL_HARMONICS){var preScaledHarmonics=polynomials.preScaledHarmonics;ubo.updateVector3("vSphericalL00",preScaledHarmonics.l00);ubo.updateVector3("vSphericalL1_1",preScaledHarmonics.l1_1);ubo.updateVector3("vSphericalL10",preScaledHarmonics.l10);ubo.updateVector3("vSphericalL11",preScaledHarmonics.l11);ubo.updateVector3("vSphericalL2_2",preScaledHarmonics.l2_2);ubo.updateVector3("vSphericalL2_1",preScaledHarmonics.l2_1);ubo.updateVector3("vSphericalL20",preScaledHarmonics.l20);ubo.updateVector3("vSphericalL21",preScaledHarmonics.l21);ubo.updateVector3("vSphericalL22",preScaledHarmonics.l22);}else{ubo.updateFloat3("vSphericalX",polynomials.x.x,polynomials.x.y,polynomials.x.z);ubo.updateFloat3("vSphericalY",polynomials.y.x,polynomials.y.y,polynomials.y.z);ubo.updateFloat3("vSphericalZ",polynomials.z.x,polynomials.z.y,polynomials.z.z);ubo.updateFloat3("vSphericalXX_ZZ",polynomials.xx.x-polynomials.zz.x,polynomials.xx.y-polynomials.zz.y,polynomials.xx.z-polynomials.zz.z);ubo.updateFloat3("vSphericalYY_ZZ",polynomials.yy.x-polynomials.zz.x,polynomials.yy.y-polynomials.zz.y,polynomials.yy.z-polynomials.zz.z);ubo.updateFloat3("vSphericalZZ",polynomials.zz.x,polynomials.zz.y,polynomials.zz.z);ubo.updateFloat3("vSphericalXY",polynomials.xy.x,polynomials.xy.y,polynomials.xy.z);ubo.updateFloat3("vSphericalYZ",polynomials.yz.x,polynomials.yz.y,polynomials.yz.z);ubo.updateFloat3("vSphericalZX",polynomials.zx.x,polynomials.zx.y,polynomials.zx.z);}}}ubo.updateFloat3("vReflectionMicrosurfaceInfos",reflectionTexture.getSize().width,reflectionTexture.lodGenerationScale,reflectionTexture.lodGenerationOffset);}if(this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled){ubo.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level);MaterialHelper.BindTextureMatrix(this._emissiveTexture,ubo,"emissive");}if(this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled){ubo.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level);MaterialHelper.BindTextureMatrix(this._lightmapTexture,ubo,"lightmap");}if(MaterialFlags.SpecularTextureEnabled){if(this._metallicTexture){ubo.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength);MaterialHelper.BindTextureMatrix(this._metallicTexture,ubo,"reflectivity");}else if(this._reflectivityTexture){ubo.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1);MaterialHelper.BindTextureMatrix(this._reflectivityTexture,ubo,"reflectivity");}if(this._metallicReflectanceTexture){ubo.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level);MaterialHelper.BindTextureMatrix(this._metallicReflectanceTexture,ubo,"metallicReflectance");}if(this._reflectanceTexture&&defines.REFLECTANCE){ubo.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level);MaterialHelper.BindTextureMatrix(this._reflectanceTexture,ubo,"reflectance");}if(this._microSurfaceTexture){ubo.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level);MaterialHelper.BindTextureMatrix(this._microSurfaceTexture,ubo,"microSurfaceSampler");}}if(this._bumpTexture&&engine.getCaps().standardDerivatives&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap){ubo.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias);MaterialHelper.BindTextureMatrix(this._bumpTexture,ubo,"bump");if(scene2._mirroredCameraPosition){ubo.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1);}else{ubo.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1);}}}if(this.pointsCloud){ubo.updateFloat("pointSize",this.pointSize);}if(defines.METALLICWORKFLOW){TmpColors.Color3[0].r=this._metallic===void 0||this._metallic===null?1:this._metallic;TmpColors.Color3[0].g=this._roughness===void 0||this._roughness===null?1:this._roughness;ubo.updateColor4("vReflectivityColor",TmpColors.Color3[0],1);var ior=(_b=(_a=this.subSurface)===null||_a===void 0?void 0:_a._indexOfRefraction)!==null&&_b!==void 0?_b:1.5;var outsideIOR=1;var f0=Math.pow((ior-outsideIOR)/(ior+outsideIOR),2);this._metallicReflectanceColor.scaleToRef(f0*this._metallicF0Factor,TmpColors.Color3[0]);var metallicF90=this._metallicF0Factor;ubo.updateColor4("vMetallicReflectanceFactors",TmpColors.Color3[0],metallicF90);}else{ubo.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);}ubo.updateColor3("vEmissiveColor",MaterialFlags.EmissiveTextureEnabled?this._emissiveColor:Color3.BlackReadOnly);ubo.updateColor3("vReflectionColor",this._reflectionColor);if(!defines.SS_REFRACTION&&((_c=this.subSurface)===null||_c===void 0?void 0:_c._linkRefractionWithTransparency)){ubo.updateColor4("vAlbedoColor",this._albedoColor,1);}else{ubo.updateColor4("vAlbedoColor",this._albedoColor,this.alpha);}this._lightingInfos.x=this._directIntensity;this._lightingInfos.y=this._emissiveIntensity;this._lightingInfos.z=this._environmentIntensity*scene2.environmentIntensity;this._lightingInfos.w=this._specularIntensity;ubo.updateVector4("vLightingIntensity",this._lightingInfos);scene2.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor);ubo.updateColor3("vAmbientColor",this._globalAmbientColor);ubo.updateFloat2("vDebugMode",this._debugLimit,this._debugFactor);}if(scene2.texturesEnabled){if(this._albedoTexture&&MaterialFlags.DiffuseTextureEnabled){ubo.setTexture("albedoSampler",this._albedoTexture);}if(this._ambientTexture&&MaterialFlags.AmbientTextureEnabled){ubo.setTexture("ambientSampler",this._ambientTexture);}if(this._opacityTexture&&MaterialFlags.OpacityTextureEnabled){ubo.setTexture("opacitySampler",this._opacityTexture);}if(reflectionTexture&&MaterialFlags.ReflectionTextureEnabled){if(defines.LODBASEDMICROSFURACE){ubo.setTexture("reflectionSampler",reflectionTexture);}else{ubo.setTexture("reflectionSampler",reflectionTexture._lodTextureMid||reflectionTexture);ubo.setTexture("reflectionSamplerLow",reflectionTexture._lodTextureLow||reflectionTexture);ubo.setTexture("reflectionSamplerHigh",reflectionTexture._lodTextureHigh||reflectionTexture);}if(defines.USEIRRADIANCEMAP){ubo.setTexture("irradianceSampler",reflectionTexture.irradianceTexture);}}if(defines.ENVIRONMENTBRDF){ubo.setTexture("environmentBrdfSampler",this._environmentBRDFTexture);}if(this._emissiveTexture&&MaterialFlags.EmissiveTextureEnabled){ubo.setTexture("emissiveSampler",this._emissiveTexture);}if(this._lightmapTexture&&MaterialFlags.LightmapTextureEnabled){ubo.setTexture("lightmapSampler",this._lightmapTexture);}if(MaterialFlags.SpecularTextureEnabled){if(this._metallicTexture){ubo.setTexture("reflectivitySampler",this._metallicTexture);}else if(this._reflectivityTexture){ubo.setTexture("reflectivitySampler",this._reflectivityTexture);}if(this._metallicReflectanceTexture){ubo.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture);}if(this._reflectanceTexture&&defines.REFLECTANCE){ubo.setTexture("reflectanceSampler",this._reflectanceTexture);}if(this._microSurfaceTexture){ubo.setTexture("microSurfaceSampler",this._microSurfaceTexture);}}if(this._bumpTexture&&engine.getCaps().standardDerivatives&&MaterialFlags.BumpTextureEnabled&&!this._disableBumpMap){ubo.setTexture("bumpSampler",this._bumpTexture);}}if(this.getScene().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(mesh)){this.getScene().depthPeelingRenderer.bind(effect);}this._eventInfo.subMesh=subMesh;this._callbackPluginEventBindForSubMesh(this._eventInfo);bindClipPlane(this._activeEffect,this,scene2);this.bindEyePosition(effect);}else if(scene2.getEngine()._features.needToAlwaysBindUniformBuffers){this._needToBindSceneUbo=true;}if(mustRebind||!this.isFrozen){if(scene2.lightsEnabled&&!this._disableLighting){MaterialHelper.BindLights(scene2,mesh,this._activeEffect,defines,this._maxSimultaneousLights);}if(scene2.fogEnabled&&mesh.applyFog&&scene2.fogMode!==Scene.FOGMODE_NONE||reflectionTexture||mesh.receiveShadows||defines.PREPASS){this.bindView(effect);}MaterialHelper.BindFogParameters(scene2,mesh,this._activeEffect,true);if(defines.NUM_MORPH_INFLUENCERS){MaterialHelper.BindMorphTargetParameters(mesh,this._activeEffect);}if(defines.BAKED_VERTEX_ANIMATION_TEXTURE){(_d=mesh.bakedVertexAnimationManager)===null||_d===void 0?void 0:_d.bind(effect,defines.INSTANCES);}this._imageProcessingConfiguration.bind(this._activeEffect);MaterialHelper.BindLogDepth(defines,this._activeEffect,scene2);}this._afterBind(mesh,this._activeEffect);ubo.update();}},{key:"getAnimatables",value:function getAnimatables(){var results=_get(_getPrototypeOf(PBRBaseMaterial.prototype),"getAnimatables",this).call(this);if(this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0){results.push(this._albedoTexture);}if(this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0){results.push(this._ambientTexture);}if(this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0){results.push(this._opacityTexture);}if(this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0){results.push(this._reflectionTexture);}if(this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0){results.push(this._emissiveTexture);}if(this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0){results.push(this._metallicTexture);}else if(this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0){results.push(this._reflectivityTexture);}if(this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0){results.push(this._bumpTexture);}if(this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0){results.push(this._lightmapTexture);}if(this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0){results.push(this._metallicReflectanceTexture);}if(this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0){results.push(this._reflectanceTexture);}if(this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0){results.push(this._microSurfaceTexture);}return results;}},{key:"_getReflectionTexture",value:function _getReflectionTexture(){if(this._reflectionTexture){return this._reflectionTexture;}return this.getScene().environmentTexture;}},{key:"getActiveTextures",value:function getActiveTextures(){var activeTextures=_get(_getPrototypeOf(PBRBaseMaterial.prototype),"getActiveTextures",this).call(this);if(this._albedoTexture){activeTextures.push(this._albedoTexture);}if(this._ambientTexture){activeTextures.push(this._ambientTexture);}if(this._opacityTexture){activeTextures.push(this._opacityTexture);}if(this._reflectionTexture){activeTextures.push(this._reflectionTexture);}if(this._emissiveTexture){activeTextures.push(this._emissiveTexture);}if(this._reflectivityTexture){activeTextures.push(this._reflectivityTexture);}if(this._metallicTexture){activeTextures.push(this._metallicTexture);}if(this._metallicReflectanceTexture){activeTextures.push(this._metallicReflectanceTexture);}if(this._reflectanceTexture){activeTextures.push(this._reflectanceTexture);}if(this._microSurfaceTexture){activeTextures.push(this._microSurfaceTexture);}if(this._bumpTexture){activeTextures.push(this._bumpTexture);}if(this._lightmapTexture){activeTextures.push(this._lightmapTexture);}return activeTextures;}},{key:"hasTexture",value:function hasTexture(texture){if(_get(_getPrototypeOf(PBRBaseMaterial.prototype),"hasTexture",this).call(this,texture)){return true;}if(this._albedoTexture===texture){return true;}if(this._ambientTexture===texture){return true;}if(this._opacityTexture===texture){return true;}if(this._reflectionTexture===texture){return true;}if(this._emissiveTexture===texture){return true;}if(this._reflectivityTexture===texture){return true;}if(this._metallicTexture===texture){return true;}if(this._metallicReflectanceTexture===texture){return true;}if(this._reflectanceTexture===texture){return true;}if(this._microSurfaceTexture===texture){return true;}if(this._bumpTexture===texture){return true;}if(this._lightmapTexture===texture){return true;}return false;}},{key:"setPrePassRenderer",value:function setPrePassRenderer(){var _a;if(!((_a=this.subSurface)===null||_a===void 0?void 0:_a.isScatteringEnabled)){return false;}var subSurfaceConfiguration=this.getScene().enableSubSurfaceForPrePass();if(subSurfaceConfiguration){subSurfaceConfiguration.enabled=true;}return true;}},{key:"dispose",value:function dispose(forceDisposeEffect,forceDisposeTextures){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m;if(forceDisposeTextures){if(this._environmentBRDFTexture&&this.getScene().environmentBRDFTexture!==this._environmentBRDFTexture){this._environmentBRDFTexture.dispose();}(_a=this._albedoTexture)===null||_a===void 0?void 0:_a.dispose();(_b=this._ambientTexture)===null||_b===void 0?void 0:_b.dispose();(_c=this._opacityTexture)===null||_c===void 0?void 0:_c.dispose();(_d=this._reflectionTexture)===null||_d===void 0?void 0:_d.dispose();(_e=this._emissiveTexture)===null||_e===void 0?void 0:_e.dispose();(_f=this._metallicTexture)===null||_f===void 0?void 0:_f.dispose();(_g=this._reflectivityTexture)===null||_g===void 0?void 0:_g.dispose();(_h=this._bumpTexture)===null||_h===void 0?void 0:_h.dispose();(_j=this._lightmapTexture)===null||_j===void 0?void 0:_j.dispose();(_k=this._metallicReflectanceTexture)===null||_k===void 0?void 0:_k.dispose();(_l=this._reflectanceTexture)===null||_l===void 0?void 0:_l.dispose();(_m=this._microSurfaceTexture)===null||_m===void 0?void 0:_m.dispose();}this._renderTargets.dispose();if(this._imageProcessingConfiguration&&this._imageProcessingObserver){this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver);}_get(_getPrototypeOf(PBRBaseMaterial.prototype),"dispose",this).call(this,forceDisposeEffect,forceDisposeTextures);}}]);return PBRBaseMaterial;}(PushMaterial);PBRBaseMaterial.PBRMATERIAL_OPAQUE=Material.MATERIAL_OPAQUE;PBRBaseMaterial.PBRMATERIAL_ALPHATEST=Material.MATERIAL_ALPHATEST;PBRBaseMaterial.PBRMATERIAL_ALPHABLEND=Material.MATERIAL_ALPHABLEND;PBRBaseMaterial.PBRMATERIAL_ALPHATESTANDBLEND=Material.MATERIAL_ALPHATESTANDBLEND;PBRBaseMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0;PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL=0;PBRBaseMaterial.LIGHTFALLOFF_GLTF=1;PBRBaseMaterial.LIGHTFALLOFF_STANDARD=2;__decorate([serializeAsImageProcessingConfiguration()],PBRBaseMaterial.prototype,"_imageProcessingConfiguration",void 0);__decorate([expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRBaseMaterial.prototype,"debugMode",void 0);__decorate([serialize()],PBRBaseMaterial.prototype,"useLogarithmicDepth",null);// node_modules/@babylonjs/core/Materials/PBR/pbrMaterial.js
var PBRMaterial=/*#__PURE__*/function(_PBRBaseMaterial){_inherits(PBRMaterial,_PBRBaseMaterial);var _super68=_createSuper(PBRMaterial);function PBRMaterial(name135,scene2){var _this184;_classCallCheck(this,PBRMaterial);_this184=_super68.call(this,name135,scene2);_this184.directIntensity=1;_this184.emissiveIntensity=1;_this184.environmentIntensity=1;_this184.specularIntensity=1;_this184.disableBumpMap=false;_this184.ambientTextureStrength=1;_this184.ambientTextureImpactOnAnalyticalLights=PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS;_this184.metallicF0Factor=1;_this184.metallicReflectanceColor=Color3.White();_this184.useOnlyMetallicFromMetallicReflectanceTexture=false;_this184.ambientColor=new Color3(0,0,0);_this184.albedoColor=new Color3(1,1,1);_this184.reflectivityColor=new Color3(1,1,1);_this184.reflectionColor=new Color3(1,1,1);_this184.emissiveColor=new Color3(0,0,0);_this184.microSurface=1;_this184.useLightmapAsShadowmap=false;_this184.useAlphaFromAlbedoTexture=false;_this184.forceAlphaTest=false;_this184.alphaCutOff=0.4;_this184.useSpecularOverAlpha=true;_this184.useMicroSurfaceFromReflectivityMapAlpha=false;_this184.useRoughnessFromMetallicTextureAlpha=true;_this184.useRoughnessFromMetallicTextureGreen=false;_this184.useMetallnessFromMetallicTextureBlue=false;_this184.useAmbientOcclusionFromMetallicTextureRed=false;_this184.useAmbientInGrayScale=false;_this184.useAutoMicroSurfaceFromReflectivityMap=false;_this184.useRadianceOverAlpha=true;_this184.useObjectSpaceNormalMap=false;_this184.useParallax=false;_this184.useParallaxOcclusion=false;_this184.parallaxScaleBias=0.05;_this184.disableLighting=false;_this184.forceIrradianceInFragment=false;_this184.maxSimultaneousLights=4;_this184.invertNormalMapX=false;_this184.invertNormalMapY=false;_this184.twoSidedLighting=false;_this184.useAlphaFresnel=false;_this184.useLinearAlphaFresnel=false;_this184.environmentBRDFTexture=null;_this184.forceNormalForward=false;_this184.enableSpecularAntiAliasing=false;_this184.useHorizonOcclusion=true;_this184.useRadianceOcclusion=true;_this184.unlit=false;_this184._environmentBRDFTexture=GetEnvironmentBRDFTexture(_this184.getScene());return _this184;}_createClass(PBRMaterial,[{key:"refractionTexture",get:function get(){return this.subSurface.refractionTexture;},set:function set(value){this.subSurface.refractionTexture=value;if(value){this.subSurface.isRefractionEnabled=true;}else if(!this.subSurface.linkRefractionWithTransparency){this.subSurface.isRefractionEnabled=false;}}},{key:"indexOfRefraction",get:function get(){return this.subSurface.indexOfRefraction;},set:function set(value){this.subSurface.indexOfRefraction=value;}},{key:"invertRefractionY",get:function get(){return this.subSurface.invertRefractionY;},set:function set(value){this.subSurface.invertRefractionY=value;}},{key:"linkRefractionWithTransparency",get:function get(){return this.subSurface.linkRefractionWithTransparency;},set:function set(value){this.subSurface.linkRefractionWithTransparency=value;if(value){this.subSurface.isRefractionEnabled=true;}}},{key:"usePhysicalLightFalloff",get:function get(){return this._lightFalloff===PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL;},set:function set(value){if(value!==this.usePhysicalLightFalloff){this._markAllSubMeshesAsTexturesDirty();if(value){this._lightFalloff=PBRBaseMaterial.LIGHTFALLOFF_PHYSICAL;}else{this._lightFalloff=PBRBaseMaterial.LIGHTFALLOFF_STANDARD;}}}},{key:"useGLTFLightFalloff",get:function get(){return this._lightFalloff===PBRBaseMaterial.LIGHTFALLOFF_GLTF;},set:function set(value){if(value!==this.useGLTFLightFalloff){this._markAllSubMeshesAsTexturesDirty();if(value){this._lightFalloff=PBRBaseMaterial.LIGHTFALLOFF_GLTF;}else{this._lightFalloff=PBRBaseMaterial.LIGHTFALLOFF_STANDARD;}}}},{key:"imageProcessingConfiguration",get:function get(){return this._imageProcessingConfiguration;},set:function set(value){this._attachImageProcessingConfiguration(value);this._markAllSubMeshesAsTexturesDirty();}},{key:"cameraColorCurvesEnabled",get:function get(){return this.imageProcessingConfiguration.colorCurvesEnabled;},set:function set(value){this.imageProcessingConfiguration.colorCurvesEnabled=value;}},{key:"cameraColorGradingEnabled",get:function get(){return this.imageProcessingConfiguration.colorGradingEnabled;},set:function set(value){this.imageProcessingConfiguration.colorGradingEnabled=value;}},{key:"cameraToneMappingEnabled",get:function get(){return this._imageProcessingConfiguration.toneMappingEnabled;},set:function set(value){this._imageProcessingConfiguration.toneMappingEnabled=value;}},{key:"cameraExposure",get:function get(){return this._imageProcessingConfiguration.exposure;},set:function set(value){this._imageProcessingConfiguration.exposure=value;}},{key:"cameraContrast",get:function get(){return this._imageProcessingConfiguration.contrast;},set:function set(value){this._imageProcessingConfiguration.contrast=value;}},{key:"cameraColorGradingTexture",get:function get(){return this._imageProcessingConfiguration.colorGradingTexture;},set:function set(value){this._imageProcessingConfiguration.colorGradingTexture=value;}},{key:"cameraColorCurves",get:function get(){return this._imageProcessingConfiguration.colorCurves;},set:function set(value){this._imageProcessingConfiguration.colorCurves=value;}},{key:"getClassName",value:function getClassName(){return"PBRMaterial";}},{key:"clone",value:function clone(name135){var _this185=this;var clone=SerializationHelper.Clone(function(){return new PBRMaterial(name135,_this185.getScene());},this);clone.id=name135;clone.name=name135;this.stencil.copyTo(clone.stencil);this.clearCoat.copyTo(clone.clearCoat);this.anisotropy.copyTo(clone.anisotropy);this.brdf.copyTo(clone.brdf);this.sheen.copyTo(clone.sheen);this.subSurface.copyTo(clone.subSurface);return clone;}},{key:"serialize",value:function serialize(){var serializationObject=_get(_getPrototypeOf(PBRMaterial.prototype),"serialize",this).call(this);serializationObject.customType="BABYLON.PBRMaterial";serializationObject.clearCoat=this.clearCoat.serialize();serializationObject.anisotropy=this.anisotropy.serialize();serializationObject.brdf=this.brdf.serialize();serializationObject.sheen=this.sheen.serialize();serializationObject.subSurface=this.subSurface.serialize();serializationObject.iridescence=this.iridescence.serialize();return serializationObject;}}],[{key:"Parse",value:function Parse(source,scene2,rootUrl){var material=SerializationHelper.Parse(function(){return new PBRMaterial(source.name,scene2);},source,scene2,rootUrl);if(source.stencil){material.stencil.parse(source.stencil,scene2,rootUrl);}if(source.clearCoat){material.clearCoat.parse(source.clearCoat,scene2,rootUrl);}if(source.anisotropy){material.anisotropy.parse(source.anisotropy,scene2,rootUrl);}if(source.brdf){material.brdf.parse(source.brdf,scene2,rootUrl);}if(source.sheen){material.sheen.parse(source.sheen,scene2,rootUrl);}if(source.subSurface){material.subSurface.parse(source.subSurface,scene2,rootUrl);}if(source.iridescence){material.iridescence.parse(source.iridescence,scene2,rootUrl);}return material;}}]);return PBRMaterial;}(PBRBaseMaterial);PBRMaterial.PBRMATERIAL_OPAQUE=PBRBaseMaterial.PBRMATERIAL_OPAQUE;PBRMaterial.PBRMATERIAL_ALPHATEST=PBRBaseMaterial.PBRMATERIAL_ALPHATEST;PBRMaterial.PBRMATERIAL_ALPHABLEND=PBRBaseMaterial.PBRMATERIAL_ALPHABLEND;PBRMaterial.PBRMATERIAL_ALPHATESTANDBLEND=PBRBaseMaterial.PBRMATERIAL_ALPHATESTANDBLEND;PBRMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=PBRBaseMaterial.DEFAULT_AO_ON_ANALYTICAL_LIGHTS;__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"directIntensity",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveIntensity",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"environmentIntensity",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"specularIntensity",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"disableBumpMap",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"albedoTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTextureStrength",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientTextureImpactOnAnalyticalLights",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"opacityTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectionTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectivityTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallic",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"roughness",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicF0Factor",void 0);__decorate([serializeAsColor3(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicReflectanceColor",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"metallicReflectanceTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectanceTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"microSurfaceTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"bumpTexture",void 0);__decorate([serializeAsTexture(),expandToProperty("_markAllSubMeshesAsTexturesDirty",null)],PBRMaterial.prototype,"lightmapTexture",void 0);__decorate([serializeAsColor3("ambient"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"ambientColor",void 0);__decorate([serializeAsColor3("albedo"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"albedoColor",void 0);__decorate([serializeAsColor3("reflectivity"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectivityColor",void 0);__decorate([serializeAsColor3("reflection"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"reflectionColor",void 0);__decorate([serializeAsColor3("emissive"),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"emissiveColor",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"microSurface",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useLightmapAsShadowmap",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"useAlphaFromAlbedoTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"forceAlphaTest",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesAndMiscDirty")],PBRMaterial.prototype,"alphaCutOff",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useSpecularOverAlpha",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRoughnessFromMetallicTextureAlpha",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRoughnessFromMetallicTextureGreen",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useMetallnessFromMetallicTextureBlue",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAmbientInGrayScale",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0);__decorate([serialize()],PBRMaterial.prototype,"usePhysicalLightFalloff",null);__decorate([serialize()],PBRMaterial.prototype,"useGLTFLightFalloff",null);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRadianceOverAlpha",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useObjectSpaceNormalMap",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useParallax",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useParallaxOcclusion",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"parallaxScaleBias",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRMaterial.prototype,"disableLighting",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceIrradianceInFragment",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsLightsDirty")],PBRMaterial.prototype,"maxSimultaneousLights",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertNormalMapX",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"invertNormalMapY",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"twoSidedLighting",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useAlphaFresnel",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useLinearAlphaFresnel",void 0);__decorate([expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"environmentBRDFTexture",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"forceNormalForward",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"enableSpecularAntiAliasing",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useHorizonOcclusion",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsTexturesDirty")],PBRMaterial.prototype,"useRadianceOcclusion",void 0);__decorate([serialize(),expandToProperty("_markAllSubMeshesAsMiscDirty")],PBRMaterial.prototype,"unlit",void 0);RegisterClass("BABYLON.PBRMaterial",PBRMaterial);// node_modules/@babylonjs/core/Morph/morphTarget.js
var MorphTarget=/*#__PURE__*/function(){function MorphTarget(name135){var influence=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;_classCallCheck(this,MorphTarget);this.name=name135;this.animations=new Array();this._positions=null;this._normals=null;this._tangents=null;this._uvs=null;this._uniqueId=0;this.onInfluenceChanged=new Observable();this._onDataLayoutChanged=new Observable();this._animationPropertiesOverride=null;this._scene=scene2||EngineStore.LastCreatedScene;this.influence=influence;if(this._scene){this._uniqueId=this._scene.getUniqueId();}}_createClass(MorphTarget,[{key:"influence",get:function get(){return this._influence;},set:function set(influence){if(this._influence===influence){return;}var previous=this._influence;this._influence=influence;if(this.onInfluenceChanged.hasObservers()){this.onInfluenceChanged.notifyObservers(previous===0||influence===0);}}},{key:"animationPropertiesOverride",get:function get(){if(!this._animationPropertiesOverride&&this._scene){return this._scene.animationPropertiesOverride;}return this._animationPropertiesOverride;},set:function set(value){this._animationPropertiesOverride=value;}},{key:"uniqueId",get:function get(){return this._uniqueId;}},{key:"hasPositions",get:function get(){return!!this._positions;}},{key:"hasNormals",get:function get(){return!!this._normals;}},{key:"hasTangents",get:function get(){return!!this._tangents;}},{key:"hasUVs",get:function get(){return!!this._uvs;}},{key:"setPositions",value:function setPositions(data){var hadPositions=this.hasPositions;this._positions=data;if(hadPositions!==this.hasPositions){this._onDataLayoutChanged.notifyObservers(void 0);}}},{key:"getPositions",value:function getPositions(){return this._positions;}},{key:"setNormals",value:function setNormals(data){var hadNormals=this.hasNormals;this._normals=data;if(hadNormals!==this.hasNormals){this._onDataLayoutChanged.notifyObservers(void 0);}}},{key:"getNormals",value:function getNormals(){return this._normals;}},{key:"setTangents",value:function setTangents(data){var hadTangents=this.hasTangents;this._tangents=data;if(hadTangents!==this.hasTangents){this._onDataLayoutChanged.notifyObservers(void 0);}}},{key:"getTangents",value:function getTangents(){return this._tangents;}},{key:"setUVs",value:function setUVs(data){var hadUVs=this.hasUVs;this._uvs=data;if(hadUVs!==this.hasUVs){this._onDataLayoutChanged.notifyObservers(void 0);}}},{key:"getUVs",value:function getUVs(){return this._uvs;}},{key:"clone",value:function clone(){var _this186=this;var newOne=SerializationHelper.Clone(function(){return new MorphTarget(_this186.name,_this186.influence,_this186._scene);},this);newOne._positions=this._positions;newOne._normals=this._normals;newOne._tangents=this._tangents;newOne._uvs=this._uvs;return newOne;}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.name=this.name;serializationObject.influence=this.influence;serializationObject.positions=Array.prototype.slice.call(this.getPositions());if(this.id!=null){serializationObject.id=this.id;}if(this.hasNormals){serializationObject.normals=Array.prototype.slice.call(this.getNormals());}if(this.hasTangents){serializationObject.tangents=Array.prototype.slice.call(this.getTangents());}if(this.hasUVs){serializationObject.uvs=Array.prototype.slice.call(this.getUVs());}SerializationHelper.AppendSerializedAnimations(this,serializationObject);return serializationObject;}},{key:"getClassName",value:function getClassName(){return"MorphTarget";}}],[{key:"Parse",value:function Parse(serializationObject,scene2){var result=new MorphTarget(serializationObject.name,serializationObject.influence);result.setPositions(serializationObject.positions);if(serializationObject.id!=null){result.id=serializationObject.id;}if(serializationObject.normals){result.setNormals(serializationObject.normals);}if(serializationObject.tangents){result.setTangents(serializationObject.tangents);}if(serializationObject.uvs){result.setUVs(serializationObject.uvs);}if(serializationObject.animations){for(var animationIndex=0;animationIndex<serializationObject.animations.length;animationIndex++){var parsedAnimation=serializationObject.animations[animationIndex];var internalClass=GetClass("BABYLON.Animation");if(internalClass){result.animations.push(internalClass.Parse(parsedAnimation));}}if(serializationObject.autoAnimate&&scene2){scene2.beginAnimation(result,serializationObject.autoAnimateFrom,serializationObject.autoAnimateTo,serializationObject.autoAnimateLoop,serializationObject.autoAnimateSpeed||1);}}return result;}},{key:"FromMesh",value:function FromMesh(mesh,name135,influence){if(!name135){name135=mesh.name;}var result=new MorphTarget(name135,influence,mesh.getScene());result.setPositions(mesh.getVerticesData(VertexBuffer.PositionKind));if(mesh.isVerticesDataPresent(VertexBuffer.NormalKind)){result.setNormals(mesh.getVerticesData(VertexBuffer.NormalKind));}if(mesh.isVerticesDataPresent(VertexBuffer.TangentKind)){result.setTangents(mesh.getVerticesData(VertexBuffer.TangentKind));}if(mesh.isVerticesDataPresent(VertexBuffer.UVKind)){result.setUVs(mesh.getVerticesData(VertexBuffer.UVKind));}return result;}}]);return MorphTarget;}();__decorate([serialize()],MorphTarget.prototype,"id",void 0);// node_modules/@babylonjs/core/Materials/Textures/rawTexture2DArray.js
var RawTexture2DArray=/*#__PURE__*/function(_Texture3){_inherits(RawTexture2DArray,_Texture3);var _super69=_createSuper(RawTexture2DArray);function RawTexture2DArray(data,width,height,depth,format,scene2){var _this187;var generateMipMaps=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;var invertY=arguments.length>7&&arguments[7]!==undefined?arguments[7]:false;var samplingMode=arguments.length>8&&arguments[8]!==undefined?arguments[8]:Texture.TRILINEAR_SAMPLINGMODE;var textureType=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;_classCallCheck(this,RawTexture2DArray);_this187=_super69.call(this,null,scene2,!generateMipMaps,invertY);_this187.format=format;_this187._texture=scene2.getEngine().createRawTexture2DArray(data,width,height,depth,format,generateMipMaps,invertY,samplingMode,null,textureType);_this187._depth=depth;_this187.is2DArray=true;return _this187;}_createClass(RawTexture2DArray,[{key:"depth",get:function get(){return this._depth;}},{key:"update",value:function update(data){if(!this._texture){return;}this._getEngine().updateRawTexture2DArray(this._texture,data,this._texture.format,this._texture.invertY,null,this._texture.type);}}],[{key:"CreateRGBATexture",value:function CreateRGBATexture(data,width,height,depth,scene2){var generateMipMaps=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var invertY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var samplingMode=arguments.length>7&&arguments[7]!==undefined?arguments[7]:3;var type=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;return new RawTexture2DArray(data,width,height,depth,5,scene2,generateMipMaps,invertY,samplingMode,type);}}]);return RawTexture2DArray;}(Texture);// node_modules/@babylonjs/core/Morph/morphTargetManager.js
var MorphTargetManager=/*#__PURE__*/function(){function MorphTargetManager(){var scene2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;_classCallCheck(this,MorphTargetManager);this._targets=new Array();this._targetInfluenceChangedObservers=new Array();this._targetDataLayoutChangedObservers=new Array();this._activeTargets=new SmartArray(16);this._supportsNormals=false;this._supportsTangents=false;this._supportsUVs=false;this._vertexCount=0;this._textureVertexStride=0;this._textureWidth=0;this._textureHeight=1;this._uniqueId=0;this._tempInfluences=new Array();this._canUseTextureForTargets=false;this._blockCounter=0;this._parentContainer=null;this.optimizeInfluencers=true;this.enableNormalMorphing=true;this.enableTangentMorphing=true;this.enableUVMorphing=true;this._useTextureToStoreTargets=true;if(!scene2){scene2=EngineStore.LastCreatedScene;}this._scene=scene2;if(this._scene){this._scene.morphTargetManagers.push(this);this._uniqueId=this._scene.getUniqueId();var engineCaps=this._scene.getEngine().getCaps();this._canUseTextureForTargets=engineCaps.canUseGLVertexID&&engineCaps.textureFloat&&engineCaps.maxVertexTextureImageUnits>0&&engineCaps.texture2DArrayMaxLayerCount>1;}}_createClass(MorphTargetManager,[{key:"areUpdatesFrozen",get:function get(){return this._blockCounter>0;},set:function set(block){if(block){this._blockCounter++;}else{this._blockCounter--;if(this._blockCounter<=0){this._blockCounter=0;this._syncActiveTargets(true);}}}},{key:"uniqueId",get:function get(){return this._uniqueId;}},{key:"vertexCount",get:function get(){return this._vertexCount;}},{key:"supportsNormals",get:function get(){return this._supportsNormals&&this.enableNormalMorphing;}},{key:"supportsTangents",get:function get(){return this._supportsTangents&&this.enableTangentMorphing;}},{key:"supportsUVs",get:function get(){return this._supportsUVs&&this.enableUVMorphing;}},{key:"numTargets",get:function get(){return this._targets.length;}},{key:"numInfluencers",get:function get(){return this._activeTargets.length;}},{key:"influences",get:function get(){return this._influences;}},{key:"useTextureToStoreTargets",get:function get(){return this._useTextureToStoreTargets;},set:function set(value){this._useTextureToStoreTargets=value;}},{key:"isUsingTextureForTargets",get:function get(){return MorphTargetManager.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets;}},{key:"getActiveTarget",value:function getActiveTarget(index){return this._activeTargets.data[index];}},{key:"getTarget",value:function getTarget(index){return this._targets[index];}},{key:"addTarget",value:function addTarget(target){var _this188=this;this._targets.push(target);this._targetInfluenceChangedObservers.push(target.onInfluenceChanged.add(function(needUpdate){_this188._syncActiveTargets(needUpdate);}));this._targetDataLayoutChangedObservers.push(target._onDataLayoutChanged.add(function(){_this188._syncActiveTargets(true);}));this._syncActiveTargets(true);}},{key:"removeTarget",value:function removeTarget(target){var index=this._targets.indexOf(target);if(index>=0){this._targets.splice(index,1);target.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(index,1)[0]);target._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(index,1)[0]);this._syncActiveTargets(true);}}},{key:"_bind",value:function _bind(effect){effect.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight);effect.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices);effect.setTexture("morphTargets",this._targetStoreTexture);}},{key:"clone",value:function clone(){var copy=new MorphTargetManager(this._scene);var _iterator195=_createForOfIteratorHelper(this._targets),_step208;try{for(_iterator195.s();!(_step208=_iterator195.n()).done;){var target=_step208.value;copy.addTarget(target.clone());}}catch(err){_iterator195.e(err);}finally{_iterator195.f();}copy.enableNormalMorphing=this.enableNormalMorphing;copy.enableTangentMorphing=this.enableTangentMorphing;copy.enableUVMorphing=this.enableUVMorphing;return copy;}},{key:"serialize",value:function serialize(){var serializationObject={};serializationObject.id=this.uniqueId;serializationObject.targets=[];var _iterator196=_createForOfIteratorHelper(this._targets),_step209;try{for(_iterator196.s();!(_step209=_iterator196.n()).done;){var target=_step209.value;serializationObject.targets.push(target.serialize());}}catch(err){_iterator196.e(err);}finally{_iterator196.f();}return serializationObject;}},{key:"_syncActiveTargets",value:function _syncActiveTargets(needUpdate){if(this.areUpdatesFrozen){return;}var influenceCount=0;this._activeTargets.reset();this._supportsNormals=true;this._supportsTangents=true;this._supportsUVs=true;this._vertexCount=0;if(this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount){this.useTextureToStoreTargets=false;}if(!this._morphTargetTextureIndices||this._morphTargetTextureIndices.length!==this._targets.length){this._morphTargetTextureIndices=new Float32Array(this._targets.length);}var targetIndex=-1;var _iterator197=_createForOfIteratorHelper(this._targets),_step210;try{for(_iterator197.s();!(_step210=_iterator197.n()).done;){var target=_step210.value;targetIndex++;if(target.influence===0&&this.optimizeInfluencers){continue;}if(this._activeTargets.length>=MorphTargetManager.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets){break;}this._activeTargets.push(target);this._morphTargetTextureIndices[influenceCount]=targetIndex;this._tempInfluences[influenceCount++]=target.influence;this._supportsNormals=this._supportsNormals&&target.hasNormals;this._supportsTangents=this._supportsTangents&&target.hasTangents;this._supportsUVs=this._supportsUVs&&target.hasUVs;var positions=target.getPositions();if(positions){var vertexCount=positions.length/3;if(this._vertexCount===0){this._vertexCount=vertexCount;}else if(this._vertexCount!==vertexCount){Logger.Error("Incompatible target. Targets must all have the same vertices count.");return;}}}}catch(err){_iterator197.e(err);}finally{_iterator197.f();}if(!this._influences||this._influences.length!==influenceCount){this._influences=new Float32Array(influenceCount);}for(var index=0;index<influenceCount;index++){this._influences[index]=this._tempInfluences[index];}if(needUpdate){this.synchronize();}}},{key:"synchronize",value:function synchronize(){if(!this._scene||this.areUpdatesFrozen){return;}if(this.isUsingTextureForTargets&&this._vertexCount){this._textureVertexStride=1;if(this._supportsNormals){this._textureVertexStride++;}if(this._supportsTangents){this._textureVertexStride++;}if(this._supportsUVs){this._textureVertexStride++;}this._textureWidth=this._vertexCount*this._textureVertexStride;this._textureHeight=1;var maxTextureSize=this._scene.getEngine().getCaps().maxTextureSize;if(this._textureWidth>maxTextureSize){this._textureHeight=Math.ceil(this._textureWidth/maxTextureSize);this._textureWidth=maxTextureSize;}var mustUpdateTexture=true;if(this._targetStoreTexture){var textureSize=this._targetStoreTexture.getSize();if(textureSize.width===this._textureWidth&&textureSize.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length){mustUpdateTexture=false;}}if(mustUpdateTexture){if(this._targetStoreTexture){this._targetStoreTexture.dispose();}var targetCount=this._targets.length;var data=new Float32Array(targetCount*this._textureWidth*this._textureHeight*4);var offset=0;for(var index=0;index<targetCount;index++){var target=this._targets[index];var positions=target.getPositions();var normals=target.getNormals();var uvs=target.getUVs();var tangents=target.getTangents();if(!positions){if(index===0){Logger.Error("Invalid morph target. Target must have positions.");}return;}offset=index*this._textureWidth*this._textureHeight*4;for(var vertex=0;vertex<this._vertexCount;vertex++){data[offset]=positions[vertex*3];data[offset+1]=positions[vertex*3+1];data[offset+2]=positions[vertex*3+2];offset+=4;if(normals){data[offset]=normals[vertex*3];data[offset+1]=normals[vertex*3+1];data[offset+2]=normals[vertex*3+2];offset+=4;}if(uvs){data[offset]=uvs[vertex*2];data[offset+1]=uvs[vertex*2+1];offset+=4;}if(tangents){data[offset]=tangents[vertex*3];data[offset+1]=tangents[vertex*3+1];data[offset+2]=tangents[vertex*3+2];offset+=4;}}}this._targetStoreTexture=RawTexture2DArray.CreateRGBATexture(data,this._textureWidth,this._textureHeight,targetCount,this._scene,false,false,1,1);}}var _iterator198=_createForOfIteratorHelper(this._scene.meshes),_step211;try{for(_iterator198.s();!(_step211=_iterator198.n()).done;){var mesh=_step211.value;if(mesh.morphTargetManager===this){mesh._syncGeometryWithMorphTargetManager();}}}catch(err){_iterator198.e(err);}finally{_iterator198.f();}}},{key:"dispose",value:function dispose(){if(this._targetStoreTexture){this._targetStoreTexture.dispose();}this._targetStoreTexture=null;if(this._scene){this._scene.removeMorphTargetManager(this);if(this._parentContainer){var index=this._parentContainer.morphTargetManagers.indexOf(this);if(index>-1){this._parentContainer.morphTargetManagers.splice(index,1);}this._parentContainer=null;}}}}],[{key:"Parse",value:function Parse(serializationObject,scene2){var result=new MorphTargetManager(scene2);result._uniqueId=serializationObject.id;var _iterator199=_createForOfIteratorHelper(serializationObject.targets),_step212;try{for(_iterator199.s();!(_step212=_iterator199.n()).done;){var targetData=_step212.value;result.addTarget(MorphTarget.Parse(targetData,scene2));}}catch(err){_iterator199.e(err);}finally{_iterator199.f();}return result;}}]);return MorphTargetManager;}();MorphTargetManager.EnableTextureStorage=true;MorphTargetManager.MaxActiveMorphTargetsInVertexAttributeMode=8;// node_modules/@babylonjs/loaders/glTF/2.0/glTFLoaderAnimation.js
function getVector3(_target,source,offset,scale){return Vector3.FromArray(source,offset).scaleInPlace(scale);}function getQuaternion(_target,source,offset,scale){return Quaternion.FromArray(source,offset).scaleInPlace(scale);}function getWeights(target,source,offset,scale){var value=new Array(target._numMorphTargets);for(var i=0;i<value.length;i++){value[i]=source[offset++]*scale;}return value;}var AnimationPropertyInfo=/*#__PURE__*/function(){function AnimationPropertyInfo(type,name135,getValue,getStride){_classCallCheck(this,AnimationPropertyInfo);this.type=type;this.name=name135;this.getValue=getValue;this.getStride=getStride;}_createClass(AnimationPropertyInfo,[{key:"_buildAnimation",value:function _buildAnimation(name135,fps,keys){var babylonAnimation=new Animation(name135,this.name,fps,this.type);babylonAnimation.setKeys(keys);return babylonAnimation;}}]);return AnimationPropertyInfo;}();var TransformNodeAnimationPropertyInfo=/*#__PURE__*/function(_AnimationPropertyInf){_inherits(TransformNodeAnimationPropertyInfo,_AnimationPropertyInf);var _super70=_createSuper(TransformNodeAnimationPropertyInfo);function TransformNodeAnimationPropertyInfo(){_classCallCheck(this,TransformNodeAnimationPropertyInfo);return _super70.apply(this,arguments);}_createClass(TransformNodeAnimationPropertyInfo,[{key:"buildAnimations",value:function buildAnimations(target,name135,fps,keys,callback){callback(target._babylonTransformNode,this._buildAnimation(name135,fps,keys));}}]);return TransformNodeAnimationPropertyInfo;}(AnimationPropertyInfo);var WeightAnimationPropertyInfo=/*#__PURE__*/function(_AnimationPropertyInf2){_inherits(WeightAnimationPropertyInfo,_AnimationPropertyInf2);var _super71=_createSuper(WeightAnimationPropertyInfo);function WeightAnimationPropertyInfo(){_classCallCheck(this,WeightAnimationPropertyInfo);return _super71.apply(this,arguments);}_createClass(WeightAnimationPropertyInfo,[{key:"buildAnimations",value:function buildAnimations(target,name135,fps,keys,callback){var _this189=this;if(target._numMorphTargets){var _loop9=function _loop9(targetIndex){var babylonAnimation=new Animation("".concat(name135,"_").concat(targetIndex),_this189.name,fps,_this189.type);babylonAnimation.setKeys(keys.map(function(key){return{frame:key.frame,inTangent:key.inTangent?key.inTangent[targetIndex]:void 0,value:key.value[targetIndex],outTangent:key.outTangent?key.outTangent[targetIndex]:void 0,interpolation:key.interpolation};}));if(target._primitiveBabylonMeshes){var _iterator200=_createForOfIteratorHelper(target._primitiveBabylonMeshes),_step213;try{for(_iterator200.s();!(_step213=_iterator200.n()).done;){var babylonMesh=_step213.value;if(babylonMesh.morphTargetManager){var morphTarget=babylonMesh.morphTargetManager.getTarget(targetIndex);var babylonAnimationClone=babylonAnimation.clone();morphTarget.animations.push(babylonAnimationClone);callback(morphTarget,babylonAnimationClone);}}}catch(err){_iterator200.e(err);}finally{_iterator200.f();}}};for(var targetIndex=0;targetIndex<target._numMorphTargets;targetIndex++){_loop9(targetIndex);}}}}]);return WeightAnimationPropertyInfo;}(AnimationPropertyInfo);var nodeAnimationData={translation:[new TransformNodeAnimationPropertyInfo(Animation.ANIMATIONTYPE_VECTOR3,"position",getVector3,function(){return 3;})],rotation:[new TransformNodeAnimationPropertyInfo(Animation.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",getQuaternion,function(){return 4;})],scale:[new TransformNodeAnimationPropertyInfo(Animation.ANIMATIONTYPE_VECTOR3,"scaling",getVector3,function(){return 3;})],weights:[new WeightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"influence",getWeights,function(target){return target._numMorphTargets;})]};// node_modules/@babylonjs/loaders/glTF/2.0/glTFLoader.js
function mergeDeep(){var isObject=function isObject(obj){return obj&&_typeof(obj)==="object";};for(var _len14=arguments.length,objects=new Array(_len14),_key40=0;_key40<_len14;_key40++){objects[_key40]=arguments[_key40];}return objects.reduce(function(prev,obj){Object.keys(obj).forEach(function(key){var pVal=prev[key];var oVal=obj[key];if(Array.isArray(pVal)&&Array.isArray(oVal)){prev[key]=pVal.concat.apply(pVal,_toConsumableArray(oVal));}else if(isObject(pVal)&&isObject(oVal)){prev[key]=mergeDeep(pVal,oVal);}else{prev[key]=oVal;}});return prev;},{});}var ArrayItem=/*#__PURE__*/function(){function ArrayItem(){_classCallCheck(this,ArrayItem);}_createClass(ArrayItem,null,[{key:"Get",value:function Get(context,array,index){if(!array||index==void 0||!array[index]){throw new Error("".concat(context,": Failed to find index (").concat(index,")"));}return array[index];}},{key:"Assign",value:function Assign(array){if(array){for(var index=0;index<array.length;index++){array[index].index=index;}}}}]);return ArrayItem;}();var GLTFLoader2=/*#__PURE__*/function(){function GLTFLoader2(parent){_classCallCheck(this,GLTFLoader2);this._completePromises=new Array();this._assetContainer=null;this._babylonLights=[];this._disableInstancedMesh=0;this._extensions=new Array();this._disposed=false;this._rootUrl=null;this._fileName=null;this._uniqueRootUrl=null;this._bin=null;this._rootBabylonMesh=null;this._defaultBabylonMaterialData={};this._postSceneLoadActions=new Array();this._parent=parent;}_createClass(GLTFLoader2,[{key:"gltf",get:function get(){if(!this._gltf){throw new Error("glTF JSON is not available");}return this._gltf;}},{key:"bin",get:function get(){return this._bin;}},{key:"parent",get:function get(){return this._parent;}},{key:"babylonScene",get:function get(){if(!this._babylonScene){throw new Error("Scene is not available");}return this._babylonScene;}},{key:"rootBabylonMesh",get:function get(){return this._rootBabylonMesh;}},{key:"dispose",value:function dispose(){if(this._disposed){return;}this._disposed=true;this._completePromises.length=0;this._extensions.forEach(function(extension){return extension.dispose&&extension.dispose();});this._extensions.length=0;this._gltf=null;this._bin=null;this._babylonScene=null;this._rootBabylonMesh=null;this._defaultBabylonMaterialData={};this._postSceneLoadActions.length=0;this._parent.dispose();}},{key:"importMeshAsync",value:function importMeshAsync(meshesNames,scene2,container,data,rootUrl,onProgress){var _this190=this;var fileName=arguments.length>6&&arguments[6]!==undefined?arguments[6]:"";return Promise.resolve().then(function(){_this190._babylonScene=scene2;_this190._assetContainer=container;_this190._loadData(data);var nodes=null;if(meshesNames){var nodeMap={};if(_this190._gltf.nodes){var _iterator201=_createForOfIteratorHelper(_this190._gltf.nodes),_step214;try{for(_iterator201.s();!(_step214=_iterator201.n()).done;){var node=_step214.value;if(node.name){nodeMap[node.name]=node.index;}}}catch(err){_iterator201.e(err);}finally{_iterator201.f();}}var names=meshesNames instanceof Array?meshesNames:[meshesNames];nodes=names.map(function(name135){var node=nodeMap[name135];if(node===void 0){throw new Error("Failed to find node '".concat(name135,"'"));}return node;});}return _this190._loadAsync(rootUrl,fileName,nodes,function(){return{meshes:_this190._getMeshes(),particleSystems:[],skeletons:_this190._getSkeletons(),animationGroups:_this190._getAnimationGroups(),lights:_this190._babylonLights,transformNodes:_this190._getTransformNodes(),geometries:_this190._getGeometries()};});});}},{key:"loadAsync",value:function loadAsync(scene2,data,rootUrl,onProgress){var _this191=this;var fileName=arguments.length>4&&arguments[4]!==undefined?arguments[4]:"";return Promise.resolve().then(function(){_this191._babylonScene=scene2;_this191._loadData(data);return _this191._loadAsync(rootUrl,fileName,null,function(){return void 0;});});}},{key:"_loadAsync",value:function _loadAsync(rootUrl,fileName,nodes,resultFunc){var _this192=this;return Promise.resolve().then(function(){_this192._rootUrl=rootUrl;_this192._uniqueRootUrl=!rootUrl.startsWith("file:")&&fileName?rootUrl:"".concat(rootUrl).concat(Date.now(),"/");_this192._fileName=fileName;_this192._loadExtensions();_this192._checkExtensions();var loadingToReadyCounterName="".concat(GLTFLoaderState[GLTFLoaderState.LOADING]," => ").concat(GLTFLoaderState[GLTFLoaderState.READY]);var loadingToCompleteCounterName="".concat(GLTFLoaderState[GLTFLoaderState.LOADING]," => ").concat(GLTFLoaderState[GLTFLoaderState.COMPLETE]);_this192._parent._startPerformanceCounter(loadingToReadyCounterName);_this192._parent._startPerformanceCounter(loadingToCompleteCounterName);_this192._parent._setState(GLTFLoaderState.LOADING);_this192._extensionsOnLoading();var promises=new Array();var oldBlockMaterialDirtyMechanism=_this192._babylonScene.blockMaterialDirtyMechanism;_this192._babylonScene.blockMaterialDirtyMechanism=true;if(!_this192.parent.loadOnlyMaterials){if(nodes){promises.push(_this192.loadSceneAsync("/nodes",{nodes:nodes,index:-1}));}else if(_this192._gltf.scene!=void 0||_this192._gltf.scenes&&_this192._gltf.scenes[0]){var scene2=ArrayItem.Get("/scene",_this192._gltf.scenes,_this192._gltf.scene||0);promises.push(_this192.loadSceneAsync("/scenes/".concat(scene2.index),scene2));}}if(!_this192.parent.skipMaterials&&_this192.parent.loadAllMaterials&&_this192._gltf.materials){for(var m=0;m<_this192._gltf.materials.length;++m){var material=_this192._gltf.materials[m];var context="/materials/"+m;var babylonDrawMode=Material.TriangleFillMode;promises.push(_this192._loadMaterialAsync(context,material,null,babylonDrawMode,function(){}));}}_this192._babylonScene.blockMaterialDirtyMechanism=oldBlockMaterialDirtyMechanism;if(_this192._parent.compileMaterials){promises.push(_this192._compileMaterialsAsync());}if(_this192._parent.compileShadowGenerators){promises.push(_this192._compileShadowGeneratorsAsync());}var resultPromise=Promise.all(promises).then(function(){if(_this192._rootBabylonMesh){_this192._rootBabylonMesh.setEnabled(true);}_this192._extensionsOnReady();_this192._parent._setState(GLTFLoaderState.READY);_this192._startAnimations();return resultFunc();});return resultPromise.then(function(result){_this192._parent._endPerformanceCounter(loadingToReadyCounterName);Tools.SetImmediate(function(){if(!_this192._disposed){Promise.all(_this192._completePromises).then(function(){_this192._parent._endPerformanceCounter(loadingToCompleteCounterName);_this192._parent._setState(GLTFLoaderState.COMPLETE);_this192._parent.onCompleteObservable.notifyObservers(void 0);_this192._parent.onCompleteObservable.clear();_this192.dispose();},function(error){_this192._parent.onErrorObservable.notifyObservers(error);_this192._parent.onErrorObservable.clear();_this192.dispose();});}});return result;});})["catch"](function(error){if(!_this192._disposed){_this192._parent.onErrorObservable.notifyObservers(error);_this192._parent.onErrorObservable.clear();_this192.dispose();}throw error;});}},{key:"_loadData",value:function _loadData(data){this._gltf=data.json;this._setupData();if(data.bin){var buffers=this._gltf.buffers;if(buffers&&buffers[0]&&!buffers[0].uri){var binaryBuffer=buffers[0];if(binaryBuffer.byteLength<data.bin.byteLength-3||binaryBuffer.byteLength>data.bin.byteLength){Logger.Warn("Binary buffer length (".concat(binaryBuffer.byteLength,") from JSON does not match chunk length (").concat(data.bin.byteLength,")"));}this._bin=data.bin;}else{Logger.Warn("Unexpected BIN chunk");}}}},{key:"_setupData",value:function _setupData(){ArrayItem.Assign(this._gltf.accessors);ArrayItem.Assign(this._gltf.animations);ArrayItem.Assign(this._gltf.buffers);ArrayItem.Assign(this._gltf.bufferViews);ArrayItem.Assign(this._gltf.cameras);ArrayItem.Assign(this._gltf.images);ArrayItem.Assign(this._gltf.materials);ArrayItem.Assign(this._gltf.meshes);ArrayItem.Assign(this._gltf.nodes);ArrayItem.Assign(this._gltf.samplers);ArrayItem.Assign(this._gltf.scenes);ArrayItem.Assign(this._gltf.skins);ArrayItem.Assign(this._gltf.textures);if(this._gltf.nodes){var nodeParents={};var _iterator202=_createForOfIteratorHelper(this._gltf.nodes),_step215;try{for(_iterator202.s();!(_step215=_iterator202.n()).done;){var node=_step215.value;if(node.children){var _iterator204=_createForOfIteratorHelper(node.children),_step217;try{for(_iterator204.s();!(_step217=_iterator204.n()).done;){var index=_step217.value;nodeParents[index]=node.index;}}catch(err){_iterator204.e(err);}finally{_iterator204.f();}}}}catch(err){_iterator202.e(err);}finally{_iterator202.f();}var rootNode=this._createRootNode();var _iterator203=_createForOfIteratorHelper(this._gltf.nodes),_step216;try{for(_iterator203.s();!(_step216=_iterator203.n()).done;){var _node7=_step216.value;var parentIndex=nodeParents[_node7.index];_node7.parent=parentIndex===void 0?rootNode:this._gltf.nodes[parentIndex];}}catch(err){_iterator203.e(err);}finally{_iterator203.f();}}}},{key:"_loadExtensions",value:function _loadExtensions(){for(var name135 in GLTFLoader2._RegisteredExtensions){var extension=GLTFLoader2._RegisteredExtensions[name135].factory(this);if(extension.name!==name135){Logger.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(extension.name," !== ").concat(name135));}this._extensions.push(extension);this._parent.onExtensionLoadedObservable.notifyObservers(extension);}this._extensions.sort(function(a,b){return(a.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE);});this._parent.onExtensionLoadedObservable.clear();}},{key:"_checkExtensions",value:function _checkExtensions(){var _this193=this;if(this._gltf.extensionsRequired){var _iterator205=_createForOfIteratorHelper(this._gltf.extensionsRequired),_step218;try{var _loop10=function _loop10(){var name135=_step218.value;var available=_this193._extensions.some(function(extension){return extension.name===name135&&extension.enabled;});if(!available){throw new Error("Require extension ".concat(name135," is not available"));}};for(_iterator205.s();!(_step218=_iterator205.n()).done;){_loop10();}}catch(err){_iterator205.e(err);}finally{_iterator205.f();}}}},{key:"_createRootNode",value:function _createRootNode(){this._babylonScene._blockEntityCollection=!!this._assetContainer;this._rootBabylonMesh=new Mesh("__root__",this._babylonScene);this._rootBabylonMesh._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;this._rootBabylonMesh.setEnabled(false);var rootNode={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case GLTFLoaderCoordinateSystemMode.AUTO:{if(!this._babylonScene.useRightHandedSystem){rootNode.rotation=[0,1,0,0];rootNode.scale=[1,1,-1];GLTFLoader2._LoadTransform(rootNode,this._rootBabylonMesh);}break;}case GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:{this._babylonScene.useRightHandedSystem=true;break;}default:{throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"));}}this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh);return rootNode;}},{key:"loadSceneAsync",value:function loadSceneAsync(context,scene2){var _this194=this;var extensionPromise=this._extensionsLoadSceneAsync(context,scene2);if(extensionPromise){return extensionPromise;}var promises=new Array();this.logOpen("".concat(context," ").concat(scene2.name||""));if(scene2.nodes){var _iterator206=_createForOfIteratorHelper(scene2.nodes),_step219;try{for(_iterator206.s();!(_step219=_iterator206.n()).done;){var index=_step219.value;var node=ArrayItem.Get("".concat(context,"/nodes/").concat(index),this._gltf.nodes,index);promises.push(this.loadNodeAsync("/nodes/".concat(node.index),node,function(babylonMesh){babylonMesh.parent=_this194._rootBabylonMesh;}));}}catch(err){_iterator206.e(err);}finally{_iterator206.f();}}var _iterator207=_createForOfIteratorHelper(this._postSceneLoadActions),_step220;try{for(_iterator207.s();!(_step220=_iterator207.n()).done;){var action=_step220.value;action();}}catch(err){_iterator207.e(err);}finally{_iterator207.f();}promises.push(this._loadAnimationsAsync());this.logClose();return Promise.all(promises).then(function(){});}},{key:"_forEachPrimitive",value:function _forEachPrimitive(node,callback){if(node._primitiveBabylonMeshes){var _iterator208=_createForOfIteratorHelper(node._primitiveBabylonMeshes),_step221;try{for(_iterator208.s();!(_step221=_iterator208.n()).done;){var babylonMesh=_step221.value;callback(babylonMesh);}}catch(err){_iterator208.e(err);}finally{_iterator208.f();}}}},{key:"_getGeometries",value:function _getGeometries(){var geometries=new Array();var nodes=this._gltf.nodes;if(nodes){var _iterator209=_createForOfIteratorHelper(nodes),_step222;try{for(_iterator209.s();!(_step222=_iterator209.n()).done;){var node=_step222.value;this._forEachPrimitive(node,function(babylonMesh){var geometry=babylonMesh.geometry;if(geometry&&geometries.indexOf(geometry)===-1){geometries.push(geometry);}});}}catch(err){_iterator209.e(err);}finally{_iterator209.f();}}return geometries;}},{key:"_getMeshes",value:function _getMeshes(){var meshes=new Array();if(this._rootBabylonMesh){meshes.push(this._rootBabylonMesh);}var nodes=this._gltf.nodes;if(nodes){var _iterator210=_createForOfIteratorHelper(nodes),_step223;try{for(_iterator210.s();!(_step223=_iterator210.n()).done;){var node=_step223.value;this._forEachPrimitive(node,function(babylonMesh){meshes.push(babylonMesh);});}}catch(err){_iterator210.e(err);}finally{_iterator210.f();}}return meshes;}},{key:"_getTransformNodes",value:function _getTransformNodes(){var transformNodes=new Array();var nodes=this._gltf.nodes;if(nodes){var _iterator211=_createForOfIteratorHelper(nodes),_step224;try{for(_iterator211.s();!(_step224=_iterator211.n()).done;){var node=_step224.value;if(node._babylonTransformNode&&node._babylonTransformNode.getClassName()==="TransformNode"){transformNodes.push(node._babylonTransformNode);}if(node._babylonTransformNodeForSkin){transformNodes.push(node._babylonTransformNodeForSkin);}}}catch(err){_iterator211.e(err);}finally{_iterator211.f();}}return transformNodes;}},{key:"_getSkeletons",value:function _getSkeletons(){var skeletons=new Array();var skins=this._gltf.skins;if(skins){var _iterator212=_createForOfIteratorHelper(skins),_step225;try{for(_iterator212.s();!(_step225=_iterator212.n()).done;){var skin=_step225.value;if(skin._data){skeletons.push(skin._data.babylonSkeleton);}}}catch(err){_iterator212.e(err);}finally{_iterator212.f();}}return skeletons;}},{key:"_getAnimationGroups",value:function _getAnimationGroups(){var animationGroups=new Array();var animations=this._gltf.animations;if(animations){var _iterator213=_createForOfIteratorHelper(animations),_step226;try{for(_iterator213.s();!(_step226=_iterator213.n()).done;){var animation=_step226.value;if(animation._babylonAnimationGroup){animationGroups.push(animation._babylonAnimationGroup);}}}catch(err){_iterator213.e(err);}finally{_iterator213.f();}}return animationGroups;}},{key:"_startAnimations",value:function _startAnimations(){switch(this._parent.animationStartMode){case GLTFLoaderAnimationStartMode.NONE:{break;}case GLTFLoaderAnimationStartMode.FIRST:{var babylonAnimationGroups=this._getAnimationGroups();if(babylonAnimationGroups.length!==0){babylonAnimationGroups[0].start(true);}break;}case GLTFLoaderAnimationStartMode.ALL:{var _babylonAnimationGroups=this._getAnimationGroups();var _iterator214=_createForOfIteratorHelper(_babylonAnimationGroups),_step227;try{for(_iterator214.s();!(_step227=_iterator214.n()).done;){var babylonAnimationGroup=_step227.value;babylonAnimationGroup.start(true);}}catch(err){_iterator214.e(err);}finally{_iterator214.f();}break;}default:{Logger.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"));return;}}}},{key:"loadNodeAsync",value:function loadNodeAsync(context,node){var _this195=this;var assign=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var extensionPromise=this._extensionsLoadNodeAsync(context,node,assign);if(extensionPromise){return extensionPromise;}if(node._babylonTransformNode){throw new Error("".concat(context,": Invalid recursive node hierarchy"));}var promises=new Array();this.logOpen("".concat(context," ").concat(node.name||""));var loadNode=function loadNode(babylonTransformNode){GLTFLoader2.AddPointerMetadata(babylonTransformNode,context);GLTFLoader2._LoadTransform(node,babylonTransformNode);if(node.camera!=void 0){var camera=ArrayItem.Get("".concat(context,"/camera"),_this195._gltf.cameras,node.camera);promises.push(_this195.loadCameraAsync("/cameras/".concat(camera.index),camera,function(babylonCamera){babylonCamera.parent=babylonTransformNode;}));}if(node.children){var _iterator215=_createForOfIteratorHelper(node.children),_step228;try{for(_iterator215.s();!(_step228=_iterator215.n()).done;){var index=_step228.value;var childNode=ArrayItem.Get("".concat(context,"/children/").concat(index),_this195._gltf.nodes,index);promises.push(_this195.loadNodeAsync("/nodes/".concat(childNode.index),childNode,function(childBabylonMesh){childBabylonMesh.parent=babylonTransformNode;}));}}catch(err){_iterator215.e(err);}finally{_iterator215.f();}}assign(babylonTransformNode);};if(node.mesh==void 0||node.skin!=void 0){var nodeName=node.name||"node".concat(node.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var transformNode=new TransformNode(nodeName,this._babylonScene);transformNode._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;if(node.mesh==void 0){node._babylonTransformNode=transformNode;}else{node._babylonTransformNodeForSkin=transformNode;}loadNode(transformNode);}if(node.mesh!=void 0){if(node.skin==void 0){var mesh=ArrayItem.Get("".concat(context,"/mesh"),this._gltf.meshes,node.mesh);promises.push(this._loadMeshAsync("/meshes/".concat(mesh.index),node,mesh,loadNode));}else{var _mesh7=ArrayItem.Get("".concat(context,"/mesh"),this._gltf.meshes,node.mesh);promises.push(this._loadMeshAsync("/meshes/".concat(_mesh7.index),node,_mesh7,function(babylonTransformNode){var babylonTransformNodeForSkin=node._babylonTransformNodeForSkin;babylonTransformNode.metadata=mergeDeep(babylonTransformNodeForSkin.metadata,babylonTransformNode.metadata||{});var skin=ArrayItem.Get("".concat(context,"/skin"),_this195._gltf.skins,node.skin);promises.push(_this195._loadSkinAsync("/skins/".concat(skin.index),node,skin,function(babylonSkeleton){_this195._forEachPrimitive(node,function(babylonMesh){babylonMesh.skeleton=babylonSkeleton;});_this195._postSceneLoadActions.push(function(){if(skin.skeleton!=void 0){var parentNode=ArrayItem.Get("/skins/".concat(skin.index,"/skeleton"),_this195._gltf.nodes,skin.skeleton).parent;if(node.index===parentNode.index){babylonTransformNode.parent=babylonTransformNodeForSkin.parent;}else{babylonTransformNode.parent=parentNode._babylonTransformNode;}}else{babylonTransformNode.parent=_this195._rootBabylonMesh;}_this195._parent.onSkinLoadedObservable.notifyObservers({node:babylonTransformNodeForSkin,skinnedNode:babylonTransformNode});});}));}));}}this.logClose();return Promise.all(promises).then(function(){_this195._forEachPrimitive(node,function(babylonMesh){if(babylonMesh.geometry&&babylonMesh.geometry.useBoundingInfoFromGeometry){babylonMesh._updateBoundingInfo();}else{babylonMesh.refreshBoundingInfo(true);}});return node._babylonTransformNode;});}},{key:"_loadMeshAsync",value:function _loadMeshAsync(context,node,mesh,assign){var primitives=mesh.primitives;if(!primitives||!primitives.length){throw new Error("".concat(context,": Primitives are missing"));}if(primitives[0].index==void 0){ArrayItem.Assign(primitives);}var promises=new Array();this.logOpen("".concat(context," ").concat(mesh.name||""));var name135=node.name||"node".concat(node.index);if(primitives.length===1){var primitive=mesh.primitives[0];promises.push(this._loadMeshPrimitiveAsync("".concat(context,"/primitives/").concat(primitive.index),name135,node,mesh,primitive,function(babylonMesh){node._babylonTransformNode=babylonMesh;node._primitiveBabylonMeshes=[babylonMesh];}));}else{this._babylonScene._blockEntityCollection=!!this._assetContainer;node._babylonTransformNode=new TransformNode(name135,this._babylonScene);node._babylonTransformNode._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;node._primitiveBabylonMeshes=[];var _iterator216=_createForOfIteratorHelper(primitives),_step229;try{for(_iterator216.s();!(_step229=_iterator216.n()).done;){var _primitive=_step229.value;promises.push(this._loadMeshPrimitiveAsync("".concat(context,"/primitives/").concat(_primitive.index),"".concat(name135,"_primitive").concat(_primitive.index),node,mesh,_primitive,function(babylonMesh){babylonMesh.parent=node._babylonTransformNode;node._primitiveBabylonMeshes.push(babylonMesh);}));}}catch(err){_iterator216.e(err);}finally{_iterator216.f();}}assign(node._babylonTransformNode);this.logClose();return Promise.all(promises).then(function(){return node._babylonTransformNode;});}},{key:"_loadMeshPrimitiveAsync",value:function _loadMeshPrimitiveAsync(context,name135,node,mesh,primitive,assign){var _this196=this;var extensionPromise=this._extensionsLoadMeshPrimitiveAsync(context,name135,node,mesh,primitive,assign);if(extensionPromise){return extensionPromise;}this.logOpen("".concat(context));var shouldInstance=this._disableInstancedMesh===0&&this._parent.createInstances&&node.skin==void 0&&!mesh.primitives[0].targets;var babylonAbstractMesh;var promise;if(shouldInstance&&primitive._instanceData){this._babylonScene._blockEntityCollection=!!this._assetContainer;babylonAbstractMesh=primitive._instanceData.babylonSourceMesh.createInstance(name135);babylonAbstractMesh._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;promise=primitive._instanceData.promise;}else{var promises=new Array();this._babylonScene._blockEntityCollection=!!this._assetContainer;var babylonMesh=new Mesh(name135,this._babylonScene);babylonMesh._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;babylonMesh.overrideMaterialSideOrientation=this._babylonScene.useRightHandedSystem?Material.CounterClockWiseSideOrientation:Material.ClockWiseSideOrientation;this._createMorphTargets(context,node,mesh,primitive,babylonMesh);promises.push(this._loadVertexDataAsync(context,primitive,babylonMesh).then(function(babylonGeometry){return _this196._loadMorphTargetsAsync(context,primitive,babylonMesh,babylonGeometry).then(function(){if(_this196._disposed){return;}_this196._babylonScene._blockEntityCollection=!!_this196._assetContainer;babylonGeometry.applyToMesh(babylonMesh);babylonGeometry._parentContainer=_this196._assetContainer;_this196._babylonScene._blockEntityCollection=false;});}));var babylonDrawMode=GLTFLoader2._GetDrawMode(context,primitive.mode);if(primitive.material==void 0){var babylonMaterial=this._defaultBabylonMaterialData[babylonDrawMode];if(!babylonMaterial){babylonMaterial=this._createDefaultMaterial("__GLTFLoader._default",babylonDrawMode);this._parent.onMaterialLoadedObservable.notifyObservers(babylonMaterial);this._defaultBabylonMaterialData[babylonDrawMode]=babylonMaterial;}babylonMesh.material=babylonMaterial;}else if(!this.parent.skipMaterials){var material=ArrayItem.Get("".concat(context,"/material"),this._gltf.materials,primitive.material);promises.push(this._loadMaterialAsync("/materials/".concat(material.index),material,babylonMesh,babylonDrawMode,function(babylonMaterial){babylonMesh.material=babylonMaterial;}));}promise=Promise.all(promises);if(shouldInstance){primitive._instanceData={babylonSourceMesh:babylonMesh,promise:promise};}babylonAbstractMesh=babylonMesh;}GLTFLoader2.AddPointerMetadata(babylonAbstractMesh,context);this._parent.onMeshLoadedObservable.notifyObservers(babylonAbstractMesh);assign(babylonAbstractMesh);this.logClose();return promise.then(function(){return babylonAbstractMesh;});}},{key:"_loadVertexDataAsync",value:function _loadVertexDataAsync(context,primitive,babylonMesh){var _this197=this;var extensionPromise=this._extensionsLoadVertexDataAsync(context,primitive,babylonMesh);if(extensionPromise){return extensionPromise;}var attributes=primitive.attributes;if(!attributes){throw new Error("".concat(context,": Attributes are missing"));}var promises=new Array();var babylonGeometry=new Geometry(babylonMesh.name,this._babylonScene);if(primitive.indices==void 0){babylonMesh.isUnIndexed=true;}else{var accessor=ArrayItem.Get("".concat(context,"/indices"),this._gltf.accessors,primitive.indices);promises.push(this._loadIndicesAccessorAsync("/accessors/".concat(accessor.index),accessor).then(function(data){babylonGeometry.setIndices(data);}));}var loadAttribute=function loadAttribute(attribute,kind,callback){if(attributes[attribute]==void 0){return;}babylonMesh._delayInfo=babylonMesh._delayInfo||[];if(babylonMesh._delayInfo.indexOf(kind)===-1){babylonMesh._delayInfo.push(kind);}var accessor=ArrayItem.Get("".concat(context,"/attributes/").concat(attribute),_this197._gltf.accessors,attributes[attribute]);promises.push(_this197._loadVertexAccessorAsync("/accessors/".concat(accessor.index),accessor,kind).then(function(babylonVertexBuffer){if(babylonVertexBuffer.getKind()===VertexBuffer.PositionKind&&!_this197.parent.alwaysComputeBoundingBox&&!babylonMesh.skeleton){var mmin=accessor.min,mmax=accessor.max;if(mmin!==void 0&&mmax!==void 0){if(accessor.normalized&&accessor.componentType!==5126){var divider=1;switch(accessor.componentType){case 5120:divider=127;break;case 5121:divider=255;break;case 5122:divider=32767;break;case 5123:divider=65535;break;}for(var i=0;i<3;++i){mmin[i]=Math.max(mmin[i]/divider,-1);mmax[i]=Math.max(mmax[i]/divider,-1);}}var min=TmpVectors.Vector3[0],max=TmpVectors.Vector3[1];min.copyFromFloats.apply(min,_toConsumableArray(mmin));max.copyFromFloats.apply(max,_toConsumableArray(mmax));babylonGeometry._boundingInfo=new BoundingInfo(min,max);babylonGeometry.useBoundingInfoFromGeometry=true;}}babylonGeometry.setVerticesBuffer(babylonVertexBuffer,accessor.count);}));if(kind==VertexBuffer.MatricesIndicesExtraKind){babylonMesh.numBoneInfluencers=8;}if(callback){callback(accessor);}};loadAttribute("POSITION",VertexBuffer.PositionKind);loadAttribute("NORMAL",VertexBuffer.NormalKind);loadAttribute("TANGENT",VertexBuffer.TangentKind);loadAttribute("TEXCOORD_0",VertexBuffer.UVKind);loadAttribute("TEXCOORD_1",VertexBuffer.UV2Kind);loadAttribute("TEXCOORD_2",VertexBuffer.UV3Kind);loadAttribute("TEXCOORD_3",VertexBuffer.UV4Kind);loadAttribute("TEXCOORD_4",VertexBuffer.UV5Kind);loadAttribute("TEXCOORD_5",VertexBuffer.UV6Kind);loadAttribute("JOINTS_0",VertexBuffer.MatricesIndicesKind);loadAttribute("WEIGHTS_0",VertexBuffer.MatricesWeightsKind);loadAttribute("JOINTS_1",VertexBuffer.MatricesIndicesExtraKind);loadAttribute("WEIGHTS_1",VertexBuffer.MatricesWeightsExtraKind);loadAttribute("COLOR_0",VertexBuffer.ColorKind,function(accessor){if(accessor.type==="VEC4"){babylonMesh.hasVertexAlpha=true;}});return Promise.all(promises).then(function(){return babylonGeometry;});}},{key:"_createMorphTargets",value:function _createMorphTargets(context,node,mesh,primitive,babylonMesh){if(!primitive.targets){return;}if(node._numMorphTargets==void 0){node._numMorphTargets=primitive.targets.length;}else if(primitive.targets.length!==node._numMorphTargets){throw new Error("".concat(context,": Primitives do not have the same number of targets"));}var targetNames=mesh.extras?mesh.extras.targetNames:null;babylonMesh.morphTargetManager=new MorphTargetManager(babylonMesh.getScene());babylonMesh.morphTargetManager.areUpdatesFrozen=true;for(var index=0;index<primitive.targets.length;index++){var weight=node.weights?node.weights[index]:mesh.weights?mesh.weights[index]:0;var name135=targetNames?targetNames[index]:"morphTarget".concat(index);babylonMesh.morphTargetManager.addTarget(new MorphTarget(name135,weight,babylonMesh.getScene()));}}},{key:"_loadMorphTargetsAsync",value:function _loadMorphTargetsAsync(context,primitive,babylonMesh,babylonGeometry){if(!primitive.targets){return Promise.resolve();}var promises=new Array();var morphTargetManager=babylonMesh.morphTargetManager;for(var index=0;index<morphTargetManager.numTargets;index++){var babylonMorphTarget=morphTargetManager.getTarget(index);promises.push(this._loadMorphTargetVertexDataAsync("".concat(context,"/targets/").concat(index),babylonGeometry,primitive.targets[index],babylonMorphTarget));}return Promise.all(promises).then(function(){morphTargetManager.areUpdatesFrozen=false;});}},{key:"_loadMorphTargetVertexDataAsync",value:function _loadMorphTargetVertexDataAsync(context,babylonGeometry,attributes,babylonMorphTarget){var _this198=this;var promises=new Array();var loadAttribute=function loadAttribute(attribute,kind,setData){if(attributes[attribute]==void 0){return;}var babylonVertexBuffer=babylonGeometry.getVertexBuffer(kind);if(!babylonVertexBuffer){return;}var accessor=ArrayItem.Get("".concat(context,"/").concat(attribute),_this198._gltf.accessors,attributes[attribute]);promises.push(_this198._loadFloatAccessorAsync("/accessors/".concat(accessor.index),accessor).then(function(data){setData(babylonVertexBuffer,data);}));};loadAttribute("POSITION",VertexBuffer.PositionKind,function(babylonVertexBuffer,data){var positions=new Float32Array(data.length);babylonVertexBuffer.forEach(data.length,function(value,index){positions[index]=data[index]+value;});babylonMorphTarget.setPositions(positions);});loadAttribute("NORMAL",VertexBuffer.NormalKind,function(babylonVertexBuffer,data){var normals=new Float32Array(data.length);babylonVertexBuffer.forEach(normals.length,function(value,index){normals[index]=data[index]+value;});babylonMorphTarget.setNormals(normals);});loadAttribute("TANGENT",VertexBuffer.TangentKind,function(babylonVertexBuffer,data){var tangents=new Float32Array(data.length/3*4);var dataIndex=0;babylonVertexBuffer.forEach(data.length/3*4,function(value,index){if((index+1)%4!==0){tangents[dataIndex]=data[dataIndex]+value;dataIndex++;}});babylonMorphTarget.setTangents(tangents);});return Promise.all(promises).then(function(){});}},{key:"_loadSkinAsync",value:function _loadSkinAsync(context,node,skin,assign){var _this199=this;var extensionPromise=this._extensionsLoadSkinAsync(context,node,skin);if(extensionPromise){return extensionPromise;}if(skin._data){assign(skin._data.babylonSkeleton);return skin._data.promise;}var skeletonId="skeleton".concat(skin.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var babylonSkeleton=new Skeleton(skin.name||skeletonId,skeletonId,this._babylonScene);babylonSkeleton._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;this._loadBones(context,skin,babylonSkeleton);var promise=this._loadSkinInverseBindMatricesDataAsync(context,skin).then(function(inverseBindMatricesData){_this199._updateBoneMatrices(babylonSkeleton,inverseBindMatricesData);});skin._data={babylonSkeleton:babylonSkeleton,promise:promise};assign(babylonSkeleton);return promise;}},{key:"_loadBones",value:function _loadBones(context,skin,babylonSkeleton){if(skin.skeleton==void 0||this._parent.alwaysComputeSkeletonRootNode){var rootNode=this._findSkeletonRootNode("".concat(context,"/joints"),skin.joints);if(rootNode){if(skin.skeleton===void 0){skin.skeleton=rootNode.index;}else{var isParent=function isParent(a,b){for(;b.parent;b=b.parent){if(b.parent===a){return true;}}return false;};var skeletonNode=ArrayItem.Get("".concat(context,"/skeleton"),this._gltf.nodes,skin.skeleton);if(skeletonNode!==rootNode&&!isParent(skeletonNode,rootNode)){Logger.Warn("".concat(context,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root"));skin.skeleton=rootNode.index;}}}else{Logger.Warn("".concat(context,": Failed to find common root"));}}var babylonBones={};var _iterator217=_createForOfIteratorHelper(skin.joints),_step230;try{for(_iterator217.s();!(_step230=_iterator217.n()).done;){var index=_step230.value;var node=ArrayItem.Get("".concat(context,"/joints/").concat(index),this._gltf.nodes,index);this._loadBone(node,skin,babylonSkeleton,babylonBones);}}catch(err){_iterator217.e(err);}finally{_iterator217.f();}}},{key:"_findSkeletonRootNode",value:function _findSkeletonRootNode(context,joints){if(joints.length===0){return null;}var paths={};var _iterator218=_createForOfIteratorHelper(joints),_step231;try{for(_iterator218.s();!(_step231=_iterator218.n()).done;){var index=_step231.value;var _path=new Array();var _node8=ArrayItem.Get("".concat(context,"/").concat(index),this._gltf.nodes,index);while(_node8.index!==-1){_path.unshift(_node8);_node8=_node8.parent;}paths[index]=_path;}}catch(err){_iterator218.e(err);}finally{_iterator218.f();}var rootNode=null;for(var i=0;;++i){var path=paths[joints[0]];if(i>=path.length){return rootNode;}var node=path[i];for(var j=1;j<joints.length;++j){path=paths[joints[j]];if(i>=path.length||node!==path[i]){return rootNode;}}rootNode=node;}}},{key:"_loadBone",value:function _loadBone(node,skin,babylonSkeleton,babylonBones){var babylonBone=babylonBones[node.index];if(babylonBone){return babylonBone;}var parentBabylonBone=null;if(node.index!==skin.skeleton){if(node.parent&&node.parent.index!==-1){parentBabylonBone=this._loadBone(node.parent,skin,babylonSkeleton,babylonBones);}else if(skin.skeleton!==void 0){Logger.Warn("/skins/".concat(skin.index,"/skeleton: Skeleton node is not a common root"));}}var boneIndex=skin.joints.indexOf(node.index);babylonBone=new Bone(node.name||"joint".concat(node.index),babylonSkeleton,parentBabylonBone,this._getNodeMatrix(node),null,null,boneIndex);babylonBones[node.index]=babylonBone;this._postSceneLoadActions.push(function(){babylonBone.linkTransformNode(node._babylonTransformNode);});return babylonBone;}},{key:"_loadSkinInverseBindMatricesDataAsync",value:function _loadSkinInverseBindMatricesDataAsync(context,skin){if(skin.inverseBindMatrices==void 0){return Promise.resolve(null);}var accessor=ArrayItem.Get("".concat(context,"/inverseBindMatrices"),this._gltf.accessors,skin.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(accessor.index),accessor);}},{key:"_updateBoneMatrices",value:function _updateBoneMatrices(babylonSkeleton,inverseBindMatricesData){var _iterator219=_createForOfIteratorHelper(babylonSkeleton.bones),_step232;try{for(_iterator219.s();!(_step232=_iterator219.n()).done;){var babylonBone=_step232.value;var baseMatrix=Matrix.Identity();var boneIndex=babylonBone._index;if(inverseBindMatricesData&&boneIndex!==-1){Matrix.FromArrayToRef(inverseBindMatricesData,boneIndex*16,baseMatrix);baseMatrix.invertToRef(baseMatrix);}var babylonParentBone=babylonBone.getParent();if(babylonParentBone){baseMatrix.multiplyToRef(babylonParentBone.getInvertedAbsoluteTransform(),baseMatrix);}babylonBone.updateMatrix(baseMatrix,false,false);babylonBone._updateDifferenceMatrix(void 0,false);}}catch(err){_iterator219.e(err);}finally{_iterator219.f();}}},{key:"_getNodeMatrix",value:function _getNodeMatrix(node){return node.matrix?Matrix.FromArray(node.matrix):Matrix.Compose(node.scale?Vector3.FromArray(node.scale):Vector3.One(),node.rotation?Quaternion.FromArray(node.rotation):Quaternion.Identity(),node.translation?Vector3.FromArray(node.translation):Vector3.Zero());}},{key:"loadCameraAsync",value:function loadCameraAsync(context,camera){var assign=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var extensionPromise=this._extensionsLoadCameraAsync(context,camera,assign);if(extensionPromise){return extensionPromise;}var promises=new Array();this.logOpen("".concat(context," ").concat(camera.name||""));this._babylonScene._blockEntityCollection=!!this._assetContainer;var babylonCamera=new FreeCamera(camera.name||"camera".concat(camera.index),Vector3.Zero(),this._babylonScene,false);babylonCamera._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;babylonCamera.ignoreParentScaling=true;camera._babylonCamera=babylonCamera;babylonCamera.rotation=new Vector3(0,Math.PI,0);switch(camera.type){case"perspective":{var perspective=camera.perspective;if(!perspective){throw new Error("".concat(context,": Camera perspective properties are missing"));}babylonCamera.fov=perspective.yfov;babylonCamera.minZ=perspective.znear;babylonCamera.maxZ=perspective.zfar||0;break;}case"orthographic":{if(!camera.orthographic){throw new Error("".concat(context,": Camera orthographic properties are missing"));}babylonCamera.mode=Camera.ORTHOGRAPHIC_CAMERA;babylonCamera.orthoLeft=-camera.orthographic.xmag;babylonCamera.orthoRight=camera.orthographic.xmag;babylonCamera.orthoBottom=-camera.orthographic.ymag;babylonCamera.orthoTop=camera.orthographic.ymag;babylonCamera.minZ=camera.orthographic.znear;babylonCamera.maxZ=camera.orthographic.zfar;break;}default:{throw new Error("".concat(context,": Invalid camera type (").concat(camera.type,")"));}}GLTFLoader2.AddPointerMetadata(babylonCamera,context);this._parent.onCameraLoadedObservable.notifyObservers(babylonCamera);assign(babylonCamera);this.logClose();return Promise.all(promises).then(function(){return babylonCamera;});}},{key:"_loadAnimationsAsync",value:function _loadAnimationsAsync(){var animations=this._gltf.animations;if(!animations){return Promise.resolve();}var promises=new Array();for(var index=0;index<animations.length;index++){var animation=animations[index];promises.push(this.loadAnimationAsync("/animations/".concat(animation.index),animation).then(function(animationGroup){if(animationGroup.targetedAnimations.length===0){animationGroup.dispose();}}));}return Promise.all(promises).then(function(){});}},{key:"loadAnimationAsync",value:function loadAnimationAsync(context,animation){var promise=this._extensionsLoadAnimationAsync(context,animation);if(promise){return promise;}this._babylonScene._blockEntityCollection=!!this._assetContainer;var babylonAnimationGroup=new AnimationGroup(animation.name||"animation".concat(animation.index),this._babylonScene);babylonAnimationGroup._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;animation._babylonAnimationGroup=babylonAnimationGroup;var promises=new Array();ArrayItem.Assign(animation.channels);ArrayItem.Assign(animation.samplers);var _iterator220=_createForOfIteratorHelper(animation.channels),_step233;try{for(_iterator220.s();!(_step233=_iterator220.n()).done;){var channel=_step233.value;promises.push(this._loadAnimationChannelAsync("".concat(context,"/channels/").concat(channel.index),context,animation,channel,function(babylonTarget,babylonAnimation){babylonTarget.animations=babylonTarget.animations||[];babylonTarget.animations.push(babylonAnimation);babylonAnimationGroup.addTargetedAnimation(babylonAnimation,babylonTarget);}));}}catch(err){_iterator220.e(err);}finally{_iterator220.f();}return Promise.all(promises).then(function(){babylonAnimationGroup.normalize(0);return babylonAnimationGroup;});}},{key:"_loadAnimationChannelAsync",value:function _loadAnimationChannelAsync(context,animationContext,animation,channel,onLoad){var promise=this._extensionsLoadAnimationChannelAsync(context,animationContext,animation,channel,onLoad);if(promise){return promise;}if(channel.target.node==void 0){return Promise.resolve();}var targetNode=ArrayItem.Get("".concat(context,"/target/node"),this._gltf.nodes,channel.target.node);if(channel.target.path==="weights"&&!targetNode._numMorphTargets||channel.target.path!=="weights"&&!targetNode._babylonTransformNode){return Promise.resolve();}var properties;switch(channel.target.path){case"translation":{properties=nodeAnimationData.translation;break;}case"rotation":{properties=nodeAnimationData.rotation;break;}case"scale":{properties=nodeAnimationData.scale;break;}case"weights":{properties=nodeAnimationData.weights;break;}default:{throw new Error("".concat(context,"/target/path: Invalid value (").concat(channel.target.path,")"));}}var targetInfo={target:targetNode,properties:properties};return this._loadAnimationChannelFromTargetInfoAsync(context,animationContext,animation,channel,targetInfo,onLoad);}},{key:"_loadAnimationChannelFromTargetInfoAsync",value:function _loadAnimationChannelFromTargetInfoAsync(context,animationContext,animation,channel,targetInfo,onLoad){var fps=this.parent.targetFps;var invfps=1/fps;var sampler=ArrayItem.Get("".concat(context,"/sampler"),animation.samplers,channel.sampler);return this._loadAnimationSamplerAsync("".concat(animationContext,"/samplers/").concat(channel.sampler),sampler).then(function(data){var numAnimations=0;var _iterator221=_createForOfIteratorHelper(targetInfo.properties),_step234;try{for(_iterator221.s();!(_step234=_iterator221.n()).done;){var property=_step234.value;var stride=property.getStride(targetInfo.target);var input=data.input;var output=data.output;var keys=new Array(input.length);var outputOffset=0;switch(data.interpolation){case"STEP":{for(var index=0;index<input.length;index++){var value=property.getValue(targetInfo.target,output,outputOffset,1);outputOffset+=stride;keys[index]={frame:input[index]*fps,value:value,interpolation:AnimationKeyInterpolation.STEP};}break;}case"CUBICSPLINE":{for(var _index29=0;_index29<input.length;_index29++){var inTangent=property.getValue(targetInfo.target,output,outputOffset,invfps);outputOffset+=stride;var _value10=property.getValue(targetInfo.target,output,outputOffset,1);outputOffset+=stride;var outTangent=property.getValue(targetInfo.target,output,outputOffset,invfps);outputOffset+=stride;keys[_index29]={frame:input[_index29]*fps,inTangent:inTangent,value:_value10,outTangent:outTangent};}break;}case"LINEAR":{for(var _index30=0;_index30<input.length;_index30++){var _value11=property.getValue(targetInfo.target,output,outputOffset,1);outputOffset+=stride;keys[_index30]={frame:input[_index30]*fps,value:_value11};}break;}}if(outputOffset>0){var name135="".concat(animation.name||"animation".concat(animation.index),"_channel").concat(channel.index,"_").concat(numAnimations);property.buildAnimations(targetInfo.target,name135,fps,keys,function(babylonAnimatable,babylonAnimation){++numAnimations;onLoad(babylonAnimatable,babylonAnimation);});}}}catch(err){_iterator221.e(err);}finally{_iterator221.f();}});}},{key:"_loadAnimationSamplerAsync",value:function _loadAnimationSamplerAsync(context,sampler){if(sampler._data){return sampler._data;}var interpolation=sampler.interpolation||"LINEAR";switch(interpolation){case"STEP":case"LINEAR":case"CUBICSPLINE":{break;}default:{throw new Error("".concat(context,"/interpolation: Invalid value (").concat(sampler.interpolation,")"));}}var inputAccessor=ArrayItem.Get("".concat(context,"/input"),this._gltf.accessors,sampler.input);var outputAccessor=ArrayItem.Get("".concat(context,"/output"),this._gltf.accessors,sampler.output);sampler._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(inputAccessor.index),inputAccessor),this._loadFloatAccessorAsync("/accessors/".concat(outputAccessor.index),outputAccessor)]).then(function(_ref16){var _ref17=_slicedToArray(_ref16,2),inputData=_ref17[0],outputData=_ref17[1];return{input:inputData,interpolation:interpolation,output:outputData};});return sampler._data;}},{key:"loadBufferAsync",value:function loadBufferAsync(context,buffer,byteOffset,byteLength){var extensionPromise=this._extensionsLoadBufferAsync(context,buffer,byteOffset,byteLength);if(extensionPromise){return extensionPromise;}if(!buffer._data){if(buffer.uri){buffer._data=this.loadUriAsync("".concat(context,"/uri"),buffer,buffer.uri);}else{if(!this._bin){throw new Error("".concat(context,": Uri is missing or the binary glTF is missing its binary chunk"));}buffer._data=this._bin.readAsync(0,buffer.byteLength);}}return buffer._data.then(function(data){try{return new Uint8Array(data.buffer,data.byteOffset+byteOffset,byteLength);}catch(e){throw new Error("".concat(context,": ").concat(e.message));}});}},{key:"loadBufferViewAsync",value:function loadBufferViewAsync(context,bufferView){var extensionPromise=this._extensionsLoadBufferViewAsync(context,bufferView);if(extensionPromise){return extensionPromise;}if(bufferView._data){return bufferView._data;}var buffer=ArrayItem.Get("".concat(context,"/buffer"),this._gltf.buffers,bufferView.buffer);bufferView._data=this.loadBufferAsync("/buffers/".concat(buffer.index),buffer,bufferView.byteOffset||0,bufferView.byteLength);return bufferView._data;}},{key:"_loadAccessorAsync",value:function _loadAccessorAsync(context,accessor,constructor){var _this200=this;if(accessor._data){return accessor._data;}var numComponents=GLTFLoader2._GetNumComponents(context,accessor.type);var byteStride=numComponents*VertexBuffer.GetTypeByteLength(accessor.componentType);var length=numComponents*accessor.count;if(accessor.bufferView==void 0){accessor._data=Promise.resolve(new constructor(length));}else{var bufferView=ArrayItem.Get("".concat(context,"/bufferView"),this._gltf.bufferViews,accessor.bufferView);accessor._data=this.loadBufferViewAsync("/bufferViews/".concat(bufferView.index),bufferView).then(function(data){if(accessor.componentType===5126&&!accessor.normalized&&(!bufferView.byteStride||bufferView.byteStride===byteStride)){return GLTFLoader2._GetTypedArray(context,accessor.componentType,data,accessor.byteOffset,length);}else{var typedArray=new constructor(length);VertexBuffer.ForEach(data,accessor.byteOffset||0,bufferView.byteStride||byteStride,numComponents,accessor.componentType,typedArray.length,accessor.normalized||false,function(value,index){typedArray[index]=value;});return typedArray;}});}if(accessor.sparse){var sparse=accessor.sparse;accessor._data=accessor._data.then(function(data){var typedArray=data;var indicesBufferView=ArrayItem.Get("".concat(context,"/sparse/indices/bufferView"),_this200._gltf.bufferViews,sparse.indices.bufferView);var valuesBufferView=ArrayItem.Get("".concat(context,"/sparse/values/bufferView"),_this200._gltf.bufferViews,sparse.values.bufferView);return Promise.all([_this200.loadBufferViewAsync("/bufferViews/".concat(indicesBufferView.index),indicesBufferView),_this200.loadBufferViewAsync("/bufferViews/".concat(valuesBufferView.index),valuesBufferView)]).then(function(_ref18){var _ref19=_slicedToArray(_ref18,2),indicesData=_ref19[0],valuesData=_ref19[1];var indices=GLTFLoader2._GetTypedArray("".concat(context,"/sparse/indices"),sparse.indices.componentType,indicesData,sparse.indices.byteOffset,sparse.count);var sparseLength=numComponents*sparse.count;var values;if(accessor.componentType===5126&&!accessor.normalized){values=GLTFLoader2._GetTypedArray("".concat(context,"/sparse/values"),accessor.componentType,valuesData,sparse.values.byteOffset,sparseLength);}else{var sparseData=GLTFLoader2._GetTypedArray("".concat(context,"/sparse/values"),accessor.componentType,valuesData,sparse.values.byteOffset,sparseLength);values=new constructor(sparseLength);VertexBuffer.ForEach(sparseData,0,byteStride,numComponents,accessor.componentType,values.length,accessor.normalized||false,function(value,index){values[index]=value;});}var valuesIndex=0;for(var indicesIndex=0;indicesIndex<indices.length;indicesIndex++){var dataIndex=indices[indicesIndex]*numComponents;for(var componentIndex=0;componentIndex<numComponents;componentIndex++){typedArray[dataIndex++]=values[valuesIndex++];}}return typedArray;});});}return accessor._data;}},{key:"_loadFloatAccessorAsync",value:function _loadFloatAccessorAsync(context,accessor){return this._loadAccessorAsync(context,accessor,Float32Array);}},{key:"_loadIndicesAccessorAsync",value:function _loadIndicesAccessorAsync(context,accessor){if(accessor.type!=="SCALAR"){throw new Error("".concat(context,"/type: Invalid value ").concat(accessor.type));}if(accessor.componentType!==5121&&accessor.componentType!==5123&&accessor.componentType!==5125){throw new Error("".concat(context,"/componentType: Invalid value ").concat(accessor.componentType));}if(accessor._data){return accessor._data;}if(accessor.sparse){var _constructor=GLTFLoader2._GetTypedArrayConstructor("".concat(context,"/componentType"),accessor.componentType);accessor._data=this._loadAccessorAsync(context,accessor,_constructor);}else{var bufferView=ArrayItem.Get("".concat(context,"/bufferView"),this._gltf.bufferViews,accessor.bufferView);accessor._data=this.loadBufferViewAsync("/bufferViews/".concat(bufferView.index),bufferView).then(function(data){return GLTFLoader2._GetTypedArray(context,accessor.componentType,data,accessor.byteOffset,accessor.count);});}return accessor._data;}},{key:"_loadVertexBufferViewAsync",value:function _loadVertexBufferViewAsync(bufferView){if(bufferView._babylonBuffer){return bufferView._babylonBuffer;}var engine=this._babylonScene.getEngine();bufferView._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(bufferView.index),bufferView).then(function(data){return new Buffer2(engine,data,false);});return bufferView._babylonBuffer;}},{key:"_loadVertexAccessorAsync",value:function _loadVertexAccessorAsync(context,accessor,kind){var _a;if((_a=accessor._babylonVertexBuffer)===null||_a===void 0?void 0:_a[kind]){return accessor._babylonVertexBuffer[kind];}if(!accessor._babylonVertexBuffer){accessor._babylonVertexBuffer={};}var engine=this._babylonScene.getEngine();if(accessor.sparse){accessor._babylonVertexBuffer[kind]=this._loadFloatAccessorAsync(context,accessor).then(function(data){return new VertexBuffer(engine,data,kind,false);});}else if(kind===VertexBuffer.MatricesIndicesKind||kind===VertexBuffer.MatricesIndicesExtraKind){accessor._babylonVertexBuffer[kind]=this._loadFloatAccessorAsync(context,accessor).then(function(data){return new VertexBuffer(engine,data,kind,false);});}else{var bufferView=ArrayItem.Get("".concat(context,"/bufferView"),this._gltf.bufferViews,accessor.bufferView);accessor._babylonVertexBuffer[kind]=this._loadVertexBufferViewAsync(bufferView).then(function(babylonBuffer){var size=GLTFLoader2._GetNumComponents(context,accessor.type);return new VertexBuffer(engine,babylonBuffer,kind,false,false,bufferView.byteStride,false,accessor.byteOffset,size,accessor.componentType,accessor.normalized,true,1,true);});}return accessor._babylonVertexBuffer[kind];}},{key:"_loadMaterialMetallicRoughnessPropertiesAsync",value:function _loadMaterialMetallicRoughnessPropertiesAsync(context,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();if(properties){if(properties.baseColorFactor){babylonMaterial.albedoColor=Color3.FromArray(properties.baseColorFactor);babylonMaterial.alpha=properties.baseColorFactor[3];}else{babylonMaterial.albedoColor=Color3.White();}babylonMaterial.metallic=properties.metallicFactor==void 0?1:properties.metallicFactor;babylonMaterial.roughness=properties.roughnessFactor==void 0?1:properties.roughnessFactor;if(properties.baseColorTexture){promises.push(this.loadTextureInfoAsync("".concat(context,"/baseColorTexture"),properties.baseColorTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Base Color)");babylonMaterial.albedoTexture=texture;}));}if(properties.metallicRoughnessTexture){properties.metallicRoughnessTexture.nonColorData=true;promises.push(this.loadTextureInfoAsync("".concat(context,"/metallicRoughnessTexture"),properties.metallicRoughnessTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Metallic Roughness)");babylonMaterial.metallicTexture=texture;}));babylonMaterial.useMetallnessFromMetallicTextureBlue=true;babylonMaterial.useRoughnessFromMetallicTextureGreen=true;babylonMaterial.useRoughnessFromMetallicTextureAlpha=false;}}return Promise.all(promises).then(function(){});}},{key:"_loadMaterialAsync",value:function _loadMaterialAsync(context,material,babylonMesh,babylonDrawMode){var assign=arguments.length>4&&arguments[4]!==undefined?arguments[4]:function(){};var extensionPromise=this._extensionsLoadMaterialAsync(context,material,babylonMesh,babylonDrawMode,assign);if(extensionPromise){return extensionPromise;}material._data=material._data||{};var babylonData=material._data[babylonDrawMode];if(!babylonData){this.logOpen("".concat(context," ").concat(material.name||""));var babylonMaterial=this.createMaterial(context,material,babylonDrawMode);babylonData={babylonMaterial:babylonMaterial,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(context,material,babylonMaterial)};material._data[babylonDrawMode]=babylonData;GLTFLoader2.AddPointerMetadata(babylonMaterial,context);this._parent.onMaterialLoadedObservable.notifyObservers(babylonMaterial);this.logClose();}if(babylonMesh){babylonData.babylonMeshes.push(babylonMesh);babylonMesh.onDisposeObservable.addOnce(function(){var index=babylonData.babylonMeshes.indexOf(babylonMesh);if(index!==-1){babylonData.babylonMeshes.splice(index,1);}});}assign(babylonData.babylonMaterial);return babylonData.promise.then(function(){return babylonData.babylonMaterial;});}},{key:"_createDefaultMaterial",value:function _createDefaultMaterial(name135,babylonDrawMode){this._babylonScene._blockEntityCollection=!!this._assetContainer;var babylonMaterial=new PBRMaterial(name135,this._babylonScene);babylonMaterial._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;babylonMaterial.fillMode=babylonDrawMode;babylonMaterial.enableSpecularAntiAliasing=true;babylonMaterial.useRadianceOverAlpha=!this._parent.transparencyAsCoverage;babylonMaterial.useSpecularOverAlpha=!this._parent.transparencyAsCoverage;babylonMaterial.transparencyMode=PBRMaterial.PBRMATERIAL_OPAQUE;babylonMaterial.metallic=1;babylonMaterial.roughness=1;return babylonMaterial;}},{key:"createMaterial",value:function createMaterial(context,material,babylonDrawMode){var extensionPromise=this._extensionsCreateMaterial(context,material,babylonDrawMode);if(extensionPromise){return extensionPromise;}var name135=material.name||"material".concat(material.index);var babylonMaterial=this._createDefaultMaterial(name135,babylonDrawMode);return babylonMaterial;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var extensionPromise=this._extensionsLoadMaterialPropertiesAsync(context,material,babylonMaterial);if(extensionPromise){return extensionPromise;}var promises=new Array();promises.push(this.loadMaterialBasePropertiesAsync(context,material,babylonMaterial));if(material.pbrMetallicRoughness){promises.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(context,"/pbrMetallicRoughness"),material.pbrMetallicRoughness,babylonMaterial));}this.loadMaterialAlphaProperties(context,material,babylonMaterial);return Promise.all(promises).then(function(){});}},{key:"loadMaterialBasePropertiesAsync",value:function loadMaterialBasePropertiesAsync(context,material,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();babylonMaterial.emissiveColor=material.emissiveFactor?Color3.FromArray(material.emissiveFactor):new Color3(0,0,0);if(material.doubleSided){babylonMaterial.backFaceCulling=false;babylonMaterial.twoSidedLighting=true;}if(material.normalTexture){material.normalTexture.nonColorData=true;promises.push(this.loadTextureInfoAsync("".concat(context,"/normalTexture"),material.normalTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Normal)");babylonMaterial.bumpTexture=texture;}));babylonMaterial.invertNormalMapX=!this._babylonScene.useRightHandedSystem;babylonMaterial.invertNormalMapY=this._babylonScene.useRightHandedSystem;if(material.normalTexture.scale!=void 0&&babylonMaterial.bumpTexture){babylonMaterial.bumpTexture.level=material.normalTexture.scale;}babylonMaterial.forceIrradianceInFragment=true;}if(material.occlusionTexture){material.occlusionTexture.nonColorData=true;promises.push(this.loadTextureInfoAsync("".concat(context,"/occlusionTexture"),material.occlusionTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Occlusion)");babylonMaterial.ambientTexture=texture;}));babylonMaterial.useAmbientInGrayScale=true;if(material.occlusionTexture.strength!=void 0){babylonMaterial.ambientTextureStrength=material.occlusionTexture.strength;}}if(material.emissiveTexture){promises.push(this.loadTextureInfoAsync("".concat(context,"/emissiveTexture"),material.emissiveTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Emissive)");babylonMaterial.emissiveTexture=texture;}));}return Promise.all(promises).then(function(){});}},{key:"loadMaterialAlphaProperties",value:function loadMaterialAlphaProperties(context,material,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var alphaMode=material.alphaMode||"OPAQUE";switch(alphaMode){case"OPAQUE":{babylonMaterial.transparencyMode=PBRMaterial.PBRMATERIAL_OPAQUE;break;}case"MASK":{babylonMaterial.transparencyMode=PBRMaterial.PBRMATERIAL_ALPHATEST;babylonMaterial.alphaCutOff=material.alphaCutoff==void 0?0.5:material.alphaCutoff;if(babylonMaterial.albedoTexture){babylonMaterial.albedoTexture.hasAlpha=true;}break;}case"BLEND":{babylonMaterial.transparencyMode=PBRMaterial.PBRMATERIAL_ALPHABLEND;if(babylonMaterial.albedoTexture){babylonMaterial.albedoTexture.hasAlpha=true;babylonMaterial.useAlphaFromAlbedoTexture=true;}break;}default:{throw new Error("".concat(context,"/alphaMode: Invalid value (").concat(material.alphaMode,")"));}}}},{key:"loadTextureInfoAsync",value:function loadTextureInfoAsync(context,textureInfo){var _this201=this;var assign=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var extensionPromise=this._extensionsLoadTextureInfoAsync(context,textureInfo,assign);if(extensionPromise){return extensionPromise;}this.logOpen("".concat(context));if(textureInfo.texCoord>=6){throw new Error("".concat(context,"/texCoord: Invalid value (").concat(textureInfo.texCoord,")"));}var texture=ArrayItem.Get("".concat(context,"/index"),this._gltf.textures,textureInfo.index);texture._textureInfo=textureInfo;var promise=this._loadTextureAsync("/textures/".concat(textureInfo.index),texture,function(babylonTexture){babylonTexture.coordinatesIndex=textureInfo.texCoord||0;GLTFLoader2.AddPointerMetadata(babylonTexture,context);_this201._parent.onTextureLoadedObservable.notifyObservers(babylonTexture);assign(babylonTexture);});this.logClose();return promise;}},{key:"_loadTextureAsync",value:function _loadTextureAsync(context,texture){var assign=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var extensionPromise=this._extensionsLoadTextureAsync(context,texture,assign);if(extensionPromise){return extensionPromise;}this.logOpen("".concat(context," ").concat(texture.name||""));var sampler=texture.sampler==void 0?GLTFLoader2.DefaultSampler:ArrayItem.Get("".concat(context,"/sampler"),this._gltf.samplers,texture.sampler);var image=ArrayItem.Get("".concat(context,"/source"),this._gltf.images,texture.source);var promise=this._createTextureAsync(context,sampler,image,assign,void 0,!texture._textureInfo.nonColorData);this.logClose();return promise;}},{key:"_createTextureAsync",value:function _createTextureAsync(context,sampler,image){var _this202=this;var assign=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(){};var textureLoaderOptions=arguments.length>4?arguments[4]:undefined;var useSRGBBuffer=arguments.length>5?arguments[5]:undefined;var samplerData=this._loadSampler("/samplers/".concat(sampler.index),sampler);var promises=new Array();var deferred=new Deferred();this._babylonScene._blockEntityCollection=!!this._assetContainer;var textureCreationOptions={noMipmap:samplerData.noMipMaps,invertY:false,samplingMode:samplerData.samplingMode,onLoad:function onLoad(){if(!_this202._disposed){deferred.resolve();}},onError:function onError(message,exception){if(!_this202._disposed){deferred.reject(new Error("".concat(context,": ").concat(exception&&exception.message?exception.message:message||"Failed to load texture")));}},mimeType:image.mimeType,loaderOptions:textureLoaderOptions,useSRGBBuffer:!!useSRGBBuffer&&this._parent.useSRGBBuffers};var babylonTexture=new Texture(null,this._babylonScene,textureCreationOptions);babylonTexture._parentContainer=this._assetContainer;this._babylonScene._blockEntityCollection=false;promises.push(deferred.promise);promises.push(this.loadImageAsync("/images/".concat(image.index),image).then(function(data){var name135=image.uri||"".concat(_this202._fileName,"#image").concat(image.index);var dataUrl="data:".concat(_this202._uniqueRootUrl).concat(name135);babylonTexture.updateURL(dataUrl,data);}));babylonTexture.wrapU=samplerData.wrapU;babylonTexture.wrapV=samplerData.wrapV;assign(babylonTexture);return Promise.all(promises).then(function(){return babylonTexture;});}},{key:"_loadSampler",value:function _loadSampler(context,sampler){if(!sampler._data){sampler._data={noMipMaps:sampler.minFilter===9728||sampler.minFilter===9729,samplingMode:GLTFLoader2._GetTextureSamplingMode(context,sampler),wrapU:GLTFLoader2._GetTextureWrapMode("".concat(context,"/wrapS"),sampler.wrapS),wrapV:GLTFLoader2._GetTextureWrapMode("".concat(context,"/wrapT"),sampler.wrapT)};}return sampler._data;}},{key:"loadImageAsync",value:function loadImageAsync(context,image){if(!image._data){this.logOpen("".concat(context," ").concat(image.name||""));if(image.uri){image._data=this.loadUriAsync("".concat(context,"/uri"),image,image.uri);}else{var bufferView=ArrayItem.Get("".concat(context,"/bufferView"),this._gltf.bufferViews,image.bufferView);image._data=this.loadBufferViewAsync("/bufferViews/".concat(bufferView.index),bufferView);}this.logClose();}return image._data;}},{key:"loadUriAsync",value:function loadUriAsync(context,property,uri){var _this203=this;var extensionPromise=this._extensionsLoadUriAsync(context,property,uri);if(extensionPromise){return extensionPromise;}if(!GLTFLoader2._ValidateUri(uri)){throw new Error("".concat(context,": '").concat(uri,"' is invalid"));}if(IsBase64DataUrl(uri)){var data=new Uint8Array(DecodeBase64UrlToBinary(uri));this.log("".concat(context,": Decoded ").concat(uri.substr(0,64),"... (").concat(data.length," bytes)"));return Promise.resolve(data);}this.log("".concat(context,": Loading ").concat(uri));return this._parent.preprocessUrlAsync(this._rootUrl+uri).then(function(url){return new Promise(function(resolve,reject){_this203._parent._loadFile(_this203._babylonScene,url,function(data){if(!_this203._disposed){_this203.log("".concat(context,": Loaded ").concat(uri," (").concat(data.byteLength," bytes)"));resolve(new Uint8Array(data));}},true,function(request){reject(new LoadFileError("".concat(context,": Failed to load '").concat(uri,"'").concat(request?": "+request.status+" "+request.statusText:""),request));});});});}},{key:"_compileMaterialsAsync",value:function _compileMaterialsAsync(){var _this204=this;this._parent._startPerformanceCounter("Compile materials");var promises=new Array();if(this._gltf.materials){var _iterator222=_createForOfIteratorHelper(this._gltf.materials),_step235;try{for(_iterator222.s();!(_step235=_iterator222.n()).done;){var material=_step235.value;if(material._data){for(var babylonDrawMode in material._data){var babylonData=material._data[babylonDrawMode];var _iterator223=_createForOfIteratorHelper(babylonData.babylonMeshes),_step236;try{for(_iterator223.s();!(_step236=_iterator223.n()).done;){var babylonMesh=_step236.value;babylonMesh.computeWorldMatrix(true);var babylonMaterial=babylonData.babylonMaterial;promises.push(babylonMaterial.forceCompilationAsync(babylonMesh));promises.push(babylonMaterial.forceCompilationAsync(babylonMesh,{useInstances:true}));if(this._parent.useClipPlane){promises.push(babylonMaterial.forceCompilationAsync(babylonMesh,{clipPlane:true}));promises.push(babylonMaterial.forceCompilationAsync(babylonMesh,{clipPlane:true,useInstances:true}));}}}catch(err){_iterator223.e(err);}finally{_iterator223.f();}}}}}catch(err){_iterator222.e(err);}finally{_iterator222.f();}}return Promise.all(promises).then(function(){_this204._parent._endPerformanceCounter("Compile materials");});}},{key:"_compileShadowGeneratorsAsync",value:function _compileShadowGeneratorsAsync(){var _this205=this;this._parent._startPerformanceCounter("Compile shadow generators");var promises=new Array();var lights=this._babylonScene.lights;var _iterator224=_createForOfIteratorHelper(lights),_step237;try{for(_iterator224.s();!(_step237=_iterator224.n()).done;){var light=_step237.value;var generator=light.getShadowGenerator();if(generator){promises.push(generator.forceCompilationAsync());}}}catch(err){_iterator224.e(err);}finally{_iterator224.f();}return Promise.all(promises).then(function(){_this205._parent._endPerformanceCounter("Compile shadow generators");});}},{key:"_forEachExtensions",value:function _forEachExtensions(action){var _iterator225=_createForOfIteratorHelper(this._extensions),_step238;try{for(_iterator225.s();!(_step238=_iterator225.n()).done;){var extension=_step238.value;if(extension.enabled){action(extension);}}}catch(err){_iterator225.e(err);}finally{_iterator225.f();}}},{key:"_applyExtensions",value:function _applyExtensions(property,functionName,actionAsync){var _iterator226=_createForOfIteratorHelper(this._extensions),_step239;try{for(_iterator226.s();!(_step239=_iterator226.n()).done;){var extension=_step239.value;if(extension.enabled){var id="".concat(extension.name,".").concat(functionName);var loaderProperty=property;loaderProperty._activeLoaderExtensionFunctions=loaderProperty._activeLoaderExtensionFunctions||{};var activeLoaderExtensionFunctions=loaderProperty._activeLoaderExtensionFunctions;if(!activeLoaderExtensionFunctions[id]){activeLoaderExtensionFunctions[id]=true;try{var result=actionAsync(extension);if(result){return result;}}finally{delete activeLoaderExtensionFunctions[id];}}}}}catch(err){_iterator226.e(err);}finally{_iterator226.f();}return null;}},{key:"_extensionsOnLoading",value:function _extensionsOnLoading(){this._forEachExtensions(function(extension){return extension.onLoading&&extension.onLoading();});}},{key:"_extensionsOnReady",value:function _extensionsOnReady(){this._forEachExtensions(function(extension){return extension.onReady&&extension.onReady();});}},{key:"_extensionsLoadSceneAsync",value:function _extensionsLoadSceneAsync(context,scene2){return this._applyExtensions(scene2,"loadScene",function(extension){return extension.loadSceneAsync&&extension.loadSceneAsync(context,scene2);});}},{key:"_extensionsLoadNodeAsync",value:function _extensionsLoadNodeAsync(context,node,assign){return this._applyExtensions(node,"loadNode",function(extension){return extension.loadNodeAsync&&extension.loadNodeAsync(context,node,assign);});}},{key:"_extensionsLoadCameraAsync",value:function _extensionsLoadCameraAsync(context,camera,assign){return this._applyExtensions(camera,"loadCamera",function(extension){return extension.loadCameraAsync&&extension.loadCameraAsync(context,camera,assign);});}},{key:"_extensionsLoadVertexDataAsync",value:function _extensionsLoadVertexDataAsync(context,primitive,babylonMesh){return this._applyExtensions(primitive,"loadVertexData",function(extension){return extension._loadVertexDataAsync&&extension._loadVertexDataAsync(context,primitive,babylonMesh);});}},{key:"_extensionsLoadMeshPrimitiveAsync",value:function _extensionsLoadMeshPrimitiveAsync(context,name135,node,mesh,primitive,assign){return this._applyExtensions(primitive,"loadMeshPrimitive",function(extension){return extension._loadMeshPrimitiveAsync&&extension._loadMeshPrimitiveAsync(context,name135,node,mesh,primitive,assign);});}},{key:"_extensionsLoadMaterialAsync",value:function _extensionsLoadMaterialAsync(context,material,babylonMesh,babylonDrawMode,assign){return this._applyExtensions(material,"loadMaterial",function(extension){return extension._loadMaterialAsync&&extension._loadMaterialAsync(context,material,babylonMesh,babylonDrawMode,assign);});}},{key:"_extensionsCreateMaterial",value:function _extensionsCreateMaterial(context,material,babylonDrawMode){return this._applyExtensions(material,"createMaterial",function(extension){return extension.createMaterial&&extension.createMaterial(context,material,babylonDrawMode);});}},{key:"_extensionsLoadMaterialPropertiesAsync",value:function _extensionsLoadMaterialPropertiesAsync(context,material,babylonMaterial){return this._applyExtensions(material,"loadMaterialProperties",function(extension){return extension.loadMaterialPropertiesAsync&&extension.loadMaterialPropertiesAsync(context,material,babylonMaterial);});}},{key:"_extensionsLoadTextureInfoAsync",value:function _extensionsLoadTextureInfoAsync(context,textureInfo,assign){return this._applyExtensions(textureInfo,"loadTextureInfo",function(extension){return extension.loadTextureInfoAsync&&extension.loadTextureInfoAsync(context,textureInfo,assign);});}},{key:"_extensionsLoadTextureAsync",value:function _extensionsLoadTextureAsync(context,texture,assign){return this._applyExtensions(texture,"loadTexture",function(extension){return extension._loadTextureAsync&&extension._loadTextureAsync(context,texture,assign);});}},{key:"_extensionsLoadAnimationAsync",value:function _extensionsLoadAnimationAsync(context,animation){return this._applyExtensions(animation,"loadAnimation",function(extension){return extension.loadAnimationAsync&&extension.loadAnimationAsync(context,animation);});}},{key:"_extensionsLoadAnimationChannelAsync",value:function _extensionsLoadAnimationChannelAsync(context,animationContext,animation,channel,onLoad){return this._applyExtensions(animation,"loadAnimationChannel",function(extension){return extension._loadAnimationChannelAsync&&extension._loadAnimationChannelAsync(context,animationContext,animation,channel,onLoad);});}},{key:"_extensionsLoadSkinAsync",value:function _extensionsLoadSkinAsync(context,node,skin){return this._applyExtensions(skin,"loadSkin",function(extension){return extension._loadSkinAsync&&extension._loadSkinAsync(context,node,skin);});}},{key:"_extensionsLoadUriAsync",value:function _extensionsLoadUriAsync(context,property,uri){return this._applyExtensions(property,"loadUri",function(extension){return extension._loadUriAsync&&extension._loadUriAsync(context,property,uri);});}},{key:"_extensionsLoadBufferViewAsync",value:function _extensionsLoadBufferViewAsync(context,bufferView){return this._applyExtensions(bufferView,"loadBufferView",function(extension){return extension.loadBufferViewAsync&&extension.loadBufferViewAsync(context,bufferView);});}},{key:"_extensionsLoadBufferAsync",value:function _extensionsLoadBufferAsync(context,buffer,byteOffset,byteLength){return this._applyExtensions(buffer,"loadBuffer",function(extension){return extension.loadBufferAsync&&extension.loadBufferAsync(context,buffer,byteOffset,byteLength);});}},{key:"isExtensionUsed",value:function isExtensionUsed(name135){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(name135)!==-1;}},{key:"logOpen",value:function logOpen(message){this._parent._logOpen(message);}},{key:"logClose",value:function logClose(){this._parent._logClose();}},{key:"log",value:function log(message){this._parent._log(message);}},{key:"startPerformanceCounter",value:function startPerformanceCounter(counterName){this._parent._startPerformanceCounter(counterName);}},{key:"endPerformanceCounter",value:function endPerformanceCounter(counterName){this._parent._endPerformanceCounter(counterName);}}],[{key:"RegisterExtension",value:function RegisterExtension(name135,factory){if(GLTFLoader2.UnregisterExtension(name135)){Logger.Warn("Extension with the name '".concat(name135,"' already exists"));}GLTFLoader2._RegisteredExtensions[name135]={factory:factory};}},{key:"UnregisterExtension",value:function UnregisterExtension(name135){if(!GLTFLoader2._RegisteredExtensions[name135]){return false;}delete GLTFLoader2._RegisteredExtensions[name135];return true;}},{key:"_LoadTransform",value:function _LoadTransform(node,babylonNode){if(node.skin!=void 0){return;}var position=Vector3.Zero();var rotation=Quaternion.Identity();var scaling=Vector3.One();if(node.matrix){var matrix=Matrix.FromArray(node.matrix);matrix.decompose(scaling,rotation,position);}else{if(node.translation){position=Vector3.FromArray(node.translation);}if(node.rotation){rotation=Quaternion.FromArray(node.rotation);}if(node.scale){scaling=Vector3.FromArray(node.scale);}}babylonNode.position=position;babylonNode.rotationQuaternion=rotation;babylonNode.scaling=scaling;}},{key:"AddPointerMetadata",value:function AddPointerMetadata(babylonObject,pointer){babylonObject.metadata=babylonObject.metadata||{};var metadata=babylonObject._internalMetadata=babylonObject._internalMetadata||{};var gltf=metadata.gltf=metadata.gltf||{};var pointers=gltf.pointers=gltf.pointers||[];pointers.push(pointer);}},{key:"_GetTextureWrapMode",value:function _GetTextureWrapMode(context,mode){mode=mode==void 0?10497:mode;switch(mode){case 33071:return Texture.CLAMP_ADDRESSMODE;case 33648:return Texture.MIRROR_ADDRESSMODE;case 10497:return Texture.WRAP_ADDRESSMODE;default:Logger.Warn("".concat(context,": Invalid value (").concat(mode,")"));return Texture.WRAP_ADDRESSMODE;}}},{key:"_GetTextureSamplingMode",value:function _GetTextureSamplingMode(context,sampler){var magFilter=sampler.magFilter==void 0?9729:sampler.magFilter;var minFilter=sampler.minFilter==void 0?9987:sampler.minFilter;if(magFilter===9729){switch(minFilter){case 9728:return Texture.LINEAR_NEAREST;case 9729:return Texture.LINEAR_LINEAR;case 9984:return Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return Texture.LINEAR_LINEAR_MIPLINEAR;default:Logger.Warn("".concat(context,"/minFilter: Invalid value (").concat(minFilter,")"));return Texture.LINEAR_LINEAR_MIPLINEAR;}}else{if(magFilter!==9728){Logger.Warn("".concat(context,"/magFilter: Invalid value (").concat(magFilter,")"));}switch(minFilter){case 9728:return Texture.NEAREST_NEAREST;case 9729:return Texture.NEAREST_LINEAR;case 9984:return Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return Texture.NEAREST_LINEAR_MIPLINEAR;default:Logger.Warn("".concat(context,"/minFilter: Invalid value (").concat(minFilter,")"));return Texture.NEAREST_NEAREST_MIPNEAREST;}}}},{key:"_GetTypedArrayConstructor",value:function _GetTypedArrayConstructor(context,componentType){switch(componentType){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("".concat(context,": Invalid component type ").concat(componentType));}}},{key:"_GetTypedArray",value:function _GetTypedArray(context,componentType,bufferView,byteOffset,length){var buffer=bufferView.buffer;byteOffset=bufferView.byteOffset+(byteOffset||0);var constructor=GLTFLoader2._GetTypedArrayConstructor("".concat(context,"/componentType"),componentType);var componentTypeLength=VertexBuffer.GetTypeByteLength(componentType);if(byteOffset%componentTypeLength!==0){Logger.Warn("".concat(context,": Copying buffer as byte offset (").concat(byteOffset,") is not a multiple of component type byte length (").concat(componentTypeLength,")"));return new constructor(buffer.slice(byteOffset,byteOffset+length*componentTypeLength),0);}return new constructor(buffer,byteOffset,length);}},{key:"_GetNumComponents",value:function _GetNumComponents(context,type){switch(type){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;}throw new Error("".concat(context,": Invalid type (").concat(type,")"));}},{key:"_ValidateUri",value:function _ValidateUri(uri){return Tools.IsBase64(uri)||uri.indexOf("..")===-1;}},{key:"_GetDrawMode",value:function _GetDrawMode(context,mode){if(mode==void 0){mode=4;}switch(mode){case 0:return Material.PointListDrawMode;case 1:return Material.LineListDrawMode;case 2:return Material.LineLoopDrawMode;case 3:return Material.LineStripDrawMode;case 4:return Material.TriangleFillMode;case 5:return Material.TriangleStripDrawMode;case 6:return Material.TriangleFanDrawMode;}throw new Error("".concat(context,": Invalid mesh primitive mode (").concat(mode,")"));}},{key:"LoadExtensionAsync",value:function LoadExtensionAsync(context,property,extensionName,actionAsync){if(!property.extensions){return null;}var extensions=property.extensions;var extension=extensions[extensionName];if(!extension){return null;}return actionAsync("".concat(context,"/extensions/").concat(extensionName),extension);}},{key:"LoadExtraAsync",value:function LoadExtraAsync(context,property,extensionName,actionAsync){if(!property.extras){return null;}var extras=property.extras;var extra=extras[extensionName];if(!extra){return null;}return actionAsync("".concat(context,"/extras/").concat(extensionName),extra);}}]);return GLTFLoader2;}();GLTFLoader2._RegisteredExtensions={};GLTFLoader2.DefaultSampler={index:-1};GLTFFileLoader._CreateGLTF2Loader=function(parent){return new GLTFLoader2(parent);};// node_modules/@babylonjs/core/Shaders/rgbdEncode.fragment.js
var name105="rgbdEncodePixelShader";var shader105="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#include<helperFunctions>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) \n{\ngl_FragColor=toRGBD(texture2D(textureSampler,vUV).rgb);\n}";ShaderStore.ShadersStore[name105]=shader105;// node_modules/@babylonjs/core/Misc/environmentTextureTools.js
var DefaultEnvironmentTextureImageType="image/png";function _OnImageReadyAsync(image,engine,expandTexture,rgbdPostProcess,url,face,i,generateNonLODTextures,lodTextures,cubeRtt,texture){return new Promise(function(resolve,reject){if(expandTexture){var tempTexture=engine.createTexture(null,true,true,null,1,null,function(message){reject(message);},image);rgbdPostProcess.getEffect().executeWhenCompiled(function(){rgbdPostProcess.externalTextureSamplerBinding=true;rgbdPostProcess.onApply=function(effect){effect._bindTexture("textureSampler",tempTexture);effect.setFloat2("scale",1,engine._features.needsInvertingBitmap&&image instanceof ImageBitmap?-1:1);};if(!engine.scenes.length){return;}engine.scenes[0].postProcessManager.directRender([rgbdPostProcess],cubeRtt,true,face,i);engine.restoreDefaultFramebuffer();tempTexture.dispose();URL.revokeObjectURL(url);resolve();});}else{engine._uploadImageToTexture(texture,image,face,i);if(generateNonLODTextures){var lodTexture=lodTextures[i];if(lodTexture){engine._uploadImageToTexture(lodTexture._texture,image,face,0);}}resolve();}});}function UploadLevelsAsync(texture,imageData){var imageType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:DefaultEnvironmentTextureImageType;if(!Tools.IsExponentOfTwo(texture.width)){throw new Error("Texture size must be a power of two");}var mipmapsCount=Scalar.ILog2(texture.width)+1;var engine=texture.getEngine();var expandTexture=false;var generateNonLODTextures=false;var rgbdPostProcess=null;var cubeRtt=null;var lodTextures=null;var caps=engine.getCaps();texture.format=5;texture.type=0;texture.generateMipMaps=true;texture._cachedAnisotropicFilteringLevel=null;engine.updateTextureSamplingMode(3,texture);if(!caps.textureLOD){expandTexture=false;generateNonLODTextures=true;lodTextures={};}else if(!engine._features.supportRenderAndCopyToLodForFloatTextures){expandTexture=false;}else if(caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering){expandTexture=true;texture.type=2;}else if(caps.textureFloatRender&&caps.textureFloatLinearFiltering){expandTexture=true;texture.type=1;}if(expandTexture){rgbdPostProcess=new PostProcess("rgbdDecode","rgbdDecode",null,null,1,null,3,engine,false,void 0,texture.type,void 0,null,false);texture._isRGBD=false;texture.invertY=false;cubeRtt=engine.createRenderTargetCubeTexture(texture.width,{generateDepthBuffer:false,generateMipMaps:true,generateStencilBuffer:false,samplingMode:3,type:texture.type,format:5});}else{texture._isRGBD=true;texture.invertY=true;if(generateNonLODTextures){var mipSlices=3;var scale=texture._lodGenerationScale;var offset=texture._lodGenerationOffset;for(var i=0;i<mipSlices;i++){var smoothness=i/(mipSlices-1);var roughness=1-smoothness;var minLODIndex=offset;var maxLODIndex=(mipmapsCount-1)*scale+offset;var lodIndex=minLODIndex+(maxLODIndex-minLODIndex)*roughness;var mipmapIndex=Math.round(Math.min(Math.max(lodIndex,0),maxLODIndex));var glTextureFromLod=new InternalTexture(engine,InternalTextureSource.Temp);glTextureFromLod.isCube=true;glTextureFromLod.invertY=true;glTextureFromLod.generateMipMaps=false;engine.updateTextureSamplingMode(2,glTextureFromLod);var lodTexture=new BaseTexture(null);lodTexture._isCube=true;lodTexture._texture=glTextureFromLod;lodTextures[mipmapIndex]=lodTexture;switch(i){case 0:texture._lodTextureLow=lodTexture;break;case 1:texture._lodTextureMid=lodTexture;break;case 2:texture._lodTextureHigh=lodTexture;break;}}}}var promises=[];var _loop11=function _loop11(_i33){var _loop12=function _loop12(_face){var bytes=imageData[_i33][_face];var blob=new Blob([bytes],{type:imageType});var url=URL.createObjectURL(blob);var promise;if(typeof Image==="undefined"||engine._features.forceBitmapOverHTMLImageElement){promise=engine.createImageBitmap(blob,{premultiplyAlpha:"none"}).then(function(img){return _OnImageReadyAsync(img,engine,expandTexture,rgbdPostProcess,url,_face,_i33,generateNonLODTextures,lodTextures,cubeRtt,texture);});}else{var image=new Image();image.src=url;promise=new Promise(function(resolve,reject){image.onload=function(){_OnImageReadyAsync(image,engine,expandTexture,rgbdPostProcess,url,_face,_i33,generateNonLODTextures,lodTextures,cubeRtt,texture).then(function(){return resolve();})["catch"](function(reason){reject(reason);});};image.onerror=function(error){reject(error);};});}promises.push(promise);};for(var _face=0;_face<6;_face++){_loop12(_face);}};for(var _i33=0;_i33<imageData.length;_i33++){_loop11(_i33);}if(imageData.length<mipmapsCount){var data;var size=Math.pow(2,mipmapsCount-1-imageData.length);var dataLength=size*size*4;switch(texture.type){case 0:{data=new Uint8Array(dataLength);break;}case 2:{data=new Uint16Array(dataLength);break;}case 1:{data=new Float32Array(dataLength);break;}}for(var _i34=imageData.length;_i34<mipmapsCount;_i34++){for(var face=0;face<6;face++){engine._uploadArrayBufferViewToTexture(texture,data,face,_i34);}}}return Promise.all(promises).then(function(){if(cubeRtt){engine._releaseTexture(texture);cubeRtt._swapAndDie(texture);}if(rgbdPostProcess){rgbdPostProcess.dispose();}if(generateNonLODTextures){if(texture._lodTextureHigh&&texture._lodTextureHigh._texture){texture._lodTextureHigh._texture.isReady=true;}if(texture._lodTextureMid&&texture._lodTextureMid._texture){texture._lodTextureMid._texture.isReady=true;}if(texture._lodTextureLow&&texture._lodTextureLow._texture){texture._lodTextureLow._texture.isReady=true;}}});}function _UpdateRGBDAsync(internalTexture,data,sphericalPolynomial,lodScale,lodOffset){var proxy=internalTexture.getEngine().createRawCubeTexture(null,internalTexture.width,internalTexture.format,internalTexture.type,internalTexture.generateMipMaps,internalTexture.invertY,internalTexture.samplingMode,internalTexture._compression);var proxyPromise=UploadLevelsAsync(proxy,data).then(function(){return internalTexture;});internalTexture.onRebuildCallback=function(_internalTexture){return{proxy:proxyPromise,isReady:true,isAsync:true};};internalTexture._source=InternalTextureSource.CubeRawRGBD;internalTexture._bufferViewArrayArray=data;internalTexture._lodGenerationScale=lodScale;internalTexture._lodGenerationOffset=lodOffset;internalTexture._sphericalPolynomial=sphericalPolynomial;return UploadLevelsAsync(internalTexture,data).then(function(){internalTexture.isReady=true;return internalTexture;});}// node_modules/@babylonjs/core/Engines/Extensions/engine.cubeTexture.js
ThinEngine.prototype._createDepthStencilCubeTexture=function(size,options,rtWrapper){var internalTexture=new InternalTexture(this,InternalTextureSource.DepthStencil);internalTexture.isCube=true;if(this.webGLVersion===1){Logger.Error("Depth cube texture is not supported by WebGL 1.");return internalTexture;}var internalOptions=_objectSpread({bilinearFiltering:false,comparisonFunction:0,generateStencil:false},options);var gl=this._gl;this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,internalTexture,true);this._setupDepthStencilTexture(internalTexture,size,internalOptions.generateStencil,internalOptions.bilinearFiltering,internalOptions.comparisonFunction);rtWrapper._depthStencilTexture=internalTexture;rtWrapper._depthStencilTextureWithStencil=internalOptions.generateStencil;for(var face=0;face<6;face++){if(internalOptions.generateStencil){gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+face,0,gl.DEPTH24_STENCIL8,size,size,0,gl.DEPTH_STENCIL,gl.UNSIGNED_INT_24_8,null);}else{gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X+face,0,gl.DEPTH_COMPONENT24,size,size,0,gl.DEPTH_COMPONENT,gl.UNSIGNED_INT,null);}}this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);this._internalTexturesCache.push(internalTexture);return internalTexture;};ThinEngine.prototype._partialLoadFile=function(url,index,loadedFiles,onfinish){var onErrorCallBack=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onload=function onload(data){loadedFiles[index]=data;loadedFiles._internalCount++;if(loadedFiles._internalCount===6){onfinish(loadedFiles);}};var onerror=function onerror(request,exception){if(onErrorCallBack&&request){onErrorCallBack(request.status+" "+request.statusText,exception);}};this._loadFile(url,onload,void 0,void 0,true,onerror);};ThinEngine.prototype._cascadeLoadFiles=function(scene2,onfinish,files){var onError=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var loadedFiles=[];loadedFiles._internalCount=0;for(var index=0;index<6;index++){this._partialLoadFile(files[index],index,loadedFiles,onfinish,onError);}};ThinEngine.prototype._cascadeLoadImgs=function(scene2,texture,onfinish,files){var onError=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var mimeType=arguments.length>5?arguments[5]:undefined;var loadedImages=[];loadedImages._internalCount=0;for(var index=0;index<6;index++){this._partialLoadImg(files[index],index,loadedImages,scene2,texture,onfinish,onError,mimeType);}};ThinEngine.prototype._partialLoadImg=function(url,index,loadedImages,scene2,texture,onfinish){var onErrorCallBack=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var mimeType=arguments.length>7?arguments[7]:undefined;var tokenPendingData=RandomGUID();var onload=function onload(img){loadedImages[index]=img;loadedImages._internalCount++;if(scene2){scene2.removePendingData(tokenPendingData);}if(loadedImages._internalCount===6&&onfinish){onfinish(texture,loadedImages);}};var onerror=function onerror(message,exception){if(scene2){scene2.removePendingData(tokenPendingData);}if(onErrorCallBack){onErrorCallBack(message,exception);}};_LoadImage(url,onload,onerror,scene2?scene2.offlineProvider:null,mimeType);if(scene2){scene2.addPendingData(tokenPendingData);}};ThinEngine.prototype._setCubeMapTextureParams=function(texture,loadMipmap,maxLevel){var gl=this._gl;gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MIN_FILTER,loadMipmap?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);texture.samplingMode=loadMipmap?3:2;if(loadMipmap&&this.getCaps().textureMaxLevel&&maxLevel!==void 0&&maxLevel>0){gl.texParameteri(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_MAX_LEVEL,maxLevel);texture._maxLodLevel=maxLevel;}this._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,null);};ThinEngine.prototype.createCubeTextureBase=function(rootUrl,scene2,files,noMipmap){var _this206=this;var onLoad=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onError=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var format=arguments.length>6?arguments[6]:undefined;var forcedExtension=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var createPolynomials=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var lodScale=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var lodOffset=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var fallback=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var beforeLoadCubeDataCallback=arguments.length>12&&arguments[12]!==undefined?arguments[12]:null;var imageHandler=arguments.length>13&&arguments[13]!==undefined?arguments[13]:null;var useSRGBBuffer=arguments.length>14&&arguments[14]!==undefined?arguments[14]:false;var texture=fallback?fallback:new InternalTexture(this,InternalTextureSource.Cube);texture.isCube=true;texture.url=rootUrl;texture.generateMipMaps=!noMipmap;texture._lodGenerationScale=lodScale;texture._lodGenerationOffset=lodOffset;texture._useSRGBBuffer=!!useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||!!noMipmap);if(!this._doNotHandleContextLost){texture._extension=forcedExtension;texture._files=files;}var originalRootUrl=rootUrl;if(this._transformTextureUrl&&!fallback){rootUrl=this._transformTextureUrl(rootUrl);}var rootUrlWithoutUriParams=rootUrl.split("?")[0];var lastDot=rootUrlWithoutUriParams.lastIndexOf(".");var extension=forcedExtension?forcedExtension:lastDot>-1?rootUrlWithoutUriParams.substring(lastDot).toLowerCase():"";var loader=null;var _iterator227=_createForOfIteratorHelper(ThinEngine._TextureLoaders),_step240;try{for(_iterator227.s();!(_step240=_iterator227.n()).done;){var availableLoader=_step240.value;if(availableLoader.canLoad(extension)){loader=availableLoader;break;}}}catch(err){_iterator227.e(err);}finally{_iterator227.f();}var onInternalError=function onInternalError(request,exception){if(rootUrl===originalRootUrl){if(onError&&request){onError(request.status+" "+request.statusText,exception);}}else{Logger.Warn("Failed to load ".concat(rootUrl,", falling back to the ").concat(originalRootUrl));_this206.createCubeTextureBase(originalRootUrl,scene2,files,!!noMipmap,onLoad,onError,format,forcedExtension,createPolynomials,lodScale,lodOffset,texture,beforeLoadCubeDataCallback,imageHandler,useSRGBBuffer);}};if(loader){var onloaddata=function onloaddata(data){if(beforeLoadCubeDataCallback){beforeLoadCubeDataCallback(texture,data);}loader.loadCubeData(data,texture,createPolynomials,onLoad,onError);};if(files&&files.length===6){if(loader.supportCascades){this._cascadeLoadFiles(scene2,function(images){return onloaddata(images.map(function(image){return new Uint8Array(image);}));},files,onError);}else{if(onError){onError("Textures type does not support cascades.");}else{Logger.Warn("Texture loader does not support cascades.");}}}else{this._loadFile(rootUrl,function(data){return onloaddata(new Uint8Array(data));},void 0,void 0,true,onInternalError);}}else{if(!files){throw new Error("Cannot load cubemap because files were not defined");}this._cascadeLoadImgs(scene2,texture,function(texture2,imgs){if(imageHandler){imageHandler(texture2,imgs);}},files,onError);}this._internalTexturesCache.push(texture);return texture;};ThinEngine.prototype.createCubeTexture=function(rootUrl,scene2,files,noMipmap){var _this207=this;var onLoad=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onError=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var format=arguments.length>6?arguments[6]:undefined;var forcedExtension=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;var createPolynomials=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var lodScale=arguments.length>9&&arguments[9]!==undefined?arguments[9]:0;var lodOffset=arguments.length>10&&arguments[10]!==undefined?arguments[10]:0;var fallback=arguments.length>11&&arguments[11]!==undefined?arguments[11]:null;var loaderOptions=arguments.length>12?arguments[12]:undefined;var useSRGBBuffer=arguments.length>13&&arguments[13]!==undefined?arguments[13]:false;var gl=this._gl;return this.createCubeTextureBase(rootUrl,scene2,files,!!noMipmap,onLoad,onError,format,forcedExtension,createPolynomials,lodScale,lodOffset,fallback,function(texture){return _this207._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);},function(texture,imgs){var width=_this207.needPOTTextures?ThinEngine.GetExponentOfTwo(imgs[0].width,_this207._caps.maxCubemapTextureSize):imgs[0].width;var height=width;var faces=[gl.TEXTURE_CUBE_MAP_POSITIVE_X,gl.TEXTURE_CUBE_MAP_POSITIVE_Y,gl.TEXTURE_CUBE_MAP_POSITIVE_Z,gl.TEXTURE_CUBE_MAP_NEGATIVE_X,gl.TEXTURE_CUBE_MAP_NEGATIVE_Y,gl.TEXTURE_CUBE_MAP_NEGATIVE_Z];_this207._bindTextureDirectly(gl.TEXTURE_CUBE_MAP,texture,true);_this207._unpackFlipY(false);var internalFormat=format?_this207._getInternalFormat(format,texture._useSRGBBuffer):texture._useSRGBBuffer?gl.SRGB8_ALPHA8:gl.RGBA;var texelFormat=format?_this207._getInternalFormat(format):gl.RGBA;if(texture._useSRGBBuffer&&_this207.webGLVersion===1){texelFormat=internalFormat;}for(var index=0;index<faces.length;index++){if(imgs[index].width!==width||imgs[index].height!==height){_this207._prepareWorkingCanvas();if(!_this207._workingCanvas||!_this207._workingContext){Logger.Warn("Cannot create canvas to resize texture.");return;}_this207._workingCanvas.width=width;_this207._workingCanvas.height=height;_this207._workingContext.drawImage(imgs[index],0,0,imgs[index].width,imgs[index].height,0,0,width,height);gl.texImage2D(faces[index],0,internalFormat,texelFormat,gl.UNSIGNED_BYTE,_this207._workingCanvas);}else{gl.texImage2D(faces[index],0,internalFormat,texelFormat,gl.UNSIGNED_BYTE,imgs[index]);}}if(!noMipmap){gl.generateMipmap(gl.TEXTURE_CUBE_MAP);}_this207._setCubeMapTextureParams(texture,!noMipmap);texture.width=width;texture.height=height;texture.isReady=true;if(format){texture.format=format;}texture.onLoadedObservable.notifyObservers(texture);texture.onLoadedObservable.clear();if(onLoad){onLoad();}},!!useSRGBBuffer);};// node_modules/@babylonjs/core/Materials/Textures/cubeTexture.js
var CubeTexture=/*#__PURE__*/function(_BaseTexture2){_inherits(CubeTexture,_BaseTexture2);var _super72=_createSuper(CubeTexture);function CubeTexture(rootUrl,sceneOrEngine){var _this208;var extensions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var noMipmap=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var files=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var onLoad=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var onError=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var format=arguments.length>7&&arguments[7]!==undefined?arguments[7]:5;var prefiltered=arguments.length>8&&arguments[8]!==undefined?arguments[8]:false;var forcedExtension=arguments.length>9&&arguments[9]!==undefined?arguments[9]:null;var createPolynomials=arguments.length>10&&arguments[10]!==undefined?arguments[10]:false;var lodScale=arguments.length>11&&arguments[11]!==undefined?arguments[11]:0.8;var lodOffset=arguments.length>12&&arguments[12]!==undefined?arguments[12]:0;var loaderOptions=arguments.length>13?arguments[13]:undefined;var useSRGBBuffer=arguments.length>14?arguments[14]:undefined;_classCallCheck(this,CubeTexture);var _a;_this208=_super72.call(this,sceneOrEngine);_this208._lodScale=0.8;_this208._lodOffset=0;_this208.onLoadObservable=new Observable();_this208.boundingBoxPosition=Vector3.Zero();_this208._rotationY=0;_this208._files=null;_this208._forcedExtension=null;_this208._extensions=null;_this208.name=rootUrl;_this208.url=rootUrl;_this208._noMipmap=noMipmap;_this208.hasAlpha=false;_this208._format=format;_this208.isCube=true;_this208._textureMatrix=Matrix.Identity();_this208._createPolynomials=createPolynomials;_this208.coordinatesMode=Texture.CUBIC_MODE;_this208._extensions=extensions;_this208._files=files;_this208._forcedExtension=forcedExtension;_this208._loaderOptions=loaderOptions;_this208._useSRGBBuffer=useSRGBBuffer;_this208._lodScale=lodScale;_this208._lodOffset=lodOffset;if(!rootUrl&&!files){return _possibleConstructorReturn(_this208);}_this208.updateURL(rootUrl,forcedExtension,onLoad,prefiltered,onError,extensions,(_a=_this208.getScene())===null||_a===void 0?void 0:_a.useDelayedTextureLoading,files);return _this208;}_createClass(CubeTexture,[{key:"boundingBoxSize",get:function get(){return this._boundingBoxSize;},set:function set(value){if(this._boundingBoxSize&&this._boundingBoxSize.equals(value)){return;}this._boundingBoxSize=value;var scene2=this.getScene();if(scene2){scene2.markAllMaterialsAsDirty(1);}}},{key:"rotationY",get:function get(){return this._rotationY;},set:function set(value){this._rotationY=value;this.setReflectionTextureMatrix(Matrix.RotationY(this._rotationY));}},{key:"noMipmap",get:function get(){return this._noMipmap;}},{key:"forcedExtension",get:function get(){return this._forcedExtension;}},{key:"getClassName",value:function getClassName(){return"CubeTexture";}},{key:"updateURL",value:function updateURL(url,forcedExtension){var onLoad=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var prefiltered=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var onError=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var extensions=arguments.length>5&&arguments[5]!==undefined?arguments[5]:null;var delayLoad=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var files=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;if(!this.name||this.name.startsWith("data:")){this.name=url;}this.url=url;if(forcedExtension){this._forcedExtension=forcedExtension;}var lastDot=url.lastIndexOf(".");var extension=forcedExtension?forcedExtension:lastDot>-1?url.substring(lastDot).toLowerCase():"";var isDDS=extension.indexOf(".dds")===0;var isEnv=extension.indexOf(".env")===0;var isBasis=extension.indexOf(".basis")===0;if(isEnv){this.gammaSpace=false;this._prefiltered=false;this.anisotropicFilteringLevel=1;}else{this._prefiltered=prefiltered;if(prefiltered){this.gammaSpace=false;this.anisotropicFilteringLevel=1;}}if(files){this._files=files;}else{if(!isBasis&&!isEnv&&!isDDS&&!extensions){extensions=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"];}this._files=this._files||[];this._files.length=0;if(extensions){for(var index=0;index<extensions.length;index++){this._files.push(url+extensions[index]);}this._extensions=extensions;}}if(delayLoad){this.delayLoadState=4;this._delayedOnLoad=onLoad;this._delayedOnError=onError;}else{this._loadTexture(onLoad,onError);}}},{key:"delayLoad",value:function delayLoad(forcedExtension){if(this.delayLoadState!==4){return;}if(forcedExtension){this._forcedExtension=forcedExtension;}this.delayLoadState=1;this._loadTexture(this._delayedOnLoad,this._delayedOnError);}},{key:"getReflectionTextureMatrix",value:function getReflectionTextureMatrix(){return this._textureMatrix;}},{key:"setReflectionTextureMatrix",value:function setReflectionTextureMatrix(value){var _this209=this;var _a;if(value.updateFlag===this._textureMatrix.updateFlag){return;}if(value.isIdentity()!==this._textureMatrix.isIdentity()){(_a=this.getScene())===null||_a===void 0?void 0:_a.markAllMaterialsAsDirty(1,function(mat){return mat.getActiveTextures().indexOf(_this209)!==-1;});}this._textureMatrix=value;}},{key:"_loadTexture",value:function _loadTexture(){var _this210=this;var onLoad=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var onError=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var _a;var scene2=this.getScene();var oldTexture=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);var onLoadProcessing=function onLoadProcessing(){var _a2;_this210.onLoadObservable.notifyObservers(_this210);if(oldTexture){oldTexture.dispose();(_a2=_this210.getScene())===null||_a2===void 0?void 0:_a2.markAllMaterialsAsDirty(1);}if(onLoad){onLoad();}};var errorHandler=function errorHandler(message,exception){_this210._loadingError=true;_this210._errorObject={message:message,exception:exception};if(onError){onError(message,exception);}Texture.OnTextureLoadErrorObservable.notifyObservers(_this210);};if(!this._texture){if(this._prefiltered){this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,scene2,this._lodScale,this._lodOffset,onLoad,errorHandler,this._format,this._forcedExtension,this._createPolynomials);}else{this._texture=this._getEngine().createCubeTexture(this.url,scene2,this._files,this._noMipmap,onLoad,errorHandler,this._format,this._forcedExtension,false,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer);}(_a=this._texture)===null||_a===void 0?void 0:_a.onLoadedObservable.add(function(){return _this210.onLoadObservable.notifyObservers(_this210);});}else{if(this._texture.isReady){Tools.SetImmediate(function(){return onLoadProcessing();});}else{this._texture.onLoadedObservable.add(function(){return onLoadProcessing();});}}}},{key:"clone",value:function clone(){var _this211=this;var uniqueId=0;var newCubeTexture=SerializationHelper.Clone(function(){var cubeTexture=new CubeTexture(_this211.url,_this211.getScene()||_this211._getEngine(),_this211._extensions,_this211._noMipmap,_this211._files);uniqueId=cubeTexture.uniqueId;return cubeTexture;},this);newCubeTexture.uniqueId=uniqueId;return newCubeTexture;}}],[{key:"CreateFromImages",value:function CreateFromImages(files,scene2,noMipmap){var rootUrlKey="";files.forEach(function(url){return rootUrlKey+=url;});return new CubeTexture(rootUrlKey,scene2,null,noMipmap,files);}},{key:"CreateFromPrefilteredData",value:function CreateFromPrefilteredData(url,scene2){var forcedExtension=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var createPolynomials=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var oldValue=scene2.useDelayedTextureLoading;scene2.useDelayedTextureLoading=false;var result=new CubeTexture(url,scene2,null,false,null,null,null,void 0,true,forcedExtension,createPolynomials);scene2.useDelayedTextureLoading=oldValue;return result;}},{key:"Parse",value:function Parse(parsedTexture,scene2,rootUrl){var texture=SerializationHelper.Parse(function(){var prefiltered=false;if(parsedTexture.prefiltered){prefiltered=parsedTexture.prefiltered;}return new CubeTexture(rootUrl+parsedTexture.name,scene2,parsedTexture.extensions,false,parsedTexture.files||null,null,null,void 0,prefiltered,parsedTexture.forcedExtension);},parsedTexture,scene2);if(parsedTexture.boundingBoxPosition){texture.boundingBoxPosition=Vector3.FromArray(parsedTexture.boundingBoxPosition);}if(parsedTexture.boundingBoxSize){texture.boundingBoxSize=Vector3.FromArray(parsedTexture.boundingBoxSize);}if(parsedTexture.animations){for(var animationIndex=0;animationIndex<parsedTexture.animations.length;animationIndex++){var parsedAnimation=parsedTexture.animations[animationIndex];var internalClass=GetClass("BABYLON.Animation");if(internalClass){texture.animations.push(internalClass.Parse(parsedAnimation));}}}return texture;}}]);return CubeTexture;}(BaseTexture);__decorate([serialize()],CubeTexture.prototype,"url",void 0);__decorate([serialize("rotationY")],CubeTexture.prototype,"rotationY",null);__decorate([serialize("files")],CubeTexture.prototype,"_files",void 0);__decorate([serialize("forcedExtension")],CubeTexture.prototype,"_forcedExtension",void 0);__decorate([serialize("extensions")],CubeTexture.prototype,"_extensions",void 0);__decorate([serializeAsMatrix("textureMatrix")],CubeTexture.prototype,"_textureMatrix",void 0);Texture._CubeTextureParser=CubeTexture.Parse;RegisterClass("BABYLON.CubeTexture",CubeTexture);// node_modules/@babylonjs/core/Materials/Textures/rawCubeTexture.js
var RawCubeTexture=/*#__PURE__*/function(_CubeTexture){_inherits(RawCubeTexture,_CubeTexture);var _super73=_createSuper(RawCubeTexture);function RawCubeTexture(scene2,data,size){var _this212;var format=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;var type=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var generateMipMaps=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var invertY=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var samplingMode=arguments.length>7&&arguments[7]!==undefined?arguments[7]:3;var compression=arguments.length>8&&arguments[8]!==undefined?arguments[8]:null;_classCallCheck(this,RawCubeTexture);_this212=_super73.call(this,"",scene2);_this212._texture=scene2.getEngine().createRawCubeTexture(data,size,format,type,generateMipMaps,invertY,samplingMode,compression);return _this212;}_createClass(RawCubeTexture,[{key:"update",value:function update(data,format,type,invertY){var compression=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,data,format,type,invertY,compression);}},{key:"updateRGBDAsync",value:function updateRGBDAsync(data){var sphericalPolynomial=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var lodScale=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0.8;var lodOffset=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;return _UpdateRGBDAsync(this._texture,data,sphericalPolynomial,lodScale,lodOffset).then(function(){});}},{key:"clone",value:function clone(){var _this213=this;return SerializationHelper.Clone(function(){var scene2=_this213.getScene();var internalTexture=_this213._texture;var texture=new RawCubeTexture(scene2,internalTexture._bufferViewArray,internalTexture.width,internalTexture.format,internalTexture.type,internalTexture.generateMipMaps,internalTexture.invertY,internalTexture.samplingMode,internalTexture._compression);if(internalTexture.source===InternalTextureSource.CubeRawRGBD){texture.updateRGBDAsync(internalTexture._bufferViewArrayArray,internalTexture._sphericalPolynomial,internalTexture._lodGenerationScale,internalTexture._lodGenerationOffset);}return texture;},this);}}]);return RawCubeTexture;}(CubeTexture);// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/EXT_lights_image_based.js
var NAME="EXT_lights_image_based";var EXT_lights_image_based=/*#__PURE__*/function(){function EXT_lights_image_based(loader){_classCallCheck(this,EXT_lights_image_based);this.name=NAME;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME);}_createClass(EXT_lights_image_based,[{key:"dispose",value:function dispose(){this._loader=null;delete this._lights;}},{key:"onLoading",value:function onLoading(){var extensions=this._loader.gltf.extensions;if(extensions&&extensions[this.name]){var extension=extensions[this.name];this._lights=extension.lights;}}},{key:"loadSceneAsync",value:function loadSceneAsync(context,scene2){var _this214=this;return GLTFLoader2.LoadExtensionAsync(context,scene2,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this214._loader.loadSceneAsync(context,scene2));_this214._loader.logOpen("".concat(extensionContext));var light=ArrayItem.Get("".concat(extensionContext,"/light"),_this214._lights,extension.light);promises.push(_this214._loadLightAsync("/extensions/".concat(_this214.name,"/lights/").concat(extension.light),light).then(function(texture){_this214._loader.babylonScene.environmentTexture=texture;}));_this214._loader.logClose();return Promise.all(promises).then(function(){});});}},{key:"_loadLightAsync",value:function _loadLightAsync(context,light){var _this215=this;if(!light._loaded){var promises=new Array();this._loader.logOpen("".concat(context));var imageData=new Array(light.specularImages.length);var _loop13=function _loop13(mipmap){var faces=light.specularImages[mipmap];imageData[mipmap]=new Array(faces.length);var _loop14=function _loop14(face){var specularImageContext="".concat(context,"/specularImages/").concat(mipmap,"/").concat(face);_this215._loader.logOpen("".concat(specularImageContext));var index=faces[face];var image=ArrayItem.Get(specularImageContext,_this215._loader.gltf.images,index);promises.push(_this215._loader.loadImageAsync("/images/".concat(index),image).then(function(data){imageData[mipmap][face]=data;}));_this215._loader.logClose();};for(var face=0;face<faces.length;face++){_loop14(face);}};for(var mipmap=0;mipmap<light.specularImages.length;mipmap++){_loop13(mipmap);}this._loader.logClose();light._loaded=Promise.all(promises).then(function(){var babylonTexture=new RawCubeTexture(_this215._loader.babylonScene,null,light.specularImageSize);babylonTexture.name=light.name||"environment";light._babylonTexture=babylonTexture;if(light.intensity!=void 0){babylonTexture.level=light.intensity;}if(light.rotation){var rotation=Quaternion.FromArray(light.rotation);if(!_this215._loader.babylonScene.useRightHandedSystem){rotation=Quaternion.Inverse(rotation);}Matrix.FromQuaternionToRef(rotation,babylonTexture.getReflectionTextureMatrix());}if(!light.irradianceCoefficients){throw new Error("".concat(context,": Irradiance coefficients are missing"));}var sphericalHarmonics=SphericalHarmonics.FromArray(light.irradianceCoefficients);sphericalHarmonics.scaleInPlace(light.intensity);sphericalHarmonics.convertIrradianceToLambertianRadiance();var sphericalPolynomial=SphericalPolynomial.FromHarmonics(sphericalHarmonics);var lodGenerationScale=(imageData.length-1)/Scalar.Log2(light.specularImageSize);return babylonTexture.updateRGBDAsync(imageData,sphericalPolynomial,lodGenerationScale);});}return light._loaded.then(function(){return light._babylonTexture;});}}]);return EXT_lights_image_based;}();GLTFLoader2.RegisterExtension(NAME,function(loader){return new EXT_lights_image_based(loader);});// node_modules/@babylonjs/core/Meshes/thinInstanceMesh.js
Mesh.prototype.thinInstanceAdd=function(matrix){var refresh=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this.getScene().getEngine().getCaps().instancedArrays){Logger.Error("Thin Instances are not supported on this device as Instanced Array extension not supported");return-1;}this._thinInstanceUpdateBufferSize("matrix",Array.isArray(matrix)?matrix.length:1);var index=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(matrix)){for(var i=0;i<matrix.length;++i){this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,matrix[i],i===matrix.length-1&&refresh);}}else{this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,matrix,refresh);}return index;};Mesh.prototype.thinInstanceAddSelf=function(){var refresh=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return this.thinInstanceAdd(Matrix.IdentityReadOnly,refresh);};Mesh.prototype.thinInstanceRegisterAttribute=function(kind,stride){if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}this.removeVerticesData(kind);this._thinInstanceInitializeUserStorage();this._userThinInstanceBuffersStorage.strides[kind]=stride;this._userThinInstanceBuffersStorage.sizes[kind]=stride*Math.max(32,this._thinInstanceDataStorage.instancesCount);this._userThinInstanceBuffersStorage.data[kind]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[kind]);this._userThinInstanceBuffersStorage.vertexBuffers[kind]=new VertexBuffer(this.getEngine(),this._userThinInstanceBuffersStorage.data[kind],kind,true,false,stride,true);this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[kind]);};Mesh.prototype.thinInstanceSetMatrixAt=function(index,matrix){var refresh=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(!this._thinInstanceDataStorage.matrixData||index>=this._thinInstanceDataStorage.instancesCount){return false;}var matrixData=this._thinInstanceDataStorage.matrixData;matrix.copyToArray(matrixData,index*16);if(this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices[index]=matrix;}if(refresh){this.thinInstanceBufferUpdated("matrix");if(!this.doNotSyncBoundingInfo){this.thinInstanceRefreshBoundingInfo(false);}}return true;};Mesh.prototype.thinInstanceSetAttributeAt=function(kind,index,value){var refresh=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}if(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[kind]||index>=this._thinInstanceDataStorage.instancesCount){return false;}this._thinInstanceUpdateBufferSize(kind,0);this._userThinInstanceBuffersStorage.data[kind].set(value,index*this._userThinInstanceBuffersStorage.strides[kind]);if(refresh){this.thinInstanceBufferUpdated(kind);}return true;};Object.defineProperty(Mesh.prototype,"thinInstanceCount",{get:function get(){return this._thinInstanceDataStorage.instancesCount;},set:function set(value){var _a,_b;var matrixData=(_a=this._thinInstanceDataStorage.matrixData)!==null&&_a!==void 0?_a:(_b=this.source)===null||_b===void 0?void 0:_b._thinInstanceDataStorage.matrixData;var numMaxInstances=matrixData?matrixData.length/16:0;if(value<=numMaxInstances){this._thinInstanceDataStorage.instancesCount=value;}},enumerable:true,configurable:true});Mesh.prototype._thinInstanceCreateMatrixBuffer=function(kind,buffer){var staticBuffer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}var matrixBuffer=new Buffer2(this.getEngine(),buffer,!staticBuffer,16,false,true);for(var i=0;i<4;i++){this.setVerticesBuffer(matrixBuffer.createVertexBuffer(kind+i,i*4,4));}return matrixBuffer;};Mesh.prototype.thinInstanceSetBuffer=function(kind,buffer){var stride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var staticBuffer=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var _a,_b,_c;stride=stride||16;if(kind==="matrix"){(_a=this._thinInstanceDataStorage.matrixBuffer)===null||_a===void 0?void 0:_a.dispose();this._thinInstanceDataStorage.matrixBuffer=null;this._thinInstanceDataStorage.matrixBufferSize=buffer?buffer.length:32*stride;this._thinInstanceDataStorage.matrixData=buffer;this._thinInstanceDataStorage.worldMatrices=null;if(buffer!==null){this._thinInstanceDataStorage.instancesCount=buffer.length/stride;this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",buffer,staticBuffer);if(!this.doNotSyncBoundingInfo){this.thinInstanceRefreshBoundingInfo(false);}}else{this._thinInstanceDataStorage.instancesCount=0;if(!this.doNotSyncBoundingInfo){this.refreshBoundingInfo();}}}else if(kind==="previousMatrix"){(_b=this._thinInstanceDataStorage.previousMatrixBuffer)===null||_b===void 0?void 0:_b.dispose();this._thinInstanceDataStorage.previousMatrixBuffer=null;this._thinInstanceDataStorage.previousMatrixData=buffer;if(buffer!==null){this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",buffer,staticBuffer);}}else{if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}if(buffer===null){if((_c=this._userThinInstanceBuffersStorage)===null||_c===void 0?void 0:_c.data[kind]){this.removeVerticesData(kind);delete this._userThinInstanceBuffersStorage.data[kind];delete this._userThinInstanceBuffersStorage.strides[kind];delete this._userThinInstanceBuffersStorage.sizes[kind];delete this._userThinInstanceBuffersStorage.vertexBuffers[kind];}}else{this._thinInstanceInitializeUserStorage();this._userThinInstanceBuffersStorage.data[kind]=buffer;this._userThinInstanceBuffersStorage.strides[kind]=stride;this._userThinInstanceBuffersStorage.sizes[kind]=buffer.length;this._userThinInstanceBuffersStorage.vertexBuffers[kind]=new VertexBuffer(this.getEngine(),buffer,kind,!staticBuffer,false,stride,true);this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[kind]);}}};Mesh.prototype.thinInstanceBufferUpdated=function(kind){var _a,_b,_c;if(kind==="matrix"){(_a=this._thinInstanceDataStorage.matrixBuffer)===null||_a===void 0?void 0:_a.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);}else if(kind==="previousMatrix"){(_b=this._thinInstanceDataStorage.previousMatrixBuffer)===null||_b===void 0?void 0:_b.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount);}else{if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}if((_c=this._userThinInstanceBuffersStorage)===null||_c===void 0?void 0:_c.vertexBuffers[kind]){this._userThinInstanceBuffersStorage.vertexBuffers[kind].updateDirectly(this._userThinInstanceBuffersStorage.data[kind],0);}}};Mesh.prototype.thinInstancePartialBufferUpdate=function(kind,data,offset){var _a;if(kind==="matrix"){if(this._thinInstanceDataStorage.matrixBuffer){this._thinInstanceDataStorage.matrixBuffer.updateDirectly(data,offset);}}else{if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}if((_a=this._userThinInstanceBuffersStorage)===null||_a===void 0?void 0:_a.vertexBuffers[kind]){this._userThinInstanceBuffersStorage.vertexBuffers[kind].updateDirectly(data,offset);}}};Mesh.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer){return[];}var matrixData=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=new Array();for(var i=0;i<this._thinInstanceDataStorage.instancesCount;++i){this._thinInstanceDataStorage.worldMatrices[i]=Matrix.FromArray(matrixData,i*16);}}return this._thinInstanceDataStorage.worldMatrices;};Mesh.prototype.thinInstanceRefreshBoundingInfo=function(){var forceRefreshParentInfo=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var applySkeleton=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var applyMorph=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer){return;}var vectors=this._thinInstanceDataStorage.boundingVectors;if(forceRefreshParentInfo){vectors.length=0;this.refreshBoundingInfo(applySkeleton,applyMorph);}var boundingInfo=this.getBoundingInfo();var matrixData=this._thinInstanceDataStorage.matrixData;if(vectors.length===0){for(var v=0;v<boundingInfo.boundingBox.vectors.length;++v){vectors.push(boundingInfo.boundingBox.vectors[v].clone());}}TmpVectors.Vector3[0].setAll(Number.POSITIVE_INFINITY);TmpVectors.Vector3[1].setAll(Number.NEGATIVE_INFINITY);for(var i=0;i<this._thinInstanceDataStorage.instancesCount;++i){Matrix.FromArrayToRef(matrixData,i*16,TmpVectors.Matrix[0]);for(var _v2=0;_v2<vectors.length;++_v2){Vector3.TransformCoordinatesToRef(vectors[_v2],TmpVectors.Matrix[0],TmpVectors.Vector3[2]);TmpVectors.Vector3[0].minimizeInPlace(TmpVectors.Vector3[2]);TmpVectors.Vector3[1].maximizeInPlace(TmpVectors.Vector3[2]);}}boundingInfo.reConstruct(TmpVectors.Vector3[0],TmpVectors.Vector3[1]);this._updateBoundingInfo();};Mesh.prototype._thinInstanceUpdateBufferSize=function(kind){var numInstances=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _a,_b,_c;if(kind===VertexBuffer.ColorKind){kind=VertexBuffer.ColorInstanceKind;}var kindIsMatrix=kind==="matrix";if(!kindIsMatrix&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[kind])){return;}var stride=kindIsMatrix?16:this._userThinInstanceBuffersStorage.strides[kind];var currentSize=kindIsMatrix?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[kind];var data=kindIsMatrix?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[kind];var bufferSize=(this._thinInstanceDataStorage.instancesCount+numInstances)*stride;var newSize=currentSize;while(newSize<bufferSize){newSize*=2;}if(!data||currentSize!=newSize){if(!data){data=new Float32Array(newSize);}else{var newData=new Float32Array(newSize);newData.set(data,0);data=newData;}if(kindIsMatrix){(_a=this._thinInstanceDataStorage.matrixBuffer)===null||_a===void 0?void 0:_a.dispose();this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",data,false);this._thinInstanceDataStorage.matrixData=data;this._thinInstanceDataStorage.matrixBufferSize=newSize;if(this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData){(_b=this._thinInstanceDataStorage.previousMatrixBuffer)===null||_b===void 0?void 0:_b.dispose();this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",data,false);}}else{(_c=this._userThinInstanceBuffersStorage.vertexBuffers[kind])===null||_c===void 0?void 0:_c.dispose();this._userThinInstanceBuffersStorage.data[kind]=data;this._userThinInstanceBuffersStorage.sizes[kind]=newSize;this._userThinInstanceBuffersStorage.vertexBuffers[kind]=new VertexBuffer(this.getEngine(),data,kind,true,false,stride,true);this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[kind]);}}};Mesh.prototype._thinInstanceInitializeUserStorage=function(){if(!this._userThinInstanceBuffersStorage){this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}};}};Mesh.prototype._disposeThinInstanceSpecificData=function(){var _a;if((_a=this._thinInstanceDataStorage)===null||_a===void 0?void 0:_a.matrixBuffer){this._thinInstanceDataStorage.matrixBuffer.dispose();this._thinInstanceDataStorage.matrixBuffer=null;}};// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/EXT_mesh_gpu_instancing.js
var NAME2="EXT_mesh_gpu_instancing";var EXT_mesh_gpu_instancing=/*#__PURE__*/function(){function EXT_mesh_gpu_instancing(loader){_classCallCheck(this,EXT_mesh_gpu_instancing);this.name=NAME2;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME2);}_createClass(EXT_mesh_gpu_instancing,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadNodeAsync",value:function loadNodeAsync(context,node,assign){var _this216=this;return GLTFLoader2.LoadExtensionAsync(context,node,this.name,function(extensionContext,extension){_this216._loader._disableInstancedMesh++;var promise=_this216._loader.loadNodeAsync("/nodes/".concat(node.index),node,assign);_this216._loader._disableInstancedMesh--;if(!node._primitiveBabylonMeshes){return promise;}var promises=new Array();var instanceCount=0;var loadAttribute=function loadAttribute(attribute){if(extension.attributes[attribute]==void 0){promises.push(Promise.resolve(null));return;}var accessor=ArrayItem.Get("".concat(extensionContext,"/attributes/").concat(attribute),_this216._loader.gltf.accessors,extension.attributes[attribute]);promises.push(_this216._loader._loadFloatAccessorAsync("/accessors/".concat(accessor.bufferView),accessor));if(instanceCount===0){instanceCount=accessor.count;}else if(instanceCount!==accessor.count){throw new Error("".concat(extensionContext,"/attributes: Instance buffer accessors do not have the same count."));}};loadAttribute("TRANSLATION");loadAttribute("ROTATION");loadAttribute("SCALE");return promise.then(function(babylonTransformNode){return Promise.all(promises).then(function(_ref20){var _ref21=_slicedToArray(_ref20,3),translationBuffer=_ref21[0],rotationBuffer=_ref21[1],scaleBuffer=_ref21[2];var matrices=new Float32Array(instanceCount*16);TmpVectors.Vector3[0].copyFromFloats(0,0,0);TmpVectors.Quaternion[0].copyFromFloats(0,0,0,1);TmpVectors.Vector3[1].copyFromFloats(1,1,1);for(var i=0;i<instanceCount;++i){translationBuffer&&Vector3.FromArrayToRef(translationBuffer,i*3,TmpVectors.Vector3[0]);rotationBuffer&&Quaternion.FromArrayToRef(rotationBuffer,i*4,TmpVectors.Quaternion[0]);scaleBuffer&&Vector3.FromArrayToRef(scaleBuffer,i*3,TmpVectors.Vector3[1]);Matrix.ComposeToRef(TmpVectors.Vector3[1],TmpVectors.Quaternion[0],TmpVectors.Vector3[0],TmpVectors.Matrix[0]);TmpVectors.Matrix[0].copyToArray(matrices,i*16);}var _iterator228=_createForOfIteratorHelper(node._primitiveBabylonMeshes),_step241;try{for(_iterator228.s();!(_step241=_iterator228.n()).done;){var babylonMesh=_step241.value;babylonMesh.thinInstanceSetBuffer("matrix",matrices,16,true);}}catch(err){_iterator228.e(err);}finally{_iterator228.f();}return babylonTransformNode;});});});}}]);return EXT_mesh_gpu_instancing;}();GLTFLoader2.RegisterExtension(NAME2,function(loader){return new EXT_mesh_gpu_instancing(loader);});// node_modules/@babylonjs/core/Meshes/Compression/meshoptCompression.js
var MeshoptCompression=/*#__PURE__*/function(){function MeshoptCompression(){_classCallCheck(this,MeshoptCompression);var decoder=MeshoptCompression.Configuration.decoder;this._decoderModulePromise=Tools.LoadScriptAsync(Tools.GetAbsoluteUrl(decoder.url)).then(function(){return MeshoptDecoder.ready;});}_createClass(MeshoptCompression,[{key:"dispose",value:function dispose(){delete this._decoderModulePromise;}},{key:"decodeGltfBufferAsync",value:function decodeGltfBufferAsync(source,count,stride,mode,filter){return this._decoderModulePromise.then(function(){var result=new Uint8Array(count*stride);MeshoptDecoder.decodeGltfBuffer(result,count,stride,source,mode,filter);return result;});}}],[{key:"Default",get:function get(){if(!MeshoptCompression._Default){MeshoptCompression._Default=new MeshoptCompression();}return MeshoptCompression._Default;}}]);return MeshoptCompression;}();MeshoptCompression.Configuration={decoder:{url:"https://preview.babylonjs.com/meshopt_decoder.js"}};MeshoptCompression._Default=null;// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/EXT_meshopt_compression.js
var NAME3="EXT_meshopt_compression";var EXT_meshopt_compression=/*#__PURE__*/function(){function EXT_meshopt_compression(loader){_classCallCheck(this,EXT_meshopt_compression);this.name=NAME3;this.enabled=loader.isExtensionUsed(NAME3);this._loader=loader;}_createClass(EXT_meshopt_compression,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadBufferViewAsync",value:function loadBufferViewAsync(context,bufferView){var _this217=this;return GLTFLoader2.LoadExtensionAsync(context,bufferView,this.name,function(extensionContext,extension){var bufferViewMeshopt=bufferView;if(bufferViewMeshopt._meshOptData){return bufferViewMeshopt._meshOptData;}var buffer=ArrayItem.Get("".concat(context,"/buffer"),_this217._loader.gltf.buffers,extension.buffer);bufferViewMeshopt._meshOptData=_this217._loader.loadBufferAsync("/buffers/".concat(buffer.index),buffer,extension.byteOffset||0,extension.byteLength).then(function(buffer2){return MeshoptCompression.Default.decodeGltfBufferAsync(buffer2,extension.count,extension.byteStride,extension.mode,extension.filter);});return bufferViewMeshopt._meshOptData;});}}]);return EXT_meshopt_compression;}();GLTFLoader2.RegisterExtension(NAME3,function(loader){return new EXT_meshopt_compression(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/EXT_texture_webp.js
var NAME4="EXT_texture_webp";var EXT_texture_webp=/*#__PURE__*/function(){function EXT_texture_webp(loader){_classCallCheck(this,EXT_texture_webp);this.name=NAME4;this._loader=loader;this.enabled=loader.isExtensionUsed(NAME4);}_createClass(EXT_texture_webp,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"_loadTextureAsync",value:function _loadTextureAsync(context,texture,assign){var _this218=this;return GLTFLoader2.LoadExtensionAsync(context,texture,this.name,function(extensionContext,extension){var sampler=texture.sampler==void 0?GLTFLoader2.DefaultSampler:ArrayItem.Get("".concat(context,"/sampler"),_this218._loader.gltf.samplers,texture.sampler);var image=ArrayItem.Get("".concat(extensionContext,"/source"),_this218._loader.gltf.images,extension.source);return _this218._loader._createTextureAsync(context,sampler,image,function(babylonTexture){assign(babylonTexture);},void 0,!texture._textureInfo.nonColorData);});}}]);return EXT_texture_webp;}();GLTFLoader2.RegisterExtension(NAME4,function(loader){return new EXT_texture_webp(loader);});// node_modules/@babylonjs/core/Misc/workerPool.js
var WorkerPool=/*#__PURE__*/function(){function WorkerPool(workers){_classCallCheck(this,WorkerPool);this._pendingActions=new Array();this._workerInfos=workers.map(function(worker2){return{workerPromise:Promise.resolve(worker2),idle:true};});}_createClass(WorkerPool,[{key:"dispose",value:function dispose(){var _iterator229=_createForOfIteratorHelper(this._workerInfos),_step242;try{for(_iterator229.s();!(_step242=_iterator229.n()).done;){var workerInfo=_step242.value;workerInfo.workerPromise.then(function(worker2){worker2.terminate();});}}catch(err){_iterator229.e(err);}finally{_iterator229.f();}this._workerInfos.length=0;this._pendingActions.length=0;}},{key:"push",value:function push(action){if(!this._executeOnIdleWorker(action)){this._pendingActions.push(action);}}},{key:"_executeOnIdleWorker",value:function _executeOnIdleWorker(action){var _iterator230=_createForOfIteratorHelper(this._workerInfos),_step243;try{for(_iterator230.s();!(_step243=_iterator230.n()).done;){var workerInfo=_step243.value;if(workerInfo.idle){this._execute(workerInfo,action);return true;}}}catch(err){_iterator230.e(err);}finally{_iterator230.f();}return false;}},{key:"_execute",value:function _execute(workerInfo,action){var _this219=this;workerInfo.idle=false;workerInfo.workerPromise.then(function(worker2){action(worker2,function(){var nextAction=_this219._pendingActions.shift();if(nextAction){_this219._execute(workerInfo,nextAction);}else{workerInfo.idle=true;}});});}}]);return WorkerPool;}();var AutoReleaseWorkerPool=/*#__PURE__*/function(_WorkerPool){_inherits(AutoReleaseWorkerPool,_WorkerPool);var _super74=_createSuper(AutoReleaseWorkerPool);function AutoReleaseWorkerPool(maxWorkers,createWorkerAsync){var _this220;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:AutoReleaseWorkerPool.DefaultOptions;_classCallCheck(this,AutoReleaseWorkerPool);_this220=_super74.call(this,[]);_this220._maxWorkers=maxWorkers;_this220._createWorkerAsync=createWorkerAsync;_this220._options=options;return _this220;}_createClass(AutoReleaseWorkerPool,[{key:"push",value:function push(action){if(!this._executeOnIdleWorker(action)){if(this._workerInfos.length<this._maxWorkers){var workerInfo={workerPromise:this._createWorkerAsync(),idle:false};this._workerInfos.push(workerInfo);this._execute(workerInfo,action);}else{this._pendingActions.push(action);}}}},{key:"_execute",value:function _execute(workerInfo,action){var _this221=this;if(workerInfo.timeoutId){clearTimeout(workerInfo.timeoutId);delete workerInfo.timeoutId;}_get(_getPrototypeOf(AutoReleaseWorkerPool.prototype),"_execute",this).call(this,workerInfo,function(worker2,onComplete){action(worker2,function(){onComplete();if(workerInfo.idle){workerInfo.timeoutId=setTimeout(function(){workerInfo.workerPromise.then(function(worker3){worker3.terminate();});var indexOf=_this221._workerInfos.indexOf(workerInfo);if(indexOf!==-1){_this221._workerInfos.splice(indexOf,1);}},_this221._options.idleTimeElapsedBeforeRelease);}});});}}]);return AutoReleaseWorkerPool;}(WorkerPool);AutoReleaseWorkerPool.DefaultOptions={idleTimeElapsedBeforeRelease:1e3};// node_modules/@babylonjs/core/Meshes/Compression/dracoCompression.js
function createDecoderAsync(wasmBinary){return new Promise(function(resolve){DracoDecoderModule({wasmBinary:wasmBinary}).then(function(module2){resolve({module:module2});});});}function decodeMesh(decoderModule,dataView,attributes,onIndicesData,onAttributeData,dividers){var buffer=new decoderModule.DecoderBuffer();buffer.Init(dataView,dataView.byteLength);var decoder=new decoderModule.Decoder();var geometry;var status;try{var type=decoder.GetEncodedGeometryType(buffer);switch(type){case decoderModule.TRIANGULAR_MESH:geometry=new decoderModule.Mesh();status=decoder.DecodeBufferToMesh(buffer,geometry);break;case decoderModule.POINT_CLOUD:geometry=new decoderModule.PointCloud();status=decoder.DecodeBufferToPointCloud(buffer,geometry);break;default:throw new Error("Invalid geometry type ".concat(type));}if(!status.ok()||!geometry.ptr){throw new Error(status.error_msg());}if(type===decoderModule.TRIANGULAR_MESH){var numFaces=geometry.num_faces();var numIndices=numFaces*3;var byteLength=numIndices*4;var ptr=decoderModule._malloc(byteLength);try{decoder.GetTrianglesUInt32Array(geometry,byteLength,ptr);var indices=new Uint32Array(numIndices);indices.set(new Uint32Array(decoderModule.HEAPF32.buffer,ptr,numIndices));onIndicesData(indices);}finally{decoderModule._free(ptr);}}var processAttribute=function processAttribute(kind,attribute){var divider=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var numComponents=attribute.num_components();var numPoints=geometry.num_points();var numValues=numPoints*numComponents;var byteLength=numValues*Float32Array.BYTES_PER_ELEMENT;var ptr=decoderModule._malloc(byteLength);try{decoder.GetAttributeDataArrayForAllPoints(geometry,attribute,decoderModule.DT_FLOAT32,byteLength,ptr);var values=new Float32Array(decoderModule.HEAPF32.buffer,ptr,numValues);if(kind==="color"&&numComponents===3){var babylonData=new Float32Array(numPoints*4);for(var i=0,j=0;i<babylonData.length;i+=4,j+=numComponents){babylonData[i+0]=values[j+0];babylonData[i+1]=values[j+1];babylonData[i+2]=values[j+2];babylonData[i+3]=1;}onAttributeData(kind,babylonData);}else{var _babylonData=new Float32Array(numValues);_babylonData.set(new Float32Array(decoderModule.HEAPF32.buffer,ptr,numValues));if(divider!==1){for(var _i35=0;_i35<_babylonData.length;_i35++){_babylonData[_i35]=_babylonData[_i35]/divider;}}onAttributeData(kind,_babylonData);}}finally{decoderModule._free(ptr);}};if(attributes){for(var kind in attributes){var id=attributes[kind];var attribute=decoder.GetAttributeByUniqueId(geometry,id);var divider=dividers&&dividers[kind]||1;processAttribute(kind,attribute,divider);}}else{var nativeAttributeTypes={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"};for(var _kind in nativeAttributeTypes){var _id=decoder.GetAttributeId(geometry,decoderModule[nativeAttributeTypes[_kind]]);if(_id!==-1){var _attribute2=decoder.GetAttribute(geometry,_id);processAttribute(_kind,_attribute2);}}}}finally{if(geometry){decoderModule.destroy(geometry);}decoderModule.destroy(decoder);decoderModule.destroy(buffer);}}function worker(){var decoderPromise;onmessage=function onmessage(event){var data=event.data;switch(data.id){case"init":{var decoder=data.decoder;if(decoder.url){importScripts(decoder.url);decoderPromise=DracoDecoderModule({wasmBinary:decoder.wasmBinary});}postMessage("done");break;}case"decodeMesh":{if(!decoderPromise){throw new Error("Draco decoder module is not available");}decoderPromise.then(function(decoder){decodeMesh(decoder,data.dataView,data.attributes,function(indices){postMessage({id:"indices",value:indices},[indices.buffer]);},function(kind,data2){postMessage({id:kind,value:data2},[data2.buffer]);});postMessage("done");});break;}}};}var DracoCompression=/*#__PURE__*/function(){function DracoCompression(){var numWorkers=arguments.length>0&&arguments[0]!==undefined?arguments[0]:DracoCompression.DefaultNumWorkers;_classCallCheck(this,DracoCompression);var decoder=DracoCompression.Configuration.decoder;var decoderInfo=decoder.wasmUrl&&decoder.wasmBinaryUrl&&(typeof WebAssembly==="undefined"?"undefined":_typeof(WebAssembly))==="object"?{url:Tools.GetAbsoluteUrl(decoder.wasmUrl),wasmBinaryPromise:Tools.LoadFileAsync(Tools.GetAbsoluteUrl(decoder.wasmBinaryUrl))}:{url:Tools.GetAbsoluteUrl(decoder.fallbackUrl),wasmBinaryPromise:Promise.resolve(void 0)};if(numWorkers&&typeof Worker==="function"&&typeof URL==="function"){this._workerPoolPromise=decoderInfo.wasmBinaryPromise.then(function(decoderWasmBinary){var workerContent="".concat(decodeMesh,"(").concat(worker,")()");var workerBlobUrl=URL.createObjectURL(new Blob([workerContent],{type:"application/javascript"}));return new AutoReleaseWorkerPool(numWorkers,function(){return new Promise(function(resolve,reject){var worker2=new Worker(workerBlobUrl);var onError=function onError(error){worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);reject(error);};var onMessage=function onMessage(message){if(message.data==="done"){worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);resolve(worker2);}};worker2.addEventListener("error",onError);worker2.addEventListener("message",onMessage);worker2.postMessage({id:"init",decoder:{url:decoderInfo.url,wasmBinary:decoderWasmBinary}});});});});}else{this._decoderModulePromise=decoderInfo.wasmBinaryPromise.then(function(decoderWasmBinary){if(!decoderInfo.url){throw new Error("Draco decoder module is not available");}return Tools.LoadScriptAsync(decoderInfo.url).then(function(){return createDecoderAsync(decoderWasmBinary);});});}}_createClass(DracoCompression,[{key:"dispose",value:function dispose(){if(this._workerPoolPromise){this._workerPoolPromise.then(function(workerPool){workerPool.dispose();});}delete this._workerPoolPromise;delete this._decoderModulePromise;}},{key:"whenReadyAsync",value:function whenReadyAsync(){if(this._workerPoolPromise){return this._workerPoolPromise.then(function(){});}if(this._decoderModulePromise){return this._decoderModulePromise.then(function(){});}return Promise.resolve();}},{key:"decodeMeshAsync",value:function decodeMeshAsync(data,attributes,dividers){var dataView=data instanceof ArrayBuffer?new Uint8Array(data):data;if(this._workerPoolPromise){return this._workerPoolPromise.then(function(workerPool){return new Promise(function(resolve,reject){workerPool.push(function(worker2,onComplete){var vertexData=new VertexData();var onError=function onError(error){worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);reject(error);onComplete();};var onMessage=function onMessage(message){if(message.data==="done"){worker2.removeEventListener("error",onError);worker2.removeEventListener("message",onMessage);resolve(vertexData);onComplete();}else if(message.data.id==="indices"){vertexData.indices=message.data.value;}else{var divider=dividers&&dividers[message.data.id]?dividers[message.data.id]:1;if(divider!==1){for(var i=0;i<message.data.value.length;i++){message.data.value[i]=message.data.value[i]/divider;}}vertexData.set(message.data.value,message.data.id);}};worker2.addEventListener("error",onError);worker2.addEventListener("message",onMessage);var dataViewCopy=new Uint8Array(dataView.byteLength);dataViewCopy.set(new Uint8Array(dataView.buffer,dataView.byteOffset,dataView.byteLength));worker2.postMessage({id:"decodeMesh",dataView:dataViewCopy,attributes:attributes},[dataViewCopy.buffer]);});});});}if(this._decoderModulePromise){return this._decoderModulePromise.then(function(decoder){var vertexData=new VertexData();decodeMesh(decoder.module,dataView,attributes,function(indices){vertexData.indices=indices;},function(kind,data2){vertexData.set(data2,kind);},dividers);return vertexData;});}throw new Error("Draco decoder module is not available");}}],[{key:"DecoderAvailable",get:function get(){var decoder=DracoCompression.Configuration.decoder;return!!(decoder.wasmUrl&&decoder.wasmBinaryUrl&&(typeof WebAssembly==="undefined"?"undefined":_typeof(WebAssembly))==="object"||decoder.fallbackUrl);}},{key:"GetDefaultNumWorkers",value:function GetDefaultNumWorkers(){if((typeof navigator==="undefined"?"undefined":_typeof(navigator))!=="object"||!navigator.hardwareConcurrency){return 1;}return Math.min(Math.floor(navigator.hardwareConcurrency*0.5),4);}},{key:"Default",get:function get(){if(!DracoCompression._Default){DracoCompression._Default=new DracoCompression();}return DracoCompression._Default;}}]);return DracoCompression;}();DracoCompression.Configuration={decoder:{wasmUrl:"https://preview.babylonjs.com/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"https://preview.babylonjs.com/draco_decoder_gltf.wasm",fallbackUrl:"https://preview.babylonjs.com/draco_decoder_gltf.js"}};DracoCompression.DefaultNumWorkers=DracoCompression.GetDefaultNumWorkers();DracoCompression._Default=null;// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_draco_mesh_compression.js
var NAME5="KHR_draco_mesh_compression";var KHR_draco_mesh_compression=/*#__PURE__*/function(){function KHR_draco_mesh_compression(loader){_classCallCheck(this,KHR_draco_mesh_compression);this.name=NAME5;this._loader=loader;this.enabled=DracoCompression.DecoderAvailable&&this._loader.isExtensionUsed(NAME5);}_createClass(KHR_draco_mesh_compression,[{key:"dispose",value:function dispose(){delete this.dracoCompression;this._loader=null;}},{key:"_loadVertexDataAsync",value:function _loadVertexDataAsync(context,primitive,babylonMesh){var _this222=this;return GLTFLoader2.LoadExtensionAsync(context,primitive,this.name,function(extensionContext,extension){if(primitive.mode!=void 0){if(primitive.mode!==5&&primitive.mode!==4){throw new Error("".concat(context,": Unsupported mode ").concat(primitive.mode));}if(primitive.mode===5){throw new Error("".concat(context,": Mode ").concat(primitive.mode," is not currently supported"));}}var attributes={};var dividers={};var loadAttribute=function loadAttribute(name135,kind){var uniqueId=extension.attributes[name135];if(uniqueId===void 0||primitive.attributes[name135]===void 0){return;}attributes[kind]=uniqueId;var accessor=ArrayItem.Get("".concat(context,"/attributes/").concat(name135),_this222._loader.gltf.accessors,primitive.attributes[name135]);if(accessor.normalized&&accessor.componentType!==5126){var divider=1;switch(accessor.componentType){case 5120:divider=127;break;case 5121:divider=255;break;case 5122:divider=32767;break;case 5123:divider=65535;break;}dividers[kind]=divider;}babylonMesh._delayInfo=babylonMesh._delayInfo||[];if(babylonMesh._delayInfo.indexOf(kind)===-1){babylonMesh._delayInfo.push(kind);}};loadAttribute("POSITION",VertexBuffer.PositionKind);loadAttribute("NORMAL",VertexBuffer.NormalKind);loadAttribute("TANGENT",VertexBuffer.TangentKind);loadAttribute("TEXCOORD_0",VertexBuffer.UVKind);loadAttribute("TEXCOORD_1",VertexBuffer.UV2Kind);loadAttribute("TEXCOORD_2",VertexBuffer.UV3Kind);loadAttribute("TEXCOORD_3",VertexBuffer.UV4Kind);loadAttribute("TEXCOORD_4",VertexBuffer.UV5Kind);loadAttribute("TEXCOORD_5",VertexBuffer.UV6Kind);loadAttribute("JOINTS_0",VertexBuffer.MatricesIndicesKind);loadAttribute("WEIGHTS_0",VertexBuffer.MatricesWeightsKind);loadAttribute("COLOR_0",VertexBuffer.ColorKind);var bufferView=ArrayItem.Get(extensionContext,_this222._loader.gltf.bufferViews,extension.bufferView);if(!bufferView._dracoBabylonGeometry){bufferView._dracoBabylonGeometry=_this222._loader.loadBufferViewAsync("/bufferViews/".concat(bufferView.index),bufferView).then(function(data){var dracoCompression=_this222.dracoCompression||DracoCompression.Default;return dracoCompression.decodeMeshAsync(data,attributes,dividers).then(function(babylonVertexData){var babylonGeometry=new Geometry(babylonMesh.name,_this222._loader.babylonScene);babylonVertexData.applyToGeometry(babylonGeometry);return babylonGeometry;})["catch"](function(error){throw new Error("".concat(context,": ").concat(error.message));});});}return bufferView._dracoBabylonGeometry;});}}]);return KHR_draco_mesh_compression;}();GLTFLoader2.RegisterExtension(NAME5,function(loader){return new KHR_draco_mesh_compression(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_lights_punctual.js
var NAME6="KHR_lights_punctual";var KHR_lights=/*#__PURE__*/function(){function KHR_lights(loader){_classCallCheck(this,KHR_lights);this.name=NAME6;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME6);}_createClass(KHR_lights,[{key:"dispose",value:function dispose(){this._loader=null;delete this._lights;}},{key:"onLoading",value:function onLoading(){var extensions=this._loader.gltf.extensions;if(extensions&&extensions[this.name]){var extension=extensions[this.name];this._lights=extension.lights;ArrayItem.Assign(this._lights);}}},{key:"loadNodeAsync",value:function loadNodeAsync(context,node,assign){var _this223=this;return GLTFLoader2.LoadExtensionAsync(context,node,this.name,function(extensionContext,extension){return _this223._loader.loadNodeAsync(context,node,function(babylonMesh){var babylonLight;var light=ArrayItem.Get(extensionContext,_this223._lights,extension.light);var name135=light.name||babylonMesh.name;_this223._loader.babylonScene._blockEntityCollection=!!_this223._loader._assetContainer;switch(light.type){case"directional":{babylonLight=new DirectionalLight(name135,Vector3.Backward(),_this223._loader.babylonScene);break;}case"point":{babylonLight=new PointLight(name135,Vector3.Zero(),_this223._loader.babylonScene);break;}case"spot":{var babylonSpotLight=new SpotLight(name135,Vector3.Zero(),Vector3.Backward(),0,1,_this223._loader.babylonScene);babylonSpotLight.angle=(light.spot&&light.spot.outerConeAngle||Math.PI/4)*2;babylonSpotLight.innerAngle=(light.spot&&light.spot.innerConeAngle||0)*2;babylonLight=babylonSpotLight;break;}default:{_this223._loader.babylonScene._blockEntityCollection=false;throw new Error("".concat(extensionContext,": Invalid light type (").concat(light.type,")"));}}babylonLight._parentContainer=_this223._loader._assetContainer;_this223._loader.babylonScene._blockEntityCollection=false;light._babylonLight=babylonLight;babylonLight.falloffType=Light.FALLOFF_GLTF;babylonLight.diffuse=light.color?Color3.FromArray(light.color):Color3.White();babylonLight.intensity=light.intensity==void 0?1:light.intensity;babylonLight.range=light.range==void 0?Number.MAX_VALUE:light.range;babylonLight.parent=babylonMesh;_this223._loader._babylonLights.push(babylonLight);GLTFLoader2.AddPointerMetadata(babylonLight,extensionContext);assign(babylonMesh);});});}}]);return KHR_lights;}();GLTFLoader2.RegisterExtension(NAME6,function(loader){return new KHR_lights(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_pbrSpecularGlossiness.js
var NAME7="KHR_materials_pbrSpecularGlossiness";var KHR_materials_pbrSpecularGlossiness=/*#__PURE__*/function(){function KHR_materials_pbrSpecularGlossiness(loader){_classCallCheck(this,KHR_materials_pbrSpecularGlossiness);this.name=NAME7;this.order=200;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME7);}_createClass(KHR_materials_pbrSpecularGlossiness,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this224=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this224._loader.loadMaterialBasePropertiesAsync(context,material,babylonMaterial));promises.push(_this224._loadSpecularGlossinessPropertiesAsync(extensionContext,material,extension,babylonMaterial));_this224._loader.loadMaterialAlphaProperties(context,material,babylonMaterial);return Promise.all(promises).then(function(){});});}},{key:"_loadSpecularGlossinessPropertiesAsync",value:function _loadSpecularGlossinessPropertiesAsync(context,material,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();babylonMaterial.metallic=null;babylonMaterial.roughness=null;if(properties.diffuseFactor){babylonMaterial.albedoColor=Color3.FromArray(properties.diffuseFactor);babylonMaterial.alpha=properties.diffuseFactor[3];}else{babylonMaterial.albedoColor=Color3.White();}babylonMaterial.reflectivityColor=properties.specularFactor?Color3.FromArray(properties.specularFactor):Color3.White();babylonMaterial.microSurface=properties.glossinessFactor==void 0?1:properties.glossinessFactor;if(properties.diffuseTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/diffuseTexture"),properties.diffuseTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Diffuse)");babylonMaterial.albedoTexture=texture;}));}if(properties.specularGlossinessTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/specularGlossinessTexture"),properties.specularGlossinessTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Specular Glossiness)");babylonMaterial.reflectivityTexture=texture;babylonMaterial.reflectivityTexture.hasAlpha=true;}));babylonMaterial.useMicroSurfaceFromReflectivityMapAlpha=true;}return Promise.all(promises).then(function(){});}}]);return KHR_materials_pbrSpecularGlossiness;}();GLTFLoader2.RegisterExtension(NAME7,function(loader){return new KHR_materials_pbrSpecularGlossiness(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_unlit.js
var NAME8="KHR_materials_unlit";var KHR_materials_unlit=/*#__PURE__*/function(){function KHR_materials_unlit(loader){_classCallCheck(this,KHR_materials_unlit);this.name=NAME8;this.order=210;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME8);}_createClass(KHR_materials_unlit,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this225=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(){return _this225._loadUnlitPropertiesAsync(context,material,babylonMaterial);});}},{key:"_loadUnlitPropertiesAsync",value:function _loadUnlitPropertiesAsync(context,material,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();babylonMaterial.unlit=true;var properties=material.pbrMetallicRoughness;if(properties){if(properties.baseColorFactor){babylonMaterial.albedoColor=Color3.FromArray(properties.baseColorFactor);babylonMaterial.alpha=properties.baseColorFactor[3];}else{babylonMaterial.albedoColor=Color3.White();}if(properties.baseColorTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/baseColorTexture"),properties.baseColorTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Base Color)");babylonMaterial.albedoTexture=texture;}));}}if(material.doubleSided){babylonMaterial.backFaceCulling=false;babylonMaterial.twoSidedLighting=true;}this._loader.loadMaterialAlphaProperties(context,material,babylonMaterial);return Promise.all(promises).then(function(){});}}]);return KHR_materials_unlit;}();GLTFLoader2.RegisterExtension(NAME8,function(loader){return new KHR_materials_unlit(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_clearcoat.js
var NAME9="KHR_materials_clearcoat";var KHR_materials_clearcoat=/*#__PURE__*/function(){function KHR_materials_clearcoat(loader){_classCallCheck(this,KHR_materials_clearcoat);this.name=NAME9;this.order=190;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME9);}_createClass(KHR_materials_clearcoat,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this226=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this226._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this226._loadClearCoatPropertiesAsync(extensionContext,extension,babylonMaterial));return Promise.all(promises).then(function(){});});}},{key:"_loadClearCoatPropertiesAsync",value:function _loadClearCoatPropertiesAsync(context,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();babylonMaterial.clearCoat.isEnabled=true;babylonMaterial.clearCoat.useRoughnessFromMainTexture=false;babylonMaterial.clearCoat.remapF0OnInterfaceChange=false;if(properties.clearcoatFactor!=void 0){babylonMaterial.clearCoat.intensity=properties.clearcoatFactor;}else{babylonMaterial.clearCoat.intensity=0;}if(properties.clearcoatTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/clearcoatTexture"),properties.clearcoatTexture,function(texture){texture.name="".concat(babylonMaterial.name," (ClearCoat Intensity)");babylonMaterial.clearCoat.texture=texture;}));}if(properties.clearcoatRoughnessFactor!=void 0){babylonMaterial.clearCoat.roughness=properties.clearcoatRoughnessFactor;}else{babylonMaterial.clearCoat.roughness=0;}if(properties.clearcoatRoughnessTexture){properties.clearcoatRoughnessTexture.nonColorData=true;promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/clearcoatRoughnessTexture"),properties.clearcoatRoughnessTexture,function(texture){texture.name="".concat(babylonMaterial.name," (ClearCoat Roughness)");babylonMaterial.clearCoat.textureRoughness=texture;}));}if(properties.clearcoatNormalTexture){properties.clearcoatNormalTexture.nonColorData=true;promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/clearcoatNormalTexture"),properties.clearcoatNormalTexture,function(texture){texture.name="".concat(babylonMaterial.name," (ClearCoat Normal)");babylonMaterial.clearCoat.bumpTexture=texture;}));babylonMaterial.invertNormalMapX=!babylonMaterial.getScene().useRightHandedSystem;babylonMaterial.invertNormalMapY=babylonMaterial.getScene().useRightHandedSystem;if(properties.clearcoatNormalTexture.scale!=void 0){babylonMaterial.clearCoat.bumpTexture.level=properties.clearcoatNormalTexture.scale;}}return Promise.all(promises).then(function(){});}}]);return KHR_materials_clearcoat;}();GLTFLoader2.RegisterExtension(NAME9,function(loader){return new KHR_materials_clearcoat(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_iridescence.js
var NAME10="KHR_materials_iridescence";var KHR_materials_iridescence=/*#__PURE__*/function(){function KHR_materials_iridescence(loader){_classCallCheck(this,KHR_materials_iridescence);this.name=NAME10;this.order=195;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME10);}_createClass(KHR_materials_iridescence,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this227=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this227._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this227._loadIridescencePropertiesAsync(extensionContext,extension,babylonMaterial));return Promise.all(promises).then(function(){});});}},{key:"_loadIridescencePropertiesAsync",value:function _loadIridescencePropertiesAsync(context,properties,babylonMaterial){var _a,_b,_c,_d,_e;if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();babylonMaterial.iridescence.isEnabled=true;babylonMaterial.iridescence.intensity=(_a=properties.iridescenceFactor)!==null&&_a!==void 0?_a:0;babylonMaterial.iridescence.indexOfRefraction=(_c=(_b=properties.iridescenceIor)!==null&&_b!==void 0?_b:properties.iridescenceIOR)!==null&&_c!==void 0?_c:1.3;babylonMaterial.iridescence.minimumThickness=(_d=properties.iridescenceThicknessMinimum)!==null&&_d!==void 0?_d:100;babylonMaterial.iridescence.maximumThickness=(_e=properties.iridescenceThicknessMaximum)!==null&&_e!==void 0?_e:400;if(properties.iridescenceTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/iridescenceTexture"),properties.iridescenceTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Iridescence Intensity)");babylonMaterial.iridescence.texture=texture;}));}if(properties.iridescenceThicknessTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/iridescenceThicknessTexture"),properties.iridescenceThicknessTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Iridescence Thickness)");babylonMaterial.iridescence.thicknessTexture=texture;}));}return Promise.all(promises).then(function(){});}}]);return KHR_materials_iridescence;}();GLTFLoader2.RegisterExtension(NAME10,function(loader){return new KHR_materials_iridescence(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_emissive_strength.js
var NAME11="KHR_materials_emissive_strength";var KHR_materials_emissive_strength=/*#__PURE__*/function(){function KHR_materials_emissive_strength(loader){_classCallCheck(this,KHR_materials_emissive_strength);this.name=NAME11;this.order=170;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME11);}_createClass(KHR_materials_emissive_strength,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this228=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){return _this228._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial).then(function(){_this228._loadEmissiveProperties(extensionContext,extension,babylonMaterial);});});}},{key:"_loadEmissiveProperties",value:function _loadEmissiveProperties(context,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}if(properties.emissiveStrength!==void 0){babylonMaterial.emissiveColor.scaleToRef(properties.emissiveStrength,babylonMaterial.emissiveColor);}}}]);return KHR_materials_emissive_strength;}();GLTFLoader2.RegisterExtension(NAME11,function(loader){return new KHR_materials_emissive_strength(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_sheen.js
var NAME12="KHR_materials_sheen";var KHR_materials_sheen=/*#__PURE__*/function(){function KHR_materials_sheen(loader){_classCallCheck(this,KHR_materials_sheen);this.name=NAME12;this.order=190;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME12);}_createClass(KHR_materials_sheen,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this229=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this229._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this229._loadSheenPropertiesAsync(extensionContext,extension,babylonMaterial));return Promise.all(promises).then(function(){});});}},{key:"_loadSheenPropertiesAsync",value:function _loadSheenPropertiesAsync(context,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();babylonMaterial.sheen.isEnabled=true;babylonMaterial.sheen.intensity=1;if(properties.sheenColorFactor!=void 0){babylonMaterial.sheen.color=Color3.FromArray(properties.sheenColorFactor);}else{babylonMaterial.sheen.color=Color3.Black();}if(properties.sheenColorTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/sheenColorTexture"),properties.sheenColorTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Sheen Color)");babylonMaterial.sheen.texture=texture;}));}if(properties.sheenRoughnessFactor!==void 0){babylonMaterial.sheen.roughness=properties.sheenRoughnessFactor;}else{babylonMaterial.sheen.roughness=0;}if(properties.sheenRoughnessTexture){properties.sheenRoughnessTexture.nonColorData=true;promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/sheenRoughnessTexture"),properties.sheenRoughnessTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Sheen Roughness)");babylonMaterial.sheen.textureRoughness=texture;}));}babylonMaterial.sheen.albedoScaling=true;babylonMaterial.sheen.useRoughnessFromMainTexture=false;return Promise.all(promises).then(function(){});}}]);return KHR_materials_sheen;}();GLTFLoader2.RegisterExtension(NAME12,function(loader){return new KHR_materials_sheen(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_specular.js
var NAME13="KHR_materials_specular";var KHR_materials_specular=/*#__PURE__*/function(){function KHR_materials_specular(loader){_classCallCheck(this,KHR_materials_specular);this.name=NAME13;this.order=190;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME13);}_createClass(KHR_materials_specular,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this230=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this230._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this230._loadSpecularPropertiesAsync(extensionContext,extension,babylonMaterial));return Promise.all(promises).then(function(){});});}},{key:"_loadSpecularPropertiesAsync",value:function _loadSpecularPropertiesAsync(context,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var promises=new Array();if(properties.specularFactor!==void 0){babylonMaterial.metallicF0Factor=properties.specularFactor;}if(properties.specularColorFactor!==void 0){babylonMaterial.metallicReflectanceColor=Color3.FromArray(properties.specularColorFactor);}if(properties.specularTexture){properties.specularTexture.nonColorData=true;promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/specularTexture"),properties.specularTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Specular F0 Strength)");babylonMaterial.metallicReflectanceTexture=texture;babylonMaterial.useOnlyMetallicFromMetallicReflectanceTexture=true;}));}if(properties.specularColorTexture){promises.push(this._loader.loadTextureInfoAsync("".concat(context,"/specularColorTexture"),properties.specularColorTexture,function(texture){texture.name="".concat(babylonMaterial.name," (Specular F0 Color)");babylonMaterial.reflectanceTexture=texture;}));}return Promise.all(promises).then(function(){});}}]);return KHR_materials_specular;}();GLTFLoader2.RegisterExtension(NAME13,function(loader){return new KHR_materials_specular(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_ior.js
var NAME14="KHR_materials_ior";var KHR_materials_ior=/*#__PURE__*/function(){function KHR_materials_ior(loader){_classCallCheck(this,KHR_materials_ior);this.name=NAME14;this.order=180;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME14);}_createClass(KHR_materials_ior,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this231=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this231._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this231._loadIorPropertiesAsync(extensionContext,extension,babylonMaterial));return Promise.all(promises).then(function(){});});}},{key:"_loadIorPropertiesAsync",value:function _loadIorPropertiesAsync(context,properties,babylonMaterial){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}if(properties.ior!==void 0){babylonMaterial.indexOfRefraction=properties.ior;}else{babylonMaterial.indexOfRefraction=KHR_materials_ior._DEFAULT_IOR;}return Promise.resolve();}}]);return KHR_materials_ior;}();KHR_materials_ior._DEFAULT_IOR=1.5;GLTFLoader2.RegisterExtension(NAME14,function(loader){return new KHR_materials_ior(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_variants.js
var NAME15="KHR_materials_variants";var KHR_materials_variants=/*#__PURE__*/function(){function KHR_materials_variants(loader){_classCallCheck(this,KHR_materials_variants);this.name=NAME15;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME15);}_createClass(KHR_materials_variants,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"getAvailableVariants",value:function getAvailableVariants(rootMesh){return KHR_materials_variants.GetAvailableVariants(rootMesh);}},{key:"selectVariant",value:function selectVariant(rootMesh,variantName){return KHR_materials_variants.SelectVariant(rootMesh,variantName);}},{key:"reset",value:function reset(rootMesh){return KHR_materials_variants.Reset(rootMesh);}},{key:"getLastSelectedVariant",value:function getLastSelectedVariant(rootMesh){return KHR_materials_variants.GetLastSelectedVariant(rootMesh);}},{key:"onLoading",value:function onLoading(){var extensions=this._loader.gltf.extensions;if(extensions&&extensions[this.name]){var extension=extensions[this.name];this._variants=extension.variants;}}},{key:"_loadMeshPrimitiveAsync",value:function _loadMeshPrimitiveAsync(context,name135,node,mesh,primitive,assign){var _this232=this;return GLTFLoader2.LoadExtensionAsync(context,primitive,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this232._loader._loadMeshPrimitiveAsync(context,name135,node,mesh,primitive,function(babylonMesh){assign(babylonMesh);if(babylonMesh instanceof Mesh){var babylonDrawMode=GLTFLoader2._GetDrawMode(context,primitive.mode);var root=_this232._loader.rootBabylonMesh;var metadata=root?root._internalMetadata=root._internalMetadata||{}:{};var gltf=metadata.gltf=metadata.gltf||{};var extensionMetadata=gltf[NAME15]=gltf[NAME15]||{lastSelected:null,original:[],variants:{}};extensionMetadata.original.push({mesh:babylonMesh,material:babylonMesh.material});var _loop15=function _loop15(){var mapping=extension.mappings[mappingIndex];var material=ArrayItem.Get("".concat(extensionContext,"/mappings/").concat(mappingIndex,"/material"),_this232._loader.gltf.materials,mapping.material);promises.push(_this232._loader._loadMaterialAsync("#/materials/".concat(mapping.material),material,babylonMesh,babylonDrawMode,function(babylonMaterial){var _loop16=function _loop16(){var variantIndex=mapping.variants[mappingVariantIndex];var variant=ArrayItem.Get("/extensions/".concat(NAME15,"/variants/").concat(variantIndex),_this232._variants,variantIndex);extensionMetadata.variants[variant.name]=extensionMetadata.variants[variant.name]||[];extensionMetadata.variants[variant.name].push({mesh:babylonMesh,material:babylonMaterial});babylonMesh.onClonedObservable.add(function(newOne){var newMesh=newOne;var metadata2=null;var newRoot=newMesh;do{newRoot=newRoot.parent;if(!newRoot){return;}metadata2=KHR_materials_variants._GetExtensionMetadata(newRoot);}while(metadata2===null);if(root&&metadata2===KHR_materials_variants._GetExtensionMetadata(root)){newRoot._internalMetadata={};for(var key in root._internalMetadata){newRoot._internalMetadata[key]=root._internalMetadata[key];}newRoot._internalMetadata.gltf=[];for(var _key41 in root._internalMetadata.gltf){newRoot._internalMetadata.gltf[_key41]=root._internalMetadata.gltf[_key41];}newRoot._internalMetadata.gltf[NAME15]={lastSelected:null,original:[],variants:{}};var _iterator231=_createForOfIteratorHelper(metadata2.original),_step244;try{for(_iterator231.s();!(_step244=_iterator231.n()).done;){var original=_step244.value;newRoot._internalMetadata.gltf[NAME15].original.push({mesh:original.mesh,material:original.material});}}catch(err){_iterator231.e(err);}finally{_iterator231.f();}for(var _key42 in metadata2.variants){if(Object.prototype.hasOwnProperty.call(metadata2.variants,_key42)){newRoot._internalMetadata.gltf[NAME15].variants[_key42]=[];var _iterator232=_createForOfIteratorHelper(metadata2.variants[_key42]),_step245;try{for(_iterator232.s();!(_step245=_iterator232.n()).done;){var variantEntry=_step245.value;newRoot._internalMetadata.gltf[NAME15].variants[_key42].push({mesh:variantEntry.mesh,material:variantEntry.material});}}catch(err){_iterator232.e(err);}finally{_iterator232.f();}}}metadata2=newRoot._internalMetadata.gltf[NAME15];}var _iterator233=_createForOfIteratorHelper(metadata2.original),_step246;try{for(_iterator233.s();!(_step246=_iterator233.n()).done;){var target=_step246.value;if(target.mesh===babylonMesh){target.mesh=newMesh;}}}catch(err){_iterator233.e(err);}finally{_iterator233.f();}var _iterator234=_createForOfIteratorHelper(metadata2.variants[variant.name]),_step247;try{for(_iterator234.s();!(_step247=_iterator234.n()).done;){var _target2=_step247.value;if(_target2.mesh===babylonMesh){_target2.mesh=newMesh;}}}catch(err){_iterator234.e(err);}finally{_iterator234.f();}});};for(var mappingVariantIndex=0;mappingVariantIndex<mapping.variants.length;++mappingVariantIndex){_loop16();}}));};for(var mappingIndex=0;mappingIndex<extension.mappings.length;++mappingIndex){_loop15();}}}));return Promise.all(promises).then(function(_ref22){var _ref23=_slicedToArray(_ref22,1),babylonMesh=_ref23[0];return babylonMesh;});});}}],[{key:"GetAvailableVariants",value:function GetAvailableVariants(rootMesh){var extensionMetadata=this._GetExtensionMetadata(rootMesh);if(!extensionMetadata){return[];}return Object.keys(extensionMetadata.variants);}},{key:"SelectVariant",value:function SelectVariant(rootMesh,variantName){var extensionMetadata=this._GetExtensionMetadata(rootMesh);if(!extensionMetadata){throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(NAME15," extension"));}var select=function select(variantName2){var entries=extensionMetadata.variants[variantName2];if(entries){var _iterator235=_createForOfIteratorHelper(entries),_step248;try{for(_iterator235.s();!(_step248=_iterator235.n()).done;){var entry=_step248.value;entry.mesh.material=entry.material;}}catch(err){_iterator235.e(err);}finally{_iterator235.f();}}};if(variantName instanceof Array){var _iterator236=_createForOfIteratorHelper(variantName),_step249;try{for(_iterator236.s();!(_step249=_iterator236.n()).done;){var name135=_step249.value;select(name135);}}catch(err){_iterator236.e(err);}finally{_iterator236.f();}}else{select(variantName);}extensionMetadata.lastSelected=variantName;}},{key:"Reset",value:function Reset(rootMesh){var extensionMetadata=this._GetExtensionMetadata(rootMesh);if(!extensionMetadata){throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(NAME15," extension"));}var _iterator237=_createForOfIteratorHelper(extensionMetadata.original),_step250;try{for(_iterator237.s();!(_step250=_iterator237.n()).done;){var entry=_step250.value;entry.mesh.material=entry.material;}}catch(err){_iterator237.e(err);}finally{_iterator237.f();}extensionMetadata.lastSelected=null;}},{key:"GetLastSelectedVariant",value:function GetLastSelectedVariant(rootMesh){var extensionMetadata=this._GetExtensionMetadata(rootMesh);if(!extensionMetadata){throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(NAME15," extension"));}return extensionMetadata.lastSelected;}},{key:"_GetExtensionMetadata",value:function _GetExtensionMetadata(rootMesh){var _a,_b;return((_b=(_a=rootMesh===null||rootMesh===void 0?void 0:rootMesh._internalMetadata)===null||_a===void 0?void 0:_a.gltf)===null||_b===void 0?void 0:_b[NAME15])||null;}}]);return KHR_materials_variants;}();GLTFLoader2.RegisterExtension(NAME15,function(loader){return new KHR_materials_variants(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_transmission.js
var TransmissionHelper=/*#__PURE__*/function(){function TransmissionHelper(options,scene2){var _this233=this;_classCallCheck(this,TransmissionHelper);this._opaqueRenderTarget=null;this._opaqueMeshesCache=[];this._transparentMeshesCache=[];this._materialObservers={};this._options=_objectSpread(_objectSpread({},TransmissionHelper._GetDefaultOptions()),options);this._scene=scene2;this._scene._transmissionHelper=this;this.onErrorObservable=new Observable();this._scene.onDisposeObservable.addOnce(function(){_this233.dispose();});this._parseScene();this._setupRenderTargets();}_createClass(TransmissionHelper,[{key:"updateOptions",value:function updateOptions(options){var _this234=this;var newValues=Object.keys(options).filter(function(key){return _this234._options[key]!==options[key];});if(!newValues.length){return;}var newOptions=_objectSpread(_objectSpread({},this._options),options);var oldOptions=this._options;this._options=newOptions;if(newOptions.renderSize!==oldOptions.renderSize||newOptions.renderTargetTextureType!==oldOptions.renderTargetTextureType||newOptions.generateMipmaps!==oldOptions.generateMipmaps||!this._opaqueRenderTarget){this._setupRenderTargets();}else{this._opaqueRenderTarget.samples=newOptions.samples;this._opaqueRenderTarget.lodGenerationScale=newOptions.lodGenerationScale;this._opaqueRenderTarget.lodGenerationOffset=newOptions.lodGenerationOffset;}}},{key:"getOpaqueTarget",value:function getOpaqueTarget(){return this._opaqueRenderTarget;}},{key:"_shouldRenderAsTransmission",value:function _shouldRenderAsTransmission(material){if(!material){return false;}if(material instanceof PBRMaterial&&material.subSurface.isRefractionEnabled){return true;}return false;}},{key:"_addMesh",value:function _addMesh(mesh){var _this235=this;this._materialObservers[mesh.uniqueId]=mesh.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this));Tools.SetImmediate(function(){if(_this235._shouldRenderAsTransmission(mesh.material)){mesh.material.refractionTexture=_this235._opaqueRenderTarget;_this235._transparentMeshesCache.push(mesh);}else{_this235._opaqueMeshesCache.push(mesh);}});}},{key:"_removeMesh",value:function _removeMesh(mesh){mesh.onMaterialChangedObservable.remove(this._materialObservers[mesh.uniqueId]);delete this._materialObservers[mesh.uniqueId];var idx=this._transparentMeshesCache.indexOf(mesh);if(idx!==-1){this._transparentMeshesCache.splice(idx,1);}idx=this._opaqueMeshesCache.indexOf(mesh);if(idx!==-1){this._opaqueMeshesCache.splice(idx,1);}}},{key:"_parseScene",value:function _parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this));this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this));this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this));}},{key:"_onMeshMaterialChanged",value:function _onMeshMaterialChanged(mesh){var transparentIdx=this._transparentMeshesCache.indexOf(mesh);var opaqueIdx=this._opaqueMeshesCache.indexOf(mesh);var useTransmission=this._shouldRenderAsTransmission(mesh.material);if(useTransmission){if(mesh.material instanceof PBRMaterial){mesh.material.subSurface.refractionTexture=this._opaqueRenderTarget;}if(opaqueIdx!==-1){this._opaqueMeshesCache.splice(opaqueIdx,1);this._transparentMeshesCache.push(mesh);}else if(transparentIdx===-1){this._transparentMeshesCache.push(mesh);}}else{if(transparentIdx!==-1){this._transparentMeshesCache.splice(transparentIdx,1);this._opaqueMeshesCache.push(mesh);}else if(opaqueIdx===-1){this._opaqueMeshesCache.push(mesh);}}}},{key:"_setupRenderTargets",value:function _setupRenderTargets(){var _this236=this;var _a,_b;if(this._opaqueRenderTarget){this._opaqueRenderTarget.dispose();}this._opaqueRenderTarget=new RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType);this._opaqueRenderTarget.ignoreCameraViewport=true;this._opaqueRenderTarget.renderList=this._opaqueMeshesCache;this._opaqueRenderTarget.clearColor=(_b=(_a=this._options.clearColor)===null||_a===void 0?void 0:_a.clone())!==null&&_b!==void 0?_b:this._scene.clearColor.clone();this._opaqueRenderTarget.gammaSpace=false;this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale;this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset;this._opaqueRenderTarget.samples=this._options.samples;var sceneImageProcessingapplyByPostProcess;var saveSceneEnvIntensity;this._opaqueRenderTarget.onBeforeBindObservable.add(function(opaqueRenderTarget){saveSceneEnvIntensity=_this236._scene.environmentIntensity;_this236._scene.environmentIntensity=1;sceneImageProcessingapplyByPostProcess=_this236._scene.imageProcessingConfiguration.applyByPostProcess;if(!_this236._options.clearColor){_this236._scene.clearColor.toLinearSpaceToRef(opaqueRenderTarget.clearColor);}else{opaqueRenderTarget.clearColor.copyFrom(_this236._options.clearColor);}_this236._scene.imageProcessingConfiguration._applyByPostProcess=true;});this._opaqueRenderTarget.onAfterUnbindObservable.add(function(){_this236._scene.environmentIntensity=saveSceneEnvIntensity;_this236._scene.imageProcessingConfiguration._applyByPostProcess=sceneImageProcessingapplyByPostProcess;});this._transparentMeshesCache.forEach(function(mesh){if(_this236._shouldRenderAsTransmission(mesh.material)){mesh.material.refractionTexture=_this236._opaqueRenderTarget;}});}},{key:"dispose",value:function dispose(){this._scene._transmissionHelper=void 0;if(this._opaqueRenderTarget){this._opaqueRenderTarget.dispose();this._opaqueRenderTarget=null;}this._transparentMeshesCache=[];this._opaqueMeshesCache=[];}}],[{key:"_GetDefaultOptions",value:function _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Constants.TEXTURETYPE_HALF_FLOAT,generateMipmaps:true};}}]);return TransmissionHelper;}();var NAME16="KHR_materials_transmission";var KHR_materials_transmission=/*#__PURE__*/function(){function KHR_materials_transmission(loader){_classCallCheck(this,KHR_materials_transmission);this.name=NAME16;this.order=175;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME16);if(this.enabled){loader.parent.transparencyAsCoverage=true;}}_createClass(KHR_materials_transmission,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this237=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this237._loader.loadMaterialBasePropertiesAsync(context,material,babylonMaterial));promises.push(_this237._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this237._loadTransparentPropertiesAsync(extensionContext,material,babylonMaterial,extension));return Promise.all(promises).then(function(){});});}},{key:"_loadTransparentPropertiesAsync",value:function _loadTransparentPropertiesAsync(context,material,babylonMaterial,extension){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var pbrMaterial=babylonMaterial;pbrMaterial.subSurface.isRefractionEnabled=true;pbrMaterial.subSurface.volumeIndexOfRefraction=1;pbrMaterial.subSurface.useAlbedoToTintRefraction=true;if(extension.transmissionFactor!==void 0){pbrMaterial.subSurface.refractionIntensity=extension.transmissionFactor;var scene2=pbrMaterial.getScene();if(pbrMaterial.subSurface.refractionIntensity&&!scene2._transmissionHelper){new TransmissionHelper({},pbrMaterial.getScene());}}else{pbrMaterial.subSurface.refractionIntensity=0;pbrMaterial.subSurface.isRefractionEnabled=false;return Promise.resolve();}pbrMaterial.subSurface.minimumThickness=0;pbrMaterial.subSurface.maximumThickness=0;if(extension.transmissionTexture){extension.transmissionTexture.nonColorData=true;return this._loader.loadTextureInfoAsync("".concat(context,"/transmissionTexture"),extension.transmissionTexture,void 0).then(function(texture){pbrMaterial.subSurface.refractionIntensityTexture=texture;pbrMaterial.subSurface.useGltfStyleTextures=true;});}else{return Promise.resolve();}}}]);return KHR_materials_transmission;}();GLTFLoader2.RegisterExtension(NAME16,function(loader){return new KHR_materials_transmission(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_translucency.js
var NAME17="KHR_materials_translucency";var KHR_materials_translucency=/*#__PURE__*/function(){function KHR_materials_translucency(loader){_classCallCheck(this,KHR_materials_translucency);this.name=NAME17;this.order=174;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME17);if(this.enabled){loader.parent.transparencyAsCoverage=true;}}_createClass(KHR_materials_translucency,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this238=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this238._loader.loadMaterialBasePropertiesAsync(context,material,babylonMaterial));promises.push(_this238._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this238._loadTranslucentPropertiesAsync(extensionContext,material,babylonMaterial,extension));return Promise.all(promises).then(function(){});});}},{key:"_loadTranslucentPropertiesAsync",value:function _loadTranslucentPropertiesAsync(context,material,babylonMaterial,extension){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}var pbrMaterial=babylonMaterial;pbrMaterial.subSurface.isTranslucencyEnabled=true;pbrMaterial.subSurface.volumeIndexOfRefraction=1;pbrMaterial.subSurface.minimumThickness=0;pbrMaterial.subSurface.maximumThickness=0;pbrMaterial.subSurface.useAlbedoToTintTranslucency=true;if(extension.translucencyFactor!==void 0){pbrMaterial.subSurface.translucencyIntensity=extension.translucencyFactor;}else{pbrMaterial.subSurface.translucencyIntensity=0;pbrMaterial.subSurface.isTranslucencyEnabled=false;return Promise.resolve();}if(extension.translucencyTexture){extension.translucencyTexture.nonColorData=true;return this._loader.loadTextureInfoAsync("".concat(context,"/translucencyTexture"),extension.translucencyTexture).then(function(texture){pbrMaterial.subSurface.translucencyIntensityTexture=texture;});}else{return Promise.resolve();}}}]);return KHR_materials_translucency;}();GLTFLoader2.RegisterExtension(NAME17,function(loader){return new KHR_materials_translucency(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_materials_volume.js
var NAME18="KHR_materials_volume";var KHR_materials_volume=/*#__PURE__*/function(){function KHR_materials_volume(loader){_classCallCheck(this,KHR_materials_volume);this.name=NAME18;this.order=173;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME18);if(this.enabled){this._loader._disableInstancedMesh++;}}_createClass(KHR_materials_volume,[{key:"dispose",value:function dispose(){if(this.enabled){this._loader._disableInstancedMesh--;}this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this239=this;return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this239._loader.loadMaterialBasePropertiesAsync(context,material,babylonMaterial));promises.push(_this239._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial));promises.push(_this239._loadVolumePropertiesAsync(extensionContext,material,babylonMaterial,extension));return Promise.all(promises).then(function(){});});}},{key:"_loadVolumePropertiesAsync",value:function _loadVolumePropertiesAsync(context,material,babylonMaterial,extension){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(context,": Material type not supported"));}if(!babylonMaterial.subSurface.isRefractionEnabled&&!babylonMaterial.subSurface.isTranslucencyEnabled||!extension.thicknessFactor){return Promise.resolve();}babylonMaterial.subSurface.volumeIndexOfRefraction=babylonMaterial.indexOfRefraction;var attenuationDistance=extension.attenuationDistance!==void 0?extension.attenuationDistance:Number.MAX_VALUE;babylonMaterial.subSurface.tintColorAtDistance=attenuationDistance;if(extension.attenuationColor!==void 0&&extension.attenuationColor.length==3){babylonMaterial.subSurface.tintColor.copyFromFloats(extension.attenuationColor[0],extension.attenuationColor[1],extension.attenuationColor[2]);}babylonMaterial.subSurface.minimumThickness=0;babylonMaterial.subSurface.maximumThickness=extension.thicknessFactor;babylonMaterial.subSurface.useThicknessAsDepth=true;if(extension.thicknessTexture){extension.thicknessTexture.nonColorData=true;return this._loader.loadTextureInfoAsync("".concat(context,"/thicknessTexture"),extension.thicknessTexture).then(function(texture){babylonMaterial.subSurface.thicknessTexture=texture;babylonMaterial.subSurface.useGltfStyleTextures=true;});}else{return Promise.resolve();}}}]);return KHR_materials_volume;}();GLTFLoader2.RegisterExtension(NAME18,function(loader){return new KHR_materials_volume(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_mesh_quantization.js
var NAME19="KHR_mesh_quantization";var KHR_mesh_quantization=/*#__PURE__*/function(){function KHR_mesh_quantization(loader){_classCallCheck(this,KHR_mesh_quantization);this.name=NAME19;this.enabled=loader.isExtensionUsed(NAME19);}_createClass(KHR_mesh_quantization,[{key:"dispose",value:function dispose(){}}]);return KHR_mesh_quantization;}();GLTFLoader2.RegisterExtension(NAME19,function(loader){return new KHR_mesh_quantization(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_texture_basisu.js
var NAME20="KHR_texture_basisu";var KHR_texture_basisu=/*#__PURE__*/function(){function KHR_texture_basisu(loader){_classCallCheck(this,KHR_texture_basisu);this.name=NAME20;this._loader=loader;this.enabled=loader.isExtensionUsed(NAME20);}_createClass(KHR_texture_basisu,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"_loadTextureAsync",value:function _loadTextureAsync(context,texture,assign){var _this240=this;return GLTFLoader2.LoadExtensionAsync(context,texture,this.name,function(extensionContext,extension){var sampler=texture.sampler==void 0?GLTFLoader2.DefaultSampler:ArrayItem.Get("".concat(context,"/sampler"),_this240._loader.gltf.samplers,texture.sampler);var image=ArrayItem.Get("".concat(extensionContext,"/source"),_this240._loader.gltf.images,extension.source);return _this240._loader._createTextureAsync(context,sampler,image,function(babylonTexture){assign(babylonTexture);},texture._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:true}:void 0,!texture._textureInfo.nonColorData);});}}]);return KHR_texture_basisu;}();GLTFLoader2.RegisterExtension(NAME20,function(loader){return new KHR_texture_basisu(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_texture_transform.js
var NAME21="KHR_texture_transform";var KHR_texture_transform=/*#__PURE__*/function(){function KHR_texture_transform(loader){_classCallCheck(this,KHR_texture_transform);this.name=NAME21;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME21);}_createClass(KHR_texture_transform,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadTextureInfoAsync",value:function loadTextureInfoAsync(context,textureInfo,assign){var _this241=this;return GLTFLoader2.LoadExtensionAsync(context,textureInfo,this.name,function(extensionContext,extension){return _this241._loader.loadTextureInfoAsync(context,textureInfo,function(babylonTexture){if(!(babylonTexture instanceof Texture)){throw new Error("".concat(extensionContext,": Texture type not supported"));}if(extension.offset){babylonTexture.uOffset=extension.offset[0];babylonTexture.vOffset=extension.offset[1];}babylonTexture.uRotationCenter=0;babylonTexture.vRotationCenter=0;if(extension.rotation){babylonTexture.wAng=-extension.rotation;}if(extension.scale){babylonTexture.uScale=extension.scale[0];babylonTexture.vScale=extension.scale[1];}if(extension.texCoord!=void 0){babylonTexture.coordinatesIndex=extension.texCoord;}assign(babylonTexture);});});}}]);return KHR_texture_transform;}();GLTFLoader2.RegisterExtension(NAME21,function(loader){return new KHR_texture_transform(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_xmp_json_ld.js
var NAME22="KHR_xmp_json_ld";var KHR_xmp_json_ld=/*#__PURE__*/function(){function KHR_xmp_json_ld(loader){_classCallCheck(this,KHR_xmp_json_ld);this.name=NAME22;this.order=100;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME22);}_createClass(KHR_xmp_json_ld,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"onLoading",value:function onLoading(){var _a,_b,_c;if(this._loader.rootBabylonMesh===null){return;}var xmp_gltf=(_a=this._loader.gltf.extensions)===null||_a===void 0?void 0:_a.KHR_xmp_json_ld;var xmp_node=(_c=(_b=this._loader.gltf.asset)===null||_b===void 0?void 0:_b.extensions)===null||_c===void 0?void 0:_c.KHR_xmp_json_ld;if(xmp_gltf&&xmp_node){var packet=+xmp_node.packet;if(xmp_gltf.packets&&packet<xmp_gltf.packets.length){this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{};this._loader.rootBabylonMesh.metadata.xmp=xmp_gltf.packets[packet];}}}}]);return KHR_xmp_json_ld;}();GLTFLoader2.RegisterExtension(NAME22,function(loader){return new KHR_xmp_json_ld(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_animation_pointer.data.js
function getColor3(_target,source,offset,scale){return Color3.FromArray(source,offset).scale(scale);}function getAlpha(_target,source,offset,scale){return source[offset+3]*scale;}function getFloat(_target,source,offset,scale){return source[offset]*scale;}function getMinusFloat(_target,source,offset,scale){return-source[offset]*scale;}function getNextFloat(_target,source,offset,scale){return source[offset+1]*scale;}function getFloatBy2(_target,source,offset,scale){return source[offset]*scale*2;}function getTextureTransformTree(textureName){return{scale:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"".concat(textureName,".uScale"),getFloat,function(){return 2;}),new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"".concat(textureName,".vScale"),getNextFloat,function(){return 2;})],offset:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"".concat(textureName,".uOffset"),getFloat,function(){return 2;}),new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"".concat(textureName,".vOffset"),getNextFloat,function(){return 2;})],rotation:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"".concat(textureName,".wAng"),getMinusFloat,function(){return 1;})]};}var CameraAnimationPropertyInfo=/*#__PURE__*/function(_AnimationPropertyInf3){_inherits(CameraAnimationPropertyInfo,_AnimationPropertyInf3);var _super75=_createSuper(CameraAnimationPropertyInfo);function CameraAnimationPropertyInfo(){_classCallCheck(this,CameraAnimationPropertyInfo);return _super75.apply(this,arguments);}_createClass(CameraAnimationPropertyInfo,[{key:"buildAnimations",value:function buildAnimations(target,name135,fps,keys,callback){callback(target._babylonCamera,this._buildAnimation(name135,fps,keys));}}]);return CameraAnimationPropertyInfo;}(AnimationPropertyInfo);var MaterialAnimationPropertyInfo=/*#__PURE__*/function(_AnimationPropertyInf4){_inherits(MaterialAnimationPropertyInfo,_AnimationPropertyInf4);var _super76=_createSuper(MaterialAnimationPropertyInfo);function MaterialAnimationPropertyInfo(){_classCallCheck(this,MaterialAnimationPropertyInfo);return _super76.apply(this,arguments);}_createClass(MaterialAnimationPropertyInfo,[{key:"buildAnimations",value:function buildAnimations(target,name135,fps,keys,callback){for(var fillMode in target._data){callback(target._data[fillMode].babylonMaterial,this._buildAnimation(name135,fps,keys));}}}]);return MaterialAnimationPropertyInfo;}(AnimationPropertyInfo);var LightAnimationPropertyInfo=/*#__PURE__*/function(_AnimationPropertyInf5){_inherits(LightAnimationPropertyInfo,_AnimationPropertyInf5);var _super77=_createSuper(LightAnimationPropertyInfo);function LightAnimationPropertyInfo(){_classCallCheck(this,LightAnimationPropertyInfo);return _super77.apply(this,arguments);}_createClass(LightAnimationPropertyInfo,[{key:"buildAnimations",value:function buildAnimations(target,name135,fps,keys,callback){callback(target._babylonLight,this._buildAnimation(name135,fps,keys));}}]);return LightAnimationPropertyInfo;}(AnimationPropertyInfo);var nodesTree={__array__:_objectSpread({__target__:true},nodeAnimationData)};var camerasTree={__array__:{__target__:true,orthographic:{xmag:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoLeft",getMinusFloat,function(){return 1;}),new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoRight",getNextFloat,function(){return 1;})],ymag:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoBottom",getMinusFloat,function(){return 1;}),new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"orthoTop",getNextFloat,function(){return 1;})],zfar:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"maxZ",getFloat,function(){return 1;})],znear:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"minZ",getFloat,function(){return 1;})]},perspective:{yfov:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"fov",getFloat,function(){return 1;})],zfar:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"maxZ",getFloat,function(){return 1;})],znear:[new CameraAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"minZ",getFloat,function(){return 1;})]}}};var materialsTree={__array__:{__target__:true,pbrMetallicRoughness:{baseColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"albedoColor",getColor3,function(){return 4;}),new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"alpha",getAlpha,function(){return 4;})],metallicFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"metallic",getFloat,function(){return 1;})],roughnessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"roughness",getFloat,function(){return 1;})],baseColorTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("albedoTexture")}}},emissiveFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"emissiveColor",getColor3,function(){return 3;})],normalTexture:{scale:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"bumpTexture.level",getFloat,function(){return 1;})]},occlusionTexture:{strength:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",getFloat,function(){return 1;})],extensions:{KHR_texture_transform:getTextureTransformTree("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:getTextureTransformTree("emissiveTexture")}},extensions:{KHR_materials_ior:{ior:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"indexOfRefraction",getFloat,function(){return 1;})]},KHR_materials_clearcoat:{clearcoatFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",getFloat,function(){return 1;})],clearcoatRoughnessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",getFloat,function(){return 1;})]},KHR_materials_sheen:{sheenColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"sheen.color",getColor3,function(){return 3;})],sheenRoughnessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"sheen.roughness",getFloat,function(){return 1;})]},KHR_materials_specular:{specularFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"metallicF0Factor",getFloat,function(){return 1;})],specularColorFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",getColor3,function(){return 3;})]},KHR_materials_emissive_strength:{emissiveStrength:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"emissiveIntensity",getFloat,function(){return 1;})]},KHR_materials_transmission:{transmissionFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",getFloat,function(){return 1;})]},KHR_materials_volume:{attenuationColor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",getColor3,function(){return 3;})],attenuationDistance:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",getFloat,function(){return 1;})],thicknessFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",getFloat,function(){return 1;})]},KHR_materials_iridescence:{iridescenceFactor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.intensity",getFloat,function(){return 1;})],iridescenceIor:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",getFloat,function(){return 1;})],iridescenceThicknessMinimum:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",getFloat,function(){return 1;})],iridescenceThicknessMaximum:[new MaterialAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",getFloat,function(){return 1;})]}}}};var extensionsTree={KHR_lights_punctual:{lights:{__array__:{__target__:true,color:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_COLOR3,"diffuse",getColor3,function(){return 3;})],intensity:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"intensity",getFloat,function(){return 1;})],range:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"range",getFloat,function(){return 1;})],spot:{innerConeAngle:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"innerAngle",getFloatBy2,function(){return 1;})],outerConeAngle:[new LightAnimationPropertyInfo(Animation.ANIMATIONTYPE_FLOAT,"angle",getFloatBy2,function(){return 1;})]}}}}};var animationPointerTree={nodes:nodesTree,materials:materialsTree,cameras:camerasTree,extensions:extensionsTree};// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/KHR_animation_pointer.js
var NAME23="KHR_animation_pointer";var KHR_animation_pointer=/*#__PURE__*/function(){function KHR_animation_pointer(loader){_classCallCheck(this,KHR_animation_pointer);this.name=NAME23;this._loader=loader;}_createClass(KHR_animation_pointer,[{key:"enabled",get:function get(){return this._loader.isExtensionUsed(NAME23);}},{key:"dispose",value:function dispose(){this._loader=null;}},{key:"_loadAnimationChannelAsync",value:function _loadAnimationChannelAsync(context,animationContext,animation,channel,onLoad){var _a;var extension=(_a=channel.target.extensions)===null||_a===void 0?void 0:_a.KHR_animation_pointer;if(!extension){return null;}if(channel.target.path!=="pointer"){Logger.Warn("".concat(context,"/target/path: Value (").concat(channel.target.path,") must be (","pointer",") when using the ").concat(this.name," extension"));}if(channel.target.node!=void 0){Logger.Warn("".concat(context,"/target/node: Value (").concat(channel.target.node,") must not be present when using the ").concat(this.name," extension"));}var extensionContext="".concat(context,"/extensions/").concat(this.name);var pointer=extension.pointer;if(!pointer){throw new Error("".concat(extensionContext,": Pointer is missing"));}var targetInfo=this._parseAnimationPointer("".concat(extensionContext,"/pointer"),pointer);if(!targetInfo){Logger.Warn("".concat(extensionContext,"/pointer: Invalid pointer (").concat(pointer,") skipped"));return null;}return this._loader._loadAnimationChannelFromTargetInfoAsync(context,animationContext,animation,channel,targetInfo,onLoad);}},{key:"_parseAnimationPointer",value:function _parseAnimationPointer(context,pointer){if(!pointer.startsWith("/")){Logger.Warn("".concat(context,": Value (").concat(pointer,") must start with a slash"));return null;}var parts=pointer.split("/");parts.shift();var node=animationPointerTree;var gltfCurrentNode=this._loader.gltf;var gltfTargetNode=void 0;var _iterator238=_createForOfIteratorHelper(parts),_step251;try{for(_iterator238.s();!(_step251=_iterator238.n()).done;){var part=_step251.value;if(node.__array__){node=node.__array__;}else{node=node[part];if(!node){return null;}}gltfCurrentNode=gltfCurrentNode&&gltfCurrentNode[part];if(node.__target__){gltfTargetNode=gltfCurrentNode;}}}catch(err){_iterator238.e(err);}finally{_iterator238.f();}if(!gltfTargetNode||!Array.isArray(node)){return null;}return{target:gltfTargetNode,properties:node};}}]);return KHR_animation_pointer;}();GLTFLoader2.RegisterExtension(NAME23,function(loader){return new KHR_animation_pointer(loader);});// node_modules/@babylonjs/core/Animations/animationEvent.js
var AnimationEvent=/*#__PURE__*/function(){function AnimationEvent(frame,action,onlyOnce){_classCallCheck(this,AnimationEvent);this.frame=frame;this.action=action;this.onlyOnce=onlyOnce;this.isDone=false;}_createClass(AnimationEvent,[{key:"_clone",value:function _clone(){return new AnimationEvent(this.frame,this.action,this.onlyOnce);}}]);return AnimationEvent;}();// node_modules/@babylonjs/core/Audio/sound.js
var Sound=/*#__PURE__*/function(){function Sound(name135,urlOrArrayBuffer,scene2){var _this242=this;var readyToPlayCallback=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var options=arguments.length>4?arguments[4]:undefined;_classCallCheck(this,Sound);var _a,_b,_c,_d,_e;this.autoplay=false;this._loop=false;this.useCustomAttenuation=false;this.isPlaying=false;this.isPaused=false;this.refDistance=1;this.rolloffFactor=1;this.maxDistance=100;this.distanceModel="linear";this.metadata=null;this.onEndedObservable=new Observable();this._spatialSound=false;this._panningModel="equalpower";this._playbackRate=1;this._streaming=false;this._startTime=0;this._currentTime=0;this._position=Vector3.Zero();this._localDirection=new Vector3(1,0,0);this._volume=1;this._isReadyToPlay=false;this._isDirectional=false;this._coneInnerAngle=360;this._coneOuterAngle=360;this._coneOuterGain=0;this._isOutputConnected=false;this._urlType="Unknown";this.name=name135;scene2=scene2||EngineStore.LastCreatedScene;if(!scene2){return;}this._scene=scene2;Sound._SceneComponentInitialization(scene2);this._readyToPlayCallback=readyToPlayCallback;this._customAttenuationFunction=function(currentVolume,currentDistance,maxDistance,refDistance,rolloffFactor){if(currentDistance<maxDistance){return currentVolume*(1-currentDistance/maxDistance);}else{return 0;}};if(options){this.autoplay=options.autoplay||false;this._loop=options.loop||false;if(options.volume!==void 0){this._volume=options.volume;}this._spatialSound=(_a=options.spatialSound)!==null&&_a!==void 0?_a:false;this.maxDistance=(_b=options.maxDistance)!==null&&_b!==void 0?_b:100;this.useCustomAttenuation=(_c=options.useCustomAttenuation)!==null&&_c!==void 0?_c:false;this.rolloffFactor=options.rolloffFactor||1;this.refDistance=options.refDistance||1;this.distanceModel=options.distanceModel||"linear";this._playbackRate=options.playbackRate||1;this._streaming=(_d=options.streaming)!==null&&_d!==void 0?_d:false;this._length=options.length;this._offset=options.offset;}if(((_e=Engine.audioEngine)===null||_e===void 0?void 0:_e.canUseWebAudio)&&Engine.audioEngine.audioContext){this._soundGain=Engine.audioEngine.audioContext.createGain();this._soundGain.gain.value=this._volume;this._inputAudioNode=this._soundGain;this._outputAudioNode=this._soundGain;if(this._spatialSound){this._createSpatialParameters();}this._scene.mainSoundTrack.addSound(this);var validParameter=true;if(urlOrArrayBuffer){try{if(typeof urlOrArrayBuffer==="string"){this._urlType="String";}else if(urlOrArrayBuffer instanceof ArrayBuffer){this._urlType="ArrayBuffer";}else if(urlOrArrayBuffer instanceof HTMLMediaElement){this._urlType="MediaElement";}else if(urlOrArrayBuffer instanceof MediaStream){this._urlType="MediaStream";}else if(urlOrArrayBuffer instanceof AudioBuffer){this._urlType="AudioBuffer";}else if(Array.isArray(urlOrArrayBuffer)){this._urlType="Array";}var urls=[];var codecSupportedFound=false;switch(this._urlType){case"MediaElement":this._streaming=true;this._isReadyToPlay=true;this._streamingSource=Engine.audioEngine.audioContext.createMediaElementSource(urlOrArrayBuffer);if(this.autoplay){this.play(0,this._offset,this._length);}if(this._readyToPlayCallback){this._readyToPlayCallback();}break;case"MediaStream":this._streaming=true;this._isReadyToPlay=true;this._streamingSource=Engine.audioEngine.audioContext.createMediaStreamSource(urlOrArrayBuffer);if(this.autoplay){this.play(0,this._offset,this._length);}if(this._readyToPlayCallback){this._readyToPlayCallback();}break;case"ArrayBuffer":if(urlOrArrayBuffer.byteLength>0){codecSupportedFound=true;this._soundLoaded(urlOrArrayBuffer);}break;case"AudioBuffer":this._audioBufferLoaded(urlOrArrayBuffer);break;case"String":urls.push(urlOrArrayBuffer);case"Array":if(urls.length===0){urls=urlOrArrayBuffer;}var _loop17=function _loop17(){var url=urls[i];codecSupportedFound=options&&options.skipCodecCheck||url.indexOf(".mp3",url.length-4)!==-1&&Engine.audioEngine.isMP3supported||url.indexOf(".ogg",url.length-4)!==-1&&Engine.audioEngine.isOGGsupported||url.indexOf(".wav",url.length-4)!==-1||url.indexOf(".m4a",url.length-4)!==-1||url.indexOf(".mp4",url.length-4)!==-1||url.indexOf("blob:")!==-1;if(codecSupportedFound){if(!_this242._streaming){_this242._scene._loadFile(url,function(data){_this242._soundLoaded(data);},void 0,true,true,function(exception){if(exception){Logger.Error("XHR "+exception.status+" error on: "+url+".");}Logger.Error("Sound creation aborted.");_this242._scene.mainSoundTrack.removeSound(_this242);});}else{_this242._htmlAudioElement=new Audio(url);_this242._htmlAudioElement.controls=false;_this242._htmlAudioElement.loop=_this242.loop;Tools.SetCorsBehavior(url,_this242._htmlAudioElement);_this242._htmlAudioElement.preload="auto";_this242._htmlAudioElement.addEventListener("canplaythrough",function(){_this242._isReadyToPlay=true;if(_this242.autoplay){_this242.play(0,_this242._offset,_this242._length);}if(_this242._readyToPlayCallback){_this242._readyToPlayCallback();}});document.body.appendChild(_this242._htmlAudioElement);_this242._htmlAudioElement.load();}return 1;// break
}};for(var i=0;i<urls.length;i++){if(_loop17())break;}break;default:validParameter=false;break;}if(!validParameter){Logger.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.");}else{if(!codecSupportedFound){this._isReadyToPlay=true;if(this._readyToPlayCallback){setTimeout(function(){if(_this242._readyToPlayCallback){_this242._readyToPlayCallback();}},1e3);}}}}catch(ex){Logger.Error("Unexpected error. Sound creation aborted.");this._scene.mainSoundTrack.removeSound(this);}}}else{this._scene.mainSoundTrack.addSound(this);if(Engine.audioEngine&&!Engine.audioEngine.WarnedWebAudioUnsupported){Logger.Error("Web Audio is not supported by your browser.");Engine.audioEngine.WarnedWebAudioUnsupported=true;}if(this._readyToPlayCallback){setTimeout(function(){if(_this242._readyToPlayCallback){_this242._readyToPlayCallback();}},1e3);}}}_createClass(Sound,[{key:"loop",get:function get(){return this._loop;},set:function set(value){if(value===this._loop){return;}this._loop=value;this.updateOptions({loop:value});}},{key:"currentTime",get:function get(){var _a;if(this._htmlAudioElement){return this._htmlAudioElement.currentTime;}if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.audioContext)&&(this.isPlaying||this.isPaused)){var timeSinceLastStart=this.isPaused?0:Engine.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+timeSinceLastStart;}return 0;}},{key:"spatialSound",get:function get(){return this._spatialSound;},set:function set(newValue){var _a;this._spatialSound=newValue;if(this._spatialSound&&((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&Engine.audioEngine.audioContext){this._createSpatialParameters();}}},{key:"dispose",value:function dispose(){var _a;if((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio){if(this.isPlaying){this.stop();}this._isReadyToPlay=false;if(this.soundTrackId===-1){this._scene.mainSoundTrack.removeSound(this);}else if(this._scene.soundTracks){this._scene.soundTracks[this.soundTrackId].removeSound(this);}if(this._soundGain){this._soundGain.disconnect();this._soundGain=null;}if(this._soundPanner){this._soundPanner.disconnect();this._soundPanner=null;}if(this._soundSource){this._soundSource.disconnect();this._soundSource=null;}this._audioBuffer=null;if(this._htmlAudioElement){this._htmlAudioElement.pause();this._htmlAudioElement.src="";document.body.removeChild(this._htmlAudioElement);}if(this._streamingSource){this._streamingSource.disconnect();}if(this._connectedTransformNode&&this._registerFunc){this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc);this._connectedTransformNode=null;}}}},{key:"isReady",value:function isReady(){return this._isReadyToPlay;}},{key:"getClassName",value:function getClassName(){return"Sound";}},{key:"_audioBufferLoaded",value:function _audioBufferLoaded(buffer){var _a;if(!((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.audioContext)){return;}this._audioBuffer=buffer;this._isReadyToPlay=true;if(this.autoplay){this.play(0,this._offset,this._length);}if(this._readyToPlayCallback){this._readyToPlayCallback();}}},{key:"_soundLoaded",value:function _soundLoaded(audioData){var _this243=this;var _a;if(!((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.audioContext)){return;}Engine.audioEngine.audioContext.decodeAudioData(audioData,function(buffer){_this243._audioBufferLoaded(buffer);},function(err){Logger.Error("Error while decoding audio data for: "+_this243.name+" / Error: "+err);});}},{key:"setAudioBuffer",value:function setAudioBuffer(audioBuffer){var _a;if((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio){this._audioBuffer=audioBuffer;this._isReadyToPlay=true;}}},{key:"updateOptions",value:function updateOptions(options){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k;if(options){this.loop=(_a=options.loop)!==null&&_a!==void 0?_a:this.loop;this.maxDistance=(_b=options.maxDistance)!==null&&_b!==void 0?_b:this.maxDistance;this.useCustomAttenuation=(_c=options.useCustomAttenuation)!==null&&_c!==void 0?_c:this.useCustomAttenuation;this.rolloffFactor=(_d=options.rolloffFactor)!==null&&_d!==void 0?_d:this.rolloffFactor;this.refDistance=(_e=options.refDistance)!==null&&_e!==void 0?_e:this.refDistance;this.distanceModel=(_f=options.distanceModel)!==null&&_f!==void 0?_f:this.distanceModel;this._playbackRate=(_g=options.playbackRate)!==null&&_g!==void 0?_g:this._playbackRate;this._length=(_h=options.length)!==null&&_h!==void 0?_h:void 0;this._setOffset((_j=options.offset)!==null&&_j!==void 0?_j:void 0);this.setVolume((_k=options.volume)!==null&&_k!==void 0?_k:this._volume);this._updateSpatialParameters();if(this.isPlaying){if(this._streaming&&this._htmlAudioElement){this._htmlAudioElement.playbackRate=this._playbackRate;if(this._htmlAudioElement.loop!==this.loop){this._htmlAudioElement.loop=this.loop;}}else{if(this._soundSource){this._soundSource.playbackRate.value=this._playbackRate;if(this._soundSource.loop!==this.loop){this._soundSource.loop=this.loop;}if(this._offset!==void 0&&this._soundSource.loopStart!==this._offset){this._soundSource.loopStart=this._offset;}if(this._length!==void 0&&this._length!==this._soundSource.loopEnd){this._soundSource.loopEnd=(this._offset|0)+this._length;}}}}}}},{key:"_createSpatialParameters",value:function _createSpatialParameters(){var _a,_b;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&Engine.audioEngine.audioContext){if(this._scene.headphone){this._panningModel="HRTF";}this._soundPanner=(_b=this._soundPanner)!==null&&_b!==void 0?_b:Engine.audioEngine.audioContext.createPanner();if(this._soundPanner&&this._outputAudioNode){this._updateSpatialParameters();this._soundPanner.connect(this._outputAudioNode);this._inputAudioNode=this._soundPanner;}}}},{key:"_updateSpatialParameters",value:function _updateSpatialParameters(){if(this._spatialSound&&this._soundPanner){if(this.useCustomAttenuation){this._soundPanner.distanceModel="linear";this._soundPanner.maxDistance=Number.MAX_VALUE;this._soundPanner.refDistance=1;this._soundPanner.rolloffFactor=1;this._soundPanner.panningModel=this._panningModel;}else{this._soundPanner.distanceModel=this.distanceModel;this._soundPanner.maxDistance=this.maxDistance;this._soundPanner.refDistance=this.refDistance;this._soundPanner.rolloffFactor=this.rolloffFactor;this._soundPanner.panningModel=this._panningModel;}}}},{key:"switchPanningModelToHRTF",value:function switchPanningModelToHRTF(){this._panningModel="HRTF";this._switchPanningModel();}},{key:"switchPanningModelToEqualPower",value:function switchPanningModelToEqualPower(){this._panningModel="equalpower";this._switchPanningModel();}},{key:"_switchPanningModel",value:function _switchPanningModel(){var _a;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._spatialSound&&this._soundPanner){this._soundPanner.panningModel=this._panningModel;}}},{key:"connectToSoundTrackAudioNode",value:function connectToSoundTrackAudioNode(soundTrackAudioNode){var _a;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._outputAudioNode){if(this._isOutputConnected){this._outputAudioNode.disconnect();}this._outputAudioNode.connect(soundTrackAudioNode);this._isOutputConnected=true;}}},{key:"setDirectionalCone",value:function setDirectionalCone(coneInnerAngle,coneOuterAngle,coneOuterGain){if(coneOuterAngle<coneInnerAngle){Logger.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle.");return;}this._coneInnerAngle=coneInnerAngle;this._coneOuterAngle=coneOuterAngle;this._coneOuterGain=coneOuterGain;this._isDirectional=true;if(this.isPlaying&&this.loop){this.stop();this.play(0,this._offset,this._length);}}},{key:"directionalConeInnerAngle",get:function get(){return this._coneInnerAngle;},set:function set(value){var _a;if(value!=this._coneInnerAngle){if(this._coneOuterAngle<value){Logger.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");return;}this._coneInnerAngle=value;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._spatialSound&&this._soundPanner){this._soundPanner.coneInnerAngle=this._coneInnerAngle;}}}},{key:"directionalConeOuterAngle",get:function get(){return this._coneOuterAngle;},set:function set(value){var _a;if(value!=this._coneOuterAngle){if(value<this._coneInnerAngle){Logger.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");return;}this._coneOuterAngle=value;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._spatialSound&&this._soundPanner){this._soundPanner.coneOuterAngle=this._coneOuterAngle;}}}},{key:"setPosition",value:function setPosition(newPosition){var _a;if(newPosition.equals(this._position)){return;}this._position.copyFrom(newPosition);if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)){this._soundPanner.positionX.value=this._position.x;this._soundPanner.positionY.value=this._position.y;this._soundPanner.positionZ.value=this._position.z;}}},{key:"setLocalDirectionToMesh",value:function setLocalDirectionToMesh(newLocalDirection){var _a;this._localDirection=newLocalDirection;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._connectedTransformNode&&this.isPlaying){this._updateDirection();}}},{key:"_updateDirection",value:function _updateDirection(){if(!this._connectedTransformNode||!this._soundPanner){return;}var mat=this._connectedTransformNode.getWorldMatrix();var direction=Vector3.TransformNormal(this._localDirection,mat);direction.normalize();this._soundPanner.orientationX.value=direction.x;this._soundPanner.orientationY.value=direction.y;this._soundPanner.orientationZ.value=direction.z;}},{key:"updateDistanceFromListener",value:function updateDistanceFromListener(){var _a;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){var distance=this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,distance,this.maxDistance,this.refDistance,this.rolloffFactor);}}},{key:"setAttenuationFunction",value:function setAttenuationFunction(callback){this._customAttenuationFunction=callback;}},{key:"play",value:function play(time,offset,length){var _this244=this;var _a,_b,_c,_d;if(this._isReadyToPlay&&this._scene.audioEnabled&&((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.audioContext)){try{var startTime=time?((_b=Engine.audioEngine)===null||_b===void 0?void 0:_b.audioContext.currentTime)+time:(_c=Engine.audioEngine)===null||_c===void 0?void 0:_c.audioContext.currentTime;if(!this._soundSource||!this._streamingSource){if(this._spatialSound&&this._soundPanner){if(!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)){this._soundPanner.positionX.value=this._position.x;this._soundPanner.positionY.value=this._position.y;this._soundPanner.positionZ.value=this._position.z;}if(this._isDirectional){this._soundPanner.coneInnerAngle=this._coneInnerAngle;this._soundPanner.coneOuterAngle=this._coneOuterAngle;this._soundPanner.coneOuterGain=this._coneOuterGain;if(this._connectedTransformNode){this._updateDirection();}else{this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z);}}}}if(this._streaming){if(!this._streamingSource){this._streamingSource=Engine.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement);this._htmlAudioElement.onended=function(){_this244._onended();};this._htmlAudioElement.playbackRate=this._playbackRate;}this._streamingSource.disconnect();if(this._inputAudioNode){this._streamingSource.connect(this._inputAudioNode);}if(this._htmlAudioElement){var tryToPlay=function tryToPlay(){var _a2,_b2;if((_a2=Engine.audioEngine)===null||_a2===void 0?void 0:_a2.unlocked){var playPromise=_this244._htmlAudioElement.play();if(playPromise!==void 0){playPromise["catch"](function(){var _a3,_b3;(_a3=Engine.audioEngine)===null||_a3===void 0?void 0:_a3.lock();if(_this244.loop||_this244.autoplay){(_b3=Engine.audioEngine)===null||_b3===void 0?void 0:_b3.onAudioUnlockedObservable.addOnce(function(){tryToPlay();});}});}}else{if(_this244.loop||_this244.autoplay){(_b2=Engine.audioEngine)===null||_b2===void 0?void 0:_b2.onAudioUnlockedObservable.addOnce(function(){tryToPlay();});}}};tryToPlay();}}else{var _tryToPlay=function _tryToPlay(){var _a2,_b2,_c2,_d2;if((_a2=Engine.audioEngine)===null||_a2===void 0?void 0:_a2.audioContext){length=length||_this244._length;if(offset!==void 0){_this244._setOffset(offset);}if(_this244._soundSource){var oldSource=_this244._soundSource;oldSource.onended=function(){oldSource.disconnect();};}_this244._soundSource=(_b2=Engine.audioEngine)===null||_b2===void 0?void 0:_b2.audioContext.createBufferSource();if(_this244._soundSource&&_this244._inputAudioNode){_this244._soundSource.buffer=_this244._audioBuffer;_this244._soundSource.connect(_this244._inputAudioNode);_this244._soundSource.loop=_this244.loop;if(offset!==void 0){_this244._soundSource.loopStart=offset;}if(length!==void 0){_this244._soundSource.loopEnd=(offset|0)+length;}_this244._soundSource.playbackRate.value=_this244._playbackRate;_this244._soundSource.onended=function(){_this244._onended();};startTime=time?((_c2=Engine.audioEngine)===null||_c2===void 0?void 0:_c2.audioContext.currentTime)+time:Engine.audioEngine.audioContext.currentTime;var actualOffset=((_this244.isPaused?_this244.currentTime:0)+((_d2=_this244._offset)!==null&&_d2!==void 0?_d2:0))%_this244._soundSource.buffer.duration;_this244._soundSource.start(startTime,actualOffset,_this244.loop?void 0:length);}}};if(((_d=Engine.audioEngine)===null||_d===void 0?void 0:_d.audioContext.state)==="suspended"){setTimeout(function(){var _a2;if(((_a2=Engine.audioEngine)===null||_a2===void 0?void 0:_a2.audioContext.state)==="suspended"){Engine.audioEngine.lock();if(_this244.loop||_this244.autoplay){Engine.audioEngine.onAudioUnlockedObservable.addOnce(function(){_tryToPlay();});}}else{_tryToPlay();}},500);}else{_tryToPlay();}}this._startTime=startTime;this.isPlaying=true;this.isPaused=false;}catch(ex){Logger.Error("Error while trying to play audio: "+this.name+", "+ex.message);}}}},{key:"_onended",value:function _onended(){this.isPlaying=false;this._startTime=0;this._currentTime=0;if(this.onended){this.onended();}this.onEndedObservable.notifyObservers(this);}},{key:"stop",value:function stop(time){var _this245=this;var _a;if(this.isPlaying){if(this._streaming){if(this._htmlAudioElement){this._htmlAudioElement.pause();if(this._htmlAudioElement.currentTime>0){this._htmlAudioElement.currentTime=0;}}else{this._streamingSource.disconnect();}this.isPlaying=false;}else if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.audioContext)&&this._soundSource){var stopTime=time?Engine.audioEngine.audioContext.currentTime+time:void 0;this._soundSource.onended=function(){_this245.isPlaying=false;_this245.isPaused=false;_this245._startTime=0;_this245._currentTime=0;if(_this245._soundSource){_this245._soundSource.onended=function(){return void 0;};}_this245._onended();};this._soundSource.stop(stopTime);}}else if(this.isPaused){this.isPaused=false;this._startTime=0;this._currentTime=0;}}},{key:"pause",value:function pause(){var _a;if(this.isPlaying){if(this._streaming){if(this._htmlAudioElement){this._htmlAudioElement.pause();}else{this._streamingSource.disconnect();}this.isPlaying=false;this.isPaused=true;}else if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.audioContext)&&this._soundSource){this._soundSource.onended=function(){return void 0;};this._soundSource.stop();this.isPlaying=false;this.isPaused=true;this._currentTime+=Engine.audioEngine.audioContext.currentTime-this._startTime;}}}},{key:"setVolume",value:function setVolume(newVolume,time){var _a;if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._soundGain){if(time&&Engine.audioEngine.audioContext){this._soundGain.gain.cancelScheduledValues(Engine.audioEngine.audioContext.currentTime);this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Engine.audioEngine.audioContext.currentTime);this._soundGain.gain.linearRampToValueAtTime(newVolume,Engine.audioEngine.audioContext.currentTime+time);}else{this._soundGain.gain.value=newVolume;}}this._volume=newVolume;}},{key:"setPlaybackRate",value:function setPlaybackRate(newPlaybackRate){this._playbackRate=newPlaybackRate;if(this.isPlaying){if(this._streaming&&this._htmlAudioElement){this._htmlAudioElement.playbackRate=this._playbackRate;}else if(this._soundSource){this._soundSource.playbackRate.value=this._playbackRate;}}}},{key:"getPlaybackRate",value:function getPlaybackRate(){return this._playbackRate;}},{key:"getVolume",value:function getVolume(){return this._volume;}},{key:"attachToMesh",value:function attachToMesh(transformNode){var _this246=this;if(this._connectedTransformNode&&this._registerFunc){this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc);this._registerFunc=null;}this._connectedTransformNode=transformNode;if(!this._spatialSound){this._spatialSound=true;this._createSpatialParameters();if(this.isPlaying&&this.loop){this.stop();this.play(0,this._offset,this._length);}}this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode);this._registerFunc=function(transformNode2){return _this246._onRegisterAfterWorldMatrixUpdate(transformNode2);};this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc);}},{key:"detachFromMesh",value:function detachFromMesh(){if(this._connectedTransformNode&&this._registerFunc){this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc);this._registerFunc=null;this._connectedTransformNode=null;}}},{key:"_onRegisterAfterWorldMatrixUpdate",value:function _onRegisterAfterWorldMatrixUpdate(node){var _a;if(!node.getBoundingInfo){this.setPosition(node.absolutePosition);}else{var mesh=node;var boundingInfo=mesh.getBoundingInfo();this.setPosition(boundingInfo.boundingSphere.centerWorld);}if(((_a=Engine.audioEngine)===null||_a===void 0?void 0:_a.canUseWebAudio)&&this._isDirectional&&this.isPlaying){this._updateDirection();}}},{key:"clone",value:function clone(){var _this247=this;if(!this._streaming){var setBufferAndRun=function setBufferAndRun(){if(_this247._isReadyToPlay){clonedSound._audioBuffer=_this247.getAudioBuffer();clonedSound._isReadyToPlay=true;if(clonedSound.autoplay){clonedSound.play(0,_this247._offset,_this247._length);}}else{setTimeout(setBufferAndRun,300);}};var currentOptions={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel};var clonedSound=new Sound(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,currentOptions);if(this.useCustomAttenuation){clonedSound.setAttenuationFunction(this._customAttenuationFunction);}clonedSound.setPosition(this._position);clonedSound.setPlaybackRate(this._playbackRate);setBufferAndRun();return clonedSound;}else{return null;}}},{key:"getAudioBuffer",value:function getAudioBuffer(){return this._audioBuffer;}},{key:"getSoundSource",value:function getSoundSource(){return this._soundSource;}},{key:"getSoundGain",value:function getSoundGain(){return this._soundGain;}},{key:"serialize",value:function serialize(){var serializationObject={name:this.name,url:this.name,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};if(this._spatialSound){if(this._connectedTransformNode){serializationObject.connectedMeshId=this._connectedTransformNode.id;}serializationObject.position=this._position.asArray();serializationObject.refDistance=this.refDistance;serializationObject.distanceModel=this.distanceModel;serializationObject.isDirectional=this._isDirectional;serializationObject.localDirectionToMesh=this._localDirection.asArray();serializationObject.coneInnerAngle=this._coneInnerAngle;serializationObject.coneOuterAngle=this._coneOuterAngle;serializationObject.coneOuterGain=this._coneOuterGain;}return serializationObject;}},{key:"_setOffset",value:function _setOffset(value){if(this._offset===value){return;}if(this.isPaused){this.stop();this.isPaused=false;}this._offset=value;}}],[{key:"Parse",value:function Parse(parsedSound,scene2,rootUrl,sourceSound){var soundName=parsedSound.name;var soundUrl;if(parsedSound.url){soundUrl=rootUrl+parsedSound.url;}else{soundUrl=rootUrl+soundName;}var options={autoplay:parsedSound.autoplay,loop:parsedSound.loop,volume:parsedSound.volume,spatialSound:parsedSound.spatialSound,maxDistance:parsedSound.maxDistance,rolloffFactor:parsedSound.rolloffFactor,refDistance:parsedSound.refDistance,distanceModel:parsedSound.distanceModel,playbackRate:parsedSound.playbackRate};var newSound;if(!sourceSound){newSound=new Sound(soundName,soundUrl,scene2,function(){scene2.removePendingData(newSound);},options);scene2.addPendingData(newSound);}else{var setBufferAndRun=function setBufferAndRun(){if(sourceSound._isReadyToPlay){newSound._audioBuffer=sourceSound.getAudioBuffer();newSound._isReadyToPlay=true;if(newSound.autoplay){newSound.play(0,newSound._offset,newSound._length);}}else{setTimeout(setBufferAndRun,300);}};newSound=new Sound(soundName,new ArrayBuffer(0),scene2,null,options);setBufferAndRun();}if(parsedSound.position){var soundPosition=Vector3.FromArray(parsedSound.position);newSound.setPosition(soundPosition);}if(parsedSound.isDirectional){newSound.setDirectionalCone(parsedSound.coneInnerAngle||360,parsedSound.coneOuterAngle||360,parsedSound.coneOuterGain||0);if(parsedSound.localDirectionToMesh){var localDirectionToMesh=Vector3.FromArray(parsedSound.localDirectionToMesh);newSound.setLocalDirectionToMesh(localDirectionToMesh);}}if(parsedSound.connectedMeshId){var connectedMesh=scene2.getMeshById(parsedSound.connectedMeshId);if(connectedMesh){newSound.attachToMesh(connectedMesh);}}if(parsedSound.metadata){newSound.metadata=parsedSound.metadata;}return newSound;}}]);return Sound;}();Sound._SceneComponentInitialization=function(_){throw _WarnImport("AudioSceneComponent");};// node_modules/@babylonjs/core/Audio/weightedsound.js
var WeightedSound=/*#__PURE__*/function(){function WeightedSound(loop,sounds,weights){var _this248=this;_classCallCheck(this,WeightedSound);this.loop=false;this._coneInnerAngle=360;this._coneOuterAngle=360;this._volume=1;this.isPlaying=false;this.isPaused=false;this._sounds=[];this._weights=[];if(sounds.length!==weights.length){throw new Error("Sounds length does not equal weights length");}this.loop=loop;this._weights=weights;var weightSum=0;var _iterator239=_createForOfIteratorHelper(weights),_step252;try{for(_iterator239.s();!(_step252=_iterator239.n()).done;){var weight=_step252.value;weightSum+=weight;}}catch(err){_iterator239.e(err);}finally{_iterator239.f();}var invWeightSum=weightSum>0?1/weightSum:0;for(var i=0;i<this._weights.length;i++){this._weights[i]*=invWeightSum;}this._sounds=sounds;var _iterator240=_createForOfIteratorHelper(this._sounds),_step253;try{for(_iterator240.s();!(_step253=_iterator240.n()).done;){var sound=_step253.value;sound.onEndedObservable.add(function(){_this248._onended();});}}catch(err){_iterator240.e(err);}finally{_iterator240.f();}}_createClass(WeightedSound,[{key:"directionalConeInnerAngle",get:function get(){return this._coneInnerAngle;},set:function set(value){if(value!==this._coneInnerAngle){if(this._coneOuterAngle<value){Logger.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");return;}this._coneInnerAngle=value;var _iterator241=_createForOfIteratorHelper(this._sounds),_step254;try{for(_iterator241.s();!(_step254=_iterator241.n()).done;){var sound=_step254.value;sound.directionalConeInnerAngle=value;}}catch(err){_iterator241.e(err);}finally{_iterator241.f();}}}},{key:"directionalConeOuterAngle",get:function get(){return this._coneOuterAngle;},set:function set(value){if(value!==this._coneOuterAngle){if(value<this._coneInnerAngle){Logger.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");return;}this._coneOuterAngle=value;var _iterator242=_createForOfIteratorHelper(this._sounds),_step255;try{for(_iterator242.s();!(_step255=_iterator242.n()).done;){var sound=_step255.value;sound.directionalConeOuterAngle=value;}}catch(err){_iterator242.e(err);}finally{_iterator242.f();}}}},{key:"volume",get:function get(){return this._volume;},set:function set(value){if(value!==this._volume){var _iterator243=_createForOfIteratorHelper(this._sounds),_step256;try{for(_iterator243.s();!(_step256=_iterator243.n()).done;){var sound=_step256.value;sound.setVolume(value);}}catch(err){_iterator243.e(err);}finally{_iterator243.f();}}}},{key:"_onended",value:function _onended(){if(this._currentIndex!==void 0){this._sounds[this._currentIndex].autoplay=false;}if(this.loop&&this.isPlaying){this.play();}else{this.isPlaying=false;}}},{key:"pause",value:function pause(){this.isPaused=true;if(this._currentIndex!==void 0){this._sounds[this._currentIndex].pause();}}},{key:"stop",value:function stop(){this.isPlaying=false;if(this._currentIndex!==void 0){this._sounds[this._currentIndex].stop();}}},{key:"play",value:function play(startOffset){if(!this.isPaused){this.stop();var randomValue=Math.random();var total=0;for(var i=0;i<this._weights.length;i++){total+=this._weights[i];if(randomValue<=total){this._currentIndex=i;break;}}}var sound=this._sounds[this._currentIndex];if(sound.isReady()){sound.play(0,this.isPaused?void 0:startOffset);}else{sound.autoplay=true;}this.isPlaying=true;this.isPaused=false;}}]);return WeightedSound;}();// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/MSFT_audio_emitter.js
var NAME24="MSFT_audio_emitter";var MSFT_audio_emitter=/*#__PURE__*/function(){function MSFT_audio_emitter(loader){_classCallCheck(this,MSFT_audio_emitter);this.name=NAME24;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME24);}_createClass(MSFT_audio_emitter,[{key:"dispose",value:function dispose(){this._loader=null;this._clips=null;this._emitters=null;}},{key:"onLoading",value:function onLoading(){var extensions=this._loader.gltf.extensions;if(extensions&&extensions[this.name]){var extension=extensions[this.name];this._clips=extension.clips;this._emitters=extension.emitters;ArrayItem.Assign(this._clips);ArrayItem.Assign(this._emitters);}}},{key:"loadSceneAsync",value:function loadSceneAsync(context,scene2){var _this249=this;return GLTFLoader2.LoadExtensionAsync(context,scene2,this.name,function(extensionContext,extension){var promises=new Array();promises.push(_this249._loader.loadSceneAsync(context,scene2));var _iterator244=_createForOfIteratorHelper(extension.emitters),_step257;try{for(_iterator244.s();!(_step257=_iterator244.n()).done;){var emitterIndex=_step257.value;var emitter=ArrayItem.Get("".concat(extensionContext,"/emitters"),_this249._emitters,emitterIndex);if(emitter.refDistance!=void 0||emitter.maxDistance!=void 0||emitter.rolloffFactor!=void 0||emitter.distanceModel!=void 0||emitter.innerAngle!=void 0||emitter.outerAngle!=void 0){throw new Error("".concat(extensionContext,": Direction or Distance properties are not allowed on emitters attached to a scene"));}promises.push(_this249._loadEmitterAsync("".concat(extensionContext,"/emitters/").concat(emitter.index),emitter));}}catch(err){_iterator244.e(err);}finally{_iterator244.f();}return Promise.all(promises).then(function(){});});}},{key:"loadNodeAsync",value:function loadNodeAsync(context,node,assign){var _this250=this;return GLTFLoader2.LoadExtensionAsync(context,node,this.name,function(extensionContext,extension){var promises=new Array();return _this250._loader.loadNodeAsync(extensionContext,node,function(babylonMesh){var _iterator245=_createForOfIteratorHelper(extension.emitters),_step258;try{var _loop18=function _loop18(){var emitterIndex=_step258.value;var emitter=ArrayItem.Get("".concat(extensionContext,"/emitters"),_this250._emitters,emitterIndex);promises.push(_this250._loadEmitterAsync("".concat(extensionContext,"/emitters/").concat(emitter.index),emitter).then(function(){var _iterator246=_createForOfIteratorHelper(emitter._babylonSounds),_step259;try{for(_iterator246.s();!(_step259=_iterator246.n()).done;){var sound=_step259.value;sound.attachToMesh(babylonMesh);if(emitter.innerAngle!=void 0||emitter.outerAngle!=void 0){sound.setLocalDirectionToMesh(Vector3.Forward());sound.setDirectionalCone(2*Tools.ToDegrees(emitter.innerAngle==void 0?Math.PI:emitter.innerAngle),2*Tools.ToDegrees(emitter.outerAngle==void 0?Math.PI:emitter.outerAngle),0);}}}catch(err){_iterator246.e(err);}finally{_iterator246.f();}}));};for(_iterator245.s();!(_step258=_iterator245.n()).done;){_loop18();}}catch(err){_iterator245.e(err);}finally{_iterator245.f();}assign(babylonMesh);}).then(function(babylonMesh){return Promise.all(promises).then(function(){return babylonMesh;});});});}},{key:"loadAnimationAsync",value:function loadAnimationAsync(context,animation){var _this251=this;return GLTFLoader2.LoadExtensionAsync(context,animation,this.name,function(extensionContext,extension){return _this251._loader.loadAnimationAsync(context,animation).then(function(babylonAnimationGroup){var promises=new Array();ArrayItem.Assign(extension.events);var _iterator247=_createForOfIteratorHelper(extension.events),_step260;try{for(_iterator247.s();!(_step260=_iterator247.n()).done;){var event=_step260.value;promises.push(_this251._loadAnimationEventAsync("".concat(extensionContext,"/events/").concat(event.index),context,animation,event,babylonAnimationGroup));}}catch(err){_iterator247.e(err);}finally{_iterator247.f();}return Promise.all(promises).then(function(){return babylonAnimationGroup;});});});}},{key:"_loadClipAsync",value:function _loadClipAsync(context,clip){if(clip._objectURL){return clip._objectURL;}var promise;if(clip.uri){promise=this._loader.loadUriAsync(context,clip,clip.uri);}else{var bufferView=ArrayItem.Get("".concat(context,"/bufferView"),this._loader.gltf.bufferViews,clip.bufferView);promise=this._loader.loadBufferViewAsync("/bufferViews/".concat(bufferView.index),bufferView);}clip._objectURL=promise.then(function(data){return URL.createObjectURL(new Blob([data],{type:clip.mimeType}));});return clip._objectURL;}},{key:"_loadEmitterAsync",value:function _loadEmitterAsync(context,emitter){var _this252=this;emitter._babylonSounds=emitter._babylonSounds||[];if(!emitter._babylonData){var clipPromises=new Array();var name135=emitter.name||"emitter".concat(emitter.index);var options={loop:false,autoplay:false,volume:emitter.volume==void 0?1:emitter.volume};var _loop19=function _loop19(i){var clipContext="/extensions/".concat(_this252.name,"/clips");var clip=ArrayItem.Get(clipContext,_this252._clips,emitter.clips[i].clip);clipPromises.push(_this252._loadClipAsync("".concat(clipContext,"/").concat(emitter.clips[i].clip),clip).then(function(objectURL){var sound=emitter._babylonSounds[i]=new Sound(name135,objectURL,_this252._loader.babylonScene,null,options);sound.refDistance=emitter.refDistance||1;sound.maxDistance=emitter.maxDistance||256;sound.rolloffFactor=emitter.rolloffFactor||1;sound.distanceModel=emitter.distanceModel||"exponential";}));};for(var i=0;i<emitter.clips.length;i++){_loop19(i);}var promise=Promise.all(clipPromises).then(function(){var weights=emitter.clips.map(function(clip){return clip.weight||1;});var weightedSound=new WeightedSound(emitter.loop||false,emitter._babylonSounds,weights);if(emitter.innerAngle){weightedSound.directionalConeInnerAngle=2*Tools.ToDegrees(emitter.innerAngle);}if(emitter.outerAngle){weightedSound.directionalConeOuterAngle=2*Tools.ToDegrees(emitter.outerAngle);}if(emitter.volume){weightedSound.volume=emitter.volume;}emitter._babylonData.sound=weightedSound;});emitter._babylonData={loaded:promise};}return emitter._babylonData.loaded;}},{key:"_getEventAction",value:function _getEventAction(context,sound,action,time,startOffset){switch(action){case"play":{return function(currentFrame){var frameOffset=(startOffset||0)+(currentFrame-time);sound.play(frameOffset);};}case"stop":{return function(){sound.stop();};}case"pause":{return function(){sound.pause();};}default:{throw new Error("".concat(context,": Unsupported action ").concat(action));}}}},{key:"_loadAnimationEventAsync",value:function _loadAnimationEventAsync(context,animationContext,animation,event,babylonAnimationGroup){var _this253=this;if(babylonAnimationGroup.targetedAnimations.length==0){return Promise.resolve();}var babylonAnimation=babylonAnimationGroup.targetedAnimations[0];var emitterIndex=event.emitter;var emitter=ArrayItem.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,emitterIndex);return this._loadEmitterAsync(context,emitter).then(function(){var sound=emitter._babylonData.sound;if(sound){var babylonAnimationEvent=new AnimationEvent(event.time,_this253._getEventAction(context,sound,event.action,event.time,event.startOffset));babylonAnimation.animation.addEvent(babylonAnimationEvent);babylonAnimationGroup.onAnimationGroupEndObservable.add(function(){sound.stop();});babylonAnimationGroup.onAnimationGroupPauseObservable.add(function(){sound.pause();});}});}}]);return MSFT_audio_emitter;}();GLTFLoader2.RegisterExtension(NAME24,function(loader){return new MSFT_audio_emitter(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/MSFT_lod.js
var NAME25="MSFT_lod";var MSFT_lod=/*#__PURE__*/function(){function MSFT_lod(loader){_classCallCheck(this,MSFT_lod);this.name=NAME25;this.order=100;this.maxLODsToLoad=10;this.onNodeLODsLoadedObservable=new Observable();this.onMaterialLODsLoadedObservable=new Observable();this._bufferLODs=new Array();this._nodeIndexLOD=null;this._nodeSignalLODs=new Array();this._nodePromiseLODs=new Array();this._nodeBufferLODs=new Array();this._materialIndexLOD=null;this._materialSignalLODs=new Array();this._materialPromiseLODs=new Array();this._materialBufferLODs=new Array();this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME25);}_createClass(MSFT_lod,[{key:"dispose",value:function dispose(){this._loader=null;this._nodeIndexLOD=null;this._nodeSignalLODs.length=0;this._nodePromiseLODs.length=0;this._nodeBufferLODs.length=0;this._materialIndexLOD=null;this._materialSignalLODs.length=0;this._materialPromiseLODs.length=0;this._materialBufferLODs.length=0;this.onMaterialLODsLoadedObservable.clear();this.onNodeLODsLoadedObservable.clear();}},{key:"onReady",value:function onReady(){var _this254=this;var _loop20=function _loop20(indexLOD){var promise=Promise.all(_this254._nodePromiseLODs[indexLOD]).then(function(){if(indexLOD!==0){_this254._loader.endPerformanceCounter("Node LOD ".concat(indexLOD));_this254._loader.log("Loaded node LOD ".concat(indexLOD));}_this254.onNodeLODsLoadedObservable.notifyObservers(indexLOD);if(indexLOD!==_this254._nodePromiseLODs.length-1){_this254._loader.startPerformanceCounter("Node LOD ".concat(indexLOD+1));_this254._loadBufferLOD(_this254._nodeBufferLODs,indexLOD+1);if(_this254._nodeSignalLODs[indexLOD]){_this254._nodeSignalLODs[indexLOD].resolve();}}});_this254._loader._completePromises.push(promise);};for(var indexLOD=0;indexLOD<this._nodePromiseLODs.length;indexLOD++){_loop20(indexLOD);}var _loop21=function _loop21(_indexLOD){var promise=Promise.all(_this254._materialPromiseLODs[_indexLOD]).then(function(){if(_indexLOD!==0){_this254._loader.endPerformanceCounter("Material LOD ".concat(_indexLOD));_this254._loader.log("Loaded material LOD ".concat(_indexLOD));}_this254.onMaterialLODsLoadedObservable.notifyObservers(_indexLOD);if(_indexLOD!==_this254._materialPromiseLODs.length-1){_this254._loader.startPerformanceCounter("Material LOD ".concat(_indexLOD+1));_this254._loadBufferLOD(_this254._materialBufferLODs,_indexLOD+1);if(_this254._materialSignalLODs[_indexLOD]){_this254._materialSignalLODs[_indexLOD].resolve();}}});_this254._loader._completePromises.push(promise);};for(var _indexLOD=0;_indexLOD<this._materialPromiseLODs.length;_indexLOD++){_loop21(_indexLOD);}}},{key:"loadSceneAsync",value:function loadSceneAsync(context,scene2){var promise=this._loader.loadSceneAsync(context,scene2);this._loadBufferLOD(this._bufferLODs,0);return promise;}},{key:"loadNodeAsync",value:function loadNodeAsync(context,node,assign){var _this255=this;return GLTFLoader2.LoadExtensionAsync(context,node,this.name,function(extensionContext,extension){var firstPromise;var nodeLODs=_this255._getLODs(extensionContext,node,_this255._loader.gltf.nodes,extension.ids);_this255._loader.logOpen("".concat(extensionContext));var _loop22=function _loop22(indexLOD){var nodeLOD=nodeLODs[indexLOD];if(indexLOD!==0){_this255._nodeIndexLOD=indexLOD;_this255._nodeSignalLODs[indexLOD]=_this255._nodeSignalLODs[indexLOD]||new Deferred();}var assignWrap=function assignWrap(babylonTransformNode){assign(babylonTransformNode);babylonTransformNode.setEnabled(false);};var promise=_this255._loader.loadNodeAsync("/nodes/".concat(nodeLOD.index),nodeLOD,assignWrap).then(function(babylonMesh){if(indexLOD!==0){var previousNodeLOD=nodeLODs[indexLOD-1];if(previousNodeLOD._babylonTransformNode){_this255._disposeTransformNode(previousNodeLOD._babylonTransformNode);delete previousNodeLOD._babylonTransformNode;}}babylonMesh.setEnabled(true);return babylonMesh;});_this255._nodePromiseLODs[indexLOD]=_this255._nodePromiseLODs[indexLOD]||[];if(indexLOD===0){firstPromise=promise;}else{_this255._nodeIndexLOD=null;_this255._nodePromiseLODs[indexLOD].push(promise);}};for(var indexLOD=0;indexLOD<nodeLODs.length;indexLOD++){_loop22(indexLOD);}_this255._loader.logClose();return firstPromise;});}},{key:"_loadMaterialAsync",value:function _loadMaterialAsync(context,material,babylonMesh,babylonDrawMode,assign){var _this256=this;if(this._nodeIndexLOD){return null;}return GLTFLoader2.LoadExtensionAsync(context,material,this.name,function(extensionContext,extension){var firstPromise;var materialLODs=_this256._getLODs(extensionContext,material,_this256._loader.gltf.materials,extension.ids);_this256._loader.logOpen("".concat(extensionContext));var _loop23=function _loop23(indexLOD){var materialLOD=materialLODs[indexLOD];if(indexLOD!==0){_this256._materialIndexLOD=indexLOD;}var promise=_this256._loader._loadMaterialAsync("/materials/".concat(materialLOD.index),materialLOD,babylonMesh,babylonDrawMode,function(babylonMaterial){if(indexLOD===0){assign(babylonMaterial);}}).then(function(babylonMaterial){if(indexLOD!==0){assign(babylonMaterial);var previousDataLOD=materialLODs[indexLOD-1]._data;if(previousDataLOD[babylonDrawMode]){_this256._disposeMaterials([previousDataLOD[babylonDrawMode].babylonMaterial]);delete previousDataLOD[babylonDrawMode];}}return babylonMaterial;});_this256._materialPromiseLODs[indexLOD]=_this256._materialPromiseLODs[indexLOD]||[];if(indexLOD===0){firstPromise=promise;}else{_this256._materialIndexLOD=null;_this256._materialPromiseLODs[indexLOD].push(promise);}};for(var indexLOD=0;indexLOD<materialLODs.length;indexLOD++){_loop23(indexLOD);}_this256._loader.logClose();return firstPromise;});}},{key:"_loadUriAsync",value:function _loadUriAsync(context,property,uri){var _this257=this;if(this._nodeIndexLOD!==null){this._loader.log("deferred");var previousIndexLOD=this._nodeIndexLOD-1;this._nodeSignalLODs[previousIndexLOD]=this._nodeSignalLODs[previousIndexLOD]||new Deferred();return this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return _this257._loader.loadUriAsync(context,property,uri);});}else if(this._materialIndexLOD!==null){this._loader.log("deferred");var _previousIndexLOD=this._materialIndexLOD-1;this._materialSignalLODs[_previousIndexLOD]=this._materialSignalLODs[_previousIndexLOD]||new Deferred();return this._materialSignalLODs[_previousIndexLOD].promise.then(function(){return _this257._loader.loadUriAsync(context,property,uri);});}return null;}},{key:"loadBufferAsync",value:function loadBufferAsync(context,buffer,byteOffset,byteLength){if(this._loader.parent.useRangeRequests&&!buffer.uri){if(!this._loader.bin){throw new Error("".concat(context,": Uri is missing or the binary glTF is missing its binary chunk"));}var loadAsync=function loadAsync(bufferLODs,indexLOD){var start=byteOffset;var end=start+byteLength-1;var bufferLOD=bufferLODs[indexLOD];if(bufferLOD){bufferLOD.start=Math.min(bufferLOD.start,start);bufferLOD.end=Math.max(bufferLOD.end,end);}else{bufferLOD={start:start,end:end,loaded:new Deferred()};bufferLODs[indexLOD]=bufferLOD;}return bufferLOD.loaded.promise.then(function(data){return new Uint8Array(data.buffer,data.byteOffset+byteOffset-bufferLOD.start,byteLength);});};this._loader.log("deferred");if(this._nodeIndexLOD!==null){return loadAsync(this._nodeBufferLODs,this._nodeIndexLOD);}else if(this._materialIndexLOD!==null){return loadAsync(this._materialBufferLODs,this._materialIndexLOD);}else{return loadAsync(this._bufferLODs,0);}}return null;}},{key:"_loadBufferLOD",value:function _loadBufferLOD(bufferLODs,indexLOD){var bufferLOD=bufferLODs[indexLOD];if(bufferLOD){this._loader.log("Loading buffer range [".concat(bufferLOD.start,"-").concat(bufferLOD.end,"]"));this._loader.bin.readAsync(bufferLOD.start,bufferLOD.end-bufferLOD.start+1).then(function(data){bufferLOD.loaded.resolve(data);},function(error){bufferLOD.loaded.reject(error);});}}},{key:"_getLODs",value:function _getLODs(context,property,array,ids){if(this.maxLODsToLoad<=0){throw new Error("maxLODsToLoad must be greater than zero");}var properties=new Array();for(var i=ids.length-1;i>=0;i--){properties.push(ArrayItem.Get("".concat(context,"/ids/").concat(ids[i]),array,ids[i]));if(properties.length===this.maxLODsToLoad){return properties;}}properties.push(property);return properties;}},{key:"_disposeTransformNode",value:function _disposeTransformNode(babylonTransformNode){var _this258=this;var babylonMaterials=new Array();var babylonMaterial=babylonTransformNode.material;if(babylonMaterial){babylonMaterials.push(babylonMaterial);}var _iterator248=_createForOfIteratorHelper(babylonTransformNode.getChildMeshes()),_step261;try{for(_iterator248.s();!(_step261=_iterator248.n()).done;){var babylonMesh=_step261.value;if(babylonMesh.material){babylonMaterials.push(babylonMesh.material);}}}catch(err){_iterator248.e(err);}finally{_iterator248.f();}babylonTransformNode.dispose();var babylonMaterialsToDispose=babylonMaterials.filter(function(babylonMaterial2){return _this258._loader.babylonScene.meshes.every(function(mesh){return mesh.material!=babylonMaterial2;});});this._disposeMaterials(babylonMaterialsToDispose);}},{key:"_disposeMaterials",value:function _disposeMaterials(babylonMaterials){var babylonTextures={};var _iterator249=_createForOfIteratorHelper(babylonMaterials),_step262;try{for(_iterator249.s();!(_step262=_iterator249.n()).done;){var _babylonMaterial=_step262.value;var _iterator251=_createForOfIteratorHelper(_babylonMaterial.getActiveTextures()),_step264;try{for(_iterator251.s();!(_step264=_iterator251.n()).done;){var babylonTexture=_step264.value;babylonTextures[babylonTexture.uniqueId]=babylonTexture;}}catch(err){_iterator251.e(err);}finally{_iterator251.f();}_babylonMaterial.dispose();}}catch(err){_iterator249.e(err);}finally{_iterator249.f();}for(var uniqueId in babylonTextures){var _iterator250=_createForOfIteratorHelper(this._loader.babylonScene.materials),_step263;try{for(_iterator250.s();!(_step263=_iterator250.n()).done;){var babylonMaterial=_step263.value;if(babylonMaterial.hasTexture(babylonTextures[uniqueId])){delete babylonTextures[uniqueId];}}}catch(err){_iterator250.e(err);}finally{_iterator250.f();}}for(var _uniqueId in babylonTextures){babylonTextures[_uniqueId].dispose();}}}]);return MSFT_lod;}();GLTFLoader2.RegisterExtension(NAME25,function(loader){return new MSFT_lod(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/MSFT_minecraftMesh.js
var NAME26="MSFT_minecraftMesh";var MSFT_minecraftMesh=/*#__PURE__*/function(){function MSFT_minecraftMesh(loader){_classCallCheck(this,MSFT_minecraftMesh);this.name=NAME26;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME26);}_createClass(MSFT_minecraftMesh,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this259=this;return GLTFLoader2.LoadExtraAsync(context,material,this.name,function(extraContext,extra){if(extra){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(extraContext,": Material type not supported"));}var promise=_this259._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial);if(babylonMaterial.needAlphaBlending()){babylonMaterial.forceDepthWrite=true;babylonMaterial.separateCullingPass=true;}babylonMaterial.backFaceCulling=babylonMaterial.forceDepthWrite;babylonMaterial.twoSidedLighting=true;return promise;}return null;});}}]);return MSFT_minecraftMesh;}();GLTFLoader2.RegisterExtension(NAME26,function(loader){return new MSFT_minecraftMesh(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/MSFT_sRGBFactors.js
var NAME27="MSFT_sRGBFactors";var MSFT_sRGBFactors=/*#__PURE__*/function(){function MSFT_sRGBFactors(loader){_classCallCheck(this,MSFT_sRGBFactors);this.name=NAME27;this._loader=loader;this.enabled=this._loader.isExtensionUsed(NAME27);}_createClass(MSFT_sRGBFactors,[{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadMaterialPropertiesAsync",value:function loadMaterialPropertiesAsync(context,material,babylonMaterial){var _this260=this;return GLTFLoader2.LoadExtraAsync(context,material,this.name,function(extraContext,extra){if(extra){if(!(babylonMaterial instanceof PBRMaterial)){throw new Error("".concat(extraContext,": Material type not supported"));}var promise=_this260._loader.loadMaterialPropertiesAsync(context,material,babylonMaterial);if(!babylonMaterial.albedoTexture){babylonMaterial.albedoColor.toLinearSpaceToRef(babylonMaterial.albedoColor);}if(!babylonMaterial.reflectivityTexture){babylonMaterial.reflectivityColor.toLinearSpaceToRef(babylonMaterial.reflectivityColor);}return promise;}return null;});}}]);return MSFT_sRGBFactors;}();GLTFLoader2.RegisterExtension(NAME27,function(loader){return new MSFT_sRGBFactors(loader);});// node_modules/@babylonjs/loaders/glTF/2.0/Extensions/ExtrasAsMetadata.js
var NAME28="ExtrasAsMetadata";var ExtrasAsMetadata=/*#__PURE__*/function(){function ExtrasAsMetadata(loader){_classCallCheck(this,ExtrasAsMetadata);this.name=NAME28;this.enabled=true;this._loader=loader;}_createClass(ExtrasAsMetadata,[{key:"_assignExtras",value:function _assignExtras(babylonObject,gltfProp){if(gltfProp.extras&&Object.keys(gltfProp.extras).length>0){var metadata=babylonObject.metadata=babylonObject.metadata||{};var gltf=metadata.gltf=metadata.gltf||{};gltf.extras=gltfProp.extras;}}},{key:"dispose",value:function dispose(){this._loader=null;}},{key:"loadNodeAsync",value:function loadNodeAsync(context,node,assign){var _this261=this;return this._loader.loadNodeAsync(context,node,function(babylonTransformNode){_this261._assignExtras(babylonTransformNode,node);assign(babylonTransformNode);});}},{key:"loadCameraAsync",value:function loadCameraAsync(context,camera,assign){var _this262=this;return this._loader.loadCameraAsync(context,camera,function(babylonCamera){_this262._assignExtras(babylonCamera,camera);assign(babylonCamera);});}},{key:"createMaterial",value:function createMaterial(context,material,babylonDrawMode){var babylonMaterial=this._loader.createMaterial(context,material,babylonDrawMode);this._assignExtras(babylonMaterial,material);return babylonMaterial;}}]);return ExtrasAsMetadata;}();GLTFLoader2.RegisterExtension(NAME28,function(loader){return new ExtrasAsMetadata(loader);});// node_modules/@babylonjs/core/Meshes/Builders/boxBuilder.js
function CreateBoxVertexData(options){var nbFaces=6;var indices=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];var normals=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0];var uvs=[];var positions=[];var width=options.width||options.size||1;var height=options.height||options.size||1;var depth=options.depth||options.size||1;var wrap=options.wrap||false;var topBaseAt=options.topBaseAt===void 0?1:options.topBaseAt;var bottomBaseAt=options.bottomBaseAt===void 0?0:options.bottomBaseAt;topBaseAt=(topBaseAt+4)%4;bottomBaseAt=(bottomBaseAt+4)%4;var topOrder=[2,0,3,1];var bottomOrder=[2,0,1,3];var topIndex=topOrder[topBaseAt];var bottomIndex=bottomOrder[bottomBaseAt];var basePositions=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(wrap){indices=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14];basePositions=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];var topFaceBase=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]];var bottomFaceBase=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];var topFaceOrder=[17,18,19,16];var bottomFaceOrder=[22,23,20,21];while(topIndex>0){topFaceBase.unshift(topFaceBase.pop());topFaceOrder.unshift(topFaceOrder.pop());topIndex--;}while(bottomIndex>0){bottomFaceBase.unshift(bottomFaceBase.pop());bottomFaceOrder.unshift(bottomFaceOrder.pop());bottomIndex--;}topFaceBase=topFaceBase.flat();bottomFaceBase=bottomFaceBase.flat();basePositions=basePositions.concat(topFaceBase).concat(bottomFaceBase);indices.push(topFaceOrder[0],topFaceOrder[2],topFaceOrder[3],topFaceOrder[0],topFaceOrder[1],topFaceOrder[2]);indices.push(bottomFaceOrder[0],bottomFaceOrder[2],bottomFaceOrder[3],bottomFaceOrder[0],bottomFaceOrder[1],bottomFaceOrder[2]);}var scaleArray=[width/2,height/2,depth/2];positions=basePositions.reduce(function(accumulator,currentValue,currentIndex){return accumulator.concat(currentValue*scaleArray[currentIndex%3]);},[]);var sideOrientation=options.sideOrientation===0?0:options.sideOrientation||VertexData.DEFAULTSIDE;var faceUV=options.faceUV||new Array(6);var faceColors=options.faceColors;var colors=[];for(var f=0;f<6;f++){if(faceUV[f]===void 0){faceUV[f]=new Vector4(0,0,1,1);}if(faceColors&&faceColors[f]===void 0){faceColors[f]=new Color4(1,1,1,1);}}for(var index=0;index<nbFaces;index++){uvs.push(faceUV[index].z,CompatibilityOptions.UseOpenGLOrientationForUV?1-faceUV[index].w:faceUV[index].w);uvs.push(faceUV[index].x,CompatibilityOptions.UseOpenGLOrientationForUV?1-faceUV[index].w:faceUV[index].w);uvs.push(faceUV[index].x,CompatibilityOptions.UseOpenGLOrientationForUV?1-faceUV[index].y:faceUV[index].y);uvs.push(faceUV[index].z,CompatibilityOptions.UseOpenGLOrientationForUV?1-faceUV[index].y:faceUV[index].y);if(faceColors){for(var c=0;c<4;c++){colors.push(faceColors[index].r,faceColors[index].g,faceColors[index].b,faceColors[index].a);}}}VertexData._ComputeSides(sideOrientation,positions,indices,normals,uvs,options.frontUVs,options.backUVs);var vertexData=new VertexData();vertexData.indices=indices;vertexData.positions=positions;vertexData.normals=normals;vertexData.uvs=uvs;if(faceColors){var totalColors=sideOrientation===VertexData.DOUBLESIDE?colors.concat(colors):colors;vertexData.colors=totalColors;}return vertexData;}function CreateBox(name135){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var box=new Mesh(name135,scene2);options.sideOrientation=Mesh._GetDefaultSideOrientation(options.sideOrientation);box._originalBuilderSideOrientation=options.sideOrientation;var vertexData=CreateBoxVertexData(options);vertexData.applyToMesh(box,options.updatable);return box;}VertexData.CreateBox=CreateBoxVertexData;Mesh.CreateBox=function(name135,size){var scene2=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var updatable=arguments.length>3?arguments[3]:undefined;var sideOrientation=arguments.length>4?arguments[4]:undefined;var options={size:size,sideOrientation:sideOrientation,updatable:updatable};return CreateBox(name135,options,scene2);};// node_modules/@babylonjs/core/Shaders/ShadersInclude/boundingBoxRendererFragmentDeclaration.js
var name106="boundingBoxRendererFragmentDeclaration";var shader106="uniform vec4 color;\n";ShaderStore.IncludesShadersStore[name106]=shader106;// node_modules/@babylonjs/core/Shaders/ShadersInclude/boundingBoxRendererUboDeclaration.js
var name107="boundingBoxRendererUboDeclaration";var shader107="#ifdef WEBGL2\nuniform vec4 color;\nuniform mat4 world;\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n#else\nlayout(std140,column_major) uniform;\nuniform BoundingBoxRenderer {\nvec4 color;\nmat4 world;\nmat4 viewProjection;\nmat4 viewProjectionR;\n};\n#endif\n";ShaderStore.IncludesShadersStore[name107]=shader107;// node_modules/@babylonjs/core/Shaders/boundingBoxRenderer.fragment.js
var name108="boundingBoxRendererPixelShader";var shader108="#include<__decl__boundingBoxRendererFragment>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\ngl_FragColor=color;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";ShaderStore.ShadersStore[name108]=shader108;// node_modules/@babylonjs/core/Shaders/ShadersInclude/boundingBoxRendererVertexDeclaration.js
var name109="boundingBoxRendererVertexDeclaration";var shader109="uniform mat4 world;\nuniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\n";ShaderStore.IncludesShadersStore[name109]=shader109;// node_modules/@babylonjs/core/Shaders/boundingBoxRenderer.vertex.js
var name110="boundingBoxRendererVertexShader";var shader110="attribute vec3 position;\n#include<__decl__boundingBoxRendererVertex>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec4 worldPos=world*vec4(position,1.0);\n#ifdef MULTIVIEW\nif (gl_ViewID_OVR==0u) {\ngl_Position=viewProjection*worldPos;\n} else {\ngl_Position=viewProjectionR*worldPos;\n}\n#else\ngl_Position=viewProjection*worldPos;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";ShaderStore.ShadersStore[name110]=shader110;// node_modules/@babylonjs/core/Rendering/boundingBoxRenderer.js
Object.defineProperty(Scene.prototype,"forceShowBoundingBoxes",{get:function get(){return this._forceShowBoundingBoxes||false;},set:function set(value){this._forceShowBoundingBoxes=value;if(value){this.getBoundingBoxRenderer();}},enumerable:true,configurable:true});Scene.prototype.getBoundingBoxRenderer=function(){if(!this._boundingBoxRenderer){this._boundingBoxRenderer=new BoundingBoxRenderer(this);}return this._boundingBoxRenderer;};Object.defineProperty(AbstractMesh.prototype,"showBoundingBox",{get:function get(){return this._showBoundingBox||false;},set:function set(value){this._showBoundingBox=value;if(value){this.getScene().getBoundingBoxRenderer();}},enumerable:true,configurable:true});var BoundingBoxRenderer=/*#__PURE__*/function(){function BoundingBoxRenderer(scene2){_classCallCheck(this,BoundingBoxRenderer);this.name=SceneComponentConstants.NAME_BOUNDINGBOXRENDERER;this.frontColor=new Color3(1,1,1);this.backColor=new Color3(0.1,0.1,0.1);this.showBackLines=true;this.onBeforeBoxRenderingObservable=new Observable();this.onAfterBoxRenderingObservable=new Observable();this.onResourcesReadyObservable=new Observable();this.enabled=true;this.renderList=new SmartArray(32);this._vertexBuffers={};this._fillIndexBuffer=null;this._fillIndexData=null;this.scene=scene2;scene2._addComponent(this);this._uniformBufferFront=new UniformBuffer(this.scene.getEngine(),void 0,void 0,"BoundingBoxRendererFront",!this.scene.getEngine().isWebGPU);this._buildUniformLayout(this._uniformBufferFront);this._uniformBufferBack=new UniformBuffer(this.scene.getEngine(),void 0,void 0,"BoundingBoxRendererBack",!this.scene.getEngine().isWebGPU);this._buildUniformLayout(this._uniformBufferBack);}_createClass(BoundingBoxRenderer,[{key:"_buildUniformLayout",value:function _buildUniformLayout(ubo){ubo.addUniform("color",4);ubo.addUniform("world",16);ubo.addUniform("viewProjection",16);ubo.addUniform("viewProjectionR",16);ubo.create();}},{key:"register",value:function register(){this.scene._beforeEvaluateActiveMeshStage.registerStep(SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER,this,this.reset);this.scene._preActiveMeshStage.registerStep(SceneComponentConstants.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER,this,this._preActiveMesh);this.scene._evaluateSubMeshStage.registerStep(SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER,this,this._evaluateSubMesh);this.scene._afterRenderingGroupDrawStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER,this,this.render);}},{key:"_evaluateSubMesh",value:function _evaluateSubMesh(mesh,subMesh){if(mesh.showSubMeshesBoundingBox){var boundingInfo=subMesh.getBoundingInfo();if(boundingInfo!==null&&boundingInfo!==void 0){boundingInfo.boundingBox._tag=mesh.renderingGroupId;this.renderList.push(boundingInfo.boundingBox);}}}},{key:"_preActiveMesh",value:function _preActiveMesh(mesh){if(mesh.showBoundingBox||this.scene.forceShowBoundingBoxes){var boundingInfo=mesh.getBoundingInfo();boundingInfo.boundingBox._tag=mesh.renderingGroupId;this.renderList.push(boundingInfo.boundingBox);}}},{key:"_prepareResources",value:function _prepareResources(){if(this._colorShader){return;}this._colorShader=new ShaderMaterial("colorShader",this.scene,"boundingBoxRenderer",{attributes:[VertexBuffer.PositionKind],uniforms:["world","viewProjection","viewProjectionR","color"],uniformBuffers:["BoundingBoxRenderer"]},false);this._colorShader.doNotSerialize=true;this._colorShader.reservedDataStore={hidden:true};this._colorShaderForOcclusionQuery=new ShaderMaterial("colorShaderOccQuery",this.scene,"boundingBoxRenderer",{attributes:[VertexBuffer.PositionKind],uniforms:["world","viewProjection","viewProjectionR","color"],uniformBuffers:["BoundingBoxRenderer"]},true);this._colorShaderForOcclusionQuery.doNotSerialize=true;this._colorShaderForOcclusionQuery.reservedDataStore={hidden:true};var engine=this.scene.getEngine();var boxdata=CreateBoxVertexData({size:1});this._vertexBuffers[VertexBuffer.PositionKind]=new VertexBuffer(engine,boxdata.positions,VertexBuffer.PositionKind,false);this._createIndexBuffer();this._fillIndexData=boxdata.indices;this.onResourcesReadyObservable.notifyObservers(this);}},{key:"_createIndexBuffer",value:function _createIndexBuffer(){var engine=this.scene.getEngine();this._indexBuffer=engine.createIndexBuffer([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,7,1,6,2,5,3,4]);}},{key:"rebuild",value:function rebuild(){var vb=this._vertexBuffers[VertexBuffer.PositionKind];if(vb){vb._rebuild();}this._createIndexBuffer();}},{key:"reset",value:function reset(){this.renderList.reset();}},{key:"render",value:function render(renderingGroupId){var _a,_b;if(this.renderList.length===0||!this.enabled){return;}this._prepareResources();if(!this._colorShader.isReady()){return;}var engine=this.scene.getEngine();engine.setDepthWrite(false);var frontColor=this.frontColor.toColor4();var backColor=this.backColor.toColor4();var transformMatrix=this.scene.getTransformMatrix();for(var boundingBoxIndex=0;boundingBoxIndex<this.renderList.length;boundingBoxIndex++){var boundingBox=this.renderList.data[boundingBoxIndex];if(boundingBox._tag!==renderingGroupId){continue;}this._createWrappersForBoundingBox(boundingBox);this.onBeforeBoxRenderingObservable.notifyObservers(boundingBox);var min=boundingBox.minimum;var max=boundingBox.maximum;var diff=max.subtract(min);var median=min.add(diff.scale(0.5));var worldMatrix=Matrix.Scaling(diff.x,diff.y,diff.z).multiply(Matrix.Translation(median.x,median.y,median.z)).multiply(boundingBox.getWorldMatrix());var useReverseDepthBuffer=engine.useReverseDepthBuffer;if(this.showBackLines){var drawWrapperBack=(_a=boundingBox._drawWrapperBack)!==null&&_a!==void 0?_a:this._colorShader._getDrawWrapper();this._colorShader._preBind(drawWrapperBack);engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect());if(useReverseDepthBuffer){engine.setDepthFunctionToLessOrEqual();}else{engine.setDepthFunctionToGreaterOrEqual();}this._uniformBufferBack.bindToEffect(drawWrapperBack.effect,"BoundingBoxRenderer");this._uniformBufferBack.updateDirectColor4("color",backColor);this._uniformBufferBack.updateMatrix("world",worldMatrix);this._uniformBufferBack.updateMatrix("viewProjection",transformMatrix);this._uniformBufferBack.update();engine.drawElementsType(Material.LineListDrawMode,0,24);}var drawWrapperFront=(_b=boundingBox._drawWrapperFront)!==null&&_b!==void 0?_b:this._colorShader._getDrawWrapper();this._colorShader._preBind(drawWrapperFront);engine.bindBuffers(this._vertexBuffers,this._indexBuffer,this._colorShader.getEffect());if(useReverseDepthBuffer){engine.setDepthFunctionToGreater();}else{engine.setDepthFunctionToLess();}this._uniformBufferFront.bindToEffect(drawWrapperFront.effect,"BoundingBoxRenderer");this._uniformBufferFront.updateDirectColor4("color",frontColor);this._uniformBufferFront.updateMatrix("world",worldMatrix);this._uniformBufferFront.updateMatrix("viewProjection",transformMatrix);this._uniformBufferFront.update();engine.drawElementsType(Material.LineListDrawMode,0,24);this.onAfterBoxRenderingObservable.notifyObservers(boundingBox);}this._colorShader.unbind();engine.setDepthFunctionToLessOrEqual();engine.setDepthWrite(true);}},{key:"_createWrappersForBoundingBox",value:function _createWrappersForBoundingBox(boundingBox){if(!boundingBox._drawWrapperFront){var engine=this.scene.getEngine();boundingBox._drawWrapperFront=new DrawWrapper(engine);boundingBox._drawWrapperBack=new DrawWrapper(engine);boundingBox._drawWrapperFront.setEffect(this._colorShader.getEffect());boundingBox._drawWrapperBack.setEffect(this._colorShader.getEffect());}}},{key:"renderOcclusionBoundingBox",value:function renderOcclusionBoundingBox(mesh){var engine=this.scene.getEngine();if(this._renderPassIdForOcclusionQuery===void 0){this._renderPassIdForOcclusionQuery=engine.createRenderPassId("Render pass for occlusion query");}var currentRenderPassId=engine.currentRenderPassId;engine.currentRenderPassId=this._renderPassIdForOcclusionQuery;this._prepareResources();var subMesh=mesh.subMeshes[0];if(!this._colorShaderForOcclusionQuery.isReady(mesh,void 0,subMesh)||!mesh.hasBoundingInfo){engine.currentRenderPassId=currentRenderPassId;return;}if(!this._fillIndexBuffer){this._fillIndexBuffer=engine.createIndexBuffer(this._fillIndexData);}var useReverseDepthBuffer=engine.useReverseDepthBuffer;engine.setDepthWrite(false);engine.setColorWrite(false);var boundingBox=mesh.getBoundingInfo().boundingBox;var min=boundingBox.minimum;var max=boundingBox.maximum;var diff=max.subtract(min);var median=min.add(diff.scale(0.5));var worldMatrix=Matrix.Scaling(diff.x,diff.y,diff.z).multiply(Matrix.Translation(median.x,median.y,median.z)).multiply(boundingBox.getWorldMatrix());var drawWrapper=subMesh._drawWrapper;this._colorShaderForOcclusionQuery._preBind(drawWrapper);engine.bindBuffers(this._vertexBuffers,this._fillIndexBuffer,drawWrapper.effect);if(useReverseDepthBuffer){engine.setDepthFunctionToGreater();}else{engine.setDepthFunctionToLess();}this.scene.resetCachedMaterial();this._uniformBufferFront.bindToEffect(drawWrapper.effect,"BoundingBoxRenderer");this._uniformBufferFront.updateMatrix("world",worldMatrix);this._uniformBufferFront.updateMatrix("viewProjection",this.scene.getTransformMatrix());this._uniformBufferFront.update();engine.drawElementsType(Material.TriangleFillMode,0,36);this._colorShaderForOcclusionQuery.unbind();engine.setDepthFunctionToLessOrEqual();engine.setDepthWrite(true);engine.setColorWrite(true);engine.currentRenderPassId=currentRenderPassId;}},{key:"dispose",value:function dispose(){if(this._renderPassIdForOcclusionQuery!==void 0){this.scene.getEngine().releaseRenderPassId(this._renderPassIdForOcclusionQuery);this._renderPassIdForOcclusionQuery=void 0;}if(!this._colorShader){return;}this.onBeforeBoxRenderingObservable.clear();this.onAfterBoxRenderingObservable.clear();this.onResourcesReadyObservable.clear();this.renderList.dispose();this._colorShader.dispose();this._colorShaderForOcclusionQuery.dispose();this._uniformBufferFront.dispose();this._uniformBufferBack.dispose();var buffer=this._vertexBuffers[VertexBuffer.PositionKind];if(buffer){buffer.dispose();this._vertexBuffers[VertexBuffer.PositionKind]=null;}this.scene.getEngine()._releaseBuffer(this._indexBuffer);if(this._fillIndexBuffer){this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer);this._fillIndexBuffer=null;}}}]);return BoundingBoxRenderer;}();// node_modules/@babylonjs/core/Engines/Extensions/engine.dynamicTexture.js
ThinEngine.prototype.createDynamicTexture=function(width,height,generateMipMaps,samplingMode){var texture=new InternalTexture(this,InternalTextureSource.Dynamic);texture.baseWidth=width;texture.baseHeight=height;if(generateMipMaps){width=this.needPOTTextures?ThinEngine.GetExponentOfTwo(width,this._caps.maxTextureSize):width;height=this.needPOTTextures?ThinEngine.GetExponentOfTwo(height,this._caps.maxTextureSize):height;}texture.width=width;texture.height=height;texture.isReady=false;texture.generateMipMaps=generateMipMaps;texture.samplingMode=samplingMode;this.updateTextureSamplingMode(samplingMode,texture);this._internalTexturesCache.push(texture);return texture;};ThinEngine.prototype.updateDynamicTexture=function(texture,source,invertY){var premulAlpha=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var format=arguments.length>4?arguments[4]:undefined;var forceBindTexture=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var allowGPUOptimization=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(!texture){return;}var gl=this._gl;var target=gl.TEXTURE_2D;var wasPreviouslyBound=this._bindTextureDirectly(target,texture,true,forceBindTexture);this._unpackFlipY(invertY===void 0?texture.invertY:invertY);if(premulAlpha){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);}var textureType=this._getWebGLTextureType(texture.type);var glformat=this._getInternalFormat(format?format:texture.format);var internalFormat=this._getRGBABufferInternalSizedFormat(texture.type,glformat);gl.texImage2D(target,0,internalFormat,glformat,textureType,source);if(texture.generateMipMaps){gl.generateMipmap(target);}if(!wasPreviouslyBound){this._bindTextureDirectly(target,null);}if(premulAlpha){gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);}texture.isReady=true;};// src/state.ts
debug("state loaded");var _RendererState=/*#__PURE__*/function(){function _RendererState(){_classCallCheck(this,_RendererState);this.shouldRenderSceneId=/* @__PURE__ */new Map();}_createClass(_RendererState,[{key:"loadOrInit",value:function(){var _loadOrInit=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7(){return _regeneratorRuntime().wrap(function _callee7$(_context7){while(1)switch(_context7.prev=_context7.next){case 0:return _context7.abrupt("return");case 1:case"end":return _context7.stop();}},_callee7);}));function loadOrInit(){return _loadOrInit.apply(this,arguments);}return loadOrInit;}()}]);return _RendererState;}();// src/a.renderer.ts
debug("a.renderer loaded");var ARenderer=/*#__PURE__*/function(){function ARenderer(config){_classCallCheck(this,ARenderer);this.defaultWebGLConfig={alpha:true,antialias:true,preserveDrawingBuffer:true,stencil:true};this.config=config;if(!this.config.state){this.config.state=new _RendererState();}window.addEventListener("resize",this.onResize);if(this.config.sceneElement){this.sceneElement=this.config.sceneElement;}}_createClass(ARenderer,[{key:"onResize",value:function onResize(){}},{key:"getConfig",value:function getConfig(){return this.config;}},{key:"setupViewport",value:function setupViewport(){if(!this.sceneElement){this.sceneElement=document.getElementById(this.config.sceneElementID);}}},{key:"dispose",value:function dispose(){var _window;(_window=window)===null||_window===void 0||_window.removeEventListener("resize",this.onResize);}}]);return ARenderer;}();// src/renderer.babylon.ts
debug("renderer.babylon loaded");var _BabylonRenderer=/*#__PURE__*/function(_ARenderer){_inherits(_BabylonRenderer,_ARenderer);var _super78=_createSuper(_BabylonRenderer);function _BabylonRenderer(config){_classCallCheck(this,_BabylonRenderer);return _super78.call(this,config);}_createClass(_BabylonRenderer,[{key:"getScene",value:function getScene(){return this.scene;}},{key:"camera",get:function get(){return this._camera;},set:function set(camera){this._camera=camera;}},{key:"getCamera",value:function getCamera(){return this._camera;}},{key:"init",value:function init(){_get(_getPrototypeOf(_BabylonRenderer.prototype),"setupViewport",this).call(this);this.setupEngine();this.setupScene();}},{key:"setupEngine",value:function setupEngine(){this.engine=new Engine(this.sceneElement,true,_objectSpread({},this.defaultWebGLConfig));this.engine.setHardwareScalingLevel(1/window.devicePixelRatio);this.engine.adaptToDeviceRatio=true;}},{key:"setupScene",value:function setupScene(){this.scene=new Scene(this.engine);this.configureDebugging();this.configureCoordinateSystem();}},{key:"configureDebugging",value:function configureDebugging(){if(this.config.debug){}}},{key:"configureCoordinateSystem",value:function configureCoordinateSystem(){}},{key:"render",value:function(){var _render2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8(onUpdate,onRender,onFrame){var _this263=this,_this$engine;var _this$scene,_this$scene2,_this$scene3,_this$scene4;return _regeneratorRuntime().wrap(function _callee8$(_context8){while(1)switch(_context8.prev=_context8.next){case 0:if(onUpdate){(_this$scene=this.scene)===null||_this$scene===void 0||_this$scene.registerBeforeRender(function(){onUpdate();});}if(onRender){(_this$scene2=this.scene)===null||_this$scene2===void 0||_this$scene2.registerAfterRender(function(){onRender();});}if(onFrame){(_this$scene3=this.scene)===null||_this$scene3===void 0||_this$scene3.registerAfterRender(function(){_this263.onFrame(onFrame);});}if(!this.config.loop){(_this$scene4=this.scene)===null||_this$scene4===void 0||_this$scene4.registerAfterRender(function(){var _this263$engine;(_this263$engine=_this263.engine)===null||_this263$engine===void 0||_this263$engine.stopRenderLoop();});}(_this$engine=this.engine)===null||_this$engine===void 0||_this$engine.runRenderLoop(function(){var _this263$config$state,_this263$scene;if(!((_this263$config$state=_this263.config.state)!==null&&_this263$config$state!==void 0&&_this263$config$state.shouldRenderSceneId.get(_this263.config.sceneId))){var _this263$engine2;(_this263$engine2=_this263.engine)===null||_this263$engine2===void 0||_this263$engine2.stopRenderLoop();return;}(_this263$scene=_this263.scene)===null||_this263$scene===void 0||_this263$scene.render();});case 5:case"end":return _context8.stop();}},_callee8,this);}));function render(_x13,_x14,_x15){return _render2.apply(this,arguments);}return render;}()},{key:"onFrame",value:function onFrame(_onFrame,_resolve){}},{key:"setCameraPositionInternal",value:function setCameraPositionInternal(vector3){this.camera.position=vector3;}},{key:"setCameraPosition",value:function setCameraPosition(vector3){this.camera.position=_BabylonRenderer.toVector3(vector3);}},{key:"setDefaultCameraPosition",value:function setDefaultCameraPosition(vector3){this.camera.position=_BabylonRenderer.toVector3(vector3);}},{key:"setDefaultCameraTarget",value:function setDefaultCameraTarget(vector3){this.camera.setTarget(_BabylonRenderer.toVector3(vector3));}},{key:"onResize",value:function onResize(){var _this$engine2;(_this$engine2=this.engine)===null||_this$engine2===void 0||_this$engine2.resize(true);}},{key:"dispose",value:function dispose(){var _this$scene5,_this$engine3;_get(_getPrototypeOf(_BabylonRenderer.prototype),"dispose",this).call(this);(_this$scene5=this.scene)===null||_this$scene5===void 0||_this$scene5.dispose();(_this$engine3=this.engine)===null||_this$engine3===void 0||_this$engine3.dispose();}}],[{key:"toVector3",value:function toVector3(vector3){return new Vector3(vector3[0],vector3[1],vector3[2]);}}]);return _BabylonRenderer;}(ARenderer);// node_modules/@babylonjs/core/Loading/loadingScreen.js
var DefaultLoadingScreen=/*#__PURE__*/function(){function DefaultLoadingScreen(_renderingCanvas){var _this264=this;var _loadingText=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var _loadingDivBackgroundColor=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"black";_classCallCheck(this,DefaultLoadingScreen);this._renderingCanvas=_renderingCanvas;this._loadingText=_loadingText;this._loadingDivBackgroundColor=_loadingDivBackgroundColor;this._resizeLoadingUI=function(){var canvasRect=_this264._renderingCanvas.getBoundingClientRect();var canvasPositioning=window.getComputedStyle(_this264._renderingCanvas).position;if(!_this264._loadingDiv){return;}_this264._loadingDiv.style.position=canvasPositioning==="fixed"?"fixed":"absolute";_this264._loadingDiv.style.left=canvasRect.left+"px";_this264._loadingDiv.style.top=canvasRect.top+"px";_this264._loadingDiv.style.width=canvasRect.width+"px";_this264._loadingDiv.style.height=canvasRect.height+"px";};}_createClass(DefaultLoadingScreen,[{key:"displayLoadingUI",value:function displayLoadingUI(){if(this._loadingDiv){return;}this._loadingDiv=document.createElement("div");this._loadingDiv.id="babylonjsLoadingDiv";this._loadingDiv.style.opacity="0";this._loadingDiv.style.transition="opacity 1.5s ease";this._loadingDiv.style.pointerEvents="none";this._loadingDiv.style.display="grid";this._loadingDiv.style.gridTemplateRows="100%";this._loadingDiv.style.gridTemplateColumns="100%";this._loadingDiv.style.justifyItems="center";this._loadingDiv.style.alignItems="center";this._loadingTextDiv=document.createElement("div");this._loadingTextDiv.style.position="absolute";this._loadingTextDiv.style.left="0";this._loadingTextDiv.style.top="50%";this._loadingTextDiv.style.marginTop="80px";this._loadingTextDiv.style.width="100%";this._loadingTextDiv.style.height="20px";this._loadingTextDiv.style.fontFamily="Arial";this._loadingTextDiv.style.fontSize="14px";this._loadingTextDiv.style.color="white";this._loadingTextDiv.style.textAlign="center";this._loadingTextDiv.style.zIndex="1";this._loadingTextDiv.innerHTML="Loading";this._loadingDiv.appendChild(this._loadingTextDiv);this._loadingTextDiv.innerHTML=this._loadingText;this._style=document.createElement("style");this._style.type="text/css";var keyFrames="@-webkit-keyframes spin1 {                    0% { -webkit-transform: rotate(0deg);}\n                    100% { -webkit-transform: rotate(360deg);}\n                }                @keyframes spin1 {                    0% { transform: rotate(0deg);}\n                    100% { transform: rotate(360deg);}\n                }";this._style.innerHTML=keyFrames;document.getElementsByTagName("head")[0].appendChild(this._style);var svgSupport=!!window.SVGSVGElement;var imgBack=new Image();if(!DefaultLoadingScreen.DefaultLogoUrl){imgBack.src=!svgSupport?"https://cdn.babylonjs.com/Assets/babylonLogo.png":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxODAuMTcgMjA4LjA0Ij48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2ZmZjt9LmNscy0ye2ZpbGw6I2UwNjg0Yjt9LmNscy0ze2ZpbGw6I2JiNDY0Yjt9LmNscy00e2ZpbGw6I2UwZGVkODt9LmNscy01e2ZpbGw6I2Q1ZDJjYTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPkJhYnlsb25Mb2dvPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iUGFnZV9FbGVtZW50cyIgZGF0YS1uYW1lPSJQYWdlIEVsZW1lbnRzIj48cGF0aCBjbGFzcz0iY2xzLTEiIGQ9Ik05MC4wOSwwLDAsNTJWMTU2bDkwLjA5LDUyLDkwLjA4LTUyVjUyWiIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtMiIgcG9pbnRzPSIxODAuMTcgNTIuMDEgMTUxLjk3IDM1LjczIDEyNC44NSA1MS4zOSAxNTMuMDUgNjcuNjcgMTgwLjE3IDUyLjAxIi8+PHBvbHlnb24gY2xhc3M9ImNscy0yIiBwb2ludHM9IjI3LjEyIDY3LjY3IDExNy4yMSAxNS42NiA5MC4wOCAwIDAgNTIuMDEgMjcuMTIgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTIiIHBvaW50cz0iNjEuODkgMTIwLjMgOTAuMDggMTM2LjU4IDExOC4yOCAxMjAuMyA5MC4wOCAxMDQuMDIgNjEuODkgMTIwLjMiLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDE1My4wNSAxNDAuMzcgOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyAwIDUyLjAxIDAgMTU2LjAzIDkwLjA4IDIwOC4wNCAxODAuMTcgMTU2LjAzIDE4MC4xNyA1Mi4wMSAxNTMuMDUgNjcuNjciLz48cG9seWdvbiBjbGFzcz0iY2xzLTMiIHBvaW50cz0iOTAuMDggNzEuNDYgNjEuODkgODcuNzQgNjEuODkgMTIwLjMgOTAuMDggMTA0LjAyIDExOC4yOCAxMjAuMyAxMTguMjggODcuNzQgOTAuMDggNzEuNDYiLz48cG9seWdvbiBjbGFzcz0iY2xzLTQiIHBvaW50cz0iMTUzLjA1IDY3LjY3IDExOC4yOCA4Ny43NCAxMTguMjggMTIwLjMgOTAuMDggMTM2LjU4IDkwLjA4IDE3Ni43MiAxNTMuMDUgMTQwLjM3IDE1My4wNSA2Ny42NyIvPjxwb2x5Z29uIGNsYXNzPSJjbHMtNSIgcG9pbnRzPSIyNy4xMiA2Ny42NyA2MS44OSA4Ny43NCA2MS44OSAxMjAuMyA5MC4wOCAxMzYuNTggOTAuMDggMTc2LjcyIDI3LjEyIDE0MC4zNyAyNy4xMiA2Ny42NyIvPjwvZz48L2c+PC9zdmc+";}else{imgBack.src=DefaultLoadingScreen.DefaultLogoUrl;}imgBack.style.width="150px";imgBack.style.gridColumn="1";imgBack.style.gridRow="1";imgBack.style.top="50%";imgBack.style.left="50%";imgBack.style.transform="translate(-50%, -50%)";imgBack.style.position="absolute";var imageSpinnerContainer=document.createElement("div");imageSpinnerContainer.style.width="300px";imageSpinnerContainer.style.gridColumn="1";imageSpinnerContainer.style.gridRow="1";imageSpinnerContainer.style.top="50%";imageSpinnerContainer.style.left="50%";imageSpinnerContainer.style.transform="translate(-50%, -50%)";imageSpinnerContainer.style.position="absolute";var imgSpinner=new Image();if(!DefaultLoadingScreen.DefaultSpinnerUrl){imgSpinner.src=!svgSupport?"https://cdn.babylonjs.com/Assets/loadingIcon.png":"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzOTIgMzkyIj48ZGVmcz48c3R5bGU+LmNscy0xe2ZpbGw6I2UwNjg0Yjt9LmNscy0ye2ZpbGw6bm9uZTt9PC9zdHlsZT48L2RlZnM+PHRpdGxlPlNwaW5uZXJJY29uPC90aXRsZT48ZyBpZD0iTGF5ZXJfMiIgZGF0YS1uYW1lPSJMYXllciAyIj48ZyBpZD0iU3Bpbm5lciI+PHBhdGggY2xhc3M9ImNscy0xIiBkPSJNNDAuMjEsMTI2LjQzYzMuNy03LjMxLDcuNjctMTQuNDQsMTItMjEuMzJsMy4zNi01LjEsMy41Mi01YzEuMjMtMS42MywyLjQxLTMuMjksMy42NS00LjkxczIuNTMtMy4yMSwzLjgyLTQuNzlBMTg1LjIsMTg1LjIsMCwwLDEsODMuNCw2Ny40M2EyMDgsMjA4LDAsMCwxLDE5LTE1LjY2YzMuMzUtMi40MSw2Ljc0LTQuNzgsMTAuMjUtN3M3LjExLTQuMjgsMTAuNzUtNi4zMmM3LjI5LTQsMTQuNzMtOCwyMi41My0xMS40OSwzLjktMS43Miw3Ljg4LTMuMywxMi00LjY0YTEwNC4yMiwxMDQuMjIsMCwwLDEsMTIuNDQtMy4yMyw2Mi40NCw2Mi40NCwwLDAsMSwxMi43OC0xLjM5QTI1LjkyLDI1LjkyLDAsMCwxLDE5NiwyMS40NGE2LjU1LDYuNTUsMCwwLDEsMi4wNSw5LDYuNjYsNi42NiwwLDAsMS0xLjY0LDEuNzhsLS40MS4yOWEyMi4wNywyMi4wNywwLDAsMS01Ljc4LDMsMzAuNDIsMzAuNDIsMCwwLDEtNS42NywxLjYyLDM3LjgyLDM3LjgyLDAsMCwxLTUuNjkuNzFjLTEsMC0xLjkuMTgtMi44NS4yNmwtMi44NS4yNHEtNS43Mi41MS0xMS40OCwxLjFjLTMuODQuNC03LjcxLjgyLTExLjU4LDEuNGExMTIuMzQsMTEyLjM0LDAsMCwwLTIyLjk0LDUuNjFjLTMuNzIsMS4zNS03LjM0LDMtMTAuOTQsNC42NHMtNy4xNCwzLjUxLTEwLjYsNS41MUExNTEuNiwxNTEuNiwwLDAsMCw2OC41Niw4N0M2Ny4yMyw4OC40OCw2Niw5MCw2NC42NCw5MS41NnMtMi41MSwzLjE1LTMuNzUsNC43M2wtMy41NCw0LjljLTEuMTMsMS42Ni0yLjIzLDMuMzUtMy4zMyw1YTEyNywxMjcsMCwwLDAtMTAuOTMsMjEuNDksMS41OCwxLjU4LDAsMSwxLTMtMS4xNVM0MC4xOSwxMjYuNDcsNDAuMjEsMTI2LjQzWiIvPjxyZWN0IGNsYXNzPSJjbHMtMiIgd2lkdGg9IjM5MiIgaGVpZ2h0PSIzOTIiLz48L2c+PC9nPjwvc3ZnPg==";}else{imgSpinner.src=DefaultLoadingScreen.DefaultSpinnerUrl;}imgSpinner.style.animation="spin1 0.75s infinite linear";imgSpinner.style.webkitAnimation="spin1 0.75s infinite linear";imgSpinner.style.transformOrigin="50% 50%";imgSpinner.style.webkitTransformOrigin="50% 50%";if(!svgSupport){var logoSize={w:16,h:18.5};var loadingSize={w:30,h:30};imgBack.style.width="".concat(logoSize.w,"vh");imgBack.style.height="".concat(logoSize.h,"vh");imgBack.style.left="calc(50% - ".concat(logoSize.w/2,"vh)");imgBack.style.top="calc(50% - ".concat(logoSize.h/2,"vh)");imgSpinner.style.width="".concat(loadingSize.w,"vh");imgSpinner.style.height="".concat(loadingSize.h,"vh");imgSpinner.style.left="calc(50% - ".concat(loadingSize.w/2,"vh)");imgSpinner.style.top="calc(50% - ".concat(loadingSize.h/2,"vh)");}imageSpinnerContainer.appendChild(imgSpinner);this._loadingDiv.appendChild(imgBack);this._loadingDiv.appendChild(imageSpinnerContainer);this._resizeLoadingUI();window.addEventListener("resize",this._resizeLoadingUI);this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor;document.body.appendChild(this._loadingDiv);this._loadingDiv.style.opacity="1";}},{key:"hideLoadingUI",value:function hideLoadingUI(){var _this265=this;if(!this._loadingDiv){return;}var onTransitionEnd=function onTransitionEnd(){if(_this265._loadingTextDiv){_this265._loadingTextDiv.remove();_this265._loadingTextDiv=null;}if(_this265._loadingDiv){_this265._loadingDiv.remove();_this265._loadingDiv=null;}if(_this265._style){_this265._style.remove();_this265._style=null;}window.removeEventListener("resize",_this265._resizeLoadingUI);};this._loadingDiv.style.opacity="0";this._loadingDiv.addEventListener("transitionend",onTransitionEnd);}},{key:"loadingUIText",get:function get(){return this._loadingText;},set:function set(text){this._loadingText=text;if(this._loadingTextDiv){this._loadingTextDiv.innerHTML=this._loadingText;}}},{key:"loadingUIBackgroundColor",get:function get(){return this._loadingDivBackgroundColor;},set:function set(color){this._loadingDivBackgroundColor=color;if(!this._loadingDiv){return;}this._loadingDiv.style.backgroundColor=this._loadingDivBackgroundColor;}}]);return DefaultLoadingScreen;}();DefaultLoadingScreen.DefaultLogoUrl="";DefaultLoadingScreen.DefaultSpinnerUrl="";Engine.DefaultLoadingScreenFactory=function(canvas){return new DefaultLoadingScreen(canvas);};// node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurVaryingDeclaration.js
var name111="kernelBlurVaryingDeclaration";var shader111="varying vec2 sampleCoord{X};";ShaderStore.IncludesShadersStore[name111]=shader111;// node_modules/@babylonjs/core/Shaders/ShadersInclude/packingFunctions.js
var name112="packingFunctions";var shader112="vec4 pack(float depth)\n{\nconst vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\nconst vec4 bit_mask=vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\nvec4 res=fract(depth*bit_shift);\nres-=res.xxyz*bit_mask;\nreturn res;\n}\nfloat unpack(vec4 color)\n{\nconst vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\nreturn dot(color,bit_shift);\n}";ShaderStore.IncludesShadersStore[name112]=shader112;// node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurFragment.js
var name113="kernelBlurFragment";var shader113="#ifdef DOF\nfactor=sampleCoC(sampleCoord{X}); \ncomputedWeight=KERNEL_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCoord{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCoord{X})*computedWeight;\n#endif\n";ShaderStore.IncludesShadersStore[name113]=shader113;// node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurFragment2.js
var name114="kernelBlurFragment2";var shader114="#ifdef DOF\nfactor=sampleCoC(sampleCenter+delta*KERNEL_DEP_OFFSET{X});\ncomputedWeight=KERNEL_DEP_WEIGHT{X}*factor;\nsumOfWeights+=computedWeight;\n#else\ncomputedWeight=KERNEL_DEP_WEIGHT{X};\n#endif\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X}))*computedWeight;\n#else\nblend+=texture2D(textureSampler,sampleCenter+delta*KERNEL_DEP_OFFSET{X})*computedWeight;\n#endif\n";ShaderStore.IncludesShadersStore[name114]=shader114;// node_modules/@babylonjs/core/Shaders/kernelBlur.fragment.js
var name115="kernelBlurPixelShader";var shader115="uniform sampler2D textureSampler;\nuniform vec2 delta;\nvarying vec2 sampleCenter;\n#ifdef DOF\nuniform sampler2D circleOfConfusionSampler;\nfloat sampleCoC(in vec2 offset) {\nfloat coc=texture2D(circleOfConfusionSampler,offset).r;\nreturn coc; \n}\n#endif\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\n#ifdef PACKEDFLOAT\n#include<packingFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\nfloat computedWeight=0.0;\n#ifdef PACKEDFLOAT\nfloat blend=0.;\n#else\nvec4 blend=vec4(0.);\n#endif\n#ifdef DOF\nfloat sumOfWeights=CENTER_WEIGHT; \nfloat factor=0.0;\n#ifdef PACKEDFLOAT\nblend+=unpack(texture2D(textureSampler,sampleCenter))*CENTER_WEIGHT;\n#else\nblend+=texture2D(textureSampler,sampleCenter)*CENTER_WEIGHT;\n#endif\n#endif\n#include<kernelBlurFragment>[0..varyingCount]\n#include<kernelBlurFragment2>[0..depCount]\n#ifdef PACKEDFLOAT\ngl_FragColor=pack(blend);\n#else\ngl_FragColor=blend;\n#endif\n#ifdef DOF\ngl_FragColor/=sumOfWeights;\n#endif\n}";ShaderStore.ShadersStore[name115]=shader115;// node_modules/@babylonjs/core/Shaders/ShadersInclude/kernelBlurVertex.js
var name116="kernelBlurVertex";var shader116="sampleCoord{X}=sampleCenter+delta*KERNEL_OFFSET{X};";ShaderStore.IncludesShadersStore[name116]=shader116;// node_modules/@babylonjs/core/Shaders/kernelBlur.vertex.js
var name117="kernelBlurVertexShader";var shader117="attribute vec2 position;\nuniform vec2 delta;\nvarying vec2 sampleCenter;\n#include<kernelBlurVaryingDeclaration>[0..varyingCount]\nconst vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nsampleCenter=(position*madd+madd);\n#include<kernelBlurVertex>[0..varyingCount]\ngl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";ShaderStore.ShadersStore[name117]=shader117;// node_modules/@babylonjs/core/PostProcesses/blurPostProcess.js
var BlurPostProcess=/*#__PURE__*/function(_PostProcess2){_inherits(BlurPostProcess,_PostProcess2);var _super79=_createSuper(BlurPostProcess);function BlurPostProcess(name135,direction,kernel,options,camera){var _this266;var samplingMode=arguments.length>5&&arguments[5]!==undefined?arguments[5]:Texture.BILINEAR_SAMPLINGMODE;var engine=arguments.length>6?arguments[6]:undefined;var reusable=arguments.length>7?arguments[7]:undefined;var textureType=arguments.length>8&&arguments[8]!==undefined?arguments[8]:0;var defines=arguments.length>9&&arguments[9]!==undefined?arguments[9]:"";var _blockCompilation=arguments.length>10&&arguments[10]!==undefined?arguments[10]:false;var textureFormat=arguments.length>11&&arguments[11]!==undefined?arguments[11]:5;_classCallCheck(this,BlurPostProcess);_this266=_super79.call(this,name135,"kernelBlur",["delta","direction"],["circleOfConfusionSampler"],options,camera,samplingMode,engine,reusable,null,textureType,"kernelBlur",{varyingCount:0,depCount:0},true,textureFormat);_this266._blockCompilation=_blockCompilation;_this266._packedFloat=false;_this266._staticDefines="";_this266._staticDefines=defines;_this266.direction=direction;_this266.onApplyObservable.add(function(effect){if(_this266._outputTexture){effect.setFloat2("delta",1/_this266._outputTexture.width*_this266.direction.x,1/_this266._outputTexture.height*_this266.direction.y);}else{effect.setFloat2("delta",1/_this266.width*_this266.direction.x,1/_this266.height*_this266.direction.y);}});_this266.kernel=kernel;return _this266;}_createClass(BlurPostProcess,[{key:"kernel",get:function get(){return this._idealKernel;},set:function set(v){if(this._idealKernel===v){return;}v=Math.max(v,1);this._idealKernel=v;this._kernel=this._nearestBestKernel(v);if(!this._blockCompilation){this._updateParameters();}}},{key:"packedFloat",get:function get(){return this._packedFloat;},set:function set(v){if(this._packedFloat===v){return;}this._packedFloat=v;if(!this._blockCompilation){this._updateParameters();}}},{key:"getClassName",value:function getClassName(){return"BlurPostProcess";}},{key:"updateEffect",value:function updateEffect(){var defines=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var uniforms=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var samplers=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var indexParameters=arguments.length>3?arguments[3]:undefined;var onCompiled=arguments.length>4?arguments[4]:undefined;var onError=arguments.length>5?arguments[5]:undefined;this._updateParameters(onCompiled,onError);}},{key:"_updateParameters",value:function _updateParameters(onCompiled,onError){var N=this._kernel;var centerIndex=(N-1)/2;var offsets=[];var weights=[];var totalWeight=0;for(var i=0;i<N;i++){var u=i/(N-1);var w=this._gaussianWeight(u*2-1);offsets[i]=i-centerIndex;weights[i]=w;totalWeight+=w;}for(var _i36=0;_i36<weights.length;_i36++){weights[_i36]/=totalWeight;}var linearSamplingWeights=[];var linearSamplingOffsets=[];var linearSamplingMap=[];for(var _i37=0;_i37<=centerIndex;_i37+=2){var j=Math.min(_i37+1,Math.floor(centerIndex));var singleCenterSample=_i37===j;if(singleCenterSample){linearSamplingMap.push({o:offsets[_i37],w:weights[_i37]});}else{var sharedCell=j===centerIndex;var weightLinear=weights[_i37]+weights[j]*(sharedCell?0.5:1);var offsetLinear=offsets[_i37]+1/(1+weights[_i37]/weights[j]);if(offsetLinear===0){linearSamplingMap.push({o:offsets[_i37],w:weights[_i37]});linearSamplingMap.push({o:offsets[_i37+1],w:weights[_i37+1]});}else{linearSamplingMap.push({o:offsetLinear,w:weightLinear});linearSamplingMap.push({o:-offsetLinear,w:weightLinear});}}}for(var _i38=0;_i38<linearSamplingMap.length;_i38++){linearSamplingOffsets[_i38]=linearSamplingMap[_i38].o;linearSamplingWeights[_i38]=linearSamplingMap[_i38].w;}offsets=linearSamplingOffsets;weights=linearSamplingWeights;var maxVaryingRows=this.getEngine().getCaps().maxVaryingVectors;var freeVaryingVec2=Math.max(maxVaryingRows,0)-1;var varyingCount=Math.min(offsets.length,freeVaryingVec2);var defines="";defines+=this._staticDefines;if(this._staticDefines.indexOf("DOF")!=-1){defines+="#define CENTER_WEIGHT ".concat(this._glslFloat(weights[varyingCount-1]),"\r\n");varyingCount--;}for(var _i39=0;_i39<varyingCount;_i39++){defines+="#define KERNEL_OFFSET".concat(_i39," ").concat(this._glslFloat(offsets[_i39]),"\r\n");defines+="#define KERNEL_WEIGHT".concat(_i39," ").concat(this._glslFloat(weights[_i39]),"\r\n");}var depCount=0;for(var _i40=freeVaryingVec2;_i40<offsets.length;_i40++){defines+="#define KERNEL_DEP_OFFSET".concat(depCount," ").concat(this._glslFloat(offsets[_i40]),"\r\n");defines+="#define KERNEL_DEP_WEIGHT".concat(depCount," ").concat(this._glslFloat(weights[_i40]),"\r\n");depCount++;}if(this.packedFloat){defines+="#define PACKEDFLOAT 1";}this._blockCompilation=false;_get(_getPrototypeOf(BlurPostProcess.prototype),"updateEffect",this).call(this,defines,null,null,{varyingCount:varyingCount,depCount:depCount},onCompiled,onError);}},{key:"_nearestBestKernel",value:function _nearestBestKernel(idealKernel){var v=Math.round(idealKernel);for(var _i41=0,_arr=[v,v-1,v+1,v-2,v+2];_i41<_arr.length;_i41++){var k=_arr[_i41];if(k%2!==0&&Math.floor(k/2)%2===0&&k>0){return Math.max(k,3);}}return Math.max(v,3);}},{key:"_gaussianWeight",value:function _gaussianWeight(x){var sigma=1/3;var denominator=Math.sqrt(2*Math.PI)*sigma;var exponent=-(x*x/(2*sigma*sigma));var weight=1/denominator*Math.exp(exponent);return weight;}},{key:"_glslFloat",value:function _glslFloat(x){var decimalFigures=arguments.length>1&&arguments[1]!==undefined?arguments[1]:8;return x.toFixed(decimalFigures).replace(/0+$/,"");}}],[{key:"_Parse",value:function _Parse(parsedPostProcess,targetCamera,scene2,rootUrl){return SerializationHelper.Parse(function(){return new BlurPostProcess(parsedPostProcess.name,parsedPostProcess.direction,parsedPostProcess.kernel,parsedPostProcess.options,targetCamera,parsedPostProcess.renderTargetSamplingMode,scene2.getEngine(),parsedPostProcess.reusable,parsedPostProcess.textureType,void 0,false);},parsedPostProcess,scene2,rootUrl);}}]);return BlurPostProcess;}(PostProcess);__decorate([serialize("kernel")],BlurPostProcess.prototype,"_kernel",void 0);__decorate([serialize("packedFloat")],BlurPostProcess.prototype,"_packedFloat",void 0);__decorate([serializeAsVector2()],BlurPostProcess.prototype,"direction",void 0);RegisterClass("BABYLON.BlurPostProcess",BlurPostProcess);// node_modules/@babylonjs/core/Shaders/ShadersInclude/bayerDitherFunctions.js
var name118="bayerDitherFunctions";var shader118="float bayerDither2(vec2 _P) {\nreturn mod(2.0*_P.y+_P.x+1.0,4.0);\n}\nfloat bayerDither4(vec2 _P) {\nvec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5*mod(_P,4.0)); \nreturn 4.0*bayerDither2(P1)+bayerDither2(P2);\n}\nfloat bayerDither8(vec2 _P) {\nvec2 P1=mod(_P,2.0); \nvec2 P2=floor(0.5 *mod(_P,4.0)); \nvec2 P4=floor(0.25*mod(_P,8.0)); \nreturn 4.0*(4.0*bayerDither2(P1)+bayerDither2(P2))+bayerDither2(P4);\n}\n";ShaderStore.IncludesShadersStore[name118]=shader118;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragmentExtraDeclaration.js
var name119="shadowMapFragmentExtraDeclaration";var shader119="#if SM_FLOAT==0\n#include<packingFunctions>\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#include<bayerDitherFunctions>\nuniform float softTransparentShadowSM;\n#endif\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nuniform vec3 lightDataSM;\nvarying vec3 vPositionWSM;\n#endif\nuniform vec3 biasAndScaleSM;\nuniform vec2 depthValuesSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n";ShaderStore.IncludesShadersStore[name119]=shader119;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragment.js
var name120="shadowMapFragment";var shader120="float depthSM=vDepthMetricSM;\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\n#if SM_USEDISTANCE==1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\ndepthSM=(-zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\ndepthSM=(zSM+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\ngl_FragDepth=clamp(1.0-depthSM,0.0,1.0);\n#else\ngl_FragDepth=clamp(depthSM,0.0,1.0); \n#endif\n#elif SM_USEDISTANCE==1\ndepthSM=(length(vPositionWSM-lightDataSM)+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#if SM_ESM==1\ndepthSM=clamp(exp(-min(87.,biasAndScaleSM.z*depthSM)),0.,1.);\n#endif\n#if SM_FLOAT==1\ngl_FragColor=vec4(depthSM,1.0,1.0,1.0);\n#else\ngl_FragColor=pack(depthSM);\n#endif\nreturn;";ShaderStore.IncludesShadersStore[name120]=shader120;// node_modules/@babylonjs/core/Shaders/shadowMap.fragment.js
var name121="shadowMapPixelShader";var shader121="#include<shadowMapFragmentExtraDeclaration>\n#ifdef ALPHATEXTURE\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEXTURE\nfloat alphaFromAlphaTexture=texture2D(diffuseSampler,vUV).a;\n#ifdef ALPHATESTVALUE\nif (alphaFromAlphaTexture<ALPHATESTVALUE)\ndiscard;\n#endif\n#endif\n#if SM_SOFTTRANSPARENTSHADOW==1\n#ifdef ALPHATEXTURE\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alphaFromAlphaTexture) discard;\n#else\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM) discard;\n#endif\n#endif\n#include<shadowMapFragment>\n}";ShaderStore.ShadersStore[name121]=shader121;// node_modules/@babylonjs/core/Shaders/ShadersInclude/sceneVertexDeclaration.js
var name122="sceneVertexDeclaration";var shader122="uniform mat4 viewProjection;\n#ifdef MULTIVIEW\nuniform mat4 viewProjectionR;\n#endif\nuniform mat4 view;\nuniform mat4 projection;\nuniform vec4 vEyePosition;\n";ShaderStore.IncludesShadersStore[name122]=shader122;// node_modules/@babylonjs/core/Shaders/ShadersInclude/meshVertexDeclaration.js
var name123="meshVertexDeclaration";var shader123="uniform mat4 world;\nuniform float visibility;\n";ShaderStore.IncludesShadersStore[name123]=shader123;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexDeclaration.js
var name124="shadowMapVertexDeclaration";var shader124="#include<sceneVertexDeclaration>\n#include<meshVertexDeclaration>\n";ShaderStore.IncludesShadersStore[name124]=shader124;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapUboDeclaration.js
var name125="shadowMapUboDeclaration";var shader125="layout(std140,column_major) uniform;\n#include<sceneUboDeclaration>\n#include<meshUboDeclaration>\n";ShaderStore.IncludesShadersStore[name125]=shader125;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexExtraDeclaration.js
var name126="shadowMapVertexExtraDeclaration";var shader126="#if SM_NORMALBIAS==1\nuniform vec3 lightDataSM;\n#endif\nuniform vec3 biasAndScaleSM;\nuniform vec2 depthValuesSM;\nvarying float vDepthMetricSM;\n#if SM_USEDISTANCE==1\nvarying vec3 vPositionWSM;\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nvarying float zSM;\n#endif\n";ShaderStore.IncludesShadersStore[name126]=shader126;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexNormalBias.js
var name127="shadowMapVertexNormalBias";var shader127="#if SM_NORMALBIAS==1\n#if SM_DIRECTIONINLIGHTDATA==1\nvec3 worldLightDirSM=normalize(-lightDataSM.xyz);\n#else\nvec3 directionToLightSM=lightDataSM.xyz-worldPos.xyz;\nvec3 worldLightDirSM=normalize(directionToLightSM);\n#endif\nfloat ndlSM=dot(vNormalW,worldLightDirSM);\nfloat sinNLSM=sqrt(1.0-ndlSM*ndlSM);\nfloat normalBiasSM=biasAndScaleSM.y*sinNLSM;\nworldPos.xyz-=vNormalW*normalBiasSM;\n#endif\n";ShaderStore.IncludesShadersStore[name127]=shader127;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapVertexMetric.js
var name128="shadowMapVertexMetric";var shader128="#if SM_USEDISTANCE==1\nvPositionWSM=worldPos.xyz;\n#endif\n#if SM_DEPTHTEXTURE==1\n#ifdef IS_NDC_HALF_ZRANGE\n#define BIASFACTOR 0.5\n#else\n#define BIASFACTOR 1.0\n#endif\n#ifdef USE_REVERSE_DEPTHBUFFER\ngl_Position.z-=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;\n#else\ngl_Position.z+=biasAndScaleSM.x*gl_Position.w*BIASFACTOR;\n#endif\n#endif\n#if defined(SM_DEPTHCLAMP) && SM_DEPTHCLAMP==1\nzSM=gl_Position.z;\ngl_Position.z=0.0;\n#elif SM_USEDISTANCE==0\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetricSM=(-gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#else\nvDepthMetricSM=(gl_Position.z+depthValuesSM.x)/depthValuesSM.y+biasAndScaleSM.x;\n#endif\n#endif\n";ShaderStore.IncludesShadersStore[name128]=shader128;// node_modules/@babylonjs/core/Shaders/shadowMap.vertex.js
var name129="shadowMapVertexShader";var shader129="attribute vec3 position;\n#ifdef NORMAL\nattribute vec3 normal;\n#endif\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#ifdef INSTANCES\nattribute vec4 world0;\nattribute vec4 world1;\nattribute vec4 world2;\nattribute vec4 world3;\n#endif\n#include<helperFunctions>\n#include<__decl__shadowMapVertex>\n#ifdef ALPHATEXTURE\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#include<shadowMapVertexExtraDeclaration>\n#include<clipPlaneVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#ifdef NORMAL\nvec3 normalUpdated=normal;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#ifdef NORMAL\nmat3 normWorldSM=mat3(finalWorld);\n#if defined(INSTANCES) && defined(THIN_INSTANCES)\nvec3 vNormalW=normalUpdated/vec3(dot(normWorldSM[0],normWorldSM[0]),dot(normWorldSM[1],normWorldSM[1]),dot(normWorldSM[2],normWorldSM[2]));\nvNormalW=normalize(normWorldSM*vNormalW);\n#else\n#ifdef NONUNIFORMSCALING\nnormWorldSM=transposeMat3(inverseMat3(normWorldSM));\n#endif\nvec3 vNormalW=normalize(normWorldSM*normalUpdated);\n#endif\n#endif\n#include<shadowMapVertexNormalBias>\ngl_Position=viewProjection*worldPos;\n#include<shadowMapVertexMetric>\n#ifdef ALPHATEXTURE\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n#include<clipPlaneVertex>\n}";ShaderStore.ShadersStore[name129]=shader129;// node_modules/@babylonjs/core/Shaders/depthBoxBlur.fragment.js
var name130="depthBoxBlurPixelShader";var shader130="varying vec2 vUV;\nuniform sampler2D textureSampler;\nuniform vec2 screenSize;\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\nvec4 colorDepth=vec4(0.0);\nfor (int x=-OFFSET; x<=OFFSET; x++)\nfor (int y=-OFFSET; y<=OFFSET; y++)\ncolorDepth+=texture2D(textureSampler,vUV+vec2(x,y)/screenSize);\ngl_FragColor=(colorDepth/float((OFFSET*2+1)*(OFFSET*2+1)));\n}";ShaderStore.ShadersStore[name130]=shader130;// node_modules/@babylonjs/core/Shaders/ShadersInclude/shadowMapFragmentSoftTransparentShadow.js
var name131="shadowMapFragmentSoftTransparentShadow";var shader131="#if SM_SOFTTRANSPARENTSHADOW==1\nif ((bayerDither8(floor(mod(gl_FragCoord.xy,8.0))))/64.0>=softTransparentShadowSM*alpha) discard;\n#endif\n";ShaderStore.IncludesShadersStore[name131]=shader131;// node_modules/@babylonjs/core/Lights/Shadows/shadowGenerator.js
var ShadowGenerator=/*#__PURE__*/function(){function ShadowGenerator(mapSize,light,usefullFloatFirst,camera){_classCallCheck(this,ShadowGenerator);this.onBeforeShadowMapRenderObservable=new Observable();this.onAfterShadowMapRenderObservable=new Observable();this.onBeforeShadowMapRenderMeshObservable=new Observable();this.onAfterShadowMapRenderMeshObservable=new Observable();this._bias=5e-5;this._normalBias=0;this._blurBoxOffset=1;this._blurScale=2;this._blurKernel=1;this._useKernelBlur=false;this._filter=ShadowGenerator.FILTER_NONE;this._filteringQuality=ShadowGenerator.QUALITY_HIGH;this._contactHardeningLightSizeUVRatio=0.1;this._darkness=0;this._transparencyShadow=false;this.enableSoftTransparentShadow=false;this.useOpacityTextureForTransparentShadow=false;this.frustumEdgeFalloff=0;this.forceBackFacesOnly=false;this._lightDirection=Vector3.Zero();this._viewMatrix=Matrix.Zero();this._projectionMatrix=Matrix.Zero();this._transformMatrix=Matrix.Zero();this._cachedPosition=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cachedDirection=new Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._currentFaceIndex=0;this._currentFaceIndexCache=0;this._defaultTextureMatrix=Matrix.Identity();this._mapSize=mapSize;this._light=light;this._scene=light.getScene();this._camera=camera!==null&&camera!==void 0?camera:null;var shadowGenerators=light._shadowGenerators;if(!shadowGenerators){shadowGenerators=light._shadowGenerators=/* @__PURE__ */new Map();}shadowGenerators.set(this._camera,this);this.id=light.id;this._useUBO=this._scene.getEngine().supportsUniformBuffers;if(this._useUBO){this._sceneUBOs=[];this._sceneUBOs.push(this._scene.createSceneUniformBuffer("Scene for Shadow Generator (light \"".concat(this._light.name,"\")")));}ShadowGenerator._SceneComponentInitialization(this._scene);var caps=this._scene.getEngine().getCaps();if(!usefullFloatFirst){if(caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering){this._textureType=2;}else if(caps.textureFloatRender&&caps.textureFloatLinearFiltering){this._textureType=1;}else{this._textureType=0;}}else{if(caps.textureFloatRender&&caps.textureFloatLinearFiltering){this._textureType=1;}else if(caps.textureHalfFloatRender&&caps.textureHalfFloatLinearFiltering){this._textureType=2;}else{this._textureType=0;}}this._initializeGenerator();this._applyFilterValues();}_createClass(ShadowGenerator,[{key:"bias",get:function get(){return this._bias;},set:function set(bias){this._bias=bias;}},{key:"normalBias",get:function get(){return this._normalBias;},set:function set(normalBias){this._normalBias=normalBias;}},{key:"blurBoxOffset",get:function get(){return this._blurBoxOffset;},set:function set(value){if(this._blurBoxOffset===value){return;}this._blurBoxOffset=value;this._disposeBlurPostProcesses();}},{key:"blurScale",get:function get(){return this._blurScale;},set:function set(value){if(this._blurScale===value){return;}this._blurScale=value;this._disposeBlurPostProcesses();}},{key:"blurKernel",get:function get(){return this._blurKernel;},set:function set(value){if(this._blurKernel===value){return;}this._blurKernel=value;this._disposeBlurPostProcesses();}},{key:"useKernelBlur",get:function get(){return this._useKernelBlur;},set:function set(value){if(this._useKernelBlur===value){return;}this._useKernelBlur=value;this._disposeBlurPostProcesses();}},{key:"depthScale",get:function get(){return this._depthScale!==void 0?this._depthScale:this._light.getDepthScale();},set:function set(value){this._depthScale=value;}},{key:"_validateFilter",value:function _validateFilter(filter){return filter;}},{key:"filter",get:function get(){return this._filter;},set:function set(value){value=this._validateFilter(value);if(this._light.needCube()){if(value===ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP){this.useExponentialShadowMap=true;return;}else if(value===ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP){this.useCloseExponentialShadowMap=true;return;}else if(value===ShadowGenerator.FILTER_PCF||value===ShadowGenerator.FILTER_PCSS){this.usePoissonSampling=true;return;}}if(value===ShadowGenerator.FILTER_PCF||value===ShadowGenerator.FILTER_PCSS){if(!this._scene.getEngine()._features.supportShadowSamplers){this.usePoissonSampling=true;return;}}if(this._filter===value){return;}this._filter=value;this._disposeBlurPostProcesses();this._applyFilterValues();this._light._markMeshesAsLightDirty();}},{key:"usePoissonSampling",get:function get(){return this.filter===ShadowGenerator.FILTER_POISSONSAMPLING;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_POISSONSAMPLING);if(!value&&this.filter!==ShadowGenerator.FILTER_POISSONSAMPLING){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"useExponentialShadowMap",get:function get(){return this.filter===ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP);if(!value&&this.filter!==ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"useBlurExponentialShadowMap",get:function get(){return this.filter===ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP);if(!value&&this.filter!==ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"useCloseExponentialShadowMap",get:function get(){return this.filter===ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP);if(!value&&this.filter!==ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"useBlurCloseExponentialShadowMap",get:function get(){return this.filter===ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP);if(!value&&this.filter!==ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"usePercentageCloserFiltering",get:function get(){return this.filter===ShadowGenerator.FILTER_PCF;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_PCF);if(!value&&this.filter!==ShadowGenerator.FILTER_PCF){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"filteringQuality",get:function get(){return this._filteringQuality;},set:function set(filteringQuality){if(this._filteringQuality===filteringQuality){return;}this._filteringQuality=filteringQuality;this._disposeBlurPostProcesses();this._applyFilterValues();this._light._markMeshesAsLightDirty();}},{key:"useContactHardeningShadow",get:function get(){return this.filter===ShadowGenerator.FILTER_PCSS;},set:function set(value){var filter=this._validateFilter(ShadowGenerator.FILTER_PCSS);if(!value&&this.filter!==ShadowGenerator.FILTER_PCSS){return;}this.filter=value?filter:ShadowGenerator.FILTER_NONE;}},{key:"contactHardeningLightSizeUVRatio",get:function get(){return this._contactHardeningLightSizeUVRatio;},set:function set(contactHardeningLightSizeUVRatio){this._contactHardeningLightSizeUVRatio=contactHardeningLightSizeUVRatio;}},{key:"darkness",get:function get(){return this._darkness;},set:function set(value){this.setDarkness(value);}},{key:"getDarkness",value:function getDarkness(){return this._darkness;}},{key:"setDarkness",value:function setDarkness(darkness){if(darkness>=1){this._darkness=1;}else if(darkness<=0){this._darkness=0;}else{this._darkness=darkness;}return this;}},{key:"transparencyShadow",get:function get(){return this._transparencyShadow;},set:function set(value){this.setTransparencyShadow(value);}},{key:"setTransparencyShadow",value:function setTransparencyShadow(transparent){this._transparencyShadow=transparent;return this;}},{key:"getShadowMap",value:function getShadowMap(){return this._shadowMap;}},{key:"getShadowMapForRendering",value:function getShadowMapForRendering(){if(this._shadowMap2){return this._shadowMap2;}return this._shadowMap;}},{key:"getClassName",value:function getClassName(){return ShadowGenerator.CLASSNAME;}},{key:"addShadowCaster",value:function addShadowCaster(mesh){var includeDescendants=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this._shadowMap){return this;}if(!this._shadowMap.renderList){this._shadowMap.renderList=[];}if(this._shadowMap.renderList.indexOf(mesh)===-1){this._shadowMap.renderList.push(mesh);}if(includeDescendants){var _iterator252=_createForOfIteratorHelper(mesh.getChildMeshes()),_step265;try{for(_iterator252.s();!(_step265=_iterator252.n()).done;){var childMesh=_step265.value;if(this._shadowMap.renderList.indexOf(childMesh)===-1){this._shadowMap.renderList.push(childMesh);}}}catch(err){_iterator252.e(err);}finally{_iterator252.f();}}return this;}},{key:"removeShadowCaster",value:function removeShadowCaster(mesh){var includeDescendants=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!this._shadowMap||!this._shadowMap.renderList){return this;}var index=this._shadowMap.renderList.indexOf(mesh);if(index!==-1){this._shadowMap.renderList.splice(index,1);}if(includeDescendants){var _iterator253=_createForOfIteratorHelper(mesh.getChildren()),_step266;try{for(_iterator253.s();!(_step266=_iterator253.n()).done;){var child=_step266.value;this.removeShadowCaster(child);}}catch(err){_iterator253.e(err);}finally{_iterator253.f();}}return this;}},{key:"getLight",value:function getLight(){return this._light;}},{key:"_getCamera",value:function _getCamera(){var _a;return(_a=this._camera)!==null&&_a!==void 0?_a:this._scene.activeCamera;}},{key:"mapSize",get:function get(){return this._mapSize;},set:function set(size){this._mapSize=size;this._light._markMeshesAsLightDirty();this.recreateShadowMap();}},{key:"_initializeGenerator",value:function _initializeGenerator(){this._light._markMeshesAsLightDirty();this._initializeShadowMap();}},{key:"_createTargetRenderTexture",value:function _createTargetRenderTexture(){var engine=this._scene.getEngine();if(engine._features.supportDepthStencilTexture){this._shadowMap=new RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,false,true,this._textureType,this._light.needCube(),void 0,false,false);this._shadowMap.createDepthStencilTexture(engine.useReverseDepthBuffer?516:513,true);}else{this._shadowMap=new RenderTargetTexture(this._light.name+"_shadowMap",this._mapSize,this._scene,false,true,this._textureType,this._light.needCube());}}},{key:"_initializeShadowMap",value:function _initializeShadowMap(){var _this267=this;this._createTargetRenderTexture();if(this._shadowMap===null){return;}this._shadowMap.wrapU=Texture.CLAMP_ADDRESSMODE;this._shadowMap.wrapV=Texture.CLAMP_ADDRESSMODE;this._shadowMap.anisotropicFilteringLevel=1;this._shadowMap.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);this._shadowMap.renderParticles=false;this._shadowMap.ignoreCameraViewport=true;if(this._storedUniqueId){this._shadowMap.uniqueId=this._storedUniqueId;}this._shadowMap.customRenderFunction=this._renderForShadowMap.bind(this);this._shadowMap.customIsReadyFunction=function(){return true;};var engine=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.add(function(){var _a;_this267._currentSceneUBO=_this267._scene.getSceneUniformBuffer();(_a=engine._debugPushGroup)===null||_a===void 0?void 0:_a.call(engine,"shadow map generation for pass id ".concat(engine.currentRenderPassId),1);});this._shadowMap.onBeforeRenderObservable.add(function(faceIndex){if(_this267._sceneUBOs){_this267._scene.setSceneUniformBuffer(_this267._sceneUBOs[0]);}_this267._currentFaceIndex=faceIndex;if(_this267._filter===ShadowGenerator.FILTER_PCF){engine.setColorWrite(false);}_this267.getTransformMatrix();_this267._scene.setTransformMatrix(_this267._viewMatrix,_this267._projectionMatrix);if(_this267._useUBO){_this267._scene.getSceneUniformBuffer().unbindEffect();_this267._scene.finalizeSceneUbo();}});this._shadowMap.onAfterUnbindObservable.add(function(){var _a,_b;if(_this267._sceneUBOs){_this267._scene.setSceneUniformBuffer(_this267._currentSceneUBO);}_this267._scene.updateTransformMatrix();if(_this267._filter===ShadowGenerator.FILTER_PCF){engine.setColorWrite(true);}if(!_this267.useBlurExponentialShadowMap&&!_this267.useBlurCloseExponentialShadowMap){(_a=engine._debugPopGroup)===null||_a===void 0?void 0:_a.call(engine,1);return;}var shadowMap=_this267.getShadowMapForRendering();if(shadowMap){_this267._scene.postProcessManager.directRender(_this267._blurPostProcesses,shadowMap.renderTarget,true);engine.unBindFramebuffer(shadowMap.renderTarget,true);(_b=engine._debugPopGroup)===null||_b===void 0?void 0:_b.call(engine,1);}});var clearZero=new Color4(0,0,0,0);var clearOne=new Color4(1,1,1,1);this._shadowMap.onClearObservable.add(function(engine2){if(_this267._filter===ShadowGenerator.FILTER_PCF){engine2.clear(clearOne,false,true,false);}else if(_this267.useExponentialShadowMap||_this267.useBlurExponentialShadowMap){engine2.clear(clearZero,true,true,false);}else{engine2.clear(clearOne,true,true,false);}});this._shadowMap.onResizeObservable.add(function(rtt){_this267._storedUniqueId=_this267._shadowMap.uniqueId;_this267._mapSize=rtt.getRenderSize();_this267._light._markMeshesAsLightDirty();_this267.recreateShadowMap();});for(var i=RenderingManager.MIN_RENDERINGGROUPS;i<RenderingManager.MAX_RENDERINGGROUPS;i++){this._shadowMap.setRenderingAutoClearDepthStencil(i,false);}}},{key:"_initializeBlurRTTAndPostProcesses",value:function _initializeBlurRTTAndPostProcesses(){var _this268=this;var engine=this._scene.getEngine();var targetSize=this._mapSize/this.blurScale;if(!this.useKernelBlur||this.blurScale!==1){this._shadowMap2=new RenderTargetTexture(this._light.name+"_shadowMap2",targetSize,this._scene,false,true,this._textureType,void 0,void 0,false);this._shadowMap2.wrapU=Texture.CLAMP_ADDRESSMODE;this._shadowMap2.wrapV=Texture.CLAMP_ADDRESSMODE;this._shadowMap2.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);}if(this.useKernelBlur){this._kernelBlurXPostprocess=new BlurPostProcess(this._light.name+"KernelBlurX",new Vector2(1,0),this.blurKernel,1,null,Texture.BILINEAR_SAMPLINGMODE,engine,false,this._textureType);this._kernelBlurXPostprocess.width=targetSize;this._kernelBlurXPostprocess.height=targetSize;this._kernelBlurXPostprocess.externalTextureSamplerBinding=true;this._kernelBlurXPostprocess.onApplyObservable.add(function(effect){effect.setTexture("textureSampler",_this268._shadowMap);});this._kernelBlurYPostprocess=new BlurPostProcess(this._light.name+"KernelBlurY",new Vector2(0,1),this.blurKernel,1,null,Texture.BILINEAR_SAMPLINGMODE,engine,false,this._textureType);this._kernelBlurXPostprocess.autoClear=false;this._kernelBlurYPostprocess.autoClear=false;if(this._textureType===0){this._kernelBlurXPostprocess.packedFloat=true;this._kernelBlurYPostprocess.packedFloat=true;}this._blurPostProcesses=[this._kernelBlurXPostprocess,this._kernelBlurYPostprocess];}else{this._boxBlurPostprocess=new PostProcess(this._light.name+"DepthBoxBlur","depthBoxBlur",["screenSize","boxOffset"],[],1,null,Texture.BILINEAR_SAMPLINGMODE,engine,false,"#define OFFSET "+this._blurBoxOffset,this._textureType);this._boxBlurPostprocess.externalTextureSamplerBinding=true;this._boxBlurPostprocess.onApplyObservable.add(function(effect){effect.setFloat2("screenSize",targetSize,targetSize);effect.setTexture("textureSampler",_this268._shadowMap);});this._boxBlurPostprocess.autoClear=false;this._blurPostProcesses=[this._boxBlurPostprocess];}}},{key:"_renderForShadowMap",value:function _renderForShadowMap(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){var index;if(depthOnlySubMeshes.length){for(index=0;index<depthOnlySubMeshes.length;index++){this._renderSubMeshForShadowMap(depthOnlySubMeshes.data[index]);}}for(index=0;index<opaqueSubMeshes.length;index++){this._renderSubMeshForShadowMap(opaqueSubMeshes.data[index]);}for(index=0;index<alphaTestSubMeshes.length;index++){this._renderSubMeshForShadowMap(alphaTestSubMeshes.data[index]);}if(this._transparencyShadow){for(index=0;index<transparentSubMeshes.length;index++){this._renderSubMeshForShadowMap(transparentSubMeshes.data[index],true);}}else{for(index=0;index<transparentSubMeshes.length;index++){transparentSubMeshes.data[index].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=false;}}}},{key:"_bindCustomEffectForRenderSubMeshForShadowMap",value:function _bindCustomEffectForRenderSubMeshForShadowMap(subMesh,effect,mesh){effect.setMatrix("viewProjection",this.getTransformMatrix());}},{key:"_renderSubMeshForShadowMap",value:function _renderSubMeshForShadowMap(subMesh){var isTransparent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var _a,_b;var renderingMesh=subMesh.getRenderingMesh();var effectiveMesh=subMesh.getEffectiveMesh();var scene2=this._scene;var engine=scene2.getEngine();var material=subMesh.getMaterial();effectiveMesh._internalAbstractMeshDataInfo._isActiveIntermediate=false;if(!material||subMesh.verticesCount===0||subMesh._renderId===scene2.getRenderId()){return;}var detNeg=effectiveMesh._getWorldMatrixDeterminant()<0;var sideOrientation=(_a=renderingMesh.overrideMaterialSideOrientation)!==null&&_a!==void 0?_a:material.sideOrientation;if(detNeg){sideOrientation=sideOrientation===0?1:0;}var reverseSideOrientation=sideOrientation===0;engine.setState(material.backFaceCulling,void 0,void 0,reverseSideOrientation,material.cullBackFaces);var batch=renderingMesh._getInstancesRenderList(subMesh._id,!!subMesh.getReplacementMesh());if(batch.mustReturn){return;}var hardwareInstancedRendering=engine.getCaps().instancedArrays&&(batch.visibleInstances[subMesh._id]!==null&&batch.visibleInstances[subMesh._id]!==void 0||renderingMesh.hasThinInstances);if(this.customAllowRendering&&!this.customAllowRendering(subMesh)){return;}if(this.isReady(subMesh,hardwareInstancedRendering,isTransparent)){subMesh._renderId=scene2.getRenderId();var shadowDepthWrapper=material.shadowDepthWrapper;var drawWrapper=(_b=shadowDepthWrapper===null||shadowDepthWrapper===void 0?void 0:shadowDepthWrapper.getEffect(subMesh,this,engine.currentRenderPassId))!==null&&_b!==void 0?_b:subMesh._getDrawWrapper();var effect=DrawWrapper.GetEffect(drawWrapper);engine.enableEffect(drawWrapper);if(!hardwareInstancedRendering){renderingMesh._bind(subMesh,effect,material.fillMode);}this.getTransformMatrix();effect.setFloat3("biasAndScaleSM",this.bias,this.normalBias,this.depthScale);if(this.getLight().getTypeID()===Light.LIGHTTYPEID_DIRECTIONALLIGHT){effect.setVector3("lightDataSM",this._cachedDirection);}else{effect.setVector3("lightDataSM",this._cachedPosition);}var camera=this._getCamera();if(camera){effect.setFloat2("depthValuesSM",this.getLight().getDepthMinZ(camera),this.getLight().getDepthMinZ(camera)+this.getLight().getDepthMaxZ(camera));}if(isTransparent&&this.enableSoftTransparentShadow){effect.setFloat("softTransparentShadowSM",effectiveMesh.visibility*material.alpha);}if(shadowDepthWrapper){subMesh._setMainDrawWrapperOverride(drawWrapper);if(shadowDepthWrapper.standalone){shadowDepthWrapper.baseMaterial.bindForSubMesh(effectiveMesh.getWorldMatrix(),renderingMesh,subMesh);}else{material.bindForSubMesh(effectiveMesh.getWorldMatrix(),renderingMesh,subMesh);}subMesh._setMainDrawWrapperOverride(null);}else{if(this.useOpacityTextureForTransparentShadow){var opacityTexture=material.opacityTexture;if(opacityTexture){effect.setTexture("diffuseSampler",opacityTexture);effect.setMatrix("diffuseMatrix",opacityTexture.getTextureMatrix()||this._defaultTextureMatrix);}}else if(material.needAlphaTesting()||material.needAlphaBlending()){var alphaTexture=material.getAlphaTestTexture();if(alphaTexture){effect.setTexture("diffuseSampler",alphaTexture);effect.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix()||this._defaultTextureMatrix);}}if(renderingMesh.useBones&&renderingMesh.computeBonesUsingShaders&&renderingMesh.skeleton){var skeleton=renderingMesh.skeleton;if(skeleton.isUsingTextureForMatrices){var boneTexture=skeleton.getTransformMatrixTexture(renderingMesh);if(!boneTexture){return;}effect.setTexture("boneSampler",boneTexture);effect.setFloat("boneTextureWidth",4*(skeleton.bones.length+1));}else{effect.setMatrices("mBones",skeleton.getTransformMatrices(renderingMesh));}}MaterialHelper.BindMorphTargetParameters(renderingMesh,effect);if(renderingMesh.morphTargetManager&&renderingMesh.morphTargetManager.isUsingTextureForTargets){renderingMesh.morphTargetManager._bind(effect);}bindClipPlane(effect,material,scene2);}if(!this._useUBO&&!shadowDepthWrapper){this._bindCustomEffectForRenderSubMeshForShadowMap(subMesh,effect,effectiveMesh);}MaterialHelper.BindSceneUniformBuffer(effect,this._scene.getSceneUniformBuffer());this._scene.getSceneUniformBuffer().bindUniformBuffer();var world=effectiveMesh.getWorldMatrix();if(hardwareInstancedRendering){effectiveMesh.getMeshUniformBuffer().bindToEffect(effect,"Mesh");effectiveMesh.transferToEffect(world);}if(this.forceBackFacesOnly){engine.setState(true,0,false,true,material.cullBackFaces);}this.onBeforeShadowMapRenderMeshObservable.notifyObservers(renderingMesh);this.onBeforeShadowMapRenderObservable.notifyObservers(effect);renderingMesh._processRendering(effectiveMesh,subMesh,effect,material.fillMode,batch,hardwareInstancedRendering,function(isInstance,worldOverride){if(effectiveMesh!==renderingMesh&&!isInstance){renderingMesh.getMeshUniformBuffer().bindToEffect(effect,"Mesh");renderingMesh.transferToEffect(worldOverride);}else{effectiveMesh.getMeshUniformBuffer().bindToEffect(effect,"Mesh");effectiveMesh.transferToEffect(isInstance?worldOverride:world);}});if(this.forceBackFacesOnly){engine.setState(true,0,false,false,material.cullBackFaces);}this.onAfterShadowMapRenderObservable.notifyObservers(effect);this.onAfterShadowMapRenderMeshObservable.notifyObservers(renderingMesh);}else{if(this._shadowMap){this._shadowMap.resetRefreshCounter();}}}},{key:"_applyFilterValues",value:function _applyFilterValues(){if(!this._shadowMap){return;}if(this.filter===ShadowGenerator.FILTER_NONE||this.filter===ShadowGenerator.FILTER_PCSS){this._shadowMap.updateSamplingMode(Texture.NEAREST_SAMPLINGMODE);}else{this._shadowMap.updateSamplingMode(Texture.BILINEAR_SAMPLINGMODE);}}},{key:"forceCompilation",value:function forceCompilation(onCompiled,options){var _this269=this;var localOptions=_objectSpread({useInstances:false},options);var shadowMap=this.getShadowMap();if(!shadowMap){if(onCompiled){onCompiled(this);}return;}var renderList=shadowMap.renderList;if(!renderList){if(onCompiled){onCompiled(this);}return;}var subMeshes=new Array();var _iterator254=_createForOfIteratorHelper(renderList),_step267;try{for(_iterator254.s();!(_step267=_iterator254.n()).done;){var mesh=_step267.value;subMeshes.push.apply(subMeshes,_toConsumableArray(mesh.subMeshes));}}catch(err){_iterator254.e(err);}finally{_iterator254.f();}if(subMeshes.length===0){if(onCompiled){onCompiled(this);}return;}var currentIndex=0;var checkReady=function checkReady(){var _a,_b;if(!_this269._scene||!_this269._scene.getEngine()){return;}while(_this269.isReady(subMeshes[currentIndex],localOptions.useInstances,(_b=(_a=subMeshes[currentIndex].getMaterial())===null||_a===void 0?void 0:_a.needAlphaBlendingForMesh(subMeshes[currentIndex].getMesh()))!==null&&_b!==void 0?_b:false)){currentIndex++;if(currentIndex>=subMeshes.length){if(onCompiled){onCompiled(_this269);}return;}}setTimeout(checkReady,16);};checkReady();}},{key:"forceCompilationAsync",value:function forceCompilationAsync(options){var _this270=this;return new Promise(function(resolve){_this270.forceCompilation(function(){resolve();},options);});}},{key:"_isReadyCustomDefines",value:function _isReadyCustomDefines(defines,subMesh,useInstances){}},{key:"_prepareShadowDefines",value:function _prepareShadowDefines(subMesh,useInstances,defines,isTransparent){defines.push("#define SM_LIGHTTYPE_"+this._light.getClassName().toUpperCase());defines.push("#define SM_FLOAT "+(this._textureType!==0?"1":"0"));defines.push("#define SM_ESM "+(this.useExponentialShadowMap||this.useBlurExponentialShadowMap?"1":"0"));defines.push("#define SM_DEPTHTEXTURE "+(this.usePercentageCloserFiltering||this.useContactHardeningShadow?"1":"0"));var mesh=subMesh.getMesh();defines.push("#define SM_NORMALBIAS "+(this.normalBias&&mesh.isVerticesDataPresent(VertexBuffer.NormalKind)?"1":"0"));defines.push("#define SM_DIRECTIONINLIGHTDATA "+(this.getLight().getTypeID()===Light.LIGHTTYPEID_DIRECTIONALLIGHT?"1":"0"));defines.push("#define SM_USEDISTANCE "+(this._light.needCube()?"1":"0"));defines.push("#define SM_SOFTTRANSPARENTSHADOW "+(this.enableSoftTransparentShadow&&isTransparent?"1":"0"));this._isReadyCustomDefines(defines,subMesh,useInstances);return defines;}},{key:"isReady",value:function isReady(subMesh,useInstances,isTransparent){var _a;var material=subMesh.getMaterial(),shadowDepthWrapper=material===null||material===void 0?void 0:material.shadowDepthWrapper;if(!material){return false;}var defines=[];this._prepareShadowDefines(subMesh,useInstances,defines,isTransparent);if(shadowDepthWrapper){if(!shadowDepthWrapper.isReadyForSubMesh(subMesh,defines,this,useInstances,this._scene.getEngine().currentRenderPassId)){return false;}}else{var subMeshEffect=subMesh._getDrawWrapper(void 0,true);var effect=subMeshEffect.effect;var cachedDefines=subMeshEffect.defines;var attribs=[VertexBuffer.PositionKind];var mesh=subMesh.getMesh();if(this.normalBias&&mesh.isVerticesDataPresent(VertexBuffer.NormalKind)){attribs.push(VertexBuffer.NormalKind);defines.push("#define NORMAL");if(mesh.nonUniformScaling){defines.push("#define NONUNIFORMSCALING");}}var needAlphaTesting=material===null||material===void 0?void 0:material.needAlphaTesting();var needAlphaBlending=material===null||material===void 0?void 0:material.needAlphaBlending();if(material&&(needAlphaTesting||needAlphaBlending)){var alphaTexture=null;if(this.useOpacityTextureForTransparentShadow){alphaTexture=material.opacityTexture;}else{alphaTexture=material.getAlphaTestTexture();}if(alphaTexture){if(!alphaTexture.isReady()){return false;}var alphaCutOff=(_a=material.alphaCutOff)!==null&&_a!==void 0?_a:ShadowGenerator.DEFAULT_ALPHA_CUTOFF;defines.push("#define ALPHATEXTURE");if(needAlphaTesting){defines.push("#define ALPHATESTVALUE ".concat(alphaCutOff).concat(alphaCutOff%1===0?".":""));}if(mesh.isVerticesDataPresent(VertexBuffer.UVKind)){attribs.push(VertexBuffer.UVKind);defines.push("#define UV1");}if(mesh.isVerticesDataPresent(VertexBuffer.UV2Kind)){if(alphaTexture.coordinatesIndex===1){attribs.push(VertexBuffer.UV2Kind);defines.push("#define UV2");}}}}var fallbacks=new EffectFallbacks();if(mesh.useBones&&mesh.computeBonesUsingShaders&&mesh.skeleton){attribs.push(VertexBuffer.MatricesIndicesKind);attribs.push(VertexBuffer.MatricesWeightsKind);if(mesh.numBoneInfluencers>4){attribs.push(VertexBuffer.MatricesIndicesExtraKind);attribs.push(VertexBuffer.MatricesWeightsExtraKind);}var skeleton=mesh.skeleton;defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers);if(mesh.numBoneInfluencers>0){fallbacks.addCPUSkinningFallback(0,mesh);}if(skeleton.isUsingTextureForMatrices){defines.push("#define BONETEXTURE");}else{defines.push("#define BonesPerMesh "+(skeleton.bones.length+1));}}else{defines.push("#define NUM_BONE_INFLUENCERS 0");}var manager=mesh.morphTargetManager;var morphInfluencers=0;if(manager){if(manager.numInfluencers>0){defines.push("#define MORPHTARGETS");morphInfluencers=manager.numInfluencers;defines.push("#define NUM_MORPH_INFLUENCERS "+morphInfluencers);if(manager.isUsingTextureForTargets){defines.push("#define MORPHTARGETS_TEXTURE");}MaterialHelper.PrepareAttributesForMorphTargetsInfluencers(attribs,mesh,morphInfluencers);}}prepareDefinesForClipPlanes(material,this._scene,defines);if(useInstances){defines.push("#define INSTANCES");MaterialHelper.PushAttributesForInstances(attribs);if(subMesh.getRenderingMesh().hasThinInstances){defines.push("#define THIN_INSTANCES");}}if(this.customShaderOptions){if(this.customShaderOptions.defines){var _iterator255=_createForOfIteratorHelper(this.customShaderOptions.defines),_step268;try{for(_iterator255.s();!(_step268=_iterator255.n()).done;){var define=_step268.value;if(defines.indexOf(define)===-1){defines.push(define);}}}catch(err){_iterator255.e(err);}finally{_iterator255.f();}}}var join=defines.join("\n");if(cachedDefines!==join){cachedDefines=join;var shaderName="shadowMap";var uniforms=["world","mBones","viewProjection","diffuseMatrix","lightDataSM","depthValuesSM","biasAndScaleSM","morphTargetInfluences","boneTextureWidth","softTransparentShadowSM","morphTargetTextureInfo","morphTargetTextureIndices"];var samplers=["diffuseSampler","boneSampler","morphTargets"];var uniformBuffers=["Scene","Mesh"];addClipPlaneUniforms(uniforms);if(this.customShaderOptions){shaderName=this.customShaderOptions.shaderName;if(this.customShaderOptions.attributes){var _iterator256=_createForOfIteratorHelper(this.customShaderOptions.attributes),_step269;try{for(_iterator256.s();!(_step269=_iterator256.n()).done;){var attrib=_step269.value;if(attribs.indexOf(attrib)===-1){attribs.push(attrib);}}}catch(err){_iterator256.e(err);}finally{_iterator256.f();}}if(this.customShaderOptions.uniforms){var _iterator257=_createForOfIteratorHelper(this.customShaderOptions.uniforms),_step270;try{for(_iterator257.s();!(_step270=_iterator257.n()).done;){var uniform=_step270.value;if(uniforms.indexOf(uniform)===-1){uniforms.push(uniform);}}}catch(err){_iterator257.e(err);}finally{_iterator257.f();}}if(this.customShaderOptions.samplers){var _iterator258=_createForOfIteratorHelper(this.customShaderOptions.samplers),_step271;try{for(_iterator258.s();!(_step271=_iterator258.n()).done;){var sampler=_step271.value;if(samplers.indexOf(sampler)===-1){samplers.push(sampler);}}}catch(err){_iterator258.e(err);}finally{_iterator258.f();}}}var engine=this._scene.getEngine();effect=engine.createEffect(shaderName,{attributes:attribs,uniformsNames:uniforms,uniformBuffersNames:uniformBuffers,samplers:samplers,defines:join,fallbacks:fallbacks,onCompiled:null,onError:null,indexParameters:{maxSimultaneousMorphTargets:morphInfluencers}},engine);subMeshEffect.setEffect(effect,cachedDefines);}if(!effect.isReady()){return false;}}if(this.useBlurExponentialShadowMap||this.useBlurCloseExponentialShadowMap){if(!this._blurPostProcesses||!this._blurPostProcesses.length){this._initializeBlurRTTAndPostProcesses();}}if(this._kernelBlurXPostprocess&&!this._kernelBlurXPostprocess.isReady()){return false;}if(this._kernelBlurYPostprocess&&!this._kernelBlurYPostprocess.isReady()){return false;}if(this._boxBlurPostprocess&&!this._boxBlurPostprocess.isReady()){return false;}return true;}},{key:"prepareDefines",value:function prepareDefines(defines,lightIndex){var scene2=this._scene;var light=this._light;if(!scene2.shadowsEnabled||!light.shadowEnabled){return;}defines["SHADOW"+lightIndex]=true;if(this.useContactHardeningShadow){defines["SHADOWPCSS"+lightIndex]=true;if(this._filteringQuality===ShadowGenerator.QUALITY_LOW){defines["SHADOWLOWQUALITY"+lightIndex]=true;}else if(this._filteringQuality===ShadowGenerator.QUALITY_MEDIUM){defines["SHADOWMEDIUMQUALITY"+lightIndex]=true;}}else if(this.usePercentageCloserFiltering){defines["SHADOWPCF"+lightIndex]=true;if(this._filteringQuality===ShadowGenerator.QUALITY_LOW){defines["SHADOWLOWQUALITY"+lightIndex]=true;}else if(this._filteringQuality===ShadowGenerator.QUALITY_MEDIUM){defines["SHADOWMEDIUMQUALITY"+lightIndex]=true;}}else if(this.usePoissonSampling){defines["SHADOWPOISSON"+lightIndex]=true;}else if(this.useExponentialShadowMap||this.useBlurExponentialShadowMap){defines["SHADOWESM"+lightIndex]=true;}else if(this.useCloseExponentialShadowMap||this.useBlurCloseExponentialShadowMap){defines["SHADOWCLOSEESM"+lightIndex]=true;}if(light.needCube()){defines["SHADOWCUBE"+lightIndex]=true;}}},{key:"bindShadowLight",value:function bindShadowLight(lightIndex,effect){var light=this._light;var scene2=this._scene;if(!scene2.shadowsEnabled||!light.shadowEnabled){return;}var camera=this._getCamera();if(!camera){return;}var shadowMap=this.getShadowMap();if(!shadowMap){return;}if(!light.needCube()){effect.setMatrix("lightMatrix"+lightIndex,this.getTransformMatrix());}if(this._filter===ShadowGenerator.FILTER_PCF){effect.setDepthStencilTexture("shadowSampler"+lightIndex,this.getShadowMapForRendering());light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),shadowMap.getSize().width,1/shadowMap.getSize().width,this.frustumEdgeFalloff,lightIndex);}else if(this._filter===ShadowGenerator.FILTER_PCSS){effect.setDepthStencilTexture("shadowSampler"+lightIndex,this.getShadowMapForRendering());effect.setTexture("depthSampler"+lightIndex,this.getShadowMapForRendering());light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/shadowMap.getSize().width,this._contactHardeningLightSizeUVRatio*shadowMap.getSize().width,this.frustumEdgeFalloff,lightIndex);}else{effect.setTexture("shadowSampler"+lightIndex,this.getShadowMapForRendering());light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),this.blurScale/shadowMap.getSize().width,this.depthScale,this.frustumEdgeFalloff,lightIndex);}light._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(camera),this.getLight().getDepthMinZ(camera)+this.getLight().getDepthMaxZ(camera),lightIndex);}},{key:"getTransformMatrix",value:function getTransformMatrix(){var scene2=this._scene;if(this._currentRenderId===scene2.getRenderId()&&this._currentFaceIndexCache===this._currentFaceIndex){return this._transformMatrix;}this._currentRenderId=scene2.getRenderId();this._currentFaceIndexCache=this._currentFaceIndex;var lightPosition=this._light.position;if(this._light.computeTransformedInformation()){lightPosition=this._light.transformedPosition;}Vector3.NormalizeToRef(this._light.getShadowDirection(this._currentFaceIndex),this._lightDirection);if(Math.abs(Vector3.Dot(this._lightDirection,Vector3.Up()))===1){this._lightDirection.z=1e-13;}if(this._light.needProjectionMatrixCompute()||!this._cachedPosition||!this._cachedDirection||!lightPosition.equals(this._cachedPosition)||!this._lightDirection.equals(this._cachedDirection)){this._cachedPosition.copyFrom(lightPosition);this._cachedDirection.copyFrom(this._lightDirection);Matrix.LookAtLHToRef(lightPosition,lightPosition.add(this._lightDirection),Vector3.Up(),this._viewMatrix);var shadowMap=this.getShadowMap();if(shadowMap){var renderList=shadowMap.renderList;if(renderList){this._light.setShadowProjectionMatrix(this._projectionMatrix,this._viewMatrix,renderList);}}this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix);}return this._transformMatrix;}},{key:"recreateShadowMap",value:function recreateShadowMap(){var shadowMap=this._shadowMap;if(!shadowMap){return;}var renderList=shadowMap.renderList;this._disposeRTTandPostProcesses();this._initializeGenerator();this.filter=this._filter;this._applyFilterValues();if(renderList){if(!this._shadowMap.renderList){this._shadowMap.renderList=[];}var _iterator259=_createForOfIteratorHelper(renderList),_step272;try{for(_iterator259.s();!(_step272=_iterator259.n()).done;){var mesh=_step272.value;this._shadowMap.renderList.push(mesh);}}catch(err){_iterator259.e(err);}finally{_iterator259.f();}}else{this._shadowMap.renderList=null;}}},{key:"_disposeBlurPostProcesses",value:function _disposeBlurPostProcesses(){if(this._shadowMap2){this._shadowMap2.dispose();this._shadowMap2=null;}if(this._boxBlurPostprocess){this._boxBlurPostprocess.dispose();this._boxBlurPostprocess=null;}if(this._kernelBlurXPostprocess){this._kernelBlurXPostprocess.dispose();this._kernelBlurXPostprocess=null;}if(this._kernelBlurYPostprocess){this._kernelBlurYPostprocess.dispose();this._kernelBlurYPostprocess=null;}this._blurPostProcesses=[];}},{key:"_disposeRTTandPostProcesses",value:function _disposeRTTandPostProcesses(){if(this._shadowMap){this._shadowMap.dispose();this._shadowMap=null;}this._disposeBlurPostProcesses();}},{key:"_disposeSceneUBOs",value:function _disposeSceneUBOs(){if(this._sceneUBOs){var _iterator260=_createForOfIteratorHelper(this._sceneUBOs),_step273;try{for(_iterator260.s();!(_step273=_iterator260.n()).done;){var ubo=_step273.value;ubo.dispose();}}catch(err){_iterator260.e(err);}finally{_iterator260.f();}this._sceneUBOs=[];}}},{key:"dispose",value:function dispose(){this._disposeRTTandPostProcesses();this._disposeSceneUBOs();if(this._light){if(this._light._shadowGenerators){var iterator=this._light._shadowGenerators.entries();for(var entry=iterator.next();entry.done!==true;entry=iterator.next()){var _entry$value=_slicedToArray(entry.value,2),camera=_entry$value[0],shadowGenerator=_entry$value[1];if(shadowGenerator===this){this._light._shadowGenerators["delete"](camera);}}if(this._light._shadowGenerators.size===0){this._light._shadowGenerators=null;}}this._light._markMeshesAsLightDirty();}this.onBeforeShadowMapRenderMeshObservable.clear();this.onBeforeShadowMapRenderObservable.clear();this.onAfterShadowMapRenderMeshObservable.clear();this.onAfterShadowMapRenderObservable.clear();}},{key:"serialize",value:function serialize(){var _a;var serializationObject={};var shadowMap=this.getShadowMap();if(!shadowMap){return serializationObject;}serializationObject.className=this.getClassName();serializationObject.lightId=this._light.id;serializationObject.cameraId=(_a=this._camera)===null||_a===void 0?void 0:_a.id;serializationObject.id=this.id;serializationObject.mapSize=shadowMap.getRenderSize();serializationObject.forceBackFacesOnly=this.forceBackFacesOnly;serializationObject.darkness=this.getDarkness();serializationObject.transparencyShadow=this._transparencyShadow;serializationObject.frustumEdgeFalloff=this.frustumEdgeFalloff;serializationObject.bias=this.bias;serializationObject.normalBias=this.normalBias;serializationObject.usePercentageCloserFiltering=this.usePercentageCloserFiltering;serializationObject.useContactHardeningShadow=this.useContactHardeningShadow;serializationObject.contactHardeningLightSizeUVRatio=this.contactHardeningLightSizeUVRatio;serializationObject.filteringQuality=this.filteringQuality;serializationObject.useExponentialShadowMap=this.useExponentialShadowMap;serializationObject.useBlurExponentialShadowMap=this.useBlurExponentialShadowMap;serializationObject.useCloseExponentialShadowMap=this.useBlurExponentialShadowMap;serializationObject.useBlurCloseExponentialShadowMap=this.useBlurExponentialShadowMap;serializationObject.usePoissonSampling=this.usePoissonSampling;serializationObject.depthScale=this.depthScale;serializationObject.blurBoxOffset=this.blurBoxOffset;serializationObject.blurKernel=this.blurKernel;serializationObject.blurScale=this.blurScale;serializationObject.useKernelBlur=this.useKernelBlur;serializationObject.renderList=[];if(shadowMap.renderList){for(var meshIndex=0;meshIndex<shadowMap.renderList.length;meshIndex++){var mesh=shadowMap.renderList[meshIndex];serializationObject.renderList.push(mesh.id);}}return serializationObject;}}],[{key:"Parse",value:function Parse(parsedShadowGenerator,scene2,constr){var light=scene2.getLightById(parsedShadowGenerator.lightId);var camera=parsedShadowGenerator.cameraId!==void 0?scene2.getCameraById(parsedShadowGenerator.cameraId):null;var shadowGenerator=constr?constr(parsedShadowGenerator.mapSize,light,camera):new ShadowGenerator(parsedShadowGenerator.mapSize,light,void 0,camera);var shadowMap=shadowGenerator.getShadowMap();for(var meshIndex=0;meshIndex<parsedShadowGenerator.renderList.length;meshIndex++){var meshes=scene2.getMeshesById(parsedShadowGenerator.renderList[meshIndex]);meshes.forEach(function(mesh){if(!shadowMap){return;}if(!shadowMap.renderList){shadowMap.renderList=[];}shadowMap.renderList.push(mesh);});}if(parsedShadowGenerator.id!==void 0){shadowGenerator.id=parsedShadowGenerator.id;}shadowGenerator.forceBackFacesOnly=!!parsedShadowGenerator.forceBackFacesOnly;if(parsedShadowGenerator.darkness!==void 0){shadowGenerator.setDarkness(parsedShadowGenerator.darkness);}if(parsedShadowGenerator.transparencyShadow){shadowGenerator.setTransparencyShadow(true);}if(parsedShadowGenerator.frustumEdgeFalloff!==void 0){shadowGenerator.frustumEdgeFalloff=parsedShadowGenerator.frustumEdgeFalloff;}if(parsedShadowGenerator.bias!==void 0){shadowGenerator.bias=parsedShadowGenerator.bias;}if(parsedShadowGenerator.normalBias!==void 0){shadowGenerator.normalBias=parsedShadowGenerator.normalBias;}if(parsedShadowGenerator.usePercentageCloserFiltering){shadowGenerator.usePercentageCloserFiltering=true;}else if(parsedShadowGenerator.useContactHardeningShadow){shadowGenerator.useContactHardeningShadow=true;}else if(parsedShadowGenerator.usePoissonSampling){shadowGenerator.usePoissonSampling=true;}else if(parsedShadowGenerator.useExponentialShadowMap){shadowGenerator.useExponentialShadowMap=true;}else if(parsedShadowGenerator.useBlurExponentialShadowMap){shadowGenerator.useBlurExponentialShadowMap=true;}else if(parsedShadowGenerator.useCloseExponentialShadowMap){shadowGenerator.useCloseExponentialShadowMap=true;}else if(parsedShadowGenerator.useBlurCloseExponentialShadowMap){shadowGenerator.useBlurCloseExponentialShadowMap=true;}else if(parsedShadowGenerator.useVarianceShadowMap){shadowGenerator.useExponentialShadowMap=true;}else if(parsedShadowGenerator.useBlurVarianceShadowMap){shadowGenerator.useBlurExponentialShadowMap=true;}if(parsedShadowGenerator.contactHardeningLightSizeUVRatio!==void 0){shadowGenerator.contactHardeningLightSizeUVRatio=parsedShadowGenerator.contactHardeningLightSizeUVRatio;}if(parsedShadowGenerator.filteringQuality!==void 0){shadowGenerator.filteringQuality=parsedShadowGenerator.filteringQuality;}if(parsedShadowGenerator.depthScale){shadowGenerator.depthScale=parsedShadowGenerator.depthScale;}if(parsedShadowGenerator.blurScale){shadowGenerator.blurScale=parsedShadowGenerator.blurScale;}if(parsedShadowGenerator.blurBoxOffset){shadowGenerator.blurBoxOffset=parsedShadowGenerator.blurBoxOffset;}if(parsedShadowGenerator.useKernelBlur){shadowGenerator.useKernelBlur=parsedShadowGenerator.useKernelBlur;}if(parsedShadowGenerator.blurKernel){shadowGenerator.blurKernel=parsedShadowGenerator.blurKernel;}return shadowGenerator;}}]);return ShadowGenerator;}();ShadowGenerator.CLASSNAME="ShadowGenerator";ShadowGenerator.FILTER_NONE=0;ShadowGenerator.FILTER_EXPONENTIALSHADOWMAP=1;ShadowGenerator.FILTER_POISSONSAMPLING=2;ShadowGenerator.FILTER_BLUREXPONENTIALSHADOWMAP=3;ShadowGenerator.FILTER_CLOSEEXPONENTIALSHADOWMAP=4;ShadowGenerator.FILTER_BLURCLOSEEXPONENTIALSHADOWMAP=5;ShadowGenerator.FILTER_PCF=6;ShadowGenerator.FILTER_PCSS=7;ShadowGenerator.QUALITY_HIGH=0;ShadowGenerator.QUALITY_MEDIUM=1;ShadowGenerator.QUALITY_LOW=2;ShadowGenerator.DEFAULT_ALPHA_CUTOFF=0.5;ShadowGenerator._SceneComponentInitialization=function(_){throw _WarnImport("ShadowGeneratorSceneComponent");};// node_modules/@babylonjs/core/Shaders/depth.fragment.js
var name132="depthPixelShader";var shader132="#ifdef ALPHATEST\nvarying vec2 vUV;\nuniform sampler2D diffuseSampler;\n#endif\n#include<clipPlaneFragmentDeclaration>\nvarying float vDepthMetric;\n#ifdef PACKED\n#include<packingFunctions>\n#endif\n#ifdef STORE_CAMERASPACE_Z\nvarying vec4 vViewPos;\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void)\n{\n#include<clipPlaneFragment>\n#ifdef ALPHATEST\nif (texture2D(diffuseSampler,vUV).a<0.4)\ndiscard;\n#endif\n#ifdef STORE_CAMERASPACE_Z\n#ifdef PACKED\ngl_FragColor=pack(vViewPos.z);\n#else\ngl_FragColor=vec4(vViewPos.z,0.0,0.0,1.0);\n#endif\n#else\n#ifdef NONLINEARDEPTH\n#ifdef PACKED\ngl_FragColor=pack(gl_FragCoord.z);\n#else\ngl_FragColor=vec4(gl_FragCoord.z,0.0,0.0,0.0);\n#endif\n#else\n#ifdef PACKED\ngl_FragColor=pack(vDepthMetric);\n#else\ngl_FragColor=vec4(vDepthMetric,0.0,0.0,1.0);\n#endif\n#endif\n#endif\n}";ShaderStore.ShadersStore[name132]=shader132;// node_modules/@babylonjs/core/Shaders/depth.vertex.js
var name133="depthVertexShader";var shader133="attribute vec3 position;\n#include<bonesDeclaration>\n#include<bakedVertexAnimationDeclaration>\n#include<morphTargetsVertexGlobalDeclaration>\n#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]\n#include<clipPlaneVertexDeclaration>\n#include<instancesDeclaration>\nuniform mat4 viewProjection;\nuniform vec2 depthValues;\n#if defined(ALPHATEST) || defined(NEED_UV)\nvarying vec2 vUV;\nuniform mat4 diffuseMatrix;\n#ifdef UV1\nattribute vec2 uv;\n#endif\n#ifdef UV2\nattribute vec2 uv2;\n#endif\n#endif\n#ifdef STORE_CAMERASPACE_Z\nuniform mat4 view;\nvarying vec4 vViewPos;\n#endif\nvarying float vDepthMetric;\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void)\n{\nvec3 positionUpdated=position;\n#ifdef UV1\nvec2 uvUpdated=uv;\n#endif\n#include<morphTargetsVertexGlobal>\n#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]\n#include<instancesVertex>\n#include<bonesVertex>\n#include<bakedVertexAnimation>\nvec4 worldPos=finalWorld*vec4(positionUpdated,1.0);\n#include<clipPlaneVertex>\ngl_Position=viewProjection*worldPos;\n#ifdef STORE_CAMERASPACE_Z\nvViewPos=view*worldPos;\n#else\n#ifdef USE_REVERSE_DEPTHBUFFER\nvDepthMetric=((-gl_Position.z+depthValues.x)/(depthValues.y));\n#else\nvDepthMetric=((gl_Position.z+depthValues.x)/(depthValues.y));\n#endif\n#endif\n#if defined(ALPHATEST) || defined(BASIC_RENDER)\n#ifdef UV1\nvUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));\n#endif\n#ifdef UV2\nvUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\n#endif\n#endif\n}\n";ShaderStore.ShadersStore[name133]=shader133;// node_modules/@babylonjs/core/Rendering/depthRenderer.js
var DepthRenderer=/*#__PURE__*/function(){function DepthRenderer(scene2){var _this271=this;var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var camera=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var storeNonLinearDepth=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var samplingMode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Texture.TRILINEAR_SAMPLINGMODE;var storeCameraSpaceZ=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var name135=arguments.length>6?arguments[6]:undefined;_classCallCheck(this,DepthRenderer);this.enabled=true;this.forceDepthWriteTransparentMeshes=false;this.useOnlyInActiveCamera=false;this.reverseCulling=false;this._scene=scene2;this._storeNonLinearDepth=storeNonLinearDepth;this._storeCameraSpaceZ=storeCameraSpaceZ;this.isPacked=type===0;if(this.isPacked){this.clearColor=new Color4(1,1,1,1);}else{this.clearColor=new Color4(1,0,0,1);}DepthRenderer._SceneComponentInitialization(this._scene);var engine=scene2.getEngine();this._camera=camera;if(samplingMode!==Texture.NEAREST_SAMPLINGMODE){if(type===1&&!engine._caps.textureFloatLinearFiltering){samplingMode=Texture.NEAREST_SAMPLINGMODE;}if(type===2&&!engine._caps.textureHalfFloatLinearFiltering){samplingMode=Texture.NEAREST_SAMPLINGMODE;}}var format=this.isPacked||!engine._features.supportExtendedTextureFormats?5:6;this._depthMap=new RenderTargetTexture(name135!==null&&name135!==void 0?name135:"DepthRenderer",{width:engine.getRenderWidth(),height:engine.getRenderHeight()},this._scene,false,true,type,false,samplingMode,void 0,void 0,void 0,format);this._depthMap.wrapU=Texture.CLAMP_ADDRESSMODE;this._depthMap.wrapV=Texture.CLAMP_ADDRESSMODE;this._depthMap.refreshRate=1;this._depthMap.renderParticles=false;this._depthMap.renderList=null;this._depthMap.activeCamera=this._camera;this._depthMap.ignoreCameraViewport=true;this._depthMap.useCameraPostProcesses=false;this._depthMap.onClearObservable.add(function(engine2){engine2.clear(_this271.clearColor,true,true,true);});this._depthMap.onBeforeBindObservable.add(function(){var _a;(_a=engine._debugPushGroup)===null||_a===void 0?void 0:_a.call(engine,"depth renderer",1);});this._depthMap.onAfterUnbindObservable.add(function(){var _a;(_a=engine._debugPopGroup)===null||_a===void 0?void 0:_a.call(engine,1);});this._depthMap.customIsReadyFunction=function(mesh,refreshRate,preWarm){if((preWarm||refreshRate===0)&&mesh.subMeshes){for(var i=0;i<mesh.subMeshes.length;++i){var subMesh=mesh.subMeshes[i];var renderingMesh=subMesh.getRenderingMesh();var batch=renderingMesh._getInstancesRenderList(subMesh._id,!!subMesh.getReplacementMesh());var hardwareInstancedRendering=engine.getCaps().instancedArrays&&(batch.visibleInstances[subMesh._id]!==null&&batch.visibleInstances[subMesh._id]!==void 0||renderingMesh.hasThinInstances);if(!_this271.isReady(subMesh,hardwareInstancedRendering)){return false;}}}return true;};var renderSubMesh=function renderSubMesh(subMesh){var _a,_b;var renderingMesh=subMesh.getRenderingMesh();var effectiveMesh=subMesh.getEffectiveMesh();var scene3=_this271._scene;var engine2=scene3.getEngine();var material=subMesh.getMaterial();effectiveMesh._internalAbstractMeshDataInfo._isActiveIntermediate=false;if(!material||effectiveMesh.infiniteDistance||material.disableDepthWrite||subMesh.verticesCount===0||subMesh._renderId===scene3.getRenderId()){return;}var detNeg=effectiveMesh._getWorldMatrixDeterminant()<0;var sideOrientation=(_a=renderingMesh.overrideMaterialSideOrientation)!==null&&_a!==void 0?_a:material.sideOrientation;if(detNeg){sideOrientation=sideOrientation===0?1:0;}var reverseSideOrientation=sideOrientation===0;engine2.setState(material.backFaceCulling,0,false,reverseSideOrientation,_this271.reverseCulling?!material.cullBackFaces:material.cullBackFaces);var batch=renderingMesh._getInstancesRenderList(subMesh._id,!!subMesh.getReplacementMesh());if(batch.mustReturn){return;}var hardwareInstancedRendering=engine2.getCaps().instancedArrays&&(batch.visibleInstances[subMesh._id]!==null&&batch.visibleInstances[subMesh._id]!==void 0||renderingMesh.hasThinInstances);var camera2=_this271._camera||scene3.activeCamera;if(_this271.isReady(subMesh,hardwareInstancedRendering)&&camera2){subMesh._renderId=scene3.getRenderId();var renderingMaterial=(_b=effectiveMesh._internalAbstractMeshDataInfo._materialForRenderPass)===null||_b===void 0?void 0:_b[engine2.currentRenderPassId];var drawWrapper=subMesh._getDrawWrapper();if(!drawWrapper&&renderingMaterial){drawWrapper=renderingMaterial._getDrawWrapper();}var cameraIsOrtho=camera2.mode===Camera.ORTHOGRAPHIC_CAMERA;if(!drawWrapper){return;}var effect=drawWrapper.effect;engine2.enableEffect(drawWrapper);if(!hardwareInstancedRendering){renderingMesh._bind(subMesh,effect,material.fillMode);}if(!renderingMaterial){effect.setMatrix("viewProjection",scene3.getTransformMatrix());effect.setMatrix("world",effectiveMesh.getWorldMatrix());if(_this271._storeCameraSpaceZ){effect.setMatrix("view",scene3.getViewMatrix());}}else{renderingMaterial.bindForSubMesh(effectiveMesh.getWorldMatrix(),effectiveMesh,subMesh);}var minZ,maxZ;if(cameraIsOrtho){minZ=!engine2.useReverseDepthBuffer&&engine2.isNDCHalfZRange?0:1;maxZ=engine2.useReverseDepthBuffer&&engine2.isNDCHalfZRange?0:1;}else{minZ=engine2.useReverseDepthBuffer&&engine2.isNDCHalfZRange?camera2.minZ:engine2.isNDCHalfZRange?0:camera2.minZ;maxZ=engine2.useReverseDepthBuffer&&engine2.isNDCHalfZRange?0:camera2.maxZ;}effect.setFloat2("depthValues",minZ,minZ+maxZ);if(!renderingMaterial){if(material.needAlphaTesting()){var alphaTexture=material.getAlphaTestTexture();if(alphaTexture){effect.setTexture("diffuseSampler",alphaTexture);effect.setMatrix("diffuseMatrix",alphaTexture.getTextureMatrix());}}if(renderingMesh.useBones&&renderingMesh.computeBonesUsingShaders&&renderingMesh.skeleton){var skeleton=renderingMesh.skeleton;if(skeleton.isUsingTextureForMatrices){var boneTexture=skeleton.getTransformMatrixTexture(renderingMesh);if(!boneTexture){return;}effect.setTexture("boneSampler",boneTexture);effect.setFloat("boneTextureWidth",4*(skeleton.bones.length+1));}else{effect.setMatrices("mBones",skeleton.getTransformMatrices(renderingMesh));}}bindClipPlane(effect,material,scene3);MaterialHelper.BindMorphTargetParameters(renderingMesh,effect);if(renderingMesh.morphTargetManager&&renderingMesh.morphTargetManager.isUsingTextureForTargets){renderingMesh.morphTargetManager._bind(effect);}}renderingMesh._processRendering(effectiveMesh,subMesh,effect,material.fillMode,batch,hardwareInstancedRendering,function(isInstance,world){return effect.setMatrix("world",world);});}};this._depthMap.customRenderFunction=function(opaqueSubMeshes,alphaTestSubMeshes,transparentSubMeshes,depthOnlySubMeshes){var index;if(depthOnlySubMeshes.length){for(index=0;index<depthOnlySubMeshes.length;index++){renderSubMesh(depthOnlySubMeshes.data[index]);}}for(index=0;index<opaqueSubMeshes.length;index++){renderSubMesh(opaqueSubMeshes.data[index]);}for(index=0;index<alphaTestSubMeshes.length;index++){renderSubMesh(alphaTestSubMeshes.data[index]);}if(_this271.forceDepthWriteTransparentMeshes){for(index=0;index<transparentSubMeshes.length;index++){renderSubMesh(transparentSubMeshes.data[index]);}}else{for(index=0;index<transparentSubMeshes.length;index++){transparentSubMeshes.data[index].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate=false;}}};}_createClass(DepthRenderer,[{key:"setMaterialForRendering",value:function setMaterialForRendering(mesh,material){this._depthMap.setMaterialForRendering(mesh,material);}},{key:"isReady",value:function isReady(subMesh,useInstances){var _a;var engine=this._scene.getEngine();var mesh=subMesh.getMesh();var scene2=mesh.getScene();var renderingMaterial=(_a=mesh._internalAbstractMeshDataInfo._materialForRenderPass)===null||_a===void 0?void 0:_a[engine.currentRenderPassId];if(renderingMaterial){return renderingMaterial.isReadyForSubMesh(mesh,subMesh,useInstances);}var material=subMesh.getMaterial();if(!material||material.disableDepthWrite){return false;}var defines=[];var attribs=[VertexBuffer.PositionKind];if(material&&material.needAlphaTesting()&&material.getAlphaTestTexture()){defines.push("#define ALPHATEST");if(mesh.isVerticesDataPresent(VertexBuffer.UVKind)){attribs.push(VertexBuffer.UVKind);defines.push("#define UV1");}if(mesh.isVerticesDataPresent(VertexBuffer.UV2Kind)){attribs.push(VertexBuffer.UV2Kind);defines.push("#define UV2");}}if(mesh.useBones&&mesh.computeBonesUsingShaders){attribs.push(VertexBuffer.MatricesIndicesKind);attribs.push(VertexBuffer.MatricesWeightsKind);if(mesh.numBoneInfluencers>4){attribs.push(VertexBuffer.MatricesIndicesExtraKind);attribs.push(VertexBuffer.MatricesWeightsExtraKind);}defines.push("#define NUM_BONE_INFLUENCERS "+mesh.numBoneInfluencers);defines.push("#define BonesPerMesh "+(mesh.skeleton?mesh.skeleton.bones.length+1:0));var skeleton=subMesh.getRenderingMesh().skeleton;if(skeleton===null||skeleton===void 0?void 0:skeleton.isUsingTextureForMatrices){defines.push("#define BONETEXTURE");}}else{defines.push("#define NUM_BONE_INFLUENCERS 0");}var morphTargetManager=mesh.morphTargetManager;var numMorphInfluencers=0;if(morphTargetManager){if(morphTargetManager.numInfluencers>0){numMorphInfluencers=morphTargetManager.numInfluencers;defines.push("#define MORPHTARGETS");defines.push("#define NUM_MORPH_INFLUENCERS "+numMorphInfluencers);if(morphTargetManager.isUsingTextureForTargets){defines.push("#define MORPHTARGETS_TEXTURE");}MaterialHelper.PrepareAttributesForMorphTargetsInfluencers(attribs,mesh,numMorphInfluencers);}}if(useInstances){defines.push("#define INSTANCES");MaterialHelper.PushAttributesForInstances(attribs);if(subMesh.getRenderingMesh().hasThinInstances){defines.push("#define THIN_INSTANCES");}}if(this._storeNonLinearDepth){defines.push("#define NONLINEARDEPTH");}if(this._storeCameraSpaceZ){defines.push("#define STORE_CAMERASPACE_Z");}if(this.isPacked){defines.push("#define PACKED");}prepareDefinesForClipPlanes(material,scene2,defines);var drawWrapper=subMesh._getDrawWrapper(void 0,true);var cachedDefines=drawWrapper.defines;var join=defines.join("\n");if(cachedDefines!==join){var uniforms=["world","mBones","boneTextureWidth","viewProjection","view","diffuseMatrix","depthValues","morphTargetInfluences","morphTargetTextureInfo","morphTargetTextureIndices"];addClipPlaneUniforms(uniforms);drawWrapper.setEffect(engine.createEffect("depth",attribs,uniforms,["diffuseSampler","morphTargets","boneSampler"],join,void 0,void 0,void 0,{maxSimultaneousMorphTargets:numMorphInfluencers}),join);}return drawWrapper.effect.isReady();}},{key:"getDepthMap",value:function getDepthMap(){return this._depthMap;}},{key:"dispose",value:function dispose(){var keysToDelete=[];for(var key in this._scene._depthRenderer){var depthRenderer=this._scene._depthRenderer[key];if(depthRenderer===this){keysToDelete.push(key);}}if(keysToDelete.length>0){this._depthMap.dispose();var _iterator261=_createForOfIteratorHelper(keysToDelete),_step274;try{for(_iterator261.s();!(_step274=_iterator261.n()).done;){var _key43=_step274.value;delete this._scene._depthRenderer[_key43];}}catch(err){_iterator261.e(err);}finally{_iterator261.f();}}}}]);return DepthRenderer;}();DepthRenderer._SceneComponentInitialization=function(_){throw _WarnImport("DepthRendererSceneComponent");};// node_modules/@babylonjs/core/Shaders/minmaxRedux.fragment.js
var name134="minmaxReduxPixelShader";var shader134="varying vec2 vUV;\nuniform sampler2D textureSampler;\n#if defined(INITIAL)\nuniform sampler2D sourceTexture;\nuniform vec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*(texSize-1.0));\nfloat f1=texelFetch(sourceTexture,coord,0).r;\nfloat f2=texelFetch(sourceTexture,coord+ivec2(1,0),0).r;\nfloat f3=texelFetch(sourceTexture,coord+ivec2(1,1),0).r;\nfloat f4=texelFetch(sourceTexture,coord+ivec2(0,1),0).r;\nfloat minz=min(min(min(f1,f2),f3),f4);\n#ifdef DEPTH_REDUX\nfloat maxz=max(max(max(sign(1.0-f1)*f1,sign(1.0-f2)*f2),sign(1.0-f3)*f3),sign(1.0-f4)*f4);\n#else\nfloat maxz=max(max(max(f1,f2),f3),f4);\n#endif\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(MAIN)\nuniform vec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*(texSize-1.0));\nvec2 f1=texelFetch(textureSampler,coord,0).rg;\nvec2 f2=texelFetch(textureSampler,coord+ivec2(1,0),0).rg;\nvec2 f3=texelFetch(textureSampler,coord+ivec2(1,1),0).rg;\nvec2 f4=texelFetch(textureSampler,coord+ivec2(0,1),0).rg;\nfloat minz=min(min(min(f1.x,f2.x),f3.x),f4.x);\nfloat maxz=max(max(max(f1.y,f2.y),f3.y),f4.y);\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(ONEBEFORELAST)\nuniform ivec2 texSize;\nvoid main(void)\n{\nivec2 coord=ivec2(vUV*vec2(texSize-1));\nvec2 f1=texelFetch(textureSampler,coord % texSize,0).rg;\nvec2 f2=texelFetch(textureSampler,(coord+ivec2(1,0)) % texSize,0).rg;\nvec2 f3=texelFetch(textureSampler,(coord+ivec2(1,1)) % texSize,0).rg;\nvec2 f4=texelFetch(textureSampler,(coord+ivec2(0,1)) % texSize,0).rg;\nfloat minz=min(f1.x,f2.x);\nfloat maxz=max(f1.y,f2.y);\nglFragColor=vec4(minz,maxz,0.,0.);\n}\n#elif defined(LAST)\nvoid main(void)\n{\nglFragColor=vec4(0.);\nif (true) { \ndiscard;\n}\n}\n#endif\n";ShaderStore.ShadersStore[name134]=shader134;// node_modules/@babylonjs/core/Misc/minMaxReducer.js
var MinMaxReducer=/*#__PURE__*/function(){function MinMaxReducer(camera){var _this272=this;_classCallCheck(this,MinMaxReducer);this.onAfterReductionPerformed=new Observable();this._forceFullscreenViewport=true;this._activated=false;this._camera=camera;this._postProcessManager=new PostProcessManager(camera.getScene());this._onContextRestoredObserver=camera.getEngine().onContextRestoredObservable.add(function(){_this272._postProcessManager._rebuild();});}_createClass(MinMaxReducer,[{key:"sourceTexture",get:function get(){return this._sourceTexture;}},{key:"setSourceTexture",value:function setSourceTexture(sourceTexture,depthRedux){var _this273=this;var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var forceFullscreenViewport=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(sourceTexture===this._sourceTexture){return;}this.dispose(false);this._sourceTexture=sourceTexture;this._reductionSteps=[];this._forceFullscreenViewport=forceFullscreenViewport;var scene2=this._camera.getScene();var reductionInitial=new PostProcess("Initial reduction phase","minmaxRedux",["texSize"],["sourceTexture"],1,null,1,scene2.getEngine(),false,"#define INITIAL"+(depthRedux?"\n#define DEPTH_REDUX":""),type,void 0,void 0,void 0,7);reductionInitial.autoClear=false;reductionInitial.forceFullscreenViewport=forceFullscreenViewport;var w=this._sourceTexture.getRenderWidth(),h=this._sourceTexture.getRenderHeight();reductionInitial.onApply=function(w2,h2){return function(effect){effect.setTexture("sourceTexture",_this273._sourceTexture);effect.setFloat2("texSize",w2,h2);};}(w,h);this._reductionSteps.push(reductionInitial);var index=1;while(w>1||h>1){w=Math.max(Math.round(w/2),1);h=Math.max(Math.round(h/2),1);var reduction=new PostProcess("Reduction phase "+index,"minmaxRedux",["texSize"],null,{width:w,height:h},null,1,scene2.getEngine(),false,"#define "+(w==1&&h==1?"LAST":w==1||h==1?"ONEBEFORELAST":"MAIN"),type,void 0,void 0,void 0,7);reduction.autoClear=false;reduction.forceFullscreenViewport=forceFullscreenViewport;reduction.onApply=function(w2,h2){return function(effect){if(w2==1||h2==1){effect.setInt2("texSize",w2,h2);}else{effect.setFloat2("texSize",w2,h2);}};}(w,h);this._reductionSteps.push(reduction);index++;if(w==1&&h==1){var func=function func(w2,h2,reduction2){var buffer=new Float32Array(4*w2*h2),minmax={min:0,max:0};return function(){scene2.getEngine()._readTexturePixels(reduction2.inputTexture.texture,w2,h2,-1,0,buffer,false);minmax.min=buffer[0];minmax.max=buffer[1];_this273.onAfterReductionPerformed.notifyObservers(minmax);};};reduction.onAfterRenderObservable.add(func(w,h,reduction));}}}},{key:"refreshRate",get:function get(){return this._sourceTexture?this._sourceTexture.refreshRate:-1;},set:function set(value){if(this._sourceTexture){this._sourceTexture.refreshRate=value;}}},{key:"activated",get:function get(){return this._activated;}},{key:"activate",value:function activate(){var _this274=this;if(this._onAfterUnbindObserver||!this._sourceTexture){return;}this._onAfterUnbindObserver=this._sourceTexture.onAfterUnbindObservable.add(function(){var _a,_b;var engine=_this274._camera.getScene().getEngine();(_a=engine._debugPushGroup)===null||_a===void 0?void 0:_a.call(engine,"min max reduction",1);_this274._reductionSteps[0].activate(_this274._camera);_this274._postProcessManager.directRender(_this274._reductionSteps,_this274._reductionSteps[0].inputTexture,_this274._forceFullscreenViewport);engine.unBindFramebuffer(_this274._reductionSteps[0].inputTexture,false);(_b=engine._debugPopGroup)===null||_b===void 0?void 0:_b.call(engine,1);});this._activated=true;}},{key:"deactivate",value:function deactivate(){if(!this._onAfterUnbindObserver||!this._sourceTexture){return;}this._sourceTexture.onAfterUnbindObservable.remove(this._onAfterUnbindObserver);this._onAfterUnbindObserver=null;this._activated=false;}},{key:"dispose",value:function dispose(){var disposeAll=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(disposeAll){this.onAfterReductionPerformed.clear();if(this._onContextRestoredObserver){this._camera.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver);this._onContextRestoredObserver=null;}}this.deactivate();if(this._reductionSteps){for(var i=0;i<this._reductionSteps.length;++i){this._reductionSteps[i].dispose();}this._reductionSteps=null;}if(this._postProcessManager&&disposeAll){this._postProcessManager.dispose();}this._sourceTexture=null;}}]);return MinMaxReducer;}();// node_modules/@babylonjs/core/Misc/depthReducer.js
var DepthReducer=/*#__PURE__*/function(_MinMaxReducer){_inherits(DepthReducer,_MinMaxReducer);var _super80=_createSuper(DepthReducer);function DepthReducer(camera){_classCallCheck(this,DepthReducer);return _super80.call(this,camera);}_createClass(DepthReducer,[{key:"depthRenderer",get:function get(){return this._depthRenderer;}},{key:"setDepthRenderer",value:function setDepthRenderer(){var depthRenderer=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var forceFullscreenViewport=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var scene2=this._camera.getScene();if(this._depthRenderer){delete scene2._depthRenderer[this._depthRendererId];this._depthRenderer.dispose();this._depthRenderer=null;}if(depthRenderer===null){if(!scene2._depthRenderer){scene2._depthRenderer={};}depthRenderer=this._depthRenderer=new DepthRenderer(scene2,type,this._camera,false,1);depthRenderer.enabled=false;this._depthRendererId="minmax"+this._camera.id;scene2._depthRenderer[this._depthRendererId]=depthRenderer;}_get(_getPrototypeOf(DepthReducer.prototype),"setSourceTexture",this).call(this,depthRenderer.getDepthMap(),true,type,forceFullscreenViewport);}},{key:"setSourceTexture",value:function setSourceTexture(sourceTexture,depthRedux){var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var forceFullscreenViewport=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;_get(_getPrototypeOf(DepthReducer.prototype),"setSourceTexture",this).call(this,sourceTexture,depthRedux,type,forceFullscreenViewport);}},{key:"activate",value:function activate(){if(this._depthRenderer){this._depthRenderer.enabled=true;}_get(_getPrototypeOf(DepthReducer.prototype),"activate",this).call(this);}},{key:"deactivate",value:function deactivate(){_get(_getPrototypeOf(DepthReducer.prototype),"deactivate",this).call(this);if(this._depthRenderer){this._depthRenderer.enabled=false;}}},{key:"dispose",value:function dispose(){var disposeAll=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;_get(_getPrototypeOf(DepthReducer.prototype),"dispose",this).call(this,disposeAll);if(this._depthRenderer&&disposeAll){var scene2=this._depthRenderer.getDepthMap().getScene();if(scene2){delete scene2._depthRenderer[this._depthRendererId];}this._depthRenderer.dispose();this._depthRenderer=null;}}}]);return DepthReducer;}(MinMaxReducer);// node_modules/@babylonjs/core/Lights/Shadows/cascadedShadowGenerator.js
var UpDir=Vector3.Up();var ZeroVec=Vector3.Zero();var tmpv1=new Vector3();var tmpv2=new Vector3();var tmpMatrix=new Matrix();var CascadedShadowGenerator=/*#__PURE__*/function(_ShadowGenerator){_inherits(CascadedShadowGenerator,_ShadowGenerator);var _super81=_createSuper(CascadedShadowGenerator);function CascadedShadowGenerator(mapSize,light,usefulFloatFirst,camera){var _this275;_classCallCheck(this,CascadedShadowGenerator);if(!CascadedShadowGenerator.IsSupported){Logger.Error("CascadedShadowMap is not supported by the current engine.");return _possibleConstructorReturn(_this275);}_this275=_super81.call(this,mapSize,light,usefulFloatFirst,camera);_this275.usePercentageCloserFiltering=true;return _this275;}_createClass(CascadedShadowGenerator,[{key:"_validateFilter",value:function _validateFilter(filter){if(filter===ShadowGenerator.FILTER_NONE||filter===ShadowGenerator.FILTER_PCF||filter===ShadowGenerator.FILTER_PCSS){return filter;}console.error('Unsupported filter "'+filter+'"!');return ShadowGenerator.FILTER_NONE;}},{key:"numCascades",get:function get(){return this._numCascades;},set:function set(value){value=Math.min(Math.max(value,CascadedShadowGenerator.MIN_CASCADES_COUNT),CascadedShadowGenerator.MAX_CASCADES_COUNT);if(value===this._numCascades){return;}this._numCascades=value;this.recreateShadowMap();this._recreateSceneUBOs();}},{key:"freezeShadowCastersBoundingInfo",get:function get(){return this._freezeShadowCastersBoundingInfo;},set:function set(freeze){if(this._freezeShadowCastersBoundingInfoObservable&&freeze){this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable);this._freezeShadowCastersBoundingInfoObservable=null;}if(!this._freezeShadowCastersBoundingInfoObservable&&!freeze){this._freezeShadowCastersBoundingInfoObservable=this._scene.onBeforeRenderObservable.add(this._computeShadowCastersBoundingInfo.bind(this));}this._freezeShadowCastersBoundingInfo=freeze;if(freeze){this._computeShadowCastersBoundingInfo();}}},{key:"_computeShadowCastersBoundingInfo",value:function _computeShadowCastersBoundingInfo(){this._scbiMin.copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._scbiMax.copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);if(this._shadowMap&&this._shadowMap.renderList){var renderList=this._shadowMap.renderList;for(var meshIndex=0;meshIndex<renderList.length;meshIndex++){var mesh=renderList[meshIndex];if(!mesh){continue;}var boundingInfo=mesh.getBoundingInfo(),boundingBox=boundingInfo.boundingBox;this._scbiMin.minimizeInPlace(boundingBox.minimumWorld);this._scbiMax.maximizeInPlace(boundingBox.maximumWorld);}var meshes=this._scene.meshes;for(var _meshIndex2=0;_meshIndex2<meshes.length;_meshIndex2++){var _mesh8=meshes[_meshIndex2];if(!_mesh8||!_mesh8.isVisible||!_mesh8.isEnabled||!_mesh8.receiveShadows){continue;}var _boundingInfo=_mesh8.getBoundingInfo(),_boundingBox=_boundingInfo.boundingBox;this._scbiMin.minimizeInPlace(_boundingBox.minimumWorld);this._scbiMax.maximizeInPlace(_boundingBox.maximumWorld);}}this._shadowCastersBoundingInfo.reConstruct(this._scbiMin,this._scbiMax);}},{key:"shadowCastersBoundingInfo",get:function get(){return this._shadowCastersBoundingInfo;},set:function set(boundingInfo){this._shadowCastersBoundingInfo=boundingInfo;}},{key:"setMinMaxDistance",value:function setMinMaxDistance(min,max){if(this._minDistance===min&&this._maxDistance===max){return;}if(min>max){min=0;max=1;}if(min<0){min=0;}if(max>1){max=1;}this._minDistance=min;this._maxDistance=max;this._breaksAreDirty=true;}},{key:"minDistance",get:function get(){return this._minDistance;}},{key:"maxDistance",get:function get(){return this._maxDistance;}},{key:"getClassName",value:function getClassName(){return CascadedShadowGenerator.CLASSNAME;}},{key:"getCascadeMinExtents",value:function getCascadeMinExtents(cascadeIndex){return cascadeIndex>=0&&cascadeIndex<this._numCascades?this._cascadeMinExtents[cascadeIndex]:null;}},{key:"getCascadeMaxExtents",value:function getCascadeMaxExtents(cascadeIndex){return cascadeIndex>=0&&cascadeIndex<this._numCascades?this._cascadeMaxExtents[cascadeIndex]:null;}},{key:"shadowMaxZ",get:function get(){if(!this._getCamera()){return 0;}return this._shadowMaxZ;},set:function set(value){var camera=this._getCamera();if(!camera){this._shadowMaxZ=value;return;}if(this._shadowMaxZ===value||value<camera.minZ||value>camera.maxZ){return;}this._shadowMaxZ=value;this._light._markMeshesAsLightDirty();this._breaksAreDirty=true;}},{key:"debug",get:function get(){return this._debug;},set:function set(dbg){this._debug=dbg;this._light._markMeshesAsLightDirty();}},{key:"depthClamp",get:function get(){return this._depthClamp;},set:function set(value){this._depthClamp=value;}},{key:"cascadeBlendPercentage",get:function get(){return this._cascadeBlendPercentage;},set:function set(value){this._cascadeBlendPercentage=value;this._light._markMeshesAsLightDirty();}},{key:"lambda",get:function get(){return this._lambda;},set:function set(value){var lambda=Math.min(Math.max(value,0),1);if(this._lambda==lambda){return;}this._lambda=lambda;this._breaksAreDirty=true;}},{key:"getCascadeViewMatrix",value:function getCascadeViewMatrix(cascadeNum){return cascadeNum>=0&&cascadeNum<this._numCascades?this._viewMatrices[cascadeNum]:null;}},{key:"getCascadeProjectionMatrix",value:function getCascadeProjectionMatrix(cascadeNum){return cascadeNum>=0&&cascadeNum<this._numCascades?this._projectionMatrices[cascadeNum]:null;}},{key:"getCascadeTransformMatrix",value:function getCascadeTransformMatrix(cascadeNum){return cascadeNum>=0&&cascadeNum<this._numCascades?this._transformMatrices[cascadeNum]:null;}},{key:"setDepthRenderer",value:function setDepthRenderer(depthRenderer){this._depthRenderer=depthRenderer;if(this._depthReducer){this._depthReducer.setDepthRenderer(this._depthRenderer);}}},{key:"autoCalcDepthBounds",get:function get(){return this._autoCalcDepthBounds;},set:function set(value){var _this276=this;var camera=this._getCamera();if(!camera){return;}this._autoCalcDepthBounds=value;if(!value){if(this._depthReducer){this._depthReducer.deactivate();}this.setMinMaxDistance(0,1);return;}if(!this._depthReducer){this._depthReducer=new DepthReducer(camera);this._depthReducer.onAfterReductionPerformed.add(function(minmax){var min=minmax.min,max=minmax.max;if(min>=max){min=0;max=1;}if(min!=_this276._minDistance||max!=_this276._maxDistance){_this276.setMinMaxDistance(min,max);}});this._depthReducer.setDepthRenderer(this._depthRenderer);}this._depthReducer.activate();}},{key:"autoCalcDepthBoundsRefreshRate",get:function get(){var _a,_b,_c;return(_c=(_b=(_a=this._depthReducer)===null||_a===void 0?void 0:_a.depthRenderer)===null||_b===void 0?void 0:_b.getDepthMap().refreshRate)!==null&&_c!==void 0?_c:-1;},set:function set(value){var _a;if((_a=this._depthReducer)===null||_a===void 0?void 0:_a.depthRenderer){this._depthReducer.depthRenderer.getDepthMap().refreshRate=value;}}},{key:"splitFrustum",value:function splitFrustum(){this._breaksAreDirty=true;}},{key:"_splitFrustum",value:function _splitFrustum(){var camera=this._getCamera();if(!camera){return;}var near=camera.minZ,far=camera.maxZ,cameraRange=far-near,minDistance=this._minDistance,maxDistance=this._shadowMaxZ<far&&this._shadowMaxZ>=near?Math.min((this._shadowMaxZ-near)/(far-near),this._maxDistance):this._maxDistance;var minZ=near+minDistance*cameraRange,maxZ=near+maxDistance*cameraRange;var range=maxZ-minZ,ratio=maxZ/minZ;for(var cascadeIndex=0;cascadeIndex<this._cascades.length;++cascadeIndex){var p=(cascadeIndex+1)/this._numCascades,log=minZ*Math.pow(ratio,p),uniform=minZ+range*p;var d=this._lambda*(log-uniform)+uniform;this._cascades[cascadeIndex].prevBreakDistance=cascadeIndex===0?minDistance:this._cascades[cascadeIndex-1].breakDistance;this._cascades[cascadeIndex].breakDistance=(d-near)/cameraRange;this._viewSpaceFrustumsZ[cascadeIndex]=d;this._frustumLengths[cascadeIndex]=(this._cascades[cascadeIndex].breakDistance-this._cascades[cascadeIndex].prevBreakDistance)*cameraRange;}this._breaksAreDirty=false;}},{key:"_computeMatrices",value:function _computeMatrices(){var scene2=this._scene;var camera=this._getCamera();if(!camera){return;}Vector3.NormalizeToRef(this._light.getShadowDirection(0),this._lightDirection);if(Math.abs(Vector3.Dot(this._lightDirection,Vector3.Up()))===1){this._lightDirection.z=1e-13;}this._cachedDirection.copyFrom(this._lightDirection);var useReverseDepthBuffer=scene2.getEngine().useReverseDepthBuffer;for(var cascadeIndex=0;cascadeIndex<this._numCascades;++cascadeIndex){this._computeFrustumInWorldSpace(cascadeIndex);this._computeCascadeFrustum(cascadeIndex);this._cascadeMaxExtents[cascadeIndex].subtractToRef(this._cascadeMinExtents[cascadeIndex],tmpv1);this._frustumCenter[cascadeIndex].addToRef(this._lightDirection.scale(this._cascadeMinExtents[cascadeIndex].z),this._shadowCameraPos[cascadeIndex]);Matrix.LookAtLHToRef(this._shadowCameraPos[cascadeIndex],this._frustumCenter[cascadeIndex],UpDir,this._viewMatrices[cascadeIndex]);var minZ=0,maxZ=tmpv1.z;var boundingInfo=this._shadowCastersBoundingInfo;boundingInfo.update(this._viewMatrices[cascadeIndex]);maxZ=Math.min(maxZ,boundingInfo.boundingBox.maximumWorld.z);if(!this._depthClamp||this.filter===ShadowGenerator.FILTER_PCSS){minZ=Math.min(minZ,boundingInfo.boundingBox.minimumWorld.z);}else{minZ=Math.max(minZ,boundingInfo.boundingBox.minimumWorld.z);}Matrix.OrthoOffCenterLHToRef(this._cascadeMinExtents[cascadeIndex].x,this._cascadeMaxExtents[cascadeIndex].x,this._cascadeMinExtents[cascadeIndex].y,this._cascadeMaxExtents[cascadeIndex].y,useReverseDepthBuffer?maxZ:minZ,useReverseDepthBuffer?minZ:maxZ,this._projectionMatrices[cascadeIndex],scene2.getEngine().isNDCHalfZRange);this._cascadeMinExtents[cascadeIndex].z=minZ;this._cascadeMaxExtents[cascadeIndex].z=maxZ;this._viewMatrices[cascadeIndex].multiplyToRef(this._projectionMatrices[cascadeIndex],this._transformMatrices[cascadeIndex]);Vector3.TransformCoordinatesToRef(ZeroVec,this._transformMatrices[cascadeIndex],tmpv1);tmpv1.scaleInPlace(this._mapSize/2);tmpv2.copyFromFloats(Math.round(tmpv1.x),Math.round(tmpv1.y),Math.round(tmpv1.z));tmpv2.subtractInPlace(tmpv1).scaleInPlace(2/this._mapSize);Matrix.TranslationToRef(tmpv2.x,tmpv2.y,0,tmpMatrix);this._projectionMatrices[cascadeIndex].multiplyToRef(tmpMatrix,this._projectionMatrices[cascadeIndex]);this._viewMatrices[cascadeIndex].multiplyToRef(this._projectionMatrices[cascadeIndex],this._transformMatrices[cascadeIndex]);this._transformMatrices[cascadeIndex].copyToArray(this._transformMatricesAsArray,cascadeIndex*16);}}},{key:"_computeFrustumInWorldSpace",value:function _computeFrustumInWorldSpace(cascadeIndex){var camera=this._getCamera();if(!camera){return;}var prevSplitDist=this._cascades[cascadeIndex].prevBreakDistance,splitDist=this._cascades[cascadeIndex].breakDistance;var isNDCHalfZRange=this._scene.getEngine().isNDCHalfZRange;camera.getViewMatrix();var invViewProj=Matrix.Invert(camera.getTransformationMatrix());var cornerIndexOffset=this._scene.getEngine().useReverseDepthBuffer?4:0;for(var cornerIndex=0;cornerIndex<CascadedShadowGenerator._FrustumCornersNDCSpace.length;++cornerIndex){tmpv1.copyFrom(CascadedShadowGenerator._FrustumCornersNDCSpace[(cornerIndex+cornerIndexOffset)%CascadedShadowGenerator._FrustumCornersNDCSpace.length]);if(isNDCHalfZRange&&tmpv1.z===-1){tmpv1.z=0;}Vector3.TransformCoordinatesToRef(tmpv1,invViewProj,this._frustumCornersWorldSpace[cascadeIndex][cornerIndex]);}for(var _cornerIndex=0;_cornerIndex<CascadedShadowGenerator._FrustumCornersNDCSpace.length/2;++_cornerIndex){tmpv1.copyFrom(this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex+4]).subtractInPlace(this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex]);tmpv2.copyFrom(tmpv1).scaleInPlace(prevSplitDist);tmpv1.scaleInPlace(splitDist);tmpv1.addInPlace(this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex]);this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex+4].copyFrom(tmpv1);this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex].addInPlace(tmpv2);}}},{key:"_computeCascadeFrustum",value:function _computeCascadeFrustum(cascadeIndex){this._cascadeMinExtents[cascadeIndex].copyFromFloats(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this._cascadeMaxExtents[cascadeIndex].copyFromFloats(Number.MIN_VALUE,Number.MIN_VALUE,Number.MIN_VALUE);this._frustumCenter[cascadeIndex].copyFromFloats(0,0,0);var camera=this._getCamera();if(!camera){return;}for(var cornerIndex=0;cornerIndex<this._frustumCornersWorldSpace[cascadeIndex].length;++cornerIndex){this._frustumCenter[cascadeIndex].addInPlace(this._frustumCornersWorldSpace[cascadeIndex][cornerIndex]);}this._frustumCenter[cascadeIndex].scaleInPlace(1/this._frustumCornersWorldSpace[cascadeIndex].length);if(this.stabilizeCascades){var sphereRadius=0;for(var _cornerIndex2=0;_cornerIndex2<this._frustumCornersWorldSpace[cascadeIndex].length;++_cornerIndex2){var dist=this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex2].subtractToRef(this._frustumCenter[cascadeIndex],tmpv1).length();sphereRadius=Math.max(sphereRadius,dist);}sphereRadius=Math.ceil(sphereRadius*16)/16;this._cascadeMaxExtents[cascadeIndex].copyFromFloats(sphereRadius,sphereRadius,sphereRadius);this._cascadeMinExtents[cascadeIndex].copyFromFloats(-sphereRadius,-sphereRadius,-sphereRadius);}else{var lightCameraPos=this._frustumCenter[cascadeIndex];this._frustumCenter[cascadeIndex].addToRef(this._lightDirection,tmpv1);Matrix.LookAtLHToRef(lightCameraPos,tmpv1,UpDir,tmpMatrix);for(var _cornerIndex3=0;_cornerIndex3<this._frustumCornersWorldSpace[cascadeIndex].length;++_cornerIndex3){Vector3.TransformCoordinatesToRef(this._frustumCornersWorldSpace[cascadeIndex][_cornerIndex3],tmpMatrix,tmpv1);this._cascadeMinExtents[cascadeIndex].minimizeInPlace(tmpv1);this._cascadeMaxExtents[cascadeIndex].maximizeInPlace(tmpv1);}}}},{key:"_recreateSceneUBOs",value:function _recreateSceneUBOs(){this._disposeSceneUBOs();if(this._sceneUBOs){for(var i=0;i<this._numCascades;++i){this._sceneUBOs.push(this._scene.createSceneUniformBuffer("Scene for CSM Shadow Generator (light \"".concat(this._light.name,"\" cascade #").concat(i,")")));}}}},{key:"_initializeGenerator",value:function _initializeGenerator(){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v;this.penumbraDarkness=(_a=this.penumbraDarkness)!==null&&_a!==void 0?_a:1;this._numCascades=(_b=this._numCascades)!==null&&_b!==void 0?_b:CascadedShadowGenerator.DEFAULT_CASCADES_COUNT;this.stabilizeCascades=(_c=this.stabilizeCascades)!==null&&_c!==void 0?_c:false;this._freezeShadowCastersBoundingInfoObservable=(_d=this._freezeShadowCastersBoundingInfoObservable)!==null&&_d!==void 0?_d:null;this.freezeShadowCastersBoundingInfo=(_e=this.freezeShadowCastersBoundingInfo)!==null&&_e!==void 0?_e:false;this._scbiMin=(_f=this._scbiMin)!==null&&_f!==void 0?_f:new Vector3(0,0,0);this._scbiMax=(_g=this._scbiMax)!==null&&_g!==void 0?_g:new Vector3(0,0,0);this._shadowCastersBoundingInfo=(_h=this._shadowCastersBoundingInfo)!==null&&_h!==void 0?_h:new BoundingInfo(new Vector3(0,0,0),new Vector3(0,0,0));this._breaksAreDirty=(_j=this._breaksAreDirty)!==null&&_j!==void 0?_j:true;this._minDistance=(_k=this._minDistance)!==null&&_k!==void 0?_k:0;this._maxDistance=(_l=this._maxDistance)!==null&&_l!==void 0?_l:1;this._currentLayer=(_m=this._currentLayer)!==null&&_m!==void 0?_m:0;this._shadowMaxZ=(_q=(_o=this._shadowMaxZ)!==null&&_o!==void 0?_o:(_p=this._getCamera())===null||_p===void 0?void 0:_p.maxZ)!==null&&_q!==void 0?_q:1e4;this._debug=(_r=this._debug)!==null&&_r!==void 0?_r:false;this._depthClamp=(_s=this._depthClamp)!==null&&_s!==void 0?_s:true;this._cascadeBlendPercentage=(_t=this._cascadeBlendPercentage)!==null&&_t!==void 0?_t:0.1;this._lambda=(_u=this._lambda)!==null&&_u!==void 0?_u:0.5;this._autoCalcDepthBounds=(_v=this._autoCalcDepthBounds)!==null&&_v!==void 0?_v:false;this._recreateSceneUBOs();_get(_getPrototypeOf(CascadedShadowGenerator.prototype),"_initializeGenerator",this).call(this);}},{key:"_createTargetRenderTexture",value:function _createTargetRenderTexture(){var engine=this._scene.getEngine();var size={width:this._mapSize,height:this._mapSize,layers:this.numCascades};this._shadowMap=new RenderTargetTexture(this._light.name+"_CSMShadowMap",size,this._scene,false,true,this._textureType,false,void 0,false,false,void 0);this._shadowMap.createDepthStencilTexture(engine.useReverseDepthBuffer?516:513,true);}},{key:"_initializeShadowMap",value:function _initializeShadowMap(){var _this277=this;_get(_getPrototypeOf(CascadedShadowGenerator.prototype),"_initializeShadowMap",this).call(this);if(this._shadowMap===null){return;}this._transformMatricesAsArray=new Float32Array(this._numCascades*16);this._viewSpaceFrustumsZ=new Array(this._numCascades);this._frustumLengths=new Array(this._numCascades);this._lightSizeUVCorrection=new Array(this._numCascades*2);this._depthCorrection=new Array(this._numCascades);this._cascades=[];this._viewMatrices=[];this._projectionMatrices=[];this._transformMatrices=[];this._cascadeMinExtents=[];this._cascadeMaxExtents=[];this._frustumCenter=[];this._shadowCameraPos=[];this._frustumCornersWorldSpace=[];for(var cascadeIndex=0;cascadeIndex<this._numCascades;++cascadeIndex){this._cascades[cascadeIndex]={prevBreakDistance:0,breakDistance:0};this._viewMatrices[cascadeIndex]=Matrix.Zero();this._projectionMatrices[cascadeIndex]=Matrix.Zero();this._transformMatrices[cascadeIndex]=Matrix.Zero();this._cascadeMinExtents[cascadeIndex]=new Vector3();this._cascadeMaxExtents[cascadeIndex]=new Vector3();this._frustumCenter[cascadeIndex]=new Vector3();this._shadowCameraPos[cascadeIndex]=new Vector3();this._frustumCornersWorldSpace[cascadeIndex]=new Array(CascadedShadowGenerator._FrustumCornersNDCSpace.length);for(var i=0;i<CascadedShadowGenerator._FrustumCornersNDCSpace.length;++i){this._frustumCornersWorldSpace[cascadeIndex][i]=new Vector3();}}var engine=this._scene.getEngine();this._shadowMap.onBeforeBindObservable.clear();this._shadowMap.onBeforeRenderObservable.clear();this._shadowMap.onBeforeRenderObservable.add(function(layer){if(_this277._sceneUBOs){_this277._scene.setSceneUniformBuffer(_this277._sceneUBOs[layer]);}_this277._currentLayer=layer;if(_this277._filter===ShadowGenerator.FILTER_PCF){engine.setColorWrite(false);}_this277._scene.setTransformMatrix(_this277.getCascadeViewMatrix(layer),_this277.getCascadeProjectionMatrix(layer));if(_this277._useUBO){_this277._scene.getSceneUniformBuffer().unbindEffect();_this277._scene.finalizeSceneUbo();}});this._shadowMap.onBeforeBindObservable.add(function(){var _a;_this277._currentSceneUBO=_this277._scene.getSceneUniformBuffer();(_a=engine._debugPushGroup)===null||_a===void 0?void 0:_a.call(engine,"cascaded shadow map generation for pass id ".concat(engine.currentRenderPassId),1);if(_this277._breaksAreDirty){_this277._splitFrustum();}_this277._computeMatrices();});this._splitFrustum();}},{key:"_bindCustomEffectForRenderSubMeshForShadowMap",value:function _bindCustomEffectForRenderSubMeshForShadowMap(subMesh,effect){effect.setMatrix("viewProjection",this.getCascadeTransformMatrix(this._currentLayer));}},{key:"_isReadyCustomDefines",value:function _isReadyCustomDefines(defines){defines.push("#define SM_DEPTHCLAMP "+(this._depthClamp&&this._filter!==ShadowGenerator.FILTER_PCSS?"1":"0"));}},{key:"prepareDefines",value:function prepareDefines(defines,lightIndex){_get(_getPrototypeOf(CascadedShadowGenerator.prototype),"prepareDefines",this).call(this,defines,lightIndex);var scene2=this._scene;var light=this._light;if(!scene2.shadowsEnabled||!light.shadowEnabled){return;}defines["SHADOWCSM"+lightIndex]=true;defines["SHADOWCSMDEBUG"+lightIndex]=this.debug;defines["SHADOWCSMNUM_CASCADES"+lightIndex]=this.numCascades;defines["SHADOWCSM_RIGHTHANDED"+lightIndex]=scene2.useRightHandedSystem;var camera=this._getCamera();if(camera&&this._shadowMaxZ<camera.maxZ){defines["SHADOWCSMUSESHADOWMAXZ"+lightIndex]=true;}if(this.cascadeBlendPercentage===0){defines["SHADOWCSMNOBLEND"+lightIndex]=true;}}},{key:"bindShadowLight",value:function bindShadowLight(lightIndex,effect){var light=this._light;var scene2=this._scene;if(!scene2.shadowsEnabled||!light.shadowEnabled){return;}var camera=this._getCamera();if(!camera){return;}var shadowMap=this.getShadowMap();if(!shadowMap){return;}var width=shadowMap.getSize().width;effect.setMatrices("lightMatrix"+lightIndex,this._transformMatricesAsArray);effect.setArray("viewFrustumZ"+lightIndex,this._viewSpaceFrustumsZ);effect.setFloat("cascadeBlendFactor"+lightIndex,this.cascadeBlendPercentage===0?1e4:1/this.cascadeBlendPercentage);effect.setArray("frustumLengths"+lightIndex,this._frustumLengths);if(this._filter===ShadowGenerator.FILTER_PCF){effect.setDepthStencilTexture("shadowSampler"+lightIndex,shadowMap);light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),width,1/width,this.frustumEdgeFalloff,lightIndex);}else if(this._filter===ShadowGenerator.FILTER_PCSS){for(var cascadeIndex=0;cascadeIndex<this._numCascades;++cascadeIndex){this._lightSizeUVCorrection[cascadeIndex*2+0]=cascadeIndex===0?1:(this._cascadeMaxExtents[0].x-this._cascadeMinExtents[0].x)/(this._cascadeMaxExtents[cascadeIndex].x-this._cascadeMinExtents[cascadeIndex].x);this._lightSizeUVCorrection[cascadeIndex*2+1]=cascadeIndex===0?1:(this._cascadeMaxExtents[0].y-this._cascadeMinExtents[0].y)/(this._cascadeMaxExtents[cascadeIndex].y-this._cascadeMinExtents[cascadeIndex].y);this._depthCorrection[cascadeIndex]=cascadeIndex===0?1:(this._cascadeMaxExtents[cascadeIndex].z-this._cascadeMinExtents[cascadeIndex].z)/(this._cascadeMaxExtents[0].z-this._cascadeMinExtents[0].z);}effect.setDepthStencilTexture("shadowSampler"+lightIndex,shadowMap);effect.setTexture("depthSampler"+lightIndex,shadowMap);effect.setArray2("lightSizeUVCorrection"+lightIndex,this._lightSizeUVCorrection);effect.setArray("depthCorrection"+lightIndex,this._depthCorrection);effect.setFloat("penumbraDarkness"+lightIndex,this.penumbraDarkness);light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),1/width,this._contactHardeningLightSizeUVRatio*width,this.frustumEdgeFalloff,lightIndex);}else{effect.setTexture("shadowSampler"+lightIndex,shadowMap);light._uniformBuffer.updateFloat4("shadowsInfo",this.getDarkness(),width,1/width,this.frustumEdgeFalloff,lightIndex);}light._uniformBuffer.updateFloat2("depthValues",this.getLight().getDepthMinZ(camera),this.getLight().getDepthMinZ(camera)+this.getLight().getDepthMaxZ(camera),lightIndex);}},{key:"getTransformMatrix",value:function getTransformMatrix(){return this.getCascadeTransformMatrix(0);}},{key:"dispose",value:function dispose(){_get(_getPrototypeOf(CascadedShadowGenerator.prototype),"dispose",this).call(this);if(this._freezeShadowCastersBoundingInfoObservable){this._scene.onBeforeRenderObservable.remove(this._freezeShadowCastersBoundingInfoObservable);this._freezeShadowCastersBoundingInfoObservable=null;}if(this._depthReducer){this._depthReducer.dispose();this._depthReducer=null;}}},{key:"serialize",value:function serialize(){var serializationObject=_get(_getPrototypeOf(CascadedShadowGenerator.prototype),"serialize",this).call(this);var shadowMap=this.getShadowMap();if(!shadowMap){return serializationObject;}serializationObject.numCascades=this._numCascades;serializationObject.debug=this._debug;serializationObject.stabilizeCascades=this.stabilizeCascades;serializationObject.lambda=this._lambda;serializationObject.cascadeBlendPercentage=this.cascadeBlendPercentage;serializationObject.depthClamp=this._depthClamp;serializationObject.autoCalcDepthBounds=this.autoCalcDepthBounds;serializationObject.shadowMaxZ=this._shadowMaxZ;serializationObject.penumbraDarkness=this.penumbraDarkness;serializationObject.freezeShadowCastersBoundingInfo=this._freezeShadowCastersBoundingInfo;serializationObject.minDistance=this.minDistance;serializationObject.maxDistance=this.maxDistance;serializationObject.renderList=[];if(shadowMap.renderList){for(var meshIndex=0;meshIndex<shadowMap.renderList.length;meshIndex++){var mesh=shadowMap.renderList[meshIndex];serializationObject.renderList.push(mesh.id);}}return serializationObject;}}],[{key:"IsSupported",get:function get(){var engine=EngineStore.LastCreatedEngine;if(!engine){return false;}return engine._features.supportCSM;}},{key:"Parse",value:function Parse(parsedShadowGenerator,scene2){var shadowGenerator=ShadowGenerator.Parse(parsedShadowGenerator,scene2,function(mapSize,light,camera){return new CascadedShadowGenerator(mapSize,light,void 0,camera);});if(parsedShadowGenerator.numCascades!==void 0){shadowGenerator.numCascades=parsedShadowGenerator.numCascades;}if(parsedShadowGenerator.debug!==void 0){shadowGenerator.debug=parsedShadowGenerator.debug;}if(parsedShadowGenerator.stabilizeCascades!==void 0){shadowGenerator.stabilizeCascades=parsedShadowGenerator.stabilizeCascades;}if(parsedShadowGenerator.lambda!==void 0){shadowGenerator.lambda=parsedShadowGenerator.lambda;}if(parsedShadowGenerator.cascadeBlendPercentage!==void 0){shadowGenerator.cascadeBlendPercentage=parsedShadowGenerator.cascadeBlendPercentage;}if(parsedShadowGenerator.depthClamp!==void 0){shadowGenerator.depthClamp=parsedShadowGenerator.depthClamp;}if(parsedShadowGenerator.autoCalcDepthBounds!==void 0){shadowGenerator.autoCalcDepthBounds=parsedShadowGenerator.autoCalcDepthBounds;}if(parsedShadowGenerator.shadowMaxZ!==void 0){shadowGenerator.shadowMaxZ=parsedShadowGenerator.shadowMaxZ;}if(parsedShadowGenerator.penumbraDarkness!==void 0){shadowGenerator.penumbraDarkness=parsedShadowGenerator.penumbraDarkness;}if(parsedShadowGenerator.freezeShadowCastersBoundingInfo!==void 0){shadowGenerator.freezeShadowCastersBoundingInfo=parsedShadowGenerator.freezeShadowCastersBoundingInfo;}if(parsedShadowGenerator.minDistance!==void 0&&parsedShadowGenerator.maxDistance!==void 0){shadowGenerator.setMinMaxDistance(parsedShadowGenerator.minDistance,parsedShadowGenerator.maxDistance);}return shadowGenerator;}}]);return CascadedShadowGenerator;}(ShadowGenerator);CascadedShadowGenerator._FrustumCornersNDCSpace=[new Vector3(-1,1,-1),new Vector3(1,1,-1),new Vector3(1,-1,-1),new Vector3(-1,-1,-1),new Vector3(-1,1,1),new Vector3(1,1,1),new Vector3(1,-1,1),new Vector3(-1,-1,1)];CascadedShadowGenerator.CLASSNAME="CascadedShadowGenerator";CascadedShadowGenerator.DEFAULT_CASCADES_COUNT=4;CascadedShadowGenerator.MIN_CASCADES_COUNT=2;CascadedShadowGenerator.MAX_CASCADES_COUNT=4;CascadedShadowGenerator._SceneComponentInitialization=function(_){throw _WarnImport("ShadowGeneratorSceneComponent");};// node_modules/@babylonjs/core/Lights/Shadows/shadowGeneratorSceneComponent.js
AbstractScene.AddParser(SceneComponentConstants.NAME_SHADOWGENERATOR,function(parsedData,scene2){if(parsedData.shadowGenerators!==void 0&&parsedData.shadowGenerators!==null){for(var index=0,cache=parsedData.shadowGenerators.length;index<cache;index++){var parsedShadowGenerator=parsedData.shadowGenerators[index];if(parsedShadowGenerator.className===CascadedShadowGenerator.CLASSNAME){CascadedShadowGenerator.Parse(parsedShadowGenerator,scene2);}else{ShadowGenerator.Parse(parsedShadowGenerator,scene2);}}}});var ShadowGeneratorSceneComponent=/*#__PURE__*/function(){function ShadowGeneratorSceneComponent(scene2){_classCallCheck(this,ShadowGeneratorSceneComponent);this.name=SceneComponentConstants.NAME_SHADOWGENERATOR;this.scene=scene2;}_createClass(ShadowGeneratorSceneComponent,[{key:"register",value:function register(){this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR,this,this._gatherRenderTargets);}},{key:"rebuild",value:function rebuild(){}},{key:"serialize",value:function serialize(serializationObject){serializationObject.shadowGenerators=[];var lights=this.scene.lights;var _iterator262=_createForOfIteratorHelper(lights),_step275;try{for(_iterator262.s();!(_step275=_iterator262.n()).done;){var light=_step275.value;var shadowGenerators=light.getShadowGenerators();if(shadowGenerators){var iterator=shadowGenerators.values();for(var key=iterator.next();key.done!==true;key=iterator.next()){var shadowGenerator=key.value;serializationObject.shadowGenerators.push(shadowGenerator.serialize());}}}}catch(err){_iterator262.e(err);}finally{_iterator262.f();}}},{key:"addFromContainer",value:function addFromContainer(container){}},{key:"removeFromContainer",value:function removeFromContainer(container,dispose){}},{key:"dispose",value:function dispose(){}},{key:"_gatherRenderTargets",value:function _gatherRenderTargets(renderTargets){var scene2=this.scene;if(this.scene.shadowsEnabled){for(var lightIndex=0;lightIndex<scene2.lights.length;lightIndex++){var light=scene2.lights[lightIndex];var shadowGenerators=light.getShadowGenerators();if(light.isEnabled()&&light.shadowEnabled&&shadowGenerators){var iterator=shadowGenerators.values();for(var key=iterator.next();key.done!==true;key=iterator.next()){var shadowGenerator=key.value;var shadowMap=shadowGenerator.getShadowMap();if(scene2.textures.indexOf(shadowMap)!==-1){renderTargets.push(shadowMap);}}}}}}}]);return ShadowGeneratorSceneComponent;}();ShadowGenerator._SceneComponentInitialization=function(scene2){var component=scene2._getComponent(SceneComponentConstants.NAME_SHADOWGENERATOR);if(!component){component=new ShadowGeneratorSceneComponent(scene2);scene2._addComponent(component);}};// src/a.scene.ts
debug("a.scene loaded");var _AScene=/*#__PURE__*/function(){function _AScene(config){_classCallCheck(this,_AScene);this.initialized=false;this.config=config;if(!this.config.sceneId){this.config.sceneId=Date.now().toString();}this.renderer=new _BabylonRenderer(this.config);}_createClass(_AScene,[{key:"getRenderer",value:function getRenderer(){return this.renderer;}},{key:"cast",value:function cast(){return this.renderer.getScene();}},{key:"init",value:function(){var _init=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee9(){return _regeneratorRuntime().wrap(function _callee9$(_context9){while(1)switch(_context9.prev=_context9.next){case 0:if(!this.initialized){_context9.next=2;break;}return _context9.abrupt("return");case 2:;this.renderer.init();if(this.config.rendererLibrary==="three"){this.initThreeScene();}else{this.initBabylonScene();}this.initialized=true;case 6:case"end":return _context9.stop();}},_callee9,this);}));function init(){return _init.apply(this,arguments);}return init;}()},{key:"initBabylonScene",value:function initBabylonScene(){this.configureBabylonShadows();if(this.config.disableCameraRotation){this.disableBabylonCameraRotation();}if(this.config.disableCameraZoom){this.disableBabylonCameraZoom();}}},{key:"initThreeScene",value:function initThreeScene(){}},{key:"configureBabylonShadows",value:function configureBabylonShadows(){var _this278=this;var shadowLight=new DirectionalLight("shadowLight",new Vector3(0.8,-2,-1),this.renderer.getScene());shadowLight.diffuse=new Color3(1,0.9,0.62);shadowLight.intensity=2;this.shadowGenerator=new ShadowGenerator(2048,shadowLight);this.shadowGenerator.useBlurExponentialShadowMap=true;this.shadowGenerator.blurKernel=8;this.renderer.getScene().meshes.forEach(function(mesh){var _this278$shadowGenera;(_this278$shadowGenera=_this278.shadowGenerator)===null||_this278$shadowGenera===void 0||_this278$shadowGenera.addShadowCaster(mesh);});}},{key:"disableBabylonCameraRotation",value:function disableBabylonCameraRotation(){var scene2=this.renderer.getScene();scene2.registerBeforeRender(function(){});}},{key:"disableBabylonCameraZoom",value:function disableBabylonCameraZoom(){}},{key:"render",value:function(){var _render3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee10(onUpdate,onRender,onFrame){return _regeneratorRuntime().wrap(function _callee10$(_context10){while(1)switch(_context10.prev=_context10.next){case 0:_context10.next=2;return this.renderer.render(onUpdate,onRender,onFrame);case 2:case"end":return _context10.stop();}},_callee10,this);}));function render(_x16,_x17,_x18){return _render3.apply(this,arguments);}return render;}()},{key:"unload",value:function(){var _unload=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee11(){return _regeneratorRuntime().wrap(function _callee11$(_context11){while(1)switch(_context11.prev=_context11.next){case 0:if(this.config.rendererLibrary==="three"){this.threeOnDestroy();}else{this.babylonOnDestroy();}case 1:case"end":return _context11.stop();}},_callee11,this);}));function unload(){return _unload.apply(this,arguments);}return unload;}()},{key:"babylonOnDestroy",value:function(){var _babylonOnDestroy=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee12(){return _regeneratorRuntime().wrap(function _callee12$(_context12){while(1)switch(_context12.prev=_context12.next){case 0:this.renderer.getScene().dispose();case 1:case"end":return _context12.stop();}},_callee12,this);}));function babylonOnDestroy(){return _babylonOnDestroy.apply(this,arguments);}return babylonOnDestroy;}()},{key:"threeOnDestroy",value:function(){var _threeOnDestroy=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee13(){return _regeneratorRuntime().wrap(function _callee13$(_context13){while(1)switch(_context13.prev=_context13.next){case 0:case"end":return _context13.stop();}},_callee13);}));function threeOnDestroy(){return _threeOnDestroy.apply(this,arguments);}return threeOnDestroy;}()}]);return _AScene;}();// src/utils.renderer.ts
debug("utils.renderer loaded");var fnForRenderer=/*#__PURE__*/function(){var _ref24=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee14(rendererLibrary,fns){var fn;return _regeneratorRuntime().wrap(function _callee14$(_context14){while(1)switch(_context14.prev=_context14.next){case 0:if(fns.has(rendererLibrary)){_context14.next=2;break;}throw new Error("TODO programmer error");case 2:fn=fns.get(rendererLibrary);_context14.next=5;return fn();case 5:case"end":return _context14.stop();}},_callee14);}));return function fnForRenderer(_x19,_x20){return _ref24.apply(this,arguments);};}();// src/a.level.ts
debug("a.level loaded");var _ALevel=/*#__PURE__*/function(){function _ALevel(scene2){_classCallCheck(this,_ALevel);this.loading=true;this.scene=scene2;}_createClass(_ALevel,[{key:"load",value:function(){var _load=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee15(){var _this279=this;return _regeneratorRuntime().wrap(function _callee15$(_context15){while(1)switch(_context15.prev=_context15.next){case 0:_context15.next=2;return this.scene.init();case 2:_context15.next=4;return this.beforeLevelLoaded();case 4:_context15.next=6;return this.loadLevel();case 6:_context15.next=8;return this.afterLevelLoaded();case 8:_context15.next=10;return this.scene.render(function(){_this279.onUpdate();},function(){_this279.onRender();},function(pixels){_this279.onFrame(pixels);});case 10:case"end":return _context15.stop();}},_callee15,this);}));function load(){return _load.apply(this,arguments);}return load;}()},{key:"beforeLevelLoaded",value:function(){var _beforeLevelLoaded=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee16(){var _this280=this;var fnsForRenderer;return _regeneratorRuntime().wrap(function _callee16$(_context16){while(1)switch(_context16.prev=_context16.next){case 0:fnsForRenderer=/* @__PURE__ */new Map();fnsForRenderer.set("babylon",function(){_this280.beforeBabylonLevelLoaded();});_context16.next=4;return fnForRenderer(this.scene.getRenderer().getConfig().rendererLibrary,fnsForRenderer);case 4:case"end":return _context16.stop();}},_callee16,this);}));function beforeLevelLoaded(){return _beforeLevelLoaded.apply(this,arguments);}return beforeLevelLoaded;}()},{key:"beforeBabylonLevelLoaded",value:function(){var _beforeBabylonLevelLoaded=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee17(){return _regeneratorRuntime().wrap(function _callee17$(_context17){while(1)switch(_context17.prev=_context17.next){case 0:case"end":return _context17.stop();}},_callee17);}));function beforeBabylonLevelLoaded(){return _beforeBabylonLevelLoaded.apply(this,arguments);}return beforeBabylonLevelLoaded;}()},{key:"loadLevel",value:function(){var _loadLevel=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee18(){var _this281=this;var fnsForRenderer;return _regeneratorRuntime().wrap(function _callee18$(_context18){while(1)switch(_context18.prev=_context18.next){case 0:fnsForRenderer=/* @__PURE__ */new Map();fnsForRenderer.set("babylon",function(){_this281.loadBabylonLevel();});_context18.next=4;return fnForRenderer(this.scene.getRenderer().getConfig().rendererLibrary,fnsForRenderer);case 4:case"end":return _context18.stop();}},_callee18,this);}));function loadLevel(){return _loadLevel.apply(this,arguments);}return loadLevel;}()},{key:"loadBabylonLevel",value:function(){var _loadBabylonLevel=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee19(){return _regeneratorRuntime().wrap(function _callee19$(_context19){while(1)switch(_context19.prev=_context19.next){case 0:case"end":return _context19.stop();}},_callee19);}));function loadBabylonLevel(){return _loadBabylonLevel.apply(this,arguments);}return loadBabylonLevel;}()},{key:"afterLevelLoaded",value:function(){var _afterLevelLoaded=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee20(){var _this282=this;var fnsForRenderer;return _regeneratorRuntime().wrap(function _callee20$(_context20){while(1)switch(_context20.prev=_context20.next){case 0:fnsForRenderer=/* @__PURE__ */new Map();fnsForRenderer.set("babylon",function(){_this282.afterBabylonLevelLoaded();});_context20.next=4;return fnForRenderer(this.scene.getRenderer().getConfig().rendererLibrary,fnsForRenderer);case 4:case"end":return _context20.stop();}},_callee20,this);}));function afterLevelLoaded(){return _afterLevelLoaded.apply(this,arguments);}return afterLevelLoaded;}()},{key:"afterBabylonLevelLoaded",value:function(){var _afterBabylonLevelLoaded=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee21(){return _regeneratorRuntime().wrap(function _callee21$(_context21){while(1)switch(_context21.prev=_context21.next){case 0:case"end":return _context21.stop();}},_callee21);}));function afterBabylonLevelLoaded(){return _afterBabylonLevelLoaded.apply(this,arguments);}return afterBabylonLevelLoaded;}()},{key:"onUpdate",value:function(){var _onUpdate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee22(){var _this283=this;var fnsForRenderer;return _regeneratorRuntime().wrap(function _callee22$(_context22){while(1)switch(_context22.prev=_context22.next){case 0:fnsForRenderer=/* @__PURE__ */new Map();fnsForRenderer.set("babylon",function(){_this283.babylonOnUpdate();});_context22.next=4;return fnForRenderer(this.scene.getRenderer().getConfig().rendererLibrary,fnsForRenderer);case 4:case"end":return _context22.stop();}},_callee22,this);}));function onUpdate(){return _onUpdate.apply(this,arguments);}return onUpdate;}()},{key:"babylonOnUpdate",value:function(){var _babylonOnUpdate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee23(){return _regeneratorRuntime().wrap(function _callee23$(_context23){while(1)switch(_context23.prev=_context23.next){case 0:case"end":return _context23.stop();}},_callee23);}));function babylonOnUpdate(){return _babylonOnUpdate.apply(this,arguments);}return babylonOnUpdate;}()},{key:"onRender",value:function(){var _onRender=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee24(){var _this284=this;var fnsForRenderer;return _regeneratorRuntime().wrap(function _callee24$(_context24){while(1)switch(_context24.prev=_context24.next){case 0:fnsForRenderer=/* @__PURE__ */new Map();fnsForRenderer.set("babylon",function(){_this284.babylonOnRender();});_context24.next=4;return fnForRenderer(this.scene.getRenderer().getConfig().rendererLibrary,fnsForRenderer);case 4:case"end":return _context24.stop();}},_callee24,this);}));function onRender(){return _onRender.apply(this,arguments);}return onRender;}()},{key:"babylonOnRender",value:function(){var _babylonOnRender=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee25(){return _regeneratorRuntime().wrap(function _callee25$(_context25){while(1)switch(_context25.prev=_context25.next){case 0:case"end":return _context25.stop();}},_callee25);}));function babylonOnRender(){return _babylonOnRender.apply(this,arguments);}return babylonOnRender;}()},{key:"onFrame",value:function(){var _onFrame2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee26(pixels){var _this285=this;var fnsForRenderer;return _regeneratorRuntime().wrap(function _callee26$(_context26){while(1)switch(_context26.prev=_context26.next){case 0:fnsForRenderer=/* @__PURE__ */new Map();fnsForRenderer.set("babylon",function(){_this285.babylonOnFrame(pixels);});_context26.next=4;return fnForRenderer(this.scene.getRenderer().getConfig().rendererLibrary,fnsForRenderer);case 4:case"end":return _context26.stop();}},_callee26,this);}));function onFrame(_x21){return _onFrame2.apply(this,arguments);}return onFrame;}()},{key:"babylonOnFrame",value:function(){var _babylonOnFrame=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee27(pixels){return _regeneratorRuntime().wrap(function _callee27$(_context27){while(1)switch(_context27.prev=_context27.next){case 0:case"end":return _context27.stop();}},_callee27);}));function babylonOnFrame(_x22){return _babylonOnFrame.apply(this,arguments);}return babylonOnFrame;}()}]);return _ALevel;}();// src/viewport.ts
var viewport_exports={};__export(viewport_exports,{defaultViewportDimensions:function defaultViewportDimensions(){return _defaultViewportDimensions;},fitCanvasToContainer:function fitCanvasToContainer(){return _fitCanvasToContainer;},getDimensions:function getDimensions(){return _getDimensions;},getElementDimensions:function getElementDimensions(){return _getElementDimensions;},getPixels:function getPixels(){return _getPixels;}});debug("viewport loaded");var _fitCanvasToContainer=function _fitCanvasToContainer(canvas){canvas.style.width="100%";canvas.style.height="100%";canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;};var _getDimensions=function _getDimensions(config){return _getElementDimensions(config.sceneElement);};var _getElementDimensions=function _getElementDimensions(element){var width=parseFloat(getComputedStyle(element).getPropertyValue("width"));var height=parseFloat(getComputedStyle(element).getPropertyValue("height"));return{width:width,height:height};};var _getPixels=function _getPixels(webGLRenderingContext,activeViewportDimensions){if(!activeViewportDimensions){activeViewportDimensions=_defaultViewportDimensions;};var pixels=new Uint8Array(4*activeViewportDimensions.width*activeViewportDimensions.height);webGLRenderingContext.readPixels(0,0,activeViewportDimensions.width,activeViewportDimensions.height,webGLRenderingContext.RGBA,webGLRenderingContext.UNSIGNED_BYTE,pixels);return pixels;};var _defaultViewportDimensions={width:_scene2.headlessViewportWidth,height:_scene2.headlessViewportHeight};// Annotate the CommonJS export names for ESM import in node:
0&&(module.exports={ALevel:_ALevel,AScene:_AScene,BabylonRenderer:_BabylonRenderer,RendererState:_RendererState,constants:constants,viewport:viewport});